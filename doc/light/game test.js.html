<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Adding meta -->
    
    
    <meta name="Description" content="VtuberKill API Document" />
    
    

    <!-- Adding external script-->
    
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" ></script>
    
    <script id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" ></script>
    
    

    <!-- Adding external style-->
    

    <!-- Adding scripts-->
    

    <!-- Adding style-->
    

    <!-- Adding overlay script-->
    

    <!-- Adding overlay style-->
    


    <title>
      game test.js
    </title>

    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/third-party/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/third-party/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/reset.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-base.css">
    <link type="text/css" rel="stylesheet" href="styles/clean-jsdoc-theme-light.css">
    
    <svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
    style="display:none">
    <defs>
        <symbol id="copy-icon" viewbox="0 0 488.3 488.3">
            <g>
                <path
                    d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z" />
                <path
                    d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z" />
            </g>
        </symbol>
        <symbol id='search-icon' viewBox="0 0 512 512">
            <g>
                <g>
                    <path
                        d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z" />
                </g>
            </g>
            <g>
                <g>
                    <path
                        d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z" />
                </g>
            </g>
        </symbol>
        <symbol id="down-icon" viewBox="0 0 16 16">
            <path 
                fill-rule="evenodd" 
                clip-rule="evenodd" 
                d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"
            >
            </path>
        </symbol>
    </defs>
</svg>
  </head>

  <body>

    <nav class="navbar" id="navbar">
      <div class="navbar-heading" id="navbar-heading"><a href="index.html"><h2 class="navbar-heading-text">VK API</h2></a></div><div class="search-box" id="search-box"><div class="search-box-input-container"><input class="search-box-input" type="text" placeholder="Search..." id="search-box-input" /><svg class="search-icon" alt="search-icon"><use xlink:href="#search-icon"></use></svg></div><div class="search-item-container" id="search-item-container"><ul class="search-item-ul" id="search-item-ul"></ul></div></div><div class="sidebar-main-content" id="sidebar-main-content"><div class="accordion collapsed" id="9659084" > <h3 class="accordion-heading">Classes<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=577383><div class="accordion-heading child"><a href="Array.html">Array</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Array.html#add">add</a></li><li data-type='method'><a href="Array.html#add">add</a></li><li data-type='method'><a href="Array.html#addArray">addArray</a></li><li data-type='method'><a href="Array.html#addArray">addArray</a></li><li data-type='method'><a href="Array.html#contains">contains</a></li><li data-type='method'><a href="Array.html#contains">contains</a></li><li data-type='method'><a href="Array.html#filterInD">filterInD</a></li><li data-type='method'><a href="Array.html#filterInD">filterInD</a></li><li data-type='method'><a href="Array.html#find">find</a></li><li data-type='method'><a href="Array.html#find">find</a></li><li data-type='method'><a href="Array.html#from">from</a></li><li data-type='method'><a href="Array.html#from">from</a></li><li data-type='method'><a href="Array.html#numOf">numOf</a></li><li data-type='method'><a href="Array.html#numOf">numOf</a></li><li data-type='method'><a href="Array.html#randomGet">randomGet</a></li><li data-type='method'><a href="Array.html#randomGet">randomGet</a></li><li data-type='method'><a href="Array.html#randomGet">randomGet</a></li><li data-type='method'><a href="Array.html#randomGet">randomGet</a></li><li data-type='method'><a href="Array.html#randomRemove">randomRemove</a></li><li data-type='method'><a href="Array.html#randomRemove">randomRemove</a></li><li data-type='method'><a href="Array.html#randomSort">randomSort</a></li><li data-type='method'><a href="Array.html#randomSort">randomSort</a></li><li data-type='method'><a href="Array.html#remove">remove</a></li><li data-type='method'><a href="Array.html#remove">remove</a></li><li data-type='method'><a href="Array.html#removeArray">removeArray</a></li><li data-type='method'><a href="Array.html#removeArray">removeArray</a></li><li data-type='method'><a href="Array.html#sortBySeat">sortBySeat</a></li><li data-type='method'><a href="Array.html#sortBySeat">sortBySeat</a></li></ul></li><li class="accordion-list" id=""><a href="Error.html">Error</a></li><li class="accordion collapsed child" id=5367687><div class="accordion-heading child"><a href="HTMLDivElement.html">HTMLDivElement</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="HTMLDivElement.html#animate">animate</a></li><li data-type='method'><a href="HTMLDivElement.html#animate">animate</a></li><li data-type='method'><a href="HTMLDivElement.html#css">css</a></li><li data-type='method'><a href="HTMLDivElement.html#css">css</a></li><li data-type='method'><a href="HTMLDivElement.html#delete">delete</a></li><li data-type='method'><a href="HTMLDivElement.html#delete">delete</a></li><li data-type='method'><a href="HTMLDivElement.html#fix">fix</a></li><li data-type='method'><a href="HTMLDivElement.html#fix">fix</a></li><li data-type='method'><a href="HTMLDivElement.html#goto">goto</a></li><li data-type='method'><a href="HTMLDivElement.html#goto">goto</a></li><li data-type='method'><a href="HTMLDivElement.html#hide">hide</a></li><li data-type='method'><a href="HTMLDivElement.html#hide">hide</a></li><li data-type='method'><a href="HTMLDivElement.html#listen">listen</a></li><li data-type='method'><a href="HTMLDivElement.html#listen">listen</a></li><li data-type='method'><a href="HTMLDivElement.html#listenTransition">listenTransition</a></li><li data-type='method'><a href="HTMLDivElement.html#listenTransition">listenTransition</a></li><li data-type='method'><a href="HTMLDivElement.html#refocus">refocus</a></li><li data-type='method'><a href="HTMLDivElement.html#refocus">refocus</a></li><li data-type='method'><a href="HTMLDivElement.html#setBackground">setBackground</a></li><li data-type='method'><a href="HTMLDivElement.html#setBackground">setBackground</a></li><li data-type='method'><a href="HTMLDivElement.html#setBackgroundDB">setBackgroundDB</a></li><li data-type='method'><a href="HTMLDivElement.html#setBackgroundDB">setBackgroundDB</a></li><li data-type='method'><a href="HTMLDivElement.html#setBackgroundImage">setBackgroundImage</a></li><li data-type='method'><a href="HTMLDivElement.html#setBackgroundImage">setBackgroundImage</a></li><li data-type='method'><a href="HTMLDivElement.html#setPosition">setPosition</a></li><li data-type='method'><a href="HTMLDivElement.html#setPosition">setPosition</a></li><li data-type='method'><a href="HTMLDivElement.html#setPosition2">setPosition</a></li><li data-type='method'><a href="HTMLDivElement.html#setPosition2">setPosition</a></li><li data-type='method'><a href="HTMLDivElement.html#show">show</a></li><li data-type='method'><a href="HTMLDivElement.html#show">show</a></li><li data-type='method'><a href="HTMLDivElement.html#unfocus">unfocus</a></li><li data-type='method'><a href="HTMLDivElement.html#unfocus">unfocus</a></li></ul></li><li class="accordion-list" id=""><a href="HTMLDivElementProxyProxy.html">HTMLDivElementProxyProxy</a></li><li class="accordion-list" id=""><a href="HTMLTableCellElement.html">HTMLTableCellElement</a></li><li class="accordion collapsed child" id=3878894><div class="accordion-heading child"><a href="HTMLTableElement.html">HTMLTableElement</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="HTMLTableElement.html#get">get</a></li><li data-type='method'><a href="HTMLTableElement.html#get">get</a></li></ul></li><li class="accordion collapsed child" id=1670717><div class="accordion-heading child"><a href="module-moduleManager-Module.html">Module</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-moduleManager-Module.html#get">get</a></li><li data-type='method'><a href="module-moduleManager-Module.html#init">init</a></li><li data-type='method'><a href="module-moduleManager-Module.html#then">then</a></li></ul></li><li class="accordion collapsed child" id=878694><div class="accordion-heading child"><a href="PlayerModel.html">PlayerModel</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="PlayerModel.html#$damagepop">$damagepop</a></li><li data-type='method'><a href="PlayerModel.html#$showCharacter">$showCharacter</a></li><li data-type='method'><a href="PlayerModel.html#$skill">$skill</a></li><li data-type='method'><a href="PlayerModel.html#$throwEmotion">$throwEmotion</a></li><li data-type='method'><a href="PlayerModel.html#addAdditionalSkill">addAdditionalSkill</a></li><li data-type='method'><a href="PlayerModel.html#addEquipTrigger">addEquipTrigger</a></li><li data-type='method'><a href="PlayerModel.html#addGaintag">addGaintag</a></li><li data-type='method'><a href="PlayerModel.html#addMark">addMark</a></li><li data-type='method'><a href="PlayerModel.html#addSkillBlocker">addSkillBlocker</a></li><li data-type='method'><a href="PlayerModel.html#addSkillLog">addSkillLog</a></li><li data-type='method'><a href="PlayerModel.html#addSkillTrigger">addSkillTrigger</a></li><li data-type='method'><a href="PlayerModel.html#addSubPlayer">addSubPlayer</a></li><li data-type='method'><a href="PlayerModel.html#addTempSkill">addTempSkill</a></li><li data-type='method'><a href="PlayerModel.html#addToJudge">addToJudge</a></li><li data-type='method'><a href="PlayerModel.html#applySkills">applySkills</a></li><li data-type='method'><a href="PlayerModel.html#attitudeTo">attitudeTo</a></li><li data-type='method'><a href="PlayerModel.html#awakenSkill">awakenSkill</a></li><li data-type='method'><a href="PlayerModel.html#buffAvatar">buffAvatar</a></li><li data-type='method'><a href="PlayerModel.html#callSubPlayer">callSubPlayer</a></li><li data-type='method'><a href="PlayerModel.html#canAddToJudge">canAddToJudge</a></li><li data-type='method'><a href="PlayerModel.html#canSave">canSave</a></li><li data-type='method'><a href="PlayerModel.html#canUse">canUse</a></li><li data-type='method'><a href="PlayerModel.html#changeSeat">changeSeat</a></li><li data-type='method'><a href="PlayerModel.html#chat">chat</a></li><li data-type='method'><a href="PlayerModel.html#checkConflict">checkConflict</a></li><li data-type='method'><a href="PlayerModel.html#checkMarks">checkMarks</a></li><li data-type='method'><a href="PlayerModel.html#chooseToGuanxing">chooseToGuanxing</a></li><li data-type='method'><a href="PlayerModel.html#clearSkills">clearSkills</a></li><li data-type='method'><a href="PlayerModel.html#countMark">countMark</a></li><li data-type='method'><a href="PlayerModel.html#directgains">directgains</a></li><li data-type='method'><a href="PlayerModel.html#disableSkill">disableSkill</a></li><li data-type='method'><a href="PlayerModel.html#emotion">emotion</a></li><li data-type='method'><a href="PlayerModel.html#enableSkill">enableSkill</a></li><li data-type='method'><a href="PlayerModel.html#exitSubPlayer">exitSubPlayer</a></li><li data-type='method'><a href="PlayerModel.html#flashAvatar">flashAvatar</a></li><li data-type='method'><a href="PlayerModel.html#get">get</a></li><li data-type='method'><a href="PlayerModel.html#getAllHistory">getAllHistory</a></li><li data-type='method'><a href="PlayerModel.html#getAttackRange">getAttackRange</a></li><li data-type='method'><a href="PlayerModel.html#getCardUsable">getCardUsable</a></li><li data-type='method'><a href="PlayerModel.html#getDamagedHp">getDamagedHp</a></li><li data-type='method'><a href="PlayerModel.html#getEquip">getEquip</a></li><li data-type='method'><a href="PlayerModel.html#getGlobalFrom">getGlobalFrom</a></li><li data-type='method'><a href="PlayerModel.html#getGlobalTo">getGlobalTo</a></li><li data-type='method'><a href="PlayerModel.html#getHandcardLimit">getHandcardLimit</a></li><li data-type='method'><a href="PlayerModel.html#getHistory">getHistory</a></li><li data-type='method'><a href="PlayerModel.html#getId">getId</a></li><li data-type='method'><a href="PlayerModel.html#getJudge">getJudge</a></li><li data-type='method'><a href="PlayerModel.html#getLastHistory">getLastHistory</a></li><li data-type='method'><a href="PlayerModel.html#getLastStat">getLastStat</a></li><li data-type='method'><a href="PlayerModel.html#getLastUsed">getLastUsed</a></li><li data-type='method'><a href="PlayerModel.html#getLeft">getLeft</a></li><li data-type='method'><a href="PlayerModel.html#getSkills">getSkills</a></li><li data-type='method'><a href="PlayerModel.html#getStat">getStat</a></li><li data-type='method'><a href="PlayerModel.html#getState">getState</a></li><li data-type='method'><a href="PlayerModel.html#getSubPlayers">getSubPlayers</a></li><li data-type='method'><a href="PlayerModel.html#getTop">getTop</a></li><li data-type='method'><a href="PlayerModel.html#getUseValue">getUseValue</a></li><li data-type='method'><a href="PlayerModel.html#goMad">goMad</a></li><li data-type='method'><a href="PlayerModel.html#hasCardAround">hasCardAround</a></li><li data-type='method'><a href="PlayerModel.html#hasMark">hasMark</a></li><li data-type='method'><a href="PlayerModel.html#hasSkill">hasSkill</a></li><li data-type='method'><a href="PlayerModel.html#hasUseTarget">hasUseTarget</a></li><li data-type='method'><a href="PlayerModel.html#hasValueTarget">hasValueTarget</a></li><li data-type='method'><a href="PlayerModel.html#init">init</a></li><li data-type='method'><a href="PlayerModel.html#initOL">initOL</a></li><li data-type='method'><a href="PlayerModel.html#initRoom">initRoom</a></li><li data-type='method'><a href="PlayerModel.html#inRange">inRange</a></li><li data-type='method'><a href="PlayerModel.html#inRangeOf">inRangeOf</a></li><li data-type='method'><a href="PlayerModel.html#isAlive">isAlive</a></li><li data-type='method'><a href="PlayerModel.html#isDamaged">isDamaged</a></li><li data-type='method'><a href="PlayerModel.html#isDead">isDead</a></li><li data-type='method'><a href="PlayerModel.html#isDying">isDying</a></li><li data-type='method'><a href="PlayerModel.html#isEnemiesOf">isEnemiesOf</a></li><li data-type='method'><a href="PlayerModel.html#isEnemyOf">isEnemyOf</a></li><li data-type='method'><a href="PlayerModel.html#isFriendOf">isFriendOf</a></li><li data-type='method'><a href="PlayerModel.html#isFriendsOf">isFriendsOf</a></li><li data-type='method'><a href="PlayerModel.html#isHealthy">isHealthy</a></li><li data-type='method'><a href="PlayerModel.html#isIn">isIn</a></li><li data-type='method'><a href="PlayerModel.html#isLinked">isLinked</a></li><li data-type='method'><a href="PlayerModel.html#isMad">isMad</a></li><li data-type='method'><a href="PlayerModel.html#isMaxCard">isMaxCard</a></li><li data-type='method'><a href="PlayerModel.html#isMaxEquip">isMaxEquip</a></li><li data-type='method'><a href="PlayerModel.html#isMaxHandcard">isMaxHandcard</a></li><li data-type='method'><a href="PlayerModel.html#isMaxHp">isMaxHp</a></li><li data-type='method'><a href="PlayerModel.html#isMin">isMin</a></li><li data-type='method'><a href="PlayerModel.html#isMinCard">isMinCard</a></li><li data-type='method'><a href="PlayerModel.html#isMinEquip">isMinEquip</a></li><li data-type='method'><a href="PlayerModel.html#isMinHandcard">isMinHandcard</a></li><li data-type='method'><a href="PlayerModel.html#isMinHp">isMinHp</a></li><li data-type='method'><a href="PlayerModel.html#isOffline">isOffline</a></li><li data-type='method'><a href="PlayerModel.html#isOnline">isOnline</a></li><li data-type='method'><a href="PlayerModel.html#isOnline2">isOnline2</a></li><li data-type='method'><a href="PlayerModel.html#isOut">isOut</a></li><li data-type='method'><a href="PlayerModel.html#isTurnedOver">isTurnedOver</a></li><li data-type='method'><a href="PlayerModel.html#isUnderControl">isUnderControl</a></li><li data-type='method'><a href="PlayerModel.html#isUnseen">isUnseen</a></li><li data-type='method'><a href="PlayerModel.html#judge">judge</a></li><li data-type='method'><a href="PlayerModel.html#link">link</a></li><li data-type='method'><a href="PlayerModel.html#logSkill">logSkill</a></li><li data-type='method'><a href="PlayerModel.html#loseToSpecial">loseToSpecial</a></li><li data-type='method'><a href="PlayerModel.html#mark">mark</a></li><li data-type='method'><a href="PlayerModel.html#needsToDiscard">needsToDiscard</a></li><li data-type='method'><a href="PlayerModel.html#popup">popup</a></li><li data-type='method'><a href="PlayerModel.html#queue">queue</a></li><li data-type='method'><a href="PlayerModel.html#reinit">reinit</a></li><li data-type='method'><a href="PlayerModel.html#removeAdditionalSkill">removeAdditionalSkill</a></li><li data-type='method'><a href="PlayerModel.html#removeEquipTrigger">removeEquipTrigger</a></li><li data-type='method'><a href="PlayerModel.html#removeGaintag">removeGaintag</a></li><li data-type='method'><a href="PlayerModel.html#removeMark">removeMark</a></li><li data-type='method'><a href="PlayerModel.html#removeSkill">removeSkill</a></li><li data-type='method'><a href="PlayerModel.html#removeSkillBlocker">removeSkillBlocker</a></li><li data-type='method'><a href="PlayerModel.html#removeSkillTrigger">removeSkillTrigger</a></li><li data-type='method'><a href="PlayerModel.html#removeSubPlayer">removeSubPlayer</a></li><li data-type='method'><a href="PlayerModel.html#restoreSkill">restoreSkill</a></li><li data-type='method'><a href="PlayerModel.html#say">say</a></li><li data-type='method'><a href="PlayerModel.html#send">send</a></li><li data-type='method'><a href="PlayerModel.html#setAvatar">setAvatar</a></li><li data-type='method'><a href="PlayerModel.html#setAvatarQueue">setAvatarQueue</a></li><li data-type='method'><a href="PlayerModel.html#setIdentity">setIdentity</a></li><li data-type='method'><a href="PlayerModel.html#setNickname">setNickname</a></li><li data-type='method'><a href="PlayerModel.html#showCharacter">showCharacter</a></li><li data-type='method'><a href="PlayerModel.html#showGiveup">showGiveup</a></li><li data-type='method'><a href="PlayerModel.html#smoothAvatar">smoothAvatar</a></li><li data-type='method'><a href="PlayerModel.html#syncStorage">syncStorage</a></li><li data-type='method'><a href="PlayerModel.html#throwEmotion">throwEmotion</a></li><li data-type='method'><a href="PlayerModel.html#toggleSubPlayer">toggleSubPlayer</a></li><li data-type='method'><a href="PlayerModel.html#tryCardAnimate">tryCardAnimate</a></li><li data-type='method'><a href="PlayerModel.html#trySkillAnimate">trySkillAnimate</a></li><li data-type='method'><a href="PlayerModel.html#turnOver">turnOver</a></li><li data-type='method'><a href="PlayerModel.html#uninit">uninit</a></li><li data-type='method'><a href="PlayerModel.html#uninitOL">uninitOL</a></li><li data-type='method'><a href="PlayerModel.html#unMad">unMad</a></li><li data-type='method'><a href="PlayerModel.html#unmark">unmark</a></li><li data-type='method'><a href="PlayerModel.html#update">update</a></li><li data-type='method'><a href="PlayerModel.html#updateMark">updateMark</a></li><li data-type='method'><a href="PlayerModel.html#updateMarks">updateMarks</a></li><li data-type='method'><a href="PlayerModel.html#useResult">useResult</a></li></ul></li><li class="accordion collapsed child" id=9054088><div class="accordion-heading child"><a href="Subject.html">Subject</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="Subject.html#set">set</a></li></ul></li></ul> </div><div class="accordion collapsed" id="9539865" > <h3 class="accordion-heading">Modules<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="module-core.html">core</a></li><li class="accordion collapsed child" id=7027><div class="accordion-heading child"><a href="module-moduleManager.html">moduleManager</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-moduleManager.html#define">define</a></li><li data-type='method'><a href="module-moduleManager.html#require">require</a></li><li data-type='method'><a href="module-moduleManager.html#~checkModule">checkModule</a></li><li data-type='method'><a href="module-moduleManager.html#~createScript">createScript</a></li><li data-type='method'><a href="module-moduleManager.html#~getModule">getModule</a></li><li data-type='method'><a href="module-moduleManager.html#~immediateInvoke">immediateInvoke</a></li><li data-type='method'><a href="module-moduleManager.html#~invokeOnReady">invokeOnReady</a></li><li data-type='method'><a href="module-moduleManager.html#~setModule">setModule</a></li><li data-type='method'><a href="module-moduleManager.html#~toUrl">toUrl</a></li></ul></li></ul> </div><div class="accordion collapsed" id="6180774" > <h3 class="accordion-heading">Events<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#event:KeyboardEvent">KeyboardEvent</a></li><li class="accordion-list" id=""><a href="global.html#event:MouseEvent">MouseEvent</a></li><li class="accordion-list" id=""><a href="global.html#event:TouchEvent">TouchEvent</a></li></ul> </div><div class="accordion collapsed" id="9189885" > <h3 class="accordion-heading">Namespaces<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="-_status.html">_status</a></li><li class="accordion-list" id=""><a href="ai.html">ai</a></li><li class="accordion-list" id=""><a href="configMenu.html">configMenu</a></li><li class="accordion-list" id=""><a href="content.html">content</a></li><li class="accordion-list" id=""><a href="element.html">element</a></li><li class="accordion collapsed child" id=6225998><div class="accordion-heading child"><a href="game.html">game</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="game.html#.addCard">addCard</a></li><li data-type='method'><a href="game.html#.addCardPack">addCardPack</a></li><li data-type='method'><a href="game.html#.addCharacter">addCharacter</a></li><li data-type='method'><a href="game.html#.addCharacterPack">addCharacterPack</a></li><li data-type='method'><a href="game.html#.addGlobalSkill">addGlobalSkill</a></li><li data-type='method'><a href="game.html#.addMode">addMode</a></li><li data-type='method'><a href="game.html#.addSkill">addSkill</a></li><li data-type='method'><a href="game.html#.check">check</a></li><li data-type='method'><a href="game.html#.clearModeConfig">clearModeConfig</a></li><li data-type='method'><a href="game.html#.countGroup">countGroup</a></li><li data-type='method'><a href="game.html#.countPlayer">countPlayer</a></li><li data-type='method'><a href="game.html#.countPlayer2">countPlayer2</a></li><li data-type='method'><a href="game.html#.createEvent">createEvent</a></li><li data-type='method'><a href="game.html#.createTrigger">createTrigger</a></li><li data-type='method'><a href="game.html#.deleteDB">deleteDB</a></li><li data-type='method'><a href="game.html#.expandSkills">expandSkills</a></li><li data-type='method'><a href="game.html#.filterSkills">filterSkills</a></li><li data-type='method'><a href="game.html#.finishCards">finishCards</a></li><li data-type='method'><a href="game.html#.finishSkill">finishSkill</a></li><li data-type='method'><a href="game.html#.getDB">getDB</a></li><li data-type='method'><a href="game.html#.getExtensionConfig">getExtensionConfig</a></li><li data-type='method'><a href="game.html#.hasPlayer">hasPlayer</a></li><li data-type='method'><a href="game.html#.hasPlayer2">hasPlayer2</a></li><li data-type='method'><a href="game.html#.import">import</a></li><li data-type='method'><a href="game.html#.loop">loop</a></li><li data-type='method'><a href="game.html#.putDB">putDB</a></li><li data-type='method'><a href="game.html#.saveConfig">saveConfig</a></li><li data-type='method'><a href="game.html#.saveConfigValue">saveConfigValue</a></li><li data-type='method'><a href="game.html#.saveExtensionConfig">saveExtensionConfig</a></li><li data-type='method'><a href="game.html#.showPlayerCard">showPlayerCard</a></li></ul></li><li class="accordion-list" id=""><a href="GameCores.html">GameCores</a></li><li class="accordion-list" id=""><a href="GameCores.Bases.html">Bases</a></li><li class="accordion-list" id=""><a href="GameCores.Bases.Event.html">Event</a></li><li class="accordion-list" id=""><a href="GameCores.GameObjects.html">GameObjects</a></li><li class="accordion-list" id=""><a href="GameCores.GameObjects.Card.html">Card</a></li><li class="accordion-list" id=""><a href="GameCores.GameObjects.Player.html">Player</a></li><li class="accordion collapsed child" id=1830048><div class="accordion-heading child"><a href="get.html">get</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="get.html#.attitude">attitude</a></li><li data-type='method'><a href="get.html#.attitude2">attitude2</a></li><li data-type='method'><a href="get.html#.autoViewAs">autoViewAs</a></li><li data-type='method'><a href="get.html#.bottomCards">bottomCards</a></li><li data-type='method'><a href="get.html#.buttonValue">buttonValue</a></li><li data-type='method'><a href="get.html#.card">card</a></li><li data-type='method'><a href="get.html#.cardOffset">cardOffset</a></li><li data-type='method'><a href="get.html#.cards">cards</a></li><li data-type='method'><a href="get.html#.colorspan">colorspan</a></li><li data-type='method'><a href="get.html#.condition">condition</a></li><li data-type='method'><a href="get.html#.connectNickname">connectNickname</a></li><li data-type='method'><a href="get.html#.copy">copy</a></li><li data-type='method'><a href="get.html#.damageEffect">damageEffect</a></li><li data-type='method'><a href="get.html#.distance">distance</a></li><li data-type='method'><a href="get.html#.disvalue">disvalue</a></li><li data-type='method'><a href="get.html#.disvalue2">disvalue2</a></li><li data-type='method'><a href="get.html#.effect">effect</a></li><li data-type='method'><a href="get.html#.effect_use">effect_use</a></li><li data-type='method'><a href="get.html#.equipResult">equipResult</a></li><li data-type='method'><a href="get.html#.equipValue">equipValue</a></li><li data-type='method'><a href="get.html#.equipValueNumber">equipValueNumber</a></li><li data-type='method'><a href="get.html#.gainableCharacters">gainableCharacters</a></li><li data-type='method'><a href="get.html#.gainableSkills">gainableSkills</a></li><li data-type='method'><a href="get.html#.gainableSkillsName">gainableSkillsName</a></li><li data-type='method'><a href="get.html#.id">id</a></li><li data-type='method'><a href="get.html#.info">info</a></li><li data-type='method'><a href="get.html#.info">info</a></li><li data-type='method'><a href="get.html#.info2">info</a></li><li data-type='method'><a href="get.html#.info2">info</a></li><li data-type='method'><a href="get.html#.infoHp">infoHp</a></li><li data-type='method'><a href="get.html#.infoMaxHp">infoMaxHp</a></li><li data-type='method'><a href="get.html#.isLuckyStar">isLuckyStar</a></li><li data-type='method'><a href="get.html#.itemtype">itemtype</a></li><li data-type='method'><a href="get.html#.judge">judge</a></li><li data-type='method'><a href="get.html#.mode">mode</a></li><li data-type='method'><a href="get.html#.name">name</a></li><li data-type='method'><a href="get.html#.name">name</a></li><li data-type='method'><a href="get.html#.name2">name</a></li><li data-type='method'><a href="get.html#.name2">name</a></li><li data-type='method'><a href="get.html#.nature">nature</a></li><li data-type='method'><a href="get.html#.nodeintro">nodeintro</a></li><li data-type='method'><a href="get.html#.nodeintro">nodeintro</a></li><li data-type='method'><a href="get.html#.objtype">objtype</a></li><li data-type='method'><a href="get.html#.order">order</a></li><li data-type='method'><a href="get.html#.player">player</a></li><li data-type='method'><a href="get.html#.players">players</a></li><li data-type='method'><a href="get.html#.position">position</a></li><li data-type='method'><a href="get.html#.recoverEffect">recoverEffect</a></li><li data-type='method'><a href="get.html#.select">select</a></li><li data-type='method'><a href="get.html#.sgn">sgn</a></li><li data-type='method'><a href="get.html#.sgnAttitude">sgnAttitude</a></li><li data-type='method'><a href="get.html#.skillthreaten">skillthreaten</a></li><li data-type='method'><a href="get.html#.threaten">threaten</a></li><li data-type='method'><a href="get.html#.unuseful">unuseful</a></li><li data-type='method'><a href="get.html#.unuseful2">unuseful2</a></li><li data-type='method'><a href="get.html#.unuseful3">unuseful3</a></li><li data-type='method'><a href="get.html#.useful">useful</a></li><li data-type='method'><a href="get.html#.utc">utc</a></li><li data-type='method'><a href="get.html#.value">value</a></li><li data-type='method'><a href="get.html#.value">value</a></li><li data-type='method'><a href="get.html#.value2">value</a></li><li data-type='method'><a href="get.html#.value2">value</a></li><li data-type='method'><a href="get.html#.verticalStr">verticalStr</a></li></ul></li><li class="accordion collapsed child" id=366762><div class="accordion-heading child"><a href="get.is.html">is</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="get.is.html#.blocked">blocked</a></li><li data-type='method'><a href="get.is.html#.double">double</a></li><li data-type='method'><a href="get.is.html#.locked">locked</a></li><li data-type='method'><a href="get.is.html#.yingbian">yingbian</a></li></ul></li><li class="accordion collapsed child" id=2788123><div class="accordion-heading child"><a href="lib.html">lib</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="lib.html#.getUTC">getUTC</a></li><li data-type='method'><a href="lib.html#.listenEnd">listenEnd</a></li><li data-type='method'><a href="lib.html#.run">run</a></li><li data-type='method'><a href="lib.html#.saveVideo">saveVideo</a></li><li data-type='method'><a href="lib.html#.setHover">setHover</a></li><li data-type='method'><a href="lib.html#.setLongPress">setLongPress</a></li><li data-type='method'><a href="lib.html#.setMousewheel">setMousewheel</a></li><li data-type='method'><a href="lib.html#.setScroll">setScroll</a></li><li data-type='method'><a href="lib.html#.updateCanvas">updateCanvas</a></li></ul></li><li class="accordion collapsed child" id=8788021><div class="accordion-heading child"><a href="lib.filter.html">filter</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="lib.filter.html#.cardSavable">cardSavable</a></li><li data-type='method'><a href="lib.filter.html#.filterTrigger">filterTrigger</a></li></ul></li><li class="accordion collapsed child" id=7308510><div class="accordion-heading child"><a href="lib.init.html">init</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="lib.init.html#.background">background</a></li><li data-type='method'><a href="lib.init.html#.css">css</a></li><li data-type='method'><a href="lib.init.html#.css">css</a></li><li data-type='method'><a href="lib.init.html#.css2">css</a></li><li data-type='method'><a href="lib.init.html#.css2">css</a></li><li data-type='method'><a href="lib.init.html#.cssstyles">cssstyles</a></li><li data-type='method'><a href="lib.init.html#.decode">decode</a></li><li data-type='method'><a href="lib.init.html#.encode">encode</a></li><li data-type='method'><a href="lib.init.html#.eval">eval</a></li><li data-type='method'><a href="lib.init.html#.init">init</a></li><li data-type='method'><a href="lib.init.html#.js">js</a></li><li data-type='method'><a href="lib.init.html#.js">js</a></li><li data-type='method'><a href="lib.init.html#.js2">js</a></li><li data-type='method'><a href="lib.init.html#.js2">js</a></li><li data-type='method'><a href="lib.init.html#.js3">js</a></li><li data-type='method'><a href="lib.init.html#.js3">js</a></li><li data-type='method'><a href="lib.init.html#.json">json</a></li><li data-type='method'><a href="lib.init.html#.layout">layout</a></li><li data-type='method'><a href="lib.init.html#.onfree">onfree</a></li><li data-type='method'><a href="lib.init.html#.onload">onload</a></li><li data-type='method'><a href="lib.init.html#.reset">reset</a></li><li data-type='method'><a href="lib.init.html#.sheet">sheet</a></li><li data-type='method'><a href="lib.init.html#.stringify">stringify</a></li><li data-type='method'><a href="lib.init.html#.stringifySkill">stringifySkill</a></li></ul></li><li class="accordion-list" id=""><a href="lib.skill.html">skill</a></li><li class="accordion-list" id=""><a href="module-core._status.html">_status</a></li><li class="accordion-list" id=""><a href="module-core.ai.html">ai</a></li><li class="accordion collapsed child" id=4606040><div class="accordion-heading child"><a href="module-core.game.html">game</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.game.html#.addCard">addCard</a></li><li data-type='method'><a href="module-core.game.html#.addCardPack">addCardPack</a></li><li data-type='method'><a href="module-core.game.html#.addCharacter">addCharacter</a></li><li data-type='method'><a href="module-core.game.html#.addCharacterPack">addCharacterPack</a></li><li data-type='method'><a href="module-core.game.html#.addGlobalSkill">addGlobalSkill</a></li><li data-type='method'><a href="module-core.game.html#.addMode">addMode</a></li><li data-type='method'><a href="module-core.game.html#.addSkill">addSkill</a></li><li data-type='method'><a href="module-core.game.html#.check">check</a></li><li data-type='method'><a href="module-core.game.html#.clearModeConfig">clearModeConfig</a></li><li data-type='method'><a href="module-core.game.html#.countGroup">countGroup</a></li><li data-type='method'><a href="module-core.game.html#.countPlayer">countPlayer</a></li><li data-type='method'><a href="module-core.game.html#.countPlayer2">countPlayer2</a></li><li data-type='method'><a href="module-core.game.html#.createEvent">createEvent</a></li><li data-type='method'><a href="module-core.game.html#.createTrigger">createTrigger</a></li><li data-type='method'><a href="module-core.game.html#.deleteDB">deleteDB</a></li><li data-type='method'><a href="module-core.game.html#.expandSkills">expandSkills</a></li><li data-type='method'><a href="module-core.game.html#.filterSkills">filterSkills</a></li><li data-type='method'><a href="module-core.game.html#.finishCards">finishCards</a></li><li data-type='method'><a href="module-core.game.html#.finishSkill">finishSkill</a></li><li data-type='method'><a href="module-core.game.html#.getDB">getDB</a></li><li data-type='method'><a href="module-core.game.html#.getExtensionConfig">getExtensionConfig</a></li><li data-type='method'><a href="module-core.game.html#.hasPlayer">hasPlayer</a></li><li data-type='method'><a href="module-core.game.html#.hasPlayer2">hasPlayer2</a></li><li data-type='method'><a href="module-core.game.html#.import">import</a></li><li data-type='method'><a href="module-core.game.html#.loop">loop</a></li><li data-type='method'><a href="module-core.game.html#.putDB">putDB</a></li><li data-type='method'><a href="module-core.game.html#.saveConfig">saveConfig</a></li><li data-type='method'><a href="module-core.game.html#.saveConfigValue">saveConfigValue</a></li><li data-type='method'><a href="module-core.game.html#.saveExtensionConfig">saveExtensionConfig</a></li><li data-type='method'><a href="module-core.game.html#.showPlayerCard">showPlayerCard</a></li></ul></li><li class="accordion collapsed child" id=2854183><div class="accordion-heading child"><a href="module-core.get.html">get</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.get.html#.attitude">attitude</a></li><li data-type='method'><a href="module-core.get.html#.attitude2">attitude2</a></li><li data-type='method'><a href="module-core.get.html#.autoViewAs">autoViewAs</a></li><li data-type='method'><a href="module-core.get.html#.bottomCards">bottomCards</a></li><li data-type='method'><a href="module-core.get.html#.buttonValue">buttonValue</a></li><li data-type='method'><a href="module-core.get.html#.card">card</a></li><li data-type='method'><a href="module-core.get.html#.cardOffset">cardOffset</a></li><li data-type='method'><a href="module-core.get.html#.cards">cards</a></li><li data-type='method'><a href="module-core.get.html#.colorspan">colorspan</a></li><li data-type='method'><a href="module-core.get.html#.condition">condition</a></li><li data-type='method'><a href="module-core.get.html#.connectNickname">connectNickname</a></li><li data-type='method'><a href="module-core.get.html#.copy">copy</a></li><li data-type='method'><a href="module-core.get.html#.damageEffect">damageEffect</a></li><li data-type='method'><a href="module-core.get.html#.distance">distance</a></li><li data-type='method'><a href="module-core.get.html#.disvalue">disvalue</a></li><li data-type='method'><a href="module-core.get.html#.disvalue2">disvalue2</a></li><li data-type='method'><a href="module-core.get.html#.effect">effect</a></li><li data-type='method'><a href="module-core.get.html#.effect_use">effect_use</a></li><li data-type='method'><a href="module-core.get.html#.equipResult">equipResult</a></li><li data-type='method'><a href="module-core.get.html#.equipValue">equipValue</a></li><li data-type='method'><a href="module-core.get.html#.equipValueNumber">equipValueNumber</a></li><li data-type='method'><a href="module-core.get.html#.gainableCharacters">gainableCharacters</a></li><li data-type='method'><a href="module-core.get.html#.gainableSkills">gainableSkills</a></li><li data-type='method'><a href="module-core.get.html#.gainableSkillsName">gainableSkillsName</a></li><li data-type='method'><a href="module-core.get.html#.id">id</a></li><li data-type='method'><a href="module-core.get.html#.infoHp">infoHp</a></li><li data-type='method'><a href="module-core.get.html#.infoMaxHp">infoMaxHp</a></li><li data-type='method'><a href="module-core.get.html#.isLuckyStar">isLuckyStar</a></li><li data-type='method'><a href="module-core.get.html#.itemtype">itemtype</a></li><li data-type='method'><a href="module-core.get.html#.judge">judge</a></li><li data-type='method'><a href="module-core.get.html#.mode">mode</a></li><li data-type='method'><a href="module-core.get.html#.nature">nature</a></li><li data-type='method'><a href="module-core.get.html#.objtype">objtype</a></li><li data-type='method'><a href="module-core.get.html#.order">order</a></li><li data-type='method'><a href="module-core.get.html#.player">player</a></li><li data-type='method'><a href="module-core.get.html#.players">players</a></li><li data-type='method'><a href="module-core.get.html#.position">position</a></li><li data-type='method'><a href="module-core.get.html#.recoverEffect">recoverEffect</a></li><li data-type='method'><a href="module-core.get.html#.select">select</a></li><li data-type='method'><a href="module-core.get.html#.sgn">sgn</a></li><li data-type='method'><a href="module-core.get.html#.sgnAttitude">sgnAttitude</a></li><li data-type='method'><a href="module-core.get.html#.skillthreaten">skillthreaten</a></li><li data-type='method'><a href="module-core.get.html#.threaten">threaten</a></li><li data-type='method'><a href="module-core.get.html#.unuseful">unuseful</a></li><li data-type='method'><a href="module-core.get.html#.unuseful2">unuseful2</a></li><li data-type='method'><a href="module-core.get.html#.unuseful3">unuseful3</a></li><li data-type='method'><a href="module-core.get.html#.useful">useful</a></li><li data-type='method'><a href="module-core.get.html#.utc">utc</a></li><li data-type='method'><a href="module-core.get.html#.verticalStr">verticalStr</a></li></ul></li><li class="accordion collapsed child" id=5228074><div class="accordion-heading child"><a href="module-core.get.is.html">is</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.get.is.html#.blocked">blocked</a></li><li data-type='method'><a href="module-core.get.is.html#.double">double</a></li><li data-type='method'><a href="module-core.get.is.html#.locked">locked</a></li><li data-type='method'><a href="module-core.get.is.html#.yingbian">yingbian</a></li></ul></li><li class="accordion collapsed child" id=2770102><div class="accordion-heading child"><a href="module-core.lib.html">lib</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.lib.html#.getUTC">getUTC</a></li><li data-type='method'><a href="module-core.lib.html#.listenEnd">listenEnd</a></li><li data-type='method'><a href="module-core.lib.html#.run">run</a></li><li data-type='method'><a href="module-core.lib.html#.saveVideo">saveVideo</a></li><li data-type='method'><a href="module-core.lib.html#.setHover">setHover</a></li><li data-type='method'><a href="module-core.lib.html#.setLongPress">setLongPress</a></li><li data-type='method'><a href="module-core.lib.html#.setMousewheel">setMousewheel</a></li><li data-type='method'><a href="module-core.lib.html#.setScroll">setScroll</a></li><li data-type='method'><a href="module-core.lib.html#.updateCanvas">updateCanvas</a></li></ul></li><li class="accordion collapsed child" id=9230454><div class="accordion-heading child"><a href="module-core.lib.filter.html">filter</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.lib.filter.html#.cardSavable">cardSavable</a></li><li data-type='method'><a href="module-core.lib.filter.html#.filterTrigger">filterTrigger</a></li></ul></li><li class="accordion collapsed child" id=9115526><div class="accordion-heading child"><a href="module-core.lib.init.html">init</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.lib.init.html#.background">background</a></li><li data-type='method'><a href="module-core.lib.init.html#.cssstyles">cssstyles</a></li><li data-type='method'><a href="module-core.lib.init.html#.decode">decode</a></li><li data-type='method'><a href="module-core.lib.init.html#.encode">encode</a></li><li data-type='method'><a href="module-core.lib.init.html#.eval">eval</a></li><li data-type='method'><a href="module-core.lib.init.html#.init">init</a></li><li data-type='method'><a href="module-core.lib.init.html#.json">json</a></li><li data-type='method'><a href="module-core.lib.init.html#.layout">layout</a></li><li data-type='method'><a href="module-core.lib.init.html#.onfree">onfree</a></li><li data-type='method'><a href="module-core.lib.init.html#.onload">onload</a></li><li data-type='method'><a href="module-core.lib.init.html#.reset">reset</a></li><li data-type='method'><a href="module-core.lib.init.html#.sheet">sheet</a></li><li data-type='method'><a href="module-core.lib.init.html#.stringify">stringify</a></li><li data-type='method'><a href="module-core.lib.init.html#.stringifySkill">stringifySkill</a></li></ul></li><li class="accordion-list" id=""><a href="module-core.lib.skill.html">skill</a></li><li class="accordion collapsed child" id=9167612><div class="accordion-heading child"><a href="module-core.ui.html">ui</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.ui.html#.clear">clear</a></li><li data-type='method'><a href="module-core.ui.html#.refresh">refresh</a></li><li data-type='method'><a href="module-core.ui.html#.update">update</a></li><li data-type='method'><a href="module-core.ui.html#.updated">updated</a></li><li data-type='method'><a href="module-core.ui.html#.updateh">updateh</a></li><li data-type='method'><a href="module-core.ui.html#.updatej">updatej</a></li><li data-type='method'><a href="module-core.ui.html#.updatejm">updatejm</a></li><li data-type='method'><a href="module-core.ui.html#.updatem">updatem</a></li><li data-type='method'><a href="module-core.ui.html#.updatez">updatez</a></li></ul></li><li class="accordion collapsed child" id=9148565><div class="accordion-heading child"><a href="module-core.ui.click.html">click</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.ui.click.html#.auto">auto</a></li><li data-type='method'><a href="module-core.ui.click.html#.cancel">cancel</a></li><li data-type='method'><a href="module-core.ui.click.html#.intro">intro</a></li><li data-type='method'><a href="module-core.ui.click.html#.ok">ok</a></li><li data-type='method'><a href="module-core.ui.click.html#.wuxie">wuxie</a></li></ul></li><li class="accordion collapsed child" id=3621286><div class="accordion-heading child"><a href="module-core.ui.create.html">create</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.ui.create.html#.button">button</a></li><li data-type='method'><a href="module-core.ui.create.html#.buttons">buttons</a></li><li data-type='method'><a href="module-core.ui.create.html#.card">card</a></li><li data-type='method'><a href="module-core.ui.create.html#.cardDialog">cardDialog</a></li><li data-type='method'><a href="module-core.ui.create.html#.characterDialog">characterDialog</a></li><li data-type='method'><a href="module-core.ui.create.html#.control">control</a></li><li data-type='method'><a href="module-core.ui.create.html#.div">div</a></li><li data-type='method'><a href="module-core.ui.create.html#.menu">menu</a></li><li data-type='method'><a href="module-core.ui.create.html#.player">player</a></li></ul></li><li class="accordion collapsed child" id=6067594><div class="accordion-heading child"><a href="sort.html">sort</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="sort.html#.card">card</a></li><li data-type='method'><a href="sort.html#.card">card</a></li><li data-type='method'><a href="sort.html#.character">character</a></li><li data-type='method'><a href="sort.html#.character">character</a></li><li data-type='method'><a href="sort.html#.seat">seat</a></li><li data-type='method'><a href="sort.html#.seat">seat</a></li></ul></li><li class="accordion collapsed child" id=7772338><div class="accordion-heading child"><a href="ui.html">ui</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="ui.html#.clear">clear</a></li><li data-type='method'><a href="ui.html#.refresh">refresh</a></li><li data-type='method'><a href="ui.html#.update">update</a></li><li data-type='method'><a href="ui.html#.updated">updated</a></li><li data-type='method'><a href="ui.html#.updateh">updateh</a></li><li data-type='method'><a href="ui.html#.updatej">updatej</a></li><li data-type='method'><a href="ui.html#.updatejm">updatejm</a></li><li data-type='method'><a href="ui.html#.updatem">updatem</a></li><li data-type='method'><a href="ui.html#.updatez">updatez</a></li></ul></li><li class="accordion collapsed child" id=6606712><div class="accordion-heading child"><a href="ui.click.html">click</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="ui.click.html#.auto">auto</a></li><li data-type='method'><a href="ui.click.html#.cancel">cancel</a></li><li data-type='method'><a href="ui.click.html#.intro">intro</a></li><li data-type='method'><a href="ui.click.html#.ok">ok</a></li><li data-type='method'><a href="ui.click.html#.wuxie">wuxie</a></li></ul></li><li class="accordion collapsed child" id=613325><div class="accordion-heading child"><a href="ui.create.html">create</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="ui.create.html#.button">button</a></li><li data-type='method'><a href="ui.create.html#.buttons">buttons</a></li><li data-type='method'><a href="ui.create.html#.card">card</a></li><li data-type='method'><a href="ui.create.html#.cardDialog">cardDialog</a></li><li data-type='method'><a href="ui.create.html#.characterDialog">characterDialog</a></li><li data-type='method'><a href="ui.create.html#.control">control</a></li><li data-type='method'><a href="ui.create.html#.div">div</a></li><li data-type='method'><a href="ui.create.html#.menu">menu</a></li><li data-type='method'><a href="ui.create.html#.player">player</a></li></ul></li></ul> </div><div class="accordion collapsed" id="6487694" > <h3 class="accordion-heading">Mixins<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion collapsed child" id=5084263><div class="accordion-heading child"><a href="lib.element.card.html">card</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="lib.element.card.html#.addGaintag">addGaintag</a></li><li data-type='method'><a href="lib.element.card.html#.hasGaintag">hasGaintag</a></li><li data-type='method'><a href="lib.element.card.html#.hasPosition">hasPosition</a></li><li data-type='method'><a href="lib.element.card.html#.init">init</a></li><li data-type='method'><a href="lib.element.card.html#.isInPile">isInPile</a></li><li data-type='method'><a href="lib.element.card.html#.removeGaintag">removeGaintag</a></li><li data-type='method'><a href="lib.element.card.html#.updateTransform">updateTransform</a></li></ul></li><li class="accordion collapsed child" id=8001638><div class="accordion-heading child"><a href="lib.element.event.html">event</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="lib.element.event.html#.backup">backup</a></li><li data-type='method'><a href="lib.element.event.html#.cancel">cancel</a></li><li data-type='method'><a href="lib.element.event.html#.finish">finish</a></li><li data-type='method'><a href="lib.element.event.html#.getParent">getParent</a></li><li data-type='method'><a href="lib.element.event.html#.getRand">getRand</a></li><li data-type='method'><a href="lib.element.event.html#.getTrigger">getTrigger</a></li><li data-type='method'><a href="lib.element.event.html#.goto">goto</a></li><li data-type='method'><a href="lib.element.event.html#.insert">insert</a></li><li data-type='method'><a href="lib.element.event.html#.insertAfter">insertAfter</a></li><li data-type='method'><a href="lib.element.event.html#.redo">redo</a></li><li data-type='method'><a href="lib.element.event.html#.resume">resume</a></li><li data-type='method'><a href="lib.element.event.html#.set">set</a></li><li data-type='method'><a href="lib.element.event.html#.set">set</a></li><li data-type='method'><a href="lib.element.event.html#.set2">set</a></li><li data-type='method'><a href="lib.element.event.html#.set2">set</a></li><li data-type='method'><a href="lib.element.event.html#.setContent">setContent</a></li><li data-type='method'><a href="lib.element.event.html#.trigger">trigger</a></li><li data-type='method'><a href="lib.element.event.html#.untrigger">untrigger</a></li></ul></li><li class="accordion collapsed child" id=3426115><div class="accordion-heading child"><a href="lib.element.player.html">player</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="lib.element.player.html#.$damagepop">$damagepop</a></li><li data-type='method'><a href="lib.element.player.html#.$showCharacter">$showCharacter</a></li><li data-type='method'><a href="lib.element.player.html#.$skill">$skill</a></li><li data-type='method'><a href="lib.element.player.html#.$throwEmotion">$throwEmotion</a></li><li data-type='method'><a href="lib.element.player.html#.addAdditionalSkill">addAdditionalSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addEquipTrigger">addEquipTrigger</a></li><li data-type='method'><a href="lib.element.player.html#.addGaintag">addGaintag</a></li><li data-type='method'><a href="lib.element.player.html#.addMark">addMark</a></li><li data-type='method'><a href="lib.element.player.html#.addSkill">addSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addSkill">addSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addSkill">addSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addSkill2">addSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addSkill2">addSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addSkill2">addSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addSkillBlocker">addSkillBlocker</a></li><li data-type='method'><a href="lib.element.player.html#.addSkillLog">addSkillLog</a></li><li data-type='method'><a href="lib.element.player.html#.addSkillTrigger">addSkillTrigger</a></li><li data-type='method'><a href="lib.element.player.html#.addSubPlayer">addSubPlayer</a></li><li data-type='method'><a href="lib.element.player.html#.addTempSkill">addTempSkill</a></li><li data-type='method'><a href="lib.element.player.html#.addToJudge">addToJudge</a></li><li data-type='method'><a href="lib.element.player.html#.applySkills">applySkills</a></li><li data-type='method'><a href="lib.element.player.html#.attitudeTo">attitudeTo</a></li><li data-type='method'><a href="lib.element.player.html#.awakenSkill">awakenSkill</a></li><li data-type='method'><a href="lib.element.player.html#.buffAvatar">buffAvatar</a></li><li data-type='method'><a href="lib.element.player.html#.callSubPlayer">callSubPlayer</a></li><li data-type='method'><a href="lib.element.player.html#.canAddToJudge">canAddToJudge</a></li><li data-type='method'><a href="lib.element.player.html#.canSave">canSave</a></li><li data-type='method'><a href="lib.element.player.html#.canUse">canUse</a></li><li data-type='method'><a href="lib.element.player.html#.changeSeat">changeSeat</a></li><li data-type='method'><a href="lib.element.player.html#.chat">chat</a></li><li data-type='method'><a href="lib.element.player.html#.checkConflict">checkConflict</a></li><li data-type='method'><a href="lib.element.player.html#.checkMarks">checkMarks</a></li><li data-type='method'><a href="lib.element.player.html#.chooseToGuanxing">chooseToGuanxing</a></li><li data-type='method'><a href="lib.element.player.html#.clearSkills">clearSkills</a></li><li data-type='method'><a href="lib.element.player.html#.countMark">countMark</a></li><li data-type='method'><a href="lib.element.player.html#.directgains">directgains</a></li><li data-type='method'><a href="lib.element.player.html#.disableSkill">disableSkill</a></li><li data-type='method'><a href="lib.element.player.html#.emotion">emotion</a></li><li data-type='method'><a href="lib.element.player.html#.enableSkill">enableSkill</a></li><li data-type='method'><a href="lib.element.player.html#.exitSubPlayer">exitSubPlayer</a></li><li data-type='method'><a href="lib.element.player.html#.flashAvatar">flashAvatar</a></li><li data-type='method'><a href="lib.element.player.html#.get">get</a></li><li data-type='method'><a href="lib.element.player.html#.getAllHistory">getAllHistory</a></li><li data-type='method'><a href="lib.element.player.html#.getAttackRange">getAttackRange</a></li><li data-type='method'><a href="lib.element.player.html#.getCards">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards2">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards2">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards2">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards3">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards3">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards3">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards4">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards4">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCards4">getCards</a></li><li data-type='method'><a href="lib.element.player.html#.getCardUsable">getCardUsable</a></li><li data-type='method'><a href="lib.element.player.html#.getDamagedHp">getDamagedHp</a></li><li data-type='method'><a href="lib.element.player.html#.getEnemies">getEnemies</a></li><li data-type='method'><a href="lib.element.player.html#.getEnemies">getEnemies</a></li><li data-type='method'><a href="lib.element.player.html#.getEnemies">getEnemies</a></li><li data-type='method'><a href="lib.element.player.html#.getEquip">getEquip</a></li><li data-type='method'><a href="lib.element.player.html#.getFriends">getFriends</a></li><li data-type='method'><a href="lib.element.player.html#.getFriends">getFriends</a></li><li data-type='method'><a href="lib.element.player.html#.getFriends">getFriends</a></li><li data-type='method'><a href="lib.element.player.html#.getFriends">getFriends</a></li><li data-type='method'><a href="lib.element.player.html#.getFriends">getFriends</a></li><li data-type='method'><a href="lib.element.player.html#.getFriends">getFriends</a></li><li data-type='method'><a href="lib.element.player.html#.getGlobalFrom">getGlobalFrom</a></li><li data-type='method'><a href="lib.element.player.html#.getGlobalTo">getGlobalTo</a></li><li data-type='method'><a href="lib.element.player.html#.getHandcardLimit">getHandcardLimit</a></li><li data-type='method'><a href="lib.element.player.html#.getHistory">getHistory</a></li><li data-type='method'><a href="lib.element.player.html#.getId">getId</a></li><li data-type='method'><a href="lib.element.player.html#.getJudge">getJudge</a></li><li data-type='method'><a href="lib.element.player.html#.getLastHistory">getLastHistory</a></li><li data-type='method'><a href="lib.element.player.html#.getLastStat">getLastStat</a></li><li data-type='method'><a href="lib.element.player.html#.getLastUsed">getLastUsed</a></li><li data-type='method'><a href="lib.element.player.html#.getLeft">getLeft</a></li><li data-type='method'><a href="lib.element.player.html#.getSkills">getSkills</a></li><li data-type='method'><a href="lib.element.player.html#.getStat">getStat</a></li><li data-type='method'><a href="lib.element.player.html#.getState">getState</a></li><li data-type='method'><a href="lib.element.player.html#.getSubPlayers">getSubPlayers</a></li><li data-type='method'><a href="lib.element.player.html#.getTop">getTop</a></li><li data-type='method'><a href="lib.element.player.html#.getUseValue">getUseValue</a></li><li data-type='method'><a href="lib.element.player.html#.goMad">goMad</a></li><li data-type='method'><a href="lib.element.player.html#.hasCardAround">hasCardAround</a></li><li data-type='method'><a href="lib.element.player.html#.hasMark">hasMark</a></li><li data-type='method'><a href="lib.element.player.html#.hasSkill">hasSkill</a></li><li data-type='method'><a href="lib.element.player.html#.hasUseTarget">hasUseTarget</a></li><li data-type='method'><a href="lib.element.player.html#.hasValueTarget">hasValueTarget</a></li><li data-type='method'><a href="lib.element.player.html#.init">init</a></li><li data-type='method'><a href="lib.element.player.html#.initOL">initOL</a></li><li data-type='method'><a href="lib.element.player.html#.initRoom">initRoom</a></li><li data-type='method'><a href="lib.element.player.html#.inRange">inRange</a></li><li data-type='method'><a href="lib.element.player.html#.inRangeOf">inRangeOf</a></li><li data-type='method'><a href="lib.element.player.html#.isAlive">isAlive</a></li><li data-type='method'><a href="lib.element.player.html#.isDamaged">isDamaged</a></li><li data-type='method'><a href="lib.element.player.html#.isDead">isDead</a></li><li data-type='method'><a href="lib.element.player.html#.isDying">isDying</a></li><li data-type='method'><a href="lib.element.player.html#.isEnemiesOf">isEnemiesOf</a></li><li data-type='method'><a href="lib.element.player.html#.isEnemyOf">isEnemyOf</a></li><li data-type='method'><a href="lib.element.player.html#.isFriendOf">isFriendOf</a></li><li data-type='method'><a href="lib.element.player.html#.isFriendsOf">isFriendsOf</a></li><li data-type='method'><a href="lib.element.player.html#.isHealthy">isHealthy</a></li><li data-type='method'><a href="lib.element.player.html#.isIn">isIn</a></li><li data-type='method'><a href="lib.element.player.html#.isLinked">isLinked</a></li><li data-type='method'><a href="lib.element.player.html#.isMad">isMad</a></li><li data-type='method'><a href="lib.element.player.html#.isMaxCard">isMaxCard</a></li><li data-type='method'><a href="lib.element.player.html#.isMaxEquip">isMaxEquip</a></li><li data-type='method'><a href="lib.element.player.html#.isMaxHandcard">isMaxHandcard</a></li><li data-type='method'><a href="lib.element.player.html#.isMaxHp">isMaxHp</a></li><li data-type='method'><a href="lib.element.player.html#.isMin">isMin</a></li><li data-type='method'><a href="lib.element.player.html#.isMinCard">isMinCard</a></li><li data-type='method'><a href="lib.element.player.html#.isMinEquip">isMinEquip</a></li><li data-type='method'><a href="lib.element.player.html#.isMinHandcard">isMinHandcard</a></li><li data-type='method'><a href="lib.element.player.html#.isMinHp">isMinHp</a></li><li data-type='method'><a href="lib.element.player.html#.isOffline">isOffline</a></li><li data-type='method'><a href="lib.element.player.html#.isOnline">isOnline</a></li><li data-type='method'><a href="lib.element.player.html#.isOnline2">isOnline2</a></li><li data-type='method'><a href="lib.element.player.html#.isOut">isOut</a></li><li data-type='method'><a href="lib.element.player.html#.isTurnedOver">isTurnedOver</a></li><li data-type='method'><a href="lib.element.player.html#.isUnderControl">isUnderControl</a></li><li data-type='method'><a href="lib.element.player.html#.isUnseen">isUnseen</a></li><li data-type='method'><a href="lib.element.player.html#.judge">judge</a></li><li data-type='method'><a href="lib.element.player.html#.link">link</a></li><li data-type='method'><a href="lib.element.player.html#.logSkill">logSkill</a></li><li data-type='method'><a href="lib.element.player.html#.loseToSpecial">loseToSpecial</a></li><li data-type='method'><a href="lib.element.player.html#.mark">mark</a></li><li data-type='method'><a href="lib.element.player.html#.needsToDiscard">needsToDiscard</a></li><li data-type='method'><a href="lib.element.player.html#.popup">popup</a></li><li data-type='method'><a href="lib.element.player.html#.queue">queue</a></li><li data-type='method'><a href="lib.element.player.html#.reinit">reinit</a></li><li data-type='method'><a href="lib.element.player.html#.removeAdditionalSkill">removeAdditionalSkill</a></li><li data-type='method'><a href="lib.element.player.html#.removeEquipTrigger">removeEquipTrigger</a></li><li data-type='method'><a href="lib.element.player.html#.removeGaintag">removeGaintag</a></li><li data-type='method'><a href="lib.element.player.html#.removeMark">removeMark</a></li><li data-type='method'><a href="lib.element.player.html#.removeSkill">removeSkill</a></li><li data-type='method'><a href="lib.element.player.html#.removeSkillBlocker">removeSkillBlocker</a></li><li data-type='method'><a href="lib.element.player.html#.removeSkillTrigger">removeSkillTrigger</a></li><li data-type='method'><a href="lib.element.player.html#.removeSubPlayer">removeSubPlayer</a></li><li data-type='method'><a href="lib.element.player.html#.restoreSkill">restoreSkill</a></li><li data-type='method'><a href="lib.element.player.html#.say">say</a></li><li data-type='method'><a href="lib.element.player.html#.send">send</a></li><li data-type='method'><a href="lib.element.player.html#.setAvatar">setAvatar</a></li><li data-type='method'><a href="lib.element.player.html#.setAvatarQueue">setAvatarQueue</a></li><li data-type='method'><a href="lib.element.player.html#.setIdentity">setIdentity</a></li><li data-type='method'><a href="lib.element.player.html#.setNickname">setNickname</a></li><li data-type='method'><a href="lib.element.player.html#.showCharacter">showCharacter</a></li><li data-type='method'><a href="lib.element.player.html#.showGiveup">showGiveup</a></li><li data-type='method'><a href="lib.element.player.html#.smoothAvatar">smoothAvatar</a></li><li data-type='method'><a href="lib.element.player.html#.syncStorage">syncStorage</a></li><li data-type='method'><a href="lib.element.player.html#.throwEmotion">throwEmotion</a></li><li data-type='method'><a href="lib.element.player.html#.toggleSubPlayer">toggleSubPlayer</a></li><li data-type='method'><a href="lib.element.player.html#.tryCardAnimate">tryCardAnimate</a></li><li data-type='method'><a href="lib.element.player.html#.trySkillAnimate">trySkillAnimate</a></li><li data-type='method'><a href="lib.element.player.html#.turnOver">turnOver</a></li><li data-type='method'><a href="lib.element.player.html#.uninit">uninit</a></li><li data-type='method'><a href="lib.element.player.html#.uninitOL">uninitOL</a></li><li data-type='method'><a href="lib.element.player.html#.unMad">unMad</a></li><li data-type='method'><a href="lib.element.player.html#.unmark">unmark</a></li><li data-type='method'><a href="lib.element.player.html#.update">update</a></li><li data-type='method'><a href="lib.element.player.html#.updateMark">updateMark</a></li><li data-type='method'><a href="lib.element.player.html#.updateMarks">updateMarks</a></li><li data-type='method'><a href="lib.element.player.html#.useResult">useResult</a></li></ul></li><li class="accordion collapsed child" id=6434645><div class="accordion-heading child"><a href="module-core.lib.element.card.html">card</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.lib.element.card.html#.addGaintag">addGaintag</a></li><li data-type='method'><a href="module-core.lib.element.card.html#.hasGaintag">hasGaintag</a></li><li data-type='method'><a href="module-core.lib.element.card.html#.hasPosition">hasPosition</a></li><li data-type='method'><a href="module-core.lib.element.card.html#.init">init</a></li><li data-type='method'><a href="module-core.lib.element.card.html#.isInPile">isInPile</a></li><li data-type='method'><a href="module-core.lib.element.card.html#.removeGaintag">removeGaintag</a></li><li data-type='method'><a href="module-core.lib.element.card.html#.updateTransform">updateTransform</a></li></ul></li><li class="accordion collapsed child" id=8478502><div class="accordion-heading child"><a href="module-core.lib.element.event.html">event</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.lib.element.event.html#.backup">backup</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.cancel">cancel</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.finish">finish</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.getParent">getParent</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.getRand">getRand</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.getTrigger">getTrigger</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.goto">goto</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.insert">insert</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.insertAfter">insertAfter</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.redo">redo</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.resume">resume</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.setContent">setContent</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.trigger">trigger</a></li><li data-type='method'><a href="module-core.lib.element.event.html#.untrigger">untrigger</a></li></ul></li><li class="accordion collapsed child" id=1512029><div class="accordion-heading child"><a href="module-core.lib.element.player.html">player</a><svg><use xlink:href="#down-icon"></use></svg></div><ul class='methods accordion-content'><li data-type='method'><a href="module-core.lib.element.player.html#.$damagepop">$damagepop</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.$showCharacter">$showCharacter</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.$skill">$skill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.$throwEmotion">$throwEmotion</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addAdditionalSkill">addAdditionalSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addEquipTrigger">addEquipTrigger</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addGaintag">addGaintag</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addMark">addMark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addSkillBlocker">addSkillBlocker</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addSkillLog">addSkillLog</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addSkillTrigger">addSkillTrigger</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addSubPlayer">addSubPlayer</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addTempSkill">addTempSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.addToJudge">addToJudge</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.applySkills">applySkills</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.attitudeTo">attitudeTo</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.awakenSkill">awakenSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.buffAvatar">buffAvatar</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.callSubPlayer">callSubPlayer</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.canAddToJudge">canAddToJudge</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.canSave">canSave</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.canUse">canUse</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.changeSeat">changeSeat</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.chat">chat</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.checkConflict">checkConflict</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.checkMarks">checkMarks</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.chooseToGuanxing">chooseToGuanxing</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.clearSkills">clearSkills</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.countMark">countMark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.directgains">directgains</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.disableSkill">disableSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.emotion">emotion</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.enableSkill">enableSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.exitSubPlayer">exitSubPlayer</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.flashAvatar">flashAvatar</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.get">get</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getAllHistory">getAllHistory</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getAttackRange">getAttackRange</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getCardUsable">getCardUsable</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getDamagedHp">getDamagedHp</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getEquip">getEquip</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getGlobalFrom">getGlobalFrom</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getGlobalTo">getGlobalTo</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getHandcardLimit">getHandcardLimit</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getHistory">getHistory</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getId">getId</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getJudge">getJudge</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getLastHistory">getLastHistory</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getLastStat">getLastStat</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getLastUsed">getLastUsed</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getLeft">getLeft</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getSkills">getSkills</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getStat">getStat</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getState">getState</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getSubPlayers">getSubPlayers</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getTop">getTop</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.getUseValue">getUseValue</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.goMad">goMad</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.hasCardAround">hasCardAround</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.hasMark">hasMark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.hasSkill">hasSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.hasUseTarget">hasUseTarget</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.hasValueTarget">hasValueTarget</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.init">init</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.initOL">initOL</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.initRoom">initRoom</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.inRange">inRange</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.inRangeOf">inRangeOf</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isAlive">isAlive</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isDamaged">isDamaged</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isDead">isDead</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isDying">isDying</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isEnemiesOf">isEnemiesOf</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isEnemyOf">isEnemyOf</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isFriendOf">isFriendOf</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isFriendsOf">isFriendsOf</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isHealthy">isHealthy</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isIn">isIn</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isLinked">isLinked</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMad">isMad</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMaxCard">isMaxCard</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMaxEquip">isMaxEquip</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMaxHandcard">isMaxHandcard</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMaxHp">isMaxHp</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMin">isMin</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMinCard">isMinCard</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMinEquip">isMinEquip</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMinHandcard">isMinHandcard</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isMinHp">isMinHp</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isOffline">isOffline</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isOnline">isOnline</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isOnline2">isOnline2</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isOut">isOut</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isTurnedOver">isTurnedOver</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isUnderControl">isUnderControl</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.isUnseen">isUnseen</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.judge">judge</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.link">link</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.logSkill">logSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.loseToSpecial">loseToSpecial</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.mark">mark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.needsToDiscard">needsToDiscard</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.popup">popup</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.queue">queue</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.reinit">reinit</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeAdditionalSkill">removeAdditionalSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeEquipTrigger">removeEquipTrigger</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeGaintag">removeGaintag</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeMark">removeMark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeSkill">removeSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeSkillBlocker">removeSkillBlocker</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeSkillTrigger">removeSkillTrigger</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.removeSubPlayer">removeSubPlayer</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.restoreSkill">restoreSkill</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.say">say</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.send">send</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.setAvatar">setAvatar</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.setAvatarQueue">setAvatarQueue</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.setIdentity">setIdentity</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.setNickname">setNickname</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.showCharacter">showCharacter</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.showGiveup">showGiveup</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.smoothAvatar">smoothAvatar</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.syncStorage">syncStorage</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.throwEmotion">throwEmotion</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.toggleSubPlayer">toggleSubPlayer</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.tryCardAnimate">tryCardAnimate</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.trySkillAnimate">trySkillAnimate</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.turnOver">turnOver</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.uninit">uninit</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.uninitOL">uninitOL</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.unMad">unMad</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.unmark">unmark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.update">update</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.updateMark">updateMark</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.updateMarks">updateMarks</a></li><li data-type='method'><a href="module-core.lib.element.player.html#.useResult">useResult</a></li></ul></li></ul> </div><div class="accordion collapsed" id="8711282" > <h3 class="accordion-heading">Global<svg><use xlink:href="#down-icon"></use></svg></h3><ul class="accordion-content"><li class="accordion-list" id=""><a href="global.html#animate">animate</a></li><li class="accordion-list" id=""><a href="global.html#assert">assert</a></li><li class="accordion-list" id=""><a href="global.html#cheat">cheat</a></li><li class="accordion-list" id=""><a href="global.html#css">css</a></li><li class="accordion-list" id=""><a href="global.html#delete">delete</a></li><li class="accordion-list" id=""><a href="global.html#fix">fix</a></li><li class="accordion-list" id=""><a href="global.html#GameConfig">GameConfig</a></li><li class="accordion-list" id=""><a href="global.html#goto">goto</a></li><li class="accordion-list" id=""><a href="global.html#hide">hide</a></li><li class="accordion-list" id=""><a href="global.html#isNonameServer">isNonameServer</a></li><li class="accordion-list" id=""><a href="global.html#listen">listen</a></li><li class="accordion-list" id=""><a href="global.html#listenTransition">listenTransition</a></li><li class="accordion-list" id=""><a href="global.html#localStorage">localStorage</a></li><li class="accordion-list" id=""><a href="global.html#mixin">mixin</a></li><li class="accordion-list" id=""><a href="global.html#nodb">nodb</a></li><li class="accordion-list" id=""><a href="global.html#onerror">onerror</a></li><li class="accordion-list" id=""><a href="global.html#onkeydown">onkeydown</a></li><li class="accordion-list" id=""><a href="global.html#onload">onload</a></li><li class="accordion-list" id=""><a href="global.html#refocus">refocus</a></li><li class="accordion-list" id=""><a href="global.html#setBackground">setBackground</a></li><li class="accordion-list" id=""><a href="global.html#setBackgroundDB">setBackgroundDB</a></li><li class="accordion-list" id=""><a href="global.html#setBackgroundImage">setBackgroundImage</a></li><li class="accordion-list" id=""><a href="global.html#setPosition">setPosition</a></li><li class="accordion-list" id=""><a href="global.html#setPosition2">setPosition</a></li><li class="accordion-list" id=""><a href="global.html#show">show</a></li><li class="accordion-list" id=""><a href="global.html#unfocus">unfocus</a></li></ul> </div></div>
      
        <div class="navbar-resize" id="navbar-resize">
          <div class="resize-dots-container">
            <div class="dots"></div>
            <div class="dots"></div>
            <div class="dots"></div>
          </div> 
        </div>
      

    </nav>
    <div class="navbar-ham" id="navbar-ham">
      <div>
        <div class="first"></div>
        <div class="second"></div>
        <div class="third"></div>
      </div>
    </div>

    <div id="main" class="main-content">
      
      <h1 id='page-title' class="page-title">
        game test.js
      </h1>
      

      



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
/**
 * Build-in Array
 * @name Array
 * @class
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array Array}
 */
/**
 * @name Error
 * @class
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error Error}
 */
/**
 * 
 * @name HTMLDivElement
 * @class
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLDivElement HTMLDivElement}
 */
/**
 * @name HTMLTableElement
 * @class
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLTableElement HTMLTableElement}
 */
/**
 * @name HTMLTableCellElement
 * @class
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLTableCellElement HTMLTableCellElement}
 */
/**
 * @event MouseEvent
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent MouseEvent}
 */
/**
 * @event TouchEvent
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/TouchEvent TouchEvent}
 */
/**
 * @event KeyboardEvent
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent KeyboardEvent}
 */

/** indexedDB`lib.configprefix + name`localStorage
 * ##### 
 * |Key Name|Constant|Nullable|Desciption|
 * |:------:|:------:|:------:|:--------:|
 * |noname_inited|||dir pathPCnodejs`noname_inited`undefined|
 * ||||
 * **constant**: 
 * **Nullable**: 
 * @name localStorage
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage localStorage}
 */

/**
 * 
 * @namespace GameCores
 */
/**
 * 
 * `windows.noname_config`(config.js)`lib.config`
 * |Config Name|Support|Custom Config|Description|
 * |:---------:|:-----:|:-----------:|:---------:|
 * |touchscreen|||true|
 * |totouched|||true|
 * |toscrolled|||MACtrue|
 * |low_performance||||
 * |confirm_exit|||true|
 * |fold_mode|||true|
 * |phonelayout|||true|
 * |show_statusbar_ios|||: 'auto', 'overlay', 'default', 'off'|
 * |mousewheel|||trueMAC|
 * |layout|||{@link GameLayout}|
 * |show_cardpile|||true|
 * **Support**: 
 * **Custom Config**: 
 * @name GameConfig
 * 
 */
/**
 * 
 * |||
 * |:--:|:---:|
 * ||h|
 * ||e|
 * ||j|
 * ||o|
 * ||s|
 * ||c|
 * ||d|
 * Regex: [hejoscd]+
 * @typedef {string} GameCores.CardPosition
 */
/**
 * 
 * @namespace Bases
 * @memberof GameCores
 */
/**
 * 
 * @namespace GameObjects
 * @memberof GameCores
 */
/**
 * switch
 * @callback GameCores.Bases.StateMachine
 * @param {!GameCores.Bases.Event} event 
 * @param {?Object} event.result `event._result``return obj``event.result = obj``this.result = obj`
 * @param {!number} step `event.step`
 * @param {?GameCores.GameObjects.Player} source `event.source`
 * @param {?GameCores.GameObjects.Player} player `event.player`
 * @param {?GameCores.GameObjects.Player} target `event.target`
 * @param {?GameCores.GameObjects.Player[]} targets `event.targets`
 * @param {?GameCores.GameObjects.Card} card `event.card`
 * @param {?GameCores.GameObjects.Card} cards `event.cards`
 * @param {?string} skill ID`event.skill`
 * @param {?boolean} forced true/ai/(undefined)`event.forced`
 * @param {?number} num {@link content.useCard}`event.num`
 * @param {?GameCores.Bases.Event} trigger ()`event.trigger`
 * @param {?Object} result `event._result`
 * @param {!_status} _status 
 * @param {!lib} lib
 * @param {!game} game 
 * @param {!ui} ui
 * @param {!get} get
 * @param {!ai} ai
 * @this GameCores.Bases.Event
 */
(function () {
    /**
     * IIFE
     * @namespace
     * @global
     */
    var _status = /**@lends _status */ {
        paused: false,
        paused2: false,
        paused3: false,
        over: false,
        clicked: false,
        auto: false,
        /**
         * event_status.event
         * @name _status.event
         * @type {!Object}
         */
        event: {
            finished: true,
            /**
             * _status.event.nextstep
             * {@link game.createEvent}
             * @name _status.event_next
             * @type {!Array}
             */
            next: [],
            /**
             * _status.event.after
             * @name _status.event_after
             * @type {!Array}
             */
            after: []
        },
        ai: {},
        lastdragchange: [],
        skillaudio: [],
        dieClose: [],
        dragline: [],
        dying: [],
        globalHistory: [{
            cardMove: [],
            custom: [],
        }],
        cardtag: {
            yingbian_zhuzhan: [],
            yingbian_kongchao: [],
            yingbian_fujia: [],
            yingbian_canqu: [],
        },
		prehidden_skills:[],
    };
    /**
     * (, , )
     * {@link lib.init.init}
     * @namespace
     * @global
     */
    var lib = /**@lends lib */ {
        discoloration1: "&lt;samp id=''>&lt;font face='yuanli'>&lt;style>#{animation:change 0.8s linear 0s infinite;}@keyframes change{0% {color:#FF0000;}20%{color:#F0A00F;}50% {color:#F000FF;}80%{color: #F0A00F;}100%{color:#FF0000;}}&lt;/style>",

        configprefix: 'vtuberkill_1.9_',
        versionOL: 27,
        updateURLS: {
            coding: 'https://v8gamemaker.coding.net/p/vtuberkill/d/vtuberkill_github/git/raw/',
            github: 'https://v8gamemaker.coding.net/p/vtuberkill/d/vtuberkill_github/git/raw/',
        },
        updateURL: 'https://v8gamemaker.coding.net/p/vtuberkill/d/vtuberkill_github/git/raw/',
        mirrorURL: 'https://v8gamemaker.coding.net/p/vtuberkill/d/vtuberkill_github/git/raw/',
        hallURL: 'www.vtuberkill.com',
        assetURL: '',
        changeLog: [],
        updates: [],
        canvasUpdates: [],
        video: [],
        skilllist: [],
        connectBanned: [],
        characterIntro: {},
        characterTitle: {},
        characterPack: {},
        characterFilter: {},
        characterSort: {},
        characterReplace: {},
        dynamicTranslate: {},
        cardPack: {},
        onresize: [],
        onphase: [],
        onwash: [],
        onover: [],
        ondb: [],
        ondb2: [],
        chatHistory: [],
        emotionList: {
            xiaowu_emotion: 14,
            shibing_emotion: 15,
            guojia_emotion: 20,
            zhenji_emotion: 20,
            xiaosha_emotion: 20,
            xiaotao_emotion: 20,
            xiaojiu_emotion: 20,
            Diana_emotion: 6,
        },
        animate: {
            skill: {},
            card: {},
        },
        arenaReady: [],
        onfree: [],
        inpile: [],
        extensions: [],
        extensionPack: {},
        cardType: {},
        hook: { globaltrigger: {}, globalskill: {} },
        hookmap: {},
        imported: {},
        layoutfixed: ['chess', 'tafang', 'stone'],//??
        /**
         * 
         * ['', '']
         * @name lib.characterDialogGroup
         * @see {@link ui.create.characterDialog}
         */
        characterDialogGroup: {
            '': function (name, capt) {
                return lib.config.favouriteCharacter.contains(name) ? capt : null;
            },
            '': function (name, capt) {
                var list = get.config('recentCharacter') || [];
                return list.contains(name) ? capt : null;
            }
        },
        /**
         * 
         * @param {HTMLDivELement} node 
         */
        listenEnd: function (node) {
            if (!node._listeningEnd) {
                node._listeningEnd = true;
                node.listenTransition(function () {
                    delete node._listeningEnd;
                    if (node._onEndMoveDelete) {
                        node.moveDelete(node._onEndMoveDelete);
                    }
                    else if (node._onEndDelete) {
                        node.delete();
                    }
                    node._transitionEnded = true;
                });
            }
        },
        /**
         * 
         * @name configMenu
         * @namespace
         * @type {!Object}
         */
        configMenu: {
            /**
             * 
             * @name configMenu.general
             * @type {!Object}
             */
            general: {
                name: '',
                config: {
                    low_performance: {
                        name: '',
                        init: false,
                        intro: '',
                        onclick: function (bool) {
                            game.saveConfig('low_performance', bool);
                            if (bool) {
                                ui.window.classList.add('low_performance');
                            }
                            else {
                                ui.window.classList.remove('low_performance');
                            }
                        }
                    },
                    compatiblemode: {
                        name: '',
                        init: false,
                        intro: '',
                        onclick: function (bool) {
                            game.saveConfig('compatiblemode', bool);
                            if (bool) {
                                ui.window.classList.add('compatiblemode');
                            }
                            else {
                                ui.window.classList.remove('compatiblemode');
                            }
                        }
                    },
                    confirm_exit: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        intro: '',
                    },
                    keep_awake: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        intro: '&lt;br>NoSleep.js',
                        onclick: function (bool) {
                            game.saveConfig('keep_awake', bool);
                            if (bool) {
                                if (window.plugins &amp;&amp; window.plugins.insomnia) window.plugins.insomnia.keepAwake();
                                else if (window.noSleep) {
                                    document.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', function enableNoSleepX() {
                                        document.removeEventListener(lib.config.touchscreen ? 'touchend' : 'click', enableNoSleepX, false);
                                        window.noSleep.enable();
                                    }, false);
                                }
                            }
                            else {
                                if (window.plugins &amp;&amp; window.plugins.insomnia) window.plugins.insomnia.allowSleepAgain();
                                else if (window.noSleep) window.noSleep.disable();
                            }
                        }
                    },
                    auto_confirm: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '1',
                    },
                    skip_shan: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        intro: '',
                    },
                    unauto_choose: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        intro: '',
                    },
                    wuxie_self: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    tao_enemy: {
                        name: '',
                        init: false,
                        intro: '',
                        unfrequent: true,
                    },
                    enable_drag: {
                        name: '',
                        init: true,
                        intro: '',
                        unfrequent: true,
                    },
                    enable_dragline: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    enable_touchdragline: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        intro: '',
                    },
                    // enable_pressure:{
                    //     name:'',
                    //     init:false,
                    //     intro:'',
                    //     unfrequent:true,
                    // },
                    // pressure_taptic:{
                    //     name:'',
                    //     init:false,
                    //     intro:'',
                    //     unfrequent:true,
                    // },
                    // pressure_click:{
                    //     name:'',
                    //     init:'pause',
                    //     intro:'',
                    //     unfrequent:true,
                    //     item:{
                    //         pause:'',
                    //         config:'',
                    //         auto:'',
                    //     }
                    // },
                    touchscreen: {
                        name: '',
                        init: false,
                        restart: true,
                        unfrequent: true,
                        intro: '',
                        onclick: function (bool) {
                            if (get.is.nomenu('touchscreen', bool)) return false;
                            game.saveConfig('touchscreen', bool);
                        }
                    },
                    swipe: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    swipe_down: {
                        name: '',
                        init: 'menu',
                        unfrequent: true,
                        intro: '',
                        item: {
                            system: '',
                            menu: '',
                            pause: '',
                            auto: '',
                            chat: '',
                            off: '',
                        },
                        onclick: function (item) {
                            if (get.is.nomenu('swipe_down', item)) return false;
                            game.saveConfig('swipe_down', item);
                        }
                    },
                    swipe_up: {
                        name: '',
                        intro: '',
                        init: 'auto',
                        unfrequent: true,
                        item: {
                            system: '',
                            menu: '',
                            pause: '',
                            auto: '',
                            chat: '',
                            off: '',
                        },
                        onclick: function (item) {
                            if (get.is.nomenu('swipe_up', item)) return false;
                            game.saveConfig('swipe_up', item);
                        }
                    },
                    swipe_left: {
                        name: '',
                        intro: '',
                        init: 'system',
                        unfrequent: true,
                        item: {
                            system: '',
                            menu: '',
                            pause: '',
                            auto: '',
                            chat: '',
                            off: '',
                        },
                        onclick: function (item) {
                            if (get.is.nomenu('swipe_left', item)) return false;
                            game.saveConfig('swipe_left', item);
                        }
                    },
                    swipe_right: {
                        name: '',
                        intro: '',
                        init: 'system',
                        unfrequent: true,
                        item: {
                            system: '',
                            menu: '',
                            pause: '',
                            auto: '',
                            chat: '',
                            off: '',
                        },
                        onclick: function (item) {
                            if (get.is.nomenu('swipe_right', item)) return false;
                            game.saveConfig('swipe_right', item);
                        }
                    },
                    round_menu_func: {
                        name: '',
                        intro: '',
                        init: 'system',
                        unfrequent: true,
                        item: {
                            system: '',
                            menu: '',
                            pause: '',
                            auto: ''
                        },
                        onclick: function (item) {
                            if (get.is.nomenu('round_menu_func', item)) return false;
                            game.saveConfig('round_menu_func', item);
                        },
                    },
                    show_splash: {
                        name: '',
                        intro: '',
                        init: 'init',
                        item: {
                            off: '',
                            init: '',
                            always: '',
                        }
                    },
                    game_speed: {
                        name: '',
                        init: 'mid',
                        item: {
                            vslow: '',
                            slow: '',
                            mid: '',
                            fast: '',
                            vfast: '',
                            vvfast: '',
                        },
                        intro: ''
                    },
                    sync_speed: {
                        name: '',
                        intro: '',
                        init: true
                    },
                    enable_vibrate: {
                        name: '',
                        intro: '',
                        init: false
                    },
                    right_click: {
                        name: '',
                        init: 'pause',
                        intro: '',
                        unfrequent: true,
                        item: {
                            pause: '',
                            shortcut: '',
                            config: '',
                            auto: '',
                        },
                        onclick: function (item) {
                            if (get.is.nomenu('right_click', item)) return false;
                            game.saveConfig('right_click', item);
                        }
                    },
                    longpress_info: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        restart: true,
                        intro: '',
                    },
                    right_info: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        restart: true,
                        intro: '',
                    },
                    hover_all: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        restart: true,
                        intro: '',
                    },
                    hover_handcard: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    hoveration: {
                        name: '',
                        unfrequent: true,
                        intro: '',
                        init: '1000',
                        item: {
                            '500': '0.5',
                            '700': '0.7',
                            '1000': '1',
                            '1500': '1.5',
                            '2500': '2.5',
                        }
                    },
                    doubleclick_intro: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    video: {
                        name: '',
                        init: '20',
                        intro: '',
                        item: {
                            '0': '',
                            '5': '',
                            '10': '',
                            '20': '',
                            '50': '',
                            '10000': '',
                        },
                        unfrequent: true,
                    },
                    max_loadtime: {
                        name: '',
                        intro: '',
                        init: '10000',
                        unfrequent: true,
                        item: {
                            5000: '5',
                            10000: '10',
                            20000: '20',
                            60000: '60'
                        },
                        onclick: function (item) {
                            game.saveConfig('max_loadtime', item);
                            if (item == '5000') {
                                localStorage.removeItem(lib.configprefix + 'loadtime');
                            }
                            else {
                                localStorage.setItem(lib.configprefix + 'loadtime', item);
                            }
                        }
                    },
                    mousewheel: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: 'mac',
                        onclick: function (bool) {
                            game.saveConfig('mousewheel', bool);
                            if (lib.config.touchscreen) return;
                            if (lib.config.mousewheel) {
                                ui.handcards1Container.onmousewheel = ui.click.mousewheel;
                                ui.handcards2Container.onmousewheel = ui.click.mousewheel;
                            }
                            else {
                                ui.handcards1Container.onmousewheel = null;
                                ui.handcards2Container.onmousewheel = null;
                            }
                        }
                    },
                    auto_check_update: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true
                    },
                    lucky_star: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true
                    },
                    dev: {
                        name: '',
                        intro: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('dev', bool);
                            if (_status.connectMode) return;
                            if (bool) {
                                lib.cheat.i();
                            }
                            else {
                                delete window.cheat;
                                delete window.game;
                                delete window.ui;
                                delete window.get;
                                delete window.ai;
                                delete window.lib;
                                delete window._status;
                            }
                        },
                        unfrequent: true,
                    },
                    errstop: {
                        name: '',
                        init: false,
                        unfrequent: true
                    },
                    update_link: {
                        name: '',
                        init: 'coding',
                        unfrequent: true,
                        item: {
                            coding: 'Coding',
                            github: 'GitHub',
                        },
                        onclick: function (item) {
                            game.saveConfig('update_link', item);
                            lib.updateURL = lib.updateURLS[item] || lib.updateURLS.coding;
                        },
                    },
                    //https://raw.githubusercontent.com/libccy/noname-extension/master/
                    extension_source: {
                        name: '',
                        init: 'Coding',
                        unfrequent: true,
                        item: {},
                        intro: function () {
                            return '&lt;br>' + lib.config.extension_sources[lib.config.extension_source];
                        },
                        onclick: function (item) {
                            game.saveConfig('extension_source', item);
                        },
                    },
                    extension_create: {
                        name: '',
                        clear: true,
                        unfrequent: true,
                        onclick: function () {
                            game.prompt('', function (str) {
                                if (str) {
                                    var map = lib.config.extension_sources;
                                    game.prompt('' + str + '', function (str2) {
                                        if (str2) {
                                            delete map[str];
                                            map[str] = str2;
                                            game.saveConfig('extension_sources', map);
                                            game.saveConfig('extension_source', str);
                                            var nodexx = ui.extension_source;
                                            nodexx.updateInner();
                                            var nodeyy = nodexx._link.menu;
                                            var nodezz = nodexx._link.config;
                                            for (var i = 0; i &lt; nodeyy.childElementCount; i++) {
                                                if (nodeyy.childNodes[i]._link == str) {
                                                    nodeyy.childNodes[i].remove();
                                                    break;
                                                }
                                            }
                                            var textMenu = ui.create.div('', str, nodeyy, function () {
                                                var node = this.parentNode._link;
                                                var config = node._link.config;
                                                node._link.current = this.link;
                                                var tmpName = node.lastChild.innerHTML;
                                                node.lastChild.innerHTML = config.item[this._link];
                                                if (config.onclick) {
                                                    if (config.onclick.call(node, this._link, this) === false) {
                                                        node.lastChild.innerHTML = tmpName;
                                                    }
                                                }
                                                if (config.update) {
                                                    config.update();
                                                }
                                            });
                                            textMenu._link = str;
                                            nodezz.item[name] = str;
                                            alert('' + str);
                                        }
                                    })
                                }
                            });
                        },
                    },
                    extension_delete: {
                        name: '',
                        clear: true,
                        unfrequent: true,
                        onclick: function () {
                            var bool = false, map = lib.config.extension_sources;
                            for (var i in map) {
                                if (i != lib.config.extension_source) {
                                    bool = true;
                                    break;
                                }
                            }
                            if (!bool) {
                                alert('');
                                return;
                            }
                            var name = lib.config.extension_source;
                            game.saveConfig('extension_source', i);
                            delete map[name];
                            game.saveConfig('extension_sources', map);
                            var nodexx = ui.extension_source;
                            nodexx.updateInner();
                            var nodeyy = nodexx._link.menu;
                            var nodezz = nodexx._link.config;
                            for (var i = 0; i &lt; nodeyy.childElementCount; i++) {
                                if (nodeyy.childNodes[i]._link == name) {
                                    nodeyy.childNodes[i].remove();
                                    break;
                                }
                            }
                            delete nodezz.item[name];
                            alert('' + name);
                        },
                    },
                    update: function (config, map) {
                        if ('ontouchstart' in document) {
                            map.touchscreen.show();
                        }
                        else {
                            map.touchscreen.hide();
                        }
                        if (lib.device || lib.node) {
                            map.auto_check_update.show();
                        }
                        else {
                            map.auto_check_update.hide();
                        }
                        if (lib.device) {
                            map.enable_vibrate.show();
                            map.keep_awake.show();
                        }
                        else {
                            map.enable_vibrate.hide();
                            map.keep_awake.hide();
                        }
                        // if(config.enable_pressure){
                        //     map.pressure_click.show();
                        //     if(lib.device){
                        //         map.pressure_taptic.show();
                        //     }
                        //     else{
                        //         map.pressure_taptic.hide();
                        //     }
                        // }
                        // else{
                        //     map.pressure_click.hide();
                        //     map.pressure_taptic.hide();
                        // }
                        if (lib.config.touchscreen) {
                            map.mousewheel.hide();
                            map.hover_all.hide();
                            map.hover_handcard.hide();
                            map.hoveration.hide();
                            map.right_info.hide();
                            map.right_click.hide();
                            map.longpress_info.show();
                            map.swipe.show();
                            if (lib.config.swipe) {
                                map.swipe_up.show();
                                map.swipe_down.show();
                                map.swipe_left.show();
                                map.swipe_right.show();
                            }
                            else {
                                map.swipe_up.hide();
                                map.swipe_down.hide();
                                map.swipe_left.hide();
                                map.swipe_right.hide();
                            }
                        }
                        else {
                            map.mousewheel.show();
                            map.hover_all.show();
                            map.right_info.show();
                            map.right_click.show();
                            map.longpress_info.hide();
                            if (!config.hover_all) {
                                map.hover_handcard.hide();
                                map.hoveration.hide();
                            }
                            else {
                                map.hover_handcard.show();
                                map.hoveration.show();
                            }
                            map.swipe.hide();
                            map.swipe_up.hide();
                            map.swipe_down.hide();
                            map.swipe_left.hide();
                            map.swipe_right.hide();
                        }
                        if (lib.config.enable_drag) {
                            if (lib.config.touchscreen) {
                                map.enable_dragline.hide();
                                map.enable_touchdragline.show();
                            }
                            else {
                                map.enable_dragline.show();
                                map.enable_touchdragline.hide();
                            }
                        }
                        else {
                            map.enable_dragline.hide();
                            map.enable_touchdragline.hide();
                        }
                        if (!get.is.phoneLayout()) {
                            map.round_menu_func.hide();
                        }
                        else {
                            map.round_menu_func.show();
                        }
                        if (!lib.node &amp;&amp; lib.device != 'ios') {
                            map.confirm_exit.show();
                        }
                        else {
                            map.confirm_exit.hide();
                        }
                        if (config.dev) {
                            map.errstop.show();
                        }
                        else {
                            map.errstop.hide();
                        }
                    }
                }
            },
            /**
             * 
             * @name configMenu.appearence
             * @type {!Object}
             */
            appearence: {
                name: '',
                config: {
                    theme: {
                        name: '',
                        init: 'woodden',
                        item: {},
                        visualMenu: function (node, link) {
                            if (!node.menu) {
                                node.className = 'button character themebutton ' + link;
                                node.menu = ui.create.div(node, '', '&lt;div>&lt;/div>&lt;div>&lt;/div>&lt;div>&lt;/div>&lt;div>&lt;/div>');
                            }
                        },
                        onclick: function (theme) {
                            game.saveConfig('theme', theme);
                            ui.arena.hide();
                            lib.init.background();
                            if (lib.config.autostyle) {
                                if (theme == 'simple') {
                                    lib.configMenu.appearence.config.player_border.onclick('slim');
                                }
                                else {
                                    lib.configMenu.appearence.config.player_border.onclick('normal');
                                }
                            }
                            setTimeout(function () {
                                var theme = ui.css.theme;
                                ui.css.theme = lib.init.css(lib.assetURL + 'theme/' + lib.config.theme, 'style');
                                theme.remove();
                                setTimeout(function () { ui.arena.show(); }, 100);
                            }, 500);
                        }
                    },
                    /**
                     * 
                     * @name configMenu.appearence.layout
                     */
                    layout: {
                        name: '',
                        init: 'mobile',
                        item: {
                            default: '',
                            newlayout: '',
                            mobile: '',
                            long: '',
                            long2: '',
                            nova: ''
                        },
                        visualMenu: function (node, link) {
                            node.className = 'button character themebutton ' + lib.config.theme;
                            if (!node.created) {
                                node.created = true;
                                node.style.overflow = 'hidden';
                                node.firstChild.style.display = 'none';
                                // node.firstChild.classList.add('shadowed');
                                // node.firstChild.style.width='16px';
                                // node.firstChild.style.height='auto';
                                // node.firstChild.style.padding='2px';
                                // node.firstChild.style.textAlign='center';
                                var me = ui.create.div(node);
                                me.style.top = 'auto';
                                if (link == 'default' || link == 'newlayout') {
                                    me.style.width = 'calc(100% - 6px)';
                                    me.style.left = '3px';
                                    me.style.bottom = '3px';
                                    me.style.height = '25px';
                                    if (link == 'newlayout') {
                                        me.style.height = '23px';
                                        me.style.bottom = '4px';
                                    }
                                }
                                else if (link == 'long2' || link == 'nova') {
                                    me.style.display = 'none';
                                }
                                else {
                                    me.style.width = '120%';
                                    me.style.left = '-10%';
                                    me.style.bottom = '0';
                                    me.style.height = '22px';
                                }
                                me.style.borderRadius = '2px';
                                var list = ['KizunaAI', 'MiraiAkari', 'Siro', 'Nekomasu'];
                                for (var i = 0; i &lt; 4; i++) {
                                    var player = ui.create.div('.fakeplayer', node);
                                    ui.create.div('.avatar', player).setBackground(list.randomRemove(), 'character');
                                    player.style.borderRadius = '2px';
                                    if (i != 3) {
                                        player.style.top = 'auto';
                                    }
                                    if (link == 'default') {
                                        player.style.height = '19px';
                                        player.style.width = '38px';
                                        player.classList.add('oldlayout')
                                    }
                                    else if (link == 'mobile' || link == 'newlayout') {
                                        player.style.width = '24px';
                                        player.style.height = '29px';
                                    }
                                    else if (link == 'nova') {
                                        player.style.width = '20px';
                                        player.style.height = '24px';
                                    }
                                    else {
                                        player.style.width = '20px';
                                        player.style.height = '34px';
                                    }
                                    if (i == 1) {
                                        player.style.left = '3px';
                                    }
                                    if (i == 2) {
                                        player.style.left = 'auto';
                                        player.style.right = '3px';
                                    }
                                    if (i == 3) {
                                        player.style.top = '3px';
                                    }
                                    if (link == 'default') {
                                        if (i == 0) {
                                            player.style.bottom = '6px';
                                        }
                                        if (i == 0 || i == 3) {
                                            player.style.left = 'calc(50% - 18px)';
                                        }
                                        if (i == 1 || i == 2) {
                                            player.style.bottom = '36px';
                                        }
                                    }
                                    else if (link == 'newlayout') {
                                        if (i == 0) {
                                            player.style.bottom = '1px';
                                        }
                                        if (i == 0 || i == 3) {
                                            player.style.left = 'calc(50% - 12px)';
                                        }
                                        if (i == 1 || i == 2) {
                                            player.style.bottom = '32px';
                                        }
                                    }
                                    else if (link == 'mobile') {
                                        if (i == 0 || i == 3) {
                                            player.style.left = 'calc(50% - 12px)';
                                        }
                                        if (i == 1 || i == 2) {
                                            player.style.bottom = '30px';
                                        }
                                    }
                                    else if (link == 'long') {
                                        if (i == 0 || i == 3) {
                                            player.style.left = 'calc(50% - 10px)';
                                        }
                                        if (i == 1 || i == 2) {
                                            player.style.bottom = '45px';
                                        }
                                    }
                                    else if (link == 'long2') {
                                        if (i == 0) {
                                            player.style.bottom = '2px';
                                            player.style.left = '3px';
                                        }
                                        if (i == 3) {
                                            player.style.left = 'calc(50% - 10px)';
                                        }
                                        if (i == 1 || i == 2) {
                                            player.style.bottom = '45px';
                                        }
                                    }
                                    else if (link == 'nova') {
                                        if (i == 0) {
                                            player.style.bottom = '2px';
                                            player.style.left = '3px';
                                        }
                                        if (i == 3) {
                                            player.style.left = 'calc(50% - 10px)';
                                        }
                                        if (i == 1 || i == 2) {
                                            player.style.left = '3px';
                                            player.style.bottom = (i * 30) + 'px';
                                        }
                                    }

                                    if (i == 0 &amp;&amp; (link == 'mobile' || link == 'long')) {
                                        player.classList.add('me');
                                        player.style.borderRadius = '0px';
                                        player.style.width = '25px';
                                        player.style.height = '25px';
                                        player.style.bottom = '-3px';
                                        player.style.left = '-3px';
                                    }
                                }
                            }
                        },
                        onclick: function (layout) {
                            if (lib.layoutfixed.contains(lib.config.mode)) {
                                game.saveConfig('layout', layout);
                            }
                            else {
                                lib.init.layout(layout);
                            }
                        }
                    },
                    // fewplayer:{
                    //     name:'',
                    //     intro:'',
                    //     init:'3',
                    //     // unfrequent:true,
                    //     item:{
                    //                  '2':'',
                    //                  '3':'',
                    //                  '4':'',
                    //                  '5':'',
                    //                  '6':'',
                    //                  '7':'',
                    //                  '8':'',
                    //     },
                    //     onclick:function(item){
                    //                  game.saveConfig('fewplayer',item);
                    //                  if(ui.arena) ui.arena.setNumber(ui.arena.dataset.number);
                    //     }
                    // },
                    player_height: {
                        name: '',
                        init: 'long',
                        // unfrequent:true,
                        item: {
                            short: '',
                            default: '',
                            long: '',
                        },
                        onclick: function (item) {
                            game.saveConfig('player_height', item);
                            ui.arena.dataset.player_height = item;
                        }
                    },
                    player_height_nova: {
                        name: '',
                        init: 'short',
                        item: {
                            // auto:'',
                            short: '',
                            default: '',
                            long: '',
                        },
                        onclick: function (item) {
                            game.saveConfig('player_height_nova', item);
                            // if(item=='auto'){
                            //     if(parseInt(ui.arena.dataset.number)>=7){
                            //         ui.arena.dataset.player_height_nova='short';
                            //     }
                            //     else{
                            //         ui.arena.dataset.player_height_nova='default';
                            //     }
                            // }
                            // else{
                            ui.arena.dataset.player_height_nova = item;
                            // }
                        }
                    },
                    // background_color_music:{
                    //     name:'',
                    //     init:'black',
                    //     item:{
                    //         blue:'',
                    //         black:'',
                    //     },
                    //     onclick:function(color){
                    //         game.saveConfig('background_color_music',color);
                    //         document.body.dataset.background_color_music=color;
                    //     }
                    // },
                    // background_color_wood:{
                    //     name:'',
                    //     init:'blue',
                    //     item:{
                    //         blue:'',
                    //         black:'',
                    //     },
                    //     onclick:function(color){
                    //         game.saveConfig('background_color_wood',color);
                    //         document.body.dataset.background_color_wood=color;
                    //     }
                    // },
                    // theme_color_music:{
                    //     name:'',
                    //     init:'black',
                    //     item:{
                    //         blue:'',
                    //         black:'',
                    //     },
                    //     onclick:function(color){
                    //         game.saveConfig('theme_color_music',color);
                    //         document.body.dataset.theme_color_music=color;
                    //     }
                    // },
                    ui_zoom: {
                        name: '',
                        unfrequent: true,
                        init: 'normal',
                        item: {
                            esmall: '80%',
                            vsmall: '90%',
                            small: '95%',
                            normal: '100%',
                            big: '105%',
                            vbig: '110%',
                            ebig: '120%',
                        },
                        onclick: function (zoom) {
                            game.saveConfig('ui_zoom', zoom);
                            switch (zoom) {
                                case 'esmall': zoom = 0.8; break;
                                case 'vsmall': zoom = 0.9; break;
                                case 'small': zoom = 0.93; break;
                                case 'big': zoom = 1.05; break;
                                case 'vbig': zoom = 1.1; break;
                                case 'ebig': zoom = 1.2; break;
                                default: zoom = 1;
                            }
                            game.documentZoom = game.deviceZoom * zoom;
                            ui.updatez();
                        }
                    },
                    image_background: {
                        name: '',
                        init: 'default',
                        item: {},
                        visualBar: function (node, item, create) {
                            if (node.created) {
                                node.lastChild.classList.remove('active');
                                return;
                            }
                            node.created = true;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    var name = file.name;
                                    if (name.indexOf('.') != -1) {
                                        name = name.slice(0, name.indexOf('.'));
                                    }
                                    var link = (game.writeFile ? 'cdv_' : 'custom_') + name;
                                    if (item[link]) {
                                        for (var i = 1; i &lt; 1000; i++) {
                                            if (!item[link + '_' + i]) {
                                                link = link + '_' + i; break;
                                            }
                                        }
                                    }
                                    item[link] = name;
                                    var callback = function () {
                                        create(link, node.parentNode.defaultNode);
                                        node.parentNode.updateBr();
                                        lib.config.customBackgroundPack.add(link);
                                        game.saveConfig('customBackgroundPack', lib.config.customBackgroundPack);
                                    };
                                    if (game.writeFile) {
                                        game.writeFile(file, 'image/background', link + '.jpg', callback);
                                    }
                                    else {
                                        game.putDB('image', link, file, callback);
                                    }
                                    if (node.lastChild.classList.contains('active')) {
                                        editbg.call(node.lastChild);
                                    }
                                }
                            }).inputNode.accept = 'image/*';
                            var editbg = function () {
                                this.classList.toggle('active');
                                var page = this.parentNode.parentNode;
                                for (var i = 0; i &lt; page.childElementCount; i++) {
                                    if (page.childNodes[i].classList.contains('button')) {
                                        var link = page.childNodes[i]._link;
                                        if (link &amp;&amp; link != 'default') {
                                            var str;
                                            if (this.classList.contains('active')) {
                                                if (link.indexOf('custom_') == 0 || link.indexOf('cdv_') == 0) {
                                                    str = '';
                                                }
                                                else {
                                                    str = '';
                                                }
                                            }
                                            else {
                                                str = item[link];
                                            }
                                            page.childNodes[i].firstChild.innerHTML = get.verticalStr(str);
                                        }
                                    }
                                }
                            };
                            ui.create.div('.menubutton', '', node, editbg);
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button character';
                            node.style.backgroundImage = '';
                            node.style.backgroundSize = '';
                            if (node.firstChild) {
                                node.firstChild.innerHTML = get.verticalStr(name);
                            }
                            if (link == 'default' || link.indexOf('custom_') == 0) {
                                node.style.backgroundImage = 'none';
                                node.classList.add('dashedmenubutton');
                                if (link.indexOf('custom_') == 0) {
                                    game.getDB('image', link, function (fileToLoad) {
                                        if (!fileToLoad) return;
                                        var fileReader = new FileReader();
                                        fileReader.onload = function (fileLoadedEvent) {
                                            var data = fileLoadedEvent.target.result;
                                            node.style.backgroundImage = 'url(' + data + ')';
                                            node.style.backgroundSize = 'cover';
                                            node.classList.remove('dashedmenubutton');
                                        };
                                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                    });
                                }
                                else {
                                    node.parentNode.defaultNode = node;
                                }
                            }
                            else {
                                if (link.indexOf('svg_') == 0) {
                                    node.setBackgroundImage('image/background/' + link.slice(4) + '.svg');
                                }
                                else {
                                    node.setBackgroundImage('image/background/' + link + '.jpg');
                                }
                                node.style.backgroundSize = 'cover';
                            }
                        },
                        onclick: function (background, node) {
                            if (node &amp;&amp; node.firstChild) {
                                var menu = node.parentNode;
                                if (node.firstChild.innerHTML == get.verticalStr('')) {
                                    menu.parentNode.noclose = true;
                                    node.remove();
                                    menu.updateBr();
                                    if (!lib.config.prompt_hidebg) {
                                        alert('--');
                                        game.saveConfig('prompt_hidebg', true);
                                    }
                                    lib.config.hiddenBackgroundPack.add(background);
                                    game.saveConfig('hiddenBackgroundPack', lib.config.hiddenBackgroundPack);
                                    delete lib.configMenu.appearence.config.image_background.item[background];
                                    if (lib.config.image_background == background) {
                                        background = 'default';
                                        this.lastChild.innerHTML = '';
                                    }
                                    else {
                                        this.lastChild.innerHTML = lib.configMenu.appearence.config.image_background.item[lib.config.image_background];
                                        return;
                                    }
                                }
                                else if (node.firstChild.innerHTML == get.verticalStr('')) {
                                    menu.parentNode.noclose = true;
                                    if (confirm('')) {
                                        node.remove();
                                        menu.updateBr();
                                        lib.config.customBackgroundPack.remove(background);
                                        game.saveConfig('customBackgroundPack', lib.config.customBackgroundPack);
                                        if (background.indexOf('cdv_') == 0) {
                                            game.removeFile('image/background/' + background + '.jpg');
                                        }
                                        else {
                                            game.deleteDB('image', background);
                                        }
                                        delete lib.configMenu.appearence.config.image_background.item[background];
                                        if (lib.config.image_background == background) {
                                            background = 'default';
                                            this.lastChild.innerHTML = '';
                                        }
                                        else {
                                            this.lastChild.innerHTML = lib.configMenu.appearence.config.image_background.item[lib.config.image_background];
                                            return;
                                        }
                                    }
                                }
                            }
                            var animate = lib.config.image_background == 'default';
                            game.saveConfig('image_background', background);
                            lib.init.background();
                            ui.background.delete();
                            ui.background = ui.create.div('.background');

                            if (lib.config.image_background_blur) {
                                ui.background.style.filter = 'blur(8px)';
                                ui.background.style.webkitFilter = 'blur(8px)';
                                ui.background.style.transform = 'scale(1.05)';
                            }
                            else {
                                ui.background.style.filter = '';
                                ui.background.style.webkitFilter = '';
                                ui.background.style.transform = '';
                            }

                            document.body.insertBefore(ui.background, document.body.firstChild);
                            if (animate) ui.background.animate('start');
                            if (lib.config.image_background == 'default') {
                                ui.background.style.backgroundImage = "none";
                            }
                            else if (lib.config.image_background.indexOf('custom_') == 0) {
                                ui.background.style.backgroundImage = "none";
                                game.getDB('image', lib.config.image_background, function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        ui.background.style.backgroundImage = 'url(' + data + ')';
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                            else {
                                if (lib.config.image_background.indexOf('svg_') == 0) {
                                    ui.background.setBackgroundImage('image/background/' + lib.config.image_background.slice(4) + '.svg');
                                }
                                else {
                                    ui.background.setBackgroundImage('image/background/' + lib.config.image_background + '.jpg');

                                    ui.backgroundSVG = ui.create.div('.background',ui.background);
                                    ui.backgroundSVG.setBackgroundImage('image/background/' + 'simple1_bg' + '.svg');
                                    ui.backgroundSVG.style.opacity = '.3';
                                }
                            }
                            ui.background.style.backgroundSize = 'cover';
                            ui.background.style.backgroundPosition = '50% 50%';
                        },
                    },
                    image_background_random: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('image_background_random', bool);
                            lib.init.background();
                        }
                    },
                    image_background_blur: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('image_background_blur', bool);
                            if (lib.config.image_background_blur) {
                                ui.background.style.filter = 'blur(8px)';
                                ui.background.style.webkitFilter = 'blur(8px)';
                                ui.background.style.transform = 'scale(1.05)';
                            }
                            else {
                                ui.background.style.filter = '';
                                ui.background.style.webkitFilter = '';
                                ui.background.style.transform = '';
                            }
                        },
                    },
                    phonelayout: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            if (get.is.nomenu('phonelayout', bool)) return false;
                            game.saveConfig('phonelayout', bool);
                            if (get.is.phoneLayout()) {
                                ui.css.phone.href = lib.assetURL + 'layout/default/phone.css';
                                ui.arena.classList.add('phone');
                            }
                            else {
                                ui.css.phone.href = '';
                                ui.arena.classList.remove('phone');
                            }
                        }
                    },
                    change_skin: {
                        name: '',
                        init: true,
                        intro: '---'
                    },
                    change_skin_auto: {
                        name: '',
                        init: 'off',
                        item: {
                            'off': '',
                            '30000': '',
                            '60000': '',
                            '120000': '',
                            '300000': '',
                        },
                        intro: '',
                        onclick: function (item) {
                            game.saveConfig('change_skin_auto', item);
                            clearTimeout(_status.skintimeout);
                            if (item != 'off') {
                                _status.skintimeout = setTimeout(ui.click.autoskin, parseInt(item));
                            }
                        }
                    },
                    card_style: {
                        name: '',
                        init: 'default',
                        intro: '',
                        item: {
                            wood: '',
                            music: '',
                            simple: '',
                            ol: '',
                            // new:'',
                            custom: '',
                            default: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'card_style', file, function () {
                                        game.getDB('image', 'card_style', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.style.backgroundImage = 'url(' + data + ')';
                                                button.className = 'button card fullskin';
                                                node.classList.add('showdelete');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'card_style');
                                    button.style.backgroundImage = 'none';
                                    button.className = 'button character dashedmenubutton';
                                    node.classList.remove('showdelete');
                                    if (lib.config.card_style == 'custom') {
                                        lib.configMenu.appearence.config.card_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button card fullskin';
                            node.style.backgroundSize = '100% 100%';
                            switch (link) {
                                case 'default': case 'custom': {
                                    if (lib.config.theme == 'simple') {
                                        node.style.backgroundImage = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4))';
                                        node.className = 'button character';
                                    }
                                    else {
                                        node.style.backgroundImage = 'none';
                                        node.className = 'button character dashedmenubutton';
                                    }
                                    break;
                                }
                                case 'new': node.setBackgroundImage('theme/style/card/image/new.png'); break;
                                case 'ol': node.setBackgroundImage('theme/style/card/image/ol.png'); break;
                                case 'wood': node.setBackgroundImage('theme/woodden/wood.jpg'); node.style.backgroundSize = 'initial'; break;
                                case 'music': node.setBackgroundImage('theme/music/wood3.png'); break;
                                case 'simple': node.setBackgroundImage('theme/simple/card.png'); break;
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                game.getDB('image', 'card_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        node.style.backgroundImage = 'url(' + data + ')';
                                        node.className = 'button card fullskin';
                                        node.parentNode.lastChild.classList.add('showdelete');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('card_style', layout);
                            var style = ui.css.card_style;
                            ui.css.card_style = lib.init.css(lib.assetURL + 'theme/style/card', lib.config.card_style);
                            style.remove();
                            if (ui.css.card_stylesheet) {
                                ui.css.card_stylesheet.remove();
                                delete ui.css.card_stylesheet;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'card_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.card_stylesheet) {
                                            ui.css.card_stylesheet.remove();
                                        }
                                        ui.css.card_stylesheet = lib.init.sheet('.card:not(*:empty){background-image:url(' + fileLoadedEvent.target.result + ')}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        unfrequent: true,
                    },
                    cardback_style: {
                        name: '',
                        intro: '',
                        init: 'default',
                        item: {
                            // wood:'',
                            // music:'',
                            vk: 'V',
                            official: '',
                            // new:'',
                            feicheng: '',
                            liusha: '',
                            ol: '',
                            custom: '',
                            default: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'cardback_style', file, function () {
                                        game.getDB('image', 'cardback_style', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.style.backgroundImage = 'url(' + data + ')';
                                                button.className = 'button character';
                                                node.classList.add('showdelete');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            ui.create.filediv('.menubutton.deletebutton.addbutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'cardback_style2', file, function () {
                                        node.classList.add('hideadd');
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'cardback_style');
                                    game.deleteDB('image', 'cardback_style2');
                                    button.style.backgroundImage = 'none';
                                    button.className = 'button character dashedmenubutton';
                                    node.classList.remove('showdelete');
                                    node.classList.remove('hideadd');
                                    if (lib.config.cardback_style == 'custom') {
                                        lib.configMenu.appearence.config.cardback_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.style.backgroundSize = '100% 100%';
                            switch (link) {
                                case 'default': case 'custom': {
                                    node.style.backgroundImage = 'none';
                                    node.className = 'button character dashedmenubutton';
                                    break;
                                }
                                case 'vk': node.className = 'button character'; node.setBackgroundImage('theme/style/cardback/image/vk.png'); break;
                                case 'new': node.className = 'button character'; node.setBackgroundImage('theme/style/cardback/image/new.png'); break;
                                case 'feicheng': node.className = 'button character'; node.setBackgroundImage('theme/style/cardback/image/feicheng.png'); break;
                                case 'official': node.className = 'button character'; node.setBackgroundImage('theme/style/cardback/image/official.png'); break;
                                case 'liusha': node.className = 'button character'; node.setBackgroundImage('theme/style/cardback/image/liusha.png'); break;
                                case 'ol': node.className = 'button character'; node.setBackgroundImage('theme/style/cardback/image/ol.png'); break;
                                case 'wood': node.className = 'button card fullskin'; node.setBackgroundImage('theme/woodden/wood.jpg'); node.style.backgroundSize = 'initial'; break;
                                case 'music': node.className = 'button card fullskin'; node.setBackgroundImage('theme/music/wood3.png'); break;
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                game.getDB('image', 'cardback_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        node.style.backgroundImage = 'url(' + data + ')';
                                        node.className = 'button character';
                                        node.parentNode.lastChild.classList.add('showdelete');
                                        game.getDB('image', 'cardback_style2', function (file) {
                                            if (file) {
                                                node.parentNode.lastChild.classList.add('hideadd');
                                            }
                                        });
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('cardback_style', layout);
                            var style = ui.css.cardback_style;
                            ui.css.cardback_style = lib.init.css(lib.assetURL + 'theme/style/cardback', lib.config.cardback_style);
                            style.remove();
                            if (ui.css.cardback_stylesheet) {
                                ui.css.cardback_stylesheet.remove();
                                delete ui.css.cardback_stylesheet;
                            }
                            if (ui.css.cardback_stylesheet2) {
                                ui.css.cardback_stylesheet2.remove();
                                delete ui.css.cardback_stylesheet2;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'cardback_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.cardback_stylesheet) {
                                            ui.css.cardback_stylesheet.remove();
                                        }
                                        ui.css.cardback_stylesheet = lib.init.sheet('.card:empty,.card.infohidden{background-image:url(' + fileLoadedEvent.target.result + ')}');
                                        game.getDB('image', 'cardback_style2', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                if (ui.css.cardback_stylesheet2) {
                                                    ui.css.cardback_stylesheet2.remove();
                                                }
                                                ui.css.cardback_stylesheet2 = lib.init.sheet('.card.infohidden:not(.infoflip){background-image:url(' + fileLoadedEvent.target.result + ')}');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        unfrequent: true,
                    },
                    hp_style: {
                        name: '',
                        init: 'ol',
                        item: {
                            default: '',
                            // official:'',
                            emotion: '',
                            glass: '',
                            round: '',
                            ol: '',
                            xinglass: '',
                            xinround: 'OL',
                            custom: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton.addbutton', '', node, function (file) {
                                if (file &amp;&amp; node.currentDB) {
                                    game.putDB('image', 'hp_style' + node.currentDB, file, function () {
                                        game.getDB('image', 'hp_style' + node.currentDB, function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.childNodes[node.currentDB - 1].style.backgroundImage = 'url(' + data + ')';
                                                button.classList.add('shown');
                                                node.classList.add('showdelete');
                                                node.currentDB++;
                                                if (node.currentDB > 4) {
                                                    node.classList.add('hideadd');
                                                    button.classList.remove('transparent');
                                                    delete node.currentDB;
                                                }
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'hp_style1');
                                    game.deleteDB('image', 'hp_style2');
                                    game.deleteDB('image', 'hp_style3');
                                    game.deleteDB('image', 'hp_style4');
                                    for (var i = 0; i &lt; button.childElementCount; i++) {
                                        button.childNodes[i].style.backgroundImage = 'none';
                                    }
                                    node.classList.remove('showdelete');
                                    node.classList.remove('hideadd');
                                    if (lib.config.hp_style == 'custom') {
                                        lib.configMenu.appearence.config.hp_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                    button.classList.remove('shown');
                                    node.currentDB = 1;
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button hpbutton dashedmenubutton';
                            node.innerHTML = '';
                            for (var i = 1; i &lt;= 4; i++) {
                                var div = ui.create.div(node);
                                if (link == 'default') {
                                    ui.create.div(div);
                                }
                                else if (link != 'custom') {
                                    div.setBackgroundImage('theme/style/hp/image/' + link + i + '.png');
                                }
                                if (i == 4) {
                                    div.style.webkitFilter = 'grayscale(1)';
                                }
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                var getDB = function (num) {
                                    node.parentNode.lastChild.currentDB = num;
                                    game.getDB('image', 'hp_style' + num, function (fileToLoad) {
                                        if (!fileToLoad) return;
                                        var fileReader = new FileReader();
                                        fileReader.onload = function (fileLoadedEvent) {
                                            var data = fileLoadedEvent.target.result;
                                            node.childNodes[num - 1].style.backgroundImage = 'url(' + data + ')';
                                            node.classList.add('shown');
                                            node.parentNode.lastChild.classList.add('showdelete');
                                            if (num &lt; 4) {
                                                getDB(num + 1);
                                            }
                                            else {
                                                node.parentNode.lastChild.classList.add('hideadd');
                                                node.classList.remove('transparent');
                                                delete node.parentNode.firstChild.currentDB;
                                            }
                                        };
                                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                    });
                                }
                                getDB(1);
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('hp_style', layout);
                            var style = ui.css.hp_style;
                            ui.css.hp_style = lib.init.css(lib.assetURL + 'theme/style/hp', lib.config.hp_style);
                            style.remove();
                            if (ui.css.hp_stylesheet1) {
                                ui.css.hp_stylesheet1.remove();
                                delete ui.css.hp_stylesheet1;
                            }
                            if (ui.css.hp_stylesheet2) {
                                ui.css.hp_stylesheet2.remove();
                                delete ui.css.hp_stylesheet2;
                            }
                            if (ui.css.hp_stylesheet3) {
                                ui.css.hp_stylesheet3.remove();
                                delete ui.css.hp_stylesheet3;
                            }
                            if (ui.css.hp_stylesheet4) {
                                ui.css.hp_stylesheet4.remove();
                                delete ui.css.hp_stylesheet4;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'hp_style1', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.hp_stylesheet1) {
                                            ui.css.hp_stylesheet1.remove();
                                        }
                                        ui.css.hp_stylesheet1 = lib.init.sheet('.hp:not(.text):not(.actcount)[data-condition="high"]>div:not(.lost){background-image:url(' + fileLoadedEvent.target.result + ')}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                                game.getDB('image', 'hp_style2', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.hp_stylesheet2) {
                                            ui.css.hp_stylesheet2.remove();
                                        }
                                        ui.css.hp_stylesheet2 = lib.init.sheet('.hp:not(.text):not(.actcount)[data-condition="mid"]>div:not(.lost){background-image:url(' + fileLoadedEvent.target.result + ')}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                                game.getDB('image', 'hp_style3', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.hp_stylesheet3) {
                                            ui.css.hp_stylesheet3.remove();
                                        }
                                        ui.css.hp_stylesheet3 = lib.init.sheet('.hp:not(.text):not(.actcount)[data-condition="low"]>div:not(.lost){background-image:url(' + fileLoadedEvent.target.result + ')}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                                game.getDB('image', 'hp_style4', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.hp_stylesheet4) {
                                            ui.css.hp_stylesheet4.remove();
                                        }
                                        ui.css.hp_stylesheet4 = lib.init.sheet('.hp:not(.text):not(.actcount)>.lost{background-image:url(' + fileLoadedEvent.target.result + ')}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        unfrequent: true,
                    },
                    player_style: {
                        name: '',
                        init: 'simple',
                        intro: '',
                        item: {
                            wood: '',
                            music: '',
                            simple: '',
                            custom: '',
                            default: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'player_style', file, function () {
                                        game.getDB('image', 'player_style', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.style.backgroundImage = 'url(' + data + ')';
                                                button.className = 'button character';
                                                button.style.backgroundSize = '100% 100%';
                                                node.classList.add('showdelete');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'player_style');
                                    button.style.backgroundImage = 'none';
                                    button.className = 'button character dashedmenubutton';
                                    node.classList.remove('showdelete');
                                    if (lib.config.player_style == 'custom') {
                                        lib.configMenu.appearence.config.player_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button character';
                            node.style.backgroundSize = '';
                            node.style.height = '108px';
                            switch (link) {
                                case 'default': case 'custom': {
                                    node.style.backgroundImage = 'none';
                                    node.className = 'button character dashedmenubutton';
                                    break;
                                }
                                case 'wood': node.setBackgroundImage('theme/woodden/wood.jpg'); break;
                                case 'music': node.style.backgroundImage = 'linear-gradient(#4b4b4b, #464646)'; break;
                                case 'simple': node.style.backgroundImage = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4))'; break;
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                game.getDB('image', 'player_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        node.style.backgroundImage = 'url(' + data + ')';
                                        node.className = 'button character';
                                        node.parentNode.lastChild.classList.add('showdelete');
                                        node.style.backgroundSize = '100% 100%';
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('player_style', layout);
                            if (ui.css.player_stylesheet) {
                                ui.css.player_stylesheet.remove();
                                delete ui.css.player_stylesheet;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'player_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.player_stylesheet) {
                                            ui.css.player_stylesheet.remove();
                                        }
                                        ui.css.player_stylesheet = lib.init.sheet('#window .player{background-image:url("' + fileLoadedEvent.target.result + '");background-size:100% 100%;}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                            else if (layout != 'default') {
                                var str = '';
                                switch (layout) {
                                    case 'wood': str = 'url("' + lib.assetURL + 'theme/woodden/wood.jpg")'; break;
                                    case 'music': str = 'linear-gradient(#4b4b4b, #464646)'; break;
                                    case 'simple': str = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4))'; break;
                                }
                                ui.css.player_stylesheet = lib.init.sheet('#window .player{background-image:' + str + '}');
                            }
                        },
                        unfrequent: true,
                    },
                    border_style: {
                        name: '',
                        init: 'default',
                        intro: '',
                        item: {
                            gold: '',
                            silver: '',
                            bronze: '',
                            dragon_gold: '',
                            dragon_silver: '',
                            dragon_bronze: '',
                            custom: '',
                            auto: '',
                            default: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'border_style', file, function () {
                                        game.getDB('image', 'border_style', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.style.backgroundImage = 'url(' + data + ')';
                                                button.className = 'button character';
                                                button.style.backgroundSize = '100% 100%';
                                                node.classList.add('showdelete');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'border_style');
                                    button.style.backgroundImage = 'none';
                                    button.className = 'button character dashedmenubutton';
                                    node.classList.remove('showdelete');
                                    if (lib.config.border_style == 'custom') {
                                        lib.configMenu.appearence.config.border_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button character';
                            node.style.backgroundSize = '';
                            node.style.height = '108px';
                            node.dataset.decoration = '';
                            if (link == 'default' || link == 'custom' || link == 'auto') {
                                node.style.backgroundImage = 'none';
                                node.className = 'button character dashedmenubutton';
                            }
                            else {
                                if (link.indexOf('dragon_') == 0) {
                                    link = link.slice(7);
                                    node.dataset.decoration = link;
                                }
                                node.setBackgroundImage('theme/style/player/' + link + '1.png');
                                node.style.backgroundSize = '100% 100%';
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                game.getDB('image', 'border_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        node.style.backgroundImage = 'url(' + data + ')';
                                        node.className = 'button character';
                                        node.parentNode.lastChild.classList.add('showdelete');
                                        node.style.backgroundSize = '100% 100%';
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('border_style', layout);
                            if (ui.css.border_stylesheet) {
                                ui.css.border_stylesheet.remove();
                                delete ui.css.border_stylesheet;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'border_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.border_stylesheet) {
                                            ui.css.border_stylesheet.remove();
                                        }
                                        ui.css.border_stylesheet = lib.init.sheet();
                                        ui.css.border_stylesheet.sheet.insertRule('#window .player>.framebg{display:block;background-image:url("' + fileLoadedEvent.target.result + '")}', 0);
                                        ui.css.border_stylesheet.sheet.insertRule('.player>.count{z-index: 3 !important;border-radius: 2px !important;text-align: center !important;}', 0);
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                            else if (layout != 'default' &amp;&amp; layout != 'auto') {
                                ui.css.border_stylesheet = lib.init.sheet();
                                if (layout.indexOf('dragon_') == 0) {
                                    layout = layout.slice(7);
                                    ui.arena.dataset.framedecoration = layout;
                                }
                                else {
                                    ui.arena.dataset.framedecoration = '';
                                }
                                ui.css.border_stylesheet.sheet.insertRule('#window .player>.framebg,#window #arena.long.mobile:not(.fewplayer) .player[data-position="0"]>.framebg{display:block;background-image:url("' + lib.assetURL + 'theme/style/player/' + layout + '1.png")}', 0);
                                ui.css.border_stylesheet.sheet.insertRule('#window #arena.long:not(.fewplayer) .player>.framebg, #arena.oldlayout .player>.framebg{background-image:url("' + lib.assetURL + 'theme/style/player/' + layout + '3.png")}', 0);
                                ui.css.border_stylesheet.sheet.insertRule('.player>.count{z-index: 3 !important;border-radius: 2px !important;text-align: center !important;}', 0);
                            }
                        },
                        unfrequent: true,
                    },
                    autoborder_count: {
                        name: '',
                        intro: '&lt;strong>&lt;/strong> &lt;br>&lt;strong>&lt;/strong> &lt;br>&lt;strong>&lt;/strong> ',
                        init: 'kill',
                        item: {
                            kill: '',
                            damage: '',
                            mix: '',
                        },
                        unfrequent: true,
                    },
                    autoborder_start: {
                        name: '',
                        init: 'bronze',
                        item: {
                            bronze: '',
                            silver: '',
                            gold: ''
                        },
                        unfrequent: true
                    },
                    player_border: {
                        name: '',
                        init: 'normal',
                        intro: '',
                        unfrequent: true,
                        item: {
                            slim: '',
                            narrow: '',
                            normal: '',
                            wide: ''
                        },
                        onclick: function (item) {
                            game.saveConfig('player_border', item);
                            if (item != 'wide' || game.layout == 'long' || game.layout == 'long2') {
                                ui.arena.classList.add('slim_player');
                            }
                            else {
                                ui.arena.classList.remove('slim_player');
                            }
                            if (item == 'slim') {
                                ui.arena.classList.add('uslim_player');
                            }
                            else {
                                ui.arena.classList.remove('uslim_player');
                            }
                            if (item == 'narrow') {
                                ui.arena.classList.add('mslim_player');
                            }
                            else {
                                ui.arena.classList.remove('mslim_player');
                            }
                            if (item == 'normal' &amp;&amp; lib.config.mode != 'brawl' &amp;&amp; (game.layout == 'long' || game.layout == 'long2')) {
                                ui.arena.classList.add('lslim_player');
                            }
                            else {
                                ui.arena.classList.remove('lslim_player');
                            }
                            ui.window.dataset.player_border = item;
                        }
                    },
                    menu_style: {
                        name: '',
                        init: 'default',
                        item: {
                            wood: '',
                            music: '',
                            simple: '',
                            custom: '',
                            default: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'menu_style', file, function () {
                                        game.getDB('image', 'menu_style', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.style.backgroundImage = 'url(' + data + ')';
                                                button.style.backgroundSize = 'cover';
                                                button.className = 'button character';
                                                node.classList.add('showdelete');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'menu_style');
                                    button.style.backgroundImage = 'none';
                                    button.style.backgroundSize = 'auto';
                                    button.className = 'button character dashedmenubutton';
                                    node.classList.remove('showdelete');
                                    if (lib.config.menu_style == 'custom') {
                                        lib.configMenu.appearence.config.menu_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button character';
                            node.style.backgroundSize = 'auto';
                            switch (link) {
                                case 'default': case 'custom': {
                                    node.style.backgroundImage = 'none';
                                    node.classList.add('dashedmenubutton');
                                    break;
                                }
                                case 'wood': node.setBackgroundImage('theme/woodden/wood2.png'); break;
                                case 'music': node.style.backgroundImage = 'linear-gradient(#4b4b4b, #464646)'; break;
                                case 'simple': node.style.backgroundImage = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4))'; break;
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                game.getDB('image', 'menu_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        node.style.backgroundImage = 'url(' + data + ')';
                                        node.style.backgroundSize = 'cover';
                                        node.className = 'button character';
                                        node.parentNode.lastChild.classList.add('showdelete');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('menu_style', layout);
                            if (ui.css.menu_stylesheet) {
                                ui.css.menu_stylesheet.remove();
                                delete ui.css.menu_stylesheet;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'menu_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.menu_stylesheet) {
                                            ui.css.menu_stylesheet.remove();
                                        }
                                        ui.css.menu_stylesheet = lib.init.sheet('html #window>.dialog.popped,html .menu,html .menubg{background-image:url("' + fileLoadedEvent.target.result + '");background-size:cover}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                            else if (layout != 'default') {
                                var str = '';
                                switch (layout) {
                                    case 'wood': str = 'url("' + lib.assetURL + 'theme/woodden/wood2.png")'; break;
                                    case 'music': str = 'linear-gradient(#4b4b4b, #464646);color:white;text-shadow:black 0 0 2px'; break;
                                    case 'simple': str = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4));color:white;text-shadow:black 0 0 2px'; break;
                                }
                                ui.css.menu_stylesheet = lib.init.sheet('html #window>.dialog.popped,html .menu,html .menubg{background-image:' + str + '}');
                            }
                        },
                        unfrequent: true,
                    },
                    control_style: {
                        name: '',
                        init: 'default',
                        item: {
                            wood: '',
                            music: '',
                            simple: '',
                            custom: '',
                            default: '',
                        },
                        visualBar: function (node, item, create, switcher) {
                            if (node.created) {
                                return;
                            }
                            var button;
                            for (var i = 0; i &lt; node.parentNode.childElementCount; i++) {
                                if (node.parentNode.childNodes[i]._link == 'custom') {
                                    button = node.parentNode.childNodes[i];
                                }
                            }
                            if (!button) {
                                return;
                            }
                            node.created = true;
                            var deletepic;
                            ui.create.filediv('.menubutton', '', node, function (file) {
                                if (file) {
                                    game.putDB('image', 'control_style', file, function () {
                                        game.getDB('image', 'control_style', function (fileToLoad) {
                                            if (!fileToLoad) return;
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                button.style.backgroundImage = 'url(' + data + ')';
                                                button.className = 'button character controlbutton';
                                                node.classList.add('showdelete');
                                            };
                                            fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                        });
                                    });
                                }
                            }).inputNode.accept = 'image/*';
                            deletepic = ui.create.div('.menubutton.deletebutton', '', node, function () {
                                if (confirm('')) {
                                    game.deleteDB('image', 'control_style');
                                    button.style.backgroundImage = 'none';
                                    button.className = 'button character controlbutton dashedmenubutton';
                                    node.classList.remove('showdelete');
                                    if (lib.config.control_style == 'custom') {
                                        lib.configMenu.appearence.config.control_style.onclick('default');
                                        switcher.lastChild.innerHTML = '';
                                    }
                                    button.classList.add('transparent');
                                }
                            });
                        },
                        visualMenu: function (node, link, name, config) {
                            node.className = 'button character controlbutton';
                            node.style.backgroundSize = '';
                            switch (link) {
                                case 'default': case 'custom': {
                                    node.style.backgroundImage = 'none';
                                    node.classList.add('dashedmenubutton');
                                    break;
                                }
                                case 'wood': node.setBackgroundImage('theme/woodden/wood.jpg'); break;
                                case 'music': node.style.backgroundImage = 'linear-gradient(#4b4b4b, #464646)'; break;
                                case 'simple': node.style.backgroundImage = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4))'; break;
                            }
                            if (link == 'custom') {
                                node.classList.add('transparent');
                                game.getDB('image', 'control_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        node.style.backgroundImage = 'url(' + data + ')';
                                        node.className = 'button character controlbutton';
                                        node.parentNode.lastChild.classList.add('showdelete');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                        },
                        onclick: function (layout) {
                            game.saveConfig('control_style', layout);
                            if (ui.css.control_stylesheet) {
                                ui.css.control_stylesheet.remove();
                                delete ui.css.control_stylesheet;
                            }
                            if (layout == 'custom') {
                                game.getDB('image', 'control_style', function (fileToLoad) {
                                    if (!fileToLoad) return;
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        if (ui.css.control_stylesheet) {
                                            ui.css.control_stylesheet.remove();
                                        }
                                        ui.css.control_stylesheet = lib.init.sheet('#window .control,.menubutton:not(.active):not(.highlight):not(.red):not(.blue),#window #system>div>div{background-image:url("' + fileLoadedEvent.target.result + '")}');
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                });
                            }
                            else if (layout != 'default') {
                                var str = '';
                                switch (layout) {
                                    case 'wood': str = 'url("' + lib.assetURL + 'theme/woodden/wood.jpg")'; break;
                                    case 'music': str = 'linear-gradient(#4b4b4b, #464646);color:white;text-shadow:black 0 0 2px'; break;
                                    case 'simple': str = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4));color:white;text-shadow:black 0 0 2px'; break;
                                }
                                if (layout == 'wood') {
                                    ui.css.control_stylesheet = lib.init.sheet('#window .control,#window .menubutton,#window #system>div>div,#window #system>div>.pressdown2{background-image:' + str + '}');
                                }
                                else {
                                    ui.css.control_stylesheet = lib.init.sheet('#window .control,.menubutton:not(.active):not(.highlight):not(.red):not(.blue),#window #system>div>div{background-image:' + str + '}');
                                }
                            }
                        },
                        unfrequent: true,
                    },
                    custom_button: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            if (bool !== 'skip') {
                                game.saveConfig('custom_button', bool);
                            }
                            if (ui.css.buttonsheet) {
                                ui.css.buttonsheet.remove();
                            }
                            if (lib.config.custom_button) {
                                var cbnum1 = 6 + (parseInt(lib.config.custom_button_system_top) || 0);
                                var cbnum2 = 6 + (parseInt(lib.config.custom_button_system_bottom) || 0);
                                var cbnum3 = 3 + (parseInt(lib.config.custom_button_control_top) || 0);
                                var cbnum4 = 3 + (parseInt(lib.config.custom_button_control_bottom) || 0);
                                var cbnum5 = 2;
                                var cbnum6 = 2;
                                if (cbnum3 &lt; 0) {
                                    cbnum5 += cbnum3;
                                    cbnum3 = 0;
                                }
                                if (cbnum4 &lt; 0) {
                                    cbnum6 += cbnum4;
                                    cbnum4 = 0;
                                }
                                ui.css.buttonsheet = lib.init.sheet(
                                    '#system>div>div, .caption>div>.tdnode{padding-top:' + cbnum1 + 'px !important;padding-bottom:' + cbnum2 + 'px !important}',
                                    '#control>.control>div{padding-top:' + cbnum3 + 'px;padding-bottom:' + cbnum4 + 'px}',
                                    '#control>.control{padding-top:' + cbnum5 + 'px;padding-bottom:' + cbnum6 + 'px}'
                                );
                            }
                        }
                    },
                    custom_button_system_top: {
                        name: '',
                        init: '0x',
                        item: {
                            '-5x': '-5px',
                            '-4x': '-4px',
                            '-3x': '-3px',
                            '-2x': '-2px',
                            '-1x': '-1px',
                            '0x': '',
                            '1x': '1px',
                            '2x': '2px',
                            '3x': '3px',
                            '4x': '4px',
                            '5x': '5px',
                        },
                        unfrequent: true,
                        onclick: function (item) {
                            game.saveConfig('custom_button_system_top', item);
                            lib.configMenu.appearence.config.custom_button.onclick('skip');
                        }
                    },
                    custom_button_system_bottom: {
                        name: '',
                        init: '0x',
                        item: {
                            '-5x': '-5px',
                            '-4x': '-4px',
                            '-3x': '-3px',
                            '-2x': '-2px',
                            '-1x': '-1px',
                            '0x': '',
                            '1x': '1px',
                            '2x': '2px',
                            '3x': '3px',
                            '4x': '4px',
                            '5x': '5px',
                        },
                        unfrequent: true,
                        onclick: function (item) {
                            game.saveConfig('custom_button_system_bottom', item);
                            lib.configMenu.appearence.config.custom_button.onclick('skip');
                        }
                    },
                    custom_button_control_top: {
                        name: '',
                        init: '0x',
                        item: {
                            '-5x': '-5px',
                            '-4x': '-4px',
                            '-3x': '-3px',
                            '-2x': '-2px',
                            '-1x': '-1px',
                            '0x': '',
                            '1x': '1px',
                            '2x': '2px',
                            '3x': '3px',
                            '4x': '4px',
                            '5x': '5px',
                        },
                        unfrequent: true,
                        onclick: function (item) {
                            game.saveConfig('custom_button_control_top', item);
                            lib.configMenu.appearence.config.custom_button.onclick('skip');
                        }
                    },
                    custom_button_control_bottom: {
                        name: '',
                        init: '0x',
                        item: {
                            '-5x': '-5px',
                            '-4x': '-4px',
                            '-3x': '-3px',
                            '-2x': '-2px',
                            '-1x': '-1px',
                            '0x': '',
                            '1x': '1px',
                            '2x': '2px',
                            '3x': '3px',
                            '4x': '4px',
                            '5x': '5px',
                        },
                        unfrequent: true,
                        onclick: function (item) {
                            game.saveConfig('custom_button_control_bottom', item);
                            lib.configMenu.appearence.config.custom_button.onclick('skip');
                        }
                    },
                    radius_size: {
                        name: '',
                        init: 'default',
                        item: {
                            off: '',
                            reduce: '',
                            default: '',
                            increase: '',
                        },
                        unfrequent: true,
                        onclick: function (item) {
                            game.saveConfig('radius_size', item);
                            ui.window.dataset.radius_size = item;
                        }
                    },
                    glow_phase: {
                        name: '',
                        unfrequent: true,
                        init: 'yellow',
                        intro: '',
                        item: {
                            none: '',
                            yellow: '',
                            green: '',
                            purple: '',
                        },
                        onclick: function (bool) {
                            game.saveConfig('glow_phase', bool);
                            lib.init.cssstyles();
                        }
                    },
                    fold_card: {
                        name: '',
                        init: true,
                        unfrequent: true,
                    },
                    fold_mode: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    seperate_control: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    blur_ui: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('blur_ui', bool);
                            if (bool) {
                                ui.window.classList.add('blur_ui');
                            }
                            else {
                                ui.window.classList.remove('blur_ui');
                            }
                        }
                    },
                    glass_ui: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('glass_ui', bool);
                            if (bool) {
                                ui.window.classList.add('glass_ui');
                            }
                            else {
                                ui.window.classList.remove('glass_ui');
                            }
                        }
                    },
                    damage_shake: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    button_press: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    jiu_effect: {
                        name: '',
                        init: true,
                        unfrequent: true,
                    },
                    animation: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                    },
                    skill_animation_type: {
                        name: '',
                        intro: '',
                        init: 'default',
                        unfrequent: true,
                        item: {
                            default: '',
                            old: '',
                            off: ''
                        }
                    },
                    die_move: {
                        name: '',
                        intro: '',
                        init: 'flip',
                        unfrequent: true,
                        item: {
                            off: '',
                            move: '',
                            flip: '',
                        }
                    },
                    target_shake: {
                        name: '',
                        intro: '',
                        init: 'off',
                        item: {
                            off: '',
                            zoom: '',
                            shake: '',
                        },
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('target_shake', bool);
                            ui.arena.dataset.target_shake = bool;
                        }
                    },
                    turned_style: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('turned_style', bool);
                            if (bool) {
                                ui.arena.classList.remove('hide_turned');
                            }
                            else {
                                ui.arena.classList.add('hide_turned');
                            }
                        }
                    },
                    link_style2: {
                        name: '',
                        intro: '',
                        init: 'chain',
                        unfrequent: true,
                        item: {
                            chain: '',
                            rotate: '',
                            mark: ''
                        },
                        onclick: function (style) {
                            var list = [];
                            for (var i = 0; i &lt; game.players.length; i++) {
                                if (game.players[i].isLinked()) {
                                    list.push(game.players[i]);
                                }
                            }
                            game.saveConfig('link_style2', style);
                            for (var i = 0; i &lt; list.length; i++) {
                                if (get.is.linked2(list[i])) {
                                    list[i].classList.add('linked2');
                                    list[i].classList.remove('linked');
                                }
                                else {
                                    list[i].classList.add('linked');
                                    list[i].classList.remove('linked2');
                                }
                            }
                            if (style == 'chain') {
                                ui.arena.classList.remove('nolink');
                            }
                            else {
                                ui.arena.classList.add('nolink');
                            }
                            ui.updatem();
                        }
                    },
                    cardshape: {
                        name: '',
                        intro: '',
                        init: 'default',
                        unfrequent: true,
                        item: {
                            default: '',
                            oblong: '',
                        },
                        onclick: function (item) {
                            var linked = false;
                            if (game.me &amp;&amp; game.me.isLinked()) {
                                linked = true;
                            }
                            game.saveConfig('cardshape', item);
                            if (item == 'oblong' &amp;&amp; (game.layout == 'long' || game.layout == 'mobile' || game.layout == 'long2' || game.layout == 'nova')) {
                                ui.arena.classList.add('oblongcard');
                                ui.window.classList.add('oblongcard');
                            }
                            else {
                                ui.arena.classList.remove('oblongcard');
                                ui.window.classList.remove('oblongcard');
                            }
                            if (linked) {
                                if (get.is.linked2(game.me)) {
                                    game.me.classList.remove('linked');
                                    game.me.classList.add('linked2');
                                }
                                else {
                                    game.me.classList.add('linked');
                                    game.me.classList.remove('linked2');
                                }
                            }
                        }
                    },
                    cardtempname: {
                        name: '',
                        intro: '',
                        init: 'default',
                        unfrequent: true,
                        item: {
                            default: '',
                            horizon: '',
                            off: '',
                        },
                        onclick: function (item) {
                            game.saveConfig('cardtempname', item);
                            if (!game.me || !game.me.getCards) return;
                            var hs = game.me.getCards('h');
                            for (var i = 0; i &lt; hs.length; i++) {
                                if (hs[i]._tempName) {
                                    switch (item) {
                                        case 'default':
                                            var node = hs[i]._tempName;
                                            node.innerHTML = get.verticalStr(node.tempname);
                                            break;
                                        case 'horizon':
                                            var node = hs[i]._tempName;
                                            node.innerHTML = node.tempname;
                                            break;
                                        default:
                                            hs[i]._tempName.delete();
                                            delete hs[i]._tempName;
                                    }
                                }
                            }
                        }
                    },
                    textequip: {
                        name: '',
                        init: 'image',
                        unfrequent: true,
                        item: {
                            image: '',
                            text: '',
                        },
                        onclick: function (item) {
                            game.saveConfig('textequip', item);
                            if (item == 'text' &amp;&amp; (game.layout == 'long' || game.layout == 'mobile')) {
                                ui.arena.classList.add('textequip');
                            }
                            else {
                                ui.arena.classList.remove('textequip');
                            }
                        }
                    },
                    buttoncharacter_style: {
                        name: '',
                        init: 'default',
                        item: {
                            default: '',
                            simple: '',
                            old: ''
                        },
                        unfrequent: true,
                    },
                    cursor_style: {
                        name: '',
                        init: 'auto',
                        intro: '',
                        unfrequent: true,
                        item: {
                            auto: '',
                            pointer: ''
                        },
                        onclick: function (item) {
                            game.saveConfig('cursor_style', item);
                            if (item == 'pointer') {
                                ui.window.classList.add('nopointer');
                            }
                            else {
                                ui.window.classList.remove('nopointer');
                            }
                        }
                    },
                    name_font: {
                        name: '',
                        init: 'LuoLiTi2',
                        unfrequent: true,
                        item: {},
                        textMenu: function (node, link) {
                            if (link != 'default') {
                                node.style.fontFamily = link;
                            }
                            node.style.fontSize = '20px';
                        },
                        onclick: function (font) {
                            game.saveConfig('name_font', font);
                            lib.init.cssstyles();
                        }
                    },
                    identity_font: {
                        name: '',
                        init: 'xingkai',
                        unfrequent: true,
                        item: {},
                        textMenu: function (node, link) {
                            if (link != 'default') {
                                node.style.fontFamily = link;
                            }
                            node.style.fontSize = '20px';
                        },
                        onclick: function (font) {
                            game.saveConfig('identity_font', font);
                            lib.init.cssstyles();
                        }
                    },
                    cardtext_font: {
                        name: '',
                        init: 'LuoLiTi2',
                        unfrequent: true,
                        item: {},
                        textMenu: function (node, link) {
                            if (link != 'default') {
                                node.style.fontFamily = link;
                            }
                            node.style.fontSize = '20px';
                        },
                        onclick: function (font) {
                            game.saveConfig('cardtext_font', font);
                            lib.init.cssstyles();
                        }
                    },
                    global_font: {
                        name: '',
                        init: 'default',
                        unfrequent: true,
                        item: {},
                        textMenu: function (node, link) {
                            if (link != 'default') {
                                node.style.fontFamily = link;
                            }
                            else {
                                node.style.fontFamily = "'STHeiti','SimHei','Microsoft JhengHei','Microsoft YaHei','WenQuanYi Micro Hei',Helvetica,Arial,sans-serif";
                            }
                            node.style.fontSize = '20px';
                        },
                        onclick: function (font) {
                            game.saveConfig('global_font', font);
                            lib.init.cssstyles();
                        }
                    },
                    update: function (config, map) {
                        if (lib.config.custom_button) {
                            map.custom_button_system_top.show();
                            map.custom_button_system_bottom.show();
                            map.custom_button_control_top.show();
                            map.custom_button_control_bottom.show();
                        }
                        else {
                            map.custom_button_system_top.hide();
                            map.custom_button_system_bottom.hide();
                            map.custom_button_control_top.hide();
                            map.custom_button_control_bottom.hide();
                        }
                        if (lib.config.change_skin) {
                            map.change_skin_auto.show();
                        }
                        else {
                            map.change_skin_auto.hide();
                        }
                        if (lib.config.image_background_random) {
                            map.image_background_blur.show();
                            map.image_background.hide();
                            // map.import_background.hide();
                        }
                        else {
                            map.image_background.show();
                            if (lib.config.image_background == 'default') {
                                map.image_background_blur.hide();
                            }
                            else {
                                map.image_background_blur.show();
                            }
                            // if(lib.config.image_background=='custom'&amp;&amp;lib.db){
                            //     map.import_background.show();
                            // }
                            // else{
                            //     map.import_background.hide();
                            // }
                        }
                        if (lib.config.layout == 'long' || lib.config.layout == 'mobile') {
                            map.textequip.show();
                            map.cardshape.show();
                            map.phonelayout.show();
                        }
                        else {
                            map.textequip.hide();
                            if (lib.config.layout == 'long2' || lib.config.layout == 'nova') {
                                map.phonelayout.show();
                                map.cardshape.show();
                            }
                            else {
                                map.phonelayout.hide();
                                map.cardshape.hide();
                            }
                        }
                        if (lib.config.layout == 'long') {
                            // map.fewplayer.show();
                            map.player_height.show();
                        }
                        else {
                            // map.fewplayer.hide();
                            if (lib.config.layout == 'long2') {
                                map.player_height.show();
                            }
                            else {
                                map.player_height.hide();
                            }
                        }
                        if (lib.config.layout == 'nova') {
                            map.player_height_nova.show();
                        }
                        else {
                            map.player_height_nova.hide();
                        }
                        if (lib.config.touchscreen) {
                            map.cursor_style.hide();
                        }
                        else {
                            map.cursor_style.show();
                        }
                        if (lib.config.border_style == 'auto') {
                            map.autoborder_count.show();
                            map.autoborder_start.show();
                        }
                        else {
                            map.autoborder_count.hide();
                            map.autoborder_start.hide();
                        }
                    },
                }
            },
            /**
             * 
             * @name configMenu.view
             * @type {!Object}
             */
            view: {
                name: '',
                config: {
                    update: function (config, map) {
                        if (['versus', 'chess', 'tafang', 'boss', 'richer'].contains(lib.config.mode)) {
                            map.show_handcardbutton.show();
                        }
                        else {
                            map.show_handcardbutton.hide();
                        }
                        if (lib.config.touchscreen) {
                            map.pop_logv.hide();
                        }
                        else {
                            map.pop_logv.show();
                        }
                        if (lib.device) {
                            if (lib.device == 'android') {
                                map.show_statusbar_android.show();
                                map.show_statusbar_ios.hide();
                            }
                            else if (lib.device == 'ios') {
                                map.show_statusbar_ios.show();
                                map.show_statusbar_android.hide();
                            }
                            if (!game.download) {
                                setTimeout(function () {
                                    if (!window.StatusBar) {
                                        map.show_statusbar.hide();
                                    }
                                }, 5000);
                            }
                        }
                        else {
                            map.show_statusbar_ios.hide();
                            map.show_statusbar_android.hide();
                        }
                        if (get.is.phoneLayout()) {
                            map.remember_round_button.show();
                            map.popequip.show();
                            map.filternode_button.show();
                            map.show_pause.hide();
                            map.show_auto.hide();
                            map.show_replay.hide();
                            map.show_round_menu.show();
                        }
                        else {
                            map.show_pause.show();
                            map.show_auto.show();
                            map.show_replay.show();
                            map.show_round_menu.hide();
                            map.remember_round_button.hide();
                            map.popequip.hide();
                            map.filternode_button.hide();
                        }
                        if (lib.config.show_card_prompt) {
                            map.hide_card_prompt_basic.show();
                            map.hide_card_prompt_equip.show();
                        }
                        else {
                            map.hide_card_prompt_basic.hide();
                            map.hide_card_prompt_equip.hide();
                        }
                        if (lib.config.show_log != 'off') {
                            map.clear_log.show();
                        }
                        else {
                            map.clear_log.hide();
                        }
                        if (get.is.phoneLayout()) {
                            map.show_time2.show();
                            map.show_time.hide();
                            if (lib.config.show_time2) {
                                map.watchface.show();
                            }
                            else {
                                map.watchface.hide();
                            }
                        }
                        else {
                            map.show_time2.hide();
                            map.show_time.show();
                            map.watchface.hide();
                        }
                        if (lib.config.show_extensionmaker) {
                            map.show_extensionshare.show();
                        }
                        else {
                            map.show_extensionshare.hide();
                        }
                    },
                    show_history: {
                        name: '',
                        init: 'off',
                        intro: '',
                        unfrequent: true,
                        item: {
                            off: '',
                            left: '',
                            right: '',
                        },
                        onclick: function (bool) {
                            if (lib.config.show_history == 'right') ui.window.animate('rightbar2');
                            game.saveConfig('show_history', bool);
                            if (_status.video || !_status.prepareArena) return;
                            if (bool == 'left') {
                                ui.window.classList.add('leftbar');
                                ui.window.classList.remove('rightbar');
                            }
                            else if (bool == 'right') {
                                ui.window.classList.remove('leftbar');
                                ui.window.classList.add('rightbar');
                            }
                            else {
                                ui.window.classList.remove('leftbar');
                                ui.window.classList.remove('rightbar');
                            }
                        }
                    },
                    pop_logv: {
                        name: '',
                        init: false,
                        unfrequent: true
                    },
                    show_log: {
                        name: '',
                        init: 'off',
                        intro: '',
                        unfrequent: true,
                        item: {
                            off: '',
                            left: '',
                            center: '',
                            right: '',
                        },
                        onclick: function (bool) {
                            game.saveConfig('show_log', bool);
                            if (lib.config.show_log != 'off') {
                                ui.arenalog.style.display = '';
                                ui.arenalog.dataset.position = bool;
                            }
                            else {
                                ui.arenalog.style.display = 'none';
                                ui.arenalog.innerHTML = '';
                            }
                        }
                    },
                    clear_log: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        intro: ''
                    },
                    log_highlight: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        intro: '',
                    },
                    show_time: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_time', bool);
                            if (bool) {
                                ui.time.style.display = '';
                            }
                            else {
                                ui.time.style.display = 'none';
                            }
                        }
                    },
                    show_time2: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_time2', bool);
                            if (bool) {
                                ui.roundmenu.classList.add('clock');
                            }
                            else {
                                ui.roundmenu.classList.remove('clock');
                            }
                        }
                    },
                    watchface: {
                        name: '',
                        init: 'none',
                        unfrequent: true,
                        item: {
                            none: '',
                            simple: '',
                        },
                        onclick: function (item) {
                            game.saveConfig('watchface', item);
                            ui.roundmenu.dataset.watchface = item;
                        }
                    },
                    show_time3: {
                        name: '',
                        init: false,
                        unfrequent: true
                    },
                    show_statusbar_android: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        content: function (bool) {
                            game.saveConfig('show_statusbar', bool);
                            if (window.StatusBar &amp;&amp; lib.device == 'android') {
                                if (bool) {
                                    window.StatusBar.overlaysWebView(false);
                                    window.StatusBar.backgroundColorByName('black');
                                    window.StatusBar.show();
                                }
                                else {
                                    window.StatusBar.hide();
                                }
                            }
                        }
                    },
                    show_statusbar_ios: {
                        name: '',
                        init: 'off',
                        unfrequent: true,
                        item: {
                            default: '',
                            overlay: '',
                            auto: '',
                            off: ''
                        },
                        onclick: function (bool) {
                            game.saveConfig('show_statusbar_ios', bool);
                            if (window.StatusBar &amp;&amp; lib.device == 'ios') {
                                if (bool != 'off' &amp;&amp; bool != 'auto') {
                                    if (lib.config.show_statusbar_ios == 'default') {
                                        window.StatusBar.overlaysWebView(false);
                                        document.body.classList.remove('statusbar');
                                    }
                                    else {
                                        window.StatusBar.overlaysWebView(true);
                                        document.body.classList.add('statusbar');
                                    }
                                    window.StatusBar.backgroundColorByName('black');
                                    window.StatusBar.show();
                                }
                                else {
                                    document.body.classList.remove('statusbar');
                                    window.StatusBar.hide();
                                }
                            }
                        }
                    },
                    show_card_prompt: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    hide_card_prompt_basic: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                    },
                    hide_card_prompt_equip: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                    },
                    show_phase_prompt: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    show_phaseuse_prompt: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    auto_popped_config: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    auto_popped_history: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                    },
                    show_round_menu: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            if (get.is.nomenu('show_round_menu', bool)) return false;
                            game.saveConfig('show_round_menu', bool);
                            if (bool &amp;&amp; ui.roundmenu) {
                                ui.roundmenu.style.display = '';
                            }
                            else {
                                ui.roundmenu.style.display = 'none';
                                alert('')
                            }
                        }
                    },
                    remember_round_button: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('remember_round_button', bool);
                            if (!bool) {
                                ui.click.resetround();
                            }
                        }
                    },
                    remember_dialog: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('remember_dialog', bool);
                            if (!bool) {
                                if (ui.dialog) {
                                    var dialog = ui.dialog;
                                    dialog.style.transform = '';
                                    dialog._dragtransform = [0, 0];
                                    dialog.style.transition = 'all 0.3s';
                                    dialog._dragtouches;
                                    dialog._dragorigin;
                                    dialog._dragorigintransform;
                                    setTimeout(function () {
                                        dialog.style.transition = '';
                                    }, 500);
                                }
                                game.saveConfig('dialog_transform', [0, 0]);
                            }
                        }
                    },
                    transparent_dialog: {
                        name: '',
                        init: false,
                        intro: 'static',
                        onclick: function (bool) {
                            game.saveConfig('transparent_dialog', bool);
                            if (bool) {
                                for (var i = 0; i &lt; ui.dialogs.length; i++) {
                                    if (ui.dialogs[i] != ui.dialog &amp;&amp; ui.dialogs[i].static) {
                                        ui.dialogs[i].unfocus();
                                    }
                                }
                            }
                            else {
                                for (var i = 0; i &lt; ui.dialogs.length; i++) {
                                    if (ui.dialogs[i] != ui.dialog &amp;&amp; ui.dialogs[i].static) {
                                        ui.dialogs[i].refocus();
                                    }
                                }
                            }
                        }
                    },
                    show_rarity: {
                        name: '',
                        init: false,
                        intro: '',
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_rarity', bool);
                        }
                    },
                    mark_identity_style: {
                        name: '',
                        intro: '',
                        unfrequent: true,
                        init: 'menu',
                        item: {
                            menu: '',
                            click: '',
                        },
                    },
                    character_dialog_tool: {
                        name: '',
                        intro: '',
                        init: '',
                        item: {
                            '': '',
                            '': '',
                            'all': ''
                        },
                        unfrequent: true,
                    },
                    recent_character_number: {
                        name: '',
                        intro: '',
                        init: '12',
                        item: {
                            '6': '6',
                            '12': '12',
                            '20': '24',
                            '30': '36',
                        },
                        unfrequent: true
                    },
                    popequip: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    filternode_button: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    show_charactercard: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true
                    },
                    show_favourite: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true
                    },
                    show_favmode: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true
                    },
                    show_favourite_menu: {
                        name: '',
                        intro: '-',
                        init: true,
                        unfrequent: true
                    },
                    show_ban_menu: {
                        name: '',
                        intro: '-',
                        init: true,
                        unfrequent: true
                    },
                    right_range: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true
                    },
                    replace_image: {
                        name: '',
                        intro: 'V',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('replace_image', bool);
                            if (bool) {
                                ui.arena.classList.remove('replace_image');
                            }
                            else {
                                ui.arena.classList.add('replace_image');
                            }
                        },
                    },
                    hide_card_image: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        restart: true,
                    },
                    show_name: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_name', bool);
                            if (bool) {
                                ui.arena.classList.remove('hide_name');
                            }
                            else {
                                ui.arena.classList.add('hide_name');
                            }
                        }
                    },
                    show_replay: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_replay', bool);
                            if (lib.config.show_replay) {
                                ui.replay.style.display = '';
                            }
                            else {
                                ui.replay.style.display = 'none';
                            }
                        }
                    },
                    show_playerids: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_playerids', bool);
                            if (lib.config.show_playerids) {
                                ui.playerids.style.display = '';
                            }
                            else {
                                ui.playerids.style.display = 'none';
                            }
                        }
                    },
                    show_sortcard: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_sortcard', bool);
                            if (lib.config.show_sortcard) {
                                ui.sortCard.style.display = '';
                            }
                            else {
                                ui.sortCard.style.display = 'none';
                            }
                        }
                    },
                    show_pause: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_pause', bool);
                            if (lib.config.show_pause) {
                                ui.pause.style.display = '';
                            }
                            else {
                                ui.pause.style.display = 'none';
                            }
                        }
                    },
                    show_auto: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_auto', bool);
                            if (lib.config.show_auto) {
                                ui.auto.style.display = '';
                            }
                            else {
                                ui.auto.style.display = 'none';
                            }
                        }
                    },
                    show_volumn: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_volumn', bool);
                            if (lib.config.show_volumn) {
                                ui.volumn.style.display = '';
                            }
                            else {
                                ui.volumn.style.display = 'none';
                            }
                        }
                    },
                    show_cardpile: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_cardpile', bool);
                            if (bool) {
                                ui.cardPileButton.style.display = '';
                            }
                            else {
                                ui.cardPileButton.style.display = 'none';
                            }
                        }
                    },
                    show_cardpile_number: {
                        name: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_cardpile_number', bool);
                            if (bool) {
                                ui.cardPileNumber.style.display = '';
                            }
                            else {
                                ui.cardPileNumber.style.display = 'none';
                            }
                        }
                    },
                    show_handcardbutton: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_handcardbutton', bool);
                        }
                    },
                    show_giveup: {
                        name: '',
                        init: true,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_giveup', bool);
                        }
                    },
                    show_wuxie: {
                        name: '',
                        intro: '',
                        init: false,
                        unfrequent: true,
                        onclick: function (bool) {
                            game.saveConfig('show_wuxie', bool);
                            if (lib.config.show_wuxie) {
                                ui.wuxie.style.display = '';
                            }
                            else {
                                ui.wuxie.style.display = 'none';
                            }
                        }
                    },
                    wuxie_right: {
                        name: '',
                        init: true,
                        unfrequent: true,
                    },
                    show_discardpile: {
                        name: '',
                        init: false,
                        unfrequent: true,
                    },
                    show_extensionmaker: {
                        name: '',
                        init: true,
                        unfrequent: true,
                    },
                    show_extensionshare: {
                        name: '',
                        init: true,
                        unfrequent: true,
                    }
                }
            },
            /**
             * 
             * @name configMenu.audio
             * @type {!Object}
             */
            audio: {
                name: '',
                config: {
                    update: function (config, map) {
                        if (lib.config.background_music == 'music_custom' &amp;&amp; (lib.device || lib.node)) {
                            map.import_music.show();
                        }
                        else {
                            map.import_music.hide();
                        }
                        map.clear_background_music[get.is.object(lib.config.customBackgroundMusic) ? 'show' : 'hide']();
                        ui.background_music_setting = map.background_music;
                        map.background_music._link.config.updatex.call(map.background_music, []);
                    },
                    background_music: {
                        updatex: function () {
                            this.lastChild.innerHTML = this._link.config.item[lib.config.background_music];
                            var menu = this._link.menu;
                            for (var i = 0; i &lt; menu.childElementCount; i++) {
                                if (!['music_off', 'music_custom', 'music_random'].concat(lib.config.all.background_music).contains(menu.childNodes[i]._link)) menu.childNodes[i].delete();
                            }
                        },
                        name: '',
                        init: true,
                        item: {
                            music_default: '',
                        },
                        onclick: function (item) {
                            game.saveConfig('background_music', item);
                            game.playBackgroundMusic();
                        }
                    },
                    import_music: {
                        name: '&lt;div style="white-space:nowrap;width:calc(100% - 5px)">' +
                            '&lt;input type="file" style="width:calc(100% - 40px)" accept="audio/*">' +
                            '&lt;button style="width:40px">&lt;/button>&lt;/div>',
                        clear: true,
                    },
                    background_audio: {
                        name: '',
                        init: true,
                    },
                    background_speak: {
                        name: '',
                        init: true,
                    },
                    equip_audio: {
                        name: '',
                        init: false,
                    },
                    repeat_audio: {
                        name: '',
                        init: false,
                    },
                    volumn_audio: {
                        name: '',
                        init: 8,
                        item: {
                            '0': '',
                            '1': '',
                            '2': '',
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': '',
                        },
                        onclick: function (volume) {
                            game.saveConfig('volumn_audio', parseInt(volume));
                        }
                    },
                    volumn_background: {
                        name: '',
                        init: 8,
                        item: {
                            '0': '',
                            '1': '',
                            '2': '',
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': '',
                        },
                        onclick: function (volume) {
                            game.saveConfig('volumn_background', parseInt(volume));
                            ui.backgroundMusic.volume = volume / 8;
                        }
                    },
                    clear_background_music: {
                        name: '',
                        clear: true,
                        onclick: function () {
                            if (confirm('')) {
                                for (var i in lib.config.customBackgroundMusic) {
                                    lib.config.all.background_music.remove(i);
                                    if (i.indexOf('cdv_') == 0) {
                                        game.removeFile('audio/background/' + i + '.mp3');
                                    }
                                    else {
                                        game.deleteDB('audio', i);
                                    }
                                }
                                lib.config.customBackgroundMusic = null;
                                game.saveConfig('customBackgroundMusic', null);
                                game.saveConfig('background_music', 'music_off');
                                if (!_status._aozhan) game.playBackgroundMusic();
                            }
                        },
                    },
                }
            },
            /**
             * (, )
             * @name configMenu.skill
             * @type {!Object}
             */
            skill: {
                name: '',
                config: {
                    update: function (config, map) {
                        for (var i in map) {
                            if (map[i]._link.config.type == 'autoskill') {
                                if (!lib.config.autoskilllist.contains(i)) {
                                    map[i].classList.add('on');
                                }
                                else {
                                    map[i].classList.remove('on');
                                }
                            }
                            else if (map[i]._link.config.type == 'banskill') {
                                if (!lib.config.forbidlist.contains(i)) {
                                    map[i].classList.add('on');
                                }
                                else {
                                    map[i].classList.remove('on');
                                }
                            }
                        }
                    }
                }
            },
            /**
             * 
             * @name configMenu.others
             * @type {!Object}
             */
            others: {
                name: '',
                config: {
                    // reset_database:{
                    //     name:'',
                    //     onclick:function(){
                    //         var node=this;
                    //         if(node._clearing){
                    //             if(indexedDB) indexedDB.deleteDatabase(lib.configprefix+'data');
                    //             game.reload();
                    //             return;
                    //         }
                    //         node._clearing=true;
                    //         node.innerHTML=' (3)';
                    //         setTimeout(function(){
                    //             node.innerHTML=' (2)';
                    //             setTimeout(function(){
                    //                 node.innerHTML=' (1)';
                    //                 setTimeout(function(){
                    //                     node.innerHTML='';
                    //                     delete node._clearing;
                    //                 },1000);
                    //             },1000);
                    //         },1000);
                    //     },
                    //     clear:true
                    // },
                    reset_game: {
                        name: '',
                        onclick: function () {
                            var node = this;
                            if (node._clearing) {
                                var noname_inited = localStorage.getItem('noname_inited');
                                var onlineKey = localStorage.getItem(lib.configprefix + 'key');
                                localStorage.clear();
                                if (noname_inited) {
                                    localStorage.setItem('noname_inited', noname_inited);
                                }
                                if (onlineKey) {
                                    localStorage.setItem(lib.configprefix + 'key', onlineKey);
                                }
                                game.deleteDB('config');
                                game.deleteDB('data');
                                game.reload();
                                return;
                            }
                            node._clearing = true;
                            node.firstChild.innerHTML = ' (3)';
                            setTimeout(function () {
                                node.firstChild.innerHTML = ' (2)';
                                setTimeout(function () {
                                    node.firstChild.innerHTML = ' (1)';
                                    setTimeout(function () {
                                        node.firstChild.innerHTML = '';
                                        delete node._clearing;
                                    }, 1000);
                                }, 1000);
                            }, 1000);
                        },
                        clear: true
                    },
                    reset_hiddenpack: {
                        name: '',
                        onclick: function () {
                            if (this.firstChild.innerHTML != '') {
                                this.firstChild.innerHTML = ''
                                game.saveConfig('hiddenModePack', []);
                                game.saveConfig('hiddenCharacterPack', []);
                                game.saveConfig('hiddenCardPack', []);
                                game.saveConfig('hiddenPlayPack', []);
                                game.saveConfig('hiddenBackgroundPack', []);
                                var that = this;
                                setTimeout(function () {
                                    that.firstChild.innerHTML = '';
                                    setTimeout(function () {
                                        if (confirm('')) {
                                            game.reload();
                                        }
                                    });
                                }, 500);
                            }
                        },
                        clear: true
                    },
                    reset_tutorial: {
                        name: '',
                        onclick: function () {
                            if (this.firstChild.innerHTML != '') {
                                this.firstChild.innerHTML = ''
                                game.saveConfig('new_tutorial', false);
                                game.saveConfig('prompt_hidebg');
                                game.saveConfig('prompt_hidepack');
                                var that = this;
                                setTimeout(function () {
                                    that.firstChild.innerHTML = '';
                                }, 500);
                            }
                        },
                        clear: true
                    },
                    import_data: {
                        name: '',
                        onclick: function () {
                            ui.import_data_button.classList.toggle('hidden');
                        },
                        clear: true
                    },
                    import_data_button: {
                        name: '&lt;div style="white-space:nowrap;width:calc(100% - 10px)">' +
                            '&lt;input type="file" style="width:calc(100% - 40px)">' +
                            '&lt;button style="width:40px">&lt;/button>&lt;/div>',
                        clear: true,
                    },
                    export_data: {
                        name: '',
                        onclick: function () {
                            var data;
                            var export_data = function (data) {
                                game.export(lib.init.encode(JSON.stringify(data)), ' -  - ' + (new Date()).toLocaleString());
                            }
                            if (!lib.db) {
                                data = {};
                                for (var i in localStorage) {
                                    if (i.indexOf(lib.configprefix) == 0) {
                                        data[i] = localStorage[i];
                                    }
                                }
                                export_data(data);
                            }
                            else {
                                game.getDB('config', null, function (data1) {
                                    game.getDB('data', null, function (data2) {
                                        export_data({
                                            config: data1,
                                            data: data2
                                        });
                                    });
                                });
                            }

                        },
                        clear: true
                    },
                    redownload_game: {
                        name: '',
                        onclick: function () {
                            var node = this;
                            if (node._clearing) {
                                localStorage.removeItem('noname_inited');
                                game.reload();
                                return;
                            }
                            node._clearing = true;
                            node.firstChild.innerHTML = ' (3)';
                            setTimeout(function () {
                                node.firstChild.innerHTML = ' (2)';
                                setTimeout(function () {
                                    node.firstChild.innerHTML = ' (1)';
                                    setTimeout(function () {
                                        node.firstChild.innerHTML = '';
                                        delete node._clearing;
                                    }, 1000);
                                }, 1000);
                            }, 1000);
                        },
                        clear: true
                    },
                    update: function (config, map) {
                        if (lib.device || lib.node) {
                            map.redownload_game.show();
                        }
                        else {
                            map.redownload_game.hide();
                        }
                    }
                    // trim_game:{
                    //     name:'',
                    //     onclick:function(){
                    //         if(this.innerHTML!=''){
                    //             this.innerHTML='';
                    //                               var pack=lib.config.all.cards.slice(0);
                    //                               if(Array.isArray(lib.config.hiddenCardPack)){
                    //                                            for(var i=0;i&lt;lib.config.hiddenCardPack.length;i++){
                    //                                                                  pack.add(lib.config.hiddenCardPack[i]);
                    //                                            }
                    //                               }
                    //                               for(var i=0;i&lt;pack.length;i++){
                    //                                            if(lib.config.all.sgscards.contains(pack[i])){
                    //                                                                  pack.splice(i--,1);
                    //                                            }
                    //                               }
                    //             game.saveConfig('hiddenCardPack',pack);
                    //
                    //                               var pack=lib.config.all.characters.slice(0);
                    //                               if(Array.isArray(lib.config.hiddenCharacterPack)){
                    //                                            for(var i=0;i&lt;lib.config.hiddenCharacterPack.length;i++){
                    //                                                                  pack.add(lib.config.hiddenCharacterPack[i]);
                    //                                            }
                    //                               }
                    //                               for(var i=0;i&lt;pack.length;i++){
                    //                                            if(lib.config.all.sgscharacters.contains(pack[i])){
                    //                                                                  pack.splice(i--,1);
                    //                                            }
                    //                               }
                    //             game.saveConfig('hiddenCharacterPack',pack);
                    //
                    //                               var pack=lib.config.all.mode.slice(0);
                    //                               if(Array.isArray(lib.config.hiddenModePack)){
                    //                                            for(var i=0;i&lt;lib.config.hiddenModePack.length;i++){
                    //                                                                  pack.add(lib.config.hiddenModePack[i]);
                    //                                            }
                    //                               }
                    //                               for(var i=0;i&lt;pack.length;i++){
                    //                                            if(lib.config.all.sgsmodes.contains(pack[i])){
                    //                                                                  pack.splice(i--,1);
                    //                                            }
                    //                               }
                    //             game.saveConfig('hiddenModePack',pack);
                    //
                    //             var that=this;
                    //             setTimeout(function(){
                    //                 that.innerHTML='';
                    //             },500);
                    //         }
                    //     },
                    //     clear:true
                    // }
                }
            }
        },
        /**
         * 
         * @name configMenu.extensionMenu
         */
        extensionMenu: {
            cardpile: {
                enable: {
                    name: '',
                    init: false,
                    restart: true,
                },
                intro: {
                    name: '',
                    clear: true,
                    nopointer: true,
                },
                sha: {
                    name: '',
                    init: '1',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                huosha: {
                    name: '',
                    init: '1',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                leisha: {
                    name: '',
                    init: '1',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                shan: {
                    name: '',
                    init: '1',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                tao: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                jiu: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                wuxie: {
                    name: '',
                    init: '0.5',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                nanman: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                wanjian: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                guohe: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                shunshou: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                tiesuo: {
                    name: '',
                    init: '0',
                    item: {
                        '1': '',
                        '0.5': '',
                        '0': ''
                    }
                },
                hide: {
                    name: '',
                    clear: true,
                    onclick: function () {
                        if (this.firstChild.innerHTML == '') {
                            this.firstChild.innerHTML = '';
                            lib.config.hiddenPlayPack.add('cardpile');
                            if (!lib.config.prompt_hidepack) {
                                alert('--');
                                game.saveConfig('prompt_hidepack', true);
                            }
                        }
                        else {
                            this.firstChild.innerHTML = '';
                            lib.config.hiddenPlayPack.remove('cardpile');
                        }
                        game.saveConfig('hiddenPlayPack', lib.config.hiddenPlayPack);
                    }
                },
            },
            // boss: {
            //     enable: {
            //         name: '',
            //         init: false,
            //         restart: true,
            //         onswitch: function (bool) {
            //             if (bool) {
            //                 var storage = { boss: {}, versus: {}, translate: {} };
            //                 var loadversus = function () {
            //                     game.loadModeAsync('versus', function (mode) {
            //                         for (var i in mode.translate) {
            //                             storage.translate[i] = mode.translate[i];
            //                         }
            //                         for (var i in mode.jiangeboss) {
            //                             if (mode.jiangeboss[i][4].contains('bossallowed')) {
            //                                 storage.versus[i] = mode.jiangeboss[i];
            //                             }
            //                         }
            //                         localStorage.setItem('boss_storage_playpackconfig', JSON.stringify(storage));
            //                     });
            //                 };
            //                 game.loadModeAsync('boss', function (mode) {
            //                     for (var i in mode.translate) {
            //                         storage.translate[i] = mode.translate[i];
            //                     }
            //                     for (var i in mode.characterPack.mode_boss) {
            //                         if (mode.characterPack.mode_boss[i][4].contains('bossallowed')) {
            //                             storage.boss[i] = mode.characterPack.mode_boss[i];
            //                         }
            //                     }
            //                     loadversus();
            //                 });
            //             }
            //             else {
            //                 localStorage.removeItem('boss_storage_playpackconfig');
            //             }
            //         }
            //     },
            //     intro: {
            //         name: '',
            //         clear: true,
            //         nopointer: true,
            //     },
            //     enableai: {
            //         name: '',
            //         init: false
            //     },
            //     hide: {
            //         name: '',
            //         clear: true,
            //         onclick: function () {
            //             if (this.firstChild.innerHTML == '') {
            //                 this.firstChild.innerHTML = '';
            //                 lib.config.hiddenPlayPack.add('boss');
            //                 if (!lib.config.prompt_hidepack) {
            //                     alert('--');
            //                     game.saveConfig('prompt_hidepack', true);
            //                 }
            //             }
            //             else {
            //                 this.firstChild.innerHTML = '';
            //                 lib.config.hiddenPlayPack.remove('boss');
            //             }
            //             game.saveConfig('hiddenPlayPack', lib.config.hiddenPlayPack);
            //         }
            //     },
            // },
            wuxing: {
                enable: {
                    name: '',
                    init: false,
                    restart: true,
                },
                intro: {
                    name: '',
                    clear: true,
                    nopointer: true,
                },
                num: {
                    name: '',
                    init: '0.3',
                    item: {
                        '0.1': '10%',
                        '0.2': '20%',
                        '0.3': '30%',
                        '0.5': '50%',
                    }
                },
                hide: {
                    name: '',
                    clear: true,
                    onclick: function () {
                        if (this.firstChild.innerHTML == '') {
                            this.firstChild.innerHTML = '';
                            lib.config.hiddenPlayPack.add('wuxing');
                            if (!lib.config.prompt_hidepack) {
                                alert('--');
                                game.saveConfig('prompt_hidepack', true);
                            }
                        }
                        else {
                            this.firstChild.innerHTML = '';
                            lib.config.hiddenPlayPack.remove('wuxing');
                        }
                        game.saveConfig('hiddenPlayPack', lib.config.hiddenPlayPack);
                    }
                },
            },
            coin: {
                enable: {
                    name: '',
                    init: false,
                    restart: true,
                    onclick: function (bool) {
                        if (bool) {
                            lib.config.plays.add('coin');
                        }
                        else {
                            lib.config.plays.remove('coin');
                        }
                        game.saveConfig('plays', lib.config.plays);
                    }
                },
                intro: {
                    name: '',
                    clear: true,
                    nopointer: true,
                },
                display: {
                    name: '',
                    init: 'text',
                    item: {
                        symbol: '',
                        text: ''
                    },
                    onclick: function (item) {
                        game.saveConfig('coin_display_playpackconfig', item);
                        if (game.changeCoin) game.changeCoin(0);
                    }
                },
                canvas: {
                    name: '',
                    init: false,
                    onclick: function (bool) {
                        game.saveConfig('coin_canvas_playpackconfig', bool);
                        if (bool) {
                            ui.window.classList.add('canvas_top');
                        }
                        else {
                            ui.window.classList.remove('canvas_top');
                        }
                    }
                },
                hide: {
                    name: '',
                    clear: true,
                    onclick: function () {
                        if (this.firstChild.innerHTML == '') {
                            this.firstChild.innerHTML = '';
                            lib.config.hiddenPlayPack.add('coin');
                            if (!lib.config.prompt_hidepack) {
                                alert('--');
                                game.saveConfig('prompt_hidepack', true);
                            }
                        }
                        else {
                            this.firstChild.innerHTML = '';
                            lib.config.hiddenPlayPack.remove('coin');
                        }
                        game.saveConfig('hiddenPlayPack', lib.config.hiddenPlayPack);
                    }
                },
            },
        },
        /**
         * 
         * @name configMenu.mode
         * @type {!Object}
         */
        mode: {
            //
            yindao: {
                name: '',
                config: {
                    update: function (config, map) {
                    },
                }
            },
            // richer: {
            //     name: '',
            //     connect: {
            //         connect_player_number: {
            //             name: '',
            //             init: '6',
            //             item: {
            //                 '2': '',
            //                 '3': '',
            //                 '4': '',
            //                 '5': '',
            //                 '6': '',
            //             },
            //             frequent: true,
            //             restart: true,
            //         },
            //         update: function (config, map) {
            //         },
            //         connect_show_range: {
            //             name: '',
            //             init: true,
            //         },
            //         // connect_show_distance:{
            //         // 	name:'',
            //         // 	init:true,
            //         // },
            //         connect_chessscroll_speed: {
            //             name: '',
            //             init: '20',
            //             intro: '',
            //             item: {
            //                 '0': '',
            //                 '10': '10/',
            //                 '20': '20/',
            //                 '30': '30/',
            //             }
            //         },
            //     },
            //     config: {
            //         player_number: {
            //             name: '',
            //             init: '6',
            //             item: {
            //                 '2': '',
            //                 '3': '',
            //                 '4': '',
            //                 '5': '',
            //                 '6': '',
            //             },
            //             frequent: true,
            //             restart: true,
            //         },
            //         update: function (config, map) {
            //             switch (config.player_number) {
            //                 case 4:
            //                 case 6: {
            //                     map.team_number.show();
            //                     break;
            //                 }
            //                 default: {
            //                     map.team_number.hide();
            //                     break;
            //                 }

            //             }
            //         },
            //         show_range: {
            //             name: '',
            //             init: true,
            //         },
            //         team_number: {
            //             name: '',
            //             init: '1',
            //             item: {
            //                 '1': '',
            //                 '2': '',
            //             },
            //             frequent: true,
            //             restart: true,
            //         },
            //         chessscroll_speed: {
            //             name: '',
            //             init: '20',
            //             intro: '',
            //             item: {
            //                 '0': '',
            //                 '10': '10/',
            //                 '20': '20/',
            //                 '30': '30/',
            //             }
            //         },
            //     }
            // },
            identity: {
                name: '',
                connect: {
                    update: function (config, map) {
                        if (config.connect_identity_mode == 'zhong') {
                            map.connect_change_choice.hide();
                            map.choice_ex.hide();
                            map.connect_player_number.hide();
                            map.connect_enhance_zhu.hide();
                            map.connect_double_nei.hide();
                            map.connect_zhong_card.show();
                            map.connect_special_identity.hide();
                            map.connect_double_character.show();
                        }
                        else if (config.connect_identity_mode == 'purple') {
                            map.connect_change_choice.hide();
                            map.choice_ex.hide();
                            map.connect_player_number.hide();
                            map.connect_enhance_zhu.hide();
                            map.connect_double_nei.hide();
                            map.connect_zhong_card.hide();
                            map.connect_special_identity.hide();
                            map.connect_double_character.hide();
                        }
                        else {
                            map.connect_change_choice.show();
                            map.choice_ex.show();
                            map.connect_double_character.show();
                            map.connect_player_number.show();
                            map.connect_enhance_zhu.show();
                            if (config.connect_player_number != '2') {
                                map.connect_double_nei.show();
                            }
                            else {
                                map.connect_double_nei.hide();
                            }
                            map.connect_zhong_card.hide();

                            if (config.connect_player_number == '8') {
                                map.connect_special_identity.show();
                            }
                            else {
                                map.connect_special_identity.hide();
                            }
                        }
                    },
                    connect_identity_mode: {
                        name: '',
                        init: 'normal',
                        item: {
                            normal: '',
                            zhong: '',
                            purple: '3v3v2',
                        },
                        restart: true,
                        frequent: true,
                        intro: '3v3v2'
                    },
                    connect_player_number: {
                        name: '',
                        init: '8',
                        item: {
                            '2': '',
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': ''
                        },
                        frequent: true,
                        restart: true,
                    },
                    connect_zhong_card: {
                        name: '',
                        init: true,
                        frequent: true,
                        restart: true
                    },
                    connect_double_nei: {
                        name: '',
                        init: false,
                        restart: true,
                        // frequent:true,
                        intro: '1v1'
                    },
                    connect_double_character: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    connect_change_card: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    connect_change_choice: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    connect_special_identity: {
                        name: '',
                        init: false,
                        restart: true,
                        frequent: true,
                        intro: ''
                    },
                    // connect_ban_weak:{
                    //     name:'',
                    //     init:true,
                    //     restart:true,
                    // },
                    // connect_ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                    connect_enhance_zhu: {
                        name: '',
                        init: false,
                        restart: true,
                        intro: ''
                    },
                    choice_ex: {
                        name: '',
                        init: '0',
                        restart: true,
                        item: {
                            '0': '',
                            '1': '',
                            '2': '',
                            '3': '',
                            '4': '',
                            '5': '',
                        },
                        intro: ''
                    },
                    card_remark: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                        intro: ''
                    }
                },
                config: {
                    update: function (config, map) {
                        if (config.identity_mode == 'zhong') {
                            map.player_number.hide();
                            map.enhance_zhu.hide();
                            map.double_nei.hide();
                            map.auto_identity.hide();
                            map.choice_ex.hide();
                            map.choice_zhu.hide();
                            map.choice_zhong.hide();
                            map.choice_nei.hide();
                            map.choice_fan.hide();
                            map.ban_identity.hide();
                            map.ban_identity2.hide();
                            map.ban_identity3.hide();
                            map.zhong_card.show();
                            map.special_identity.hide();
                            map.choose_group.show();
                            map.change_choice.show();
                            map.auto_mark_identity.show();
                            map.double_character.show();
                            map.free_choose.show();
                            map.change_identity.show();
                            if (config.double_character) {
                                map.double_hp.show();
                            }
                            else {
                                map.double_hp.hide();
                            }
                            map.continue_game.show();
                        }
                        else if (config.identity_mode == 'purple') {
                            map.player_number.hide();
                            map.enhance_zhu.hide();
                            map.double_nei.hide();
                            map.auto_identity.hide();
                            map.choice_ex.hide();
                            map.choice_zhu.hide();
                            map.choice_zhong.hide();
                            map.choice_nei.hide();
                            map.choice_fan.hide();
                            map.ban_identity.hide();
                            map.ban_identity2.hide();
                            map.ban_identity3.hide();
                            map.zhong_card.hide();
                            map.special_identity.hide();
                            map.double_character.hide();
                            map.double_hp.hide();
                            map.choose_group.hide();
                            map.auto_mark_identity.hide();
                            map.change_choice.hide();
                            map.free_choose.hide();
                            map.change_identity.hide();
                            map.continue_game.hide();
                        }
                        else {
                            map.continue_game.show();
                            map.player_number.show();
                            map.enhance_zhu.show();
                            map.auto_identity.show();
                            if (config.player_number != '2') {
                                map.double_nei.show();
                            }
                            else {
                                map.double_nei.hide();
                            }
                            map.choice_ex.show();
                            map.choice_zhu.show();
                            map.choice_zhong.show();
                            map.choice_nei.show();
                            map.choice_fan.show();
                            map.ban_identity.show();
                            if (config.ban_identity == 'off') {
                                map.ban_identity2.hide();
                            }
                            else {
                                map.ban_identity2.show();
                            }
                            if (config.ban_identity == 'off' || config.ban_identity2 == 'off') {
                                map.ban_identity3.hide();
                            }
                            else {
                                map.ban_identity3.show();
                            }
                            map.zhong_card.hide();
                            map.choose_group.show();
                            map.auto_mark_identity.show();
                            map.change_choice.show();
                            map.free_choose.show();
                            map.change_identity.show();
                            if (config.player_number == '8') {
                                map.special_identity.show();
                            }
                            else {
                                map.special_identity.hide();
                            }
                            map.double_character.show();
                            if (config.double_character) {
                                map.double_hp.show();
                            }
                            else {
                                map.double_hp.hide();
                            }
                        }
                    },
                    identity_mode: {
                        name: '',
                        init: 'normal',
                        item: {
                            normal: '',
                            zhong: '',
                            purple: '3v3v2',
                        },
                        restart: true,
                        frequent: true,
                        intro: ''
                    },
                    player_number: {
                        name: '',
                        init: '3',
                        item: {
                            '2': '',
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': ''
                        },
                        frequent: true,
                        restart: true,
                    },
                    double_nei: {
                        name: '',
                        init: false,
                        restart: true,
                        frequent: true,
                        intro: '1v1'
                    },
                    choose_group: {
                        name: '',
                        init: true,
                        restart: true,
                        frequent: true,
                        intro: ''
                    },
                    nei_fullscreenpop: {
                        name: '',
                        intro: '',
                        init: true,
                        unfrequent: true,
                    },
                    double_character: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    special_identity: {
                        name: '',
                        init: false,
                        restart: true,
                        frequent: true,
                        intro: ''
                    },
                    zhong_card: {
                        name: '',
                        init: true,
                        frequent: true,
                        restart: true
                    },
                    double_hp: {
                        name: '',
                        init: 'pingjun',
                        item: {
                            hejiansan: '',
                            pingjun: '',
                            zuidazhi: '',
                            zuixiaozhi: '',
                            zonghe: '',
                        },
                        restart: true,
                    },
                    auto_identity: {
                        name: '',
                        item: {
                            off: '',
                            one: '',
                            two: '',
                            three: '',
                            always: ''
                        },
                        init: 'off',
                        onclick: function (bool) {
                            game.saveConfig('auto_identity', bool, this._link.config.mode);
                            if (get.config('identity_mode') == 'zhong') return;
                            var num;
                            switch (bool) {
                                case '': num = 1; break;
                                case '': num = 2; break;
                                case '': num = 3; break;
                                default: num = 0; break;
                            }
                            if (num &amp; !_status.identityShown &amp;&amp; game.phaseNumber > game.players.length * num &amp;&amp; game.showIdentity) {
                                _status.identityShown = true;
                                game.showIdentity(false);
                            }
                        },
                        intro: '',
                    },
                    auto_mark_identity: {
                        name: '',
                        init: true,
                        intro: '',
                    },
                    // ban_weak:{
                    //     name:'',
                    //     init:true,
                    //     restart:true,
                    // },
                    // ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                    enhance_zhu: {
                        name: '',
                        init: false,
                        restart: true,
                        intro: ''
                    },
                    free_choose: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('free_choose', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat2 &amp;&amp; get.config('free_choose')) ui.create.cheat2();
                            else if (ui.cheat2 &amp;&amp; !get.config('free_choose')) {
                                ui.cheat2.close();
                                delete ui.cheat2;
                            }
                        }
                    },
                    change_identity: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_identity', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            var dialog;
                            if (ui.cheat2 &amp;&amp; ui.cheat2.backup) dialog = ui.cheat2.backup;
                            else dialog = _status.event.dialog;
                            if (!_status.brawl || !_status.brawl.noAddSetting) {
                                if (!dialog.querySelector('table') &amp;&amp; get.config('change_identity')) _status.event.getParent().addSetting(dialog);
                                else _status.event.getParent().removeSetting(dialog);
                            }
                            ui.update();
                        }
                    },
                    change_choice: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_choice', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat &amp;&amp; get.config('change_choice')) ui.create.cheat();
                            else if (ui.cheat &amp;&amp; !get.config('change_choice')) {
                                ui.cheat.close();
                                delete ui.cheat;
                            }
                        }
                    },
                    change_card: {
                        name: '',
                        init: 'disabled',
                        item: {
                            disabled: '',
                            once: '',
                            twice: '',
                            unlimited: '',
                        },
                    },
                    continue_game: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('continue_game', bool, this._link.config.mode);
                            if (get.config('continue_game')) {
                                if (!ui.continue_game &amp;&amp; _status.over &amp;&amp; !_status.brawl &amp;&amp; !game.no_continue_game) {
                                    ui.continue_game = ui.create.control('', game.reloadCurrent);
                                }
                            }
                            else if (ui.continue_game) {
                                ui.continue_game.close();
                                delete ui.continue_game;
                            }
                        },
                        intro: ''
                    },
                    dierestart: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('dierestart', bool, this._link.config.mode);
                            if (get.config('dierestart')) {
                                if (!ui.restart &amp;&amp; game.me.isDead() &amp;&amp; !_status.connectMode) {
                                    ui.restart = ui.create.control('restart', game.reload);
                                }
                            }
                            else if (ui.restart) {
                                ui.restart.close();
                                delete ui.restart;
                            }
                        }
                    },
                    revive: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('revive', bool, this._link.config.mode);
                            if (get.config('revive')) {
                                if (!ui.revive &amp;&amp; game.me.isDead()) {
                                    ui.revive = ui.create.control('revive', ui.click.dierevive);
                                }
                            }
                            else if (ui.revive) {
                                ui.revive.close();
                                delete ui.revive;
                            }
                        }
                    },
                    ban_identity: {
                        name: '',
                        init: 'off',
                        item: {
                            off: '',
                            zhu: '',
                            zhong: '',
                            nei: '',
                            fan: '',
                        },
                    },
                    ban_identity2: {
                        name: '2',
                        init: 'off',
                        item: {
                            off: '',
                            zhu: '',
                            zhong: '',
                            nei: '',
                            fan: '',
                        },
                    },
                    ban_identity3: {
                        name: '3',
                        init: 'off',
                        item: {
                            off: '',
                            zhu: '',
                            zhong: '',
                            nei: '',
                            fan: '',
                        },
                    },
                    ai_strategy: {
                        name: '',
                        init: 'ai_strategy_1',
                        item: {
                            ai_strategy_1: '',
                            ai_strategy_2: '',
                            ai_strategy_3: '',
                            ai_strategy_4: '',
                            ai_strategy_5: '',
                            ai_strategy_6: '',
                        },
                        intro: ''
                    },
                    difficulty: {
                        name: 'AI',
                        init: 'normal',
                        item: {
                            easy: '',
                            normal: '',
                            hard: '',
                        },
                    },
                    choice_ex: {
                        name: '',
                        init: '0',
                        restart: true,
                        item: {
                            '0': '',
                            '1': '',
                            '2': '',
                            '4': '',
                            '6': '',
                            '8': '',
                        },
                        intro: ''
                    },
                    choice_zhu: {
                        name: '',
                        init: '3',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                    choice_zhong: {
                        name: '',
                        init: '4',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                    choice_nei: {
                        name: '',
                        init: '5',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                    choice_fan: {
                        name: '',
                        init: '3',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                    card_remark: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                        intro: ''
                    }
                }
            },
            guozhan: {
                name: '',
                connect: {
                    update: function (config, map) {
                        if (config.connect_onlyguozhan) {
                            map.connect_junzhu.show();
                        }
                        else {
                            map.connect_junzhu.hide();
                        }
                    },
                    connect_guozhan_mode: {
                        name: '',
                        init: 'normal',
                        item: {
                            normal: '',
                            yingbian: '',
                            old: '',
                        },
                        frequent: true,
                        restart: true,
                        intro: '&lt;li>&lt;br>&lt;li>OL&lt;br>&lt;li>',
                    },
                    connect_player_number: {
                        name: '',
                        init: '8',
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': ''
                        },
                        frequent: true,
                        restart: true,
                    },
                    connect_initshow_draw: {
                        name: '',
                        item: {
                            'off': '',
                            'draw': '',
                            'mark': '',
                        },
                        init: 'mark',
                        frequent: true,
                        intro: ''
                    },
                    connect_aozhan: {
                        name: '',
                        init: true,
                        intro: '&lt;br>&lt;br>&lt;br>',
                        frequent: true,
                        restart: true,
                    },
                    connect_viewnext: {
                        name: '',
                        init: false,
                        intro: '',
                    },
                    connect_zhulian: {
                        name: '',
                        init: true,
                        // frequent:true,
                        intro: ''
                    },
                    connect_junzhu: {
                        name: '',
                        init: true,
                        // frequent:true,
                        restart: true,
                        intro: ''
                    },
                    connect_change_card: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    card_remark: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                        intro: ''
                    }
                    // connect_ban_weak:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                    // connect_ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                },
                config: {
                    update: function (config, map) {
                        if (config.onlyguozhan) {
                            map.junzhu.show();
                        }
                        else {
                            map.junzhu.hide();
                        }
                    },
                    guozhan_mode: {
                        name: '',
                        init: 'normal',
                        item: {
                            normal: '',
                            yingbian: '',
                            old: '',
                            free: '',
                        },
                        frequent: true,
                        restart: true,
                        intro: '&lt;li>&lt;br>&lt;li>OL&lt;br>&lt;li>&lt;br>&lt;li>',
                    },
                    player_number: {
                        name: '',
                        init: '8',
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': ''
                        },
                        frequent: true,
                        restart: true,
                    },
                    initshow_draw: {
                        name: '',
                        item: {
                            'off': '',
                            'draw': '',
                            'mark': '',
                        },
                        init: 'mark',
                        frequent: true,
                        intro: ''
                    },
                    aozhan: {
                        name: '',
                        init: true,
                        frequent: true,
                        restart: true,
                        intro: '&lt;br>&lt;br>&lt;br>',
                    },
                    viewnext: {
                        name: '',
                        init: false,
                        intro: '',
                    },
                    aozhan_bgm: {
                        name: '',
                        item: {
                            disabled: '',
                            online: 'Online',
                            rewrite: 'Rewrite',
                            chaoming: '',
                        },
                        init: 'rewrite',
                        onclick: function (item) {
                            game.saveConfig('aozhan_bgm', item, this._link.config.mode);
                            if (_status._aozhan == true) game.playBackgroundMusic();
                        },
                    },
                    zhulian: {
                        name: '',
                        init: true,
                        // frequent:true,
                        intro: ''
                    },
                    changeViceType: {
                        name: '',
                        init: 'default',
                        item: {
                            default: '',
                            online: '',
                        },
                        frequent: true,
                        restart: true,
                    },
                    onlyguozhan: {
                        name: '',
                        init: true,
                        frequent: true,
                        restart: true,
                        intro: ''
                    },
                    guozhanSkin: {
                        name: '',
                        init: true,
                        frequent: true,
                        restart: true,
                        intro: ''
                    },
                    junzhu: {
                        name: '',
                        init: true,
                        // frequent:true,
                        restart: true,
                        intro: ''
                    },
                    double_hp: {
                        name: '',
                        init: 'pingjun',
                        item: {
                            hejiansan: '',
                            pingjun: '',
                            zuidazhi: '',
                            zuixiaozhi: '',
                            zonghe: '',
                        },
                        restart: true,
                    },
                    // ban_weak:{
                    //     name:'',
                    //     init:true,
                    //     restart:true,
                    // },
                    // ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                    free_choose: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('free_choose', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat2 &amp;&amp; get.config('free_choose')) ui.create.cheat2();
                            else if (ui.cheat2 &amp;&amp; !get.config('free_choose')) {
                                ui.cheat2.close();
                                delete ui.cheat2;
                            }
                        }
                    },
                    onlyguozhanexpand: {
                        name: '',
                        init: false,
                        restart: true,
                        intro: ''
                    },
                    change_identity: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_identity', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            var dialog;
                            if (ui.cheat2 &amp;&amp; ui.cheat2.backup) dialog = ui.cheat2.backup;
                            else dialog = _status.event.dialog;
                            if (!_status.brawl || !_status.brawl.noAddSetting) {
                                if (!dialog.querySelector('table') &amp;&amp; get.config('change_identity')) _status.event.getParent().addSetting(dialog);
                                else _status.event.getParent().removeSetting(dialog);
                            }
                            ui.update();
                        }
                    },
                    change_choice: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_choice', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat &amp;&amp; get.config('change_choice')) ui.create.cheat();
                            else if (ui.cheat &amp;&amp; !get.config('change_choice')) {
                                ui.cheat.close();
                                delete ui.cheat;
                            }
                        }
                    },
                    change_card: {
                        name: '',
                        init: 'disabled',
                        item: {
                            disabled: '',
                            once: '',
                            twice: '',
                            unlimited: '',
                        }
                    },
                    continue_game: {
                        name: '',
                        init: true,
                        intro: '',
                        onclick: function (bool) {
                            game.saveConfig('continue_game', bool, this._link.config.mode);
                            if (get.config('continue_game')) {
                                if (!ui.continue_game &amp;&amp; _status.over &amp;&amp; !_status.brawl &amp;&amp; !game.no_continue_game) {
                                    ui.continue_game = ui.create.control('', game.reloadCurrent);
                                }
                            }
                            else if (ui.continue_game) {
                                ui.continue_game.close();
                                delete ui.continue_game;
                            }
                        }
                    },
                    dierestart: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('dierestart', bool, this._link.config.mode);
                            if (get.config('dierestart')) {
                                if (!ui.restart &amp;&amp; game.me.isDead() &amp;&amp; !_status.connectMode) {
                                    ui.restart = ui.create.control('restart', game.reload);
                                }
                            }
                            else if (ui.restart) {
                                ui.restart.close();
                                delete ui.restart;
                            }
                        }
                    },
                    revive: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('revive', bool, this._link.config.mode);
                            if (get.config('revive')) {
                                if (!ui.revive &amp;&amp; game.me.isDead()) {
                                    ui.revive = ui.create.control('revive', ui.click.dierevive);
                                }
                            }
                            else if (ui.revive) {
                                ui.revive.close();
                                delete ui.revive;
                            }
                        }
                    },
                    difficulty: {
                        name: 'AI',
                        init: 'normal',
                        item: {
                            easy: '',
                            normal: '',
                            hard: '',
                        }
                    },
                    choice_num: {
                        name: '',
                        init: '7',
                        restart: true,
                        item: {
                            '5': '',
                            '6': '',
                            '7': '',
                            '8': '',
                            '9': '',
                            '10': '',
                        }
                    },
                    card_remark: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                        intro: ''
                    }
                }
            },
            versus: {
                name: '',
                connect: {
                    update: function (config, map) {
                        if (config.connect_versus_mode == '1v1') {
                            map.connect_choice_num.show();
                            map.connect_replace_number.show();
                        }
                        else {
                            map.connect_choice_num.hide();
                            map.connect_replace_number.hide();
                        }
                        if (config.connect_versus_mode == '2v2' || config.connect_versus_mode == '3v3') {
                            map.connect_replace_handcard.show();
                        }
                        else {
                            map.connect_replace_handcard.hide();
                        }
                    },
                    connect_versus_mode: {
                        name: '',
                        init: '1v1',
                        item: {
                            '1v1': '1v1',
                            '2v2': '2v2',
                            '3v3': '3v3',
                            '4v4': '4v4',
                            //'guandu':'',
                        },
                        frequent: true
                    },
                    connect_replace_handcard: {
                        name: '',
                        init: true,
                        frequent: true,
                        intro: '+1'
                    },
                    connect_choice_num: {
                        name: '',
                        init: '20',
                        frequent: true,
                        item: {
                            '12': '12',
                            '16': '16',
                            '20': '20',
                            '24': '24',
                            '40': '40',
                        }
                    },
                    connect_replace_number: {
                        name: '',
                        init: '2',
                        frequent: true,
                        item: {
                            '0': '',
                            '1': '1',
                            '2': '2',
                            '3': '3',
                            '4': '4',
                            '5': '5',
                        }
                    },
                    // connect_ban_weak:{
                    //     name:'',
                    //     init:true,
                    //     restart:true,
                    // },
                    // connect_ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                },
                config: {
                    update: function (config, map) {
                        if (config.versus_mode == 'four') {
                            map.change_choice.hide();
                            map.ladder.show();
                            if (config.ladder) {
                                map.ladder_monthly.show();
                                map.ladder_reset.show();
                            }
                            else {
                                map.ladder_monthly.hide();
                                map.ladder_reset.hide();
                            }
                            map.enable_all.show();
                            map.enable_all_cards_four.show();
                            map.four_assign.show();
                            map.four_phaseswap.show();
                            map.expand_dialog.show();
                            map.fouralign.show();
                        }
                        else {
                            map.change_choice.show();
                            map.ladder.hide();
                            map.ladder_monthly.hide();
                            map.ladder_reset.hide();
                            map.enable_all.hide();
                            map.enable_all_cards_four.hide();
                            map.four_assign.hide();
                            map.four_phaseswap.hide();
                            map.expand_dialog.hide();
                            map.fouralign.hide();
                        }
                        if (config.versus_mode == 'three') {
                            map.edit_character_three.show();
                        }
                        else {
                            map.edit_character_three.hide();
                        }
                        if (config.versus_mode == 'three' || config.versus_mode == 'one') {
                            map.enable_all_three.show();
                            map.enable_all_cards.show();
                        }
                        else {
                            map.enable_all_three.hide();
                            map.enable_all_cards.hide();
                        }
                        if (config.versus_mode == 'jiange' || config.versus_mode == 'two' || config.versus_mode == 'endless' ||
                            config.versus_mode == 'three' || config.versus_mode == 'one' || config.versus_mode == 'siguo') {
                            map.free_choose.show();
                        }
                        else {
                            map.free_choose.hide();
                        }
                        if (config.versus_mode == 'jiange') {
                            map.double_character_jiange.show();
                        }
                        else {
                            map.double_character_jiange.hide();
                        }
                        if (config.versus_mode == 'two') {
                            map.replace_handcard_two.show();
                            map.replace_character_two.show();
                            map.two_assign.show();
                            map.two_phaseswap.show();
                        }
                        else {
                            map.replace_handcard_two.hide();
                            map.replace_character_two.hide();
                            map.two_assign.hide();
                            map.two_phaseswap.hide();
                        }
                        if (config.versus_mode == 'two' || config.versus_mode == 'siguo' || config.versus_mode == 'four') {
                            if (config.versus_mode == 'four' &amp;&amp; (config.four_assign || config.four_phaseswap)) {
                                map.change_identity.hide();
                            }
                            else {
                                map.change_identity.show();
                            }
                        }
                        else {
                            map.change_identity.hide();
                        }
                        if (config.versus_mode == 'siguo') {
                            map.siguo_character.show();
                        }
                        else {
                            map.siguo_character.hide();
                        }
                    },
                    versus_mode: {
                        name: '',
                        init: 'four',
                        item: {
                            four: '',
                            three: '',
                            two: '',
                            //guandu:'',
                            jiange: '',
                            siguo: '',
                            standard: ''
                            // endless:'',
                            // triple:'',
                            // one:'&lt;span style="display:inline-block;width:100%;text-align:center">1v1&lt;/span>',
                        },
                        restart: true,
                        frequent: true,
                    },
                    ladder: {
                        name: '',
                        init: true,
                        frequent: true,
                        restart: true
                    },
                    ladder_monthly: {
                        name: '',
                        init: true,
                        frequent: true,
                    },
                    enable_all: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    enable_all_cards_four: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    enable_all_three: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    enable_all_cards: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    four_assign: {
                        name: '',
                        init: false,
                        restart: true,
                    },
                    four_phaseswap: {
                        name: '',
                        init: false,
                        restart: true,
                    },
                    two_assign: {
                        name: '',
                        init: false,
                        restart: true,
                    },
                    two_phaseswap: {
                        name: '',
                        init: false,
                        restart: true,
                    },
                    free_choose: {
                        name: '',
                        init: true,
                        frequent: true,
                        onclick: function (bool) {
                            game.saveConfig('free_choose', bool, this._link.config.mode);
                            if (!ui.create.cheat2) return;
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat2 &amp;&amp; get.config('free_choose')) ui.create.cheat2();
                            else if (ui.cheat2 &amp;&amp; !get.config('free_choose')) {
                                ui.cheat2.close();
                                delete ui.cheat2;
                            }
                        }
                    },
                    fouralign: {
                        name: '',
                        init: false
                    },
                    change_identity: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_identity', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (_status.mode == 'four') {
                                if (get.config('four_assign') || get.config('four_phaseswap')) return;
                                if (bool) {
                                    if (_status.event.parent.addSetting) {
                                        _status.event.parent.addSetting();
                                    }
                                }
                                else {
                                    var seats = _status.event.parent.seatsbutton;
                                    if (seats) {
                                        while (seats.length) {
                                            seats.shift().remove();
                                        }
                                        delete _status.event.parent.seatsbutton;
                                    }
                                }
                            }
                            else {
                                var dialog;
                                if (ui.cheat2 &amp;&amp; ui.cheat2.backup) dialog = ui.cheat2.backup;
                                else dialog = _status.event.dialog;
                                if (!_status.brawl || !_status.brawl.noAddSetting) {
                                    if (!dialog.querySelector('table') &amp;&amp; get.config('change_identity')) _status.event.getParent().addSetting(dialog);
                                    else _status.event.getParent().removeSetting(dialog);
                                }
                                ui.update();
                            }
                        }
                    },
                    change_choice: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_choice', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat &amp;&amp; get.config('change_choice')) ui.create.cheat();
                            else if (ui.cheat &amp;&amp; !get.config('change_choice')) {
                                ui.cheat.close();
                                delete ui.cheat;
                            }
                        },
                        frequent: true,
                    },
                    double_character_jiange: {
                        name: '',
                        init: false,
                        frequent: true,
                    },
                    replace_handcard_two: {
                        name: '',
                        init: true,
                        frequent: true,
                        intro: '+1'
                    },
                    replace_character_two: {
                        name: '',
                        init: false,
                        frequent: true,
                        intro: ''
                    },
                    expand_dialog: {
                        name: '',
                        intro: '',
                        init: false,
                    },
                    siguo_character: {
                        name: '',
                        init: 'increase',
                        item: {
                            increase: '',
                            normal: '',
                            off: '',
                        },
                        frequent: true
                    },
                    // ban_weak:{
                    //     name:'',
                    //     init:true,
                    //     restart:true,
                    // },
                    // ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true
                    // },
                    ladder_reset: {
                        name: '',
                        onclick: function () {
                            var node = this;
                            if (node._clearing) {
                                game.save('ladder', {
                                    current: 900,
                                    top: 900,
                                    month: (new Date()).getMonth()
                                });
                                ui.ladder.innerHTML = '';
                                clearTimeout(node._clearing);
                                node.firstChild.innerHTML = '';
                                delete node._clearing;
                                return;
                            }
                            node.firstChild.innerHTML = ' (3)';
                            node._clearing = setTimeout(function () {
                                node.firstChild.innerHTML = ' (2)';
                                node._clearing = setTimeout(function () {
                                    node.firstChild.innerHTML = ' (1)';
                                    node._clearing = setTimeout(function () {
                                        node.firstChild.innerHTML = '';
                                        delete node._clearing;
                                    }, 1000);
                                }, 1000);
                            }, 1000);
                        },
                        clear: true,
                    },
                    edit_character_three: {
                        name: '',
                        clear: true,
                        onclick: function () {
                            if (get.mode() != 'versus') {
                                alert('');
                                return;
                            }
                            var container = ui.create.div('.popup-container.editor');
                            var editorpage = ui.create.div(container);
                            var discardConfig = ui.create.div('.editbutton', '', editorpage, function () {
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete(null);
                                delete window.saveNonameInput;
                            });
                            var node = container;
                            var map = get.config('character_three') || lib.choiceThree;
                            var str = 'character=[\n    ';
                            for (var i = 0; i &lt; map.length; i++) {
                                str += '"' + map[i] + '",';
                                if (i + 1 &lt; map.length &amp;&amp; (i + 1) % 5 == 0) str += '\n    ';
                            }
                            str += '\n];';
                            node.code = str;
                            ui.window.classList.add('shortcutpaused');
                            ui.window.classList.add('systempaused');
                            var saveInput = function () {
                                var code;
                                if (container.editor) {
                                    code = container.editor.getValue();
                                }
                                else if (container.textarea) {
                                    code = container.textarea.value;
                                }
                                try {
                                    var character = null;
                                    eval(code);
                                    if (!Array.isArray(character)) {
                                        throw ('err');
                                    }
                                }
                                catch (e) {
                                    alert('' + e + '');
                                    return;
                                }
                                game.saveConfig('character_three', character, 'versus');
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete();
                                container.code = code;
                                delete window.saveNonameInput;
                            };
                            window.saveNonameInput = saveInput;
                            var saveConfig = ui.create.div('.editbutton', '', editorpage, saveInput);
                            var editor = ui.create.div(editorpage);
                            if (node.aced) {
                                ui.window.appendChild(node);
                                node.editor.setValue(node.code, 1);
                            }
                            else if (lib.device == 'ios') {
                                ui.window.appendChild(node);
                                if (!node.textarea) {
                                    var textarea = document.createElement('textarea');
                                    editor.appendChild(textarea);
                                    node.textarea = textarea;
                                    lib.setScroll(textarea);
                                }
                                node.textarea.value = node.code;
                            }
                            else {
                                var aceReady = function () {
                                    ui.window.appendChild(node);
                                    var mirror = window.CodeMirror(editor, {
                                        value: node.code,
                                        mode: "javascript",
                                        lineWrapping: !lib.config.touchscreen &amp;&amp; lib.config.mousewheel,
                                        lineNumbers: true,
                                        indentUnit: 4,
                                        autoCloseBrackets: true,
                                        theme: 'mdn-like'
                                    });
                                    lib.setScroll(editor.querySelector('.CodeMirror-scroll'));
                                    node.aced = true;
                                    node.editor = mirror;
                                }
                                if (!window.ace) {
                                    lib.init.js(lib.assetURL + 'game', 'codemirror', aceReady);
                                    lib.init.css(lib.assetURL + 'layout/default', 'codemirror');
                                }
                                else {
                                    aceReady();
                                }
                            };
                        },
                    },
                    reset_character_three: {
                        name: '',
                        intro: '',
                        clear: true,
                        onclick: function () {
                            if (confirm('')) {
                                game.saveConfig('character_three', null, 'versus');
                                alert('');
                            }
                        },
                    },
                }
            },
            connect: {
                name: '',
                config: {
                    connect_nickname: {
                        name: '',
                        input: true,
                        frequent: true,
                    },
                    connect_avatar: {
                        name: '',
                        init: 'KizunaAI',
                        item: {},
                        frequent: true,
                        onclick: function (item) {
                            game.saveConfig('connect_avatar', item);
                            game.saveConfig('connect_avatar', item, 'connect');
                        }
                    },
                    hall_ip: {
                        name: '',
                        input: true,
                        frequent: true,
                    },
                    hall_button: {
                        name: '',
                        init: true,
                        frequent: true,
                        onclick: function (bool) {
                            game.saveConfig('hall_button', bool, 'connect');
                            if (ui.hall_button) {
                                if (bool) {
                                    ui.hall_button.style.display = '';
                                }
                                else {
                                    ui.hall_button.style.display = 'none';
                                }
                            }
                        }
                    },
                }
            },
            boss: {
                name: '',
                config: {
                    free_choose: {
                        name: '',
                        init: true,
                        frequent: true,
                        onclick: function (bool) {
                            game.saveConfig('free_choose', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat2 &amp;&amp; get.config('free_choose')) ui.create.cheat2();
                            else if (ui.cheat2 &amp;&amp; !get.config('free_choose')) {
                                ui.cheat2.close();
                                delete ui.cheat2;
                            }
                        }
                    },
                    change_choice: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_choice', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat &amp;&amp; get.config('change_choice')) ui.create.cheat();
                            else if (ui.cheat &amp;&amp; !get.config('change_choice')) {
                                ui.cheat.close();
                                delete ui.cheat;
                            }
                        },
                        frequent: true,
                    },
                    single_control: {
                        name: '',
                        init: true,
                        frequent: true,
                        onclick: function (bool) {
                            game.saveConfig('single_control', bool, this._link.config.mode);
                            if (ui.single_swap &amp;&amp; game.me != game.boss) {
                                if (bool) {
                                    ui.single_swap.style.display = 'none';
                                }
                                else {
                                    ui.single_swap.style.display = '';
                                }
                            }
                        },
                        intro: 'AI'
                    },
                    // ban_weak:{
                    //     name:'',
                    //     init:true,
                    //     restart:true,
                    // },
                    // ban_strong:{
                    //     name:'',
                    //     init:false,
                    //     restart:true,
                    // },
                }
            },
            doudizhu: {
                name: '',
                connect: {
                    update: function (config, map) {
                        if (config.connect_doudizhu_mode == 'online') {
                            map.connect_change_card.hide();
                        }
                        else {
                            map.connect_change_card.show();
                        }
                        if (config.connect_doudizhu_mode != 'normal') {
                            map.connect_double_character.hide();
                        }
                        else {
                            map.connect_double_character.show();
                        }
                    },
                    connect_doudizhu_mode: {
                        name: '',
                        init: 'normal',
                        item: {
                            normal: '',
                            kaihei: '',
                            huanle: '',
                            binglin: '',
                            online: '',
                        },
                        restart: true,
                        frequent: true,
                    },
                    connect_double_character: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    connect_change_card: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                },
                config: {
                    update: function (config, map) {
                        if (config.doudizhu_mode == 'online') {
                            map.change_card.hide();
                            map.edit_character.show();
                            map.reset_character.show();
                        }
                        else {
                            map.change_card.show();
                            map.edit_character.hide();
                            map.reset_character.hide();
                        }
                        if (config.doudizhu_mode != 'normal') {
                            map.double_character.hide();
                            map.free_choose.hide();
                            map.change_identity.hide();
                            map.change_choice.hide();
                            map.continue_game.hide();
                            map.dierestart.hide();
                            map.choice_zhu.hide();
                            map.choice_fan.hide();
                            map.revive.hide();
                        }
                        else {
                            map.double_character.show();
                            map.free_choose.show();
                            map.change_identity.show();
                            map.change_choice.show();
                            map.continue_game.show();
                            map.dierestart.show();
                            map.choice_zhu.show();
                            map.choice_fan.show();
                            map.revive.show();
                        }
                        if (config.double_character &amp;&amp; config.doudizhu_mode == 'normal') {
                            map.double_hp.show();
                        }
                        else {
                            map.double_hp.hide();
                        }
                    },
                    doudizhu_mode: {
                        name: '',
                        init: 'normal',
                        item: {
                            normal: '',
                            kaihei: '',
                            huanle: '',
                            binglin: '',
                            online: '',
                        },
                        restart: true,
                        frequent: true,
                    },
                    double_character: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    double_hp: {
                        name: '',
                        init: 'pingjun',
                        item: {
                            hejiansan: '',
                            pingjun: '',
                            zuidazhi: '',
                            zuixiaozhi: '',
                            zonghe: '',
                        },
                        restart: true,
                    },
                    free_choose: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('free_choose', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat2 &amp;&amp; get.config('free_choose')) ui.create.cheat2();
                            else if (ui.cheat2 &amp;&amp; !get.config('free_choose')) {
                                ui.cheat2.close();
                                delete ui.cheat2;
                            }
                        }
                    },
                    change_identity: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_identity', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            var dialog;
                            if (ui.cheat2 &amp;&amp; ui.cheat2.backup) dialog = ui.cheat2.backup;
                            else dialog = _status.event.dialog;
                            if (!_status.brawl || !_status.brawl.noAddSetting) {
                                if (!dialog.querySelector('table') &amp;&amp; get.config('change_identity')) _status.event.getParent().addSetting(dialog);
                                else _status.event.getParent().removeSetting(dialog);
                            }
                            ui.update();
                        }
                    },
                    change_choice: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_choice', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat &amp;&amp; get.config('change_choice')) ui.create.cheat();
                            else if (ui.cheat &amp;&amp; !get.config('change_choice')) {
                                ui.cheat.close();
                                delete ui.cheat;
                            }
                        }
                    },
                    change_card: {
                        name: '',
                        init: 'disabled',
                        item: {
                            disabled: '',
                            once: '',
                            twice: '',
                            unlimited: '',
                        },
                    },
                    continue_game: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('continue_game', bool, this._link.config.mode);
                            if (get.config('continue_game')) {
                                if (!ui.continue_game &amp;&amp; _status.over &amp;&amp; !_status.brawl &amp;&amp; !game.no_continue_game) {
                                    ui.continue_game = ui.create.control('', game.reloadCurrent);
                                }
                            }
                            else if (ui.continue_game) {
                                ui.continue_game.close();
                                delete ui.continue_game;
                            }
                        },
                        intro: ''
                    },
                    dierestart: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('dierestart', bool, this._link.config.mode);
                            if (get.config('dierestart')) {
                                if (!ui.restart &amp;&amp; game.me.isDead() &amp;&amp; !_status.connectMode) {
                                    ui.restart = ui.create.control('restart', game.reload);
                                }
                            }
                            else if (ui.restart) {
                                ui.restart.close();
                                delete ui.restart;
                            }
                        }
                    },
                    revive: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('revive', bool, this._link.config.mode);
                            if (get.config('revive')) {
                                if (!ui.revive &amp;&amp; game.me.isDead()) {
                                    ui.revive = ui.create.control('revive', ui.click.dierevive);
                                }
                            }
                            else if (ui.revive) {
                                ui.revive.close();
                                delete ui.revive;
                            }
                        }
                    },
                    choice_zhu: {
                        name: '',
                        init: '3',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                    choice_fan: {
                        name: '',
                        init: '3',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                    edit_character: {
                        name: '',
                        clear: true,
                        onclick: function () {
                            if (get.mode() != 'doudizhu') {
                                alert('');
                                return;
                            }
                            var container = ui.create.div('.popup-container.editor');
                            var editorpage = ui.create.div(container);
                            var discardConfig = ui.create.div('.editbutton', '', editorpage, function () {
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete(null);
                                delete window.saveNonameInput;
                            });
                            var node = container;
                            var map = get.config('character_online') || lib.characterOnline;
                            node.code = 'character=' + get.stringify(map) + '\n/*\n    \n    \n    Key\n    Key\n    /\n    \n*/';
                            ui.window.classList.add('shortcutpaused');
                            ui.window.classList.add('systempaused');
                            var saveInput = function () {
                                var code;
                                if (container.editor) {
                                    code = container.editor.getValue();
                                }
                                else if (container.textarea) {
                                    code = container.textarea.value;
                                }
                                try {
                                    var character = null;
                                    eval(code);
                                    if (!get.is.object(character)) {
                                        throw ('err');
                                    }
                                    var groups = [];
                                    for (var i in character) {
                                        if (!Array.isArray(character[i])) throw ('type');
                                        if (character[i].length >= 3) groups.push(i);
                                    }
                                    if (groups.length &lt; 3) throw ('enough');
                                }
                                catch (e) {
                                    if (e == 'type') {
                                        alert('');
                                    }
                                    else if (e == 'enough') {
                                        alert('33');
                                    }
                                    else if (e == 'err') {
                                        alert('');
                                    }
                                    else {
                                        alert('' + e + '')
                                    }
                                    return;
                                }
                                game.saveConfig('character_online', character, 'doudizhu');
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete();
                                container.code = code;
                                delete window.saveNonameInput;
                            };
                            window.saveNonameInput = saveInput;
                            var saveConfig = ui.create.div('.editbutton', '', editorpage, saveInput);
                            var editor = ui.create.div(editorpage);
                            if (node.aced) {
                                ui.window.appendChild(node);
                                node.editor.setValue(node.code, 1);
                            }
                            else if (lib.device == 'ios') {
                                ui.window.appendChild(node);
                                if (!node.textarea) {
                                    var textarea = document.createElement('textarea');
                                    editor.appendChild(textarea);
                                    node.textarea = textarea;
                                    lib.setScroll(textarea);
                                }
                                node.textarea.value = node.code;
                            }
                            else {
                                var aceReady = function () {
                                    ui.window.appendChild(node);
                                    var mirror = window.CodeMirror(editor, {
                                        value: node.code,
                                        mode: "javascript",
                                        lineWrapping: !lib.config.touchscreen &amp;&amp; lib.config.mousewheel,
                                        lineNumbers: true,
                                        indentUnit: 4,
                                        autoCloseBrackets: true,
                                        theme: 'mdn-like'
                                    });
                                    lib.setScroll(editor.querySelector('.CodeMirror-scroll'));
                                    node.aced = true;
                                    node.editor = mirror;
                                }
                                if (!window.ace) {
                                    lib.init.js(lib.assetURL + 'game', 'codemirror', aceReady);
                                    lib.init.css(lib.assetURL + 'layout/default', 'codemirror');
                                }
                                else {
                                    aceReady();
                                }
                            };
                        },
                    },
                    reset_character: {
                        name: '',
                        intro: '',
                        clear: true,
                        onclick: function () {
                            if (confirm('')) {
                                game.saveConfig('character_online', null, 'doudizhu');
                                alert('');
                            }
                        },
                    },
                }
            },
            longlaoguan: {
                name: '',
                connect: {
                    update: function (config, map) { },
                    connect_change_card: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                },
                config: {
                    update: function (config, map) {
                        if (config.double_character) {
                            map.double_hp.show();
                        }
                        else {
                            map.double_hp.hide();
                        }
                    },
                    double_character: {
                        name: '',
                        init: false,
                        frequent: true,
                        restart: true,
                    },
                    double_hp: {
                        name: '',
                        init: 'pingjun',
                        item: {
                            hejiansan: '',
                            pingjun: '',
                            zuidazhi: '',
                            zuixiaozhi: '',
                            zonghe: '',
                        },
                        restart: true,
                    },
                    free_choose: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('free_choose', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat2 &amp;&amp; get.config('free_choose')) ui.create.cheat2();
                            else if (ui.cheat2 &amp;&amp; !get.config('free_choose')) {
                                ui.cheat2.close();
                                delete ui.cheat2;
                            }
                        }
                    },
                    change_identity: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_identity', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            var dialog;
                            if (ui.cheat2 &amp;&amp; ui.cheat2.backup) dialog = ui.cheat2.backup;
                            else dialog = _status.event.dialog;
                            if (!_status.brawl || !_status.brawl.noAddSetting) {
                                if (!dialog.querySelector('table') &amp;&amp; get.config('change_identity')) _status.event.getParent().addSetting(dialog);
                                else _status.event.getParent().removeSetting(dialog);
                            }
                            ui.update();
                        }
                    },
                    change_choice: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('change_choice', bool, this._link.config.mode);
                            if (!_status.event.getParent().showConfig &amp;&amp; !_status.event.showConfig) return;
                            if (!ui.cheat &amp;&amp; get.config('change_choice')) ui.create.cheat();
                            else if (ui.cheat &amp;&amp; !get.config('change_choice')) {
                                ui.cheat.close();
                                delete ui.cheat;
                            }
                        }
                    },
                    change_card: {
                        name: '',
                        init: 'disabled',
                        item: {
                            disabled: '',
                            once: '',
                            twice: '',
                            unlimited: '',
                        },
                    },
                    continue_game: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('continue_game', bool, this._link.config.mode);
                            if (get.config('continue_game')) {
                                if (!ui.continue_game &amp;&amp; _status.over &amp;&amp; !_status.brawl) {
                                    ui.continue_game = ui.create.control('', game.reloadCurrent);
                                }
                            }
                            else if (ui.continue_game) {
                                ui.continue_game.close();
                                delete ui.continue_game;
                            }
                        },
                        intro: ''
                    },
                    dierestart: {
                        name: '',
                        init: true,
                        onclick: function (bool) {
                            game.saveConfig('dierestart', bool, this._link.config.mode);
                            if (get.config('dierestart')) {
                                if (!ui.restart &amp;&amp; game.me.isDead() &amp;&amp; !_status.connectMode) {
                                    ui.restart = ui.create.control('restart', game.reload);
                                }
                            }
                            else if (ui.restart) {
                                ui.restart.close();
                                delete ui.restart;
                            }
                        }
                    },
                    revive: {
                        name: '',
                        init: false,
                        onclick: function (bool) {
                            game.saveConfig('revive', bool, this._link.config.mode);
                            if (get.config('revive')) {
                                if (!ui.revive &amp;&amp; game.me.isDead()) {
                                    ui.revive = ui.create.control('revive', ui.click.dierevive);
                                }
                            }
                            else if (ui.revive) {
                                ui.revive.close();
                                delete ui.revive;
                            }
                        }
                    },
                    choice_zhu: {
                        name: '',
                        init: '1',
                        restart: true,
                        item: {
                            '1': '',
                        },
                    },
                    choice_fan: {
                        name: '',
                        init: '5',
                        restart: true,
                        item: {
                            '3': '',
                            '4': '',
                            '5': '',
                            '6': '',
                            '8': '',
                            '10': '',
                        },
                    },
                }
            },
            single: {
                name: '',
                connect: {
                    connect_single_mode: {
                        name: '',
                        init: 'dianjiang',
                        item: {
                            dianjiang: '',
                            // normal:'1v1',
                            // changban:'',
                        },
                        restart: true,
                        frequent: true,
                    },
                    connect_enable_jin: {
                        name: '',
                        init: false,
                        restart: true,
                        frequent: true,
                    },
                    update: function (config, map) {
                        if (config.connect_single_mode != 'normal') {
                            map.connect_enable_jin.hide();
                        }
                        else {
                            map.connect_enable_jin.show();
                        }
                    },
                },
                config: {
                    single_mode: {
                        name: '',
                        init: 'dianjiang',
                        item: {
                            dianjiang: '',
                            // normal:'1v1',
                            // changban:'',
                        },
                        restart: true,
                        frequent: true,
                    },
                    enable_jin: {
                        name: '',
                        init: false,
                        restart: true,
                        frequent: true,
                    },
                    update: function (config, map) {
                        if (config.single_mode != 'normal') {
                            map.enable_jin.hide();
                        }
                        else {
                            map.enable_jin.show();
                        }
                    },
                }
            },
            brawl: {
                name: '',
                config: {
                    huanhuazhizhan: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    qunxionggeju: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    duzhansanguo: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    daoshiyueying: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    weiwoduzun: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    tongxingzhizheng: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    jiazuzhizheng: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    // tongqueduopao:{
                    // 	name:'',
                    // 	init:true,
                    // 	frequent:true
                    // },
                    tongjiangmoshi: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    // baiyidujiang:{
                    // 	name:'',
                    // 	init:true,
                    // 	frequent:true
                    // },
                    qianlidanji: {
                        name: '',
                        init: true,
                        frequent: true
                    },
                    // liangjunduilei:{
                    // 	name:'',
                    // 	init:true,
                    // 	frequent:true
                    // },
                    scene: {
                        name: '',
                        init: true,
                        frequent: true
                    }
                }
            },
        },
        /**
         * libdelayedvideoId
         * @type {!Object}
         */
        status: {
            running: false,
            canvas: false,
            time: 0,
            reload: 0,
            delayed: 0,
            frameId: 0,
            videoId: 0,
            globalId: 0,
        },
        /**
         * 
         * @type {!Object}
         */
        help: {
            'FAQ': '&lt;ul>&lt;li>Q&lt;li>A&lt;br>' +
                '&lt;li>Q&lt;li>AMEA&lt;br>' +
                '&lt;li>Qlulu&lt;li>Alulu&lt;br>',

            '': '&lt;ul>&lt;li>//&lt;li>&lt;li>&lt;br>' +
                '&lt;table>&lt;tr>&lt;td>A&lt;td>&lt;tr>&lt;td>W&lt;td>&lt;tr>&lt;td>&lt;td>&lt;/table>&lt;li>&lt;br>&lt;/ul>',
            // '':'&lt;div style="margin:10px">&lt;/div>&lt;ul style="margin-top:0">&lt;li>&lt;br>game.players&lt;li>&lt;br>game.dead'+
            // '&lt;li>&lt;br>game.me&lt;li>/&lt;br>game.me.previous/next'+
            // '&lt;li>/&lt;br>game.me.previousSeat/&lt;br>nextSeat'+
            // '&lt;li>&lt;br>ui.cardPile&lt;li>&lt;br>ui.discardPile&lt;/ul>'+
            // '&lt;div style="margin:10px">&lt;/div>&lt;ul style="margin-top:0">&lt;li>&lt;br>player.hp'+
            // '&lt;li>&lt;br>player.maxHp&lt;li>&lt;br>player.identity&lt;li>&lt;br>player.getCards("h")&lt;li>&lt;br>player.getCards("e")&lt;li>&lt;br>player.getCards("j")'+
            // '&lt;li>//&lt;br>player.isAlive()/&lt;br>isLinked()/&lt;br>isTurnedOver()&lt;/ul>'+
            // '&lt;div style="margin:10px">&lt;/div>&lt;ul style="margin-top:0">&lt;li>&lt;br>player.damage(source,&lt;br>num)'+
            // '&lt;li>&lt;br>player.recover(num)&lt;li>&lt;br>player.draw(num)&lt;li>&lt;br>player.gain(cards)&lt;li>&lt;br>player.discard(cards)'+
            // '&lt;li>&lt;br>player.useCard(card,&lt;br>targets)&lt;li>&lt;br>player.die()&lt;li>&lt;br>player.revive(hp)&lt;/ul>'+
            // '&lt;div style="margin:10px">&lt;/div>&lt;ul style="margin-top:0">&lt;li>&lt;br>game.print(str)&lt;li>&lt;br>cls&lt;li>/&lt;br>up/down&lt;li>&lt;br>game.over(bool)'+
            // '&lt;li>&lt;br>lib.character&lt;li>&lt;br>lib.card&lt;/ul>',
            '': '&lt;ul>&lt;li>///' +
                '&lt;li>' +
                '&lt;li>' +
                '&lt;li>' +
                '&lt;li>' +
                '&lt;li>'
        },
        /**
         * (: [, ])|(: , [, ])
         * @name lib.setIntro
         * @param {!HTMLDivElement} node 
         * @param {?function} func 
         * @param {?boolean} left true
         * @see {@link get.nodeintro}
         */
        setIntro: function (node, func, left) {
            if (lib.config.touchscreen) {
                if (left) {
                    node.listen(ui.click.touchintro);
                }
                else {
                    lib.setLongPress(node, ui.click.intro);
                }
            }
            else {
                if (left) {
                    node.listen(ui.click.intro);
                }
                if (lib.config.hover_all) {
                    lib.setHover(node, ui.click.hoverplayer);
                }
                if (lib.config.right_info) {
                    node.oncontextmenu = ui.click.rightplayer;
                }
            }
            // if(!left){
            //     lib.setPressure(node,ui.click.rightpressure);
            // }
            if (func) {
                node._customintro = func;
            }
        },
        // setPressure:function(node,func){
        //     if(window.Pressure){
        //         window.Pressure.set(node,{change: func}, {polyfill: false});
        //     }
        // },
        setPopped: function (node, func, width, height, forceclick, paused2) {
            node._poppedfunc = func;
            node._poppedwidth = width;
            node._poppedheight = height;
            if (forceclick) {
                node.forceclick = true;
            }
            if (lib.config.touchscreen || forceclick) {
                node.listen(ui.click.hoverpopped);
            }
            else {
                node.addEventListener('mouseenter', ui.click.hoverpopped);
                // node.addEventListener('mouseleave',ui.click.hoverpopped_leave);
            }
            if (paused2) {
                node._paused2 = true;
            }
        },
        placePoppedDialog: function (dialog, e) {
            if (dialog._place_text) {
                if (dialog._place_text.firstChild.offsetWidth >= 190 ||
                    dialog._place_text.firstChild.offsetHeight >= 30) {
                    dialog._place_text.style.textAlign = 'left';
                    dialog._place_text.style.marginLeft = '14px';
                }
            }
            if (e.touches &amp;&amp; e.touches[0]) {
                e = e.touches[0];
            }
            var height = Math.min(ui.window.offsetHeight - 20, dialog.content.scrollHeight);
            if (dialog._mod_height) {
                height += dialog._mod_height;
            }
            dialog.style.height = height + 'px';
            if (e.clientX / game.documentZoom &lt; ui.window.offsetWidth / 2) {
                dialog.style.left = (e.clientX / game.documentZoom + 10) + 'px';
            }
            else {
                dialog.style.left = (e.clientX / game.documentZoom - dialog.offsetWidth - 10) + 'px';
            }
            var idealtop = (e.clientY || 0) / game.documentZoom - dialog.offsetHeight / 2;
            if (typeof idealtop != 'number' || isNaN(idealtop) || idealtop &lt;= 5) {
                idealtop = 5;
            }
            else if (idealtop + dialog.offsetHeight + 10 > ui.window.offsetHeight) {
                idealtop = ui.window.offsetHeight - 10 - dialog.offsetHeight;
            }
            dialog.style.top = idealtop + 'px';
        },
        /**
         * @callback lib.setHover~callback
         * @param {MouseEvent} e MouseEvent on mouse move
         * @returns {*}TODO
         */
        /**
         * 
         * 
         * @function
         * @param {!HTMLElement} node
         * @param {?lib.setHover~callback} func 
         * @param {?number} hoveration null {@link GameConfig}
         * @param {?number} width null
         * @returns {!HTMLElement}
         */
        setHover: function (node, func, hoveration, width) {
            node._hoverfunc = func;
            if (typeof hoveration == 'number') {
                node._hoveration = hoveration;
            }
            if (typeof width == 'number') {
                node._hoverwidth = width
            }
            node.addEventListener('mouseenter', ui.click.mouseenter);
            node.addEventListener('mouseleave', ui.click.mouseleave);
            node.addEventListener('mousedown', ui.click.mousedown);
            node.addEventListener('mousemove', ui.click.mousemove);
            return node;
        },
        /**
         * 
         * 
         * @function
         * @param {!HTMLElement} node 
         * @returns {!HTMLElement}
         */
        setScroll: function (node) {
            node.ontouchstart = ui.click.touchStart;
            node.ontouchmove = ui.click.touchScroll;
            node.style.WebkitOverflowScrolling = 'touch';
            return node;
        },
        /**
         * 
         * 
         * @function
         * @param {!HTMLElement} node 
         * @returns {!HTMLElement}
         */
        setMousewheel: function (node) {
            if (lib.config.mousewheel) node.onmousewheel = ui.click.mousewheel;
        },
        /**
         * 
         * 
         * @param {!HTMLElement} node 
         * @param {?function} func 
         * @returns {!HTMLElement}
         */
        setLongPress: function (node, func) {
            node.addEventListener('touchstart', ui.click.longpressdown);
            node.addEventListener('touchend', ui.click.longpresscancel);
            node._longpresscallback = func;
            return node;
        },
        /**
         * `ui.canvas`
         * @param {!number} time 
         * @returns {(undefined|false)} `&lt;canvas>`false
         */
        updateCanvas: function (time) {
            if (lib.canvasUpdates.length === 0) {
                lib.status.canvas = false;
                return false;
            }
            ui.canvas.width = ui.arena.offsetWidth;
            ui.canvas.height = ui.arena.offsetHeight;
            var ctx = ui.ctx;
            ctx.shadowBlur = 5;
            ctx.shadowColor = 'rgba(0,0,0,0.3)';
            ctx.strokeStyle = 'white';
            // ctx.lineCap='round';
            ctx.lineWidth = 3;
            ctx.save();
            for (var i = 0; i &lt; lib.canvasUpdates.length; i++) {
                ctx.restore();
                ctx.save();
                var update = lib.canvasUpdates[i];
                if (!update.starttime) {
                    update.starttime = time;
                }
                if (update(time - update.starttime, ctx) === false) {
                    lib.canvasUpdates.splice(i--, 1);
                }
            }
        },
        /**
         * `lib.updates`
         * @param {!number} time 
         */
        run: function (time) {
            lib.status.time = time;
            for (var i = 0; i &lt; lib.updates.length; i++) {
                if (!lib.updates[i].hasOwnProperty('_time')) {
                    lib.updates[i]._time = time;
                }
                if (lib.updates[i](time - lib.updates[i]._time - lib.status.delayed) === false) {
                    lib.updates.splice(i--, 1);
                }
            }
            if (lib.updates.length) {
                lib.status.frameId = requestAnimationFrame(lib.run);
            }
            else {
                lib.status.time = 0;
                lib.status.delayed = 0;
            }
        },
        /**
         * datedatetimedatetime
         * [recommend] {@link get}
         * @function
         * @param {Date} date
         * @returns {number} datetime
         * @see {@link get.utc}
         */
        getUTC: function (date) {
            return date.getTime();
        },
        /**
         * 
         */
        saveVideo: function () {
            if (_status.videoToSave) {
                game.export(lib.init.encode(JSON.stringify(_status.videoToSave)),
                    ' -  - ' + _status.videoToSave.name[0] + ' - ' + _status.videoToSave.name[1]);
            }
        },
        /**
         * 
         * @namespace
         */
        init: {
            /**
             * HTMLDivElementArraydeleteaddArray
             * 
             * @function
             */
            init: function () {
                //part: `lib.configprefix` 
                //PCnode.js`__dirname`
                //`__dirname`  `'F:\\vtb\\test\\src'``lib.configprefix``'noname_0.9_Fvts_'|'vtuberkill_1.9_Fvts_'`
                //BUG: [PC win10] `\`
                if (typeof __dirname === 'string' &amp;&amp; __dirname.length) {
                    var dirsplit = __dirname.split('/');
                    for (var i = 0; i &lt; dirsplit.length; i++) {
                        if (dirsplit[i]) {
                            var c = dirsplit[i][0];
                            lib.configprefix += /[A-Z]|[a-z]/.test(c) ? c : '_';
                        }
                    }
                    lib.configprefix += '_';
                }
                window.resetGameTimeout = setTimeout(lib.init.reset, parseInt(localStorage.getItem(lib.configprefix + 'loadtime')) || 5000);
                //part: `cordovaLoadTimeout` ../app/redirect.js
                if (window.cordovaLoadTimeout) {
                    clearTimeout(window.cordovaLoadTimeout);
                    delete window.cordovaLoadTimeout;
                }
                //part: htmlcss
                var links = document.head.querySelectorAll('link');
                for (var i = 0; i &lt; links.length; i++) {
                    if (links[i].href.indexOf('app/color.css') != -1) {
                        links[i].remove();
                        break;
                    }
                }
                //part: phantomindexedDB
                var index = window.location.href.indexOf('index.html?server=');
                if (index != -1) {
                    /**
                     * ID
                     * @type {string}
                     * @global
                     */
                    window.isNonameServer = window.location.href.slice(index + 18);
                    /**
                     * indexedDB
                     * @type {boolean}
                     * @global
                     */
                    window.nodb = true;
                }
                else {
                    //??
                    index = localStorage.getItem(lib.configprefix + 'asserver');
                    if (index) {
                        window.isNonameServer = index;
                        window.isNonameServerIp = lib.hallURL;
                    }
                }
                //part: 
                var htmlbg = localStorage.getItem(lib.configprefix + 'background');
                if (htmlbg) {
                    if (htmlbg[0] == '[') {
                        try {
                            htmlbg = JSON.parse(htmlbg);
                            htmlbg = htmlbg[get.rand(htmlbg.length)];
                            if (htmlbg.indexOf('custom_') == 0) {
                                throw ('err');
                            }
                            _status.htmlbg = htmlbg;
                        }
                        catch (e) {
                            htmlbg = null;
                        }
                    }
                    if (htmlbg) {
                        if (htmlbg.indexOf('svg_') == 0) {
                            document.documentElement.style.backgroundImage = 'url("' + lib.assetURL + 'image/background/' + htmlbg.slice(4) + '.svg")';
                        }
                        else {
                            document.documentElement.style.backgroundImage = 'url("' + lib.assetURL + 'image/background/' + htmlbg + '.jpg")';
                            document.documentElement.style.backgroundSize = 'cover';
                            document.documentElement.style.backgroundPosition = '50% 50%';
                        }
                    }
                }
                //part: get, ui, ai, game  lib
                lib.get = get;
                lib.ui = ui;
                lib.ai = ai;
                lib.game = game;
                //part:  HTMLDivElement.
                /**
                 * 
                 * @function HTMLDivElement#animate
                 * @param {string} name - 
                 * @param {number} [time=1000] - ms
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.animate = function (name, time) {
                    var that;
                    if (get.is.mobileMe(this) &amp;&amp; name == 'target') {
                        that = ui.mebg;
                    }
                    else {
                        that = this;
                    }
                    that.classList.add(name);
                    setTimeout(function () {
                        that.classList.remove(name);
                    }, time || 1000);
                    return this;
                };
                /**
                 * 
                 * @function HTMLDivElement#hide
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.hide = function () {
                    this.classList.add('hidden');
                    return this;
                };
                /**
                 * 
                 * @function HTMLDivElement#unfocus
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.unfocus = function () {
                    if (lib.config.transparent_dialog) this.classList.add('transparent');
                    return this;
                };
                /**
                 * 
                 * @function HTMLDivElement#refocus
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.refocus = function () {
                    this.classList.remove('transparent');
                    return this;
                };
                /**
                 * 
                 * @function HTMLDivElement#show
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.show = function () {
                    this.classList.remove('hidden');
                    return this;
                };
                /**
                 * @callback HTMLDivElement~deleteCallback
                 * @see {@link HTMLDivElement#delete}
                 */
                /**
                 * DOM
                 * @function HTMLDivElement#delete
                 * @param {number} time - ms
                 * @param {HTMLDivElement~deleteCallback} callback - 
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.delete = function (time, callback) {
                    if (this.timeout) {
                        clearTimeout(this.timeout);
                        delete this.timeout;
                    }
                    if (!this._listeningEnd || this._transitionEnded) {
                        if (typeof time != 'number') time = 500;
                        this.classList.add('removing');
                        var that = this;
                        this.timeout = setTimeout(function () {
                            that.remove();
                            that.classList.remove('removing');
                            if (typeof callback == 'function') {
                                callback();
                            }
                        }, time);
                    }
                    else {
                        this._onEndDelete = true;
                    }
                    return this;
                };
                /**
                 * ()
                 * @function HTMLDivElement#goto
                 * @param {*} position - 
                 * @param {number} time - 
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.goto = function (position, time) {
                    if (this.timeout) {
                        clearTimeout(this.timeout);
                        delete this.timeout;
                    }

                    if (typeof time != 'number') time = 500;
                    this.classList.add('removing');

                    var that = this;
                    this.timeout = setTimeout(function () {
                        if (!that.destroyed) {
                            position.appendChild(that);
                        }
                        that.classList.remove('removing');
                        delete that.destiny;
                    }, time);
                    this.destiny = position;
                    return this;
                };
                /**
                 * 
                 * @function HTMLDivElement#fix
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.fix = function () {
                    clearTimeout(this.timeout);
                    delete this.timeout;
                    delete this.destiny;
                    this.classList.remove('removing');
                    return this;
                };
                /**
                 * name
                 * `image/${type?type+'/':''}${type?subfolder+'/':''}${name}${ext}`
                 * @function HTMLDivElement#setBackground
                 * @param {string} [name] - 
                 * @param {string} [type] - 
                 * @param {string} [ext='.jpg'] - 
                 * @param {string} [subfolder='default'] - `type`
                 * @returns {?HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.setBackground = function (name, type, ext, subfolder) {
                    if (!name) return;
                    var src;
                    if (ext == 'noskin') {
                        ext = '.jpg';
                    }
                    ext = ext || '.jpg';
                    subfolder = subfolder || 'default'
                    if (type) {
                        var dbimage = null, extimage = null, modeimage = null;
                        var nameinfo;
                        var gzbool = false;
                        var mode = get.mode();
                        if (type == 'character') {
                            if (lib.characterPack['mode_' + mode] &amp;&amp; lib.characterPack['mode_' + mode][name]) {
                                if (mode == 'guozhan') {
                                    nameinfo = lib.character[name];
                                    if (name.indexOf('gz_shibing') == 0) {
                                        name = name.slice(3, 11);
                                    }
                                    else {
                                        if (lib.config.mode_config.guozhan.guozhanSkin &amp;&amp; lib.character[name] &amp;&amp; lib.character[name][4].contains('gzskin')) gzbool = true;
                                        name = name.slice(3);
                                    }
                                }
                                else {
                                    modeimage = mode;
                                }
                            }
                            else if (lib.character[name]) {
                                nameinfo = lib.character[name];
                            }
                            else if (name.indexOf('::') != -1) {
                                name = name.split('::');
                                modeimage = name[0];
                                name = name[1];
                            }
                        }
                        if (!modeimage &amp;&amp; nameinfo &amp;&amp; nameinfo[4]) {
                            for (var i = 0; i &lt; nameinfo[4].length; i++) {
                                if (nameinfo[4][i].indexOf('ext:') == 0) {
                                    extimage = nameinfo[4][i]; break;
                                }
                                else if (nameinfo[4][i].indexOf('db:') == 0) {
                                    dbimage = nameinfo[4][i]; break;
                                }
                                else if (nameinfo[4][i].indexOf('mode:') == 0) {
                                    modeimage = nameinfo[4][i].slice(5); break;
                                }
                                else if (nameinfo[4][i].indexOf('character:') == 0) {
                                    name = nameinfo[4][i].slice(10); break;
                                }
                            }
                        }
                        if (extimage) {
                            src = extimage.replace(/ext:/, 'extension/');
                        }
                        else if (dbimage) {
                            this.setBackgroundDB(dbimage.slice(3));
                            return this;
                        }
                        else if (modeimage) {
                            src = 'image/mode/' + modeimage + '/character/' + name + ext;
                        }
                        else if (type == 'character' &amp;&amp; lib.config.skin[name] &amp;&amp; arguments[2] != 'noskin') {
                            src = 'image/skin/' + name + '/' + lib.config.skin[name] + ext;
                        }
                        else {
                            if (type == 'character') {
                                src = 'image/character/' + (gzbool ? 'gz_' : '') + name + ext;
                            }
                            else {
                                src = 'image/' + type + '/' + subfolder + '/' + name + ext;
                            }
                        }
                    }
                    else {
                        src = 'image/' + name + ext;
                    }
                    this.setBackgroundImage(src);
                    this.style.backgroundSize = "cover";
                    return this;
                };
                /**
                 * 
                 * @function HTMLDivElement#setBackgroundDB
                 * @param {string} img - 
                 */
                HTMLDivElement.prototype.setBackgroundDB = function (img) {
                    var node = this;
                    game.getDB('image', img, function (src) {
                        node.style.backgroundImage = "url('" + src + "')";
                        node.style.backgroundSize = "cover";
                    });
                };
                /**
                 * 
                 * @function HTMLDivElement#setBackgroundImage
                 * @param {string} img - {@link lib.assetURL|assertURL}
                 */
                HTMLDivElement.prototype.setBackgroundImage = function (img) {
                    this.style.backgroundImage = 'url("' + lib.assetURL + img + '")';
                },
                    /**
                     * {@link HTMLDivElement#listen|listen}click
                     * @callback HTMLDivElement#listen~listenCallback
                     * @param {(MouseEvent|TouchEvent)} e - 
                     */
                    /**
                     * 
                     * @function HTMLDivElement#listen
                     * @param {HTMLDivElement#listen~listenCallback} func - 
                     * @returns {HTMLDivElement} this self
                     */
                    HTMLDivElement.prototype.listen = function (func) {
                        if (lib.config.touchscreen) {
                            this.addEventListener('touchend', function (e) {
                                if (!_status.dragged) {
                                    func.call(this, e);
                                }
                            });
                            var fallback = function (e) {
                                if (!_status.touchconfirmed) {
                                    func.call(this, e);
                                }
                                else {
                                    this.removeEventListener('click', fallback);
                                }
                            }
                            this.addEventListener('click', fallback);
                        }
                        else {
                            this.addEventListener('click', func);
                        }
                        return this;
                    };
                /**
                 * @callback HTMLDivElement#listenTransition~callback
                 * @see {@link HTMLDivElement#listenTransition}
                 */
                /**
                 * 
                 * @function HTMLDivElement#listenTransition
                 * @param {HTMLDivElement#listenTransition~callback} func - 
                 * @param {number} [time=1000] - 
                 * @returns {!number} timeoutID 
                 */
                HTMLDivElement.prototype.listenTransition = function (func, time) {
                    var that = this;
                    var done = false;
                    var callback = function () {
                        if (!done) {
                            func.call(that);
                            done = true;
                        }
                    };
                    this.addEventListener('webkitTransitionEnd', callback);
                    return setTimeout(callback, time || 1000);
                };
                /**
                 * 
                 * ```JavaScript
                 * top = calc(`offsets[0]`%+`offsets[1]`px)
                 * left = calc(`offsets[2]`%+`offsets[3]`px)
                 * ```
                 * @function HTMLDivElement#setPosition
                 * @param {!number[]} offsets - 4
                 * @returns {HTMLDivElement} this self
                 */
                /**
                 * 
                 * ```JavaScript
                 * top  = calc(`top_pc`%+`top_px`px)
                 * left = calc(`lft_pc`%+`lft_px`px)
                 * ```
                 * @function HTMLDivElement#setPosition
                 * @variation 2
                 * @param {number} top_pc
                 * @param {number} top_px
                 * @param {number} lft_pc
                 * @param {number} lft_px
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.setPosition = function () {
                    var position;
                    if (arguments.length == 4) {
                        position = [];
                        for (var i = 0; i &lt; arguments.length; i++) position.push(arguments[i]);
                    }
                    else if (arguments.length == 1 &amp;&amp; Array.isArray(arguments[0]) &amp;&amp; arguments[0].length == 4) {
                        position = arguments[0];
                    }
                    else {
                        return this;
                    }
                    var top = 'calc(' + position[0] + '% ';
                    if (position[1] > 0) top += '+ ' + position[1] + 'px)';
                    else top += '- ' + Math.abs(position[1]) + 'px)';
                    var left = 'calc(' + position[2] + '% ';
                    if (position[3] > 0) left += '+ ' + position[3] + 'px)';
                    else left += '- ' + Math.abs(position[3]) + 'px)';
                    this.style.top = top;
                    this.style.left = left;
                    return this;
                };
                /**
                 * css
                 * @function HTMLDivElement#css
                 * @param {Object} style - style
                 * @param {string} [style.innerHTML] - HTML
                 * @param {...string} [style.cssProperty] - css{@link https://developer.mozilla.org/en-US/docs/Web/CSS/Reference|cssProperty}
                 * @returns {HTMLDivElement} this self
                 */
                HTMLDivElement.prototype.css = function (style) {
                    for (var i in style) {
                        if (i == 'innerHTML') {
                            this.innerHTML = style[i];
                        }
                        else {
                            this.style[i] = style[i];
                        }
                    }
                    return this;
                };
                /**
                 * Table[row][col]
                 * @deprecated &lt;span style="color:red;">[never use]&lt;/span> 
                 * @function HTMLTableElement#get
                 * @param {!number} row - 
                 * @param {!number} col - 
                 * @returns {HTMLTableCellElement} /
                 */
                HTMLTableElement.prototype.get = function (row, col) {
                    if (row &lt; this.childNodes.length) {
                        return this.childNodes[row].childNodes[col];
                    }
                };
                //part: 
                /**
                 * `item`
                 * @function Array#numOf
                 * @param {*} item - 
                 * @returns {!number} 
                 */
                Array.prototype.numOf = function (item) {
                    var num = 0;
                    for (var i = 0; i &lt; this.length; i++) {
                        if (this[i] == item) num++;
                    }
                    return num;
                };
                /**
                 * 
                 * @function Array#filterInD
                 * @param {CardPosition[]} [pos='o'] - 
                 * @returns {!Array} 
                 */
                Array.prototype.filterInD = function (pos) {
                    if (!pos) pos = 'o';
                    var list = [];
                    for (var i = 0; i &lt; this.length; i++) {
                        if (pos.indexOf(get.position(this[i], true)) != -1) list.push(this[i]);
                    }
                    return list;
                };
                /**
                 * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf|Array.prototype.indexOf()}
                 * @function Array#find
                 * @param {*} item - 
                 * @returns {!number} -1
                 */
                Array.prototype.find = function (item) {
                    return this.indexOf(item);
                };
                /**
                 * {@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf|Array.prototype.indexOf(item)!=-1}
                 * @function Array#contains
                 * @param {any} item - 
                 * @returns {boolean} `true``false`
                 */
                Array.prototype.contains = function (item) {
                    return this.indexOf(item) != -1;
                };
                /**
                 * 
                 * @function Array#add
                 * @param {...any} elements - 
                 * @returns {Array} this self
                 */
                Array.prototype.add = function () {
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (this.contains(arguments[i])) {
                            return false;
                        }
                        this.push(arguments[i]);
                    }
                    return this;
                };
                /**
                 * {@link Array#add}
                 * @deprecated [since ES 2015] ES2015 Spread{@link https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax|Spread syntax}
                 * @function Array#addArray
                 * @param {!Array} arr - 
                 * @returns {Array} this self
                 */
                Array.prototype.addArray = function (arr) {
                    for (var i = 0; i &lt; arr.length; i++) {
                        this.add(arr[i]);
                    }
                    return this;
                };
                /**
                 * ==
                 * &lt;ul>
                 *   &lt;li>&lt;/li>
                 * &lt;/ul>
                 * @function Array#remove
                 * @deprecated [performance warning] 
                 * @param {(*|Array)} item - ||
                 * @returns {?Array} this self`item`undefined
                 */
                Array.prototype.remove = function (item) {
                    if (Array.isArray(item)) {
                        for (var i = 0; i &lt; item.length; i++) this.remove(item[i]);
                        return;
                    }
                    var pos = this.find(item);
                    if (pos == -1) {
                        return false;
                    }
                    this.splice(pos, 1);
                    return this;
                };
                /**
                 * ==
                 * &lt;ul>
                 *   &lt;li>&lt;/li>
                 *   &lt;li>`arr`{@link Array#remove|Array.prototype.remove}&lt;/li>
                 * &lt;/ul>
                 * @function Array#removeArray
                 * @deprecated [performance warning] {@link Array#remove}
                 * @param {!Array} arr - 
                 * @returns {Array} this self
                 */
                Array.prototype.removeArray = function (arr) {
                    for (var i = 0; i &lt; arr.length; i++) {
                        this.remove(arr[i]);
                    }
                    return this;
                };
                /**
                 * 
                 * @function Array#randomGet
                 * @param {...any} elements - `elements`{@link Array#remove|Array.prototype.remove}
                 * @returns {any} 
                 */
                Array.prototype.randomGet = function () {
                    var arr = this.slice(0);
                    for (var i = 0; i &lt; arguments.length; i++) arr.remove(arguments[i]);
                    return arr[Math.floor(Math.random() * arr.length)];
                };
                /**
                 * 
                 * @function Array#randomRemove
                 * @deprecated [performance warning] 
                 * @param {number} [num=undefined] - 
                 * @returns {(Array|any)} 
                 */
                Array.prototype.randomRemove = function (num) {
                    if (typeof num == 'number') {
                        var list = [];
                        for (var i = 0; i &lt; num; i++) {
                            if (this.length) {
                                list.push(this.randomRemove());
                            }
                            else {
                                break;
                            }
                        }
                        return list;
                    }
                    else {
                        return this.splice(Math.floor(Math.random() * this.length), 1)[0];
                    }
                };
                /**
                 * 
                 * @function Array#randomSort
                 * @returns {Array} this self
                 */
                Array.prototype.randomSort = function () {
                    var list = [];
                    while (this.length) {
                        list.push(this.randomRemove());
                    }
                    for (var i = 0; i &lt; list.length; i++) {
                        this.push(list[i]);
                    }
                    return this;
                };
                /**
                 * 
                 * @function Array#randomGet
                 * @param {...any} elements - `elements`{@link Array#remove|Array.prototype.remove}
                 * @returns {!Array&lt;any>} 
                 */
                Array.prototype.randomGets = function (num) {
                    if (num > this.length) {
                        num = this.length;
                    }
                    var arr = this.slice(0);
                    var list = [];
                    for (var i = 0; i &lt; num; i++) {
                        list.push(arr.splice(Math.floor(Math.random() * arr.length), 1)[0]);
                    }
                    return list;
                };
                /**
                 * /- TODO
                 * @function Array#sortBySeat
                 * @param {GameCores.GameObjects.Player} target 
                 * @returns {Array} this self
                 */
                Array.prototype.sortBySeat = function (target) {
                    lib.tempSortSeat = target;
                    this.sort(lib.sort.seat);
                    delete lib.tempSortSeat;
                    return this;
                };
                if (!Array.from) {
                    /**
                     * 
                     * @function Array#from
                     * @param {...any} args - 
                     * @returns {!Array} `args`
                     */
                    Array.from = function (args) {
                        var list = [];
                        if (args &amp;&amp; args.length) {
                            for (var i = 0; i &lt; args.length; i++) {
                                list.push(args[i]);
                            }
                        }
                        return list;
                    }
                }
                //part: window.onkeydown, window.onload, window.onerror
                /**
                 * 
                 * @function
                 * @global
                 * @param {KeyboardEvent} e - 
                 * @listens KeyboardEvent
                 */
                window.onkeydown = function (e) {
                    if (!ui.menuContainer || !ui.menuContainer.classList.contains('hidden')) {
                        if (e.keyCode == 116 || ((e.ctrlKey || e.metaKey) &amp;&amp; e.keyCode == 82)) {
                            if (e.shiftKey) {
                                if (confirm('')) {
                                    var noname_inited = localStorage.getItem('noname_inited');
                                    var onlineKey = localStorage.getItem(lib.configprefix + 'key');
                                    localStorage.clear();
                                    if (noname_inited) {
                                        localStorage.setItem('noname_inited', noname_inited);
                                    }
                                    if (onlineKey) {
                                        localStorage.setItem(lib.configprefix + 'key', onlineKey);
                                    }
                                    if (indexedDB) indexedDB.deleteDatabase(lib.configprefix + 'data');
                                    game.reload();
                                    return;
                                }
                            }
                            else {
                                game.reload();
                            }
                        }
                        else if (e.keyCode == 83 &amp;&amp; (e.ctrlKey || e.metaKey)) {
                            if (window.saveNonameInput) {
                                window.saveNonameInput();
                            }
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                        else if (e.keyCode == 74 &amp;&amp; (e.ctrlKey || e.metaKey) &amp;&amp; lib.node) {
                            lib.node.debug();
                        }
                    }
                    else {
                        game.closePopped();
                        var dialogs = document.querySelectorAll('#window>.dialog.popped:not(.static)');
                        for (var i = 0; i &lt; dialogs.length; i++) {
                            dialogs[i].delete();
                        }
                        if (e.keyCode == 32) {
                            var node = ui.window.querySelector('pausedbg');
                            if (node) {
                                node.click();
                            }
                            else {
                                ui.click.pause();
                            }
                        }
                        else if (e.keyCode == 65) {
                            if (ui.auto) ui.auto.click();
                        }
                        else if (e.keyCode == 87) {
                            if (ui.wuxie &amp;&amp; ui.wuxie.style.display != 'none') {
                                ui.wuxie.classList.toggle('glow')
                            }
                            else if (ui.tempnowuxie) {
                                ui.tempnowuxie.classList.toggle('glow')
                            }
                        }
                        else if (e.keyCode == 116 || ((e.ctrlKey || e.metaKey) &amp;&amp; e.keyCode == 82)) {
                            if (e.shiftKey) {
                                if (confirm('')) {
                                    var noname_inited = localStorage.getItem('noname_inited');
                                    var onlineKey = localStorage.getItem(lib.configprefix + 'key');
                                    localStorage.clear();
                                    if (noname_inited) {
                                        localStorage.setItem('noname_inited', noname_inited);
                                    }
                                    if (onlineKey) {
                                        localStorage.setItem(lib.configprefix + 'key', onlineKey);
                                    }
                                    if (indexedDB) indexedDB.deleteDatabase(lib.configprefix + 'data');
                                    game.reload();
                                    return;
                                }
                            }
                            else {
                                game.reload();
                            }
                        }
                        else if (e.keyCode == 83 &amp;&amp; (e.ctrlKey || e.metaKey)) {
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                        else if (e.keyCode == 74 &amp;&amp; (e.ctrlKey || e.metaKey) &amp;&amp; lib.node) {
                            lib.node.debug();
                        }
                        // else if(e.keyCode==27){
                        //     if(!ui.arena.classList.contains('paused')) ui.click.config();
                        // }
                    }
                };
                /**
                 * window
                 * @function
                 * @global
                 */
                window.onload = function () {
                    if (lib.device) {
                        var script = document.createElement('script');
                        script.src = 'cordova.js';
                        document.body.appendChild(script);
                        document.addEventListener('deviceready', function () {
                            if (lib.init.cordovaReady) {
                                lib.init.cordovaReady();
                                delete lib.init.cordovaReady;
                            }
                        });
                    }
                    if (_status.packLoaded) {
                        delete _status.packLoaded;
                        lib.init.onload();
                    }
                    else {
                        /**
                         * onloadonload
                         * @private
                         * @default
                         */
                        _status.windowLoaded = true;
                    }
                };
                /**
                 * 
                 * @function
                 * @global
                 * @param {string} msg - 
                 * @param {string} src - URL
                 * @param {string} line - 
                 * @param {string} column - 
                 * @param {Error} err - 
                 */
                window.onerror = function (msg, src, line, column, err) {
                    var str = msg;
                    if (window._status &amp;&amp; _status.event) {
                        var evt = _status.event;
                        str += ('\n' + evt.name + ': ' + evt.step);
                        if (evt.parent) str += '\n' + evt.parent.name + ': ' + evt.parent.step;
                        if (evt.parent &amp;&amp; evt.parent.parent) str += '\n' + evt.parent.parent.name + ': ' + evt.parent.parent.step;
                        if (evt.player || evt.target || evt.source || evt.skill || evt.card) {
                            str += '\n-------------'
                        }
                        if (evt.player) {
                            str += '\nplayer: ' + evt.player.name;
                        }
                        if (evt.target) {
                            str += '\ntarget: ' + evt.target.name;
                        }
                        if (evt.source) {
                            str += '\nsource: ' + evt.source.name;
                        }
                        if (evt.skill) {
                            str += '\nskill: ' + evt.skill.name;
                        }
                        if (evt.card) {
                            str += '\ncard: ' + evt.card.name;
                        }
                    }
                    str += '\n-------------';
                    str += '\n' + line;
                    str += '\n' + column;
                    if (err &amp;&amp; err.stack) str += '\n' + err.stack;
                    alert(str);
                    window.ea = Array.from(arguments);
                    window.em = msg;
                    window.el = line;
                    window.ec = column;
                    window.eo = err;
                    game.print(msg);
                    game.print(line);
                    game.print(column);
                    game.print(err.stack);
                    if (!lib.config.errstop) {
                        _status.withError = true;
                        game.loop();
                    }
                };
                //part: window.nogame_updateconfig.js
                if (window.noname_update) {
                    lib.version = window.noname_update.version;
                    lib.changeLog = window.noname_update.changeLog;
                    if (window.noname_update.players) {
                        lib.changeLog.push('players://' + JSON.stringify(window.noname_update.players));
                    }
                    if (window.noname_update.cards) {
                        lib.changeLog.push('cards://' + JSON.stringify(window.noname_update.cards));
                    }
                    delete window.noname_update;
                }
                //part: lib.device, lib.assetURL
                var noname_inited = localStorage.getItem('noname_inited');
                if (noname_inited &amp;&amp; noname_inited !== 'nodejs') {
                    var ua = navigator.userAgent.toLowerCase();
                    if (ua.indexOf('android') != -1) {
                        lib.device = 'android';
                    }
                    else if (ua.indexOf('iphone') != -1 || ua.indexOf('ipad') != -1) {
                        lib.device = 'ios';
                    }
                    lib.assetURL = noname_inited;
                }
                //part: flag`ui.css`trueUIconfig`ui.css`config`config3`css
                var config3 = null;
                var proceed = function (config2) {
                    //[recommend] `init``proceed`
                    if (config3 === null) {
                        config3 = config2;
                        return;
                    }
                    //part: `config2.mode``config2.mode``lib.config.mode_config`
                    if (config2.mode) lib.config.mode = config2.mode;
                    if (lib.config.mode_config[lib.config.mode] == undefined) lib.config.mode_config[lib.config.mode] = {};
                    for (var i in lib.config.mode_config.global) {
                        if (lib.config.mode_config[lib.config.mode][i] == undefined) {
                            lib.config.mode_config[lib.config.mode][i] = lib.config.mode_config.global[i];
                        }
                    }
                    //part: defaultcharacters
                    if (lib.config.characters) {
                        lib.config.defaultcharacters = lib.config.characters.slice(0);
                    }
                    //part: defaultcards
                    if (lib.config.cards) {
                        lib.config.defaultcards = lib.config.cards.slice(0);
                    }
                    //part: `config2``lib.config``lib.mode_config`
                    for (var i in config2) {
                        if (i.indexOf('_mode_config') != -1) {
                            var thismode = i.substr(i.indexOf('_mode_config') + 13);
                            if (!lib.config.mode_config[thismode]) {
                                lib.config.mode_config[thismode] = {};
                            }
                            lib.config.mode_config[thismode][i.substr(0, i.indexOf('_mode_config'))] = config2[i];
                        }
                        else {
                            lib.config[i] = config2[i];
                        }
                    }
                    //part: `lib.config.translate``lib.translate`
                    for (var i in lib.config.translate) {
                        lib.translate[i] = lib.config.translate[i];
                    }

                    lib.config.all.characters = [];
                    lib.config.all.cards = [];
                    lib.config.all.plays = [];
                    lib.config.all.mode = [];
                    //part: 
                    if (lib.config.debug) {
                        lib.init.js(lib.assetURL + 'game', 'asset', function () {
                            lib.skin = window.noname_skin_list;
                            delete window.noname_skin_list;
                            delete window.noname_asset_list;
                        });
                    }

                    if (window.isNonameServer) {
                        lib.config.mode = 'connect';
                    }
                    //part: `window.noname_package`package.js
                    var pack = window.noname_package;
                    delete window.noname_package;
                    for (i in pack.character) {
                        if (lib.config.hiddenCharacterPack.indexOf(i) == -1) {
                            lib.config.all.characters.push(i);
                            lib.translate[i + '_character_config'] = pack.character[i];
                        }
                    }
                    for (i in pack.card) {
                        if (lib.config.hiddenCardPack.indexOf(i) == -1) {
                            lib.config.all.cards.push(i);
                            lib.translate[i + '_card_config'] = pack.card[i];
                        }
                    }
                    for (i in pack.play) {
                        lib.config.all.plays.push(i);
                        lib.translate[i + '_play_config'] = pack.play[i];
                    }
                    for (i in pack.submode) {
                        for (var j in pack.submode[i]) {
                            lib.translate[i + '|' + j] = pack.submode[i][j];
                        }
                    }

                    if (!lib.config.gameRecord) {
                        lib.config.gameRecord = {};
                    }
                    for (i in pack.mode) {
                        if (lib.config.hiddenModePack.indexOf(i) == -1) {
                            lib.config.all.mode.push(i);
                            lib.translate[i] = pack.mode[i];
                            if (!lib.config.gameRecord[i]) {
                                lib.config.gameRecord[i] = { data: {} };
                            }
                        }
                    }
                    //??
                    if (lib.config.all.mode.length == 0) {
                        lib.config.all.mode.push('identity');
                        lib.translate.identity = '';
                        if (!lib.config.gameRecord.identity) {
                            lib.config.gameRecord.identity = { data: {} };
                        }
                    }
                    if (pack.background) {
                        for (i in pack.background) {
                            if (lib.config.hiddenBackgroundPack.contains(i)) continue;
                            lib.configMenu.appearence.config.image_background.item[i] = pack.background[i];
                        }
                        for (var i = 0; i &lt; lib.config.customBackgroundPack.length; i++) {
                            var link = lib.config.customBackgroundPack[i];
                            lib.configMenu.appearence.config.image_background.item[link] = link.slice(link.indexOf('_') + 1);
                        }
                        lib.configMenu.appearence.config.image_background.item.default = '';
                    }
                    if (pack.music) {
                        if (lib.device || typeof window.require == 'function') {
                            lib.configMenu.audio.config.background_music.item.music_custom = '';
                        }
                        lib.config.all.background_music = ['music_diaochan'];
                        for (i in pack.music) {
                            lib.config.all.background_music.push(i);
                            lib.configMenu.audio.config.background_music.item[i] = pack.music[i];
                        }
                        if (lib.config.customBackgroundMusic) {
                            for (i in lib.config.customBackgroundMusic) {
                                lib.config.all.background_music.push(i);
                                lib.configMenu.audio.config.background_music.item[i] = lib.config.customBackgroundMusic[i];
                            }
                        }
                        lib.configMenu.audio.config.background_music.item.music_random = '';
                        lib.configMenu.audio.config.background_music.item.music_off = '';
                    }
                    if (pack.theme) {
                        for (i in pack.theme) {
                            lib.configMenu.appearence.config.theme.item[i] = pack.theme[i];
                        }
                    }
                    if (lib.config.extension_sources) {
                        for (i in lib.config.extension_sources) {
                            lib.configMenu.general.config.extension_source.item[i] = i;
                        }
                    }

                    if (pack.font) {
                        ui.css.fontsheet = lib.init.sheet();
                        for (i in pack.font) {
                            lib.configMenu.appearence.config.name_font.item[i] = pack.font[i];
                            lib.configMenu.appearence.config.identity_font.item[i] = pack.font[i];
                            lib.configMenu.appearence.config.cardtext_font.item[i] = pack.font[i];
                            lib.configMenu.appearence.config.global_font.item[i] = pack.font[i];
                            ui.css.fontsheet.sheet.insertRule("@font-face {font-family: '" + i + "';src: url('" + lib.assetURL + "font/" + i + ".ttf');}", 0);
                        }
                        lib.configMenu.appearence.config.cardtext_font.item.default = '';
                        lib.configMenu.appearence.config.global_font.item.default = '';
                    }
                    //part: touch, layout, scroll config
                    var ua = navigator.userAgent.toLowerCase();
                    if ('ontouchstart' in document) {
                        //
                        if (!lib.config.totouched) {
                            game.saveConfig('totouched', true);
                            if (lib.device) {
                                //
                                game.saveConfig('low_performance', true);
                                game.saveConfig('confirm_exit', true);
                                game.saveConfig('touchscreen', true);
                                game.saveConfig('fold_mode', false);
                                if (ua.indexOf('ipad') == -1) {
                                    game.saveConfig('phonelayout', true);
                                }
                                else if (lib.device == 'ios') {
                                    game.saveConfig('show_statusbar_ios', 'overlay');
                                }
                            }
                            else if (confirm('')) {
                                //
                                game.saveConfig('touchscreen', true);
                                if (ua.indexOf('iphone') != -1 || ua.indexOf('android') != -1) {
                                    game.saveConfig('phonelayout', true);
                                }

                                game.reload();
                            }
                        }
                    }
                    else if (lib.config.touchscreen) {//
                        game.saveConfig('touchscreen', false);
                    }

                    if (!lib.config.toscrolled &amp;&amp; ua.indexOf('macintosh') != -1) {
                        game.saveConfig('toscrolled', true);
                        game.saveConfig('mousewheel', false);
                    }
                    //part: 
                    var show_splash = lib.config.show_splash;
                    if (show_splash == 'off') {
                        show_splash = false;
                    }
                    else if (show_splash == 'init') {
                        if (localStorage.getItem('show_splash_off')) {
                            show_splash = false;
                        }
                    }
                    localStorage.removeItem('show_splash_off');
                    //part: extension list
                    //??
                    //[never executed]
                    var extensionlist = [];
                    if (!localStorage.getItem(lib.configprefix + 'disable_extension')) {
                        if (lib.config.extensions &amp;&amp; lib.config.extensions.length) {
                            window.resetExtension = function () {
                                for (var i = 0; i &lt; lib.config.extensions.length; i++) {
                                    game.saveConfig('extension_' + lib.config.extensions[i] + '_enable', false);
                                }
                                localStorage.setItem(lib.configprefix + 'disable_extension', true);
                            }
                        }
                        for (var i = 0; i &lt; lib.config.plays.length; i++) {
                            if (lib.config.all.plays.indexOf(lib.config.plays[i]) != -1) {
                                extensionlist.push(lib.config.plays[i]);
                            }
                        }
                        for (var i = 0; i &lt; lib.config.extensions.length; i++) {
                            var extcontent = localStorage.getItem(lib.configprefix + 'extension_' + lib.config.extensions[i]);
                            if (extcontent) {
                                _status.evaluatingExtension = true;
                                try {
                                    eval(extcontent);
                                }
                                catch (e) {
                                    console.log(e);
                                }
                                _status.evaluatingExtension = false;
                            }
                            else if (lib.config.mode != 'connect' || (!localStorage.getItem(lib.configprefix + 'directstart') &amp;&amp; show_splash)) {
                                extensionlist.push(lib.config.extensions[i]);
                            }
                        }
                    }
                    else {
                        if (lib.config.mode != 'connect' || (!localStorage.getItem(lib.configprefix + 'directstart') &amp;&amp; show_splash)) {
                            for (var i = 0; i &lt; lib.config.extensions.length; i++) {
                                game.import('extension', { name: lib.config.extensions[i] });
                            }
                        }
                    }
                    //
                    var loadPack = function () {
                        var toLoad = lib.config.all.cards.length + lib.config.all.characters.length + 1;
                        var packLoaded = function () {
                            toLoad--;
                            if (toLoad == 0) {
                                if (_status.windowLoaded) {
                                    delete _status.windowLoaded;
                                    lib.init.onload();
                                }
                                else {
                                    /**
                                     * window.onloadonload
                                     * @private
                                     * @default
                                     */
                                    _status.packLoaded = true;
                                }
                            }
                        };
                        if (localStorage.getItem(lib.configprefix + 'playback')) {
                            toLoad++;
                            lib.init.js(lib.assetURL + 'mode', lib.config.mode, packLoaded, packLoaded);
                        }
                        else if ((localStorage.getItem(lib.configprefix + 'directstart') || !show_splash) &amp;&amp;
                            lib.config.all.mode.indexOf(lib.config.mode) != -1) {
                            toLoad++;
                            lib.init.js(lib.assetURL + 'mode', lib.config.mode, packLoaded, packLoaded);
                        }
                        lib.init.js(lib.assetURL + 'card', lib.config.all.cards, packLoaded, packLoaded);
                        lib.init.js(lib.assetURL + 'character', lib.config.all.characters, packLoaded, packLoaded);
                        lib.init.js(lib.assetURL + 'character', 'rank', packLoaded, packLoaded);
                        // if(lib.device!='ios'&amp;&amp;lib.config.enable_pressure) lib.init.js(lib.assetURL+'game','pressure');
                    };
                    //part: layout`game.layout = layout`
                    var layout = lib.config.layout;
                    if (lib.layoutfixed.indexOf(lib.config.mode) !== -1) {
                        layout = 'mobile';
                    }
                    if (layout == 'phone') {
                        layout = 'mobile';
                        game.saveConfig('layout', 'mobile');
                        game.saveConfig('phonelayout', true);
                    }
                    game.layout = layout;
                    //part: _status.htmlbg
                    if (lib.config.image_background_random) {
                        if (_status.htmlbg) {
                            game.saveConfig('image_background', _status.htmlbg);
                        }
                        else {
                            var list = [];
                            for (var i in lib.configMenu.appearence.config.image_background.item) {
                                if (i == 'default') continue;
                                list.push(i);
                            }
                            game.saveConfig('image_background', list.randomGet(lib.config.image_background));
                        }
                        lib.init.background();
                    }
                    delete _status.htmlbg;
                    //part: game to window.game
                    window.game = game;
                    //part: js(, , )css(UI, )
                    var styleToLoad = 6;
                    var styleLoaded = function () {
                        styleToLoad--;
                        if (styleToLoad == 0) {
                            if (extensionlist.length &amp;&amp; (lib.config.mode != 'connect' || show_splash)) {
                                var extToLoad = extensionlist.length;
                                var extLoaded = function () {
                                    extToLoad--;
                                    if (extToLoad == 0) {
                                        loadPack();
                                    }
                                }
                                for (var i = 0; i &lt; extensionlist.length; i++) {
                                    lib.init.js(lib.assetURL + 'extension/' + extensionlist[i], 'extension', extLoaded, (function (i) {
                                        return function () {
                                            game.removeExtension(i);
                                            extToLoad--;
                                            if (extToLoad == 0) {
                                                loadPack();
                                            }
                                        }
                                    }(extensionlist[i])));
                                }
                            }
                            else {
                                loadPack();
                            }
                        }
                    };
                    //css.layout
                    if (lib.config.layout != 'default') {
                        ui.css.layout = lib.init.css(lib.assetURL + 'layout/' + layout, 'layout', styleLoaded);
                    }
                    else {
                        ui.css.layout = lib.init.css();
                        styleToLoad--;
                    }
                    //css.phone
                    if (get.is.phoneLayout()) {
                        ui.css.phone = lib.init.css(lib.assetURL + 'layout/default', 'phone', styleLoaded);
                    }
                    else {
                        ui.css.phone = lib.init.css();
                        styleToLoad--;
                    }
                    //css.theme
                    ui.css.theme = lib.init.css(lib.assetURL + 'theme/' + lib.config.theme, 'style', styleLoaded);
                    //css.card_style
                    ui.css.card_style = lib.init.css(lib.assetURL + 'theme/style/card', lib.config.card_style, styleLoaded);
                    //css_cardpack_style
                    ui.css.cardback_style = lib.init.css(lib.assetURL + 'theme/style/cardback', lib.config.cardback_style, styleLoaded);
                    //css.hp_style
                    ui.css.hp_style = lib.init.css(lib.assetURL + 'theme/style/hp', lib.config.hp_style, styleLoaded);
                    //part: `&lt;link>`, 
                    if (lib.config.player_style &amp;&amp; lib.config.player_style != 'default' &amp;&amp; lib.config.player_style != 'custom') {
                        var str = '';
                        switch (lib.config.player_style) {
                            case 'wood': str = 'url("' + lib.assetURL + 'theme/woodden/wood.jpg")'; break;
                            case 'music': str = 'linear-gradient(#4b4b4b, #464646)'; break;
                            case 'simple': str = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4))'; break;
                        }
                        ui.css.player_stylesheet = lib.init.sheet('#window .player{background-image:' + str + '}');
                    }
                    if (lib.config.border_style &amp;&amp; lib.config.border_style != 'default' &amp;&amp; lib.config.border_style != 'custom' &amp;&amp; lib.config.border_style != 'auto') {
                        ui.css.border_stylesheet = lib.init.sheet();
                        var bstyle = lib.config.border_style;
                        if (bstyle.indexOf('dragon_') == 0) {
                            bstyle = bstyle.slice(7);
                        }
                        ui.css.border_stylesheet.sheet.insertRule('#window .player>.framebg,#window #arena.long.mobile:not(.fewplayer) .player[data-position="0"]>.framebg{display:block;background-image:url("' + lib.assetURL + 'theme/style/player/' + bstyle + '1.png")}', 0);
                        ui.css.border_stylesheet.sheet.insertRule('#window #arena.long:not(.fewplayer) .player>.framebg, #arena.oldlayout .player>.framebg{background-image:url("' + lib.assetURL + 'theme/style/player/' + bstyle + '3.png")}', 0);
                        ui.css.border_stylesheet.sheet.insertRule('.player>.count{z-index: 3 !important;border-radius: 2px !important;text-align: center !important;}', 0);
                    }
                    if (lib.config.control_style &amp;&amp; lib.config.control_style != 'default' &amp;&amp; lib.config.control_style != 'custom') {
                        var str = '';
                        switch (lib.config.control_style) {
                            case 'wood': str = 'url("' + lib.assetURL + 'theme/woodden/wood.jpg")'; break;
                            case 'music': str = 'linear-gradient(#4b4b4b, #464646);color:white;text-shadow:black 0 0 2px'; break;
                            case 'simple': str = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4));color:white;text-shadow:black 0 0 2px'; break;
                        }
                        if (lib.config.control_style == 'wood') {
                            ui.css.control_stylesheet = lib.init.sheet('#window .control,#window .menubutton,#window #system>div>div,#window #system>div>.pressdown2{background-image:' + str + '}');
                        }
                        else {
                            ui.css.control_stylesheet = lib.init.sheet('#window .control,.menubutton:not(.active):not(.highlight):not(.red):not(.blue),#window #system>div>div{background-image:' + str + '}');
                        }
                    }
                    if (lib.config.menu_style &amp;&amp; lib.config.menu_style != 'default' &amp;&amp; lib.config.menu_style != 'custom') {
                        var str = '';
                        switch (lib.config.menu_style) {
                            case 'wood': str = 'url("' + lib.assetURL + 'theme/woodden/wood2.png")'; break;
                            case 'music': str = 'linear-gradient(#4b4b4b, #464646);color:white;text-shadow:black 0 0 2px'; break;
                            case 'simple': str = 'linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4));color:white;text-shadow:black 0 0 2px'; break;
                        }
                        ui.css.menu_stylesheet = lib.init.sheet('html #window>.dialog.popped,html .menu,html .menubg{background-image:' + str + '}');
                    }
                    //part: ??
                    lib.config.duration = 500;
                    //part: add mouse/touch event listeners to document.
                    if (!lib.config.touchscreen) {
                        document.addEventListener('mousewheel', ui.click.windowmousewheel, { passive: true });
                        document.addEventListener('mousemove', ui.click.windowmousemove);
                        document.addEventListener('mousedown', ui.click.windowmousedown);
                        document.addEventListener('mouseup', ui.click.windowmouseup);
                        document.addEventListener('contextmenu', ui.click.right);
                    }
                    else {
                        document.addEventListener('touchstart', ui.click.touchconfirm);
                        document.addEventListener('touchstart', ui.click.windowtouchstart);
                        document.addEventListener('touchend', ui.click.windowtouchend);
                        document.addEventListener('touchmove', ui.click.windowtouchmove);
                    }
                };
                var proceed2 = function () {
                    if (config3) {
                        proceed(config3);
                    }
                    else {
                        config3 = true;
                    }
                };
                //part: ui.css.menuui.css.default
                ui.css = {
                    menu: lib.init.css(lib.assetURL + 'layout/default', 'menu', function () {
                        ui.css.default = lib.init.css(lib.assetURL + 'layout/default', 'layout');
                        proceed2();
                    })
                };
                //part: config for different type of devices(PC, mobile devices).
                if (lib.device) {
                    //window
                    lib.init.cordovaReady = function () {
                        if (lib.device == 'android') {
                            document.addEventListener("pause", function () {
                                if (!_status.paused2 &amp;&amp; (typeof _status.event.isMine == 'function' &amp;&amp; !_status.event.isMine())) {
                                    ui.click.pause();
                                }
                                if (ui.backgroundMusic) {
                                    ui.backgroundMusic.pause();
                                }
                            });
                            document.addEventListener("resume", function () {
                                if (ui.backgroundMusic) {
                                    ui.backgroundMusic.play();
                                }
                            });
                            document.addEventListener("backbutton", function () {
                                if (ui.arena &amp;&amp; ui.arena.classList.contains('menupaused')) {
                                    if (window.saveNonameInput) {
                                        window.saveNonameInput();
                                    }
                                    else {
                                        ui.click.configMenu();
                                    }
                                }
                                else if (lib.config.confirm_exit) {
                                    navigator.notification.confirm(
                                        '',
                                        function (index) {
                                            switch (index) {
                                                case 2: game.saveConfig('null'); game.reload(); break;
                                                case 3: navigator.app.exitApp(); break;
                                            }
                                        },
                                        '',
                                        ['', '', '']
                                    );
                                }
                                else {
                                    navigator.app.exitApp();
                                }
                            });
                        }
                        game.download = function (url, folder, onsuccess, onerror, dev, onprogress) {
                            if (url.indexOf('http') != 0) {
                                url = get.url(dev) + url;
                            }
                            var fileTransfer = new FileTransfer();
                            folder = lib.assetURL + folder;
                            if (onprogress) {
                                fileTransfer.onprogress = function (progressEvent) {
                                    onprogress(progressEvent.loaded, progressEvent.total);
                                };
                            }
                            lib.config.brokenFile.add(folder);
                            game.saveConfigValue('brokenFile');
                            fileTransfer.download(encodeURI(url), encodeURI(folder), function () {
                                lib.config.brokenFile.remove(folder);
                                game.saveConfigValue('brokenFile');
                                if (onsuccess) {
                                    onsuccess();
                                }
                            }, onerror);
                        };
                        game.readFile = function (filename, callback, onerror) {
                            window.resolveLocalFileSystemURL(lib.assetURL, function (entry) {
                                entry.getFile(filename, {}, function (fileEntry) {
                                    fileEntry.file(function (fileToLoad) {
                                        var fileReader = new FileReader();
                                        fileReader.onload = function (e) {
                                            callback(e.target.result);
                                        };
                                        fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                                    }, onerror);
                                }, onerror);
                            }, onerror);
                        };
                        game.writeFile = function (data, path, name, callback) {
                            game.ensureDirectory(path, function () { });
                            if (Object.prototype.toString.call(data) == '[object File]') {
                                var fileReader = new FileReader();
                                fileReader.onload = function (e) {
                                    game.writeFile(e.target.result, path, name, callback);
                                };
                                fileReader.readAsArrayBuffer(data, "UTF-8");
                            }
                            else {
                                window.resolveLocalFileSystemURL(lib.assetURL + path, function (entry) {
                                    entry.getFile(name, { create: true }, function (fileEntry) {
                                        fileEntry.createWriter(function (fileWriter) {
                                            fileWriter.onwriteend = callback;
                                            fileWriter.write(data);
                                        });
                                    });
                                });
                            }
                        };
                        game.removeFile = function (dir, callback) {
                            window.resolveLocalFileSystemURL(lib.assetURL, function (entry) {
                                entry.getFile(dir, {}, function (fileEntry) {
                                    fileEntry.remove();
                                    if (callback) {
                                        callback();
                                    }
                                });
                            });
                        };
                        game.getFileList = function (dir, callback) {
                            var files = [], folders = [];
                            window.resolveLocalFileSystemURL(lib.assetURL + dir, function (entry) {
                                var dirReader = entry.createReader();
                                var entries = [];
                                var readEntries = function () {
                                    dirReader.readEntries(function (results) {
                                        if (!results.length) {
                                            entries.sort();
                                            for (var i = 0; i &lt; entries.length; i++) {
                                                if (entries[i].isDirectory) {
                                                    folders.push(entries[i].name);
                                                }
                                                else {
                                                    files.push(entries[i].name);
                                                }
                                            }
                                            callback(folders, files);
                                        }
                                        else {
                                            entries = entries.concat(Array.from(results));
                                            readEntries();
                                        }
                                    });
                                };
                                readEntries();
                            });
                        };
                        game.ensureDirectory = function (list, callback, file) {
                            var directorylist;
                            var num = 0;
                            if (file) {
                                num = 1;
                            }
                            if (typeof list == 'string') {
                                directorylist = [list];
                            }
                            else {
                                var directorylist = list.slice(0);
                            }
                            window.resolveLocalFileSystemURL(lib.assetURL, function (rootEntry) {
                                var access = function (entry, dir, callback) {
                                    if (dir.length &lt;= num) {
                                        callback();
                                    }
                                    else {
                                        var str = dir.shift();
                                        entry.getDirectory(str, { create: false }, function (entry) {
                                            access(entry, dir, callback);
                                        }, function () {
                                            entry.getDirectory(str, { create: true }, function (entry) {
                                                access(entry, dir, callback);
                                            });
                                        });
                                    }
                                }
                                var createDirectory = function () {
                                    if (directorylist.length) {
                                        access(rootEntry, directorylist.shift().split('/'), createDirectory);
                                    }
                                    else {
                                        callback();
                                    }
                                };
                                createDirectory();
                            });
                        }
                        if (ui.updateUpdate) {
                            ui.updateUpdate();
                        }
                        var showbar = function () {
                            if (window.StatusBar) {
                                if (lib.device == 'android') {
                                    if (lib.config.show_statusbar_android) {
                                        window.StatusBar.overlaysWebView(false);
                                        window.StatusBar.backgroundColorByName('black');
                                        window.StatusBar.show();
                                    }
                                }
                                else if (lib.device == 'ios') {
                                    if (lib.config.show_statusbar_ios != 'off' &amp;&amp; lib.config.show_statusbar_ios != 'auto') {
                                        if (lib.config.show_statusbar_ios == 'default') {
                                            window.StatusBar.overlaysWebView(false);
                                        }
                                        else {
                                            window.StatusBar.overlaysWebView(true);
                                        }
                                        window.StatusBar.backgroundColorByName('black');
                                        window.StatusBar.show();
                                    }
                                }
                            }
                        }
                        if (lib.arenaReady) {
                            lib.arenaReady.push(showbar);
                        }
                        else {
                            showbar();
                        }
                    }
                }
                else if (typeof window.require == 'function') {
                    //part: PC
                    lib.node = {
                        fs: require('fs'),
                        debug: function () {
                            require('electron').remote.getCurrentWindow().toggleDevTools();
                        }
                    };
                    game.download = function (url, folder, onsuccess, onerror, dev, onprogress) {
                        if (url.indexOf('http') != 0) {
                            url = get.url(dev) + url;
                        }
                        game.ensureDirectory(folder, function () {
                            try {
                                var file = lib.node.fs.createWriteStream(__dirname + '/' + folder);
                            }
                            catch (e) {
                                onerror();
                            }
                            lib.config.brokenFile.add(folder);
                            game.saveConfigValue('brokenFile');
                            if (!lib.node.http) lib.node.http = require('http');
                            if (!lib.node.https) lib.node.https = require('https');
                            var opts = require('url').parse(encodeURI(url));
                            opts.headers = { 'User-Agent': 'AppleWebkit' };
                            var request = (url.indexOf('https') == 0 ? lib.node.https : lib.node.http).get(opts, function (response) {
                                var stream = response.pipe(file);
                                stream.on('finish', function () {
                                    lib.config.brokenFile.remove(folder);
                                    game.saveConfigValue('brokenFile');
                                    if (onsuccess) {
                                        onsuccess();
                                    }
                                });
                                stream.on('error', onerror);
                                if (onprogress) {
                                    var streamInterval = setInterval(function () {
                                        if (stream.closed) {
                                            clearInterval(streamInterval);
                                        }
                                        else {
                                            onprogress(stream.bytesWritten);
                                        }
                                    }, 200);
                                }
                            });
                        }, true);
                    };
                    game.readFile = function (filename, callback, onerror) {
                        lib.node.fs.readFile(__dirname + '/' + filename, function (err, data) {
                            if (err) {
                                onerror(err);
                            }
                            else {
                                callback(data);
                            }
                        });
                    };
                    game.writeFile = function (data, path, name, callback) {
                        game.ensureDirectory(path, function () { });
                        if (Object.prototype.toString.call(data) == '[object File]') {
                            var fileReader = new FileReader();
                            fileReader.onload = function (e) {
                                game.writeFile(e.target.result, path, name, callback);
                            };
                            fileReader.readAsArrayBuffer(data, "UTF-8");
                        }
                        else {
                            get.zip(function (zip) {
                                zip.file('i', data);
                                lib.node.fs.writeFile(__dirname + '/' + path + '/' + name, zip.files.i.asNodeBuffer(), null, callback);
                            });
                        }
                    };
                    game.removeFile = function (filename, callback) {
                        lib.node.fs.unlink(__dirname + '/' + filename, callback || function () { });
                    };
                    game.getFileList = function (dir, callback) {
                        var files = [], folders = [];
                        dir = __dirname + '/' + dir;
                        lib.node.fs.readdir(dir, function (err, filelist) {
                            for (var i = 0; i &lt; filelist.length; i++) {
                                if (filelist[i][0] != '.' &amp;&amp; filelist[i][0] != '_') {
                                    if (lib.node.fs.statSync(dir + '/' + filelist[i]).isDirectory()) {
                                        folders.push(filelist[i]);
                                    }
                                    else {
                                        files.push(filelist[i]);
                                    }
                                }
                            }
                            callback(folders, files);
                        });
                    };
                    game.ensureDirectory = function (list, callback, file) {
                        var directorylist;
                        var num = 0;
                        if (file) {
                            num = 1;
                        }
                        if (typeof list == 'string') {
                            directorylist = [list];
                        }
                        else {
                            var directorylist = list.slice(0);
                        }
                        var access = function (str, dir, callback) {
                            if (dir.length &lt;= num) {
                                callback();
                            }
                            else {
                                str += '/' + dir.shift();
                                lib.node.fs.access(__dirname + str, function (e) {
                                    if (e) {
                                        try {
                                            lib.node.fs.mkdir(__dirname + str, function () {
                                                access(str, dir, callback);
                                            });
                                        }
                                        catch (e) {
                                            console.log(e);
                                        }
                                    }
                                    else {
                                        access(str, dir, callback);
                                    }
                                });
                            }
                        }
                        var createDirectory = function () {
                            if (directorylist.length) {
                                access('', directorylist.shift().split('/'), createDirectory);
                            }
                            else {
                                callback();
                            }
                        };
                        createDirectory();
                    };
                    if (ui.updateUpdate) {
                        ui.updateUpdate();
                    }
                }
                else {
                    //part: 
                    window.onbeforeunload = function () {
                        if (lib.config.confirm_exit &amp;&amp; !_status.reloading) {
                            return ''
                        }
                        else {
                            return null;
                        }
                    }
                }
                //part: window.configconfig.js
                lib.config = window.config;
                //part: 
                lib.configOL = {};
                delete window.config;
                var config2;
                if (localStorage.getItem(lib.configprefix + 'nodb')) {
                    window.nodb = true;
                }
                //part: 
                //`config2` indexedDB/localStorageconfig`config2``config2``{}``false`config
                //config`ui.css``config2``config3``proceed`
                if (window.indexedDB &amp;&amp; !window.nodb) {
                    //part: indexedDB
                    var request = window.indexedDB.open(lib.configprefix + 'data', 4);
                    request.onupgradeneeded = function (e) {
                        var db = e.target.result;
                        if (!db.objectStoreNames.contains('video')) {
                            db.createObjectStore('video', { keyPath: 'time' });
                        }
                        if (!db.objectStoreNames.contains('image')) {
                            db.createObjectStore('image');
                        }
                        if (!db.objectStoreNames.contains('audio')) {
                            db.createObjectStore('audio');
                        }
                        if (!db.objectStoreNames.contains('config')) {
                            db.createObjectStore('config');
                        }
                        if (!db.objectStoreNames.contains('data')) {
                            db.createObjectStore('data');
                        }
                    };
                    request.onsuccess = function (e) {
                        lib.db = e.target.result;
                        //part: indexedDB config
                        game.getDB('config', null, function (obj) {
                            if (!obj.storageImported) {
                                try {
                                    config2 = JSON.parse(localStorage.getItem(lib.configprefix + 'config'));
                                    if (!config2 || typeof config2 != 'object') throw 'err'
                                }
                                catch (err) {
                                    config2 = {};
                                }
                                for (var i in config2) {
                                    game.saveConfig(i, config2[i]);
                                }
                                for (var i in lib.mode) {
                                    try {
                                        config2 = JSON.parse(localStorage.getItem(lib.configprefix + i));
                                        if (!config2 || typeof config2 != 'object' || get.is.empty(config2)) throw 'err'
                                    }
                                    catch (err) {
                                        config2 = false;
                                    }
                                    localStorage.removeItem(lib.configprefix + i);
                                    if (config2) {
                                        game.putDB('data', i, config2);
                                    }
                                }
                                game.saveConfig('storageImported', true);
                                //init background
                                lib.init.background();
                                localStorage.removeItem(lib.configprefix + 'config');
                            }
                            else {
                                config2 = obj;
                            }
                            proceed(config2);
                        });
                    }
                }
                else {
                    //part: localStorage
                    try {
                        config2 = JSON.parse(localStorage.getItem(lib.configprefix + 'config'));
                        if (!config2 || typeof config2 != 'object') throw 'err'
                    }
                    catch (err) {
                        config2 = {};
                        localStorage.setItem(lib.configprefix + 'config', JSON.stringify({}));
                    }
                    proceed(config2);
                }
            },
            /**
             * 
             * 
             * @function
             */
            reset: function () {
                if (window.inSplash) return;
                if (window.resetExtension) {
                    if (confirm('')) {
                        window.resetExtension();
                        window.location.reload();
                    }
                }
                else {
                    if (lib.device) {
                        if (navigator.notification) {
                            navigator.notification.confirm(
                                '',
                                function (index) {
                                    if (index == 2) {
                                        localStorage.removeItem('noname_inited');
                                        window.location.reload();
                                    }
                                    else if (index == 3) {
                                        var noname_inited = localStorage.getItem('noname_inited');
                                        var onlineKey = localStorage.getItem(lib.configprefix + 'key');
                                        localStorage.clear();
                                        if (noname_inited) {
                                            localStorage.setItem('noname_inited', noname_inited);
                                        }
                                        if (onlineKey) {
                                            localStorage.setItem(lib.configprefix + 'key', onlineKey);
                                        }
                                        if (indexedDB) indexedDB.deleteDatabase(lib.configprefix + 'data');
                                        setTimeout(function () {
                                            window.location.reload();
                                        }, 200);
                                    }
                                },
                                '',
                                ['', '', '']
                            );
                        }
                        else {
                            if (confirm('')) {
                                localStorage.removeItem('noname_inited');
                                window.location.reload();
                            }
                        }
                    }
                    else {
                        if (confirm('')) {
                            var onlineKey = localStorage.getItem(lib.configprefix + 'key');
                            localStorage.clear();
                            if (onlineKey) {
                                localStorage.setItem(lib.configprefix + 'key', onlineKey);
                            }
                            if (indexedDB) indexedDB.deleteDatabase(lib.configprefix + 'data');
                            setTimeout(function () {
                                window.location.reload();
                            }, 200);
                        }
                    }
                }
            },
            /**
             * 
             * @function
             */
            onload: function () {
                ui.updated();
                /**
                 * 
                 * @type {number}
                 */
                game.documentZoom = game.deviceZoom;
                if (game.documentZoom != 1) {
                    ui.updatez();
                }
                ui.background = ui.create.div('.background');
                ui.background.style.backgroundSize = "cover";
                ui.background.style.backgroundPosition = '50% 50%';
                if (lib.config.image_background &amp;&amp; lib.config.image_background != 'default' &amp;&amp; lib.config.image_background.indexOf('custom_') != 0) {
                    if (lib.config.image_background.indexOf('svg_') == 0) {
                        ui.background.setBackgroundImage('image/background/' + lib.config.image_background.slice(4) + '.svg');
                    }
                    else {
                        ui.background.setBackgroundImage('image/background/' + lib.config.image_background + '.jpg');
                        
                        ui.backgroundSVG = ui.create.div('.background',ui.background);
                        ui.backgroundSVG.setBackgroundImage('image/background/' + 'simple1_bg' + '.svg');
                        ui.backgroundSVG.style.opacity = '.3';
                    }
                    if (lib.config.image_background_blur) {
                        ui.background.style.filter = 'blur(8px)';
                        ui.background.style.webkitFilter = 'blur(8px)';
                        ui.background.style.transform = 'scale(1.05)';
                    }
                }
                document.documentElement.style.backgroundImage = '';
                document.documentElement.style.backgroundSize = '';
                document.documentElement.style.backgroundPosition = '';
                document.body.insertBefore(ui.background, document.body.firstChild);
                document.body.onresize = ui.updatexr;
                if (lib.config.touchscreen) {
                    document.body.addEventListener('touchstart', function (e) {
                        this.startX = e.touches[0].clientX / game.documentZoom;
                        this.startY = e.touches[0].clientY / game.documentZoom;
                        _status.dragged = false;
                    });
                    document.body.addEventListener('touchmove', function (e) {
                        if (_status.dragged) return;
                        if (Math.abs(e.touches[0].clientX / game.documentZoom - this.startX) > 10 ||
                            Math.abs(e.touches[0].clientY / game.documentZoom - this.startY) > 10) {
                            _status.dragged = true;
                        }
                    });
                }

                if (lib.config.image_background.indexOf('custom_') == 0) {
                    ui.background.style.backgroundImage = "none";
                    game.getDB('image', lib.config.image_background, function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            var data = fileLoadedEvent.target.result;
                            ui.background.style.backgroundImage = 'url(' + data + ')';
                            if (lib.config.image_background_blur) {
                                ui.background.style.filter = 'blur(8px)';
                                ui.background.style.webkitFilter = 'blur(8px)';
                                ui.background.style.transform = 'scale(1.05)';
                            }
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.card_style == 'custom') {
                    game.getDB('image', 'card_style', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.card_stylesheet) {
                                ui.css.card_stylesheet.remove();
                            }
                            ui.css.card_stylesheet = lib.init.sheet('.card:not(*:empty){background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.cardback_style == 'custom') {
                    game.getDB('image', 'cardback_style', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.cardback_stylesheet) {
                                ui.css.cardback_stylesheet.remove();
                            }
                            ui.css.cardback_stylesheet = lib.init.sheet('.card:empty,.card.infohidden{background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                    game.getDB('image', 'cardback_style2', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.cardback_stylesheet2) {
                                ui.css.cardback_stylesheet2.remove();
                            }
                            ui.css.cardback_stylesheet2 = lib.init.sheet('.card.infohidden:not(.infoflip){background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.hp_style == 'custom') {
                    game.getDB('image', 'hp_style1', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.hp_stylesheet1) {
                                ui.css.hp_stylesheet1.remove();
                            }
                            ui.css.hp_stylesheet1 = lib.init.sheet('.hp:not(.text):not(.actcount)[data-condition="high"]>div:not(.lost){background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                    game.getDB('image', 'hp_style2', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.hp_stylesheet2) {
                                ui.css.hp_stylesheet2.remove();
                            }
                            ui.css.hp_stylesheet2 = lib.init.sheet('.hp:not(.text):not(.actcount)[data-condition="mid"]>div:not(.lost){background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                    game.getDB('image', 'hp_style3', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.hp_stylesheet3) {
                                ui.css.hp_stylesheet3.remove();
                            }
                            ui.css.hp_stylesheet3 = lib.init.sheet('.hp:not(.text):not(.actcount)[data-condition="low"]>div:not(.lost){background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                    game.getDB('image', 'hp_style4', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.hp_stylesheet4) {
                                ui.css.hp_stylesheet4.remove();
                            }
                            ui.css.hp_stylesheet4 = lib.init.sheet('.hp:not(.text):not(.actcount)>.lost{background-image:url(' + fileLoadedEvent.target.result + ')}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.player_style == 'custom') {
                    ui.css.player_stylesheet = lib.init.sheet('#window .player{background-image:none;background-size:100% 100%;}');
                    game.getDB('image', 'player_style', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.player_stylesheet) {
                                ui.css.player_stylesheet.remove();
                            }
                            ui.css.player_stylesheet = lib.init.sheet('#window .player{background-image:url("' + fileLoadedEvent.target.result + '");background-size:100% 100%;}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.border_style == 'custom') {
                    game.getDB('image', 'border_style', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.border_stylesheet) {
                                ui.css.border_stylesheet.remove();
                            }
                            ui.css.border_stylesheet = lib.init.sheet();
                            ui.css.border_stylesheet.sheet.insertRule('#window .player>.framebg{display:block;background-image:url("' + fileLoadedEvent.target.result + '")}', 0);
                            ui.css.border_stylesheet.sheet.insertRule('.player>.count{z-index: 3 !important;border-radius: 2px !important;text-align: center !important;}', 0);
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.control_style == 'custom') {
                    game.getDB('image', 'control_style', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.control_stylesheet) {
                                ui.css.control_stylesheet.remove();
                            }
                            ui.css.control_stylesheet = lib.init.sheet('#window .control,.menubutton:not(.active):not(.highlight):not(.red):not(.blue),#window #system>div>div{background-image:url("' + fileLoadedEvent.target.result + '")}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }
                if (lib.config.menu_style == 'custom') {
                    game.getDB('image', 'menu_style', function (fileToLoad) {
                        if (!fileToLoad) return;
                        var fileReader = new FileReader();
                        fileReader.onload = function (fileLoadedEvent) {
                            if (ui.css.menu_stylesheet) {
                                ui.css.menu_stylesheet.remove();
                            }
                            ui.css.menu_stylesheet = lib.init.sheet('html #window>.dialog.popped,html .menu,html .menubg{background-image:url("' + fileLoadedEvent.target.result + '");background-size:cover}');
                        };
                        fileReader.readAsDataURL(fileToLoad, "UTF-8");
                    });
                }

                var proceed2 = function () {
                    var mode = lib.imported.mode;
                    var card = lib.imported.card;
                    var character = lib.imported.character;
                    var play = lib.imported.play;
                    delete window.game;
                    var i, j, k;
                    for (i in mode[lib.config.mode].element) {
                        if (!lib.element[i]) lib.element[i] = [];
                        for (j in mode[lib.config.mode].element[i]) {
                            if (j == 'init') {
                                if (!lib.element[i].inits) lib.element[i].inits = [];
                                lib.element[i].inits.push(mode[lib.config.mode].element[i][j]);
                            }
                            else {
                                lib.element[i][j] = mode[lib.config.mode].element[i][j];
                            }
                        }
                    }
                    for (i in mode[lib.config.mode].ai) {
                        if (typeof mode[lib.config.mode].ai[i] == 'object') {
                            if (ai[i] == undefined) ai[i] = {};
                            for (j in mode[lib.config.mode].ai[i]) {
                                ai[i][j] = mode[lib.config.mode].ai[i][j];
                            }
                        }
                        else {
                            ai[i] = mode[lib.config.mode].ai[i];
                        }
                    }
                    for (i in mode[lib.config.mode].ui) {
                        if (typeof mode[lib.config.mode].ui[i] == 'object') {
                            if (ui[i] == undefined) ui[i] = {};
                            for (j in mode[lib.config.mode].ui[i]) {
                                ui[i][j] = mode[lib.config.mode].ui[i][j];
                            }
                        }
                        else {
                            ui[i] = mode[lib.config.mode].ui[i];
                        }
                    }
                    for (i in mode[lib.config.mode].game) {
                        game[i] = mode[lib.config.mode].game[i];
                    }
                    for (i in mode[lib.config.mode].get) {
                        get[i] = mode[lib.config.mode].get[i];
                    }
                    lib.init.start = mode[lib.config.mode].start;
                    lib.init.startBefore = mode[lib.config.mode].startBefore;
                    if (game.onwash) {
                        lib.onwash.push(game.onwash);
                        delete game.onwash;
                    }
                    if (game.onover) {
                        lib.onover.push(game.onover);
                        delete game.onover;
                    }
                    lib.config.banned = lib.config[lib.config.mode + '_banned'] || [];
                    lib.config.bannedcards = lib.config[lib.config.mode + '_bannedcards'] || [];

                    lib.rank = window.noname_character_rank;
                    delete window.noname_character_rank;
                    for (i in mode[lib.config.mode]) {
                        if (i == 'element') continue;
                        if (i == 'game') continue;
                        if (i == 'ai') continue;
                        if (i == 'ui') continue;
                        if (i == 'get') continue;
                        if (i == 'config') continue;
                        if (i == 'onreinit') continue;
                        if (i == 'start') continue;
                        if (i == 'startBefore') continue;
                        if (lib[i] == undefined) lib[i] = (Array.isArray(mode[lib.config.mode][i])) ? [] : {};
                        for (j in mode[lib.config.mode][i]) {
                            lib[i][j] = mode[lib.config.mode][i][j];
                        }
                    }
                    if (typeof mode[lib.config.mode].init == 'function') {
                        mode[lib.config.mode].init();
                    }

                    var connectCharacterPack = [];
                    var connectCardPack = [];
                    for (i in character) {
                        if (character[i].character) {
                            lib.characterPack[i] = character[i].character
                        }
                        for (j in character[i]) {
                            if (j == 'mode' || j == 'forbid') continue;
                            if (j == 'connect') {
                                connectCharacterPack.push(i);
                                continue;
                            }
                            if (j == 'character' &amp;&amp; !lib.config.characters.contains(i) &amp;&amp; lib.config.mode != 'connect') {
                                if (lib.config.mode == 'chess' &amp;&amp; get.config('chess_mode') == 'leader' &amp;&amp; get.config('chess_leader_allcharacter')) {
                                    for (k in character[i][j]) {
                                        lib.hiddenCharacters.push(k);
                                    }
                                }
                                else if (lib.config.mode != 'boss' || i != 'boss') {
                                    continue;
                                }
                            }
                            if (Array.isArray(lib[j]) &amp;&amp; Array.isArray(character[i][j])) {
                                lib[j].addArray(character[i][j]);
                                continue;
                            }
                            for (k in character[i][j]) {
                                if (j == 'character') {
                                    if (!character[i][j][k][4]) {
                                        character[i][j][k][4] = [];
                                    }
                                    if (character[i][j][k][4].contains('boss') ||
                                        character[i][j][k][4].contains('hiddenboss')) {
                                        lib.config.forbidai.add(k);
                                    }
                                    if (lib.config.forbidai_user &amp;&amp; lib.config.forbidai_user.contains(k)) {
                                        lib.config.forbidai.add(k);
                                    }
                                    for (var l = 0; l &lt; character[i][j][k][3].length; l++) {
                                        lib.skilllist.add(character[i][j][k][3][l]);
                                    }
                                }
                                if (j == 'skill' &amp;&amp; k[0] == '_' &amp;&amp; (lib.config.mode != 'connect' ? (!lib.config.characters.contains(i)) : (!character[i].connect))) {
                                    continue;
                                }
                                if (j == 'translate' &amp;&amp; k == i) {
                                    lib[j][k + '_character_config'] = character[i][j][k];
                                }
                                else {
                                    if (lib[j][k] == undefined) {
                                        if (j == 'skill' &amp;&amp; !character[i][j][k].forceLoad &amp;&amp; lib.config.mode == 'connect' &amp;&amp; !character[i].connect) {
                                            lib[j][k] = {
                                                nopop: character[i][j][k].nopop,
                                                derivation: character[i][j][k].derivation
                                            };
                                        }
                                        else {
                                            lib[j][k] = character[i][j][k];
                                        }
                                        if (j == 'card' &amp;&amp; lib[j][k].derivation) {
                                            if (!lib.cardPack.mode_derivation) {
                                                lib.cardPack.mode_derivation = [k];
                                            }
                                            else {
                                                lib.cardPack.mode_derivation.push(k);
                                            }
                                        }
                                    }
                                    else if (Array.isArray(lib[j][k]) &amp;&amp; Array.isArray(character[i][j][k])) {
                                        lib[j][k].addArray(character[i][j][k]);
                                    }
                                    else {
                                        console.log('dublicate ' + j + ' in character ' + i + ':\n' + k + '\n' + ': ' + lib[j][k] + '\n' + character[i][j][k]);
                                    }
                                }
                            }
                        }
                    }
                    var connect_avatar_list = [];
                    for (var i in lib.character) {
                        connect_avatar_list.push(i);
                    }
                    connect_avatar_list.sort(lib.sort.capt);
                    for (var i = 0; i &lt; connect_avatar_list.length; i++) {
                        var ia = connect_avatar_list[i];
                        lib.mode.connect.config.connect_avatar.item[ia] = lib.translate[ia];
                    }
                    if (lib.config.mode != 'connect') {
                        var pilecfg = lib.config.customcardpile[get.config('cardpilename') || ''];
                        if (pilecfg) {
                            lib.config.bannedpile = get.copy(pilecfg[0] || {});
                            lib.config.addedpile = get.copy(pilecfg[1] || {});
                        }
                        else {
                            lib.config.bannedpile = {};
                            lib.config.addedpile = {};
                        }
                    }
                    else {
                        lib.cardPackList = {};
                    }
                    for (i in card) {
                        lib.cardPack[i] = [];
                        if (card[i].card) {
                            for (var j in card[i].card) {
                                if (!card[i].card[j].hidden &amp;&amp; card[i].translate[j + '_info']) {
                                    lib.cardPack[i].push(j);
                                }
                            }
                        }
                        for (j in card[i]) {
                            if (j == 'mode' || j == 'forbid') continue;
                            if (j == 'connect') {
                                connectCardPack.push(i);
                                continue;
                            }
                            if (j == 'list') {
                                if (lib.config.mode == 'connect') {
                                    lib.cardPackList[i] = card[i][j];
                                }
                                else {
                                    if (lib.config.cards.contains(i)) {
                                        var pile;
                                        if (typeof card[i][j] == 'function') {
                                            pile = card[i][j]();
                                        }
                                        else {
                                            pile = card[i][j];
                                        }
                                        lib.cardPile[i] = pile.slice(0);
                                        if (lib.config.bannedpile[i]) {
                                            for (var k = 0; k &lt; lib.config.bannedpile[i].length; k++) {
                                                pile[lib.config.bannedpile[i][k]] = null;
                                            }
                                        }
                                        for (var k = 0; k &lt; pile.length; k++) {
                                            if (!pile[k]) {
                                                pile.splice(k--, 1);
                                            }
                                        }
                                        if (lib.config.addedpile[i]) {
                                            for (var k = 0; k &lt; lib.config.addedpile[i].length; k++) {
                                                pile.push(lib.config.addedpile[i][k]);
                                            }
                                        }
                                        lib.card.list = lib.card.list.concat(pile);
                                    }
                                }
                            }
                            else {
                                for (k in card[i][j]) {
                                    if (j == 'skill' &amp;&amp; k[0] == '_' &amp;&amp; !card[i][j][k].forceLoad &amp;&amp; (lib.config.mode != 'connect' ? (!lib.config.cards.contains(i)) : (!card[i].connect))) {
                                        continue;
                                    }
                                    if (j == 'translate' &amp;&amp; k == i) {
                                        lib[j][k + '_card_config'] = card[i][j][k];
                                    }
                                    else {
                                        if (lib[j][k] == undefined) {
                                            if (j == 'skill' &amp;&amp; !card[i][j][k].forceLoad &amp;&amp; lib.config.mode == 'connect' &amp;&amp; !card[i].connect) {
                                                lib[j][k] = {
                                                    nopop: card[i][j][k].nopop,
                                                    derivation: card[i][j][k].derivation
                                                };
                                            }
                                            else {
                                                lib[j][k] = card[i][j][k];
                                            }
                                        }
                                        else console.log('dublicate ' + j + ' in card ' + i + ':\n' + k + '\n' + lib[j][k] + '\n' + card[i][j][k]);
                                        if (j == 'card' &amp;&amp; lib[j][k].derivation) {
                                            if (!lib.cardPack.mode_derivation) {
                                                lib.cardPack.mode_derivation = [k];
                                            }
                                            else {
                                                lib.cardPack.mode_derivation.push(k);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    if (lib.cardPack.mode_derivation) {
                        for (var i = 0; i &lt; lib.cardPack.mode_derivation.length; i++) {
                            if (typeof lib.card[lib.cardPack.mode_derivation[i]].derivation == 'string' &amp;&amp; !lib.character[lib.card[lib.cardPack.mode_derivation[i]].derivation]) {
                                lib.cardPack.mode_derivation.splice(i--, 1);
                            }
                            else if (typeof lib.card[lib.cardPack.mode_derivation[i]].derivationpack == 'string' &amp;&amp; !lib.config.cards.contains(lib.card[lib.cardPack.mode_derivation[i]].derivationpack)) {
                                lib.cardPack.mode_derivation.splice(i--, 1);
                            }
                        }
                        if (lib.cardPack.mode_derivation.length == 0) {
                            delete lib.cardPack.mode_derivation;
                        }
                    }
                    if (lib.config.mode != 'connect') {
                        for (i in play) {
                            if (lib.config.hiddenPlayPack.contains(i)) continue;
                            if (play[i].forbid &amp;&amp; play[i].forbid.contains(lib.config.mode)) continue;
                            if (play[i].mode &amp;&amp; play[i].mode.contains(lib.config.mode) == false) continue;
                            for (j in play[i].element) {
                                if (!lib.element[j]) lib.element[j] = [];
                                for (k in play[i].element[j]) {
                                    if (k == 'init') {
                                        if (!lib.element[j].inits) lib.element[j].inits = [];
                                        lib.element[j].inits.push(play[i].element[j][k]);
                                    }
                                    else {
                                        lib.element[j][k] = play[i].element[j][k];
                                    }
                                }
                            }
                            for (j in play[i].ui) {
                                if (typeof play[i].ui[j] == 'object') {
                                    if (ui[j] == undefined) ui[j] = {};
                                    for (k in play[i].ui[j]) {
                                        ui[j][k] = play[i].ui[j][k];
                                    }
                                }
                                else {
                                    ui[j] = play[i].ui[j];
                                }
                            }
                            for (j in play[i].game) {
                                game[j] = play[i].game[j];
                            }
                            for (j in play[i].get) {
                                get[j] = play[i].get[j];
                            }
                            for (j in play[i]) {
                                if (j == 'mode' || j == 'forbid' || j == 'init' || j == 'element' ||
                                    j == 'game' || j == 'get' || j == 'ui' || j == 'arenaReady') continue;
                                for (k in play[i][j]) {
                                    if (j == 'translate' &amp;&amp; k == i) {
                                        // lib[j][k+'_play_config']=play[i][j][k];
                                    }
                                    else {
                                        if (lib[j][k] != undefined) {
                                            console.log('dublicate ' + j + ' in play ' + i + ':\n' + k + '\n' + ': ' + lib[j][k] + '\n' + play[i][j][k]);
                                        }
                                        lib[j][k] = play[i][j][k];
                                    }
                                }
                            }
                            if (typeof play[i].init == 'function') play[i].init();
                            if (typeof play[i].arenaReady == 'function') lib.arenaReady.push(play[i].arenaReady);
                        }
                    }

                    lib.connectCharacterPack = [];
                    lib.connectCardPack = [];
                    for (var i = 0; i &lt; lib.config.all.characters.length; i++) {
                        var packname = lib.config.all.characters[i];
                        if (connectCharacterPack.contains(packname)) {
                            lib.connectCharacterPack.push(packname)
                        }
                    }
                    for (var i = 0; i &lt; lib.config.all.cards.length; i++) {
                        var packname = lib.config.all.cards[i];
                        if (connectCardPack.contains(packname)) {
                            lib.connectCardPack.push(packname)
                        }
                    }
                    if (lib.config.mode != 'connect') {
                        for (i = 0; i &lt; lib.card.list.length; i++) {
                            if (lib.card.list[i][2] == 'huosha') {
                                lib.card.list[i] = lib.card.list[i].slice(0);
                                lib.card.list[i][2] = 'sha';
                                lib.card.list[i][3] = 'fire';
                            }
                            else if (lib.card.list[i][2] == 'leisha') {
                                lib.card.list[i] = lib.card.list[i].slice(0);
                                lib.card.list[i][2] = 'sha';
                                lib.card.list[i][3] = 'thunder';
                            }
                            else if (lib.card.list[i][2] == 'haisha') {
                                lib.card.list[i] = lib.card.list[i].slice(0);
                                lib.card.list[i][2] = 'sha';
                                lib.card.list[i][3] = 'ocean';
                            }
                            else if (lib.card.list[i][2] == 'yamisha') {
                                lib.card.list[i] = lib.card.list[i].slice(0);
                                lib.card.list[i][2] = 'sha';
                                lib.card.list[i][3] = 'yami';
                            }
                            if (lib.card.list[i][2] == 'haitao') {
                                lib.card.list[i] = lib.card.list[i].slice(0);
                                lib.card.list[i][2] = 'tao';
                                lib.card.list[i][3] = 'ocean';
                            }
                            if (lib.card.list[i][2] == 'haijiu') {
                                lib.card.list[i] = lib.card.list[i].slice(0);
                                lib.card.list[i][2] = 'jiu';
                                lib.card.list[i][3] = 'ocean';
                            }
                            if (!lib.card[lib.card.list[i][2]]) {
                                lib.card.list.splice(i, 1); i--;
                            }
                            else if (lib.card[lib.card.list[i][2]].mode &amp;&amp;
                                lib.card[lib.card.list[i][2]].mode.contains(lib.config.mode) == false) {
                                lib.card.list.splice(i, 1); i--;
                            }
                        }
                    }

                    if (lib.config.mode == 'connect') {
                        _status.connectMode = true;
                    }
                    if (window.isNonameServer) {
                        lib.cheat.i();
                    }
                    else if (lib.config.dev &amp;&amp; (!_status.connectMode || lib.config.debug)) {
                        lib.cheat.i();
                    }
                    lib.config.sort_card = get.sortCard(lib.config.sort);
                    delete lib.imported.character;
                    delete lib.imported.card;
                    delete lib.imported.mode;
                    delete lib.imported.play;
                    for (var i in lib.init) {
                        if (i.indexOf('setMode_') == 0) {
                            delete lib.init[i];
                        }
                    }
                    if (!_status.connectMode) {
                        for (var i = 0; i &lt; lib.extensions.length; i++) {
                            try {
                                _status.extension = lib.extensions[i][0];
                                _status.evaluatingExtension = lib.extensions[i][3];
                                lib.extensions[i][1](lib.extensions[i][2], lib.extensions[i][4]);
                                if (lib.extensions[i][4]) {
                                    if (lib.extensions[i][4].character) {
                                        for (var j in lib.extensions[i][4].character.character) {
                                            game.addCharacterPack(get.copy(lib.extensions[i][4].character));
                                            break;
                                        }
                                    }
                                    if (lib.extensions[i][4].card) {
                                        for (var j in lib.extensions[i][4].card.card) {
                                            game.addCardPack(get.copy(lib.extensions[i][4].card));
                                            break;
                                        }
                                    }
                                    if (lib.extensions[i][4].skill) {
                                        for (var j in lib.extensions[i][4].skill.skill) {
                                            game.addSkill(j, lib.extensions[i][4].skill.skill[j],
                                                lib.extensions[i][4].skill.translate[j], lib.extensions[i][4].skill.translate[j + '_info']);
                                        }
                                    }
                                }
                                delete _status.extension;
                                delete _status.evaluatingExtension;
                            }
                            catch (e) {
                                console.log(e);
                            }
                        }
                    }
                    delete lib.extensions;

                    if (lib.init.startBefore) {
                        lib.init.startBefore();
                        delete lib.init.startBefore;
                    }
                    ui.create.arena();
                    game.createEvent('game', false).setContent(lib.init.start);
                    if (lib.mode[lib.config.mode] &amp;&amp; lib.mode[lib.config.mode].fromextension) {
                        var startstr = mode[lib.config.mode].start.toString();
                        if (startstr.indexOf('onfree') == -1) {
                            setTimeout(lib.init.onfree, 500);
                        }
                    }
                    delete lib.init.start;
                    game.loop();
                }
                var proceed = function () {
                    if (!lib.db) {
                        try {
                            lib.storage = JSON.parse(localStorage.getItem(lib.configprefix + lib.config.mode));
                            if (typeof lib.storage != 'object') throw ('err');
                            if (lib.storage == null) throw ('err');
                        }
                        catch (err) {
                            lib.storage = {};
                            localStorage.setItem(lib.configprefix + lib.config.mode, "{}");
                        }
                        proceed2();
                    }
                    else {
                        game.getDB('data', lib.config.mode, function (obj) {
                            lib.storage = obj || {};
                            proceed2();
                        });
                    }
                };
                if (!lib.imported.mode || !lib.imported.mode[lib.config.mode]) {
                    window.inSplash = true;
                    clearTimeout(window.resetGameTimeout);
                    delete window.resetGameTimeout;
                    var clickedNode = false;
                    var clickNode = function () {
                        if (clickedNode) return;
                        this.classList.add('clicked');
                        clickedNode = true;
                        lib.config.mode = this.link;
                        game.saveConfig('mode', this.link);
                        if (this.link == 'connect') {
                            localStorage.setItem(lib.configprefix + 'directstart', true);
                            game.reload();
                        }
                        else {
                            if (game.layout != 'mobile' &amp;&amp; lib.layoutfixed.indexOf(lib.config.mode) !== -1) {
                                game.layout = 'mobile';
                                ui.css.layout.href = lib.assetURL + 'layout/' + game.layout + '/layout.css';
                            }
                            else if (game.layout == 'mobile' &amp;&amp; lib.config.layout != 'mobile' &amp;&amp; lib.layoutfixed.indexOf(lib.config.mode) === -1) {
                                game.layout = lib.config.layout;
                                if (game.layout == 'default') {
                                    ui.css.layout.href = '';
                                }
                                else {
                                    ui.css.layout.href = lib.assetURL + 'layout/' + game.layout + '/layout.css';
                                }
                            }
                            splash.delete(1000);
                            delete window.inSplash;
                            window.resetGameTimeout = setTimeout(lib.init.reset, 5000);

                            this.listenTransition(function () {
                                lib.init.js(lib.assetURL + 'mode', lib.config.mode, proceed);
                            }, 500);
                        }
                    }
                    var downNode = function () {
                        this.classList.add('glow');
                    }
                    var upNode = function () {
                        this.classList.remove('glow');
                    }
                    var splash = ui.create.div('#splash', document.body);
                    if (lib.config.touchscreen) {
                        splash.classList.add('touch');
                        lib.setScroll(splash);
                    }
                    if (lib.config.player_border != 'wide') {
                        splash.classList.add('slim');
                    }
                    splash.dataset.radius_size = lib.config.radius_size;
                    for (var i = 0; i &lt; lib.config.all.mode.length; i++) {
                        var node = ui.create.div('.hidden', splash, clickNode);
                        node.link = lib.config.all.mode[i];
                        ui.create.div(node, '.splashtext', get.verticalStr(get.translation(lib.config.all.mode[i])));
                        if (lib.config.all.stockmode.indexOf(lib.config.all.mode[i]) != -1) {
                            ui.create.div(node, '.avatar').setBackgroundImage('image/splash/' + lib.config.all.mode[i] + '.jpg');
                        }
                        else {
                            var avatarnode = ui.create.div(node, '.avatar');
                            var avatarbg = lib.mode[lib.config.all.mode[i]].splash;
                            if (avatarbg.indexOf('ext:') == 0) {
                                avatarnode.setBackgroundImage(avatarbg.replace(/ext:/, 'extension/'));
                            }
                            else {
                                avatarnode.setBackgroundDB(avatarbg);
                            }
                        }
                        if (!lib.config.touchscreen) {
                            node.addEventListener('mousedown', downNode);
                            node.addEventListener('mouseup', upNode);
                            node.addEventListener('mouseleave', upNode);
                        }
                        setTimeout((function (node) {
                            return function () {
                                node.show();
                            }
                        }(node)), i * 100);
                    }
                    if (lib.config.mousewheel) {
                        splash.onmousewheel = ui.click.mousewheel;
                    }
                }
                else {
                    proceed();
                }
                localStorage.removeItem(lib.configprefix + 'directstart');
                delete lib.init.init;//??
            },
            startOnline: function () {
                'step 0'
                event._resultid = null;
                event._result = null;
                game.pause();
                'step 1'
                if (result) {
                    if (event._resultid) {
                        result.id = event._resultid;
                    }
                    game.send('result', result);
                }
                event.goto(0);
            },
            /**
             * 
             * @function
             */
            onfree: function () {
                if (lib.onfree) {
                    clearTimeout(window.resetGameTimeout);
                    delete window.resetGameTimeout;
                    if (!game.syncMenu) {
                        delete window.resetExtension;
                        localStorage.removeItem(lib.configprefix + 'disable_extension');
                    }

                    if (game.removeFile &amp;&amp; lib.config.brokenFile.length) {
                        while (lib.config.brokenFile.length) {
                            game.removeFile(lib.config.brokenFile.shift());
                        }
                        game.saveConfigValue('brokenFile');
                    }

                    var onfree = lib.onfree;
                    delete lib.onfree;
                    var loop = function () {
                        if (onfree.length) {
                            (onfree.shift())();
                            setTimeout(loop, 100);
                        }
                    };
                    setTimeout(loop, 500);
                }
            },
            connection: function (ws) {
                var client = {
                    ws: ws,
                    id: ws.wsid || get.id(),
                    closed: false
                };
                lib.node.clients.push(client);
                for (var i in lib.element.client) {
                    client[i] = lib.element.client[i];
                }
                if (window.isNonameServer) {
                    document.querySelector('#server_count').innerHTML = lib.node.clients.length;
                }
                ws.on('message', function (messagestr) {
                    var message;
                    try {
                        message = JSON.parse(messagestr);
                        if (!Array.isArray(message) ||
                            typeof lib.message.server[message[0]] !== 'function') {
                            throw ('err');
                        }
                        for (var i = 1; i &lt; message.length; i++) {
                            message[i] = get.parsedResult(message[i]);
                        }
                    }
                    catch (e) {
                        console.log(e);
                        console.log('invalid message: ' + messagestr);
                        return;
                    }
                    lib.message.server[message.shift()].apply(client, message);
                });
                ws.on('close', function () {
                    client.close();
                });
                client.send('opened');
            },
            /**
             * `&lt;style>`
             * @function
             * @param {...string} rules css rules
             * @returns {!HTMLStyleElement} `&lt;style>`
             */
            sheet: function () {
                var style = document.createElement('style');
                document.head.appendChild(style);
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'string') {
                        style.sheet.insertRule(arguments[i], 0);
                    }
                }
                return style;
            },
            /**
             * css
             * `&lt;link>``&lt;link>`
             * @function lib.init.css
             * @param {string} [path=null] css, null`&lt;link>`href
             * @param {string} file .csspathnull
             * @param {function():void} [before] onload`&lt;link>`
             */
            /**
             * css
             * `&lt;link>``&lt;link>`
             * @function lib.init.css
             * @variation 2
             * @param {string} [path=null] css, null`&lt;link>`href
             * @param {string} file .csspathnull
             * @param {HTMLLinkElement} [before] {@link HTMLLinkElement}`&lt;link>``before`
             * @returns {HTMLLinkElement} `&lt;link>`
             */
            css: function (path, file, before) {
                var style = document.createElement("link");
                style.rel = "stylesheet";
                if (path) {
                    style.href = path + '/' + file + ".css";
                }
                if (typeof before == 'function') {
                    style.addEventListener('load', before);
                    document.head.appendChild(style);
                }
                else if (before) {
                    document.head.insertBefore(style, before);
                }
                else {
                    document.head.appendChild(style);
                }
                return style;
            },
            /**
             * js
             * `&lt;script>`
             * @function lib.init.js
             * @param {!string} dir js, null`&lt;link>`href
             * @param {!string} file .jspathnull
             * @param {function():void} [onload] onload
             * @param {function():void} [onerror] onerror 
             * @returns {!HTMLScriptElement} `&lt;script>`
             */
            /**
             * js
             * `&lt;script>`
             * @function lib.init.js
             * @variation 2
             * @param {!string} path js, null`&lt;link>`href
             * @param {null} file .js
             * @param {function():void} [onload] onload
             * @param {function():void} [onerror] onerror 
             * @returns {!HTMLScriptElement} `&lt;script>`
             */
            /**
             * js
             * `&lt;script>`
             * @function lib.init.js
             * @variation 3
             * @param {!string} path js, null`&lt;link>`href
             * @param {Array&lt;string>} files 
             * @param {?function():void} [onload] onload`&lt;script>`
             * @param {?function():void} [onerror] onerror`&lt;script>`
             */
            js: function (path, file, onload, onerror) {
                if (path[path.length - 1] == '/') {
                    path = path.slice(0, path.length - 1);
                }
                //??
                if (path == lib.assetURL + 'mode' &amp;&amp; lib.config.all.stockmode.indexOf(file) == -1) {
                    lib.init['setMode_' + file]();
                    onload();
                    return;
                }
                if (Array.isArray(file)) {
                    for (var i = 0; i &lt; file.length; i++) {
                        lib.init.js(path, file[i], onload, onerror);
                    }
                }
                else {
                    var script = document.createElement('script');
                    if (!file) {
                        script.src = path;
                    }
                    else {
                        script.src = path + '/' + file + ".js";
                    }
                    if (path.indexOf('http') == 0) {
                        script.src += '?rand=' + get.id();
                        script.addEventListener('load', function () {
                            script.remove();
                        });
                    }
                    document.head.appendChild(script);
                    if (typeof onload == 'function') {
                        script.addEventListener('load', onload);
                        script.addEventListener('error', onerror);
                    }
                    return script;
                }
            },
            req: function (str, onload, onerror, master) {
                var sScriptURL;
                if (str.indexOf('http') == 0) {
                    sScriptURL = str;
                }
                else {
                    var url = get.url(master);
                    if (url[url.length - 1] != '/') {
                        url += '/';
                    }
                    sScriptURL = url + str;
                }
                var oReq = new XMLHttpRequest();
                if (onload) oReq.addEventListener("load", onload);
                if (onerror) oReq.addEventListener("error", onerror);
                oReq.open("GET", sScriptURL);
                oReq.send();
            },
            /**
             * json
             * @function
             * @param {!string} url url
             * @param {function(Object):void} onload 
             * @param {function():void} onerror 
             */
            json: function (url, onload, onerror) {
                var oReq = new XMLHttpRequest();
                if (onload) oReq.addEventListener("load", function () {
                    var result;
                    try {
                        result = JSON.parse(this.responseText);
                        if (!result) {
                            throw ('err');
                        }
                    }
                    catch (e) {
                        onerror();
                        return;
                    }
                    onload(result);
                });
                if (onerror) oReq.addEventListener("error", onerror);
                oReq.open("GET", url);
                oReq.send();
            },
            /**
             * 
             * @function
             */
            cssstyles: function () {
                if (ui.css.styles) {
                    ui.css.styles.remove();
                }
                ui.css.styles = lib.init.sheet();
                ui.css.styles.sheet.insertRule('#arena .player>.name,#arena .button.character>.name {font-family: ' + (lib.config.name_font || 'xinwei') + ',xinwei}', 0);
                ui.css.styles.sheet.insertRule('#arena .player .identity>div {font-family: ' + (lib.config.identity_font || 'huangcao') + ',xinwei}', 0);
                ui.css.styles.sheet.insertRule('.button.character.newstyle>.identity {font-family: ' + (lib.config.identity_font || 'huangcao') + ',xinwei}', 0);
                if (lib.config.cardtext_font &amp;&amp; lib.config.cardtext_font != 'default') {
                    ui.css.styles.sheet.insertRule('.card div:not(.info):not(.background) {font-family: ' + lib.config.cardtext_font + ';}', 0);
                }
                if (lib.config.global_font &amp;&amp; lib.config.global_font != 'default') {
                    ui.css.styles.sheet.insertRule('#window {font-family: ' + lib.config.global_font + ',xinwei}', 0);
                    ui.css.styles.sheet.insertRule('#window #control{font-family: STHeiti,SimHei,Microsoft JhengHei,Microsoft YaHei,WenQuanYi Micro Hei,Helvetica,Arial,sans-serif}', 0);
                }
                switch (lib.config.glow_phase) {
                    case 'yellow': ui.css.styles.sheet.insertRule('#arena .player:not(.selectable):not(.selected).glow_phase {box-shadow: rgba(0, 0, 0, 0.3) 0 0 0 1px, rgb(217, 152, 62) 0 0 15px, rgb(217, 152, 62) 0 0 15px !important;}', 0); break;
                    case 'green': ui.css.styles.sheet.insertRule('#arena .player:not(.selectable):not(.selected).glow_phase {box-shadow: rgba(0, 0, 0, 0.3) 0 0 0 1px, rgba(10, 155, 67, 1) 0 0 15px, rgba(10, 155, 67, 1) 0 0 15px !important;}', 0); break;
                    case 'purple': ui.css.styles.sheet.insertRule('#arena .player:not(.selectable):not(.selected).glow_phase {box-shadow: rgba(0, 0, 0, 0.3) 0 0 0 1px, rgb(189, 62, 170) 0 0 15px, rgb(189, 62, 170) 0 0 15px !important;}', 0); break;
                }
            },
            /**
             * 
             * @function
             * @param {string} layout 
             * @param {boolean} nosave 
             */
            layout: function (layout, nosave) {
                if (!nosave) game.saveConfig('layout', layout);
                game.layout = layout;
                ui.arena.hide();
                setTimeout(function () {
                    if (game.layout == 'default') {
                        ui.css.layout.href = '';
                    }
                    else {
                        ui.css.layout.href = lib.assetURL + 'layout/' + game.layout + '/layout.css';
                    }
                    if (game.layout == 'mobile' || game.layout == 'long') {
                        ui.arena.classList.add('mobile');
                    }
                    else {
                        ui.arena.classList.remove('mobile');
                    }
                    if (game.layout == 'mobile' || game.layout == 'long' || game.layout == 'long2' || game.layout == 'nova') {
                        if (game.me &amp;&amp; game.me.node.handcards2.childNodes.length) {
                            while (game.me.node.handcards2.childNodes.length) {
                                game.me.node.handcards1.appendChild(game.me.node.handcards2.firstChild);
                            }
                        }
                    }
                    if (game.layout == 'default') {
                        ui.arena.classList.add('oldlayout');
                    }
                    else {
                        ui.arena.classList.remove('oldlayout');
                    }
                    if (lib.config.cardshape == 'oblong' &amp;&amp; (game.layout == 'long' || game.layout == 'mobile' || game.layout == 'long2' || game.layout == 'nova')) {
                        ui.arena.classList.add('oblongcard');
                        ui.window.classList.add('oblongcard');
                    }
                    else {
                        ui.arena.classList.remove('oblongcard');
                        ui.window.classList.remove('oblongcard');
                    }
                    if (lib.config.textequip == 'text' &amp;&amp; (game.layout == 'long' || game.layout == 'mobile')) {
                        ui.arena.classList.add('textequip');
                    }
                    else {
                        ui.arena.classList.remove('textequip');
                    }
                    if (get.is.phoneLayout()) {
                        ui.css.phone.href = lib.assetURL + 'layout/default/phone.css';
                        ui.arena.classList.add('phone');
                    }
                    else {
                        ui.css.phone.href = '';
                        ui.arena.classList.remove('phone');
                    }
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (get.is.linked2(game.players[i])) {
                            if (game.players[i].classList.contains('linked')) {
                                game.players[i].classList.remove('linked');
                                game.players[i].classList.add('linked2');
                            }
                        }
                        else {
                            if (game.players[i].classList.contains('linked2')) {
                                game.players[i].classList.remove('linked2');
                                game.players[i].classList.add('linked');
                            }
                        }
                    }
                    if (game.layout == 'long' || game.layout == 'long2') {
                        ui.arena.classList.add('long');
                    }
                    else {
                        ui.arena.classList.remove('long');
                    }
                    if (lib.config.player_border != 'wide' || game.layout == 'long' || game.layout == 'long2') {
                        ui.arena.classList.add('slim_player');
                    }
                    else {
                        ui.arena.classList.remove('slim_player');
                    }
                    if (lib.config.player_border == 'normal' &amp;&amp; lib.config.mode != 'brawl' &amp;&amp; (game.layout == 'long' || game.layout == 'long2')) {
                        ui.arena.classList.add('lslim_player');
                    }
                    else {
                        ui.arena.classList.remove('lslim_player');
                    }
                    if (lib.config.player_border == 'slim') {
                        ui.arena.classList.add('uslim_player');
                    }
                    else {
                        ui.arena.classList.remove('uslim_player');
                    }
                    if (lib.config.player_border == 'narrow') {
                        ui.arena.classList.add('mslim_player');
                    }
                    else {
                        ui.arena.classList.remove('mslim_player');
                    }
                    ui.updatej();
                    ui.updatem();
                    setTimeout(function () {
                        ui.arena.show();
                        if (game.me) game.me.update();
                        setTimeout(function () {
                            ui.updatex();
                        }, 500);
                        setTimeout(function () {
                            ui.updatec();
                        }, 1000);
                    }, 100);
                }, 500);
            },
            /**
             * 
             * @function
             */
            background: function () {
                if (lib.config.image_background_random) {
                    var list = [];
                    for (var i in lib.configMenu.appearence.config.image_background.item) {
                        if (i == 'default') continue;
                        list.push(i);
                    }
                    list.remove(lib.config.image_background);
                    localStorage.setItem(lib.configprefix + 'background', JSON.stringify(list));
                }
                else if (lib.config.image_background &amp;&amp; lib.config.image_background != 'default' &amp;&amp; lib.config.image_background.indexOf('custom_') != 0) {
                    localStorage.setItem(lib.configprefix + 'background', lib.config.image_background);
                }
                else if (lib.config.image_background == 'default' &amp;&amp; lib.config.theme == 'simple') {
                    localStorage.setItem(lib.configprefix + 'background', 'ol_bg');
                }
                else {
                    localStorage.removeItem(lib.configprefix + 'background');
                }
            },
            parsex: function (func) {
                var k;
                var str = '(';
                str += func.toString();
                if (str.indexOf('step 0') == -1) {
                    str = str.replace(/\{/, '{{if(event.step==1) {event.finish();return;}');
                }
                else {
                    for (k = 1; k &lt; 99; k++) {
                        if (str.indexOf('step ' + k) == -1) break;
                        str = str.replace(new RegExp("'step " + k + "'", 'g'), "break;case " + k + ":");
                        str = str.replace(new RegExp('"step ' + k + '"', 'g'), "break;case " + k + ":");
                    }
                    str = str.replace(/'step 0'|"step 0"/, 'if(event.step==' + k + ') {event.finish();return;}switch(step){case 0:');
                }
                str += '})';
                return str;
            },
            parse: function (func) {
                var str = func.toString();
                //galgame
                str = str.replace(/(?!\.)galgame/g, 'game.galgame');

                str = str.slice(str.indexOf('{') + 1);
                if (str.indexOf('step 0') == -1) {
                    str = '{if(event.step==1) {event.finish();return;}' + str;
                }
                else {
                    for (var k = 1; k &lt; 99; k++) {
                        if (str.indexOf('step ' + k) == -1) break;
                        str = str.replace(new RegExp("'step " + k + "'", 'g'), "break;case " + k + ":");
                        str = str.replace(new RegExp('"step ' + k + '"', 'g'), "break;case " + k + ":");
                    }
                    str = str.replace(/'step 0'|"step 0"/, 'if(event.step==' + k + ') {event.finish();return;}switch(step){case 0:');
                }
                return (new Function('event', 'step', 'source', 'player', 'target', 'targets',
                    'card', 'cards', 'skill', 'forced', 'num', 'trigger', 'result',
                    '_status', 'lib', 'game', 'ui', 'get', 'ai', str));
            },
            /**
             * `{a:function(){}, b:function(){}}``{a: any, b: any}`
             * @function
             * @param {(function():any|Object&lt;string, function():any>)} func /
             * @returns {(any|Object&lt;string, any>)}
             */
            eval: function (func) {
                if (typeof func == 'function') {
                    return eval('(' + func.toString() + ')');
                }
                else if (typeof func == 'object') {
                    for (var i in func) {
                        if (func.hasOwnProperty(i)) {
                            func[i] = lib.init.eval(func[i]);
                        }
                    }
                }
                return func;
            },
            /**
             * 
             * @function
             * @param {string} strUni 
             * @returns 
             */
            encode: function (strUni) {
                var strUtf = strUni.replace(
                    /[\u0080-\u07ff]/g, function (c) {
                        var cc = c.charCodeAt(0);
                        return String.fromCharCode(0xc0 | cc >> 6, 0x80 | cc &amp; 0x3f);
                    });
                strUtf = strUtf.replace(
                    /[\u0800-\uffff]/g, function (c) {
                        var cc = c.charCodeAt(0);
                        return String.fromCharCode(0xe0 | cc >> 12, 0x80 | cc >> 6 &amp; 0x3F, 0x80 | cc &amp; 0x3f);
                    });
                return btoa(strUtf);
            },
            /**
             * 
             * @function
             * @param {string} str 
             * @returns {string} 
             */
            decode: function (str) {
                var strUtf = atob(str);
                var strUni = strUtf.replace(
                    /[\u00e0-\u00ef][\u0080-\u00bf][\u0080-\u00bf]/g, function (c) {
                        var cc = ((c.charCodeAt(0) &amp; 0x0f) &lt;&lt; 12) | ((c.charCodeAt(1) &amp; 0x3f) &lt;&lt; 6) | (c.charCodeAt(2) &amp; 0x3f);
                        return String.fromCharCode(cc);
                    });
                strUni = strUni.replace(
                    /[\u00c0-\u00df][\u0080-\u00bf]/g, function (c) {
                        var cc = (c.charCodeAt(0) &amp; 0x1f) &lt;&lt; 6 | c.charCodeAt(1) &amp; 0x3f;
                        return String.fromCharCode(cc);
                    });
                return strUni;
            },
            /**
             * jsjson
             * @function
             * @returns {!string} 
             */
            stringify: function (obj) {
                var str = '{'
                for (var i in obj) {
                    str += '"' + i + '":'
                    if (Object.prototype.toString.call(obj[i]) == '[object Object]') {
                        str += lib.init.stringify(obj[i]);
                    }
                    else if (typeof obj[i] == 'function') {
                        str += obj[i].toString();
                    }
                    else {
                        str += JSON.stringify(obj[i]);
                    }
                    str += ','
                }
                str += '}';
                return str;
            },
            /**
             * json
             * @function
             * @returns {!string} 
             */
            stringifySkill: function (obj) {
                var str = '';
                for (var i in obj) {
                    str += i + ':'
                    if (Object.prototype.toString.call(obj[i]) == '[object Object]') {
                        str += '{\n' + lib.init.stringifySkill(obj[i]) + '}';
                    }
                    else if (typeof obj[i] == 'function') {
                        str += obj[i].toString().replace(/\t/g, '');
                    }
                    else {
                        str += JSON.stringify(obj[i]);
                    }
                    str += ',\n'
                }
                return str;
            }
        },
        /**
         * 
         * @name cheat
         */
        cheat: {
            i: function () {
                window.cheat = lib.cheat;
                window.game = game;
                window.ui = ui;
                window.get = get;
                window.ai = ai;
                window.lib = lib;
                window._status = _status;
            },
            dy: function () {
                var next = game.me.next;
                for (var i = 0; i &lt; 10; i++) {
                    if (next.identity != 'zhu') {
                        break;
                    }
                    next = next.next;
                }
                next.die();
            },
            x: function () {
                var gl = function (dir, callback) {
                    var files = [], folders = [];
                    dir = '/Users/widget/Documents/extension/' + dir;
                    lib.node.fs.readdir(dir, function (err, filelist) {
                        for (var i = 0; i &lt; filelist.length; i++) {
                            if (filelist[i][0] != '.' &amp;&amp; filelist[i][0] != '_') {
                                if (lib.node.fs.statSync(dir + '/' + filelist[i]).isDirectory()) {
                                    folders.push(filelist[i]);
                                }
                                else {
                                    files.push(filelist[i]);
                                }
                            }
                        }
                        callback(folders, files);
                    });
                }
                var args = Array.from(arguments);
                for (var i = 0; i &lt; args.length; i++) {
                    args[i] = args[i][0];
                }
                gl('', function (list) {
                    if (args.length) {
                        for (var i = 0; i &lt; list.length; i++) {
                            if (!args.contains(list[i][0])) {
                                list.splice(i--, 1);
                            }
                        }
                    }
                    if (list.length) {
                        for (var i = 0; i &lt; list.length; i++) {
                            (function (str) {
                                gl(str, function (folders, files) {
                                    if (files.length > 1) {
                                        for (var i = 0; i &lt; files.length; i++) {
                                            if (files[i].indexOf('extension.js') != -1) {
                                                files.splice(i--, 1);
                                            }
                                            else {
                                                if (i % 5 == 0) {
                                                    str += '\n\t\t\t';
                                                }
                                                str += '"' + files[i] + '",';
                                            }
                                        }
                                        console.log(str.slice(0, str.length - 1));
                                    }
                                });
                            }(list[i]));
                        }
                    }
                });
            },
            cfg: function () {
                var mode = lib.config.all.mode.slice(0);
                mode.remove('connect');
                mode.remove('brawl');
                var banned = ['shen_guanyu', 'shen_caocao', 'caopi', 're_daqiao', 'caorui',
                    'daqiao', 'lingcao', 'liuzan', 'lusu', 'luxun', 'yanwen', 'zhouyu', 'ns_wangyue', 'gw_yenaifa',
                    'old_caozhen', 'swd_jiangziya', 'xuhuang', 'maliang', 'guojia', 'simayi', 'swd_kangnalishi', 'hs_siwangzhiyi', 'hs_nozdormu', 'old_zhuzhi'];
                var bannedcards = ['zengbin'];
                var favs = ["hs_tuoqi", "hs_siwangxianzhi", "hs_xukongzhiying", "hs_hsjiasha", "gjqt_xieyi", "gjqt_yunwuyue", "gjqt_beiluo",
                    "gjqt_cenying", "shen_lvmeng", "shen_zhaoyun", "shen_zhugeliang", "ow_ana", "chenlin", "ns_guanlu", "hs_guldan", "swd_guyue",
                    "pal_jiangyunfan", "mtg_jiesi", "swd_lanyin", "pal_liumengli", "swd_muyun", "pal_nangonghuang", "swd_muyue", "pal_murongziying",
                    "swd_qiner", "pal_shenqishuang", "hs_taisi", "wangji", "pal_xingxuan", "xunyou", "hs_yelise", "pal_yuejinzhao", "pal_yueqi",
                    "gjqt_yuewuyi", "swd_yuxiaoxue", "ow_zhaliya", "zhangchunhua", "hs_zhihuanhua", "swd_zhiyin", "old_zhonghui", "gjqt_bailitusu",
                    "hs_barnes", "ow_dva", "swd_hengai", "pal_jushifang", "hs_kazhakusi", "hs_lafamu", "ow_liekong", "hs_lreno", "pal_mingxiu",
                    "swd_murongshi", "gw_oudimu", "gjqt_ouyangshaogong", "hs_pyros", "qinmi", "gw_sanhanya", "hs_selajin", "swd_shuwaner",
                    "swd_situqiang", "hs_xialikeer", "pal_xuejian", "swd_yuchiyanhong", "swd_yuwentuo", "swd_zhaoyun", "zhugeliang", "gw_aigeleisi",
                    "gw_aimin", "gjqt_aruan", "hs_aya", "swd_cheyun", "swd_chenjingchou", "gw_diandian", "swd_huzhongxian", "hs_jinglinglong",
                    "hs_kaituozhe", "hs_kalimosi", "gw_linjing", "ow_luxiao", "re_luxun", "hs_morgl", "swd_sikongyu", "hs_sthrall", "sunquan",
                    "sunshangxiang", "gw_yioufeisisp", "gw_yisilinni", "hs_yogg", "hs_ysera", "pal_yuntianhe", "zhugejin", "zhugeke", "gw_zhuoertan",
                    "hs_anduin", "swd_anka", "ow_banzang", "ow_chanyata", "diaochan", "swd_duguningke", "sp_diaochan", "hetaihou", "ns_huamulan",
                    "swd_huanglei", "swd_huanyuanzhi", "re_huatuo", "gw_huoge", "pal_jiangcheng", "yj_jushou", "swd_kendi", "yxs_libai",
                    "mtg_lilianna", "xin_liru", "liuxie", "pal_lixiaoyao", "pal_longkui", "ns_nanhua", "swd_qi", "swd_septem", "gw_shasixiwusi",
                    "ow_tianshi", "swd_weida", "gjqt_xiayize", "swd_xiyan", "hs_xsylvanas", "hs_yelinlonghou", "ow_yuanshi", "zuoci"];
                var vintage = ['tianjian', 'shuiyun', 'zhuyue', 'zhimeng', 'poyun', 'qianfang', 'xfenxin', 'danqing', 'ywuhun', 'tianwu', 'xuelu',
                    'shahun', 'yuling', 'duhun', 'liaoyuan', 'touxi', 'wangchen', 'poyue', 'kunlunjing', 'huanhun', 'yunchou', 'tuzhen', 'cyqiaoxie',
                    'mufeng', 'duanyi', 'guozao', 'yaotong', 'pozhen', 'tanlin', 'susheng', 'jikong', 'shouyin', 'jilve', 'hxunzhi', 'huodan', 'shanxian',
                    'ziyu', 'kuoyin', 'feiren', 'zihui', 'jidong', 'baoxue', 'aqianghua', 'maoding', 'bfengshi', 'zhongdun', 'pingzhang', 'maichong',
                    'guozai', 'jingxiang', 'yuelu', 'liechao', 'fengnu', 'hanshuang', 'enze', 'malymowang', 'xshixin', 'qingzun'];
                var favmodes = ["versus|three", "versus|four", "versus|two", "chess|combat"];
                for (var i = 0; i &lt; mode.length; i++) {
                    game.saveConfig(mode[i] + '_banned', banned);
                    game.saveConfig(mode[i] + '_bannedcards', bannedcards);
                }
                var characters = lib.config.all.characters.slice(0);
                characters.remove('standard');
                characters.remove('old');
                game.saveConfig('vintageSkills', vintage);
                game.saveConfig('favouriteCharacter', favs);
                game.saveConfig('favouriteMode', favmodes);
                game.saveConfig('theme', 'simple');
                game.saveConfig('player_border', 'slim');
                game.saveConfig('cards', lib.config.all.cards);
                game.saveConfig('characters', characters);
                game.saveConfig('change_skin', false);
                game.saveConfig('show_splash', 'off');
                game.saveConfig('show_favourite', false);
                game.saveConfig('animation', false);
                game.saveConfig('hover_all', false);
                game.saveConfig('asset_version', 'v1.9');
                // game.saveConfig('characters',lib.config.all.characters);
                // game.saveConfig('cards',lib.config.all.cards);
                game.saveConfig('plays', ['cardpile']);
                game.saveConfig('skip_shan', false);
                game.saveConfig('tao_enemy', true);
                game.saveConfig('layout', 'long2');
                game.saveConfig('hp_style', 'ol');
                game.saveConfig('background_music', 'music_off');
                game.saveConfig('background_audio', false);
                game.saveConfig('background_speak', false);
                game.saveConfig('show_volumn', false);
                game.saveConfig('show_replay', true);
                game.saveConfig('autostyle', true);
                game.saveConfig('debug', true);
                game.saveConfig('dev', true);
                if (!lib.device) {
                    game.saveConfig('sync_speed', false);
                }
                game.reload();
            },
            o: function () {
                ui.arena.classList.remove('observe');
            },
            pt: function () {
                var list = Array.from(arguments);
                while (list.length) {
                    var card = cheat.gn(list.pop());
                    if (card) ui.cardPile.insertBefore(card, ui.cardPile.firstChild);
                }
            },
            q: function () {
                // if(lib.config.layout!='mobile') lib.init.layout('mobile');
                if (arguments.length == 0) {
                    var style = ui.css.card_style;
                    if (lib.config.card_style != 'simple') {
                        lib.config.card_style = 'simple';
                        ui.css.card_style = lib.init.css(lib.assetURL + 'theme/style/card', 'simple');
                    }
                    else {
                        lib.config.card_style = 'default';
                        ui.css.card_style = lib.init.css(lib.assetURL + 'theme/style/card', 'default');
                    }
                    style.remove();
                }
                else {
                    for (var i = 0; i &lt; arguments.length; i++) {
                        cheat.g(arguments[i]);
                    }
                }
                ui.arena.classList.remove('selecting');
                ui.arena.classList.remove('tempnoe');
            },
            p: function (name, i, skin) {
                var list = ['swd', 'hs', 'pal', 'gjqt', 'ow', 'gw'];
                if (!lib.character[name]) {
                    for (var j = 0; j &lt; list.length; j++) {
                        if (lib.character[list[j] + '_' + name]) {
                            name = list[j] + '_' + name; break;
                        }
                    }
                }
                if (skin) {
                    lib.config.skin[name] = skin
                }
                var target;
                if (typeof i == 'number') {
                    target = game.players[i];
                }
                else {
                    target = game.me.next;
                }
                if (!lib.character[name]) {
                    target.node.avatar.setBackground(name, 'character');
                    target.node.avatar.show();
                }
                else {
                    target.init(name);
                }
                if (i === true) {
                    if (lib.config.layout == 'long2') {
                        lib.init.layout('mobile');
                    }
                    else {
                        lib.init.layout('long2');
                    }
                }
            },
            e: function () {
                var cards = [], target;
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (get.itemtype(arguments[i]) == 'player') {
                        target = arguments[i];
                    }
                    else {
                        cards.push(game.createCard(arguments[i]));
                    }
                }
                if (!cards.length) {
                    cards.push(game.createCard('qilin'));
                    cards.push(game.createCard('bagua'));
                    cards.push(game.createCard('dilu'));
                    cards.push(game.createCard('chitu'));
                    cards.push(game.createCard('muniu'));
                }
                target = target || game.me;
                for (var i = 0; i &lt; cards.length; i++) {
                    var card = target.getEquip(cards[i]);
                    if (card) {
                        card.discard();
                        target.removeEquipTrigger(card);
                    }
                    target.$equip(cards[i]);
                }
            },
            c: function () {
                // (function () {
                //     var a = 0, b = 0, c = 0, d = 0, e = 0, f = 0, g = 0, h = 0, i = 0, j = 0, k = 0, l = 0, m = 0;
                //     var sa = 0, sb = 0, sc = 0, sd = 0, se = 0, sf = 0, sg = 0, sh = 0, si = 0, sj = 0, sk = 0, sl = 0, sm = 0;
                //     for (var i in lib.character) {
                //         switch (lib.character[i][1]) {
                //             case 'wei': a++; if (lib.config.banned.contains(i)) sa++; break;
                //             case 'shu': b++; if (lib.config.banned.contains(i)) sb++; break;
                //             case 'wu': c++; if (lib.config.banned.contains(i)) sc++; break;
                //             case 'qun': d++; if (lib.config.banned.contains(i)) sd++; break;
                //             case 'western': e++; if (lib.config.banned.contains(i)) se++; break;
                //             case 'key': f++; if (lib.config.banned.contains(i)) sf++; break;
                //             case 'holo': g++; if (lib.config.banned.contains(i)) sg++; break;
                //             case 'nijisanji': h++; if (lib.config.banned.contains(i)) sh++; break;
                //             case 'VirtuaReal': i++; if (lib.config.banned.contains(i)) si++; break;
                //             case 'HappyElements': i++; if (lib.config.banned.contains(i)) si++; break;
                //             case 'upd8': j++; if (lib.config.banned.contains(i)) sj++; break;
                //             case 'dotlive': k++; if (lib.config.banned.contains(i)) sk++; break;
                //             case 'eilene': l++; if (lib.config.banned.contains(i)) sl++; break;
                //             case 'paryi': m++; if (lib.config.banned.contains(i)) sm++; break;
                //             case 'kagura': n++; if (lib.config.banned.contains(i)) sn++; break;
                //             case 'nanashi': o++; if (lib.config.banned.contains(i)) so++; break;
                //             case 'psp': p++; if (lib.config.banned.contains(i)) sp++; break;
                //             case 'asoul': q++; if (lib.config.banned.contains(i)) sq++; break;
                //             case 'nori': r++; if (lib.config.banned.contains(i)) sr++; break;
                //             case 'vwp': s++; if (lib.config.banned.contains(i)) ss++; break;
                //             case 'vshojo': t++; if (lib.config.banned.contains(i)) st++; break;
                //             case 'xuyan': u++; if (lib.config.banned.contains(i)) su++; break;
                //             case 'chaos': v++; if (lib.config.banned.contains(i)) sv++; break;
                //             case 'xuefeng': w++; if (lib.config.banned.contains(i)) sw++; break;
                //             case 'ego': w++; if (lib.config.banned.contains(i)) sw++; break;
                //             case 'chidori': w++; if (lib.config.banned.contains(i)) sw++; break;
                //         }
                //     }
                //     console.log('' + (a - sa) + '/' + a);
                //     console.log('' + (b - sb) + '/' + b);
                //     console.log('' + (c - sc) + '/' + c);
                //     console.log('' + (d - sd) + '/' + d);
                //     console.log('' + (e - se) + '/' + e);
                //     console.log('' + (f - sf) + '/' + f);
                //     console.log('' + (g - sg) + '/' + g);
                //     console.log('' + (h - sh) + '/' + h);
                //     console.log('U' + (j - sj) + '/' + j);
                //     console.log('' + (k - sk) + '/' + k);
                //     console.log('' + ((a + b + c + d + e + f + g + h + i + j + k + l + m) - (sa + sb + sc + sd + se + sf + sg + sh + hi + sj + sk + sl + sm)) + '/' + (a + b + c + d + e + f + g + h + i + j + k + l + m));
                // }());
                (function () {
                    var a = 0, b = 0, c = 0, d = 0;
                    var aa = 0, bb = 0, cc = 0, dd = 0;
                    var sa = 0, sb = 0, sc = 0, sd = 0;
                    var sha = 0, shan = 0, tao = 0, jiu = 0, wuxie = 0, heisha = 0, hongsha = 0;
                    var num = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0 };
                    for (var i in lib.card) {
                        if (get.objtype(lib.card[i]) == 'object' &amp;&amp; lib.translate[i + '_info']) {
                            switch (lib.card[i].type) {
                                case 'basic': a++; break;
                                case 'trick': b++; break;
                                case 'equip': c++; break;
                                default: d++; break;
                            }
                        }
                    }
                    for (var i = 0; i &lt; lib.card.list.length; i++) {
                        if (typeof lib.card[lib.card.list[i][2]] == 'object') {
                            switch (lib.card[lib.card.list[i][2]].type) {
                                case 'basic': aa++; break;
                                case 'trick': case 'delay': bb++; break;
                                case 'equip': cc++; break;
                                default: dd++; break;
                            }
                            switch (lib.card.list[i][0]) {
                                case 'heart': sa++; break;
                                case 'diamond': sb++; break;
                                case 'club': sc++; break;
                                case 'spade': sd++; break;
                            }
                            if (lib.card.list[i][2] == 'sha') {
                                sha++;
                                if (lib.card.list[i][0] == 'club' || lib.card.list[i][0] == 'spade') {
                                    heisha++;
                                }
                                else {
                                    hongsha++;
                                }
                            }
                            if (lib.card.list[i][2] == 'shan') {
                                shan++;
                            }
                            if (lib.card.list[i][2] == 'tao') {
                                tao++;
                            }
                            if (lib.card.list[i][2] == 'jiu') {
                                jiu++;
                            }
                            if (lib.card.list[i][2] == 'wuxie') {
                                wuxie++;
                            }
                            num[lib.card.list[i][1]]++;
                        }
                    }
                    var str = '' + aa + ' ' + '' + bb + ' ' + '' + cc + ' ' + '' + dd
                    console.log(str);
                    str = '' + sa + ' ' + '' + sb + ' ' + '' + sc + ' ' + '' + sd
                    console.log(str);
                    str = '' + sha + ' ' + '' + heisha + ' ' + '' + hongsha + ' ' + '' + shan + ' ' + '' + tao + ' ' + '' + jiu + ' ' + '' + wuxie
                    console.log(str);
                    if (arguments[1]) {
                        for (var i = 1; i &lt;= 13; i++) {
                            if (i &lt; 10) {
                                console.log(i + ' ', num[i]);
                            }
                            else {
                                console.log(i, num[i]);
                            }
                        }
                    }
                    var arr = [];
                    for (var i = 1; i &lt;= 13; i++) {
                        arr.push(num[i]);
                    }
                    console.log((a + b + c + d) + '/' + (aa + bb + cc + dd), ...arr)
                }());
            },
            id: function () {
                game.showIdentity();
            },
            b: function () {
                if (!ui.dialog || !ui.dialog.buttons) return;
                for (var i = 0; i &lt; Math.min(arguments.length, ui.dialog.buttons.length); i++) {
                    ui.dialog.buttons[i].link = arguments[i];
                }
            },
            uy: function (me) {
                if (me) {
                    game.me.useCard({ name: 'spell_yexinglanghun' }, game.me);
                }
                else {
                    var enemy = game.me.getEnemy();
                    enemy.useCard({ name: 'spell_yexinglanghun' }, enemy);
                }
            },
            gs: function (name, act) {
                var card = game.createCard('spell_' + (name || 'yexinglanghun'));
                game.me.node.handcards1.appendChild(card);
                if (!act) {
                    game.me.actused = -99;
                }
                ui.updatehl();
                delete _status.event._cardChoice;
                delete _status.event._targetChoice;
                delete _status.event._skillChoice;
                setTimeout(game.check, 300);
            },
            gc: function (name, act) {
                var card = game.createCard('stone_' + (name || 'falifulong') + '_stonecharacter');
                game.me.node.handcards1.appendChild(card);
                if (!act) {
                    game.me.actused = -99;
                }
                ui.updatehl();
                delete _status.event._cardChoice;
                delete _status.event._targetChoice;
                delete _status.event._skillChoice;
                setTimeout(game.check, 300);
            },
            a: function (bool) {
                if (lib.config.test_game) {
                    game.saveConfig('test_game');
                }
                else {
                    if (bool) {
                        if (typeof bool === 'string') {
                            game.saveConfig('test_game', bool);
                        }
                        else {
                            game.saveConfig('test_game', '_');
                        }
                    }
                    else {
                        game.saveConfig('test_game', true);
                    }
                }
                game.reload();
            },
            as: function () {
                ui.window.classList.remove('testing');
                var bg = ui.window.querySelector('.pausedbg');
                if (bg) {
                    bg.remove();
                }
            },
            uj: function () {
                cheat.e('qilin');
                game.me.next.useCard({ name: 'jiedao' }, [game.me, game.me.previous]);
            },
            u: function () {
                var card = { name: 'sha' }, source = game.me.next, targets = [];
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (get.itemtype(arguments[i]) == 'player') {
                        source = arguments[i];
                    }
                    else if (Array.isArray(arguments[i])) {
                        targets = arguments[i];
                    }
                    else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                        card = arguments[i];
                    }
                    else if (typeof arguments[i] == 'string') {
                        card = { name: arguments[i] }
                    }
                }
                if (!targets.length) targets.push(game.me);
                source.useCard(game.createCard(card.name, card.suit, card.number, card.nature), targets);
            },
            r: function (bool) {
                var list = ['s', 'ap', 'a', 'am', 'bp', 'b', 'bm', 'c', 'd'];
                var str = '';
                for (var i = 0; i &lt; list.length; i++) {
                    if (str) str += '  ';
                    str += list[i] + '-' + lib.rank[list[i]].length;
                }
                console.log(str);
                for (var i in lib.characterPack) {
                    if (!bool &amp;&amp; lib.config.all.sgscharacters.contains(i)) continue;
                    var map = {};
                    var str = '';
                    for (var j in lib.characterPack[i]) {
                        var rank = get.rank(j);
                        if (!map[rank]) {
                            map[rank] = 1;
                        }
                        else {
                            map[rank]++;
                        }
                    }
                    for (var j = 0; j &lt; list.length; j++) {
                        if (map[list[j]]) {
                            if (str) str += '  ';
                            str += list[j] + '-' + map[list[j]];
                        }
                    }
                    if (str) {
                        console.log(lib.translate[i + '_character_config'] + '' + str);
                    }
                }

                var list = lib.rank.s.concat(lib.rank.ap).concat(lib.rank.a).concat(lib.rank.am).
                    concat(lib.rank.bp).concat(lib.rank.b).concat(lib.rank.bm).concat(lib.rank.c).concat(lib.rank.d);
                for (var i in lib.character) {
                    if (lib.config.forbidai.contains(i)) continue;
                    if (i.indexOf('boss_') != 0 &amp;&amp; i.indexOf('tafang_') != 0 &amp;&amp; !list.contains(i)) console.log(get.translation(i), i);
                }
            },
            h: function (player) {
                console.log(get.translation(player.getCards('h')));
            },
            g: function () {
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (i > 0 &amp;&amp; typeof arguments[i] == 'number') {
                        for (var j = 0; j &lt; arguments[i] - 1; j++) {
                            cheat.gx(arguments[i - 1]);
                        }
                    }
                    else {
                        cheat.gx(arguments[i]);
                    }
                }
            },
            ga: function (type) {
                for (var i in lib.card) {
                    if (lib.card[i].type == type || lib.card[i].subtype == type) {
                        cheat.g(i);
                    }
                }
            },
            gg: function () {
                for (var i = 0; i &lt; game.players.length; i++) {
                    for (var j = 0; j &lt; arguments.length; j++) {
                        cheat.gx(arguments[j], game.players[i]);
                    }
                }
            },
            gx: function (name, target) {
                target = target || game.me;
                var card = cheat.gn(name);
                if (!card) return;
                target.node.handcards1.appendChild(card);
                delete _status.event._cardChoice;
                delete _status.event._targetChoice;
                delete _status.event._skillChoice;
                game.check();
                target.update();
                ui.updatehl();
            },
            gn: function (name) {
                var nature = null;
                var suit = null;
                var suits = ['club', 'spade', 'diamond', 'heart'];
                for (var i = 0; i &lt; suits.length; i++) {
                    if (name.indexOf(suits[i]) == 0) {
                        suit = suits[i];
                        name = name.slice(suits[i].length);
                        break;
                    }
                }
                if (name.indexOf('red') == 0) {
                    name = name.slice(3);
                    suit = ['diamond', 'heart'].randomGet();
                }
                if (name.indexOf('black') == 0) {
                    name = name.slice(5);
                    suit = ['spade', 'club'].randomGet();
                }

                if (name == 'huosha') {
                    name = 'sha';
                    nature = 'fire';
                }
                else if (name == 'leisha') {
                    name = 'sha';
                    nature = 'thunder';
                }
                else if (name == 'haisha') {
                    name = 'sha';
                    nature = 'ocean';
                }
                else if (name == 'yamisha') {
                    name = 'sha';
                    nature = 'yami';
                }
                else if (name == 'haitao') {
                    name = 'tao';
                    nature = 'ocean';
                }
                if (!lib.card[name]) {
                    return null;
                }
                return game.createCard(name, suit, null, nature);
            },
            ge: function (target) {
                if (target) {
                    cheat.gx('zhuge', target);
                    cheat.gx('qinglong', target);
                    cheat.gx('bagua', target);
                    cheat.gx('dilu', target);
                    cheat.gx('chitu', target);
                    cheat.gx('muniu', target);
                }
                else {
                    cheat.g('zhuge');
                    cheat.g('qinglong');
                    cheat.g('bagua');
                    cheat.g('dilu');
                    cheat.g('chitu');
                    cheat.g('muniu');
                }
            },
            gj: function () {
                cheat.g('shandian');
                cheat.g('huoshan');
                cheat.g('hongshui');
                cheat.g('lebu');
                cheat.g('bingliang');
                cheat.g('guiyoujie');
            },
            gf: function () {
                for (var i in lib.card) {
                    if (lib.card[i].type == 'food') {
                        cheat.g(i);
                    }
                }
            },
            d: function (num, target) {
                if (num == undefined) num = 1;
                var cards = get.cards(num);
                for (var i = 0; i &lt; num; i++) {
                    var card = cards[i];
                    game.me.node.handcards1.appendChild(card);
                    delete _status.event._cardChoice;
                    delete _status.event._targetChoice;
                    delete _status.event._skillChoice;
                    game.check();
                    game.me.update();
                    ui.updatehl();
                }
            },
            s: function () {
                for (var i = 0; i &lt; arguments.length; i++) {
                    game.me.addSkill(arguments[i], true);
                }
                delete _status.event._cardChoice;
                delete _status.event._targetChoice;
                delete _status.event._skillChoice;
                game.check();
            },
            t: function (num) {
                if (game.players.contains(num)) {
                    num = game.players.indexOf(num);
                }
                if (num == undefined) {
                    for (var i = 0; i &lt; game.players.length; i++) cheat.t(i);
                    return;
                }
                var player = game.players[num];
                var cards = player.getCards('hej');
                for (var i = 0; i &lt; cards.length; i++) {
                    cards[i].discard();
                }
                player.removeEquipTrigger();
                player.update();
            },
            to: function () {
                for (var i = 0; i &lt; game.players.length; i++) {
                    if (game.players[i] != game.me) {
                        cheat.t(i);
                    }
                }
            },
            tm: function () {
                for (var i = 0; i &lt; game.players.length; i++) {
                    if (game.players[i] == game.me) {
                        cheat.t(i);
                    }
                }
            },
            k: function (i) {
                if (i == undefined) i = 1;
                game.players[i].hp = 1;
                cheat.t(i);
                cheat.g('juedou');
            },
            z: function (name) {
                switch (name) {
                    case 'cc': name = 're_caocao'; break;
                    case 'lb': name = 're_liubei'; break;
                    case 'sq': name = 'sunquan'; break;
                    case 'dz': name = 'dongzhuo'; break;
                    case 'ys': name = 're_yuanshao'; break;
                    case 'zj': name = 'sp_zhangjiao'; break;
                    case 'ls': name = 'liushan'; break;
                    case 'sc': name = 'sunce'; break;
                    case 'cp': name = 'caopi'; break;
                    case 'cr': name = 'caorui'; break;
                    case 'sx': name = 'sunxiu'; break;
                    case 'lc': name = 'liuchen'; break;
                    case 'sh': name = 'sunhao'; break;
                }
                game.zhu.init(name);
                game.zhu.maxHp++;
                game.zhu.hp++;
                game.zhu.update();
            },
        },
        /**
         * 
         * 
         * @type {!Object}
         */
        translate: {
            sc: '',
            ship: '',
            flower: '',
            egg: '',
            wine: '',
            shoe: '',
            yuxisx: '',
            shoukao: '',
            junk: '',

            common: '',
            rare: '',
            epic: '',
            legend: '',

            beginner: '',

            default: "",
            special: '',
            zhenfa: '',
            aozhan: "",
            mode_derivation_card_config: '',
            mode_banned_card_config: '',
            mode_favourite_character_config: '',
            mode_banned_character_config: '',
            suit: '',
            heart: "",
            diamond: "",
            spade: "",
            club: "",
            ghujia: '',
            ghujia_bg: '',
            heart2: "",
            diamond2: "",
            spade2: "",
            club2: "",
            color: '',
            red: '',
            black: '',
            none: '',

            number: '',
            cardname: '',

            ok: "",
            ok2: "",
            cancel: "",
            cancel2: "",
            restart: "",
            setting: "",
            start: "",
            random: "",
            _out: '',
            agree: '',
            refuse: '',
            fire: "",
            thunder: "",
            poison: "",
            kami: '',
            ocean: '',
            ice: '',
            yami: '',

            fire_ab: '',
            thunder_ab: '',
            ocean_ab: '',
            ice_ab: '',
            yami_ab: '',

            vtuber: '',
            clubs: '',
            vtuber2: '',
            clubs2: '',

            wei: '',
            shu: '',
            wu: '',
            qun: '',
            shen: '',
            western: '',
            key: 'N',
            holo: '',
            dotlive: '',
            nijisanji: '',
            VirtuaReal: '',
            HappyElements: '',
            upd8: 'U',
            eilene: '',
            paryi: '',
            kagura: '',
            nanashi: '774',
            psp: 'P',
            asoul: 'A',
            nori: '',
            vwp: '',
            vshojo: 'V',
            xuyan: '',
            chaos: 'C',
            xuefeng: '',
            hunmiao: '',
            ego: '',
            chidori: '',
            lucca: 'L',
            double: '',
            wei2: '',
            shu2: '',
            wu2: '',
            qun2: '',
            shen2: '',
            western2: '',
            key2: 'KEY',
            holo2: 'Hololive',
            upd82: 'Upd8',
            dotlive2: '.live',
            nijisanji2: 'Nijisanji',
            VirtuaReal2: 'VirtuaReal',
            HappyElements2: '',
            eilene2: '',
            paryi2: '',
            kagura2: '',
            nanashi2: '774inc',
            psp2: 'psplive',
            asoul2: 'A_SOUL',
            nori2: 'Noripro',
            vwp2: '',
            vshojo2: 'Vshojo',
            xuyan2: '',
            chaos2: 'ChaosLive',
            xuefeng2: '',
            hunmiao2: '',
            ego2: 'Egolive',
            chidori2: '',
            lucca2: 'Lucca',
            double2: '',
            male: '',
            female: '',
            mad: '',
            mad_bg: '',

            hp: '',

            draw_card: '',
            discard_card: '',
            take_damage: '',
            reset_character: '',
            recover_hp: '',
            lose_hp: '',
            get_damage: '',
            weiColor: "#b0d0e2",
            shuColor: "#ffddb9",
            wuColor: "#b2d9a9",
            qunColor: "#f6f6f6",
            shenColor: "#ffe14c",
            westernColor: "#ffe14c",
            jinColor: "#ffe14c",
            keyColor: "#c9b1fd",
            holoColor: "#38ABE0",
            nijisanjiColor: "#b0d0e2",
            dotliveColor: "#b2d9a9",
            upd8Color: "#ffe14c",
            eileneColor: "#DB7093",
            paryiColor: "#DDAAAF",
            VirtuaRealColor: "#77aaee",
            HappyElementsColor: "#60ACC8",
            kaguraColor: "#55deef",
            nanashiColor: "#e27b6b",
            pspColor: "#4d3d11",
            asoulColor: "#ffddcc",
            noriColor: "#a8ddaa",
            basic: '',
            equip: '',
            trick: '',
            delay: '',
            character: '',
            revive: '',
            equip1: '',
            equip2: '',
            equip3: '',
            equip4: '',
            equip5: '',
            equip6: '',
            zero: '',
            one: '',
            two: '',
            three: '',
            four: '',
            five: '',
            six: '',
            seven: '',
            eight: '',
            nine: '',
            ten: '',
            _chongzhu: '',
            _lianhuan: '',
            _lianhuan2: '',
            _kamisha: '',
            _oceansha: '',
            _icesha: '',
            _yamisha: '',
            _yamisha2: '',
            _shengjie: '',
            qianxing: '',
            mianyi: '',
            fengyin: '',
            baiban: '',
            _disableJudge: "",
            pileTop: '',
            pileBottom: '',

            xiaowu_emotion: '',
            guojia_emotion: '',
            zhenji_emotion: '',
            shibing_emotion: '',
            xiaosha_emotion: '',
            xiaotao_emotion: '',
            xiaojiu_emotion: '',
            Diana_emotion: '',

            pause: '',
            config: '',
            auto: '',

            unknown: '',
            unknown0: '',
            unknown1: '',
            unknown2: '',
            unknown3: '',
            unknown4: '',
            unknown5: '',
            unknown6: '',
            unknown7: '',

            feichu_equip1: "",
            feichu_equip1_info: "",
            feichu_equip2: "",
            feichu_equip2_info: "",
            feichu_equip3: "",
            feichu_equip3_info: "",
            feichu_equip4: "",
            feichu_equip4_info: "",
            feichu_equip5: "",
            feichu_equip5_info: "",
            feichu_equip1_bg: "",
            feichu_equip2_bg: "",
            feichu_equip3_bg: "",
            feichu_equip4_bg: "",
            feichu_equip5_bg: "",
            disable_judge: '',
            disable_judge_info: '',
            disable_judge_bg: '',
            pss: '',
            pss_paper: '',
            pss_scissor: '',
            pss_stone: '',
            pss_paper_info: '',
            pss_scissor_info: '',
            pss_stone_info: '',
            
			group_wei:"",
			group_shu:"",
			group_wu:"",
			group_jin:"",
			group_qun:"",
			group_key:"",
			group_holo:"",
			group_nijisanji:"",
			group_VirtuaReal:"",
			group_upd8:"U",
			group_paryi:"",
			group_kagura:"",
			group_nanashi:"7",
			group_psp:"P",
			group_asoul:"",
			group_nori:"",
			group_vwp:"",
			group_chaos:"",
			group_xuyan:"",
			group_xuefeng:"",
			group_wei_bg:"",
			group_shu_bg:"",
			group_wu_bg:"",
			group_qun_bg:"",
			group_jin_bg:"",
			group_key_bg:"",
			group_holo_bg:"",
			group_nijisanji_bg:"",
			group_VirtuaReal_bg:"",
			group_upd8_bg:"U",
			group_paryi_bg:"",
			group_kagura_bg:"",
			group_nanashi_bg:"",
			group_psp_bg:"",
			group_asoul_bg:"",
			group_nori_bg:"",
			group_vwp_bg:"",
			group_chaos_bg:"",
			group_xuyan_bg:"",
			group_xuefeng_bg:"",
        },
        /**
         * 
         * @name element
         * @namespace
         * @see {@link content}
         * @see {@link lib.element.player}
         * @see {@link lib.element.card}
         */
        element: {
            /**
             * setContent
             * 
             * @name content
             * @namespace
             * @global
             */
            content: {
                resetRound: function () {
                    var skill = event.resetSkill || event.name.slice(0, event.name.indexOf('_roundcount'));
                    if (!player || !lib.skill[skill]) return;
                    var roundname = skill + '_roundcount';
                    if (player.storage[roundname] > 0) {
                        player.storage[roundname]--
                    }
                    if (player.storage[roundname] > 0) {
                        player.updateMarks();
                    }
                    else {
                        player.unmarkSkill(roundname);
                    }
                },
                //
                chooseShengjie: function () {
                    'step 0'
                    var list = [];
                    if (!lib.cardPack.mode_derivation || !lib.cardPack.mode_derivation.length) event.finish();
                    for (var i = 0; i &lt; lib.cardPack.mode_derivation.length; i++) {
                        var info = lib.card[lib.cardPack.mode_derivation[i]];
                        if (info &amp;&amp; info.materials &amp;&amp; (typeof info.materials == 'function' || Array.isArray(info.materials))) list.push(lib.cardPack.mode_derivation[i]);
                    }
                    if (event.filterProduct) list = list.filter(event.filterProduct);
                    event.list = list;
                    'step 1'
                    var next = player.chooseButton([event.prompt, [event.list, 'vcard'], '', [event.materials, 'card'], 'hidden'], event.forced);
                    next.set('filterButton', function (button) {
                        var ub = ui.selected.buttons;
                        if (get.itemtype(button.link) == 'card') {
                            if (!ub.length) return false;
                            var card = button.link;
                            var scards = ub.slice(1).map(function (scard) {
                                return scard.link;
                            });
                            var product = ub[0].link[2];
                            scards = scards.filter(function (scard) {
                                return get.itemtype(scard) == 'card';
                            });
                            if (_status.event.filterMaterial &amp;&amp; !_status.event.filterMaterial(button.link, scards)) return false;
                            var filter = get.info({ name: product }).materials;
                            if (Array.isArray(filter)) {
                                if (filter.length > scards.length) {
                                    var mate = filter.slice(0);
                                    var smate = [];
                                    for (var j = 0; j &lt; mate.length; j++) {
                                        for (var k of scards) {
                                            if (!smate.contains(k)) {
                                                if (get.is.filterCardBy(k, mate[j])) {
                                                    smate.push(k)
                                                    mate.splice(j--, 1);
                                                }
                                            }
                                        }
                                    }
                                    for (var j = 0; j &lt; mate.length; j++) {
                                        if (get.is.filterCardBy(card, mate[j])) {
                                            return true
                                        }
                                    }

                                }
                                return false;
                            }
                            return true;
                        }
                        if (ub.length) return false;
                        return true;
                    });
                    next.set('selectButton', function () {
                        var ub = ui.selected.buttons;
                        if (ub.length) {
                            var scards = ub.slice(1).map(function (scard) {
                                return scard.link;
                            });
                            var product = ub[0].link[2];
                            var filter = get.info({ name: product }).materials;
                            if (Array.isArray(filter)) {
                                if (filter.length == scards.length) {
                                    var mate = filter.slice(0);
                                    for (var j = 0; j &lt; mate.length; j++) {
                                        for (var k of scards) {
                                            if (get.is.filterCardBy(k, mate[j])) {
                                                mate.splice(j--, 1);
                                            }
                                        }
                                    }
                                    if (mate.length == 0) return ub.length;
                                }
                            }
                        }
                        return [ub.length + 1, ub.length + 2];
                    });
                    next.set('filterMaterial', event.filterMaterial);
                    'step 2'
                    if (result.bool) {
                        var cards = result.links.slice(1);
                        var star = game.createCard2(result.links[0][2], get.suit3(cards).randomGet(), 14);
                        event.result = {
                            bool: true,
                            cards: cards,
                            materials: cards,
                            star: star,
                        };
                    }
                    else event.result = { bool: false };
                },
                emptyEvent: function () {
                    event.trigger(event.name);
                },
                showCharacter: function () {
                    'step 0'
                    event.trigger('showCharacterEnd');
                    'step 1'
                    event.trigger('showCharacterAfter');
                    if (get.mode() == 'identity' &amp;&amp; player.isZhu) event.trigger('zhuUpdate');
                },
                removeCharacter: function () {
                    player.$removeCharacter(event.num);
                },
                chooseUseTarget: function () {
                    'step 0'
                    if (get.is.object(card) &amp;&amp; !event.viewAs) card.isCard = true;
                    if (cards &amp;&amp; get.itemtype(card) != 'card') {
                        card = get.copy(card);
                        card.cards = cards.slice(0);
                        event.card = card;
                    }
                    if (!lib.filter.cardEnabled(card, player) || (event.addCount !== false &amp;&amp; !lib.filter.cardUsable(card, player))) {
                        event.result = { bool: false };
                        event.finish();
                        return;
                    }
                    var info = get.info(card);
                    var range;
                    if (!info.notarget) {
                        var select = get.copy(info.selectTarget);
                        if (select == undefined) {
                            range = [1, 1];
                        }
                        else if (typeof select == 'number') range = [select, select];
                        else if (get.itemtype(select) == 'select') range = select;
                        else if (typeof select == 'function') range = select(card, player);
                        game.checkMod(card, player, range, 'selectTarget', player);
                    }
                    if (info.notarget || range[1] == -1) {
                        if (!info.notarget &amp;&amp; range[1] == -1) {
                            for (var i = 0; i &lt; targets.length; i++) {
                                if (!player.canUse(card, targets[i], event.nodistance ? false : null, event.addCount === false ? null : true)) {
                                    targets.splice(i--, 1);
                                }
                            }
                            if (targets.length) {
                                event.targets2 = targets;
                            }
                            else {
                                event.finish();
                                return;
                            }
                        }
                        else event.targets2 = [];
                        if (event.forced) {
                            event._result = { bool: true };
                        }
                        else {
                            var next = player.chooseBool();
                            next.set('prompt', event.prompt || ('' + (event.targets2.length ? '' : '') + get.translation(event.targets2) + '' + get.translation(card) + '?'));
                            if (event.hsskill) next.setHiddenSkill(event.hsskill);
                            if (event.prompt2) next.set('prompt2', event.prompt2);
                            next.ai = function () {
                                var eff = 0;
                                for (var i = 0; i &lt; event.targets2.length; i++) {
                                    eff += get.effect(event.targets2[i], card, player, player);
                                }
                                return eff > 0;
                            };
                        }
                    }
                    else {
                        var next = player.chooseTarget();
                        next.set('_get_card', card);
                        next.set('filterTarget', function (card, player, target) {
                            if (!_status.event.targets.contains(target)) return false;
                            if (!_status.event.nodistance &amp;&amp; !lib.filter.targetInRange(card, player, target)) return false;
                            return lib.filter.targetEnabledx(card, player, target);
                        });
                        next.set('ai', event.ai || get.effect_use);
                        next.set('selectTarget', event.selectTarget || lib.filter.selectTarget);
                        if (event.nodistance) next.set('nodistance', true);
                        if (event.forced) next.set('forced', true);
                        if (event.addCount !== false) next.set('addCount_extra', true);
                        next.set('targets', targets);
                        next.set('prompt', event.prompt || ('' + get.translation(card) + ''));
                        if (event.prompt2) next.set('prompt2', event.prompt2);
                        if (event.hsskill) next.setHiddenSkill(event.hsskill);
                    }
                    'step 1'
                    if (result.bool) {
                        event.result = {
                            bool: true,
                            targets: event.targets2 || result.targets,
                        };
                        var next = player.useCard(card, event.targets2 || result.targets);
                        next.oncard = event.oncard;
                        if (cards) next.cards = cards.slice(0);
                        if (event.nopopup) next.nopopup = true;
                        if (event.animate === false) next.animate = false;
                        if (event.throw === false) next.throw = false;
                        if (event.addCount === false) next.addCount = false;
                        if (event.noTargetDelay) next.targetDelay = false;
                        if (event.nodelayx) next.delayx = false;
                        if (event.logSkill) {
                            if (typeof event.logSkill == 'string') {
                                next.skill = event.logSkill;
                            }
                            else if (Array.isArray(event.logSkill)) {
                                player.logSkill.apply(player, event.logSkill);
                            }
                        }
                    }
                    else event.result = { bool: false };
                },
                chooseToDuiben: function () {
                    'step 0'
                    game.log(player, '', target, '', '#y');
                    if (_status.connectMode) {
                        player.chooseButtonOL([
                            [player, ['', [[['', '', 'db_def2'], ['', '', 'db_def1']], 'vcard']], true],
                            [target, ['', [[['', '', 'db_atk1'], ['', '', 'db_atk2']], 'vcard']], true]
                        ], function () { }, function () { return 1 + Math.random() }).set('switchToAuto', function () {
                            _status.event.result = 'ai';
                        }).set('processAI', function () {
                            var buttons = _status.event.dialog.buttons;
                            return {
                                bool: true,
                                links: [buttons.randomGet().link],
                            }
                        });
                    }
                    'step 1'
                    if (_status.connectMode) {
                        event.mes = result[player.playerid].links[0][2];
                        event.tes = result[target.playerid].links[0][2];
                        event.goto(4);
                    }
                    else {
                        player.chooseButton(['', [[['', '', 'db_def2'], ['', '', 'db_def1']], 'vcard']], true).ai = function () { return 1 + Math.random() };
                    }
                    'step 2'
                    event.mes = result.links[0][2];
                    target.chooseButton(['', [[['', '', 'db_atk1'], ['', '', 'db_atk2']], 'vcard']], true).ai = function () { return 1 + Math.random() };
                    'step 3'
                    event.tes = result.links[0][2];
                    'step 4'
                    game.broadcast(function () {
                        ui.arena.classList.add('thrownhighlight');
                    });
                    ui.arena.classList.add('thrownhighlight');
                    game.addVideo('thrownhighlight1');
                    target.$compare(game.createCard(event.tes, '', ''), player, game.createCard(event.mes, '', ''));
                    game.log(target, '', '#g' + get.translation(event.tes));
                    game.log(player, '', '#g' + get.translation(event.mes));
                    game.delay(0, 1500);
                    'step 5'
                    var mes = event.mes.slice(6);
                    var tes = event.tes.slice(6);
                    var str;
                    if (mes == tes) {
                        str = get.translation(player) + '';
                        player.popup('', 'wood');
                        target.popup('', 'fire');
                        game.log(player, '#g');
                        event.result = { bool: true };
                    }
                    else {
                        str = get.translation(player) + '';
                        target.popup('', 'wood');
                        player.popup('', 'fire');
                        game.log(target, '#g');
                        event.result = { bool: false };
                    }
                    game.broadcastAll(function (str) {
                        var dialog = ui.create.dialog(str);
                        dialog.classList.add('center');
                        setTimeout(function () {
                            dialog.close();
                        }, 1000);
                    }, str);
                    game.delay(2);
                    'step 6'
                    game.broadcastAll(function () {
                        ui.arena.classList.remove('thrownhighlight');
                    });
                    game.addVideo('thrownhighlight2');
                    if (event.clear !== false) {
                        game.broadcastAll(ui.clear);
                    }
                },
                chooseToPSS: function () {
                    'step 0'
                    game.log(player, '', target, '');
                    if (_status.connectMode) {
                        player.chooseButtonOL([
                            [player, ['', [[['', '', 'pss_stone'], ['', '', 'pss_scissor'], ['', '', 'pss_paper']], 'vcard']], true],
                            [target, ['', [[['', '', 'pss_stone'], ['', '', 'pss_scissor'], ['', '', 'pss_paper']], 'vcard']], true]
                        ], function () { }, function () { return 1 + Math.random() }).set('switchToAuto', function () {
                            _status.event.result = 'ai';
                        }).set('processAI', function () {
                            var buttons = _status.event.dialog.buttons;
                            return {
                                bool: true,
                                links: [buttons.randomGet().link],
                            }
                        });
                    }
                    'step 1'
                    if (_status.connectMode) {
                        event.mes = result[player.playerid].links[0][2];
                        event.tes = result[target.playerid].links[0][2];
                        event.goto(4);
                    }
                    else {
                        player.chooseButton(['', [[['', '', 'pss_stone'], ['', '', 'pss_scissor'], ['', '', 'pss_paper']], 'vcard']], true).ai = function () { return 1 + Math.random() };
                    }
                    'step 2'
                    event.mes = result.links[0][2];
                    target.chooseButton(['', [[['', '', 'pss_stone'], ['', '', 'pss_scissor'], ['', '', 'pss_paper']], 'vcard']], true).ai = function () { return 1 + Math.random() };
                    'step 3'
                    event.tes = result.links[0][2];
                    'step 4'
                    game.broadcast(function () {
                        ui.arena.classList.add('thrownhighlight');
                    });
                    ui.arena.classList.add('thrownhighlight');
                    game.addVideo('thrownhighlight1');
                    player.$compare(game.createCard(event.mes, '', ''), target, game.createCard(event.tes, '', ''));
                    game.log(player, '', '#g' + get.translation(event.mes));
                    game.log(target, '', '#g' + get.translation(event.tes));
                    game.delay(0, 1500);
                    'step 5'
                    var mes = event.mes.slice(4);
                    var tes = event.tes.slice(4);
                    var str;
                    if (mes == tes) {
                        str = '';
                        player.popup('', 'metal');
                        target.popup('', 'metal');
                        game.log('', '#g');
                        event.result = { tie: true };
                    }
                    else {
                        if ({ paper: 'stone', scissor: 'paper', stone: 'scissor' }[mes] == tes) {
                            str = get.translation(player) + '';
                            player.popup('', 'wood');
                            target.popup('', 'fire');
                            game.log(player, '#g');
                            event.result = { bool: true, winner: mes };
                        }
                        else {
                            str = get.translation(target) + '';
                            target.popup('', 'wood');
                            player.popup('', 'fire');
                            game.log(target, '#g');
                            event.result = { bool: false, winner: tes };
                        }
                    }
                    game.broadcastAll(function (str) {
                        var dialog = ui.create.dialog(str);
                        dialog.classList.add('center');
                        setTimeout(function () {
                            dialog.close();
                        }, 1000);
                    }, str);
                    game.delay(2);
                    'step 6'
                    game.broadcastAll(function () {
                        ui.arena.classList.remove('thrownhighlight');
                    });
                    game.addVideo('thrownhighlight2');
                    if (event.clear !== false) {
                        game.broadcastAll(ui.clear);
                    }
                },
                cardsDiscard: function () {
                    game.getGlobalHistory().cardMove.push(event);
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].discard();
                    }
                },
                orderingDiscard: function () {
                    var cards = event.relatedEvent.orderingCards;
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (get.position(cards[i], true) != 'o') cards.splice(i--, 1);
                    }
                    if (cards.length) game.cardsDiscard(cards);
                },
                cardsGotoOrdering: function () {
                    game.getGlobalHistory().cardMove.push(event);
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].fix();
                        ui.ordering.appendChild(cards[i]);
                    }
                    var evt = event.relatedEvent || event.getParent();
                    if (!evt.orderingCards) evt.orderingCards = [];
                    if (!event.noOrdering &amp;&amp; !event.cardsOrdered) {
                        event.cardsOrdered = true;
                        var next = game.createEvent('orderingDiscard', false, evt.getParent());
                        next.relatedEvent = evt;
                        next.setContent('orderingDiscard');
                    }
                    if (!event.noOrdering) evt.orderingCards.addArray(cards);
                },
                cardsGotoSpecial: function () {
                    game.getGlobalHistory().cardMove.push(event);
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].fix();
                        ui.special.appendChild(cards[i]);
                    }
                    if (event.notrigger !== true) event.trigger('addCardToStorage');
                },
                chooseToEnable: function () {
                    'step 0'
                    var list = [];
                    for (var i = 1; i &lt; 6; i++) {
                        if (!player.isDisabled(i)) continue;
                        list.push('equip' + i);
                    }
                    if (!list.length) event.finish();
                    else {
                        event.list = list;
                        var next = player.chooseControl(list);
                        next.set('prompt', '');
                        if (!event.ai) event.ai = function (event, player, list) {
                            return list.randomGet();
                        }
                        event.ai = event.ai(event.getParent(), player, list);
                        next.ai = function () {
                            return event.ai;
                        };
                    }
                    'step 1'
                    event.result = { control: result.control };
                    player.enableEquip(result.control);
                },
                chooseToDisable: function () {
                    'step 0'
                    var list = [];
                    for (var i = 1; i &lt; 7; i++) {
                        if ((i == 3 || i == 4) &amp;&amp; event.horse) continue;
                        if (i == 6 &amp;&amp; !event.horse) continue;
                        if (player.isDisabled(i)) continue;
                        list.push('equip' + i);
                    }
                    if (!list.length) event.finish();
                    else {
                        event.list = list;
                        var next = player.chooseControl(list);
                        next.set('prompt', '');
                        if (!event.ai) event.ai = function (event, player, list) {
                            return list.randomGet();
                        }
                        event.ai = event.ai(event.getParent(), player, list);
                        next.ai = function () {
                            return event.ai;
                        };
                    }
                    'step 1'
                    event.result = { control: result.control };
                    if (result.control == 'equip6') {
                        player.disableEquip(3);
                        player.disableEquip(4);
                    }
                    else player.disableEquip(result.control);
                },
                swapEquip: function () {
                    "step 0"
                    game.log(player, '', target, '')
                    var e1 = player.getCards('e');
                    var todis1 = [];
                    for (var i = 0; i &lt; e1.length; i++) {
                        if (target.isDisabled(get.subtype(e1[i]))) todis1.push(e1[i]);
                    }
                    player.discard(todis1);
                    var e2 = target.getCards('e');
                    var todis2 = [];
                    for (var i = 0; i &lt; e2.length; i++) {
                        if (player.isDisabled(get.subtype(e2[i]))) todis2.push(e2[i]);
                    }
                    target.discard(todis2);
                    "step 1"
                    event.cards = [player.getCards('e'), target.getCards('e')];
                    player.lose(event.cards[0], ui.ordering, 'visible');
                    target.lose(event.cards[1], ui.ordering, 'visible');
                    if (event.cards[0].length) player.$give(event.cards[0], target, false);
                    if (event.cards[1].length) target.$give(event.cards[1], player, false);
                    "step 2"
                    for (var i = 0; i &lt; event.cards[1].length; i++) {
                        player.equip(event.cards[1][i]);
                    }
                    for (var i = 0; i &lt; event.cards[0].length; i++) {
                        target.equip(event.cards[0][i]);
                    }
                },
                disableEquip: function () {
                    if (!player.isDisabled(event.pos)) {
                        var cards = player.getCards('e', function (card) {
                            var subtype = get.subtype(card);
                            if (subtype == event.pos) return true;
                            if (subtype == 'equip6' &amp;&amp; ['equip3', 'equip4'].contains(event.pos)) return true;
                            return false;
                        });
                        if (cards.length) player.discard(cards).delay = false;
                        game.log(player, '', get.translation(event.pos), '');
                        player.$disableEquip(event.pos);
                    }
                },
                enableEquip: function () {
                    if (player.isDisabled(event.pos)) {
                        player.syncStorage('_disableEquip');
                        game.log(player, '', get.translation(event.pos), '');
                        player.$enableEquip(event.pos);
                    };
                },
                disableJudge: function () {
                    'step 0'
                    game.log(player, '');
                    var js = player.getCards('j');
                    if (js.length) player.discard(js);
                    player.storage._disableJudge = true;
                    //player.markSkill('_disableJudge');
                    'step 1'
                    game.broadcastAll(function (player, card) {
                        player.$disableJudge();
                    }, player);
                },
                enableJudge: function () {
                    if (!player.storage._disableJudge) return;
                    game.log(player, '');
                    game.broadcastAll(function (player) {
                        player.$enableJudge();
                    }, player);
                },
                /*--------*/
                phasing: function () {
                    'step 0'
                    while (ui.dialogs.length) {
                        ui.dialogs[0].close();
                    }
                    if (!player.noPhaseDelay &amp;&amp; lib.config.show_phase_prompt) {
                        player.popup('');
                    }
                    if (lib.config.glow_phase) {
                        if (_status.currentPhase) {
                            _status.currentPhase.classList.remove('glow_phase');
                            game.broadcast(function (player) {
                                player.classList.remove('glow_phase');
                            }, _status.currentPhase);
                        }
                        player.classList.add('glow_phase');
                        game.broadcast(function (player) {
                            player.classList.add('glow_phase');
                        }, player);
                    }
                    _status.currentPhase = player;
                    _status.discarded = [];
                    game.phaseNumber++;
                    player.phaseNumber++;
                    game.syncState();
                    game.addVideo('phaseChange', player);
                    if (game.phaseNumber == 1 &amp;&amp; lib.configOL.observe) {
                        lib.configOL.observeReady = true;
                        game.send('server', 'config', lib.configOL);
                    }
                    game.log();
                    game.log(player, '');
                    player._noVibrate = true;
                    if (get.config('identity_mode') != 'zhong' &amp;&amp; get.config('identity_mode') != 'purple' &amp;&amp; !_status.connectMode) {
                        var num;
                        switch (get.config('auto_identity')) {
                            case 'one': num = 1; break;
                            case 'two': num = 2; break;
                            case 'three': num = 3; break;
                            case 'always': num = -1; break;
                            default: num = 0; break;
                        }
                        if (num &amp;&amp; !_status.identityShown &amp;&amp; game.phaseNumber > game.players.length * num &amp;&amp; game.showIdentity) {
                            if (!_status.video) player.popup('');
                            _status.identityShown = true;
                            game.showIdentity(false);
                        }
                    }
                    player.ai.tempIgnore = [];
                    _status.globalHistory.push({
                        cardMove: [],
                        custom: [],
                    });
                    game.countPlayer2(function (current) {
                        current.actionHistory.push({ useCard: [], respond: [], skipped: [], lose: [], gain: [], sourceDamage: [], damage: [], custom: [] });
                        current.stat.push({ card: {}, skill: {} });
                        if (event.parent._roundStart) {
                            current.getHistory().isRound = true;
                            current.getStat().isRound = true;
                        }
                    });
                    player.getHistory().isMe = true;
                    player.getStat().isMe = true;
                    if (event.parent._roundStart) {
                        game.getGlobalHistory().isRound = true;
                    }
                    if (ui.land &amp;&amp; ui.land.player == player) {
                        game.addVideo('destroyLand');
                        ui.land.destroy();
                    }
                    'step 1'
                    event.trigger('phaseBeginStart');
                },
                /**
                 * 
                 * @name content.toggleSubPlayer
                 * @type {GameCores.Bases.StateMachine}
                 */
                toggleSubPlayer: function () {
                    'step 0'
                    var list = event.list || player.storage.subplayer.skills.slice(0);
                    list.remove(player.storage.subplayer.name2);
                    event.list = list;
                    if (!event.directresult) {
                        if (list.length > 1) {
                            var dialog = ui.create.dialog('', 'hidden');
                            dialog.add([list, 'character']);
                            player.chooseButton(dialog, true);
                        }
                        else if (list.length == 1) {
                            event.directresult = list[0];
                        }
                        else {
                            event.finish();
                        }
                    }
                    else {
                        if (!list.contains(event.directresult)) {
                            event.finish();
                        }
                    }
                    'step 1'
                    if (!event.directresult) {
                        if (result &amp;&amp; result.bool &amp;&amp; result.links[0]) {
                            event.directresult = result.links[0];
                        }
                        else {
                            event.finish();
                            return;
                        }
                    }
                    if (player.storage.subplayer) {
                        var current = player.storage.subplayer.name2;
                        if (event.directresult == current) {
                            event.finish();
                            return;
                        }
                        player.storage[current].hp = player.hp;
                        player.storage[current].maxHp = player.maxHp;
                        player.storage[current].hs = player.getCards('h');
                        player.storage[current].es = player.getCards('e');
                        player.lose(player.getCards('he'), ui.special)._triggered = null;

                        var cfg = player.storage[event.directresult];
                        player.storage.subplayer.name2 = event.directresult;
                        player.reinit(current, event.directresult, [
                            cfg.hp,
                            cfg.maxHp
                        ]);
                        if (cfg.hs.length) player.directgain(cfg.hs);
                        if (cfg.es.length) player.directequip(cfg.es);
                    }
                },
                /**
                 * 
                 * @name content.callSubPlayer
                 * @type {GameCores.Bases.StateMachine}
                 */
                exitSubPlayer: function () {
                    'step 0'
                    if (player.storage.subplayer) {
                        var current = player.storage.subplayer.name2;
                        if (event.remove) {
                            player.lose(player.getCards('he'), ui.discardPile)._triggered = null;
                        }
                        else {
                            player.storage[current].hp = player.hp;
                            player.storage[current].maxHp = player.maxHp;
                            player.storage[current].hs = player.getCards('h');
                            player.storage[current].es = player.getCards('e');
                            player.lose(player.getCards('he'), ui.special)._triggered = null;
                        }
                        player.reinit(current, player.storage.subplayer.name, [
                            player.storage.subplayer.hp,
                            player.storage.subplayer.maxHp
                        ]);
                        player.update();
                        if (event.remove) {
                            if (player.storage[current].onremove) {
                                player.storage[current].onremove(player);
                            }
                            delete player.storage[current];
                            player.storage.subplayer.skills.remove(current);
                            game.log(player, '', '#g' + current);
                        }
                        else {
                            game.log(player, '', '#g' + current);
                        }
                        player.addSkill(player.storage.subplayer.skills);
                    }
                    'step 1'
                    if (player.storage.subplayer) {
                        player.directgain(player.storage.subplayer.hs);
                        player.directequip(player.storage.subplayer.es);
                    }
                    player.removeSkill('subplayer');
                    'step 2'
                    if (event.remove) {
                        event.trigger('subPlayerDie');
                    }
                },
                /**
                 * 
                 * @name content.callSubPlayer
                 * @type {GameCores.Bases.StateMachine}
                 */
                callSubPlayer: function () {
                    'step 0'
                    var list = player.getSubPlayers(event.tag);
                    event.list = list;
                    if (!event.directresult) {
                        if (list.length > 1) {
                            var dialog = ui.create.dialog('', 'hidden');
                            dialog.add([list, 'character']);
                            player.chooseButton(dialog, true);
                        }
                        else if (list.length == 1) {
                            event.directresult = list[0];
                        }
                        else {
                            event.finish();
                        }
                    }
                    else {
                        if (!list.contains(event.directresult)) {
                            event.finish();
                        }
                    }
                    'step 1'
                    if (!event.directresult) {
                        if (result &amp;&amp; result.bool &amp;&amp; result.links[0]) {
                            event.directresult = result.links[0];
                        }
                        else {
                            event.finish();
                            return;
                        }
                    }
                    if (event.directresult) {
                        var cfg = player.storage[event.directresult];
                        var source = cfg.source || player.name;
                        var name = event.directresult;
                        game.log(player, '', '#g' + name);
                        player.storage.subplayer = {
                            name: source,
                            name2: event.directresult,
                            hp: player.hp,
                            maxHp: player.maxHp,
                            skills: event.list.slice(0),
                            hs: player.getCards('h'),
                            es: player.getCards('e'),
                            intro2: cfg.intro2
                        }
                        player.removeSkill(event.list);
                        player.reinit(source, name, [cfg.hp, cfg.maxHp]);
                        player.addSkill('subplayer');
                        player.lose(player.getCards('he'), ui.special)._triggered = null;
                        if (cfg.hs.length) player.directgain(cfg.hs);
                        if (cfg.es.length) player.directequip(cfg.es);
                    }
                    'step 2'
                    game.delay();
                },
                /**
                 * 
                 * @name content.reverseOrder
                 * @type {GameCores.Bases.StateMachine}
                 */
                reverseOrder: function () {
                    "step 0"
                    game.delay();
                    "step 1"
                    var choice;
                    if (get.tag(card, 'multineg')) {
                        choice = (player.previous.side == player.side) ? '' : '';
                    }
                    else {
                        choice = (player.next.side == player.side) ? '' : '';
                    }
                    player.chooseControl('', '', function (event, player) {
                        return _status.event.choice || '';
                    }).set('prompt', '' + get.translation(card) + '').set('choice', choice).set('forceDie', true);
                    "step 2"
                    if (result &amp;&amp; result.control == '') {
                        var evt = event.getParent();
                        evt.fixedSeat = true;
                        evt.targets.sortBySeat();
                        evt.targets.reverse();
                        if (evt.targets[evt.targets.length - 1] == player) {
                            evt.targets.unshift(evt.targets.pop());
                        }
                    }
                },
                /**
                 * 
                 * @name content.addJudgeCard
                 * @type {GameCores.Bases.StateMachine}
                 */
                addJudgeCard: function () {
                    if (lib.filter.judge(card, player, target) &amp;&amp; cards.length &amp;&amp; get.position(cards[0], true) == 'o') target.addJudge(card, cards);
                },
                /**
                 * 
                 * @name content.equipCard
                 * @type {GameCores.Bases.StateMachine}
                 */
                equipCard: function () {
                    if (cards.length &amp;&amp; get.position(cards[0], true) == 'o') target.equip(card, cards[0]);
                },
                /**
                 * 
                 * @name content.gameDraw
                 * @type {GameCores.Bases.StateMachine}
                 */
                gameDraw: function () {
                    "step 0"
                    if (_status.brawl &amp;&amp; _status.brawl.noGameDraw) {
                        event.finish();
                        return;
                    }
                    var end = player;
                    var numx = num;
                    do {
                        if (typeof num == 'function') {
                            numx = num(player);
                        }
                        if (player.getTopCards) player.directgain(player.getTopCards(numx));
                        else player.directgain(get.cards(numx));
                        if (player.singleHp === true &amp;&amp; get.mode() != 'guozhan' &amp;&amp; (lib.config.mode != 'doudizhu' || _status.mode != 'online')) {
                            player.doubleDraw();
                        }
                        player = player.next;
                    }
                    while (player != end);
                    event.changeCard = get.config('change_card');
                    if (_status.connectMode || (lib.config.mode == 'doudizhu' &amp;&amp; _status.mode == 'online') || lib.config.mode != 'identity' &amp;&amp; lib.config.mode != 'guozhan' &amp;&amp; lib.config.mode != 'doudizhu' &amp;&amp; lib.config.mode != 'longlaoguan') {
                        event.changeCard = 'disabled';
                    }
                    "step 1"
                    if (event.changeCard != 'disabled' &amp;&amp; !_status.auto) {
                        event.dialog = ui.create.dialog('');
                        ui.create.confirm('oc');
                        event.custom.replace.confirm = function (bool) {
                            _status.event.bool = bool;
                            game.resume();
                        }
                    }
                    else {
                        event.finish();
                    }
                    "step 2"
                    if (event.changeCard == 'once') {
                        event.changeCard = 'disabled';
                    }
                    else if (event.changeCard == 'twice') {
                        event.changeCard = 'once';
                    }
                    else if (event.changeCard == 'disabled') {
                        event.bool = false;
                        return;
                    }
                    _status.imchoosing = true;
                    event.switchToAuto = function () {
                        _status.event.bool = false;
                        game.resume();
                    }
                    game.pause();
                    "step 3"
                    _status.imchoosing = false;
                    if (event.bool) {
                        if (game.changeCoin) {
                            game.changeCoin(-3);
                        }
                        var hs = game.me.getCards('h');
                        game.addVideo('lose', game.me, [get.cardsInfo(hs), [], [], []]);
                        for (var i = 0; i &lt; hs.length; i++) {
                            hs[i].discard(false);
                        }
                        game.me.directgain(get.cards(hs.length));
                        var ss = game.me.getCards('s');
                        game.addVideo('lose', game.me, [get.cardsInfo(ss), [], [], []]);
                        for (var i = 0; i &lt; ss.length; i++) {
                            ss[i].discard(false);
                        }
                        game.me.directgains(get.cards(ss.length));
                        event.goto(2);
                    }
                    else {
                        if (event.dialog) event.dialog.close();
                        if (ui.confirm) ui.confirm.close();
                        event.finish();
                    }
                },
                /**
                 * 
                 * @name content.phaseLoop
                 * @type {GameCores.Bases.StateMachine}
                 */
                phaseLoop: function () {
                    "step 0"
                    for (var i = 0; i &lt; lib.onphase.length; i++) {
                        lib.onphase[i]();
                    }
                    player.phase();
                    "step 1"
                    if (!game.players.contains(event.player.next)) {
                        event.player = game.findNext(event.player.next);
                    }
                    else {
                        event.player = event.player.next;
                    }
                    event.goto(0);
                },
                /**
                 * 
                 * @name content.loadPackage
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Array&lt;Object>} event.packages 
                 * @property {string} event.packages[].0 `lib.assetURL`
                 * @property {string} event.packages[].1 
                 */
                loadPackage: function () {
                    'step 0'
                    if (event.packages.length) {
                        window.game = game;
                        var pack = event.packages.shift().split('/');
                        lib.init.js(lib.assetURL + pack[0], pack[1], game.resume);
                        game.pause();
                    }
                    else {
                        event.finish();
                    }
                    'step 1'
                    if (!lib.config.dev) delete window.game;//??
                    var character = lib.imported.character;
                    var card = lib.imported.card;
                    var i, j, k;
                    for (i in character) {
                        if (character[i].character) {
                            lib.characterPack[i] = character[i].character;
                        }
                        if (character[i].forbid &amp;&amp; character[i].forbid.contains(lib.config.mode)) continue;
                        if (character[i].mode &amp;&amp; character[i].mode.contains(lib.config.mode) == false) continue;

                        if (Array.isArray(lib[j]) &amp;&amp; Array.isArray(character[i][j])) {
                            lib[j].addArray(character[i][j]);
                            continue;
                        }
                        for (j in character[i]) {
                            if (j == 'mode' || j == 'forbid' || j == 'characterSort') continue;
                            for (k in character[i][j]) {
                                if (j == 'character') {
                                    if (!character[i][j][k][4]) {
                                        character[i][j][k][4] = [];
                                    }
                                    if (character[i][j][k][4].contains('boss') ||
                                        character[i][j][k][4].contains('hiddenboss')) {
                                        lib.config.forbidai.add(k);
                                    }
                                    if (lib.config.forbidai_user &amp;&amp; lib.config.forbidai_user.contains(k)) {
                                        lib.config.forbidai.add(k);
                                    }
                                    for (var l = 0; l &lt; character[i][j][k][3].length; l++) {
                                        lib.skilllist.add(character[i][j][k][3][l]);
                                    }
                                }
                                if (j == 'translate' &amp;&amp; k == i) {
                                    lib[j][k + '_character_config'] = character[i][j][k];
                                }
                                else {
                                    if (lib[j][k] == undefined) {
                                        lib[j][k] = character[i][j][k];
                                    }
                                    else if (Array.isArray(lib[j][k]) &amp;&amp; Array.isArray(character[i][j][k])) {
                                        lib[j][k].addArray(character[i][j][k]);
                                    }
                                    else {
                                        console.log('dublicate ' + j + ' in character ' + i + ':\n' + k + '\n' + ': ' + lib[j][k] + '\n' + character[i][j][k]);
                                    }
                                }
                            }
                        }
                    }
                    for (i in card) {
                        lib.cardPack[i] = [];
                        if (card[i].card) {
                            for (var j in card[i].card) {
                                if (!card[i].card[j].hidden &amp;&amp; card[i].translate[j + '_info']) {
                                    lib.cardPack[i].push(j);
                                }
                            }
                        }
                        for (j in card[i]) {
                            if (j == 'mode' || j == 'forbid') continue;
                            if (j == 'list') continue;
                            for (k in card[i][j]) {
                                if (j == 'skill' &amp;&amp; k[0] == '_' &amp;&amp; !lib.config.cards.contains(i)) {
                                    continue;
                                }
                                if (j == 'translate' &amp;&amp; k == i) {
                                    lib[j][k + '_card_config'] = card[i][j][k];
                                }
                                else {
                                    if (lib[j][k] == undefined) lib[j][k] = card[i][j][k];
                                    else console.log('dublicate ' + j + ' in card ' + i + ':\n' + k + '\n' + lib[j][k] + '\n' + card[i][j][k]);
                                }
                            }
                        }
                    }
                    event.goto(0);
                },
                /**
                 * 
                 * @name content.loadMode
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!string} event.mode mode
                 * @property {?Object} event.result (undefined)
                 */
                loadMode: function () {
                    'step 0'
                    window.game = game;
                    lib.init.js(lib.assetURL + 'mode', event.mode, game.resume);
                    game.pause();
                    'step 1'
                    if (!lib.config.dev) delete window.game;
                    event.result = lib.imported.mode[event.mode];
                    delete lib.imported.mode[event.mode];
                },
                /**
                 * 
                 * @name content.forceOver
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {?string} event.bool {@link game.over}'noover'
                 * @property {?function():void} [event.callback] 
                 */
                forceOver: function () {
                    'step 0'
                    while (ui.controls.length) {
                        ui.controls[0].close();
                    }
                    while (ui.dialogs.length) {
                        ui.dialogs[0].close();
                    }
                    'step 1'
                    if (event.bool != 'noover') {
                        game.over(event.bool);
                    }
                    if (event.callback) {
                        event.callback();
                    }
                },
                /**
                 * 
                 * @name content.arrangeTrigger
                 * @type {GameCores.Bases.StateMachine}
                 */
                arrangeTrigger: function () {
                    'step 0'
                    event.filter1 = function (info) {
                        if (info[1].isDead() &amp;&amp; !lib.skill[info[0]].forceDie) return false;
                        return lib.filter.filterTrigger(trigger, info[1], event.triggername, info[0]);
                    }
                    event.filter2 = function (info2) {
                        var info = lib.skill[info2[0]];
                        if (!lib.translate[info2[0]] || info.popup === false || info.silent) return false;
                        return true;
                    }
                    event.filter3 = function (info, info2) {
                        return event.filter2(info2) &amp;&amp; event.filter1(info2) &amp;&amp; info2[1] == info[1] &amp;&amp; info[2] == info2[2] &amp;&amp; (lib.skill.global.contains(info2[0]) || info[1].hasSkill(info2[0], true));
                    }
                    'step 1'
                    if (trigger.filterStop &amp;&amp; trigger.filterStop()) {
                        event.finish();
                    }
                    else if (event.list.length) {
                        var info = event.list.shift();
                        game.createTrigger(event.triggername, info[0], info[1], trigger);
                        event.redo();
                    }
                    'step 2'
                    if (!event.map.length) {
                        if (event.list2.length) {
                            var info = event.list2.shift();
                            game.createTrigger(event.triggername, info[0], info[1], trigger);
                            event.redo();
                        }
                        else {
                            if (trigger._triggering == this) {
                                delete trigger._triggering;
                            }
                            event.finish();
                            return;
                        }
                    };
                    event.doing = event.map.shift();
                    'step 3'
                    event.num = 0;
                    var bool = false;
                    var list = event.doing.list;
                    for (var i = 0; i &lt; list.length; i++) {
                        if (event.filter1(list[i])) {
                            event.num = i;
                            bool = true;
                            break;
                        }
                    }
                    if (!bool) { event.goto(2); return; }
                    var priority = list[event.num][2];
                    for (var i = 0; i &lt; event.num; i++) {
                        if (event.doing.list[i][2] > priority) {
                            event.doing.list.splice(i--, 1);
                            event.num--;
                        }
                    }
                    event.choice = [];
                    if (event.num &lt; event.doing.list.length - 1 &amp;&amp; event.filter2(event.doing.list[event.num])) {
                        var current = event.doing.list[event.num];
                        event.choice.push(current);
                        for (var i = event.num + 1; i &lt; event.doing.list.length; i++) {
                            if (event.filter3(current, event.doing.list[i])) event.choice.push(event.doing.list[i]);
                        }
                    }
                    if (event.choice.length &lt; 2) event.goto(6);
                    'step 4'
                    var controls = [];
                    event.current = event.choice[0][1]
                    for (var i = 0; i &lt; event.choice.length; i++) {
                        controls.push(event.choice[i][0]);
                    }
                    event.current.chooseControl(controls).set('prompt', '').set('forceDie', true).set('arrangeSkill', true);
                    'step 5'
                    if (result.control) {
                        for (var i = 0; i &lt; event.doing.list.length; i++) {
                            if (event.doing.list[i][0] == result.control &amp;&amp; event.doing.list[i][1] == event.current) {
                                event.num = i; break;
                            }
                        }
                    }
                    'step 6'
                    var info = event.doing.list[event.num];
                    if (info) {
                        event.doing.list2.push(info);
                        event.doing.list.splice(event.num, 1);
                        game.createTrigger(event.triggername, info[0], info[1], trigger);
                    }
                    'step 7'
                    if (trigger.filterStop &amp;&amp; trigger.filterStop()) {
                        event.finish();
                    }
                    else event.goto(event.doing.list.length ? 3 : 2);
                },
                /**
                 * 
                 * 
                 * @name content.createTrigger
                 * @type {GameCores.Bases.StateMachine}
                 */
                createTrigger: function () {
                    "step 0"
                    if (lib.filter.filterTrigger(trigger, player, event.triggername, event.skill)) {
                        var fullskills = game.expandSkills(player.getSkills().concat(lib.skill.global));
                        if (!fullskills.contains(event.skill)) {
                            var info = get.info(event.skill);
                            var hidden = player.hiddenSkills.slice(0);
                            game.expandSkills(hidden);
                            if (hidden.contains(event.skill)) {
                                if (!info.silent &amp;&amp; player.hasSkillTag('nomingzhi', false, null, true)) {
                                    event.finish();
                                }
                                else if (!info.direct) {
                                    event.trigger('triggerHidden');
                                }
                                else {
                                    event.skillHidden = true;
                                }
                            }
                            else {
                                var keep = false;
                                for (var i in player.additionalSkills) {
                                    if (i.indexOf('hidden:') == 0 &amp;&amp; game.expandSkills(player.additionalSkills[i]).contains(event.skill)) {
                                        keep = true; break;
                                    }
                                }
                                if (!keep) {
                                    event.finish();
                                }
                            }
                        }
                    }
                    else {
                        event.finish();
                    }
                    "step 1"
                    if (event.cancelled) {
                        event.finish();
                        return;
                    }
                    var info = get.info(event.skill);
                    if (!event.revealed &amp;&amp; !info.forced) {
                        var checkFrequent = function (info) {
                            if (player.hasSkillTag('nofrequent', false, event.skill)) return false;
                            if (typeof info.frequent == 'boolean') return info.frequent;
                            if (typeof info.frequent == 'function') return info.frequent(trigger, player);
                            if (info.frequent == 'check' &amp;&amp; typeof info.check == 'function') return info.check(trigger, player);
                            return false;
                        }
                        if (info.direct &amp;&amp; player.isUnderControl()) {
                            game.swapPlayerAuto(player);
                            event._result = { bool: true };
                            event._direct = true;
                        }
                        else if (info.direct) {
                            event._result = { bool: true };
                            event._direct = true;
                        }
                        else if (info.direct &amp;&amp; player.isOnline()) {
                            event._result = { bool: true };
                            event._direct = true;
                        }
                        else {
                            if (checkFrequent(info)) {
                                event.frequentSkill = true;
                            }
                            var str;
                            var check = info.check;
                            if (info.prompt) str = info.prompt;
                            else {
                                if (typeof info.logTarget == 'string') {
                                    str = get.prompt(event.skill, trigger[info.logTarget], player);
                                }
                                else if (typeof info.logTarget == 'function') {
                                    str = get.prompt(event.skill, info.logTarget(trigger, player), player);
                                }
                                else {
                                    str = get.prompt(event.skill, null, player);
                                }
                            }
                            if (typeof str == 'function') { str = str(trigger, player) }
                            var next = player.chooseBool(str);
                            if (event.frequentSkill) next.set('frequentSkill', event.skill);
                            next.set('forceDie', true);
                            next.ai = function () {
                                return !check || check(trigger, player);
                            };
                            if (typeof info.prompt2 == 'function') {
                                next.set('prompt2', info.prompt2(trigger, player));
                            }
                            else if (typeof info.prompt2 == 'string') {
                                next.set('prompt2', info.prompt2);
                            }
                            else if (info.prompt2 != false) {
                                if (lib.dynamicTranslate[event.skill] || lib.translate[event.skill + '_info'])
                                    next.set('prompt2', get.skillInfoTranslation(event.skill, player));
                            }
                            if (trigger.skillwarn) {
                                if (next.prompt2) {
                                    next.set('prompt2', '&lt;span class="thundertext">' + trigger.skillwarn + '&lt;/span>' + next.prompt2);
                                }
                                else {
                                    next.set('prompt2', trigger.skillwarn);
                                }
                            }

                            if (info.addDialog) {
                                var createDialog = [str, 'small'];
                                if (next.prompt2) createDialog.push(next.prompt2);
                                createDialog.push(info.addDialog(trigger, player));
                                next.set('createDialog', createDialog);
                            }
                        }
                    }
                    "step 2"
                    var info = get.info(event.skill);
                    if (result &amp;&amp; result.bool != false) {
                        var autodelay = info.autodelay;
                        if (typeof autodelay == 'function') {
                            autodelay = autodelay(trigger, player);
                        }
                        if (autodelay &amp;&amp; (info.forced || !event.isMine())) {
                            if (typeof autodelay == 'number') {
                                game.delayx(autodelay);
                            }
                            else {
                                game.delayx();
                            }
                        }
                    }
                    "step 3"
                    var info = get.info(event.skill);
                    if (result &amp;&amp; result.bool == false) {
                        if (info.oncancel) info.oncancel(trigger, player);
                        event.finish();
                        return;
                    }
                    var next = game.createEvent(event.skill);
                    if (typeof info.usable == 'number') {
                        player.addSkill('counttrigger');
                        if (!player.storage.counttrigger) {
                            player.storage.counttrigger = {};
                        }
                        if (!player.storage.counttrigger[event.skill]) {
                            player.storage.counttrigger[event.skill] = 1;
                        }
                        else {
                            player.storage.counttrigger[event.skill]++;
                        }
                    }
                    next.player = player;
                    next._trigger = trigger;
                    next.triggername = event.triggername;
                    next.setContent(info.content);
                    next.skillHidden = event.skillHidden;
                    if (info.forceDie) next.forceDie = true;
                    if (info.popup != false &amp;&amp; !info.direct) {
                        if (info.popup) {
                            player.popup(info.popup);
                            game.log(player, '', '#p' + get.skillTranslation(event.skill, player) + '');
                        }
                        else {
                            if (info.logTarget &amp;&amp; info.logLine !== false) {
                                if (typeof info.logTarget == 'string') {
                                    player.logSkill(event.skill, trigger[info.logTarget], info.line);
                                }
                                else if (typeof info.logTarget == 'function') {
                                    player.logSkill(event.skill, info.logTarget(trigger, player), info.line);
                                }
                            }
                            else {
                                player.logSkill(event.skill, false, info.line);
                            }
                        }
                    }
                    "step 4"
                    if (player._hookTrigger) {
                        for (var i = 0; i &lt; player._hookTrigger.length; i++) {
                            var info = lib.skill[player._hookTrigger[i]].hookTrigger;
                            if (info) {
                                if (info.after &amp;&amp; info.after(event, player, event.triggername)) {
                                    event.trigger('triggerAfter');
                                    break;
                                }
                            }
                        }
                    }
                },
                /**
                 * Play video
                 * @name content.playVideoContent
                 * @type {GameCores.Bases.StateMachine}
                 */
                playVideoContent: function () {
                    'step 0'
                    game.delay(0, 500);
                    'step 1'
                    if (!game.chess) {
                        ui.control.innerHTML = '';
                        var nodes = [];
                        for (var i = 0; i &lt; ui.arena.childNodes.length; i++) {
                            nodes.push(ui.arena.childNodes[i]);
                        }
                        for (var i = 0; i &lt; nodes.length; i++) {
                            if (nodes[i] == ui.canvas) continue;
                            if (nodes[i] == ui.control) continue;
                            if (nodes[i] == ui.mebg) continue;
                            if (nodes[i] == ui.me) continue;
                            if (nodes[i] == ui.roundmenu) continue;
                            nodes[i].remove();
                        }
                        ui.sidebar.innerHTML = '';
                        ui.cardPile.innerHTML = '';
                        ui.discardPile.innerHTML = '';
                        ui.special.innerHTML = '';
                        ui.ordering.innerHTML = '';
                    }
                    ui.system.firstChild.innerHTML = '';
                    ui.system.lastChild.innerHTML = '';
                    ui.system.firstChild.appendChild(ui.config2);
                    if (ui.updateVideoMenu) {
                        ui.updateVideoMenu();
                    }
                    _status.videoDuration = 1;
                    ui.create.system('', function () {
                        var mode = localStorage.getItem(lib.configprefix + 'playbackmode');
                        if (mode) {
                            game.saveConfig('mode', mode);
                        }
                        game.reload();
                    });
                    ui.create.system('', function () {
                        _status.replayvideo = true;
                        game.playVideo(_status.playback, lib.config.mode);
                    });
                    ui.create.system('', ui.click.pause, true).id = 'pausebutton';
                    var slow = ui.create.system('', function () {
                        _status.videoDuration *= 1.5;
                        updateDuration();
                    }, true);
                    var fast = ui.create.system('', function () {
                        _status.videoDuration /= 1.5;
                        updateDuration();
                    }, true);
                    var updateDuration = function () {
                        if (_status.videoDuration > 1) {
                            slow.classList.add('glow');
                        }
                        else {
                            slow.classList.remove('glow');
                        }
                        if (_status.videoDuration &lt; 1) {
                            fast.classList.add('glow');
                        }
                        else {
                            fast.classList.remove('glow');
                        }
                    }
                    ui.system.style.display = '';
                    ui.refresh(ui.system);
                    ui.system.show();
                    ui.window.show();
                    if (lib.config.mode != 'versus' &amp;&amp; lib.config.mode != 'boss') {
                        ui.arena.style.display = '';
                        ui.refresh(ui.arena);
                        ui.arena.show();
                    }
                    if (!game.chess) {
                        game.playerMap = {};
                    }
                    game.finishCards();
                    'step 2'
                    if (event.video.length) {
                        var content = event.video.shift();
                        // console.log(content);
                        if (content.type == 'delay') {
                            game.delay(content.content);
                        }
                        else if (content.type == 'play') {
                            window.play = {};
                            if (!event.playtoload) {
                                event.playtoload = 1;
                            }
                            else {
                                event.playtoload++;
                            }
                            var script = lib.init.js(lib.assetURL + 'play', content.name);
                            script.addEventListener('load', function () {
                                var play = window.play[content.name]
                                if (play &amp;&amp; play.video) {
                                    play.video(content.init);
                                }
                                event.playtoload--;
                                if (event.playtoload == 0) {
                                    delete window.play;
                                }
                            });
                        }
                        else if (typeof content.player == 'string' &amp;&amp; game.playerMap[content.player] &amp;&amp;
                            game.playerMap[content.player].classList &amp;&amp;
                            !game.playerMap[content.player].classList.contains('obstacle')) {
                            game.videoContent[content.type](game.playerMap[content.player], content.content);
                        }
                        else {
                            game.videoContent[content.type](content.content);
                        }
                        if (event.video.length) {
                            game.delay(0, _status.videoDuration * Math.min(2000, event.video[0].delay));
                        }
                        event.redo();
                    }
                    else {
                        _status.over = true;
                        ui.system.lastChild.hide();
                        setTimeout(function () {
                            ui.system.lastChild.innerHTML = '';
                        }, 500);
                    }
                },
                /**
                 * wait for player
                 * @name content.waitForPlayer
                 * @type {GameCores.Bases.StateMachine}
                 */
                waitForPlayer: function () {
                    'step 0'
                    ui.auto.hide();
                    ui.pause.hide();

                    game.createServer();
                    if (!lib.translate.zhu) {
                        lib.translate.zhu = '';
                    }
                    if (event.func) {
                        event.func();
                    }
                    if (!lib.configOL.number) {
                        lib.configOL.number = parseInt(lib.configOL.player_number);
                    }
                    if (game.onlineroom) {
                        game.send('server', 'config', lib.configOL);
                    }

                    ui.create.connectPlayers(game.ip);
                    if (!window.isNonameServer) {
                        var me = game.connectPlayers[0];
                        me.setIdentity('zhu');
                        me.initOL(get.connectNickname(), lib.config.connect_avatar);
                        me.playerid = '1';
                        game.onlinezhu = '1';
                    }
                    _status.waitingForPlayer = true;
                    if (window.isNonameServer) {
                        document.querySelector('#server_status').innerHTML = '';
                    }
                    game.pause();
                    'step 1'
                    _status.waitingForPlayer = false;
                    lib.configOL.gameStarted = true;
                    if (window.isNonameServer) {
                        document.querySelector('#server_status').innerHTML = '';
                    }
                    if (game.onlineroom) {
                        game.send('server', 'config', lib.configOL);
                    }
                    for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                        game.connectPlayers[i].delete();
                    }
                    delete game.connectPlayers;
                    if (ui.roomInfo) {
                        ui.roomInfo.remove();
                        delete ui.roomInfo;
                    }
                    if (ui.exitroom) {
                        ui.exitroom.remove();
                        delete ui.exitroom;
                    }
                    game.broadcast('gameStart');
                    game.delay(2);
                    ui.auto.show();
                    ui.pause.show();
                    if (lib.config.show_cardpile) {
                        ui.cardPileButton.style.display = '';
                    }
                },
                /**
                 * ()
                 * @name content.replaceHandcards
                 * @type {GameCores.Bases.StateMachine}
                 */
                replaceHandcards: function () {
                    'step 0'
                    if (event.players.contains(game.me)) {
                        game.me.chooseBool('');
                    }
                    else {
                        event.finish();
                    }
                    'step 1'
                    if (result &amp;&amp; result.bool) {
                        var hs = game.me.getCards('h')
                        for (var i = 0; i &lt; hs.length; i++) {
                            hs[i].discard(false);
                        }
                        game.me.directgain(get.cards(hs.length));
                    }
                },
                /**
                 * [support online]
                 * @name content.replaceHandcards
                 * @type {GameCores.Bases.StateMachine}
                 */
                replaceHandcardsOL: function () {
                    'step 0'
                    var send = function () {
                        game.me.chooseBool('');
                        game.resume();
                    };
                    var sendback = function (result, player) {
                        if (result &amp;&amp; result.bool) {
                            var hs = player.getCards('h')
                            game.broadcastAll(function (player, hs) {
                                game.addVideo('lose', player, [get.cardsInfo(hs), [], [], []]);
                                for (var i = 0; i &lt; hs.length; i++) {
                                    hs[i].discard(false);
                                }
                            }, player, hs);
                            player.directgain(get.cards(hs.length));
                        }
                    };
                    for (var i = 0; i &lt; event.players.length; i++) {
                        if (event.players[i].isOnline()) {
                            event.withol = true;
                            event.players[i].send(send);
                            event.players[i].wait(sendback);
                        }
                        else if (event.players[i] == game.me) {
                            event.withme = true;
                            game.me.chooseBool('');
                            game.me.wait(sendback);
                        }
                    }
                    'step 1'
                    if (event.withme) {
                        game.me.unwait(result);
                    }
                    'step 2'
                    if (event.withol &amp;&amp; !event.resultOL) {
                        game.pause();
                    }
                },
                /**
                 * 
                 * @name content.phase
                 * @type {GameCores.Bases.StateMachine}
                 */
                phase: function () {
                    "step 0"
                    if (!event.stageList || !event.stageList.length) event.stageList = lib.phaseName;
                    event.stepNum = 0;
                    "step 1"
                    if (typeof player[event.stageList[event.stepNum]] == 'function') player[event.stageList[event.stepNum]]();
                    "step 2"
                    if (event.stageList[event.stepNum] == 'phaseDraw') {
                        if (!player.noPhaseDelay) {
                            if (player == game.me) {
                                game.delay();
                            }
                            else {
                                game.delayx();
                            }
                        }
                    }
                    if (event.stageList[event.stepNum] == 'phaseUse') {
                        game.broadcastAll(function () {
                            if (ui.tempnowuxie) {
                                ui.tempnowuxie.close();
                                delete ui.tempnowuxie;
                            }
                        });
                    }
                    if (event.stageList[event.stepNum] == 'phaseDiscard') {
                        if (!player.noPhaseDelay) game.delayx();
                        delete player._noSkill;
                    }
                    "step 3"
                    event.trigger('phaseNext');
                    if (event.stageList[++event.stepNum]) {
                        event.trigger('stepNext');

                        event.goto(1);
                    }
                },
                /**
                 * 
                 * @name content.phaseJudge
                 * @type {GameCores.Bases.StateMachine}
                 */
                phaseJudge: function () {
                    "step 0"
                    event.cards = player.getCards('j');
                    if (!event.cards.length) event.finish();
                    "step 1"
                    if (cards.length &amp;&amp; player.getCards('j').contains(cards[0])) {
                        event.card = cards.shift();
                        if (event.card.classList.contains('removing')) {
                            event.card.remove();
                            delete event.card;
                            event.redo();
                        }
                        else if (event.card.classList.contains('feichu')) {
                            event.finish();
                            return;
                        }
                        else {
                            player.lose(event.card, 'visible', ui.ordering);
                            player.$phaseJudge(event.card);
                            event.cancelled = false;
                            event.trigger('phaseJudge');
                            var name = event.card.viewAs || event.card.name;
                            player.popup(name, 'thunder');
                            if (!lib.card[name].effect) {
                                game.delay();
                                event.redo();
                            }
                            else if (!lib.card[name].judge) {
                                game.delay();
                                event.nojudge = true;
                            }
                        }
                    }
                    else event.finish();
                    "step 2"
                    if (!event.cancelled &amp;&amp; !event.nojudge) player.judge(event.card).set('type', 'phase');
                    "step 3"
                    var name = event.card.viewAs || event.card.name;
                    if (event.cancelled &amp;&amp; !event.direct) {
                        if (lib.card[name].cancel) {
                            var next = game.createEvent(name + 'Cancel');
                            next.setContent(lib.card[name].cancel);
                            next.card = event.card;
                            next.cards = [event.card];
                            next.player = player;
                        }
                    }
                    else {
                        var next = game.createEvent(name);
                        next.setContent(lib.card[name].effect);
                        next._result = result;
                        next.card = event.card;
                        next.cards = [event.card];
                        next.player = player;
                    }
                    ui.clear();
                    event.goto(1);
                },
                /**
                 * 
                 * @name content.phaseDraw
                 * @type {GameCores.Bases.StateMachine}
                 */
                phaseDraw: function () {
                    "step 0"
                    event.trigger("phaseDrawBegin1");
                    "step 1"
                    event.trigger("phaseDrawBegin2");
                    "step 2"
                    if (game.modPhaseDraw) {
                        game.modPhaseDraw(player, event.num);
                    }
                    else {
                        if (event.num > 0) {
                            var num = event.num;
                            if (event.attachDraw) {
                                for (var i = 0; i &lt; event.attachDraw.length; i++) {
                                    ui.cardPile.insertBefore(event.attachDraw[i], ui.cardPile.firstChild);
                                }
                                num += event.attachDraw.length;
                            }
                            var next = player.draw(num);
                            if (event.attachDraw) {
                                next.minnum = event.attachDraw.length;
                            }
                        }
                    }
                    "step 3"
                    if (Array.isArray(result)) {
                        event.cards = result;
                    }
                },
                /**
                 * 
                 * @name content.phaseUse
                 * @type {GameCores.Bases.StateMachine}
                 */
                phaseUse: function () {
                    "step 0";
                    var next = player.chooseToUse();
                    if (!lib.config.show_phaseuse_prompt) {
                        next.set('prompt', false);
                    }
                    next.set('type', 'phase');
                    "step 1"
                    if (result.bool &amp;&amp; !event.skipped) {
                        event.goto(0);
                    }
                    game.broadcastAll(function () {
                        if (ui.tempnowuxie) {
                            ui.tempnowuxie.close();
                            delete ui.tempnowuxie;
                        }
                    });
                    "step 2"
                    var stat = player.getStat();
                    for (var i in stat.skill) {
                        var bool = false;
                        var info = lib.skill[i];
                        if (!info) continue;
                        if (info.enable != undefined) {
                            if (typeof info.enable == 'string' &amp;&amp; info.enable == 'phaseUse') bool = true;
                            else if (typeof info.enable == 'object' &amp;&amp; info.enable.contains('phaseUse')) bool = true;
                        }
                        if (bool) stat.skill[i] = 0;
                    }
                    for (var i in stat.card) {
                        var bool = false;
                        var info = lib.card[i];
                        if (!info) continue;
                        if (info.updateUsable == 'phaseUse') stat.card[i] = 0;
                    }
                },
                /**
                 * 
                 * @name content.phaseDiscard
                 * @type {GameCores.Bases.StateMachine}
                 */
                phaseDiscard: function () {
                    "step 0"
                    if (!event.num) event.num = player.needsToDiscard();
                    if (event.num &lt;= 0) event.finish();
                    else {
                        if (lib.config.show_phase_prompt) {
                            player.popup('');
                        }
                    }
                    event.trigger('phaseDiscard');
                    "step 1"
                    player.chooseToDiscard(num, true);
                    "step 2"
                    event.cards = result.cards;
                },
                /**
                 * (|)
                 * @name content.chooseToUse
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseToUse: function () {
                    "step 0"
                    if (event.responded) return;
                    if (game.modeSwapPlayer &amp;&amp; !_status.auto &amp;&amp; player.isUnderControl() &amp;&amp; !lib.filter.wuxieSwap(event)) {
                        game.modeSwapPlayer(player);
                    }
                    var skills = player.getSkills(true);
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var info = lib.skill[skills[i]];
                        if (info &amp;&amp; info.onChooseToUse) {
                            info.onChooseToUse(event);
                        }
                    }
                    _status.noclearcountdown = true;
                    if (event.type == 'phase') {
                        if (event.isMine()) {
                            if (lib.config.mode == 'richer' &amp;&amp; lib.skill._chessmove.filter(true, player) &amp;&amp; player.getStat().skill &amp;&amp; !player.getStat().skill._chessmove) {
                                event.endButton = ui.create.control('', 'stayleft', function () { });
                            }
                            else {
                                event.endButton = ui.create.control('', 'stayleft', function () {
                                    if (_status.event.skill) {
                                        ui.click.cancel();
                                    }
                                    ui.click.cancel();
                                });
                            }
                            event.fakeforce = true;
                        }
                        else {
                            if (event.endButton) {
                                event.endButton.close();
                                delete event.endButton;
                            }
                            event.fakeforce = false;
                        }
                    }
                    if (event.player.isUnderControl() &amp;&amp; !_status.auto) {
                        event.result = {
                            bool: false
                        }
                        return;
                    }
                    else if (event.isMine()) {
                        if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                            ui.click.cancel();
                            return;
                        }
                        if (event.type == 'wuxie') {
                            if (ui.tempnowuxie) {
                                var triggerevent = event.getTrigger();
                                if (triggerevent &amp;&amp; triggerevent.targets &amp;&amp; triggerevent.num == triggerevent.targets.length - 1) {
                                    ui.tempnowuxie.close();
                                }
                            }
                            if (lib.filter.wuxieSwap(event)) {
                                event.result = {
                                    bool: false
                                }
                                return;
                            }
                        }
                        var ok = game.check();
                        if (!ok || !lib.config.auto_confirm) {
                            game.pause();
                            if (lib.config.enable_vibrate &amp;&amp; player._noVibrate) {
                                delete player._noVibrate;
                                game.vibrate();
                            }
                        }
                        if (!ok) {
                            if (typeof event.prompt == 'string') {
                                if (event.openskilldialog) {
                                    event.skillDialog = ui.create.dialog(event.openskilldialog);
                                    delete event.openskilldialog;
                                    event.dialog = event.prompt;
                                }
                                else {
                                    event.dialog = ui.create.dialog(event.prompt);
                                    if (event.prompt2) {
                                        event.dialog.addText(event.prompt2);
                                    }
                                }
                            }
                            else if (event.prompt == 'function') {
                                event.dialog = ui.create.dialog(event.prompt(event));
                            }
                            else if (event.prompt == undefined) {
                                var str;
                                if (typeof event.filterCard == 'object') {
                                    var filter = event.filterCard;
                                    str = '' + get.cnNumber(event.selectCard[0]) + ''
                                    if (filter.name) {
                                        str += get.translation(filter.name);
                                    }
                                    else {
                                        str += '';
                                    }
                                }
                                else {
                                    str = '';
                                }
                                if (event.openskilldialog) {
                                    event.skillDialog = ui.create.dialog(event.openskilldialog);
                                    delete event.openskilldialog;
                                    event.dialog = str;
                                }
                                else if (typeof event.skillDialog != 'string') {
                                    event.dialog = ui.create.dialog(str);
                                }
                                else {
                                    event.dialog = str;
                                }
                            }
                        }
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event.result = 'ai';
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        var ok = game.check();
                        if (ok) {
                            ui.click.ok();
                        }
                        else if (ai.basic.chooseCard(event.ai1)) {
                            if (ai.basic.chooseTarget(event.ai2)) {
                                ui.click.ok();
                                event._aiexcludeclear = true;
                            }
                            else {
                                if (!event.norestore) {
                                    if (event.skill) {
                                        var skill = event.skill;
                                        ui.click.cancel();
                                        event._aiexclude.add(skill);
                                        var info = get.info(skill);
                                        if (info.sourceSkill) {
                                            event._aiexclude.add(info.sourceSkill);
                                        }
                                    }
                                    else {
                                        get.card(true).aiexclude();
                                        game.uncheck();
                                    }
                                    event.redo();
                                    game.resume();
                                }
                                else {
                                    ui.click.cancel();
                                }
                            }
                        }
                        else if (event.skill &amp;&amp; !event.norestore) {
                            var skill = event.skill;
                            ui.click.cancel();
                            event._aiexclude.add(skill);
                            var info = get.info(skill);
                            if (info.sourceSkill) {
                                event._aiexclude.add(info.sourceSkill);
                            }
                            event.redo();
                            game.resume();
                        }
                        else {
                            ui.click.cancel();
                        }
                        if (event.aidelay &amp;&amp; event.result &amp;&amp; event.result.bool) {
                            game.delayx();
                        }
                    }
                    "step 2"
                    if (event.endButton) {
                        event.endButton.close();
                        delete event.endButton;
                    }
                    event.resume();
                    if (event.result) {
                        if (event.result.skill) {
                            var info = get.info(event.result.skill);
                            if (info &amp;&amp; info.chooseButton) {
                                if (event.dialog &amp;&amp; typeof event.dialog == 'object') event.dialog.close();
                                var dialog = info.chooseButton.dialog(event, player);
                                if (info.chooseButton.chooseControl) {
                                    var next = player.chooseControl(info.chooseButton.chooseControl(event, player));
                                    next.dialog = dialog;
                                    next.set('ai', info.chooseButton.check || function () { return 0; });
                                }
                                else {
                                    var next = player.chooseButton(dialog);
                                    next.set('ai', info.chooseButton.check || function () { return 1; });
                                    next.set('filterButton', info.chooseButton.filter || function () { return true; });
                                    next.set('selectButton', info.chooseButton.select || 1);
                                }
                                event.buttoned = event.result.skill;
                            }
                            else if (info &amp;&amp; info.precontent &amp;&amp; !game.online &amp;&amp; !event.nouse) {
                                var next = game.createEvent('pre_' + event.result.skill);
                                next.setContent(info.precontent);
                                next.set('result', event.result);
                                next.set('player', player);
                            }
                        }
                    }
                    "step 3"
                    if (event.buttoned) {
                        if (result.bool || result.control &amp;&amp; result.control != 'cancel2') {
                            var info = get.info(event.buttoned).chooseButton;
                            lib.skill[event.buttoned + '_backup'] = info.backup(info.chooseControl ? result : result.links, player);
                            lib.skill[event.buttoned + '_backup'].sourceSkill = event.buttoned;
                            if (game.online) {
                                event._sendskill = [event.buttoned + '_backup', lib.skill[event.buttoned + '_backup']];
                            }
                            event.backup(event.buttoned + '_backup');
                            if (info.prompt) {
                                event.openskilldialog = info.prompt(info.chooseControl ? result : result.links, player);
                            }
                        }
                        else {
                            ui.control.animate('nozoom', 100);
                            event._aiexclude.add(event.buttoned);
                        }
                        event.goto(0);
                        delete event.buttoned;
                    }
                    "step 4"
                    if (event._aiexcludeclear) {
                        delete event._aiexcludeclear;
                        event._aiexclude.length = 0;
                    }
                    delete _status.noclearcountdown;
                    if (event.skillDialog &amp;&amp; get.objtype(event.skillDialog) == 'div') {
                        event.skillDialog.close();
                    }
                    if (event.result &amp;&amp; event.result.bool &amp;&amp; !game.online &amp;&amp; !event.nouse) {
                        player.useResult(event.result, event);
                    }
                    else if (event._sendskill) {
                        event.result._sendskill = event._sendskill;
                    }
                    if (event.dialog &amp;&amp; typeof event.dialog == 'object') event.dialog.close();
                    if (!_status.noclearcountdown) {
                        game.stopCountChoose();
                    }
                    "step 5"
                    if (event._result &amp;&amp; event.result) {
                        event.result.result = event._result;
                    }
                },
                /**
                 * (|)
                 * @name content.chooseToUse
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseToRespond: function () {
                    "step 0"
                    if (event.responded) {
                        delete event.dialog;
                        return;
                    }
                    var skills = player.getSkills(true);
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var info = lib.skill[skills[i]];
                        if (info &amp;&amp; info.onChooseToRespond) {
                            info.onChooseToRespond(event);
                        }
                    }
                    _status.noclearcountdown = true;
                    if (!_status.connectMode &amp;&amp; lib.config.skip_shan &amp;&amp; event.autochoose &amp;&amp; event.autochoose()) {
                        event.result = { bool: false };
                    }
                    else {
                        if (game.modeSwapPlayer &amp;&amp; !_status.auto &amp;&amp; player.isUnderControl()) {
                            game.modeSwapPlayer(player);
                        }
                        if (event.isMine()) {
                            if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                                ui.click.cancel();
                                return;
                            }
                            var ok = game.check();
                            if (!ok) {
                                game.pause();
                                if (event.openskilldialog) {
                                    event.skillDialog = ui.create.dialog(event.openskilldialog);
                                    delete event.openskilldialog;
                                    event.dialog = event.prompt;
                                }
                                else {
                                    if (event.prompt) event.dialog = ui.create.dialog(event.prompt);
                                    if (event.prompt2) event.dialog.addText(event.prompt2);
                                }
                            }
                        }
                        else if (event.isOnline()) {
                            event.send();
                        }
                        else {
                            event.result = 'ai';
                        }
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        var ok = game.check();
                        if (ok) {
                            ui.click.ok();
                        }
                        else if (ai.basic.chooseCard(event.ai)) {
                            ui.click.ok();
                            event._aiexcludeclear = true;
                        }
                        else if (event.skill &amp;&amp; !event.norestore) {
                            var skill = event.skill;
                            ui.click.cancel();
                            event._aiexclude.add(skill);
                            var info = get.info(skill);
                            if (info.sourceSkill) {
                                event._aiexclude.add(info.sourceSkill);
                            }
                            event.redo();
                            game.resume();
                        }
                        else {
                            ui.click.cancel();
                        }
                        if (event.aidelay &amp;&amp; event.result &amp;&amp; event.result.bool) {
                            game.delayx();
                        }
                    }
                    "step 2"
                    event.resume();
                    if (event.result) {
                        if (event.result.skill) {
                            var info = get.info(event.result.skill);
                            if (info &amp;&amp; info.chooseButton) {
                                if (event.dialog &amp;&amp; typeof event.dialog == 'object') event.dialog.close();
                                var dialog = info.chooseButton.dialog(event, player);
                                if (info.chooseButton.chooseControl) {
                                    var next = player.chooseControl(info.chooseButton.chooseControl(event, player));
                                    next.dialog = dialog;
                                    next.set('ai', info.chooseButton.check || function () { return 0; });
                                }
                                else {
                                    var next = player.chooseButton(dialog);
                                    next.set('ai', info.chooseButton.check || function () { return 1; });
                                    next.set('filterButton', info.chooseButton.filter || function () { return true; });
                                    next.set('selectButton', info.chooseButton.select || 1);
                                }
                                event.buttoned = event.result.skill;
                            }
                            else if (info &amp;&amp; info.precontent &amp;&amp; !game.online) {
                                var next = game.createEvent('pre_' + event.result.skill);
                                next.setContent(info.precontent);
                                next.set('result', event.result);
                                next.set('player', player);
                            }
                        }
                    }
                    "step 3"
                    if (event.buttoned) {
                        if (result.bool || result.control &amp;&amp; result.control != 'cancel2') {
                            var info = get.info(event.buttoned).chooseButton;
                            lib.skill[event.buttoned + '_backup'] = info.backup(info.chooseControl ? result : result.links, player);
                            lib.skill[event.buttoned + '_backup'].sourceSkill = event.buttoned;
                            if (game.online) {
                                event._sendskill = [event.buttoned + '_backup', lib.skill[event.buttoned + '_backup']];
                            }
                            event.backup(event.buttoned + '_backup');
                            if (info.prompt) {
                                event.openskilldialog = info.prompt(info.chooseControl ? result : result.links, player);
                            }
                        }
                        else {
                            ui.control.animate('nozoom', 100);
                            event._aiexclude.add(event.buttoned);
                        }
                        event.goto(0);
                        delete event.buttoned;
                    }
                    "step 4"
                    delete _status.noclearcountdown;
                    if (event.skillDialog &amp;&amp; get.objtype(event.skillDialog) == 'div') {
                        event.skillDialog.close();
                    }
                    if (event.result.bool &amp;&amp; !game.online) {
                        if (event.result._sendskill) {
                            lib.skill[event.result._sendskill[0]] = event.result._sendskill[1];
                        }
                        var info = get.info(event.result.skill);
                        if (event.onresult) {
                            event.onresult(event.result);
                        }
                        if (event.result.skill) {
                            if (info.direct &amp;&amp; !info.clearTime) {
                                _status.noclearcountdown = true;
                            }
                        }
                        if (event.logSkill) {
                            if (typeof event.logSkill == 'string') {
                                player.logSkill(event.logSkill);
                            }
                            else if (Array.isArray(event.logSkill)) {
                                player.logSkill.apply(player, event.logSkill);
                            }
                        }
                        if (!event.result.card &amp;&amp; event.result.skill) {
                            event.result.used = event.result.skill;
                            player.useSkill(event.result.skill, event.result.cards, event.result.targets);
                        }
                        else {
                            if (info &amp;&amp; info.prerespond) {
                                info.prerespond(event.result, player);
                            }
                            var next = player.respond(event.result.cards, event.result.card, event.animate, event.result.skill, event.source);
                            if (event.result.noanimate) next.animate = false;
                            if (event.parent.card &amp;&amp; event.parent.type == 'card') {
                                next.set('respondTo', [event.parent.player, event.parent.card]);
                            }
                            if (event.noOrdering) next.noOrdering = true;
                        }
                    }
                    else if (event._sendskill) {
                        event.result._sendskill = event._sendskill;
                    }
                    if (event.dialog &amp;&amp; event.dialog.close) event.dialog.close();
                    if (!_status.noclearcountdown) {
                        game.stopCountChoose();
                    }
                },
                /**
                 * 
                 * @name content.chooseToDiscard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseToDiscard: function () {
                    "step 0"
                    if (event.autochoose()) {
                        event.result = {
                            bool: true,
                            autochoose: true,
                            cards: player.getCards(event.position),
                            rawcards: player.getCards(event.position),
                        }
                        for (var i = 0; i &lt; event.result.cards.length; i++) {
                            if (!lib.filter.cardDiscardable(event.result.cards[i], player, event)) {
                                event.result.cards.splice(i--, 1);
                            }
                        }
                    }
                    else {
                        // &amp;&amp;!lib.filter.wuxieSwap(trigger)
                        if (game.modeSwapPlayer &amp;&amp; !_status.auto &amp;&amp; player.isUnderControl()) {
                            game.modeSwapPlayer(player);
                        }
                        event.rangecards = player.getCards(event.position);
                        for (var i = 0; i &lt; event.rangecards.length; i++) {
                            if (lib.filter.cardDiscardable(event.rangecards[i], player, event)) {
                                event.rangecards.splice(i--, 1);
                            }
                            else {
                                event.rangecards[i].uncheck('chooseToDiscard');
                            }
                        }
                        var range = get.select(event.selectCard);
                        game.check();
                        if (event.isMine()) {
                            if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                                ui.click.cancel();
                                return;
                            }
                            game.pause();
                            if (range[1] > 1 &amp;&amp; typeof event.selectCard != 'function') {
                                event.promptdiscard = ui.create.control('', function () {
                                    ai.basic.chooseCard(event.ai);
                                    if (_status.event.custom.add.card) {
                                        _status.event.custom.add.card();
                                    }
                                    for (var i = 0; i &lt; ui.selected.cards.length; i++) {
                                        ui.selected.cards[i].updateTransform(true);
                                    }
                                });
                            }
                            if (Array.isArray(event.dialog)) {
                                event.dialog = ui.create.dialog.apply(this, event.dialog);
                                event.dialog.open();
                                event.dialog.classList.add('noselect');
                            }
                            else if (event.prompt != false) {
                                var str;
                                if (typeof (event.prompt) == 'string') str = event.prompt;
                                else {
                                    str = '';
                                    if (range[0] == range[1]) str += get.cnNumber(range[0]);
                                    else if (range[1] == Infinity) str += '' + get.cnNumber(range[0]);
                                    else str += get.cnNumber(range[0]) + '' + get.cnNumber(range[1]);
                                    str += '';
                                    if (event.position == 'h' || event.position == undefined) str += '';
                                    if (event.position == 'e') str += '';
                                    str += '';
                                }
                                event.dialog = ui.create.dialog(str);
                                if (event.prompt2) {
                                    event.dialog.addText(event.prompt2, event.prompt2.length &lt;= 20);
                                }
                                if (Array.isArray(event.selectCard)) {
                                    event.promptbar = event.dialog.add('0/' + get.numStr(event.selectCard[1], 'card'));
                                    event.custom.add.card = function () {
                                        _status.event.promptbar.innerHTML =
                                            ui.selected.cards.length + '/' + get.numStr(_status.event.selectCard[1], 'card');
                                    }
                                }
                            }
                            else if (get.itemtype(event.dialog) == 'dialog') {
                                event.dialog.style.display = '';
                                event.dialog.open();
                            }
                        }
                        else if (event.isOnline()) {
                            event.send();
                        }
                        else {
                            event.result = 'ai';
                        }
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseCard(event.ai) || forced) {
                            ui.click.ok();
                        }
                        else if (event.skill) {
                            var skill = event.skill;
                            ui.click.cancel();
                            event._aiexclude.add(skill);
                            event.redo();
                            game.resume();
                        }
                        else {
                            ui.click.cancel();
                        }
                    }
                    if (event.rangecards) {
                        for (var i = 0; i &lt; event.rangecards.length; i++) {
                            event.rangecards[i].recheck('chooseToDiscard');
                        }
                    }
                    "step 2"
                    event.resume();
                    if (event.promptdiscard) {
                        event.promptdiscard.close();
                    }
                    "step 3"
                    if (event.result.bool &amp;&amp; event.result.cards &amp;&amp; event.result.cards.length &amp;&amp;
                        !game.online &amp;&amp; event.autodelay &amp;&amp; !event.isMine()) {
                        if (typeof event.autodelay == 'number') {
                            game.delayx(event.autodelay);
                        }
                        else {
                            game.delayx();
                        }
                    }
                    "step 4"
                    if (event.logSkill &amp;&amp; event.result.bool &amp;&amp; !game.online) {
                        if (typeof event.logSkill == 'string') {
                            player.logSkill(event.logSkill);
                        }
                        else if (Array.isArray(event.logSkill)) {
                            player.logSkill.apply(player, event.logSkill);
                        }
                    }
                    if (!game.online) {
                        if (typeof event.delay == 'boolean') {
                            event.done = player.discard(event.result.cards).set('delay', event.delay);
                        }
                        else {
                            event.done = player.discard(event.result.cards);
                        }
                    }
                    if (event.dialog &amp;&amp; event.dialog.close) event.dialog.close();
                },
                /**
                 * 
                 * @name content.chooseToCompareLose
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseToCompareLose: function () {
                    for (var i = 0; i &lt; event.lose_list.length; i++) {
                        var next = event.lose_list[i][0].lose(event.lose_list[i][1], ui.ordering);
                        next.relatedEvent = event.getParent();
                        next.getlx = false;
                    }
                },
                /**
                 * 
                 * @name content.chooseToCompareMultiple
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseToCompareMultiple: function () {
                    "step 0"
                    if (player.countCards('h') == 0) {
                        event.result = { cancelled: true, bool: false }
                        event.finish();
                        return;
                    }
                    for (var i = 0; i &lt; targets.length; i++) {
                        if (targets[i].countCards('h') == 0) {
                            event.result = { cancelled: true, bool: false }
                            event.finish();
                            return;
                        }
                    }
                    if (!event.multitarget) {
                        targets.sort(lib.sort.seat);
                    }
                    game.log(player, '', targets, '');
                    "step 1"
                    event._result = [];
                    event.list = targets.filter(function (current) {
                        return !event.fixedResult || !event.fixedResult[current.playerid];
                    });
                    if (event.list.length || !event.fixedResult || !event.fixedResult[player.playerid]) {
                        if (!event.fixedResult || !event.fixedResult[player.playerid]) event.list.unshift(player);
                        player.chooseCardOL(event.list, '', true).set('type', 'compare').set('ai', event.ai).set('source', player).aiCard = function (target) {
                            var hs = target.getCards('h');
                            var event = _status.event;
                            event.player = target;
                            hs.sort(function (a, b) {
                                return event.ai(b) - event.ai(a);
                            });
                            delete event.player;
                            return { bool: true, cards: [hs[0]] };
                        };
                    }
                    "step 2"
                    var cards = [];
                    var lose_list = [];
                    if (event.fixedResult &amp;&amp; event.fixedResult[player.playerid]) {
                        event.list.unshift(player);
                        result.unshift({ bool: true, cards: [event.fixedResult[player.playerid]] });
                        lose_list.push([player, [event.fixedResult[player.playerid]]]);
                    }
                    else {
                        if (result[0].skill &amp;&amp; lib.skill[result[0].skill] &amp;&amp; lib.skill[result[0].skill].onCompare) {
                            player.logSkill(result[0].skill);
                            result[0].cards = lib.skill[result[0].skill].onCompare(player)
                        }
                        else lose_list.push([player, result[0].cards]);
                    };
                    for (var j = 0; j &lt; targets.length; j++) {
                        if (event.list.contains(targets[j])) {
                            var i = event.list.indexOf(targets[j]);
                            if (result[i].skill &amp;&amp; lib.skill[result[i].skill] &amp;&amp; lib.skill[result[i].skill].onCompare) {
                                event.list[i].logSkill(result[i].skill);
                                result[i].cards = lib.skill[result[i].skill].onCompare(event.list[i]);
                            }
                            else lose_list.push([targets[j], result[i].cards]);
                            cards.push(result[i].cards[0]);
                        }
                        else if (event.fixedResult &amp;&amp; event.fixedResult[targets[j].playerid]) {
                            cards.push(event.fixedResult[targets[j].playerid]);
                            lose_list.push([targets[j], [event.fixedResult[targets[j].playerid]]]);
                        }
                    }
                    if (lose_list.length) {
                        game.loseAsync({
                            lose_list: lose_list,
                        }).setContent('chooseToCompareLose');
                    }
                    event.cardlist = cards;
                    event.cards = cards;
                    event.card1 = result[0].cards[0];
                    event.num1 = event.card1.number;
                    event.iwhile = 0;
                    event.result = {
                        player: event.card1,
                        targets: event.cardlist.slice(0),
                        num1: [],
                        num2: [],
                    };
                    game.log(player, '', event.card1);
                    "step 3"
                    if (event.iwhile &lt; targets.length) {
                        event.target = targets[event.iwhile];
                        event.target.animate('target');
                        player.animate('target');
                        event.card2 = event.cardlist[event.iwhile];
                        event.num2 = event.card2.number;
                        game.log(event.target, '', event.card2);
                        player.line(event.target);
                        player.$compare(event.card1, event.target, event.card2);
                        event.trigger('compare');
                        game.delay(0, 1500);
                    }
                    else {
                        event.goto(7);
                    }
                    "step 4"
                    event.result.num1[event.iwhile] = event.num1;
                    event.result.num2[event.iwhile] = event.num2;
                    var str;
                    if (event.num1 > event.num2) {
                        event.result.winner = player;
                        event.result.loser = target;
                        str = get.translation(player) + '';
                        player.popup('');
                        target.popup('');
                    }
                    else {
                        str = get.translation(player) + '';
                        if (event.num1 == event.num2) {
                            event.result.tie = true;
                            player.popup('');
                            target.popup('');
                        }
                        else {
                            event.result.winner = target;
                            event.result.loser = player;
                            player.popup('');
                            target.popup('');
                        }
                    }
                    game.broadcastAll(function (str) {
                        var dialog = ui.create.dialog(str);
                        dialog.classList.add('center');
                        setTimeout(function () {
                            dialog.close();
                        }, 1000);
                    }, str);
                    game.delay(2);
                    "step 5"
                    if (event.callback) {
                        game.broadcastAll(function (card1, card2) {
                            if (card1.clone) card1.clone.style.opacity = 0.5;
                            if (card2.clone) card2.clone.style.opacity = 0.5;
                        }, event.card1, event.card2);
                        var next = game.createEvent('compareMultiple');
                        next.player = player;
                        next.target = event.target;
                        next.card1 = event.card1;
                        next.card2 = event.card2;
                        next.num1 = event.num1;
                        next.num2 = event.num2;
                        next.winner = event.result.winner;
                        next.setContent(event.callback);
                    }
                    "step 6"
                    game.broadcastAll(ui.clear);
                    event.iwhile++;
                    event.goto(3);
                    "step 7"
                    event.cards.add(event.card1);
                },
                /**
                 * 
                 * @name content.chooseToCompare
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseToCompare: function () {
                    "step 0"
                    if (player.countCards('h') == 0 || target.countCards('h') == 0) {
                        event.result = { cancelled: true, bool: false }
                        event.finish();
                        return;
                    }
                    game.log(player, '', target, '');
                    event.lose_list = [];
                    "step 1"
                    var sendback = function () {
                        if (_status.event != event) {
                            return function () {
                                event.resultOL = _status.event.resultOL;
                            };
                        }
                    };
                    if (event.fixedResult &amp;&amp; event.fixedResult[player.playerid]) {
                        event.card1 = event.fixedResult[player.playerid];
                        event.lose_list.push([player, event.card1]);
                    }
                    else if (player.isOnline()) {
                        player.wait(sendback);
                        event.ol = true;
                        player.send(function (ai) {
                            game.me.chooseCard('', true).set('type', 'compare').set('glow_result', true).ai = ai;
                            game.resume();
                        }, event.ai);
                    }
                    else {
                        event.localPlayer = true;
                        player.chooseCard('', true).set('type', 'compare').set('glow_result', true).ai = event.ai;
                    }
                    if (event.fixedResult &amp;&amp; event.fixedResult[target.playerid]) {
                        event.card2 = event.fixedResult[target.playerid];
                        event.lose_list.push([target, event.card2]);
                    }
                    else if (target.isOnline()) {
                        target.wait(sendback);
                        event.ol = true;
                        target.send(function (ai) {
                            game.me.chooseCard('', true).set('type', 'compare').set('glow_result', true).ai = ai;
                            game.resume();
                        }, event.ai);
                    }
                    else {
                        event.localTarget = true;
                    }
                    "step 2"
                    if (event.localPlayer) {
                        if (result.skill &amp;&amp; lib.skill[result.skill] &amp;&amp; lib.skill[result.skill].onCompare) {
                            result.cards = lib.skill[result.skill].onCompare(player);
                            player.logSkill(result.skill);
                        }
                        else event.lose_list.push([player, result.cards[0]]);
                        event.card1 = result.cards[0];
                    }
                    if (event.localTarget) {
                        target.chooseCard('', true).set('type', 'compare').set('glow_result', true).ai = event.ai;
                    }
                    "step 3"
                    if (event.localTarget) {
                        if (result.skill &amp;&amp; lib.skill[result.skill] &amp;&amp; lib.skill[result.skill].onCompare) {
                            target.logSkill(result.skill);
                            result.cards = lib.skill[result.skill].onCompare(target);
                        }
                        else event.lose_list.push([target, result.cards[0]]);
                        event.card2 = result.cards[0];
                    }
                    if (!event.resultOL &amp;&amp; event.ol) {
                        game.pause();
                    }
                    "step 4"
                    try {
                        if (!event.card1) {
                            if (event.resultOL[player.playerid].skill &amp;&amp; lib.skill[event.resultOL[player.playerid].skill] &amp;&amp; lib.skill[event.resultOL[player.playerid].skill].onCompare) {
                                player.logSkill(event.resultOL[player.playerid].skill);
                                event.resultOL[player.playerid].cards = lib.skill[event.resultOL[player.playerid].skill].onCompare(player);
                            }
                            else event.lose_list.push([player, event.resultOL[player.playerid].cards[0]]);
                            event.card1 = event.resultOL[player.playerid].cards[0];
                        };
                        if (!event.card2) {
                            if (event.resultOL[target.playerid].skill &amp;&amp; lib.skill[event.resultOL[target.playerid].skill] &amp;&amp; lib.skill[event.resultOL[target.playerid].skill].onCompare) {
                                target.logSkill(event.resultOL[target.playerid].skill);
                                event.resultOL[target.playerid].cards = lib.skill[event.resultOL[target.playerid].skill].onCompare(player);
                            }
                            else event.lose_list.push([target, event.resultOL[target.playerid].cards[0]]);
                            event.card2 = event.resultOL[target.playerid].cards[0];
                        }
                        if (!event.card1 || !event.card2) {
                            throw ('err');
                        }
                    }
                    catch (e) {
                        console.log(e);
                        game.print(e);
                        event.finish();
                        return;
                    }
                    if (event.card2.number >= 10 || event.card2.number &lt;= 4) {
                        if (target.countCards('h') > 2) {
                            event.addToAI = true;
                        }
                    }
                    if (event.lose_list.length) {
                        game.loseAsync({
                            lose_list: event.lose_list,
                        }).setContent('chooseToCompareLose');
                    }
                    "step 5"
                    game.broadcast(function () {
                        ui.arena.classList.add('thrownhighlight');
                    });
                    ui.arena.classList.add('thrownhighlight');
                    game.addVideo('thrownhighlight1');
                    player.$compare(event.card1, target, event.card2);
                    game.log(player, '', event.card1);
                    game.log(target, '', event.card2);
                    event.num1 = event.card1.number;
                    event.num2 = event.card2.number;
                    event.trigger('compare');
                    game.delay(0, 1500);
                    "step 6"
                    event.result = {
                        player: event.card1,
                        target: event.card2,
                        num1: event.num1,
                        num2: event.num2
                    }
                    var str;
                    if (event.num1 > event.num2) {
                        event.result.bool = true;
                        event.result.winner = player;
                        event.result.loser = target;
                        str = get.translation(player) + '';
                        player.popup('');
                        target.popup('');
                    }
                    else {
                        event.result.bool = false;
                        str = get.translation(player) + '';
                        if (event.num1 == event.num2) {
                            event.result.tie = true;
                            player.popup('');
                            target.popup('');
                        }
                        else {
                            event.result.winner = target;
                            event.result.loser = player;
                            player.popup('');
                            target.popup('');
                        }
                    }
                    game.broadcastAll(function (str) {
                        var dialog = ui.create.dialog(str);
                        dialog.classList.add('center');
                        setTimeout(function () {
                            dialog.close();
                        }, 1000);
                    }, str);
                    game.delay(2);
                    "step 7"
                    if (typeof event.target.ai.shown == 'number' &amp;&amp; event.target.ai.shown &lt;= 0.85 &amp;&amp; event.addToAI) {
                        event.target.ai.shown += 0.1;
                    }
                    game.broadcastAll(function () {
                        ui.arena.classList.remove('thrownhighlight');
                    });
                    game.addVideo('thrownhighlight2');
                    if (event.clear !== false) {
                        game.broadcastAll(ui.clear);
                    }
                    if (typeof event.preserve == 'function') {
                        event.preserve = event.preserve(event.result);
                    }
                    else if (event.preserve == 'win') {
                        event.preserve = event.result.bool;
                    }
                    else if (event.preserve == 'lose') {
                        event.preserve = !event.result.bool;
                    }
                },
                /**
                 * 
                 * @name content.discoverSkill
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                discoverSkill: function () {
                    'step 0'
                    var num = event.num || 3;
                    var choice;
                    if (typeof event.list == 'string' || typeof event.list == 'function') {
                        choice = get.gainableSkills(event.list).randomGets(num);
                    }
                    else if (Array.isArray(event.list)) {
                        choice = event.list.randomGets(num);
                    }
                    else {
                        choice = Array.from(event.list).randomGets(num);
                    }
                    if (!choice.length) {
                        event.finish();
                        event.result = { bool: false };
                        return;
                    }
                    event.skillai = event.ai || function (list) {
                        return get.max(list, get.skillRank, 'item');
                    };
                    if (_status.connectMode) {
                        if (choice.length == 1) event._result = { control: list[0] };
                        else player.chooseControl(choice).set('prompt', '').set('forceDie', true).set('ai', function () {
                            return event.skillai(choice);
                        });
                    }
                    else if (event.isMine()) {
                        game.check();
                        game.pause();
                        event.dialog = ui.create.dialog('forcebutton');
                        event.dialog.add(event.prompt || '');
                        var clickItem = function () {
                            _status.event._result = this.link;
                            game.resume();
                        };
                        for (i = 0; i &lt; choice.length; i++) {
                            if (lib.translate[choice[i] + '_info']) {
                                var translation = get.translation(choice[i]);
                                if (translation[0] == '' &amp;&amp; translation.length == 3) {
                                    translation = translation.slice(1, 3);
                                }
                                else {
                                    translation = translation.slice(0, 2);
                                }
                                var item = event.dialog.add('&lt;div class="popup pointerdiv" style="width:80%;display:inline-block">&lt;div class="skill">' +
                                    translation + '&lt;/div>&lt;div>' + lib.translate[choice[i] + '_info'] + '&lt;/div>&lt;/div>');
                                item.firstChild.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickItem);
                                item.firstChild.link = choice[i];
                            }
                        }
                        event.dialog.add(ui.create.div('.placeholder'));
                        event.switchToAuto = function () {
                            event._result = event.skillai(event.choice);
                            game.resume();
                        };
                        if (event.isMine() || event.dialogdisplay) {
                            event.dialog.style.display = '';
                            event.dialog.open();
                        }
                        game.countChoose();
                        event.choosing = true;
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event._result = event.skillai(choice);
                    }
                    'step 1'
                    if (_status.connectMode) {
                        event.result = { bool: true, skill: result.control };
                    } else {
                        if (event.dialog) {
                            event.dialog.close();
                        }
                        event.choosing = false;
                        event.result = { bool: true, skill: result };
                    }
                },
                /**
                 * 
                 * @name content.chooseSkill
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseSkill: function () {
                    'step 0'
                    var list;
                    if (typeof event.target == 'string') {
                        list = get.gainableSkillsName(event.target, event.func);
                    }
                    else {
                        list = event.target.getGainableSkills(event.func);
                    }
                    if (!list.length) {
                        event.finish();
                        event.result = { bool: false };
                        return;
                    }
                    event.skillai = function (list) {
                        return get.max(list, get.skillRank, 'item');
                    };
                    if (event.isMine()) {
                        var dialog = ui.create.dialog('forcebutton');
                        dialog.add(event.prompt || '');
                        _status.event.list = list;
                        var clickItem = function () {
                            _status.event._result = this.link;
                            game.resume();
                        };
                        for (i = 0; i &lt; list.length; i++) {
                            if (lib.translate[list[i] + '_info']) {
                                var translation = get.translation(list[i]);
                                if (translation[0] == '' &amp;&amp; translation.length == 3) {
                                    translation = translation.slice(1, 3);
                                }
                                else {
                                    translation = translation.slice(0, 2);
                                }
                                var item = dialog.add('&lt;div class="popup pointerdiv" style="width:80%;display:inline-block">&lt;div class="skill">' +
                                    translation + '&lt;/div>&lt;div>' + lib.translate[list[i] + '_info'] + '&lt;/div>&lt;/div>');
                                item.firstChild.addEventListener('click', clickItem);
                                item.firstChild.link = list[i];
                            }
                        }
                        dialog.add(ui.create.div('.placeholder'));
                        event.dialog = dialog;
                        event.switchToAuto = function () {
                            event._result = event.skillai(event.list);
                            game.resume();
                        };
                        _status.imchoosing = true;
                        game.pause();
                    }
                    else {
                        event._result = event.skillai(list);
                    }
                    'step 1'
                    _status.imchoosing = false;
                    if (event.dialog) {
                        event.dialog.close();
                    }
                    event.result = { bool: true, skill: result };
                },
                /**
                 * (|)
                 * @name content.chooseSkill
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                discoverCard: function () {
                    'step 0'
                    var num = event.num || 3;
                    var choice;
                    if (typeof event.list == 'string' || typeof event.list == 'function') {
                        choice = get.inpile(event.list).randomGets(num);
                    }
                    else if (Array.isArray(event.list)) {
                        choice = event.list.randomGets(num);
                    }
                    else {
                        choice = Array.from(event.list).randomGets(num);
                    }
                    if (choice.length) {
                        var prompt = event.prompt;
                        if (!prompt) {
                            prompt = '';
                            if (event.use) {
                                prompt += '';
                            }
                            else if (!event.nogain) {
                                prompt += '';
                            }
                        }
                        if (typeof choice[0] === 'string') {
                            var next = player.chooseVCardButton(choice, prompt, event.forced);
                            if (event.ai) {
                                next.set('ai', event.ai);
                            }
                        }
                        else if (get.itemtype(choice[0]) == 'card') {
                            var next = player.chooseCardButton(choice, prompt, event.forced);
                            if (event.ai) {
                                next.set('ai', event.ai);
                            }
                        }
                        else {
                            event.finish();
                        }
                    }
                    else {
                        event.finish();
                    }
                    'step 1'
                    event.result = {
                        bool: result.bool,
                        card: null,
                        choice: null
                    };
                    if (result.bool &amp;&amp; result.links.length) {
                        var link = result.links[0];
                        var togain = null;
                        if (get.itemtype(link) == 'card') {
                            event.result.card = link;
                            togain = link;
                        }
                        else if (Array.isArray(link)) {
                            event.result.choice = link[2];
                            togain = game.createCard(link[2]);
                        }
                        if (togain) {
                            if (event.use) {
                                player.chooseUseTarget(togain);
                            }
                            else if (!event.nogain) {
                                player.gain(togain, 'draw');
                                game.log(player, '');
                            }
                        }
                    }
                },
                /**
                 * ()
                 * @name content.chooseButton
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseButton: function () {
                    "step 0"
                    if (typeof event.dialog == 'number') {
                        event.dialog = get.idDialog(event.dialog);
                    }
                    if (event.createDialog &amp;&amp; !event.dialog) {
                        if (Array.isArray(event.createDialog)) {
                            event.createDialog.add('hidden');
                            event.dialog = ui.create.dialog.apply(this, event.createDialog);
                        }
                        event.closeDialog = true;
                    }
                    if (event.dialog == undefined) event.dialog = ui.dialog;
                    if (event.isMine() || event.dialogdisplay) {
                        event.dialog.style.display = '';
                        event.dialog.open();
                    }
                    game.check();
                    if (event.isMine()) {
                        if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                            ui.click.cancel();
                            return;
                        }
                        game.pause();
                    }
                    else if (event.isOnline()) {
                        event.send();
                        delete event.callback;
                    }
                    else {
                        event.result = 'ai';
                    }
                    if (event.onfree) {
                        lib.init.onfree();
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        if (event.processAI) {
                            event.result = event.processAI();
                        }
                        else {
                            game.check();
                            if (ai.basic.chooseButton(event.ai) || forced) ui.click.ok();
                            else ui.click.cancel();
                        }
                    }
                    if (event.closeDialog) {
                        event.dialog.close();
                    }
                    if (event.callback) {
                        event.callback(event.player, event.result);
                    }
                    event.resume();
                },
                /**
                 * 
                 * @name content.chooseCardOL
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseCardOL: function () {
                    'step 0'
                    event.targets = event.list.slice(0);
                    if (!_status.connectMode) {
                        event.result = [];
                        event.goto(7);
                    }
                    else {
                        for (var i = 0; i &lt; event.list.length; i++) {
                            var target = event.list[i];
                            target.wait();
                            if (target.isOnline()) {
                                target.send(function (args, set) {
                                    game.me.chooseCard.apply(game.me, args).set(set);
                                    game.resume();
                                }, event._args, event._set);
                                event.list.splice(i--, 1);
                            }
                            else if (target == game.me) {
                                event.withme = true;
                                event.list.splice(i--, 1);
                            }
                        }
                    }
                    'step 1'
                    if (event.list.length) {
                        event.target = event.list.shift();
                        event.target.chooseCard.apply(event.target, event._args).set(event._set);
                    }
                    else {
                        event.goto(3);
                    }
                    'step 2'
                    event.target.unwait(result);
                    event.goto(1);
                    'step 3'
                    if (event.withme) {
                        game.me.chooseCard.apply(game.me, event._args).set(event._set);
                    }
                    else {
                        event.goto(5);
                    }
                    'step 4'
                    game.me.unwait(result);
                    'step 5'
                    if (!event.resultOL) {
                        game.pause();
                    }
                    'step 6'
                    event.result = [];
                    for (var i = 0; i &lt; event.targets.length; i++) {
                        event.result[i] = event.resultOL[event.targets[i].playerid] || {};
                        if (event.result[i] == 'ai' &amp;&amp; event.aiCard) {
                            event.result[i] = event.aiCard(event.targets[i]);
                        }
                    }
                    event.finish();
                    'step 7'
                    if (event.list.length) {
                        event.target = event.list.shift();
                        event.target.chooseCard.apply(event.target, event._args).set(event._set);
                    }
                    else {
                        for (var i = 0; i &lt; event.targets.length; i++) {
                            if (!event.result[i]) {
                                event.result[i] = {};
                            }
                        }
                        event.finish();
                    }
                    'step 8'
                    event.result[event.targets.indexOf(event.target)] = result;
                    event.goto(7);
                },
                /**
                 * ()
                 * @name content.chooseButtonOL
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseButtonOL: function () {
                    'step 0'
                    ui.arena.classList.add('markhidden');
                    for (var i = 0; i &lt; event.list.length; i++) {
                        var current = event.list[i];
                        current[0].wait();
                        if (current[0].isOnline()) {
                            var target = current.shift();
                            target.send(function (args, callback, switchToAuto, processAI) {
                                ui.arena.classList.add('markhidden');
                                var next = game.me.chooseButton.apply(game.me, args);
                                next.callback = callback;
                                next.switchToAuto = switchToAuto;
                                next.processAI = processAI;
                                next.complexSelect = true;
                                game.resume();
                            }, current, event.callback, event.switchToAuto, event.processAI);
                            target._choose_button_ol = current;
                            event.list.splice(i--, 1);
                        }
                        else if (current[0] == game.me) {
                            event.last = current;
                            event.last.shift();
                            event.list.splice(i--, 1);
                        }
                    }
                    'step 1'
                    if (event.list.length) {
                        var current = event.list.shift();
                        if (current.length)
                            event.target = current.shift();
                        else {
                            event.target = current;
                            current = null;
                        }
                        var next = event.target.chooseButton.apply(event.target, current);
                        next.callback = event.callback;
                        next.switchToAuto = event.switchToAuto;
                        next.processAI = event.processAI;
                    }
                    else {
                        event.goto(3);
                    }
                    'step 2'
                    event.target.unwait(result);
                    event.goto(1);
                    'step 3'
                    if (event.last) {
                        var next = game.me.chooseButton.apply(game.me, event.last);
                        next.callback = event.callback;
                        next.switchToAuto = event.switchToAuto;
                        next.processAI = event.processAI;
                    }
                    else {
                        event.goto(5);
                    }
                    'step 4'
                    game.me.unwait(result);
                    'step 5'
                    if (!event.resultOL) {
                        game.pause();
                    }
                    'step 6'
                    game.broadcastAll(function () {
                        ui.arena.classList.remove('markhidden');
                    });
                    event.result = event.resultOL;
                },
                /**
                 * 
                 * @name content.chooseCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseCard: function () {
                    "step 0"
                    if (event.directresult) {
                        event.result = {
                            buttons: [],
                            cards: event.directresult.slice(0),
                            targets: [],
                            confirm: 'ok',
                            bool: true,
                            links: []
                        };
                    }
                    else {
                        game.check();
                        if (event.isMine()) {
                            game.pause();
                            if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                                ui.click.cancel();
                                return;
                            }
                            if (event.prompt != false) {
                                var str;
                                if (typeof event.prompt == 'string') str = event.prompt;
                                else {
                                    str = ''
                                    var range = get.select(event.selectCard);
                                    if (range[0] == range[1]) str += get.cnNumber(range[0]);
                                    else if (range[1] == Infinity) str += '' + get.cnNumber(range[0]);
                                    else str += get.cnNumber(range[0]) + '' + get.cnNumber(range[1]);
                                    str += '';
                                    if (event.position == 'h' || event.position == undefined) str += '';
                                    if (event.position == 'e') str += '';
                                    str += '';
                                }
                                event.dialog = ui.create.dialog(str);
                                if (event.prompt2) {
                                    event.dialog.addText(event.prompt2, event.prompt2.length &lt;= 20);
                                }
                                if (Array.isArray(event.promptx)) {
                                    for (var i = 0; i &lt; event.promptx.length; i++) {
                                        event.dialog.add(event.promptx[i]);
                                    }
                                }
                                if (Array.isArray(event.selectCard)) {
                                    event.promptbar = event.dialog.add('0/' + get.numStr(event.selectCard[1], 'card'));
                                    event.custom.add.card = function () {
                                        _status.event.promptbar.innerHTML =
                                            ui.selected.cards.length + '/' + get.numStr(_status.event.selectCard[1], 'card');
                                    }
                                }
                            }
                        }
                        else if (event.isOnline()) {
                            event.send();
                        }
                        else {
                            event.result = 'ai';
                        }
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseCard(event.ai) || forced) {
                            ui.click.ok();
                        }
                        else if (event.skill) {
                            var skill = event.skill;
                            ui.click.cancel();
                            event._aiexclude.add(skill);
                            event.redo();
                            game.resume();
                        }
                        else {
                            ui.click.cancel();
                        }
                    }
                    "step 2"
                    event.resume();
                    if (event.glow_result &amp;&amp; event.result.cards &amp;&amp; !event.directresult) {
                        for (var i = 0; i &lt; event.result.cards.length; i++) {
                            event.result.cards[i].classList.add('glow');
                        }
                    }
                    if (event.dialog) event.dialog.close();
                },
                /**
                 * 
                 * @name content.chooseTarget
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseTarget: function () {
                    "step 0"
                    if (event.isMine()) {
                        if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                            ui.click.cancel();
                            return;
                        }
                        game.check();
                        game.pause();
                        if (event.createDialog &amp;&amp; !event.dialog &amp;&amp; Array.isArray(event.createDialog)) {
                            event.dialog = ui.create.dialog.apply(this, event.createDialog);
                        }
                        else if (event.prompt != false) {
                            var str;
                            if (typeof event.prompt == 'string') str = event.prompt;
                            else {
                                str = ''
                                var range = get.select(event.selectTarget);
                                if (range[0] == range[1]) str += get.cnNumber(range[0]);
                                else if (range[1] == Infinity) str += '' + get.cnNumber(range[0]);
                                else str += get.cnNumber(range[0]) + '' + get.cnNumber(range[1]);
                                str += '';
                            }
                            event.dialog = ui.create.dialog(str);
                            if (event.prompt2) {
                                event.dialog.addText(event.prompt2, event.prompt2.length &lt;= 20);
                            }
                            if (event.promptbar != 'none') {
                                event.promptbar = event.dialog.add('0/' + get.numStr(get.select(event.selectTarget)[1], 'target'));
                                event.custom.add.target = function () {
                                    _status.event.promptbar.innerHTML =
                                        ui.selected.targets.length + '/' + get.numStr(get.select(event.selectTarget)[1], 'target');
                                }
                            }
                        }
                        else if (get.itemtype(event.dialog) == 'dialog') {
                            event.dialog.open();
                        }
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event.result = 'ai';
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseTarget(event.ai) || forced) {
                            ui.click.ok();
                        }
                        else {
                            ui.click.cancel();
                        }
                    }
                    if (event.result.bool &amp;&amp; event.animate !== false) {//play anim
                        for (var i = 0; i &lt; event.result.targets.length; i++) {
                            event.result.targets[i].animate('target');
                        }
                    }
                    if (event.dialog) event.dialog.close();
                    event.resume();
                    "step 2"
                    if (event.onresult) {
                        event.onresult(event.result);
                    }
                    if (event.result.bool &amp;&amp; event.autodelay &amp;&amp; !event.isMine()) {
                        if (typeof event.autodelay == 'number') {
                            game.delayx(event.autodelay);
                        }
                        else {
                            game.delayx();
                        }
                    }
                },
                /**
                 * 
                 * @name content.chooseCardTarget
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseCardTarget: function () {
                    "step 0"
                    if (event.isMine()) {
                        if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                            ui.click.cancel();
                            return;
                        }
                        game.check();
                        game.pause();
                        if (event.prompt != false) {
                            event.dialog = ui.create.dialog(event.prompt || '');
                            if (event.prompt2) {
                                event.dialog.addText(event.prompt2, event.prompt2.length &lt;= 20);
                            }
                        }
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event.result = 'ai';
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseCard(event.ai1)) {
                            if (ai.basic.chooseTarget(event.ai2)) {
                                ui.click.ok();
                                _status.event._aiexclude.length = 0;
                            }
                            else {
                                get.card(true).aiexclude();
                                game.uncheck();
                                event.redo();
                                game.resume();
                            }
                        }
                        else {
                            ui.click.cancel();
                        }
                    }
                    "step 2"
                    event.resume();
                    if (event.result.bool &amp;&amp; event.animate !== false) {
                        for (var i = 0; i &lt; event.result.targets.length; i++) {
                            event.result.targets[i].animate('target');
                        }
                    }
                    if (event.dialog) event.dialog.close();
                },
                /**
                 * ()
                 * @name content.chooseControl
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseControl: function () {
                    "step 0"
                    if (event.controls.length == 0) {
                        if (event.sortcard) {
                            var sortnum = 2;
                            if (event.sorttop) {
                                sortnum = 1;
                            }
                            for (var i = 0; i &lt; event.sortcard.length + sortnum; i++) {
                                event.controls.push(get.cnNumber(i, true));
                            }
                        }
                        else if (event.choiceList) {
                            for (var i = 0; i &lt; event.choiceList.length; i++) {
                                event.controls.push('' + get.cnNumber(i + 1, true));
                            }
                        }
                        else {
                            event.finish();
                            return;
                        }
                    }
                    else if (event.choiceList &amp;&amp; event.controls.length == 1 &amp;&amp; event.controls[0] == 'cancel2') {
                        event.controls.shift();
                        for (var i = 0; i &lt; event.choiceList.length; i++) {
                            event.controls.push('' + get.cnNumber(i + 1, true));
                        }
                        event.controls.push('cancel2');
                    }
                    if (event.isMine()) {
                        if (event.arrangeSkill) {
                            var hidden = player.hiddenSkills.slice(0);
                            game.expandSkills(hidden);
                            if (hidden.length) {
                                for (var i of event.controls) {
                                    if (_status.prehidden_skills.contains(i) &amp;&amp; hidden.contains(i)) {
                                        event.result = {
                                            bool: true,
                                            control: i,
                                        }
                                        return;
                                    }
                                }
                            }
                        }
                        else if (event.hsskill &amp;&amp; _status.prehidden_skills.contains(event.hsskill) &amp;&amp; event.controls.contains('cancel2')) {
                            event.result = {
                                bool: true,
                                control: 'cancel2',
                            }
                            return;
                        }
                        if (event.sortcard) {
                            var prompt = event.prompt || '';
                            if (event.tosort) {
                                prompt += '' + get.translation(event.tosort);
                            }
                            event.dialog = ui.create.dialog(prompt, 'hidden');
                            if (event.sortcard &amp;&amp; event.sortcard.length) {
                                event.dialog.addSmall(event.sortcard);
                            }
                            else {
                                event.dialog.buttons = [];
                                event.dialog.add(ui.create.div('.buttons'));
                            }
                            var buttons = event.dialog.content.lastChild;
                            var sortnum = 2;
                            if (event.sorttop) {
                                sortnum = 1;
                            }
                            for (var i = 0; i &lt; event.dialog.buttons.length + sortnum; i++) {
                                var item = ui.create.div('.button.card.pointerdiv.mebg');
                                item.style.width = '50px';
                                buttons.insertBefore(item, event.dialog.buttons[i]);
                                item.innerHTML = '&lt;div style="font-family: xinwei;font-size: 25px;height: 75px;line-height: 25px;top: 8px;left: 10px;width: 30px;">' + get.cnNumber(i + 1, true) + '&lt;/div>';
                                if (i == event.dialog.buttons.length + 1) {
                                    item.firstChild.innerHTML = '';
                                }
                                item.link = get.cnNumber(i, true);
                                item.listen(ui.click.dialogcontrol);
                            }

                            event.dialog.forcebutton = true;
                            event.dialog.classList.add('forcebutton');
                            event.dialog.open();
                        }
                        else if (event.dialogcontrol) {
                            event.dialog = ui.create.dialog(event.prompt || '', 'hidden');
                            for (var i = 0; i &lt; event.controls.length; i++) {
                                var item = event.dialog.add('&lt;div class="popup text pointerdiv" style="width:calc(100% - 10px);display:inline-block">' + event.controls[i] + '&lt;/div>');
                                item.firstChild.listen(ui.click.dialogcontrol);
                                item.firstChild.link = event.controls[i];
                            }
                            event.dialog.forcebutton = true;
                            event.dialog.classList.add('forcebutton');
                            if (event.addDialog) {
                                for (var i = 0; i &lt; event.addDialog.length; i++) {
                                    if (get.itemtype(event.addDialog[i]) == 'cards') {
                                        event.dialog.addSmall(event.addDialog[i]);
                                    }
                                    else {
                                        event.dialog.add(event.addDialog[i]);
                                    }
                                }
                                event.dialog.add(ui.create.div('.placeholder.slim'));
                            }
                            event.dialog.open();
                        }
                        else {
                            if (event.seperate || lib.config.seperate_control) {
                                event.controlbars = [];
                                for (var i = 0; i &lt; event.controls.length; i++) {
                                    event.controlbars.push(ui.create.control([event.controls[i]]));
                                }
                            }
                            else {
                                event.controlbar = ui.create.control(event.controls);
                            }
                            if (event.dialog) {
                                if (Array.isArray(event.dialog)) {
                                    event.dialog = ui.create.dialog.apply(this, event.dialog);
                                }
                                event.dialog.open();
                            }
                            else if (event.choiceList) {
                                event.dialog = ui.create.dialog(event.prompt || '', 'hidden');
                                event.dialog.forcebutton = true;
                                event.dialog.open();
                                for (var i = 0; i &lt; event.choiceList.length; i++) {
                                    event.dialog.add('&lt;div class="popup text" style="width:calc(100% - 10px);display:inline-block">' +
                                        get.cnNumber(i + 1, true) + '' + event.choiceList[i] + '&lt;/div>');
                                }
                            }
                            else if (event.prompt) {
                                event.dialog = ui.create.dialog(event.prompt);
                                if (event.prompt2) {
                                    event.dialog.addText(event.prompt2, event.prompt2.length &lt;= 20 || event.centerprompt2);
                                }
                            }
                        }
                        game.pause();
                        game.countChoose();
                        event.choosing = true;
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event.result = 'ai';
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        event.result = {};
                        if (event.ai) {
                            var result = event.ai(event.getParent(), player);
                            if (typeof result == 'number') event.result.control = event.controls[result];
                            else event.result.control = result;
                        }
                        else event.result.control = event.controls[event.choice];
                    }
                    event.result.index = event.controls.indexOf(event.result.control);
                    event.choosing = false;
                    _status.imchoosing = false;
                    if (event.dialog &amp;&amp; event.dialog.close) event.dialog.close();
                    if (event.controlbar) event.controlbar.close();
                    if (event.controlbars) {
                        for (var i = 0; i &lt; event.controlbars.length; i++) {
                            event.controlbars[i].close();
                        }
                    }
                    event.resume();
                },
                /**
                 * (|)
                 * @name content.chooseBool
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseBool: function () {
                    "step 0"
                    if (event.isMine()) {
                        if (event.frequentSkill &amp;&amp; !lib.config.autoskilllist.contains(event.frequentSkill)) {
                            ui.click.ok();
                            return;
                        }
                        else if (event.hsskill &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                            ui.click.cancel();
                            return;
                        }
                        ui.create.confirm('oc');
                        if (event.createDialog &amp;&amp; !event.dialog) {
                            if (Array.isArray(event.createDialog)) {
                                event.dialog = ui.create.dialog.apply(this, event.createDialog);
                                if (event.dialogselectx) {
                                    for (var i = 0; i &lt; event.dialog.buttons.length; i++) {
                                        event.dialog.buttons[i].classList.add('selectedx');
                                    }
                                }
                            }
                        }
                        if (event.dialog) {
                            event.dialog.open();
                        }
                        else if (event.prompt) {
                            event.dialog = ui.create.dialog(event.prompt);
                            if (event.prompt2) {
                                event.dialog.addText(event.prompt2, event.prompt2.length &lt;= 20);
                            }
                        }
                        game.pause();
                        game.countChoose();
                        event.choosing = true;
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event.result = 'ai';
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        if (event.ai) {
                            event.choice = event.ai(event.getParent(), player);
                        }
                        event.result = { bool: event.choice };
                    }
                    _status.imchoosing = false;
                    event.choosing = false;
                    if (event.dialog) event.dialog.close();
                    event.resume();
                },
                /**
                 * (|)
                 * @name content.chooseDrawRecover
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                chooseDrawRecover: function () {
                    'step 0'
                    if (player.isHealthy() &amp;&amp; event.forced) {
                        player.draw(event.num1);
                        event.finish();
                        return;
                    }
                    var controls = ['draw_card'];
                    if (player.isDamaged()) {
                        event.num2 = Math.min(event.num2, player.maxHp - player.hp);
                        controls.push('recover_hp');
                    }
                    if (!event.forced) {
                        controls.push('cancel2');
                    }
                    var prompt = event.prompt;
                    if (!prompt) {
                        if (player.isHealthy()) {
                            prompt = '' + get.cnNumber(event.num1) + '';
                        }
                        else {
                            prompt = '' + get.cnNumber(event.num1) + '' + get.cnNumber(event.num2) + '' + get.translation('hp');
                        }
                    }
                    var next = player.chooseControl(controls);
                    next.set('prompt', prompt);
                    if (event.hsskill) next.setHiddenSkill(event.hsskill);
                    if (event.ai) {
                        next.set('ai', event.ai);
                    }
                    else {
                        var choice;
                        if (player.isDamaged() &amp;&amp; get.recoverEffect(player) > 0 &amp;&amp; (
                            player.hp == 1 || player.needsToDiscard() ||
                            player.hasSkillTag('maixie_hp') || event.num2 > event.num1 ||
                            (event.num2 == event.num1 &amp;&amp; player.needsToDiscard(1))
                        )) {
                            choice = 'recover_hp';
                        }
                        else {
                            choice = 'draw_card';
                        }
                        next.set('ai', function () {
                            return _status.event.choice;
                        });
                        next.set('choice', choice);
                    }
                    'step 1'
                    if (result.control != 'cancel2') {
                        if (event.logSkill) {
                            if (typeof event.logSkill == 'string') {
                                player.logSkill(event.logSkill);
                            }
                            else if (Array.isArray(event.logSkill)) {
                                player.logSkill.apply(player, event.logSkill);
                            }
                        }
                        if (result.control == 'draw_card') {
                            player.draw(event.num1);
                        }
                        else {
                            player.recover(event.num2);
                        }
                    }
                    event.result = result;
                },
                /**
                 * 
                 * @name content.choosePlayerCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                choosePlayerCard: function () {
                    "step 0"
                    if (!event.dialog) event.dialog = ui.create.dialog('hidden');
                    else if (!event.isMine) {
                        event.dialog.style.display = 'none';
                    }
                    if (event.prompt) {
                        event.dialog.add(event.prompt);
                    }
                    else {
                        event.dialog.add('' + get.translation(target) + '');
                    }
                    if (event.prompt2) {
                        event.dialog.addText(event.prompt2);
                    }
                    var directh = (!lib.config.unauto_choose &amp;&amp; !event.complexSelect);
                    directh = game.showPlayerCard(event, target, directh, null);
                    if (event.dialog.buttons.length == 0) {
                        event.finish();
                        return;
                    }
                    var cs = target.getCards(event.position);
                    var select = get.select(event.selectButton);
                    if (event.forced &amp;&amp; select[0] >= cs.length) {
                        event.result = {
                            bool: true,
                            buttons: event.dialog.buttons,
                            links: cs
                        }
                    }
                    else if (event.forced &amp;&amp; directh &amp;&amp; !event.isOnline() &amp;&amp; select[0] == select[1]) {
                        event.result = {
                            bool: true,
                            buttons: event.dialog.buttons.randomGets(select[0]),
                            links: []
                        }
                        for (var i = 0; i &lt; event.result.buttons.length; i++) {
                            event.result.links[i] = event.result.buttons[i].link;
                        }
                    }
                    else {
                        if (event.isMine()) {
                            if (event.hsskill &amp;&amp; !event.forced &amp;&amp; _status.prehidden_skills.contains(event.hsskill)) {
                                ui.click.cancel();
                                return;
                            }
                            event.dialog.open();
                            game.check();
                            game.pause();
                        }
                        else if (event.isOnline()) {
                            event.send();
                        }
                        else {
                            event.result = 'ai';
                        }
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseButton(event.ai) || forced) ui.click.ok();
                        else ui.click.cancel();
                    }
                    event.dialog.close();
                    if (event.result.links) {
                        event.result.cards = event.result.links.slice(0);
                    }
                    event.resume();
                },
                /**
                 * 
                 * @name content.discardPlayerCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                discardPlayerCard: function () {
                    "step 0"
                    if (event.directresult) {
                        event.result = {
                            buttons: [],
                            cards: event.directresult.slice(0),
                            links: event.directresult.slice(0),
                            targets: [],
                            confirm: 'ok',
                            bool: true
                        };
                        event.cards = event.directresult.slice(0);
                        event.goto(2);
                        return;
                    }
                    if (!event.dialog) event.dialog = ui.create.dialog('hidden');
                    else if (!event.isMine) {
                        event.dialog.style.display = 'none';
                    }
                    if (event.prompt == undefined) {
                        var str = '' + get.translation(target);
                        var range = get.select(event.selectButton);
                        if (range[0] == range[1]) str += get.cnNumber(range[0]);
                        else if (range[1] == Infinity) str += '' + get.cnNumber(range[0]);
                        else str += get.cnNumber(range[0]) + '' + get.cnNumber(range[1]);
                        str += '';
                        if (event.position == 'h' || event.position == undefined) str += '';
                        if (event.position == 'e') str += '';
                        str += '';
                        event.prompt = str;
                    }
                    if (event.prompt) {
                        event.dialog.add(event.prompt);
                    }
                    if (event.prompt2) {
                        event.dialog.addText(event.prompt2);
                    }
                    var directh = (!lib.config.unauto_choose &amp;&amp; !event.complexSelect);
                    directh = game.showPlayerCard(event, target, directh, 'canBeDiscarded');
                    if (event.dialog.buttons.length == 0) {
                        event.finish();
                        return;
                    }
                    var cs = target.getCards(event.position);
                    var select = get.select(event.selectButton);
                    if (event.forced &amp;&amp; select[0] >= cs.length) {
                        event.result = {
                            bool: true,
                            buttons: event.dialog.buttons,
                            links: cs
                        }
                    }
                    else if (event.forced &amp;&amp; directh &amp;&amp; !event.isOnline() &amp;&amp; select[0] == select[1]) {
                        event.result = {
                            bool: true,
                            buttons: event.dialog.buttons.randomGets(select[0]),
                            links: []
                        }
                        for (var i = 0; i &lt; event.result.buttons.length; i++) {
                            event.result.links[i] = event.result.buttons[i].link;
                        }
                    }
                    else {
                        if (event.isMine()) {
                            event.dialog.open();
                            game.check();
                            game.pause();
                        }
                        else if (event.isOnline()) {
                            event.send();
                        }
                        else {
                            event.result = 'ai';
                        }
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseButton(event.ai) || forced) ui.click.ok();
                        else ui.click.cancel();
                    }
                    event.dialog.close();
                    "step 2"
                    event.resume();
                    if (event.result.bool &amp;&amp; event.result.links &amp;&amp; !game.online) {
                        if (event.logSkill) {
                            if (typeof event.logSkill == 'string') {
                                player.logSkill(event.logSkill);
                            }
                            else if (Array.isArray(event.logSkill)) {
                                player.logSkill.apply(player, event.logSkill);
                            }
                        }
                        var cards = [];
                        for (var i = 0; i &lt; event.result.links.length; i++) {
                            cards.push(event.result.links[i]);
                        }
                        event.result.cards = event.result.links.slice(0);
                        event.cards = cards;
                        event.trigger("rewriteDiscardResult");
                    }
                    "step 3"
                    if (event.boolline) {
                        player.line(target, 'green');
                    }
                    if (!event.chooseonly) {
                        var next = target.discard(event.cards);
                        if (player != target) next.notBySelf = true;
                        event.done = next;
                        if (event.delay === false) {
                            next.set('delay', false);
                        }
                    }
                },
                /**
                 * 
                 * @name content.gainPlayerCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                gainPlayerCard: function () {
                    "step 0"
                    if (event.directresult) {
                        event.result = {
                            buttons: [],
                            cards: event.directresult.slice(0),
                            links: event.directresult.slice(0),
                            targets: [],
                            confirm: 'ok',
                            bool: true
                        };
                        event.cards = event.directresult.slice(0);
                        event.goto(2);
                        return;
                    }
                    if (!event.dialog) event.dialog = ui.create.dialog('hidden');
                    else if (!event.isMine) {
                        event.dialog.style.display = 'none';
                    }
                    if (event.prompt == undefined) {
                        var str = '' + get.translation(target);
                        var range = get.select(event.selectButton);
                        if (range[0] == range[1]) str += get.cnNumber(range[0]);
                        else if (range[1] == Infinity) str += '' + get.cnNumber(range[0]);
                        else str += get.cnNumber(range[0]) + '' + get.cnNumber(range[1]);
                        str += '';
                        if (event.position == 'h' || event.position == undefined) str += '';
                        if (event.position == 'e') str += '';
                        str += '';
                        event.prompt = str;
                    }
                    if (event.prompt) {
                        event.dialog.add(event.prompt);
                    }
                    if (event.prompt2) {
                        event.dialog.addText(event.prompt2);
                    }
                    var directh = (!lib.config.unauto_choose &amp;&amp; !event.complexSelect);
                    directh = game.showPlayerCard(event, target, directh, 'canBeGained');
                    if (event.dialog.buttons.length == 0) {
                        event.dialog.close();
                        event.finish();
                        return;
                    }
                    var cs = target.getCards(event.position);
                    var select = get.select(event.selectButton);
                    if (event.forced &amp;&amp; select[0] >= cs.length) {
                        event.result = {
                            bool: true,
                            buttons: event.dialog.buttons,
                            links: cs
                        }
                    }
                    else if (event.forced &amp;&amp; directh &amp;&amp; !event.isOnline() &amp;&amp; select[0] == select[1]) {
                        event.result = {
                            bool: true,
                            buttons: event.dialog.buttons.randomGets(select[0]),
                            links: []
                        }
                        for (var i = 0; i &lt; event.result.buttons.length; i++) {
                            event.result.links[i] = event.result.buttons[i].link;
                        }
                    }
                    else {
                        if (event.isMine()) {
                            event.dialog.open();
                            game.check();
                            game.pause();
                        }
                        else if (event.isOnline()) {
                            event.send();
                        }
                        else {
                            event.result = 'ai';
                        }
                    }
                    "step 1"
                    if (event.result == 'ai') {
                        game.check();
                        if (ai.basic.chooseButton(event.ai) || forced) ui.click.ok();
                        else ui.click.cancel();
                    }
                    event.dialog.close();
                    "step 2"
                    event.resume();
                    if (game.online || !event.result.bool) {
                        event.finish();
                    }
                    "step 3"
                    if (event.logSkill &amp;&amp; event.result.bool &amp;&amp; !game.online) {
                        if (typeof event.logSkill == 'string') {
                            player.logSkill(event.logSkill);
                        }
                        else if (Array.isArray(event.logSkill)) {
                            player.logSkill.apply(player, event.logSkill);
                        }
                    }
                    var cards = [];
                    for (var i = 0; i &lt; event.result.links.length; i++) {
                        cards.push(event.result.links[i]);
                    }
                    event.result.cards = event.result.links.slice(0);
                    event.cards = cards;
                    event.trigger("rewriteGainResult");
                    "step 4"
                    if (event.boolline) {
                        player.line(target, 'green');
                    }
                    if (!event.chooseonly) {
                        if (event.delay !== false) {
                            var next = player.gain(event.cards, target, event.visibleMove ? 'give' : 'giveAuto', 'bySelf');
                            event.done = next;
                        }
                        else {
                            var next = player.gain(event.cards, target, 'bySelf');
                            event.done = next;
                            target[event.visibleMove ? '$give' : '$giveAuto'](cards, player);
                            if (event.visibleMove) next.visible = true;
                        }
                    }
                    else target[event.visibleMove ? '$give' : '$giveAuto'](cards, player);
                },
                /**
                 * 
                 * @name content.showHandcards
                 * @type {GameCores.Bases.StateMachine}
                 */
                showHandcards: function () {
                    "step 0"
                    if (player.countCards('h') == 0) {
                        event.finish();
                        return;
                    }
                    var cards = player.getCards('h');
                    var str = get.translation(player.name) + '';
                    if (typeof event.prompt == 'string') {
                        str = event.prompt;
                    }
                    event.dialog = ui.create.dialog(str, cards);
                    event.dialogid = lib.status.videoId++;
                    event.dialog.videoId = event.dialogid;
                    game.broadcast(function (str, cards, id) {
                        ui.create.dialog(str, cards).videoId = id;
                    }, str, cards, event.dialogid);
                    game.log(player, '', cards);
                    game.addVideo('showCards', player, [str, get.cardsInfo(cards)]);
                    game.delayx(2);
                    "step 1"
                    game.broadcast('closeDialog', event.dialogid);
                    event.dialog.close();
                },
                /**
                 * 
                 * @name content.showHandcards
                 * @type {GameCores.Bases.StateMachine}
                 */
                showCards: function () {
                    "step 0"
                    if (get.itemtype(cards) != 'cards') {
                        event.finish();
                        return;
                    }
                    if (!event.str) {
                        event.str = get.translation(player.name) + '';
                    }
                    event.dialog = ui.create.dialog(event.str, cards);
                    event.dialogid = lib.status.videoId++;
                    event.dialog.videoId = event.dialogid;

                    if (event.hiddencards) {
                        for (var i = 0; i &lt; event.dialog.buttons.length; i++) {
                            if (event.hiddencards.contains(event.dialog.buttons[i].link)) {
                                event.dialog.buttons[i].className = 'button card';
                                event.dialog.buttons[i].innerHTML = '';
                            }
                        }
                    }
                    game.broadcast(function (str, cards, cards2, id) {
                        var dialog = ui.create.dialog(str, cards);
                        dialog.forcebutton = true;
                        dialog.videoId = id;
                        if (cards2) {
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (cards2.contains(dialog.buttons[i].link)) {
                                    dialog.buttons[i].className = 'button card';
                                    dialog.buttons[i].innerHTML = '';
                                }
                            }
                        }
                    }, event.str, cards, event.hiddencards, event.dialogid);
                    if (event.hiddencards) {
                        var cards2 = cards.slice(0);
                        for (var i = 0; i &lt; event.hiddencards.length; i++) {
                            cards2.remove(event.hiddencards[i]);
                        }
                        game.log(player, '', cards2);
                    }
                    else {
                        game.log(player, '', cards);
                    }
                    game.delayx(2);
                    game.addVideo('showCards', player, [event.str, get.cardsInfo(cards)]);
                    "step 1"
                    game.broadcast('closeDialog', event.dialogid);
                    event.dialog.close();
                },
                /**
                 * 
                 * @name content.showHandcards
                 * @type {GameCores.Bases.StateMachine}
                 */
                viewCards: function () {
                    "step 0"
                    if (player == game.me) {
                        event.dialog = ui.create.dialog(event.str, event.cards);
                        if (event.isMine()) {
                            game.pause();
                            ui.create.confirm('o');
                            game.countChoose();
                            event.choosing = true;
                        }
                        else {
                            event.finish();
                            event.result = 'viewed';
                            setTimeout(function () {
                                event.dialog.close();
                            }, 2 * lib.config.duration);
                            game.delayx(2);
                        }
                    }
                    else if (event.isOnline()) {
                        event.send();
                    }
                    else {
                        event.finish();
                    }
                    "step 1"
                    event.result = 'viewed';
                    _status.imchoosing = false;
                    event.choosing = false;
                    if (event.dialog) event.dialog.close();
                },
                /**
                 * 
                 * @name content.moveCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                moveCard: function () {
                    'step 0'
                    if (!player.canMoveCard(null, event.nojudge, event.moveHandcard)) {
                        event.finish();
                        return;
                    }
                    var next = player.chooseTarget(2, function (card, player, target) {
                        if (_status.event.sourceFilterTarget &amp;&amp; typeof _status.event.sourceFilterTarget == 'function') {
                            if (!_status.event.sourceFilterTarget(card, player, target)) return false;
                        }
                        if (ui.selected.targets.length) {
                            var from = ui.selected.targets[0];
                            if (_status.event.moveHandcard &amp;&amp; from.countCards('h') > 0) return true;
                            var js = from.getCards('j');
                            for (var i = 0; i &lt; js.length; i++) {
                                if (_status.event.nojudge) break;
                                if (target.canAddJudge(js[i])) return true;
                            }
                            if (target.isMin()) return false;
                            var es = from.getCards('e');
                            for (var i = 0; i &lt; es.length; i++) {
                                if (target.isEmpty(get.subtype(es[i]))) return true;
                            }
                            return false;
                        }
                        else {
                            var range = 'ej';
                            if (_status.event.nojudge) range = 'e';
                            if (_status.event.moveHandcard) range = 'h' + range;
                            return target.countCards(range) > 0;
                        }
                    });
                    next.set('nojudge', event.nojudge || false);
                    next.set('moveHandcard', event.moveHandcard || false);
                    next.set('sourceFilterTarget', event.sourceFilterTarget || false);
                    next.set('ai', event.ai || function (target) {
                        var player = _status.event.player;
                        var att = get.attitude(player, target);
                        var sgnatt = get.sgn(att);
                        if (ui.selected.targets.length == 0) {
                            if (att > 0) {
                                if (!_status.event.nojudge &amp;&amp; target.countCards('j', function (card) {
                                    return game.hasPlayer(function (current) {
                                        return current != target &amp;&amp; current.canAddJudge(card) &amp;&amp; get.attitude(player, current) &lt; 0;
                                    })
                                })) return 14;
                                if (target.countCards('e', function (card) {
                                    return get.value(card, target) &lt; 0 &amp;&amp; game.hasPlayer(function (current) {
                                        return current != target &amp;&amp; get.attitude(player, current) &lt; 0 &amp;&amp; current.isEmpty(get.subtype(card)) &amp;&amp; get.effect(target, card, player, player) &lt; 0;
                                    });
                                }) > 0) return 9;
                            }
                            else if (att &lt; 0) {
                                if (game.hasPlayer(function (current) {
                                    if (current != target &amp;&amp; get.attitude(player, current) > 0) {
                                        var es = target.getCards('e');
                                        for (var i = 0; i &lt; es.length; i++) {
                                            if (get.value(es[i], target) > 0 &amp;&amp; current.isEmpty(get.subtype(es[i])) &amp;&amp; get.effect(current, es[i], player, player) > 0) return true;
                                        }
                                    }
                                })) {
                                    return -att;
                                }
                            }
                            return 0;
                        }
                        var es = ui.selected.targets[0].getCards('e');
                        var i;
                        var att2 = get.sgn(get.attitude(player, ui.selected.targets[0]));
                        for (i = 0; i &lt; es.length; i++) {
                            if (sgnatt != 0 &amp;&amp; att2 != 0 &amp;&amp; sgnatt != att2 &amp;&amp;
                                get.sgn(get.value(es[i], ui.selected.targets[0])) == -att2 &amp;&amp;
                                get.sgn(get.effect(target, es[i], player, target)) == sgnatt &amp;&amp;
                                target.isEmpty(get.subtype(es[i]))) {
                                return Math.abs(att);
                            }
                        }
                        if (i == es.length &amp;&amp; (_status.event.nojudge || !ui.selected.targets[0].countCards('j', function (card) {
                            return target.canAddJudge(card);
                        }) || att2 &lt;= 0)) {
                            return 0;
                        }
                        return -att * att2;
                    });
                    next.set('multitarget', true);
                    next.set('targetprompt', _status.event.targetprompt || ['', '']);
                    next.set('prompt', event.prompt || '');
                    if (event.prompt2) next.set('prompt2', event.prompt2);
                    if (event.forced) next.set('forced', true);
                    'step 1'
                    event.result = result;
                    if (result.bool) {
                        player.line2(result.targets, 'green');
                        event.targets = result.targets;
                    }
                    else {
                        event.finish();
                    }
                    'step 2'
                    game.delay();
                    'step 3'
                    if (targets.length == 2) {
                        player.choosePlayerCard('hej', true, function (button) {
                            var player = _status.event.player;
                            var targets0 = _status.event.targets0;
                            var targets1 = _status.event.targets1;
                            if (get.attitude(player, targets0) > 0 &amp;&amp; get.attitude(player, targets1) &lt; 0) {
                                if (get.position(button.link) == 'j') return 12;
                                if (get.value(button.link, targets0) &lt; 0 &amp;&amp; get.effect(targets1, button.link, player, targets1) > 0) return 10;
                                return 0;
                            }
                            else {
                                if (get.position(button.link) == 'j') return -10;
                                return get.value(button.link) * get.effect(targets1, button.link, player, targets1);
                            }
                        }, targets[0]).set('nojudge', event.nojudge || false).set('targets0', targets[0]).set('targets1', targets[1]).set('filterButton', function (button) {
                            var targets1 = _status.event.targets1;
                            if (get.position(button.link) == 'h') {
                                if (!_status.event.moveHandcard) return false;
                                return true;
                            }
                            if (get.position(button.link) == 'j') {
                                if (_status.event.nojudge) return false;
                                return targets1.canAddJudge(button.link);
                            }
                            else {
                                return targets1.isEmpty(get.subtype(button.link));
                            }
                        }).set('moveHandcard', event.moveHandcard || false);
                    }
                    else {
                        event.finish();
                    }
                    'step 4'
                    if (result.bool &amp;&amp; result.links.length) {
                        var link = result.links[0];
                        if (get.position(link) == 'e') {
                            event.targets[1].equip(link);
                        }
                        else if (get.position(link) == 'h') {
                            event.targets[0].give(link, event.targets[1], 'giveAuto');
                        }
                        else if (link.viewAs) {
                            event.targets[1].addJudge({ name: link.viewAs }, [link]);
                        }
                        else {
                            event.targets[1].addJudge(link);
                        }
                        if (get.position(link) != 'h') {
                            event.targets[0].$give(link, event.targets[1], false);
                            game.log(event.targets[0], '', link, '', event.targets[1]);
                        }
                        event.result.card = link;
                        event.result.position = get.position(link);
                        game.delay();
                    }
                },
                /**
                 * 
                 * @name content.useCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {?Object} event.result ()
                 */
                useCard: function () {
                    "step 0"
                    if (!card) {
                        console.log('err: no card', get.translation(event.player));
                        event.finish();
                        return;
                    }
                    if (!get.info(card, false).noForceDie) event.forceDie = true;
                    var next = player.lose(cards, 'visible', ui.ordering).set('type', 'use');
                    var directDiscard = [];
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (!next.cards.contains(cards[i])) {
                            directDiscard.push(cards[i]);
                        }
                    }
                    if (directDiscard.length) game.cardsGotoOrdering(directDiscard);
                    //player.using=cards;
                    var cardaudio = true;
                    if (event.skill) {
                        if (lib.skill[event.skill].audio) {
                            cardaudio = false;
                        }
                        if (lib.skill[event.skill].log != false) {
                            player.logSkill(event.skill);
                        }
                        if (get.info(event.skill).popname) {
                            player.tryCardAnimate(card, event.card.name, 'metal', true);
                        }
                    }
                    else if (!event.nopopup) {
                        if (lib.translate[event.card.name + '_pop']) {
                            player.tryCardAnimate(card, lib.translate[event.card.name + '_pop'], 'metal');
                        }
                        else {
                            player.tryCardAnimate(card, event.card.name, 'metal');
                        }
                    }
                    if (event.audio === false) {
                        cardaudio = false;
                    }
                    if (cardaudio) {
                        game.broadcastAll(function (player, card) {
                            if (lib.config.background_audio) {
                                if (get.type(card) == 'equip' &amp;&amp; !lib.config.equip_audio) return;
                                var sex = player.sex == 'female' ? 'female' : 'male';
                                var audioinfo = lib.card[card.name].audio;
                                // if(audioinfo||true){
                                if (card.name == 'sha' &amp;&amp; (card.nature == 'fire' || card.nature == 'thunder' || card.nature == 'ice' || card.nature == 'ocean')) {
                                    game.playAudio('card', sex, card.name + '_' + card.nature);
                                }
                                else {
                                    if (typeof audioinfo == 'string') {
                                        if (audioinfo.indexOf('ext:') == 0) game.playAudio('..', 'extension', audioinfo.slice(4), card.name + '_' + sex);
                                        else game.playAudio('card', sex, audioinfo);
                                    }
                                    else {
                                        game.playAudio('card', sex, card.name);
                                    }
                                }
                                // }
                                // else if(get.type(card)!='equip'){
                                //     game.playAudio('card/default');
                                // }
                            }
                        }, player, card);
                    }
                    if (event.animate != false &amp;&amp; event.line != false) {
                        if ((card.name == 'wuxie' || card.name == 'youdishenru') &amp;&amp; event.getParent().source) {
                            var lining = event.getParent().sourcex || event.getParent().source2 || event.getParent().source;
                            if (lining == player &amp;&amp; event.getParent().sourcex2) {
                                lining = event.getParent().sourcex2;
                            }
                            if (Array.isArray(lining) &amp;&amp; event.getTrigger().name == 'jiedao') {
                                player.line(lining[0], 'green');
                            }
                            else {
                                player.line(lining, 'green');
                            }
                        }
                        else {
                            var config = {};
                            if (card.nature == 'fire' ||
                                (card.classList &amp;&amp; card.classList.contains('fire'))) {
                                config.color = 'fire';
                            }
                            else if (card.nature == 'thunder' ||
                                (card.classList &amp;&amp; card.classList.contains('thunder'))) {
                                config.color = 'thunder';
                            }
                            else if (card.nature == 'ocean' ||
                                (card.classList &amp;&amp; card.classList.contains('ocean'))) {
                                config.color = 'ocean';
                            }
                            else if (card.nature == 'yami' ||
                                (card.classList &amp;&amp; card.classList.contains('yami'))) {
                                config.color = 'yami';
                            }
                            if (event.addedTarget) {
                                player.line2(targets.concat(event.addedTargets), config);
                            }
                            else if (get.info(card, false).multitarget &amp;&amp; targets.length > 1 &amp;&amp; !get.info(card, false).multiline) {
                                player.line2(targets, config);
                            }
                            else {
                                player.line(targets, config);
                            }
                        }
                        if (event.throw !== false) player.$throw(cards);
                        if (lib.config.sync_speed &amp;&amp; cards[0] &amp;&amp; cards[0].clone) {
                            var waitingForTransition = get.time();
                            event.waitingForTransition = waitingForTransition;
                            cards[0].clone.listenTransition(function () {
                                if (_status.waitingForTransition == waitingForTransition &amp;&amp; _status.paused) {
                                    game.resume();
                                }
                                delete event.waitingForTransition;
                            });
                        }
                    }
                    event.id = get.id();
                    event.excluded = [];
                    event.directHit = [];
                    event.customArgs = { default: {} };
                    if (typeof event.baseDamage != 'number') event.baseDamage = get.info(card, false).baseDamage || 1;
                    if (event.oncard) {
                        event.oncard(event.card, event.player);
                    }
                    player.actionHistory[player.actionHistory.length - 1].useCard.push(event);
                    if (event.addCount !== false) {
                        if (player.stat[player.stat.length - 1].card[card.name] == undefined) {
                            player.stat[player.stat.length - 1].card[card.name] = 1;
                        }
                        else {
                            player.stat[player.stat.length - 1].card[card.name]++;
                        }
                        if (event.skill) {
                            if (player.stat[player.stat.length - 1].skill[event.skill] == undefined) {
                                player.stat[player.stat.length - 1].skill[event.skill] = 1;
                            }
                            else {
                                player.stat[player.stat.length - 1].skill[event.skill]++;
                            }
                            var sourceSkill = get.info(event.skill).sourceSkill;
                            if (sourceSkill) {
                                if (player.stat[player.stat.length - 1].skill[sourceSkill] == undefined) {
                                    player.stat[player.stat.length - 1].skill[sourceSkill] = 1;
                                }
                                else {
                                    player.stat[player.stat.length - 1].skill[sourceSkill]++;
                                }
                            }
                        }
                    }
                    if (targets.length) {
                        var str = (targets.length == 1 &amp;&amp; targets[0] == player) ? '#b' : targets;
                        if (cards.length &amp;&amp; !card.isCard) {
                            if (event.addedTarget) {
                                game.log(player, '', str, '', card, '', cards, '', event.addedTargets, '');
                            }
                            else {
                                game.log(player, '', str, '', card, '', cards, '');
                            }
                        }
                        else {
                            if (event.addedTarget) {
                                game.log(player, '', str, '', card, '', event.addedTargets, '');
                            }
                            else {
                                game.log(player, '', str, '', card);
                            }
                        }
                    }
                    else {
                        if (cards.length &amp;&amp; !card.isCard) {
                            if (event.addedTarget) {
                                game.log(player, '', card, '', cards, '', event.addedTargets, '');
                            }
                            else {
                                game.log(player, '', card, '', cards, '');
                            }
                        }
                        else {
                            if (event.addedTarget) {
                                game.log(player, '', card, '', event.addedTargets, '');
                            }
                            else {
                                game.log(player, '', card);
                            }
                        }
                    }
                    if (card.name == 'wuxie') {
                        game.logv(player, [card, cards], [event.getTrigger().card]);
                    }
                    else {
                        game.logv(player, [card, cards], targets);
                    }
                    event.trigger('useCard1');
                    "step 1"
                    event.trigger('useCard2');
                    "step 2"
                    event.trigger('useCard');
                    event._oncancel = function () {
                        game.broadcastAll(function (id) {
                            if (ui.tempnowuxie &amp;&amp; ui.tempnowuxie._origin == id) {
                                ui.tempnowuxie.close();
                                delete ui.tempnowuxie;
                            }
                        }, event.id);
                    };
                    "step 3"
                    event.sortTarget = function (animate, sort) {
                        var info = get.info(card, false);
                        if (num == 0 &amp;&amp; targets.length > 1) {
                            if (!info.multitarget) {
                                if (!event.fixedSeat &amp;&amp; !sort) {
                                    targets.sortBySeat(player);
                                }
                                if (animate) for (var i = 0; i &lt; targets.length; i++) {
                                    targets[i].animate('target');
                                }
                            }
                            else if (animate) {
                                for (var i = 0; i &lt; targets.length; i++) {
                                    targets[i].animate('target');
                                }
                            }
                        }
                    }
                    event.sortTarget();
                    event.getTriggerTarget = function (list1, list2) {
                        var listx = list1.slice(0).sortBySeat();
                        for (var i = 0; i &lt; listx.length; i++) {
                            if (list2.numOf(listx[i]) &lt; listx.numOf(listx[i])) return listx[i];
                        }
                        return null;
                    }
                    var info = get.info(card, false);
                    if (!info.nodelay &amp;&amp; event.animate != false) {
                        if (event.delayx !== false) {
                            if (event.waitingForTransition) {
                                _status.waitingForTransition = event.waitingForTransition;
                                game.pause();
                            }
                            else {
                                game.delayx();
                            }
                        }
                    }
                    "step 4"
                    if (event.all_excluded) return;
                    if (!event.triggeredTargets1) event.triggeredTargets1 = [];
                    var target = event.getTriggerTarget(targets, event.triggeredTargets1);
                    if (target) {
                        event.triggeredTargets1.push(target);
                        var next = game.createEvent('useCardToPlayer', false);
                        if (event.triggeredTargets1.length == 1) next.isFirstTarget = true;
                        next.setContent('emptyEvent');
                        next.targets = targets;
                        next.target = target;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.excluded = event.excluded;
                        next.directHit = event.directHit;
                        next.customArgs = event.customArgs;
                        if (event.forceDie) next.forceDie = true;
                        event.redo();
                    }
                    "step 5"
                    if (event.all_excluded) return;
                    if (!event.triggeredTargets2) event.triggeredTargets2 = [];
                    var target = event.getTriggerTarget(targets, event.triggeredTargets2);
                    if (target) {
                        event.triggeredTargets2.push(target);
                        var next = game.createEvent('useCardToTarget', false);
                        if (event.triggeredTargets2.length == 1) next.isFirstTarget = true;
                        next.setContent('emptyEvent');
                        next.targets = targets;
                        next.target = target;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.excluded = event.excluded;
                        next.directHit = event.directHit;
                        next.customArgs = event.customArgs;
                        if (event.forceDie) next.forceDie = true;
                        event.redo();
                    }
                    "step 6"
                    if (event.all_excluded) return;
                    if (!event.triggeredTargets3) event.triggeredTargets3 = [];
                    var target = event.getTriggerTarget(targets, event.triggeredTargets3);
                    if (target) {
                        event.triggeredTargets3.push(target);
                        var next = game.createEvent('useCardToPlayered', false);
                        if (event.triggeredTargets3.length == 1) next.isFirstTarget = true;
                        next.setContent('emptyEvent');
                        next.targets = targets;
                        next.target = target;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.excluded = event.excluded;
                        next.directHit = event.directHit;
                        next.customArgs = event.customArgs;
                        if (event.forceDie) next.forceDie = true;
                        event.redo();
                    }
                    "step 7"
                    if (event.all_excluded) return;
                    if (!event.triggeredTargets4) event.triggeredTargets4 = [];
                    var target = event.getTriggerTarget(targets, event.triggeredTargets4);
                    if (target) {
                        event.triggeredTargets4.push(target);
                        var next = game.createEvent('useCardToTargeted', false);
                        if (event.triggeredTargets4.length == 1) next.isFirstTarget = true;
                        next.setContent('emptyEvent');
                        next.targets = targets;
                        next.target = target;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.excluded = event.excluded;
                        next.directHit = event.directHit;
                        next.customArgs = event.customArgs;
                        if (event.forceDie) next.forceDie = true;
                        if (targets.length == event.triggeredTargets4.length) {
                            event.sortTarget();
                        }
                        event.redo();
                    }
                    "step 8"
                    var info = get.info(card, false);
                    if (info.contentBefore) {
                        var next = game.createEvent(card.name + 'ContentBefore');
                        next.setContent(info.contentBefore);
                        next.targets = targets;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.type = 'precard';
                        if (event.forceDie) next.forceDie = true;
                    }
                    else if (info.reverseOrder &amp;&amp; get.is.versus() &amp;&amp; targets.length > 1) {
                        var next = game.createEvent(card.name + 'ContentBefore');
                        next.setContent('reverseOrder');
                        next.targets = targets;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.type = 'precard';
                        if (event.forceDie) next.forceDie = true;
                    }
                    "step 9"
                    if (event.all_excluded) return;
                    var info = get.info(card, false);
                    if (num == 0 &amp;&amp; targets.length > 1) {
                        event.sortTarget(true, true);
                    }
                    if (targets[num] &amp;&amp; targets[num].isDead()) return;
                    if (targets[num] &amp;&amp; targets[num].isOut()) return;
                    if (targets[num] &amp;&amp; targets[num].removed) return;
                    if (targets[num] &amp;&amp; info.ignoreTarget &amp;&amp; info.ignoreTarget(card, player, targets[num])) return;
                    if (targets.length == 0 &amp;&amp; !info.notarget) return;
                    if (targets[num] &amp;&amp; event.excluded.contains(targets[num])) {
                        var next = game.createEvent('useCardToExcluded', false);
                        next.setContent('emptyEvent');
                        next.targets = targets;
                        next.target = targets[num];
                        next.num = num;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        return;
                    };
                    var next = game.createEvent(card.name);
                    next.setContent(info.content);
                    next.targets = targets;
                    next.card = card;
                    next.cards = cards;
                    next.player = player;
                    next.num = num;
                    next.type = 'card';
                    next.skill = event.skill;
                    next.multitarget = info.multitarget;
                    next.preResult = event.preResult;
                    next.baseDamage = event.baseDamage;
                    if (event.forceDie) next.forceDie = true;
                    if (event.addedTargets) {
                        next.addedTargets = event.addedTargets;
                        next.addedTarget = event.addedTarget;
                        next._targets = event._targets;
                    }
                    if (info.targetDelay === false) {
                        event.targetDelay = false;
                    }
                    next.target = targets[num];
                    for (var i in event.customArgs.default) next[i] = event.customArgs.default[i];
                    if (next.target &amp;&amp; event.customArgs[next.target.playerid]) {
                        var customArgs = event.customArgs[next.target.playerid];
                        for (var i in customArgs) next[i] = customArgs[i];
                    }
                    if (next.target &amp;&amp; event.directHit.contains(next.target)) next.directHit = true;
                    if (next.target &amp;&amp; !info.multitarget) {
                        if (num == 0 &amp;&amp; targets.length > 1) {
                            // var ttt=next.target;
                            // setTimeout(function(){ttt.animate('target');},0.5*lib.config.duration);
                        }
                        else {
                            next.target.animate('target');
                        }
                    }
                    if (!info.nodelay &amp;&amp; num > 0) {
                        if (event.targetDelay !== false) {
                            game.delayx(0.5);
                        }
                    }
                    "step 10"
                    if (event.all_excluded) return;
                    if (!get.info(event.card, false).multitarget &amp;&amp; num &lt; targets.length - 1 &amp;&amp; !event.cancelled) {
                        event.num++;
                        event.goto(9);
                    }
                    "step 11"
                    if (get.info(card, false).contentAfter) {
                        var next = game.createEvent(card.name + 'ContentAfter');
                        next.setContent(get.info(card, false).contentAfter);
                        next.targets = targets;
                        next.card = card;
                        next.cards = cards;
                        next.player = player;
                        next.preResult = event.preResult;
                        next.type = 'postcard';
                        if (event.forceDie) next.forceDie = true;
                    }
                    "step 12"
                    if (event.postAi) {
                        event.player.logAi(event.targets, event.card);
                    }
                    if (event._result) {
                        event.result = event._result;
                    }
                    //delete player.using;
                    if (document.getElementsByClassName('thrown').length) {
                        if (event.delayx !== false) game.delayx();
                    }
                    else {
                        event.finish();
                    }
                    "step 13"
                    event._oncancel();
                },
                /**
                 * 
                 * @name content.useSkill
                 * @type {GameCores.Bases.StateMachine}
                 */
                useSkill: function () {
                    "step 0"
                    var info = get.info(event.skill);
                    if (!info.noForceDie) event.forceDie = true;
                    event._skill = event.skill;
                    game.trySkillAudio(event.skill, player);
                    var checkShow = player.checkShow(event.skill);
                    if (info.discard != false &amp;&amp; info.lose != false &amp;&amp; !info.viewAs) {
                        player.discard(cards).delay = false;
                        if (lib.config.low_performance) {
                            event.discardTransition = true;
                        }
                    }
                    else {
                        if (info.lose != false) {
                            if (info.losetrigger == false) {
                                var losecard = player.lose(cards, ui.special)._triggered = null;
                            }
                            else {
                                var losecard = player.lose(cards, ui.special);
                                if (info.visible) losecard.visible = true;
                                if (info.loseTo) losecard.position = ui[info.loseTo];
                                if (info.insert) losecard.insert_card = true;
                                if (losecard.position == ui.special &amp;&amp; info.toStorage) losecard.toStorage = true;
                            }
                        }
                        if (!info.prepare &amp;&amp; info.viewAs) {
                            player.$throw(cards);
                            if (losecard) losecard.visible = true;
                            if (lib.config.sync_speed &amp;&amp; cards[0] &amp;&amp; cards[0].clone) {
                                var waitingForTransition = get.time();
                                event.waitingForTransition = waitingForTransition;
                                cards[0].clone.listenTransition(function () {
                                    if (_status.waitingForTransition == waitingForTransition &amp;&amp; _status.paused) {
                                        game.resume();
                                    }
                                    delete event.waitingForTransition;
                                });
                            }
                        }
                    }
                    if (info.line != false &amp;&amp; targets.length) {
                        var config = {};
                        if (get.is.object(info.line)) config = info.line;
                        else if (info.line == 'fire') {
                            config.color = 'fire';
                        }
                        else if (info.line == 'thunder') {
                            config.color = 'thunder';
                        }
                        else if (info.line == 'ocean') {
                            config.color = 'ocean';
                        }
                        else if (info.line === undefined || info.line == 'green') {
                            config.color = 'green';
                        }
                        if (info.multitarget &amp;&amp; !info.multiline &amp;&amp; targets.length > 1) {
                            player.line2(targets, config);
                        }
                        else {
                            player.line(targets, config);
                        }
                    }
                    var str = '';
                    if (targets &amp;&amp; targets.length &amp;&amp; info.log != 'notarget') {
                        str += '&lt;span class="bluetext">' + (targets[0] == player ? '' : get.translation(targets[0]));
                        for (var i = 1; i &lt; targets.length; i++) {
                            str += '' + (targets[i] == player ? '' : get.translation(targets[i]));
                        }
                        str += '&lt;/span>'
                    }
                    str += '';
                    if (!info.direct) {
                        game.log(player, str, '#p' + get.skillTranslation(skill, player) + '');
                        if (info.logv !== false) game.logv(player, skill, targets);
                        player.trySkillAnimate(skill, skill, checkShow);
                    }
                    if (event.addCount != false) {
                        if (player.stat[player.stat.length - 1].skill[skill] == undefined) {
                            player.stat[player.stat.length - 1].skill[skill] = 1;
                        }
                        else {
                            player.stat[player.stat.length - 1].skill[skill]++;
                        }
                        var sourceSkill = get.info(skill).sourceSkill;
                        if (sourceSkill) {
                            if (player.stat[player.stat.length - 1].skill[sourceSkill] == undefined) {
                                player.stat[player.stat.length - 1].skill[sourceSkill] = 1;
                            }
                            else {
                                player.stat[player.stat.length - 1].skill[sourceSkill]++;
                            }
                        }
                    }
                    if (player.stat[player.stat.length - 1].allSkills == undefined) {
                        player.stat[player.stat.length - 1].allSkills = 1;
                    }
                    else {
                        player.stat[player.stat.length - 1].allSkills++;
                    }
                    if (info.prepare) {
                        switch (info.prepare) {
                            case 'give': if (losecard) losecard.visible = true; player.$give(cards, targets[0]); break;
                            case 'give2': player.$give(cards.length, targets[0]); break;
                            case 'throw': if (losecard) losecard.visible = true; player.$throw(cards); break;
                            case 'throw2': player.$throw(cards.length); break;
                            default: info.prepare(cards, player, targets);
                        }
                    }
                    if (info.round) {
                        var roundname = skill + '_roundcount';
                        player.storage[roundname] = game.roundNumber;
                        player.syncStorage(roundname);
                        player.markSkill(roundname);
                    }
                    "step 1"
                    var info = get.info(event.skill);
                    if (info &amp;&amp; info.contentBefore) {
                        var next = game.createEvent(event.skill + 'ContentBefore');
                        next.setContent(info.contentBefore);
                        next.targets = targets;
                        next.cards = cards;
                        next.player = player;
                        if (event.forceDie) next.forceDie = true;
                    }
                    "step 2"
                    if (!event.skill) {
                        console.log('error: no skill', get.translation(event.player), event.player.getSkills());
                        if (event._skill) {
                            event.skill = event._skill;
                            console.log(event._skill);
                        }
                        else {
                            event.finish();
                            return;
                        }
                    }
                    var info = get.info(event.skill);
                    if (targets[num] &amp;&amp; targets[num].isDead() ||
                        targets[num] &amp;&amp; targets[num].isOut() ||
                        targets[num] &amp;&amp; targets[num].removed) {
                        if (!info.multitarget &amp;&amp; num &lt; targets.length - 1) {
                            event.num++;
                            event.redo();
                        }
                        return;
                    }
                    var next = game.createEvent(event.skill);
                    next.setContent(info.content);
                    next.targets = targets;
                    next.cards = cards;
                    next.player = player;
                    next.num = num;
                    next.multitarget = info.multitarget;
                    if (num == 0 &amp;&amp; next.targets.length > 1) {
                        if (!info.multitarget) {
                            lib.tempSortSeat = player;
                            targets.sort(lib.sort.seat);
                            delete lib.tempSortSeat;
                        }
                        for (var i = 0; i &lt; targets.length; i++) {
                            targets[i].animate('target');
                        }
                    }
                    next.target = targets[num];
                    if (event.forceDie) next.forceDie = true;
                    if (next.target &amp;&amp; !info.multitarget) {
                        if (num == 0 &amp;&amp; targets.length > 1) {
                            // var ttt=next.target;
                            // setTimeout(function(){ttt.animate('target');},0.5*lib.config.duration);
                        }
                        else {
                            next.target.animate('target');
                        }
                    }
                    if (num == 0) {
                        if (typeof info.delay == 'number') game.delay(info.delay);
                        else if (info.delay !== false &amp;&amp; info.delay !== 0) {
                            if (event.waitingForTransition) {
                                _status.waitingForTransition = event.waitingForTransition;
                                game.pause();
                            }
                            else {
                                game.delayx()
                            }
                        }
                    }
                    else game.delayx(0.5);
                    if (!info.multitarget &amp;&amp; num &lt; targets.length - 1) {
                        event.num++;
                        event.redo();
                    }
                    "step 3"
                    var info = get.info(event.skill);
                    if (info &amp;&amp; info.contentAfter) {
                        var next = game.createEvent(event.skill + 'ContentAfter');
                        next.setContent(info.contentAfter);
                        next.targets = targets;
                        next.cards = cards;
                        next.player = player;
                        if (event.forceDie) next.forceDie = true;
                    }
                    "step 4"
                    if (player.getStat().allSkills > 200) {
                        player._noSkill = true;
                        console.log(player.name, event.skill);
                    }
                    if (document.getElementsByClassName('thrown').length) {
                        if (event.skill &amp;&amp; get.info(event.skill).delay !== false &amp;&amp; get.info(event.skill).delay !== 0) game.delayx();
                    }
                    else {
                        event.finish();
                    }
                    "step 5"
                    ui.clear();
                },
                /**
                 * (||)
                 * @name content.useCard
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Array&lt;GameCores.GameObjects.Card>} event.result 
                 */
                draw: function () {
                    // if(lib.config.background_audio){
                    //     game.playAudio('effect','draw');
                    // }
                    // game.broadcast(function(){
                    //     if(lib.config.background_audio){
                    //         game.playAudio('effect','draw');
                    //     }
                    // });
                    if (typeof event.minnum == 'number' &amp;&amp; num &lt; event.minnum) {
                        num = event.minnum;
                    }
                    if (event.drawDeck) {
                        if (event.drawDeck > num) {
                            event.drawDeck = num;
                        }
                        num -= event.drawDeck;
                    }
                    if (event.log != false) {
                        if (num > 0) {
                            if (event.bottom) game.log(player, '' + get.cnNumber(num) + '');
                            else game.log(player, '' + get.cnNumber(num) + '');
                        }
                        if (event.drawDeck) {
                            game.log(player, '' + get.cnNumber(event.drawDeck) + '');
                        }
                    }
                    var cards;
                    if (num > 0) {
                        if (event.bottom) cards = get.bottomCards(num);
                        else if (player.getTopCards) cards = player.getTopCards(num);
                        else cards = get.cards(num);
                    }
                    else {
                        cards = [];
                    }
                    if (event.drawDeck) {
                        cards = cards.concat(player.getDeckCards(event.drawDeck));
                    }
                    if (event.animate != false) {
                        if (event.visible) {
                            var next = player.gain(cards, 'gain2');
                            if (event.bottom) game.log(player, '' + get.cnNumber(num) + '', cards, '');
                            else game.log(player, '' + get.cnNumber(num) + '', cards, '');
                        }
                        else {
                            var next = player.gain(cards, 'draw');
                        }
                    }
                    else {
                        var next = player.gain(cards);
                        if (event.$draw) {
                            player.$draw(cards.length);
                        }
                    }
                    if (event.gaintag) next.gaintag.addArray(event.gaintag);
                    event.result = cards;
                },
                /**
                 * (|||)
                 * @name content.discard
                 * @type {GameCores.Bases.StateMachine}
                 */
                discard: function () {
                    "step 0"
                    game.log(player, '', cards);
                    event.done = player.lose(cards, event.position, 'visible').type = 'discard';
                    "step 1"
                    event.trigger('discard');
                },
                /**
                 * 
                 * @name content.respond
                 * @type {GameCores.Bases.StateMachine}
                 */
                respond: function () {
                    'step 0'
                    var cardaudio = true;
                    if (event.skill) {
                        if (lib.skill[event.skill].audio) {
                            cardaudio = false;
                        }
                        player.logSkill(event.skill);
                        player.checkShow(event.skill, true);
                        if (lib.skill[event.skill].onrespond &amp;&amp; !game.online) {
                            lib.skill[event.skill].onrespond(event, player);
                        }
                    }
                    else if (!event.nopopup) player.tryCardAnimate(card, card.name, 'wood');
                    if (cardaudio &amp;&amp; event.getParent(3).name == 'useCard') {
                        game.broadcastAll(function (player, card) {
                            if (lib.config.background_audio) {
                                var sex = player.sex == 'female' ? 'female' : 'male';
                                var audioinfo = lib.card[card.name].audio;
                                // if(audioinfo||true){
                                if (typeof audioinfo == 'string' &amp;&amp; audioinfo.indexOf('ext:') == 0) {
                                    game.playAudio('..', 'extension', audioinfo.slice(4), card.name + '_' + sex);
                                }
                                else {
                                    game.playAudio('card', sex, card.name);
                                }
                                // }
                                // else{
                                //     game.playAudio('card/default');
                                // }
                            }
                        }, player, card);
                    }
                    if (cards.length &amp;&amp; (cards.length > 1 || cards[0].name != card.name)) {
                        game.log(player, '', card, '', cards, '');
                    }
                    else {
                        game.log(player, '', card);
                    }
                    player.actionHistory[player.actionHistory.length - 1].respond.push(event);
                    var cards2 = cards.slice(0);
                    if (cards2.length) {
                        var next = player.lose(cards2, ui.ordering, 'visible');
                        if (event.noOrdering) next.noOrdering = true;
                        cards2.removeArray(next.cards);
                        if (cards2.length) {
                            var next2 = game.cardsGotoOrdering(cards2);
                            if (event.noOrdering) next2.noOrdering = true;
                        }
                    }
                    if (event.animate != false &amp;&amp; event.throw !== false) {
                        for (var i = 0; i &lt; cards.length; i++) {
                            player.$throw(cards[i]);
                            if (event.highlight) {
                                cards[i].clone.classList.add('thrownhighlight');
                                game.addVideo('highlightnode', player, get.cardInfo(cards[i]));
                            }
                        }
                        if (event.highlight) {
                            game.broadcast(function (cards) {
                                for (var i = 0; i &lt; cards.length; i++) {
                                    if (cards[i].clone) {
                                        cards[i].clone.classList.add('thrownhighlight');
                                    }
                                }
                            }, cards);
                        }
                    }
                    event.trigger('respond');
                    'step 1'
                    game.delayx(0.5);
                },
                /**
                 * ()
                 * @name content.swapHandcards
                 * @type {GameCores.Bases.StateMachine}
                 */
                swapHandcards: function () {
                    'step 0'
                    event.cards1 = event.cards1 || player.getCards('h');
                    event.cards2 = event.cards2 || target.getCards('h');
                    game.loseAsync({
                        player: player,
                        target: target,
                        cards1: event.cards1,
                        cards2: event.cards2,
                    }).setContent('swapHandcardsx');
                    'step 1'
                    player.gain(event.cards2);
                    target.gain(event.cards1);
                },
                swapHandcardsx: function () {
                    'step 0'
                    player.$giveAuto(event.cards1, target);
                    target.$giveAuto(event.cards2, player);
                    'step 1'
                    event.cards = event.cards1;
                    var next = player.lose(event.cards, ui.ordering).getlx = false;
                    next.relatedEvent = event.getParent();
                    if (player == game.me) {
                        event.delayed = true;
                    }
                    else {
                        next.delay = false;
                    }
                    'step 2'
                    event.cards = event.cards2;
                    var next = target.lose(event.cards, ui.ordering).getlx = false;
                    next.relatedEvent = event.getParent();
                    if (target == game.me) {
                        event.delayed = true;
                    }
                    else {
                        next.delay = false;
                    }
                    'step 3'
                    if (!event.delayed) game.delay();
                },
                /**
                 * 
                 * @name content.gainMultiple
                 * @type {GameCores.Bases.StateMachine}
                 */
                gainMultiple: function () {
                    'step 0'
                    event.delayed = false;
                    event.num = 0;
                    event.cards = [];
                    'step 1'
                    player.gainPlayerCard(targets[num], event.position, true).set('boolline', false).set('delay', num == targets.length - 1);
                    'step 2'
                    if (result.bool) {
                        event.cards.addArray(result.cards);
                        if (num == targets.length - 1) event.delayed = true;
                    }
                    event.num++;
                    if (event.num &lt; targets.length) {
                        event.goto(1);
                    }
                    'step 3'
                    if (!event.delayed) game.delay();
                },
                /**
                 * 
                 * @name content.lose
                 * @type {GameCores.Bases.StateMachine}
                 */
                gain: function () {
                    "step 0"
                    if (cards) {
                        var map = {};
                        for (var i of cards) {
                            var owner = get.owner(i, 'judge');
                            if (owner &amp;&amp; (owner != player || get.position(i) != 'h')) {
                                var id = owner.playerid;
                                if (!map[id]) map[id] = [];
                                map[id].push(i);
                            }
                        }
                        for (var i in map) {
                            var owner = (_status.connectMode ? lib.playerOL : game.playerMap)[i];
                            var next = owner.lose(map[i], ui.special).set('type', 'gain').set('forceDie', true).set('getlx', false);
                            if (event.animate == 'give' || event.visible == true) next.visible = true;
                            event.relatedLose = next;
                        }
                    }
                    else {
                        event.finish();
                    }
                    "step 1"
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (cards[i].destroyed) {
                            if (player.hasSkill(cards[i].destroyed)) {
                                delete cards[i].destroyed;
                            }
                            else {
                                cards.splice(i--, 1);
                            }
                        }
                    }
                    if (cards.length == 0) {
                        event.finish();
                        return;
                    }
                    player.getHistory('gain').push(event);
                    //if(event.source&amp;&amp;event.delay!==false) game.delayx();
                    "step 2"
                    if (player.getStat().gain == undefined) {
                        player.getStat().gain = cards.length;
                    }
                    else {
                        player.getStat().gain += cards.length;
                    }
                    "step 3"
                    var sort;
                    var frag1 = document.createDocumentFragment();
                    var frag2 = document.createDocumentFragment();
                    var hs = player.getCards('hs');
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (hs.contains(cards[i])) {
                            cards.splice(i--, 1);
                        }
                    }
                    for (var num = 0; num &lt; cards.length; num++) {
                        sort = lib.config.sort_card(cards[num]);
                        if (lib.config.reverse_sort) sort = -sort;
                        cards[num].fix();
                        cards[num].style.transform = '';
                        cards[num].addGaintag(event.gaintag);
                        if (_status.discarded) {
                            _status.discarded.remove(cards[num]);
                        }
                        // cards[num].vanishtag.length=0;
                        for (var num2 = 0; num2 &lt; cards[num].vanishtag.length; num2++) {
                            if (cards[num].vanishtag[num2][0] != '_') {
                                cards[num].vanishtag.splice(num2--, 1);
                            }
                        }
                        if (player == game.me) {
                            cards[num].classList.add('drawinghidden');
                        }
                        if (get.is.singleHandcard() || sort > 1) frag1.appendChild(cards[num]);
                        else frag2.appendChild(cards[num]);
                    }
                    var addv = function () {
                        if (player == game.me) {
                            game.addVideo('gain12', player, [get.cardsInfo(frag1.childNodes), get.cardsInfo(frag2.childNodes), event.gaintag]);
                        }
                    };
                    var broadcast = function () {
                        game.broadcast(function (player, cards, num, gaintag) {
                            player.directgain(cards, null, gaintag);
                            _status.cardPileNum = num;
                        }, player, cards, ui.cardPile.childNodes.length, event.gaintag);
                    };
                    if (event.animate == 'draw') {
                        player.$draw(cards.length);
                        game.pause();
                        setTimeout(function () {
                            addv();
                            player.node.handcards1.insertBefore(frag1, player.node.handcards1.firstChild);
                            player.node.handcards2.insertBefore(frag2, player.node.handcards2.firstChild);
                            player.update();
                            if (player == game.me) ui.updatehl();
                            broadcast();
                            game.resume();
                        }, get.delayx(500, 500));
                    }
                    else if (event.animate == 'gain') {
                        player.$gain(cards);
                        game.pause();
                        setTimeout(function () {
                            addv();
                            player.node.handcards1.insertBefore(frag1, player.node.handcards1.firstChild);
                            player.node.handcards2.insertBefore(frag2, player.node.handcards2.firstChild);
                            player.update();
                            if (player == game.me) ui.updatehl();
                            broadcast();
                            game.resume();
                        }, get.delayx(700, 700));
                    }
                    else if (event.animate == 'gain2' || event.animate == 'draw2') {
                        var gain2t = 300;
                        if (player.$gain2(cards) &amp;&amp; player == game.me) {
                            gain2t = 500;
                        }
                        game.pause();
                        setTimeout(function () {
                            addv();
                            player.node.handcards1.insertBefore(frag1, player.node.handcards1.firstChild);
                            player.node.handcards2.insertBefore(frag2, player.node.handcards2.firstChild);
                            player.update();
                            if (player == game.me) ui.updatehl();
                            broadcast();
                            game.resume();
                        }, get.delayx(gain2t, gain2t));
                    }
                    else if (event.source &amp;&amp; (event.animate == 'give' || event.animate == 'giveAuto')) {
                        if (event.animate == 'give') event.source['$' + event.animate](cards, player);
                        else {
                            var givemap = { hs: [], ots: [] };
                            for (var i = 0; i &lt; cards.length; i++) {
                                givemap[event.relatedLose &amp;&amp; event.relatedLose.hs &amp;&amp; event.relatedLose.hs.contains(cards[i]) ? 'hs' : 'ots'].push(cards[i]);
                            }
                            if (givemap.hs.length) event.source.$giveAuto(givemap.hs, player);
                            if (givemap.ots.length) event.source.$give(givemap.ots, player);
                        }
                        game.pause();
                        setTimeout(function () {
                            addv();
                            player.node.handcards1.insertBefore(frag1, player.node.handcards1.firstChild);
                            player.node.handcards2.insertBefore(frag2, player.node.handcards2.firstChild);
                            player.update();
                            if (player == game.me) ui.updatehl();
                            broadcast();
                            game.resume();
                        }, get.delayx(500, 500));
                    }
                    else {
                        addv();
                        player.node.handcards1.insertBefore(frag1, player.node.handcards1.firstChild);
                        player.node.handcards2.insertBefore(frag2, player.node.handcards2.firstChild);
                        player.update();
                        if (player == game.me) ui.updatehl();
                        broadcast();
                        event.finish();
                    }
                    if (event.log) {
                        game.log(player, '', cards);
                    }
                    "step 4"
                    game.delayx();
                },
                /**
                 * (|)(special arena)
                 * @name content.lose
                 * @type {GameCores.Bases.StateMachine}
                 */
                lose: function () {
                    "step 0"
                    var evt = event.getParent();
                    if (evt.name != 'discard' &amp;&amp; event.type != 'discard') {
                        event.delay = false;
                        return;
                    }
                    if (evt.delay === false) event.delay = false;
                    if (evt.animate != false) {
                        evt.discardid = lib.status.videoId++;
                        game.broadcastAll(function (player, cards, id) {
                            player.$throw(cards, null, 'nobroadcast');
                            var cardnodes = [];
                            cardnodes._discardtime = get.time();
                            for (var i = 0; i &lt; cards.length; i++) {
                                if (cards[i].clone) {
                                    cardnodes.push(cards[i].clone);
                                }
                            }
                            ui.todiscard[id] = cardnodes;
                        }, player, cards, evt.discardid);
                        if (lib.config.sync_speed &amp;&amp; cards[0] &amp;&amp; cards[0].clone) {
                            if (evt.delay != false) {
                                var waitingForTransition = get.time();
                                evt.waitingForTransition = waitingForTransition;
                                cards[0].clone.listenTransition(function () {
                                    if (_status.waitingForTransition == waitingForTransition &amp;&amp; _status.paused) {
                                        game.resume();
                                    }
                                    delete evt.waitingForTransition;
                                });
                            }
                            else if (evt.getParent().discardTransition) {
                                delete evt.getParent().discardTransition;
                                var waitingForTransition = get.time();
                                evt.getParent().waitingForTransition = waitingForTransition;
                                cards[0].clone.listenTransition(function () {
                                    if (_status.waitingForTransition == waitingForTransition &amp;&amp; _status.paused) {
                                        game.resume();
                                    }
                                    delete evt.getParent().waitingForTransition;
                                });
                            }
                        }
                    }
                    "step 1"
                    event.gaintag_map = {};
                    var hs = [], es = [], js = [], ss = [];
                    if (event.insert_card &amp;&amp; event.position == ui.cardPile) event.cards.reverse();
                    var hej = player.getCards('hejs');
                    event.stockcards = cards.slice(0);
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (cards[i].gaintag &amp;&amp; cards[i].gaintag.length) {
                            event.gaintag_map[cards[i].cardid] = cards[i].gaintag.slice(0);
                            if (cards[i].hasGaintag('ming_')) event.gaintag_map[cards[i].cardid].push('ming_');
                            if (cards[i].hasGaintag('an_')) event.gaintag_map[cards[i].cardid].push('an_');
                            cards[i].removeGaintag(true);
                        }
                        if (!hej.contains(cards[i])) {
                            cards.splice(i--, 1);
                        }
                        else if (cards[i].parentNode) {
                            if (cards[i].parentNode.classList.contains('equips')) {
                                cards[i].original = 'e';
                                es.push(cards[i]);
                            }
                            else if (cards[i].parentNode.classList.contains('judges')) {
                                cards[i].original = 'j';
                                js.push(cards[i]);
                            }
                            else if (cards[i].parentNode.classList.contains('handcards')) {
                                if (cards[i].classList.contains('glows')) {
                                    cards[i].original = 's';
                                    ss.push(cards[i]);
                                }
                                else {
                                    cards[i].original = 'h';
                                    hs.push(cards[i]);
                                }
                            }
                            else {
                                cards[i].original = null;
                            }
                        }

                        cards[i].style.transform += ' scale(0.2)';
                        cards[i].classList.remove('glow');
                        cards[i].classList.remove('glows');
                        cards[i].recheck();

                        var info = lib.card[cards[i].name];
                        if (info.destroy || cards[i]._destroy) {
                            cards[i].delete();
                            cards[i].destroyed = info.destroy || cards[i]._destroy;
                        }
                        else if (event.position) {
                            if (_status.discarded) {
                                if (event.position == ui.discardPile) {
                                    _status.discarded.add(cards[i]);
                                }
                                else {
                                    _status.discarded.remove(cards[i]);
                                }
                            }
                            if (event.insert_index) {
                                event.position.insertBefore(cards[i], event.insert_index(event, cards[i]));
                                cards[i].fix();
                            }
                            else if (event.insert_card) {
                                event.position.insertBefore(cards[i], event.position.firstChild);
                                cards[i].fix();
                            }
                            else if (event.position == ui.cardPile) {
                                event.position.appendChild(cards[i]);
                                cards[i].fix();
                            }
                            else cards[i].goto(event.position);
                        }
                        else {
                            cards[i].remove();
                        }
                        //if(ss.contains(cards[i])) cards.splice(i--,1);
                    }
                    if (player == game.me) ui.updatehl();
                    ui.updatej(player);
                    game.broadcast(function (player, cards, num) {
                        for (var i = 0; i &lt; cards.length; i++) {
                            cards[i].classList.remove('glow');
                            cards[i].classList.remove('glows');
                            cards[i].fix();
                            cards[i].remove();
                        }
                        if (player == game.me) {
                            ui.updatehl();
                        }
                        ui.updatej(player);
                        _status.cardPileNum = num;
                    }, player, cards, ui.cardPile.childNodes.length);
                    game.addVideo('lose', player, [get.cardsInfo(hs), get.cardsInfo(es), get.cardsInfo(js), get.cardsInfo(ss)]);
                    event.cards2 = hs.concat(es);
                    player.getHistory('lose').push(event);
                    game.getGlobalHistory().cardMove.push(event);
                    player.update();
                    game.addVideo('loseAfter', player);
                    event.num = 0;
                    if (event.position == ui.ordering) {
                        var evt = event.relatedEvent || event.getParent();
                        if (!evt.orderingCards) evt.orderingCards = [];
                        if (!event.noOrdering &amp;&amp; !event.cardsOrdered) {
                            event.cardsOrdered = true;
                            var next = game.createEvent('orderingDiscard', false, evt.getParent());
                            next.relatedEvent = evt;
                            next.setContent('orderingDiscard');
                        }
                        if (!event.noOrdering) {
                            evt.orderingCards.addArray(cards);
                            evt.orderingCards.addArray(ss);
                        }
                    }
                    else if (event.position == ui.cardPile) {
                        game.updateRoundNumber();
                    }
                    event.hs = hs;
                    event.es = es;
                    event.js = js;
                    event.ss = ss;
                    "step 2"
                    if (num &lt; cards.length) {
                        let evt = event.getParent();
                        if (event.es.contains(cards[num])) {
                            event.moveEquip = false;
                            if ((evt.name == 'equip' &amp;&amp; evt.cards.contains(cards[num]))
                                || (event.getParent() &amp;&amp; event.getParent().name != 'swapEquip')) event.moveEquip = true;
                            event.loseEquip = true;
                            player.removeEquipTrigger(cards[num], event.moveEquip);
                            var info = get.info(cards[num]);
                            if (info.onLose &amp;&amp; (!info.filterLose || info.filterLose(cards[num], player))) {
                                event.goto(3);
                                return;
                            }
                        }
                        event.num++;
                        event.redo();
                    }
                    else {
                        if (event.loseEquip) {
                            player.addEquipTrigger();
                        }
                        event.goto(4);
                    }
                    "step 3"
                    var info = get.info(cards[num]);
                    if (info.loseDelay != false &amp;&amp; (player.isAlive() || info.forceDie)) {
                        player.popup(cards[num].name);
                        game.delayx();
                    }
                    if (Array.isArray(info.onLose)) {
                        for (var i = 0; i &lt; info.onLose.length; i++) {
                            var next = game.createEvent('lose_' + cards[num].name);
                            next.setContent(info.onLose[i]);
                            if (info.forceDie) next.forceDie = true;
                            next.player = player;
                            next.card = cards[num];
                        }
                    }
                    else {
                        var next = game.createEvent('lose_' + cards[num].name);
                        next.setContent(info.onLose);
                        next.player = player;
                        if (info.forceDie) next.forceDie = true;
                        next.card = cards[num];
                    }
                    event.num++;
                    event.goto(2);
                    "step 4"
                    var evt = event.getParent();
                    if (evt.name != 'discard' &amp;&amp; event.type != 'discard') return;
                    if (evt.delay != false) {
                        if (evt.waitingForTransition) {
                            _status.waitingForTransition = evt.waitingForTransition;
                            game.pause();
                        }
                        else {
                            game.delayx();
                        }
                    }
                },
                /**
                 * 
                 * @name content.damage
                 * @type {GameCores.Bases.StateMachine}
                 */
                damage: function () {
                    "step 0"
                    event.forceDie = true;
                    event.trigger('damageBegin1');
                    "step 1"
                    event.trigger('damageBegin2');
                    "step 2"
                    event.trigger('damageBegin3');
                    "step 3"
                    event.trigger('damageBegin4');
                    "step 4"
                    if (num > 0 &amp;&amp; player.hujia &amp;&amp; !player.hasSkillTag('nohujia') &amp;&amp; !(source &amp;&amp; source.hasSkillTag('overHujia', true, {
                        name: event.card ? event.card.name : null,
                        target: player,
                        card: event.card
                    }))) {
                        if (num >= player.hujia) {
                            event.hujia = player.hujia;
                            num -= player.hujia;
                        }
                        else {
                            event.hujia = num;
                            num = 0;
                        }
                        player.changeHujia(-event.hujia).type = 'damage';
                    }
                    event.num = num;
                    if (num &lt;= 0) {
                        event.trigger('damageZero');
                        delete event.filterStop;
                        event.finish();
                        event._triggered = null;
                    }
                    if (num > 0) {
                        event.trigger('damageHit');
                    }
                    "step 5"
                    if (lib.config.background_audio) {
                        game.playAudio('effect', 'damage' + (num > 1 ? '2' : ''));
                    }
                    game.broadcast(function (num) {
                        if (lib.config.background_audio) {
                            game.playAudio('effect', 'damage' + (num > 1 ? '2' : ''));
                        }
                    }, num);
                    var str = '';
                    if (source) str += '&lt;span class="bluetext">' + (source == player ? '' : get.translation(source)) + '&lt;/span>';
                    str += get.cnNumber(num) + '';
                    if (event.nature) str += get.translation(event.nature) + '';
                    str += '';
                    game.log(player, str);
                    if (player.stat[player.stat.length - 1].damaged == undefined) {
                        player.stat[player.stat.length - 1].damaged = num;
                    }
                    else {
                        player.stat[player.stat.length - 1].damaged += num;
                    }
                    if (source) {
                        source.getHistory('sourceDamage').push(event);
                        if (source.stat[source.stat.length - 1].damage == undefined) {
                            source.stat[source.stat.length - 1].damage = num;
                        }
                        else {
                            source.stat[source.stat.length - 1].damage += num;
                        }
                    }
                    player.getHistory('damage').push(event);
                    if (event.notrigger) {
                        player.changeHp(-num, false)._triggered = null;
                    }
                    else {
                        player.changeHp(-num, false);
                    }
                    if (event.animate !== false) {
                        player.$damage(source);
                        game.broadcastAll(function (nature, player) {
                            if (lib.config.animation &amp;&amp; !lib.config.low_performance) {
                                if (nature == 'fire') {
                                    player.$fire();
                                }
                                else if (nature == 'thunder') {
                                    player.$thunder();
                                }
                            }
                        }, event.nature, player);
                        player.$damagepop(-num, event.nature);
                    }
                    if (!event.notrigger) {
                        if (num == 0) {
                            event.trigger('damageZero');
                            event._triggered = null;
                        }
                        else {
                            event.trigger('damage');
                        }
                    }
                    "step 6"
                    if (player.hp &lt;= 0 &amp;&amp; player.isAlive()) {
                        game.delayx();
                        player.dying(event);
                    }
                    if (source &amp;&amp; lib.config.border_style == 'auto') {
                        var dnum = 0;
                        for (var j = 0; j &lt; source.stat.length; j++) {
                            if (source.stat[j].damage != undefined) dnum += source.stat[j].damage;
                        }
                        if (dnum >= 2) {
                            if (lib.config.autoborder_start == 'silver') {
                                dnum += 4;
                            }
                            else if (lib.config.autoborder_start == 'gold') {
                                dnum += 8;
                            }
                        }
                        if (lib.config.autoborder_count == 'damage') {
                            source.node.framebg.dataset.decoration = '';
                            if (dnum >= 10) {
                                source.node.framebg.dataset.auto = 'gold';
                                if (dnum >= 12) source.node.framebg.dataset.decoration = 'gold';
                            }
                            else if (dnum >= 6) {
                                source.node.framebg.dataset.auto = 'silver';
                                if (dnum >= 8) source.node.framebg.dataset.decoration = 'silver';
                            }
                            else if (dnum >= 2) {
                                source.node.framebg.dataset.auto = 'bronze';
                                if (dnum >= 4) source.node.framebg.dataset.decoration = 'bronze';
                            }
                            if (dnum >= 2) {
                                source.classList.add('topcount');
                            }
                        }
                        else if (lib.config.autoborder_count == 'mix') {
                            source.node.framebg.dataset.decoration = '';
                            switch (source.node.framebg.dataset.auto) {
                                case 'bronze': if (dnum >= 4) source.node.framebg.dataset.decoration = 'bronze'; break;
                                case 'silver': if (dnum >= 8) source.node.framebg.dataset.decoration = 'silver'; break;
                                case 'gold': if (dnum >= 12) source.node.framebg.dataset.decoration = 'gold'; break;
                            }
                        }
                    }
                    "step 7"
                    if (!event.notrigger) event.trigger('damageSource');
                },
                /**
                 * 
                 * @name content.recover
                 * @type {GameCores.Bases.StateMachine}
                 */
                recover: function () {
                    if (lib.config.background_audio) {
                        game.playAudio('effect', 'recover');
                    }
                    game.broadcast(function () {
                        if (lib.config.background_audio) {
                            game.playAudio('effect', 'recover');
                        }
                    });
                    if (num > player.maxHp - player.hp) {
                        num = player.maxHp - player.hp;
                        event.num = num;
                    }
                    if (num > 0) {
                        player.changeHp(num, false);
                        game.broadcastAll(function (player) {
                            if (lib.config.animation &amp;&amp; !lib.config.low_performance) {
                                player.$recover();
                            }
                        }, player);
                        player.$damagepop(num, 'wood');
                        game.log(player, '' + get.cnNumber(num) + '' + get.translation('hp'));
                        event.result = num;
                    }
                },
                /**
                 * 
                 * @name content.loseHp
                 * @type {GameCores.Bases.StateMachine}
                 */
                loseHp: function () {
                    "step 0"
                    if (lib.config.background_audio) {
                        game.playAudio('effect', 'loseHp');
                    }
                    game.broadcast(function () {
                        if (lib.config.background_audio) {
                            game.playAudio('effect', 'loseHp');
                        }
                    });
                    game.log(player, '' + get.cnNumber(num) + '' + get.translation('hp'))
                    player.changeHp(-num);
                    "step 1"
                    if (player.hp &lt;= 0) {
                        game.delayx();
                        player.dying(event);
                    }
                },
                /**
                 * 
                 * @name content.doubleDraw
                 * @type {GameCores.Bases.StateMachine}
                 */
                doubleDraw: function () {
                    "step 0"
                    player.chooseBool('');
                    "step 1"
                    if (result.bool) {
                        player.draw();
                    }
                },
                /**
                 * 
                 * @name content.loseMaxHp
                 * @type {GameCores.Bases.StateMachine}
                 */
                loseMaxHp: function () {
                    "step 0"
                    game.log(player, '' + get.cnNumber(num) + '' + get.translation('hp') + '');
                    player.maxHp -= num;
                    event.loseHp = Math.max(0, player.hp - player.maxHp);
                    player.update();
                    "step 1"
                    if (player.maxHp &lt;= 0) {
                        player.die(event);
                    }
                },
                /**
                 * 
                 * @name content.gainMaxHp
                 * @type {GameCores.Bases.StateMachine}
                 */
                gainMaxHp: function () {
                    "step 0"
                    game.log(player, '' + get.cnNumber(num) + '' + get.translation('hp') + '');
                    player.maxHp += num;
                    player.update();
                },
                /**
                 * ()
                 * @name content.changeHp
                 * @type {GameCores.Bases.StateMachine}
                 */
                changeHp: function () {
                    //
                    'step 0'
                    event.trigger('changeHpBegin');
                    'step 1'
                    player.hp += num;
                    if (isNaN(player.hp)) player.hp = 0;
                    if (player.hp > player.maxHp) player.hp = player.maxHp;
                    player.update();
                    if (event.popup !== false) {
                        player.$damagepop(num, 'water');
                    }
                    //
                    if (_status.dying.contains(player) &amp;&amp; player.hp > 0) {
                        _status.dying.remove(player);
                        game.broadcast(function (list) {
                            _status.dying = list;
                        }, _status.dying);
                        var evt = event.getParent('_save');
                        if (evt &amp;&amp; evt.finish) evt.finish();
                        evt = event.getParent('dying');
                        if (evt &amp;&amp; evt.finish) evt.finish()
                    }
                    event.trigger('changeHp');
                },
                /**
                 * /
                 * @name content.changeHujia
                 * @type {GameCores.Bases.StateMachine}
                 */
                changeHujia: function () {
                    if (lib.config.background_audio) {
                        game.playAudio('effect', 'hujia');
                    }
                    game.broadcast(function () {
                        if (lib.config.background_audio) {
                            game.playAudio('effect', 'hujia');
                        }
                    });
                    player.hujia += num;
                    player.$damagepop((num > 0 ? '+' + num : num), 'gray');
                    if (num > 0) {
                        game.log(player, '' + get.cnNumber(num) + '');
                    } else if (num &lt; 0) {
                        if (event.type == 'damage') game.log(player, '' + get.cnNumber(-num) + '');
                        //else if(event.type=='lose')	game.log(player,''+get.cnNumber(-num)+'');
                        else game.log(player, '' + get.cnNumber(-num) + '');
                    }
                    if (player.hujia &lt; 0) {
                        player.hujia = 0;
                    }
                    player.update();
                },
                /**
                 * 
                 * @name content.dying
                 * @type {GameCores.Bases.StateMachine}
                 */
                dying: function () {
                    "step 0"
                    event.forceDie = true;
                    if (player.isDying() || player.hp > 0) {
                        event.finish();
                        return;
                    }
                    _status.dying.unshift(player);
                    game.broadcast(function (list) {
                        _status.dying = list;
                    }, _status.dying);
                    event.trigger('dying');
                    game.log(player, '');
                    "step 1"
                    delete event.filterStop;
                    if (player.hp > 0) {
                        _status.dying.remove(player);
                        game.broadcast(function (list) {
                            _status.dying = list;
                        }, _status.dying);
                        event.finish();
                    }
                    else if (!event.skipTao) {
                        var next = game.createEvent('_save');
                        var start = false;
                        var starts = [_status.currentPhase, event.source, event.player, game.me, game.players[0]];
                        for (var i = 0; i &lt; starts.length; i++) {
                            if (get.itemtype(starts[i]) == 'player') {
                                start = starts[i]; break;
                            }
                        }
                        next.player = start;
                        next._trigger = event;
                        next.triggername = '_save';
                        next.forceDie = true;
                        next.setContent(lib.skill._save.content);
                    }
                    "step 2"
                    _status.dying.remove(player);
                    game.broadcast(function (list) {
                        _status.dying = list;
                    }, _status.dying);
                    if (player.hp &lt;= 0 &amp;&amp; !player.nodying) player.die(event.reason);
                },
                /**
                 * 
                 * @name content.die
                 * @type {GameCores.Bases.StateMachine}
                 */
                die: function () {
                    "step 0"
                    event.forceDie = true;
                    if (_status.roundStart == player) {
                        _status.roundStart = player.next || player.getNext() || game.players[0];
                    }
                    if (ui.land &amp;&amp; ui.land.player == player) {
                        game.addVideo('destroyLand');
                        ui.land.destroy();
                    }
                    var unseen = false;
                    if (player.classList.contains('unseen')) {
                        player.classList.remove('unseen');
                        unseen = true;
                    }
                    var logvid = game.logv(player, 'die', source);
                    event.logvid = logvid;
                    if (unseen) {
                        player.classList.add('unseen');
                    }
                    if (source) {
                        game.log(player, '', source, '');
                        if (source.stat[source.stat.length - 1].kill == undefined) {
                            source.stat[source.stat.length - 1].kill = 1;
                        }
                        else {
                            source.stat[source.stat.length - 1].kill++;
                        }
                    }
                    else {
                        game.log(player, '')
                    }


                    // player.removeEquipTrigger();

                    // for(var i in lib.skill.globalmap){
                    //     if(lib.skill.globalmap[i].contains(player)){
                    //                  lib.skill.globalmap[i].remove(player);
                    //                  if(lib.skill.globalmap[i].length==0&amp;&amp;!lib.skill[i].globalFixed){
                    //                               game.removeGlobalSkill(i);
                    //                  }
                    //     }
                    // }

                    game.broadcastAll(function (player) {
                        player.classList.add('dead');
                        player.removeLink();
                        player.classList.remove('turnedover');
                        player.classList.remove('out');
                        player.node.count.innerHTML = '0';
                        player.node.hp.hide();
                        player.node.equips.hide();
                        player.node.count.hide();
                        player.previous.next = player.next;
                        player.next.previous = player.previous;
                        game.players.remove(player);
                        game.dead.push(player);
                        _status.dying.remove(player);

                        if (lib.config.background_speak) {
                            if (lib.character[player.name] &amp;&amp; lib.character[player.name][4].contains('die_audio')) {
                                game.playAudio('die', player.name);
                            }
                            // else if(true){
                            else {
                                game.playAudio('die', player.name, function () {
                                    game.playAudio('die', player.name.slice(player.name.indexOf('_') + 1));
                                });
                            }
                        }
                    }, player);

                    game.addVideo('diex', player);
                    if (event.animate !== false) {
                        player.$die(source);
                    }
                    if (player.hp != 0) {
                        player.changeHp(0 - player.hp, false).forceDie = true;
                    }
                    "step 1"
                    if (player.dieAfter) player.dieAfter(source);
                    "step 2"
                    event.trigger('die');
                    "step 3"
                    if (player.isDead()) {
                        if (!game.reserveDead) {
                            for (var mark in player.marks) {
                                player.unmarkSkill(mark);
                            }
                            while (player.node.marks.childNodes.length > 1) {
                                player.node.marks.lastChild.remove();
                            }
                            game.broadcast(function (player) {
                                while (player.node.marks.childNodes.length > 1) {
                                    player.node.marks.lastChild.remove();
                                }
                            }, player);
                        }
                        for (var i in player.tempSkills) {
                            player.removeSkill(i);
                        }
                        var skills = player.getSkills();
                        for (var i = 0; i &lt; skills.length; i++) {
                            if (lib.skill[skills[i]].temp) {
                                player.removeSkill(skills[i]);
                            }
                        }
                        if (_status.characterlist) {
                            if (lib.character[player.name]) _status.characterlist.add(player.name);
                            if (lib.character[player.name1]) _status.characterlist.add(player.name1);
                            if (lib.character[player.name2]) _status.characterlist.add(player.name2);
                        }
                        event.cards = player.getCards('hejs');
                        if (event.cards.length) {
                            player.discard(event.cards).forceDie = true;
                            //player.$throw(event.cards,1000);
                        }
                    }
                    "step 4"
                    if (player.dieAfter2) player.dieAfter2(source);
                    "step 5"
                    game.broadcastAll(function (player) {
                        if (game.online &amp;&amp; player == game.me &amp;&amp; !_status.over &amp;&amp; !game.controlOver &amp;&amp; !ui.exit) {
                            if (lib.mode[lib.configOL.mode].config.dierestart) {
                                ui.create.exit();
                            }
                        }
                    }, player);
                    if (!_status.connectMode &amp;&amp; player == game.me &amp;&amp; !_status.over &amp;&amp; !game.controlOver) {
                        ui.control.show();
                        if (get.config('revive') &amp;&amp; lib.mode[lib.config.mode].config.revive &amp;&amp; !ui.revive) {
                            ui.revive = ui.create.control('revive', ui.click.dierevive);
                        }
                        if (get.config('continue_game') &amp;&amp; !ui.continue_game &amp;&amp; lib.mode[lib.config.mode].config.continue_game &amp;&amp; !_status.brawl &amp;&amp; !game.no_continue_game) {
                            ui.continue_game = ui.create.control('', game.reloadCurrent);
                        }
                        if (get.config('dierestart') &amp;&amp; lib.mode[lib.config.mode].config.dierestart &amp;&amp; !ui.restart) {
                            ui.restart = ui.create.control('restart', game.reload);
                        }
                    }

                    if (!_status.connectMode &amp;&amp; player == game.me &amp;&amp; !game.modeSwapPlayer) {
                        // _status.auto=false;
                        if (ui.auto) {
                            // ui.auto.classList.remove('glow');
                            ui.auto.hide();
                        }
                        if (ui.wuxie) ui.wuxie.hide();
                    }

                    if (typeof _status.coin == 'number' &amp;&amp; source &amp;&amp; !_status.auto) {
                        if (source == game.me || source.isUnderControl()) {
                            _status.coin += 10;
                        }
                    }
                    if (source &amp;&amp; lib.config.border_style == 'auto' &amp;&amp; (lib.config.autoborder_count == 'kill' || lib.config.autoborder_count == 'mix')) {
                        switch (source.node.framebg.dataset.auto) {
                            case 'gold': case 'silver': source.node.framebg.dataset.auto = 'gold'; break;
                            case 'bronze': source.node.framebg.dataset.auto = 'silver'; break;
                            default: source.node.framebg.dataset.auto = lib.config.autoborder_start || 'bronze';
                        }
                        if (lib.config.autoborder_count == 'kill') {
                            source.node.framebg.dataset.decoration = source.node.framebg.dataset.auto;
                        }
                        else {
                            var dnum = 0;
                            for (var j = 0; j &lt; source.stat.length; j++) {
                                if (source.stat[j].damage != undefined) dnum += source.stat[j].damage;
                            }
                            source.node.framebg.dataset.decoration = '';
                            switch (source.node.framebg.dataset.auto) {
                                case 'bronze': if (dnum >= 4) source.node.framebg.dataset.decoration = 'bronze'; break;
                                case 'silver': if (dnum >= 8) source.node.framebg.dataset.decoration = 'silver'; break;
                                case 'gold': if (dnum >= 12) source.node.framebg.dataset.decoration = 'gold'; break;
                            }
                        }
                        source.classList.add('topcount');
                    }
                },
                /**
                 * 
                 * @name content.equip
                 * @type {GameCores.Bases.StateMachine}
                 */
                equip: function () {
                    "step 0"
                    console.log(card, cards)
                    if (cards) {
                        var owner = get.owner(cards[0]);
                        if (owner) owner.lose(card, ui.special, 'visible').set('type', 'equip').set('getlx', false);
                    }
                    "step 1"
                    if (event.cancelled) {
                        event.finish();
                        return;
                    }
                    if (cards[0].destroyed) {
                        if (player.hasSkill(cards[0].destroyed)) {
                            delete cards[0].destroyed;
                        }
                        else {
                            event.finish();
                            return;
                        }
                    }
                    if (event.draw) {
                        game.delay(0, 300);
                        player.$draw(cards);
                    }
                    var viewAs = typeof card == 'string' ? card : card.name;
                    event.viewAs = viewAs;
                    if (!lib.card[viewAs]) {
                        cards[0].fix();
                        cards[0].style.transform = '';
                        cards[0].classList.remove('drawinghidden');
                        delete cards[0]._transform;
                        game.cardsDiscard(cards[0]);
                        event.finish();
                    }
                    "step 2"
                    game.broadcast(function (player, card, viewAs) {
                        if (card.clone &amp;&amp; (card.clone.parentNode == player.parentNode || card.clone.parentNode == ui.arena)) {
                            card.clone.moveDelete(player);
                            game.addVideo('gain2', player, get.cardsInfo([card]));
                        }
                    }, player, cards[0], event.viewAs);
                    if (cards[0].clone &amp;&amp; (cards[0].clone.parentNode == player.parentNode || cards[0].clone.parentNode == ui.arena)) {
                        cards[0].clone.moveDelete(player);
                        game.addVideo('gain2', player, get.cardsInfo(cards));
                    }
                    player.equiping = true;
                    "step 3"
                    var info = get.info(card, false);
                    var current = player.getCards('e', function (card) {
                        if (info.customSwap) return info.customSwap(card);
                        return get.subtype(card, false) == info.subtype;
                    });
                    if (current.length) {
                        player.lose(current, false, 'visible').set('type', 'equip').set('getlx', false);
                        if (info.loseThrow) {
                            player.$throw(current);
                        }
                        event.swapped = true;
                        event.redo();
                    }
                    if (get.itemtype(card) != 'card') {
                        if (typeof card == 'string') cards[0].viewAs = card;
                        else cards[0].viewAs = card.name;
                    }
                    else {
                        delete cards[0].viewAs;
                    }
                    "step 4"
                    if (player.isMin() || player.countCards('e', { subtype: get.subtype(event.viewAs) })) {
                        event.finish();
                        game.cardsDiscard(cards[0]);
                        delete player.equiping;
                        return;
                    }
                    if (lib.config.background_audio) {
                        game.playAudio('effect', get.subtype(event.viewAs));
                    }
                    game.broadcast(function (type) {
                        if (lib.config.background_audio) {
                            game.playAudio('effect', type);
                        }
                    }, get.subtype(cards[0].viewAs));
                    if (cards[0].viewAs &amp;&amp; cards[0].viewAs != cards[0].name) {
                        player.$equip(cards[0], cards[0].viewAs);
                        game.addVideo('equip', player, get.cardInfo(cards[0].viewAs));
                        game.log(player, '&lt;span class="yellowtext">' + get.translation(cards[0].viewAs) + '&lt;/span>', cards[0], '');
                    }
                    else if (cards[0].originalName &amp;&amp; cards[0].originalName != cards[0].name) {
                        player.$equip(cards[0]);
                        game.addVideo('equip', player, get.cardInfo(cards[0]));
                        game.log(player, '', cards[0], '' + get.translation(cards[0].originalName) + '');
                    }
                    else {
                        player.$equip(cards[0]);
                        game.addVideo('equip', player, get.cardInfo(card));
                        game.log(player, '', card);
                    }
                    "step 5"
                    var info = get.info(card, false);
                    if (info.onEquip &amp;&amp; (!info.filterEquip || info.filterEquip(card, player))) {
                        if (Array.isArray(info.onEquip)) {
                            for (var i = 0; i &lt; info.onEquip.length; i++) {
                                var next = game.createEvent('equip_' + card.name);
                                next.setContent(info.onEquip[i]);
                                next.player = player;
                                next.card = card;
                            }
                        }
                        else {
                            var next = game.createEvent('equip_' + card.name);
                            next.setContent(info.onEquip);
                            next.player = player;
                            next.card = card;
                        }
                        if (info.equipDelay != 'false') game.delayx();
                    }
                    delete player.equiping;
                    if (event.delay) {
                        game.delayx();
                    }
                },
                /**
                 * 
                 * @name content.addJudge
                 * @type {GameCores.Bases.StateMachine}
                 */
                addJudge: function () {
                    "step 0"
                    if (cards) {
                        var owner = get.owner(cards[0]);
                        if (owner) {
                            event.relatedLose = owner.lose(cards, 'visible').set('getlx', false);
                        }
                    }
                    "step 1"
                    if (cards[0].destroyed) {
                        if (player.hasSkill(cards[0].destroyed)) {
                            delete cards[0].destroyed;
                        }
                        else {
                            event.finish();
                            return;
                        }
                    }
                    cards[0].fix();
                    cards[0].style.transform = '';
                    cards[0].classList.remove('drawinghidden');
                    delete cards[0]._transform;
                    var viewAs = typeof card == 'string' ? card : card.name;
                    if (!lib.card[viewAs] || !lib.card[viewAs].effect) {
                        game.cardsDiscard(cards[0]);
                    }
                    else {
                        cards[0].style.transform = '';
                        cards[0].classList.add('drawinghidden');
                        player.node.judges.insertBefore(cards[0], player.node.judges.firstChild);
                        if (_status.discarded) {
                            _status.discarded.remove(cards[0]);
                        }
                        ui.updatej(player);
                        game.broadcast(function (player, card, viewAs) {
                            card.fix();
                            card.style.transform = '';
                            card.classList.add('drawinghidden');
                            card.viewAs = viewAs;
                            if (viewAs &amp;&amp; viewAs != card.name &amp;&amp; (card.classList.contains('fullskin') || card.classList.contains('fullborder'))) {
                                card.classList.add('fakejudge');
                                card.node.background.innerHTML = lib.translate[viewAs + '_bg'] || get.translation(viewAs)[0]
                            }
                            else {
                                card.classList.remove('fakejudge');
                            }
                            player.node.judges.insertBefore(card, player.node.judges.firstChild);
                            ui.updatej(player);
                            if (card.clone &amp;&amp; (card.clone.parentNode == player.parentNode || card.clone.parentNode == ui.arena)) {
                                card.clone.moveDelete(player);
                                game.addVideo('gain2', player, get.cardsInfo([card]));
                            }
                        }, player, cards[0], viewAs);
                        if (cards[0].clone &amp;&amp; (cards[0].clone.parentNode == player.parentNode || cards[0].clone.parentNode == ui.arena)) {
                            cards[0].clone.moveDelete(player);
                            game.addVideo('gain2', player, get.cardsInfo(cards));
                        }
                        // player.$gain2(cards);
                        if (get.itemtype(card) != 'card') {
                            if (typeof card == 'string') cards[0].viewAs = card;
                            else cards[0].viewAs = card.name;
                        }
                        else {
                            delete cards[0].viewAs;
                        }
                        if (cards[0].viewAs &amp;&amp; cards[0].viewAs != cards[0].name) {
                            if (cards[0].classList.contains('fullskin') || cards[0].classList.contains('fullborder')) {
                                cards[0].classList.add('fakejudge');
                                cards[0].node.background.innerHTML = lib.translate[cards[0].viewAs + '_bg'] || get.translation(cards[0].viewAs)[0];
                            }
                            //
                            game.log(player, '&lt;span class="yellowtext">' + get.translation(cards[0].viewAs) + '&lt;/span>', cards[0], '');
                        }
                        else {
                            cards[0].classList.remove('fakejudge');
                            game.log(player, '', cards);
                        }
                        game.addVideo('addJudge', player, [get.cardInfo(cards[0]), cards[0].viewAs]);
                    }
                },
                /**
                 * 
                 * @name content.judge
                 * @type {GameCores.Bases.StateMachine}
                 * @property {!Object} event 
                 * @property {!Object} event.result 
                 */
                judge: function () {
                    "step 0"
                    var judgestr = get.translation(player) + '' + event.judgestr + '';
                    event.videoId = lib.status.videoId++;
                    var cardj = event.directresult;
                    if (!cardj) {
                        if (player.getTopCards) cardj = player.getTopCards()[0];
                        else cardj = get.cards()[0];
                    }
                    var nextj = game.cardsGotoOrdering(cardj);
                    if (event.position != ui.discardPile) nextj.noOrdering = true;
                    player.judging.unshift(cardj);
                    game.addVideo('judge1', player, [get.cardInfo(player.judging[0]), judgestr, event.videoId]);
                    game.broadcastAll(function (player, card, str, id, cardid) {
                        var event;
                        if (game.online) {
                            event = {};
                        }
                        else {
                            event = _status.event;
                        }
                        if (game.chess) {
                            event.node = card.copy('thrown', 'center', ui.arena).animate('start');
                        }
                        else {
                            event.node = player.$throwordered(card.copy(), true);
                        }
                        if (lib.cardOL) lib.cardOL[cardid] = event.node;
                        event.node.cardid = cardid;
                        event.node.classList.add('thrownhighlight');
                        ui.arena.classList.add('thrownhighlight');
                        event.dialog = ui.create.dialog(str);
                        event.dialog.classList.add('center');
                        event.dialog.videoId = id;
                    }, player, player.judging[0], judgestr, event.videoId, get.id());

                    game.log(player, '' + event.judgestr + '', player.judging[0]);
                    game.delay(2);
                    if (!event.noJudgeTrigger) event.trigger('judge');
                    "step 1"
                    event.result = {
                        card: player.judging[0],
                        name: player.judging[0].name,
                        number: get.number(player.judging[0]),
                        suit: get.suit(player.judging[0]),
                        color: get.color(player.judging[0]),
                        node: event.node,
                    };
                    if (event.fixedResult) {
                        for (var i in event.fixedResult) {
                            event.result[i] = event.fixedResult[i];
                        }
                    }
                    event.result.judge = event.judge(event.result);
                    if (event.result.judge > 0) event.result.bool = true;
                    else if (event.result.judge &lt; 0) event.result.bool = false;
                    else event.result.bool = null;
                    player.judging.shift();
                    game.checkMod(player, event.result, 'judge', player);
                    if (event.result.bool == true) {
                        player.popup('');
                    }
                    else if (event.result.bool == false) {
                        player.popup('');
                    }
                    if (event.clearArena != false) {
                        game.broadcastAll(ui.clear);
                    }
                    game.broadcast(function (id) {
                        var dialog = get.idDialog(id);
                        if (dialog) {
                            dialog.close();
                        }
                        ui.arena.classList.remove('thrownhighlight');
                    }, event.videoId);
                    event.dialog.close();
                    game.addVideo('judge2', null, event.videoId);
                    ui.arena.classList.remove('thrownhighlight');
                    game.log(player, '', event.result.card);
                    if (event.callback) {
                        var next = game.createEvent('judgeCallback', false);
                        next.player = player;
                        next.card = event.result.card;
                        next.judgeResult = get.copy(event.result);
                        next.setContent(event.callback);
                    }
                    else {
                        if (!get.owner(event.result.card)) {
                            if (event.position != ui.discardPile) event.position.appendChild(event.result.card);
                        }
                    }
                },
                /**
                 * 
                 * @name content.turnOver
                 * @type {GameCores.Bases.StateMachine}
                 */
                turnOver: function () {
                    game.log(player, '');
                    player.classList.toggle('turnedover');
                    game.broadcast(function (player) {
                        player.classList.toggle('turnedover');
                    }, player);
                    game.addVideo('turnOver', player, player.classList.contains('turnedover'));
                },
                /**
                 * /
                 * @name content.link
                 * @type {GameCores.Bases.StateMachine}
                 */
                link: function () {
                    if (player.isLinked()) {
                        game.log(player, '');
                    }
                    else {
                        game.log(player, '');
                    }
                    if (lib.config.background_audio) {
                        game.playAudio('effect', 'link');
                    }
                    game.broadcast(function () {
                        if (lib.config.background_audio) {
                            game.playAudio('effect', 'link');
                        }
                    });
                    player.classList.remove('target');
                    if (get.is.linked2(player)) {
                        player.classList.toggle('linked2');
                    }
                    else {
                        player.classList.toggle('linked');
                    }
                    ui.updatej(player);
                    ui.updatem(player);
                    game.broadcast(function (player, linked) {
                        player.classList.remove('target');
                        if (get.is.linked2(player)) {
                            if (linked) {
                                player.classList.add('linked2');
                            }
                            else {
                                player.classList.remove('linked2');
                            }
                        }
                        else {
                            if (linked) {
                                player.classList.add('linked');
                            }
                            else {
                                player.classList.remove('linked');
                            }
                        }
                        ui.updatej(player);
                        ui.updatem(player);
                    }, player, player.isLinked());
                    game.addVideo('link', player, player.isLinked());
                },
                chooseToGuanxing: function () {
                    "step 0"
                    if (player.isUnderControl()) {
                        game.swapPlayerAuto(player);
                    }
                    var cards = get.cards(num);
                    event.cards = cards;
                    var switchToAuto = (event.ai || function () {
                        _status.imchoosing = false;
                        if (event.dialog) event.dialog.close();
                        if (event.control) event.control.close();
                        var top = [];
                        var bottom;
                        cards.sort(function (a, b) {
                            return get.value(b, player) - get.value(a, player);
                        });
                        while (cards.length) {
                            if (get.value(cards[0], player) &lt;= 5) break;
                            top.unshift(cards.shift());
                        }
                        bottom = cards;
                        for (var i = 0; i &lt; top.length; i++) {
                            ui.cardPile.insertBefore(top[i], ui.cardPile.firstChild);
                        }
                        for (i = 0; i &lt; bottom.length; i++) {
                            ui.cardPile.appendChild(bottom[i]);
                        }
                        player.popup(get.cnNumber(top.length) + '' + get.cnNumber(bottom.length) + '');
                        game.log(player, '' + get.cnNumber(top.length) + '');
                        game.delay(2);
                    });
                    var chooseButton = function (player, cards) {
                        var event = _status.event;
                        player = player || event.player;
                        cards = cards || event.cards;
                        event.top = [];
                        event.bottom = [];
                        event.status = true;
                        event.dialog = ui.create.dialog('', cards);
                        for (var i = 0; i &lt; event.dialog.buttons.length; i++) {
                            event.dialog.buttons[i].classList.add('pointerdiv');
                        }
                        event.switchToAuto = function () {
                            event._result = 'ai';
                            event.dialog.close();
                            event.control.close();
                            _status.imchoosing = false;
                        },
                            event.control = ui.create.control('ok', 'pileTop', 'pileBottom', function (link) {
                                var event = _status.event;
                                if (link == 'ok') {
                                    event._result = {
                                        top: [],
                                        bottom: []
                                    }
                                    for (var i = 0; i &lt; event.top.length; i++) {
                                        event._result.top.push(event.top[i].link);
                                    }
                                    for (var i = 0; i &lt; event.bottom.length; i++) {
                                        event._result.bottom.push(event.bottom[i].link);
                                    }
                                    event.dialog.close();
                                    event.control.close();
                                    game.resume();
                                    _status.imchoosing = false;
                                }
                                else if (link == 'pileTop') {
                                    event.status = true;
                                    event.dialog.content.childNodes[0].innerHTML = '';
                                }
                                else {
                                    event.status = false;
                                    event.dialog.content.childNodes[0].innerHTML = '';
                                }
                            })
                        for (var i = 0; i &lt; event.dialog.buttons.length; i++) {
                            event.dialog.buttons[i].classList.add('selectable');
                        }
                        event.custom.replace.button = function (link) {
                            var event = _status.event;
                            if (link.classList.contains('target')) {
                                link.classList.remove('target');
                                event.top.remove(link);
                            }
                            else if (link.classList.contains('glow')) {
                                link.classList.remove('glow');
                                event.bottom.remove(link);
                            }
                            else if (event.status) {
                                link.classList.add('target');
                                event.top.unshift(link);
                            }
                            else {
                                link.classList.add('glow');
                                event.bottom.push(link);
                            }
                        }
                        event.custom.replace.window = function () {
                            for (var i = 0; i &lt; _status.event.dialog.buttons.length; i++) {
                                _status.event.dialog.buttons[i].classList.remove('target');
                                _status.event.dialog.buttons[i].classList.remove('glow');
                                _status.event.top.length = 0;
                                _status.event.bottom.length = 0;
                            }
                        }
                        game.pause();
                        game.countChoose();
                    };
                    event.switchToAuto = switchToAuto;
                    if (event.isMine()) {
                        chooseButton();
                    }
                    else if (event.isOnline()) {
                        event.player.send(chooseButton, event.player, event.cards);
                        event.player.wait();
                        game.pause();
                    }
                    else {
                        event.switchToAuto();
                        event.finish();
                    }
                    "step 1"
                    var result = event.result || result;
                    if (!result || result == 'ai') {
                        event.switchToAuto();
                    }
                    else {
                        var top = result.top || [];
                        var bottom = result.bottom || [];
                        for (var i = 0; i &lt; top.length; i++) {
                            ui.cardPile.insertBefore(top[i], ui.cardPile.firstChild);
                        }
                        for (i = 0; i &lt; event.cards.length; i++) {
                            if (!top.contains(event.cards[i]) &amp;&amp; !bottom.contains(event.cards[i])) {
                                ui.cardPile.appendChild(event.cards[i]);
                            }
                        }
                        for (i = 0; i &lt; bottom.length; i++) {
                            ui.cardPile.appendChild(bottom[i]);
                        }
                        player.popup(get.cnNumber(top.length) + '' + get.cnNumber(event.cards.length - top.length) + '');
                        game.log(player, '' + get.cnNumber(top.length) + '');
                        game.updateRoundNumber();
                        game.delay(2);
                    }
                },
            },
            /**
             * .playershowCard
             * 
             * @namespace
             * @mixin
             */
            player: {
                /**
                 * 
                 */
                hasCardAround: function () {
                    let cards = [];
					let skills = this.getSkills(true,false,false);
                    game.expandSkills(skills);
					for(let i of skills){
                        if(lib.skill[i]&amp;&amp;lib.skill[i].cardAround){
                            let key = [];
                            let storage = this.getStorage(i);
                            let method = lib.skill[i].cardAround;
                            if(Array.isArray(method)){
                                for(let j of method)   key = key.concat(storage[j]);
                            }
                            else if(typeof method == 'function'){
                                key = key.concat(method(this));
                            }
                            else if(Array.isArray(storage)) key = key.concat(storage);
                            else    key.push(storage);
                            console.log(key);
                            cards.addArray(key);
                        }
					}
                    if(cards.length)    return cards;
                    return false;
                },
                isYingV: function () {
                    var info = lib.character[this.name || this.name1];
                    if (info &amp;&amp; info[4]) {
                        if (info[4].contains('yingV')) return true;
                    }
                },
                isGuoV: function () {
                    var info = lib.character[this.name || this.name1];
                    if (info &amp;&amp; info[4]) {
                        if (info[4].contains('guoV')) return true;
                    }
                },
                /**
                 * 
                 */
                addToJudge: function (card, source) {
                    let cards = (get.itemtype(card) == 'card') ? [card] : card;
                    if (source) source.$give(cards, this, false);
                    if (get.type(cards[0]) == 'delay') this.addJudge(cards[0]);
                    else if (get.color(cards[0]) == 'red' &amp;&amp; this.canAddJudge('lebu')) this.addJudge({ name: 'lebu' }, cards);
                    else if (get.color(cards[0]) == 'black' &amp;&amp; this.canAddJudge('bingliang')) this.addJudge({ name: 'bingliang' }, cards);
                },
                /**
                 * 
                 */
                canAddToJudge: function (card) {
                    if (get.type(card) == 'delay') return this.canAddJudge(card);
                    if (this.canAddJudge('lebu') &amp;&amp; get.color(card) == 'red') return true
                    if (this.canAddJudge('bingliang') &amp;&amp; get.color(card) == 'black') return true
                    return false;
                },
                //()
                chooseShengjie: function () {
                    let next = game.createEvent('chooseShengjie');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') next.materials = arguments[i];
                        else if (typeof arguments[i] == 'boolean') next.forced = arguments[i];
                        else if (typeof arguments[i] == 'string') next.prompt = arguments[i];
                        else if (get.itemtype(arguments[i]) == 'select' || typeof arguments[i] == 'number') next.select = arguments[i];
                        else if (typeof arguments[i] == 'function') next.filterProduct = arguments[i];
                        else if (typeof arguments[i] == 'function') next.filterMaterial = arguments[i];
                    }
                    if (!this.canShengjie.apply(this, arguments)) return;
                    if (next.prompt == undefined) next.prompt = '';
                    if (next.select == undefined) next.select = [1, Infinity];
                    next.setContent('chooseShengjie');
                    return next;
                },
                canShengjie: function () {
                    if (lib.configOL.protect_beginner) return false;
                    let list = [];
                    if (!lib.cardPack.mode_derivation || !lib.cardPack.mode_derivation.length) return false;
                    for (var i = 0; i &lt; lib.cardPack.mode_derivation.length; i++) {
                        var info = lib.card[lib.cardPack.mode_derivation[i]];
                        if (info &amp;&amp; info.materials &amp;&amp; (typeof info.materials == 'function' || Array.isArray(info.materials))) list.push(lib.cardPack.mode_derivation[i]);
                    }
                    var materials, select, filterProduct, bool = false;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') materials = arguments[i];
                        else if (get.itemtype(arguments[i]) == 'select' || typeof arguments[i] == 'number') select = arguments[i];
                        else if (typeof arguments[i] == 'function') filterProduct = arguments[i];
                    }
                    if (filterProduct) list = list.filter(filterProduct);
                    if (!materials || !list.length) return false;
                    if (select == undefined) select = [1, Infinity];
                    var materialList = [];
                    var cards = materials.slice(0);
                    var l = cards.length;
                    var all = Math.pow(l, 2);
                    for (var i = 1; i &lt; all; i++) {
                        var array = [];
                        for (var j = 0; j &lt; l; j++) {
                            if (Math.floor((i % Math.pow(2, j + 1)) / Math.pow(2, j)) > 0) array.push(cards[j])
                        }
                        if ((get.itemtype(select) == 'select' &amp;&amp; array.length >= select[0] &amp;&amp; array.length &lt;= select[1])
                            || (typeof select == 'number' &amp;&amp; array.length == select)) materialList.push(array);
                    }
                    for (var j of materialList) {
                        for (var k of list) {
                            var filter = get.info({ name: k }).materials;
                            if (Array.isArray(filter) &amp;&amp; filter.length == j.length) {
                                var mate = filter.slice(0);
                                for (var l = 0; l &lt; mate.length; l++) {
                                    for (var card of j) {
                                        if (get.is.filterCardBy(card, mate[l])) {
                                            mate.splice(l--, 1);
                                        }
                                    }
                                }
                                if (mate.length == 0) {
                                    bool = true;
                                }
                            }
                            if (typeof filter == 'function') {
                                bool = filter(j);
                            }
                        }
                    }
                    return bool;
                },
                //
                /**
                 * 
                 */
                addSkillBlocker: function (skill) {
                    if (!this.storage.skill_blocker) this.storage.skill_blocker = [];
                    this.storage.skill_blocker.push(skill);
                },
                /**
                 * 
                 */
                removeSkillBlocker: function (skill) {
                    if (this.storage.skill_blocker) {
                        this.storage.skill_blocker.remove(skill);
                        if (!this.storage.skill_blocker.length) delete this.storage.skill_blocker;
                    }
                },
                /**
                 * ()
                 */
                loseToSpecial: function (cards, tag, target) {
                    var next = game.loseAsync({
                        player: this,
                        cards: cards,
                        tag: tag,
                        toStorage: true,
                        target: target || this,
                    });
                    next.setContent(function () {
                        "step 0"
                        player.lose(cards, ui.special).set('getlx', false);
                        "step 1"
                        target.directgains(cards, null, event.tag)
                    });
                    return next;
                },
                /**
                 * 
                 */
                addGaintag: function (cards, tag) {
                    if (get.itemtype(cards) == 'card') cards = [cards];
                    game.addVideo('addGaintag', this, [get.cardsInfo(cards), tag]);
                    game.broadcastAll(function (player, cards, tag) {
                        var hs = player.getCards('h');
                        for (var i of cards) {
                            if (hs.contains(i)) i.addGaintag(tag);
                        }
                    }, this, cards, tag);
                },
                /**
                 * 
                 */
                removeGaintag: function (tag, cards) {
                    game.addVideo('removeGaintag', this, tag);
                    game.broadcastAll(function (player, tag, cards) {
                        cards = cards || player.getCards('h');
                        for (var i of cards) i.removeGaintag(tag);
                    }, this, tag, cards);
                },
                /**
                 * 
                 * @param {string} target 
                 * @returns {!boolean} `true``false`
                 */
                canSave: function (target) {
                    var player = this;
                    if (player.hasSkillTag('save', true, target, true)) return true;
                    var name = {}, hs = player.getCards('hs');
                    for (var i of hs) name[get.name(i)] = true;
                    for (var i in lib.card) {
                        if (lib.card[i].savable &amp;&amp; (lib.inpile.contains(i) || name[i])) {
                            if (lib.filter.cardSavable({ name: i }, player, target) &amp;&amp; (_status.connectMode || player.hasUsableCard(i))) return true;
                        }
                    }
                    return false;
                },
                /**
                 * 
                 * @param {(0|1|2)} num 0:; 1: ; 2: 
                 * @param {?boolean} [log] truefalse
                 * @returns {GameCores.Bases.Event}
                 */
                showCharacter: function (num, log) {
                    var toShow = [];
                    if ((num == 0 || num == 2) &amp;&amp; this.isUnseen(0)) toShow.add(this.name1);
                    if ((num == 1 || num == 2) &amp;&amp; this.isUnseen(1)) toShow.add(this.name2);
                    if (!toShow.length) return;
                    lib.element.player.$showCharacter.apply(this, arguments);
                    var next = game.createEvent('showCharacter', false);
                    next.player = this;
                    next.num = num;
                    next.toShow = toShow;
                    next._args = arguments;
                    next.setContent('showCharacter');
                    return next;
                },
                /**
                 * ()
                 * @param {(0|1|2)} num 0:; 1: ; 2: 
                 * @param {?boolean} [log] truefalse
                 */
                $showCharacter: function (num, log) {
                    if (num == 0 &amp;&amp; !this.isUnseen(0)) {
                        return;
                    }
                    if (num == 1 &amp;&amp; (!this.name2 || !this.isUnseen(1))) {
                        return;
                    }
                    if (!this.isUnseen(2)) {
                        return;
                    }
                    game.addVideo('showCharacter', this, num);
                    var skills;
                    switch (num) {
                        case 0:
                            if (log !== false) game.log(this, '', '#b' + this.name1);
                            this.name = this.name1;
                            skills = lib.character[this.name][3] || [];
                            this.sex = lib.character[this.name][0];
                            if (this.group == 'unknown') this.group = lib.character[this.name][1];
                            this.classList.remove('unseen');
                            break;
                        case 1:
                            if (log !== false) game.log(this, '', '#b' + this.name2);
                            skills = lib.character[this.name2][3] || [];
                            if (this.sex == 'unknown') this.sex = lib.character[this.name2][0];
                            if (this.name.indexOf('unknown') == 0) this.name = this.name2;
                            this.classList.remove('unseen2');
                            break;
                        case 2:
                            if (log !== false) {
                                if (this.name2) game.log(this, '', '#b' + this.name1, '', '#b' + this.name2);
                                else game.log(this, '', '#b' + this.name1);
                            }
                            this.name = this.name1;
                            var skills = (lib.character[this.name][3] || []);
                            if (this.name2) skills = skills.concat(lib.character[this.name2][3] || []);
                            this.sex = lib.character[this.name][0];
                            if (this.group == 'unknown') this.group = lib.character[this.name][1];
                            this.classList.remove('unseen');
                            this.classList.remove('unseen2');
                            break;
                    }
                    if (!this.isUnseen(2)) {
                        delete this.storage.nohp;
                        this.hp = this.storage.rawHp + this.maxHp - 1;
                        this.maxHp = this.storage.rawMaxHp + this.maxHp - 1;
                        this.node.hp.show();
                        this.update();
                    }
                    game.broadcast(function (player, name, sex, num, group) {
                        player.group = group;
                        player.name = name;
                        player.sex = sex;
                        switch (num) {
                            case 0: player.classList.remove('unseen'); break;
                            case 1: player.classList.remove('unseen2'); break;
                            case 2: player.classList.remove('unseen'); player.classList.remove('unseen2'); break;
                        }
                        if (!player.isUnseen(2)) {
                            delete player.storage.nohp;
                            player.node.hp.show();
                            player.update();
                        }
                    }, this, this.name, this.sex, num, this.group);
                    for (var i = 0; i &lt; skills.length; i++) {
                        if (this.hiddenSkills.contains(skills[i])) {
                            this.hiddenSkills.remove(skills[i]);
                            this.addSkill(skills[i]);
                        }
                    }
                    this.checkConflict();
                },
                /**
                 * 
                 * `num`
                 * @param {number} num
                 * @returns {GameCores.Bases.Event}
                 */
                chooseToGuanxing: function (num) {
                    var next = game.createEvent('chooseToGuanxing');
                    next.num = num || 1;
                    next.player = this;
                    next.setContent('chooseToGuanxing');
                    return next;
                },
                /**
                 * ()
                 * @param {!GameCores.GameObjects.Player} 
                 * @param {!string} emotion 
                 */
                $throwEmotion: function (target, name) {
                    game.addVideo('throwEmotion', this, [target.dataset.position, name]);
                    var getLeft = function (player) {
                        if (player == game.me &amp;&amp; !ui.fakeme &amp;&amp; !ui.chess) return player.getLeft() + player.node.avatar.offsetWidth / 2;
                        return player.getLeft() + player.offsetWidth / 2;
                    }
                    var player = this;
                    var emotion = ui.create.div('', '&lt;div style="text-align:center"> &lt;img src="' + lib.assetURL + 'image/emotion/throw_emotion/' + name + '1.png"> &lt;/div>', game.chess ? ui.chess : ui.window);
                    emotion.style.width = '60px';
                    emotion.style.height = '60px';
                    var width = emotion.offsetWidth / 2;
                    var height = emotion.offsetHeight / 2;
                    if (game.chess) width += 60;
                    var left = getLeft(player) - width;
                    var top = player.getTop() + player.offsetHeight / 3 - height;
                    emotion.style.left = left + 'px';
                    emotion.style.top = top + 'px';
                    var left2 = getLeft(target) - width;
                    var top2 = target.getTop() + target.offsetHeight / 3 - height;
                    emotion.style['z-index'] = 10;
                    emotion.style.transform = 'translateY(' + (top2 - top) + 'px) translateX(' + (left2 - left) + 'px)';
                    if (lib.config.background_audio) game.playAudio('effect', 'throw_' + name + get.rand(1, 2));
                    setTimeout(function () {
                        emotion.innerHTML = ('&lt;div style="text-align:center"> &lt;img src="' + lib.assetURL + 'image/emotion/throw_emotion/' + name + '2.png"> &lt;/div>');
                        setTimeout(function () {
                            emotion.delete();
                        }, 1200);
                    }, 600);
                },
                /**
                 * [support online]
                 * @param {string} name 
                 * @param {string} popname `popname``name``get.skillTranslation(name, this)`
                 * @param {?boolean} [checkShow]
                 */
                trySkillAnimate: function (name, popname, checkShow) {
                    if (!game.online &amp;&amp; lib.config.skill_animation_type != 'off' &amp;&amp; lib.skill[name] &amp;&amp; lib.skill[name].skillAnimation) {
                        if (lib.config.skill_animation_type == 'default') {
                            checkShow = checkShow || 'main';
                        }
                        else {
                            checkShow = false;
                        }
                        if (lib.skill[name].textAnimation) {
                            checkShow = false;
                        }
                        this.$skill(lib.skill[name].animationStr || lib.translate[name], lib.skill[name].skillAnimation, lib.skill[name].animationColor, checkShow);
                        return;
                    }
                    var player = this;
                    game.broadcast(function (player, name, popname) {
                        player.trySkillAnimate(name, popname);
                    }, player, name, popname);
                    if (lib.animate.skill[name]) lib.animate.skill[name].apply(this, arguments);
                    else {
                        if (popname != name) this.popup(popname, 'water', false);
                        else this.popup(get.skillTranslation(name, this), 'water', false);
                    }
                },
                /**
                 * [support online]
                 * @param {!GameCores.GameObjects.Card} card
                 * @param {string} name 
                 * @param {string} nature 
                 * @param {?string} [popname] `name`
                 */
                tryCardAnimate: function (card, name, nature, popname) {
                    var player = this;
                    game.broadcast(function (player, card, name, nature, popname) {
                        player.tryCardAnimate(card, name, nature, popname);
                    }, player, card, name, nature, popname);
                    if (lib.animate.card[card.name]) lib.animate.card[card.name].apply(this, arguments);
                    else {
                        if (!lib.config.show_card_prompt) return;
                        if (get.type(card) == 'equip' &amp;&amp; lib.config.hide_card_prompt_equip) return;
                        if (get.type(card) == 'basic' &amp;&amp; lib.config.hide_card_prompt_basic) return;
                        if (popname) player.popup({ name: card.name, nature: card.nature }, nature, false);
                        else player.popup(name, nature, false);
                    }
                },
                hasUsableCard: function (name) {
                    var player = this;
                    if (player.countCards('hs', name)) return true;
                    var skills = player.getSkills(true).concat(lib.skill.global);
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var ifo = get.info(skills[i]);
                        if (ifo.viewAs &amp;&amp; typeof ifo.viewAs != 'function' &amp;&amp; ifo.viewAs.name == name) {
                            if (!ifo.viewAsFilter || ifo.viewAsFilter(player)) {
                                return true;
                            }
                        }
                        else {
                            var hiddenCard = get.info(skills[i]).hiddenCard;
                            if (typeof hiddenCard == 'function' &amp;&amp; hiddenCard(player, name)) {
                                return true;
                            }
                        }
                    }
                },
                /**
                 * 
                 * @param {string} to 
                 * @returns {!boolean} `true``false`
                 */
                inRange: function (to) {
                    var from = this;
                    if (from == to || from.hasSkill('undist') || to.hasSkill('undist')) return false;
                    if (!game.players.contains(from) &amp;&amp; !game.dead.contains(from)) return false;
                    if (!game.players.contains(to) &amp;&amp; !game.dead.contains(to)) return false;
                    var mod1 = game.checkMod(from, to, 'unchanged', 'inRange', from);
                    if (mod1 != 'unchanged') return mod1;
                    var mod2 = game.checkMod(from, to, 'unchanged', 'inRangeOf', to);
                    if (mod2 != 'unchanged') return mod2;
                    if (from.getAttackRange() &lt; 1) return false;
                    var player = from, m, n = 1, i;
                    var fxy, txy;
                    if (game.chess) {
                        fxy = from.getXY();
                        txy = to.getXY();
                        n = Math.abs(fxy[0] - txy[0]) + Math.abs(fxy[1] - txy[1]);
                    }
                    else if (to.isMin(true) || from.isMin(true)) { }
                    else {
                        var length = game.players.length;
                        var totalPopulation = game.players.length + game.dead.length + 1;
                        for (var iwhile = 0; iwhile &lt; totalPopulation; iwhile++) {
                            if (player.nextSeat != to) {
                                player = player.nextSeat;
                                if (player.isAlive() &amp;&amp; !player.isOut() &amp;&amp; !player.hasSkill('undist') &amp;&amp; !player.isMin(true)) n++;
                            }
                            else {
                                break;
                            }
                        }
                        for (i = 0; i &lt; game.players.length; i++) {
                            if (game.players[i].isOut() || game.players[i].hasSkill('undist') || game.players[i].isMin(true)) length--;
                        }
                        if (from.isDead()) length++;
                        if (to.isDead()) length++;
                        var left = from.hasSkillTag('left_hand');
                        var right = from.hasSkillTag('right_hand');
                        if (left === right) n = Math.min(n, length - n);
                        else if (left == true) n = length - n;
                    }
                    n = game.checkMod(from, to, n, 'globalFrom', from);
                    n = game.checkMod(from, to, n, 'globalTo', to);
                    m = n;
                    m = game.checkMod(from, to, m, 'attackFrom', from);
                    m = game.checkMod(from, to, m, 'attackTo', to);
                    var equips1 = from.getCards('e', function (card) {
                        return !ui.selected.cards || !ui.selected.cards.contains(card);
                    }), equips2 = to.getCards('e', function (card) {
                        return !ui.selected.cards || !ui.selected.cards.contains(card);
                    });
                    for (i = 0; i &lt; equips1.length; i++) {
                        var info = get.info(equips1[i]).distance;
                        if (!info) continue;
                        if (info.globalFrom) {
                            m += info.globalFrom;
                            n += info.globalFrom;
                        }
                        if (info.attackFrom) {
                            m += info.attackFrom;
                        }
                    }
                    for (i = 0; i &lt; equips2.length; i++) {
                        var info = get.info(equips2[i]).distance;
                        if (!info) continue;
                        if (info.globalTo) {
                            m += info.globalTo;
                            n += info.globalTo;
                        }
                        if (info.attaclTo) {
                            m += info.attaclTo;
                        }
                    }
                    return m &lt;= 1;
                },
                /**
                 * 
                 * @param {string} source 
                 * @returns {!boolean} `true``false`
                 */
                inRangeOf: function (source) {
                    return source.inRange(this);
                },
                /**
                 * 
                 * @returns {!number} this.maxHp - Math.max(0, this.hp)
                 */
                getDamagedHp: function () {
                    return this.maxHp - Math.max(0, this.hp);
                },
                changeGroup: function (group, log, broadcast) {
                    var player = this;
                    if (broadcast !== false) {
                        game.broadcast(function (player, group) {
                            player.group = group;
                            player.node.name.dataset.nature = get.groupnature(group);
                        }, player, group);
                    }
                    player.group = group;
                    player.node.name.dataset.nature = get.groupnature(group);
                    if (log !== false) game.log(this, '', '#y' + get.translation(group + 2));
                },
                chooseToDuiben: function (target) {
                    var next = game.createEvent('chooseToDuiben');
                    next.player = this;
                    next.target = target;
                    next.setContent('chooseToDuiben');
                    return next;
                },
                chooseToPSS: function (target) {
                    var next = game.createEvent('chooseToPSS');
                    next.player = this;
                    next.target = target;
                    next.setContent('chooseToPSS');
                    return next;
                },
                chooseToEnable: function () {
                    var next = game.createEvent('chooseToEnable');
                    next.player = this;
                    next.setContent('chooseToEnable');
                    return next;
                },
                chooseToDisable: function (horse) {
                    var next = game.createEvent('chooseToDisable');
                    next.player = this;
                    if (horse) next.horse = true;
                    next.setContent('chooseToDisable');
                    return next;
                },
                countDisabled: function () {
                    if (!this.storage.disableEquip) return 0;
                    return this.storage.disableEquip.length;
                },
                isPhaseUsing: function (notmeisok) {
                    if (!notmeisok &amp;&amp; _status.currentPhase != this) return false;
                    return _status.event.name == 'phaseUse' || _status.event.getParent('phaseUse').name == 'phaseUse';
                },
                swapEquip: function (target, subtype) {
                    var next = game.createEvent('swapEquip');
                    next.player = this;
                    next.target = target;
                    next.subtype = subtype;
                    next.setContent('swapEquip');
                    return next;
                },
                canCompare: function (target) {
                    if (this == target) return false;
                    if (!this.countCards('h') || !target.countCards('h')) return false;
                    if (this.hasSkillTag('noCompareSource') || target.hasSkillTag('noCompareTarget')) return false;
                    return true;
                },
                disableEquip: function (pos) {
                    if (typeof pos == 'number') pos = 'equip' + pos;
                    var next = game.createEvent('disableEquip');
                    next.player = this;
                    next.pos = pos;
                    next.source = _status.event.player;
                    next.setContent('disableEquip');
                    return next;
                },
                $disableEquip: function (skill) {
                    game.broadcast(function (player, skill) {
                        player.$disableEquip(skill);
                    }, this, skill);
                    var player = this;
                    if (!player.storage.disableEquip) player.storage.disableEquip = [];
                    player.storage.disableEquip.add(skill);
                    player.storage.disableEquip.sort();
                    var pos = { equip1: '', equip2: '', equip3: '+1', equip4: '-1', equip5: '' }[skill];
                    if (!pos) return;
                    var card = game.createCard('feichu_' + skill, pos, '');
                    card.fix();
                    card.style.transform = '';
                    card.classList.remove('drawinghidden');
                    card.classList.add('feichu');
                    delete card._transform;
                    var equipNum = get.equipNum(card);
                    var equipped = false;
                    for (var i = 0; i &lt; player.node.equips.childNodes.length; i++) {
                        if (get.equipNum(player.node.equips.childNodes[i]) >= equipNum) {
                            player.node.equips.insertBefore(card, player.node.equips.childNodes[i]);
                            equipped = true;
                            break;
                        }
                    }
                    if (!equipped) {
                        player.node.equips.appendChild(card);
                        if (_status.discarded) {
                            _status.discarded.remove(card);
                        }
                    }
                    return player;
                },
                enableEquip: function (pos) {
                    if (typeof pos == 'number') pos = 'equip' + pos;
                    var next = game.createEvent('enableEquip');
                    next.player = this;
                    next.pos = pos;
                    next.source = _status.event.player;
                    next.setContent('enableEquip');
                    return next;
                },
                $enableEquip: function (skill) {
                    game.broadcast(function (player, skill) {
                        player.$enableEquip(skill);
                    }, this, skill);
                    var player = this;
                    if (player.storage.disableEquip) player.storage.disableEquip.remove(skill);
                    for (var i = 0; i &lt; player.node.equips.childNodes.length; i++) {
                        if (player.node.equips.childNodes[i].name == 'feichu_' + skill) {
                            player.node.equips.removeChild(player.node.equips.childNodes[i]);
                            break;
                        }
                    }
                    return player;
                },
                isDisabled: function (arg) {
                    if (typeof arg == 'number') arg = 'equip' + arg;
                    if (arg == 'equip6' &amp;&amp; this.storage.disableEquip &amp;&amp; (this.storage.disableEquip.contains('equip3') || this.storage.disableEquip.contains('equip4'))) return true;
                    if (this.storage.disableEquip &amp;&amp; this.storage.disableEquip.contains(arg)) return true;
                    return false;
                },
                isEmpty: function (num) {
                    if (num == 6 || num == 'equip6') {
                        if (!this.isEmpty(3) || !this.isEmpty(4)) return false;
                    }
                    else if ([3, 4, 'equip3', 'equip4'].contains(num)) {
                        if (this.getEquip(6)) return false;
                    }
                    return !this.isDisabled(num) &amp;&amp; !this.getEquip(num);
                },
                $disableJudge: function () {
                    var player = this;
                    var card = game.createCard('disable_judge', '', '');
                    player.storage._disableJudge = true;
                    card.fix();
                    card.classList.add('feichu');
                    card.style.transform = '';
                    card.classList.add('drawinghidden');
                    player.node.judges.insertBefore(card, player.node.judges.firstChild);
                    ui.updatej(player);
                },
                $enableJudge: function () {
                    var player = this;
                    player.storage._disableJudge = false;
                    for (var i = 0; i &lt; player.node.judges.childNodes.length; i++) {
                        if (player.node.judges.childNodes[i].name == 'disable_judge') {
                            player.node.judges.removeChild(player.node.judges.childNodes[i]);
                            break;
                        }
                    }
                },
                disableJudge: function () {
                    var next = game.createEvent('disableJudge');
                    next.player = this;
                    next.source = _status.event.player;
                    next.setContent('disableJudge');
                    return next;
                },
                enableJudge: function () {
                    var next = game.createEvent('enableJudge');
                    next.player = this;
                    next.source = _status.event.player;
                    next.setContent('enableJudge');
                    return next;
                },
                //
                /**
                 * 
                 * @param {?string} character undefined
                 * @param {(string|false)} character2 false
                 * @param {!boolean} skill truefalse`character2`false
                 * @returns {GameCores.GameObjects.Card} 
                 */
                init: function (character, character2, skill) {
                    if (typeof character == 'string' &amp;&amp; !lib.character[character]) {
                        lib.character[character] = get.character(character);
                    }
                    if (typeof character2 == 'string' &amp;&amp; !lib.character[character2]) {
                        lib.character[character2] = get.character(character2);
                    }
                    if (!lib.character[character]) return;
                    if (get.is.jun(character2)) {
                        var tmp = character;
                        character = character2;
                        character2 = tmp;
                    }
                    if (character2 == false) {
                        skill = false;
                        character2 = null;
                    }
                    var info = lib.character[character];
                    if (!info) {
                        info = ['', '', 1, [], []];
                    }
                    if (!info[4]) {
                        info[4] = [];
                    }
                    var skills = info[3].slice(0);
                    this.clearSkills(true);
                    this.classList.add('fullskin');
                    if (!game.minskin &amp;&amp; get.is.newLayout() &amp;&amp; !info[4].contains('minskin')) {
                        this.classList.remove('minskin');
                        this.node.avatar.setBackground(character, 'character');
                    }
                    else {
                        this.node.avatar.setBackground(character, 'character');
                        if (info[4].contains('minskin')) {
                            this.classList.add('minskin');
                        }
                        else if (game.minskin) {
                            this.classList.add('minskin');
                        }
                        else {
                            this.classList.remove('minskin');
                        }
                    }

                    var hp1 = get.infoHp(info[2]);
                    var maxHp1 = get.infoMaxHp(info[2]);

                    this.node.avatar.show();
                    this.node.count.show();
                    this.node.equips.show();
                    this.name = character;
                    this.name1 = character;
                    this.sex = info[0];
                    this.group = info[1];
                    this.hp = hp1;
                    this.maxHp = maxHp1;
                    this.hujia = 0;
                    this.node.intro.innerHTML = lib.config.intro;
                    this.node.name.dataset.nature = get.groupnature(this.group);
                    lib.setIntro(this);
                    this.node.name.innerHTML = get[get.slimName2?'slimName2':'slimName'](character);
                    if (this.classList.contains('minskin') &amp;&amp; this.node.name.querySelectorAll('br').length >= 4) {
                        this.node.name.classList.add('long');
                    }
                    if (info[4].contains('hiddenSkill') &amp;&amp; !this.noclick) {
                        if (!this.hiddenSkills) this.hiddenSkills = [];
                        this.hiddenSkills.addArray(skills);
                        skills = [];
                        this.classList.add(_status.video ? 'unseen_v' : 'unseen');
                        this.name = 'unknown';
                        if (!this.node.name_seat &amp;&amp; !_status.video) {
                            this.node.name_seat = ui.create.div('.name.name_seat', get.verticalStr(get.translation(this.name)), this);
                            this.node.name_seat.dataset.nature = get.groupnature(this.group);
                        }
                        this.sex = 'male';
                        //this.group='unknown';
                        this.storage.nohp = true;
                        skills.add('g_hidden_ai');
                    }
                    if (character2 &amp;&amp; lib.character[character2]) {
                        var info2 = lib.character[character2];
                        if (!info2) {
                            info2 = ['', '', 1, [], []];
                        }
                        if (!info2[4]) {
                            info2[4] = [];
                        }
                        this.classList.add('fullskin2');
                        this.node.avatar2.setBackground(character2, 'character');

                        this.node.avatar2.show();
                        this.name2 = character2;
                        var hp2 = get.infoHp(info2[2]);
                        var maxHp2 = get.infoMaxHp(info2[2]);
                        var double_hp;
                        if (_status.connectMode || get.mode() == 'single') {
                            double_hp = 'pingjun';
                        }
                        else {
                            double_hp = get.config('double_hp');
                        }
                        switch (double_hp) {
                            case 'pingjun': {
                                this.maxHp = Math.floor((maxHp1 + maxHp2) / 2);
                                this.hp = Math.floor((hp1 + hp2) / 2);
                                this.singleHp = ((maxHp1 + maxHp2) % 2 === 1);
                                break;
                            }
                            case 'zuidazhi': {
                                this.maxHp = Math.max(maxHp1, maxHp2);
                                this.hp = Math.max(hp1, hp2);
                                break;
                            }
                            case 'zuixiaozhi': {
                                this.maxHp = Math.min(maxHp1, maxHp2);
                                this.hp = Math.min(hp1, hp2);
                                break;
                            }
                            case 'zonghe': {
                                this.maxHp = maxHp1 + maxHp2;
                                this.hp = hp1 + hp2;
                                break;
                            }
                            default: {
                                this.maxHp = maxHp1 + maxHp2 - 3;
                                this.hp = hp1 + hp2 - 3;
                            };
                        }
                        this.node.count.classList.add('p2');
                        if (info2[4].contains('hiddenSkill') &amp;&amp; !this.noclick) {
                            if (!this.hiddenSkills) this.hiddenSkills = [];
                            this.hiddenSkills.addArray(info2[3]);
                            this.classList.add(_status.video ? 'unseen2_v' : 'unseen2');
                            this.storage.nohp = true;
                            skills.add('g_hidden_ai');
                        }
                        else skills = skills.concat(info2[3]);

                        this.node.name2.innerHTML = get.slimName(character2);
                    }
                    if (this.storage.nohp) {
                        this.storage.rawHp = this.hp;
                        this.storage.rawMaxHp = this.maxHp;
                        this.hp = 1;
                        this.maxHp = 1;
                        this.node.hp.hide();
                    }
                    if (skill != false) {
                        for (var i = 0; i &lt; skills.length; i++) {
                            this.addSkill(skills[i]);
                        }
                        this.checkConflict();
                    }
                    lib.group.add(this.group);
                    if (this.inits) {
                        for (var i = 0; i &lt; lib.element.player.inits.length; i++) {
                            lib.element.player.inits[i](this);
                        }
                    }
                    if (this._inits) {
                        for (var i = 0; i &lt; this._inits.length; i++) {
                            this._inits[i](this);
                        }
                    }
                    this.update();
                    return this;
                },
                /**
                 * [support online]
                 * @param {string} name 
                 * @param {string} character 
                 */
                initOL: function (name, character) {
                    this.node.avatar.setBackground(character, 'character');
                    this.node.avatar.show();
                    this.node.name.innerHTML = get.verticalStr(name);
                    this.nickname = name;
                    this.avatar = character;
                    this.node.nameol.innerHTML = '';
                    if (lib.character[character]) this.sex = lib.character[character][0];
                },
                /**
                 * [support online]
                 */
                uninitOL: function () {
                    this.node.avatar.hide();
                    this.node.name.innerHTML = '';
                    this.node.identity.firstChild.innerHTML = '';
                    delete this.nickname;
                    delete this.avatar;
                    delete this.sex;
                },
                /**
                 * 
                 * @returns {GameCores.GameObjects.Player} this self
                 * @param {Array} info 
                 */
                initRoom: function (info, info2) {
                    var str = '';
                    this.serving = false;
                    if (!info || info == 'server') {
                        this.roomempty = true;
                        str = '';
                        this.roomfull = false;
                        this.roomgaming = false;
                        this.version = null;
                        if (info == 'server') {
                            this.serving = true;
                        }
                    }
                    else {
                        var config = info[2];
                        this.key = info[4];
                        this.roomempty = false;
                        str += get.modetrans(config);
                        str += ' ';
                        for (var i = str.length; i &lt; 11; i++) str += '';
                        this.version = config.version;
                        if (config.gameStarted) {
                            str += '&lt;span class="firetext">&lt;/span>';
                            if (config.observe &amp;&amp; config.observeReady &amp;&amp; this.version == lib.versionOL) {
                                this.classList.remove('exclude');
                            }
                            else {
                                this.classList.add('exclude');
                            }
                        }
                        else {
                            str += '&lt;span class="greentext">&lt;/span>';
                            if (this.version != lib.versionOL) {
                                this.classList.add('exclude');
                            }
                            else {
                                this.classList.remove('exclude');
                            }
                        }
                        this.maxHp = parseInt(config.number);
                        this.hp = Math.min(this.maxHp, info[3]);
                        if (this.hp &lt; this.maxHp || config.gameStarted) str += ('' + this.hp + '/' + this.maxHp);
                        else str += ('&lt;span class="firetext">' + this.hp + '/' + this.maxHp + '&lt;/span>');

                        str += ('(' + info[0].slice(0, 12) + ' )');
                        this.config = config;
                        if (this.hp == this.maxHp &amp;&amp; !config.gameStarted) {
                            this.roomfull = true;
                        }
                        else {
                            this.roomfull = false;
                        }
                        if (config.gameStarted &amp;&amp; (!config.observe || !config.observeReady)) {
                            this.roomgaming = true;
                        }
                        else {
                            this.roomgaming = false;
                        }
                    }
                    this.firstChild.innerHTML = str;
                    return this;
                },
                /**
                 * TODO - 
                 * @param {*} from
                 * @param {*} to
                 * @param {*} maxHp
                 * @param {*} online
                 * @returns {(undefined|GameCores.GameObjects.Player)}
                 */
                reinit: function (from, to, maxHp, online) {
                    var info1 = lib.character[from];
                    var info2 = lib.character[to];
                    var smooth = true;
                    if (maxHp == 'nosmooth') {
                        smooth = false;
                        maxHp = null;
                    }
                    if (this.name2 == from) {
                        this.name2 = to;
                        if (this.isUnseen(0) &amp;&amp; !this.isUnseen(1)) {
                            this.sex = info2[0];
                            this.name = to;
                        }
                        if (smooth) this.smoothAvatar(true);
                        this.node.avatar2.setBackground(to, 'character');
                        this.node.name2.innerHTML = get.slimName(to);
                    }
                    else if (this.name == from || this.name1 == from) {
                        if (this.name1 == from) {
                            this.name1 = to;
                        }
                        if (!this.classList.contains('unseen2')) {
                            this.name = to;
                            this.sex = info2[0];
                        }
                        if (smooth) this.smoothAvatar(false);
                        this.node.avatar.setBackground(to, 'character');
                        this.node.name.innerHTML = get.slimName(to);

                        if (this == game.me &amp;&amp; ui.fakeme) {
                            ui.fakeme.style.backgroundImage = this.node.avatar.style.backgroundImage;
                        }
                    }
                    else {
                        return this;
                    }
                    if (online) {
                        return;
                    }
                    for (var i = 0; i &lt; info1[3].length; i++) {
                        this.removeSkill(info1[3][i]);
                    }
                    for (var i = 0; i &lt; info2[3].length; i++) {
                        this.addSkill(info2[3][i]);
                    }
                    if (Array.isArray(maxHp)) {
                        this.maxHp = maxHp[1];
                        this.hp = maxHp[0];
                    }
                    else {
                        var num;
                        if (maxHp === false) {
                            num = 0;
                        }
                        else {
                            if (typeof maxHp != 'number') {
                                maxHp = get.infoMaxHp(info2[2]);
                            }
                            num = maxHp - get.infoMaxHp(info1[2]);
                        }
                        if (typeof this.singleHp == 'boolean') {
                            if (num % 2 != 0) {
                                if (this.singleHp) {
                                    this.maxHp += (num + 1) / 2;
                                    this.singleHp = false;
                                }
                                else {
                                    this.maxHp += (num - 1) / 2;
                                    this.singleHp = true;
                                    if (!game.online) {
                                        this.doubleDraw();
                                    }
                                }
                            }
                            else {
                                this.maxHp += num / 2;
                            }
                        }
                        else {
                            this.maxHp += num;
                        }
                    }
                    game.broadcast(function (player, from, to, skills) {
                        player.reinit(from, to, null, true);
                        player.applySkills(skills);
                    }, this, from, to, get.skillState(this));
                    game.addVideo('reinit3', this, {
                        from: from,
                        to: to,
                        hp: this.maxHp,
                        avatar2: this.name2 == to
                    });
                    this.update();
                },
                /**
                 * 
                 * @returns {!GameCores.GameObjects.Player} this self
                 */
                uninit: function () {
                    for (var i = 1; i &lt; 6; i++) {
                        if (this.isDisabled(i)) this.$enableEquip('equip' + i);
                    }
                    if (this.storage._disableJudge) {
                        game.broadcastAll(function (player) {
                            player.storage._disableJudge = false;
                            for (var i = 0; i &lt; player.node.judges.childNodes.length; i++) {
                                if (player.node.judges.childNodes[i].name == 'disable_judge') {
                                    player.node.judges.removeChild(player.node.judges.childNodes[i]);
                                    break;
                                }
                            }
                        }, this);
                    }
                    this.node.avatar.hide();
                    this.node.count.hide();
                    if (this.node.wuxing) {
                        this.node.wuxing.hide();
                    }
                    if (this.node.name_seat) {
                        this.node.name_seat.remove();
                        delete this.node.name_seat;
                    }
                    if (this.storage.nohp) this.node.hp.show();
                    this.classList.remove('unseen');
                    this.classList.remove('unseen2');
                    delete this.name;
                    delete this.name1;
                    delete this.sex;
                    delete this.group;
                    delete this.hp;
                    delete this.maxHp;
                    delete this.hujia;
                    this.clearSkills(true);
                    this.node.identity.style.backgroundColor = '';
                    this.node.intro.innerHTML = '';
                    this.node.name.innerHTML = '';
                    this.node.hp.innerHTML = '';
                    this.node.count.innerHTML = '0';
                    if (this.name2) {
                        delete this.singleHp;
                        this.node.avatar2.hide();
                        this.node.name2.innerHTML = '';
                        this.classList.remove('fullskin2')
                        delete this.name2;
                        this.node.count.classList.remove('p2');
                    }
                    for (var mark in this.marks) {
                        this.marks[mark].remove();
                    }
                    ui.updatem(this);

                    this.skipList = [];
                    this.skills = this.skills.contains('cangji_yozuru') ? ['cangji_yozuru'] : [];
                    this.initedSkills = [];
                    this.additionalSkills = {};
                    this.disabledSkills = {};
                    this.hiddenSkills = [];
                    this.awakenedSkills = [];
                    this.forbiddenSkills = {};
                    this.phaseNumber = 0;
                    this.stat = [{ card: {}, skill: {} }];
                    this.tempSkills = {};
                    this.storage = {};
                    this.marks = {};
                    this.ai = { friend: [], enemy: [], neutral: [] };

                    return this;
                },
                /**
                 * `this.offsetLeft`
                 * @returns {!number}
                 */
                getLeft: function () {
                    return this.offsetLeft;
                },
                /**
                 * `this.offsetTop`
                 * @returns {!number}
                 */
                getTop: function () {
                    return this.offsetTop;
                },
                /**
                 * @param {?boolean} [vice] truefalse()
                 * @param {?boolean} [video] truefalse
                 */
                smoothAvatar: function (vice, video) {
                    var div = ui.create.div('.fullsize');
                    if (vice) {
                        div.style.background = getComputedStyle(this.node.avatar2).background;
                        this.node.avatar2.appendChild(div);
                    }
                    else {
                        div.style.background = getComputedStyle(this.node.avatar).background;
                        this.node.avatar.appendChild(div);
                    }
                    ui.refresh(div);
                    div.style.transition = 'all 1s';
                    setTimeout(function () {
                        div.classList.add('removing');
                        setTimeout(function () {
                            div.remove();
                        }, 2000);
                    }, 100);
                    if (video != false) {
                        game.addVideo('smoothAvatar', this, vice);
                    }
                },
                /**
                 * 
                 * @param {number} position
                 * @param {boolean} [video] truefalse
                 */
                changeSeat: function (position, video) {
                    var player = this;
                    if (video !== false) game.addVideo('changeSeat', player, position);
                    var rect1 = player.getBoundingClientRect();
                    player.style.transition = 'all 0s';
                    ui.refresh(player);
                    player.dataset.position = position;
                    var rect2 = player.getBoundingClientRect();
                    var dx = rect1.left - rect2.left;
                    var dy = rect1.top - rect2.top;
                    if ((game.chess || (player.dataset.position != 0 &amp;&amp; position != 0)) &amp;&amp; player.classList.contains('linked')) {
                        player.style.transform = 'rotate(-90deg) translate(' + (-dy) + 'px,' + (dx) + 'px)';
                    }
                    else {
                        player.style.transform = 'translate(' + (dx) + 'px,' + (dy) + 'px)';
                    }
                    setTimeout(function () {
                        player.style.transition = '';
                        ui.refresh(player);
                        player.style.transform = '';
                    }, 100);
                },
                /**
                 * ()
                 * @returns {!GameCores.GameObjects.Player} this self
                 */
                send: function () {
                    if (!this.ws || this.ws.closed) return this;
                    this.ws.send.apply(this.ws, arguments);
                    return this;
                },
                /**
                 * IDID(|)
                 * @returns {!GameCores.GameObjects.Player} this self
                 */
                getId: function () {
                    if (_status.video || _status.connectMode) return this;
                    if (this.playerid) {
                        delete game.playerMap[this.playerid];
                    }
                    this.playerid = get.id();
                    game.playerMap[this.playerid] = this;
                    return this;
                },
                /**
                 * [support online]
                 * @param {!GameCores.GameObjects.Player} 
                 * @param {!string} emotion 
                 */
                throwEmotion: function (target, emotion) {
                    game.broadcastAll(function (player, target, emotion) {
                        player.$throwEmotion(target, emotion);
                    }, this, target, emotion);
                },
                /**
                 * 
                 * @param {string} emotionPack 
                 * @param {number} emotionID ID
                 */
                emotion: function (pack, id) {
                    var str = '&lt;img src="##assetURL##image/emotion/' + pack + '/' + id + '.gif" width="50" height="50">';
                    lib.element.player.say.call(this, str);
                    game.broadcast(function (id, str) {
                        if (lib.playerOL[id]) {
                            lib.playerOL[id].say(str);
                        }
                        else if (game.connectPlayers) {
                            for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                if (game.connectPlayers[i].playerid == id) {
                                    lib.element.player.say.call(game.connectPlayers[i], str);
                                    return;
                                }
                            }
                        }
                    }, this.playerid, str);
                },
                /**
                 * [support online]
                 * @param {!string} str 
                 */
                chat: function (str) {
                    if (get.is.banWords(str)) return;
                    lib.element.player.say.call(this, str);
                    game.broadcast(function (id, str) {
                        if (lib.playerOL[id]) {
                            lib.playerOL[id].say(str);
                        }
                        else if (game.connectPlayers) {
                            for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                if (game.connectPlayers[i].playerid == id) {
                                    lib.element.player.say.call(game.connectPlayers[i], str);
                                    return;
                                }
                            }
                        }
                    }, this.playerid, str);
                },
                /**
                 * ()
                 * @param {!string} str 
                 */
                say: function (str) {
                    str = str.replace(/##assetURL##/g, lib.assetURL);
                    var dialog = ui.create.dialog('hidden');
                    dialog.classList.add('static');
                    dialog.add('&lt;div class="text" style="word-break:break-all;display:inline">' + str + '&lt;/div>');
                    dialog.classList.add('popped');
                    ui.window.appendChild(dialog);
                    var width = dialog.content.firstChild.firstChild.offsetWidth;
                    if (width &lt; 190) {
                        dialog._mod_height = -16;
                    }
                    else {
                        dialog.content.firstChild.style.textAlign = 'left';
                    }
                    dialog.style.width = (width + 16) + 'px';
                    var refnode;
                    if (this.node &amp;&amp; this.node.avatar &amp;&amp; this.parentNode == ui.arena) {
                        refnode = this.node.avatar;
                    }
                    if (refnode) {
                        lib.placePoppedDialog(dialog, {
                            clientX: (ui.arena.offsetLeft + this.getLeft() + refnode.offsetLeft + refnode.offsetWidth / 2) * game.documentZoom,
                            clientY: (ui.arena.offsetTop + this.getTop() + refnode.offsetTop + refnode.offsetHeight / 4) * game.documentZoom
                        });
                    }
                    else {
                        lib.placePoppedDialog(dialog, {
                            clientX: (this.getLeft() + this.offsetWidth / 2) * game.documentZoom,
                            clientY: (this.getTop() + this.offsetHeight / 4) * game.documentZoom
                        });
                    }
                    if (dialog._mod_height) {
                        dialog.content.firstChild.style.padding = 0;
                    }
                    setTimeout(function () {
                        dialog.delete();
                    }, lib.quickVoice.indexOf(str) != -1 ? 3800 : 2000);
                    var name = get.translation(this.name);
                    var info = [name ? (name + '[' + this.nickname + ']') : this.nickname, str];
                    lib.chatHistory.push(info);
                    if (_status.addChatEntry) {
                        if (_status.addChatEntry._origin.parentNode) {
                            _status.addChatEntry(info, false);
                        }
                        else {
                            delete _status.addChatEntry;
                        }
                    }
                    if (lib.config.background_speak &amp;&amp; lib.quickVoice.indexOf(str) != -1) {
                        game.playAudio('voice', (this.sex == 'female' ? 'female' : 'male'), lib.quickVoice.indexOf(str));
                    }
                },
                /**
                 * 
                 */
                showGiveup: function () {
                    this._giveUp = true;
                    if (this == game.me) {
                        ui.create.giveup();
                    }
                    else if (this.isOnline2()) {
                        this.send(ui.create.giveup);
                    }
                },
                /**
                 * [support online]
                 * @param {Object} skills 
                 * @param {?Array&lt;string>} skills.global 
                 * @param {?Object} skills.skillinfo 
                 * @param {?Object} skills.stat 
                 * @param {?Object} skills."['playerid']" 
                 */
                applySkills: function (skills) {
                    for (var i in skills) {
                        if (i == 'global') {
                            lib.skill.global = skills[i];
                        }
                        else if (i == 'skillinfo') {
                            for (var j in skills[i]) {
                                if (!lib.skill[j]) {
                                    lib.skill[j] = {};
                                }
                                lib.skill[j].chooseButton = skills[i][j];
                            }
                        }
                        else if (i == 'stat') {
                            this.stat = [skills.stat];
                        }
                        else if (lib.playerOL[i]) {
                            for (var j in skills[i]) {
                                lib.playerOL[i][j] = skills[i][j];
                            }
                        }
                    }
                },
                /**
                 * 
                 * @returns {GameCores.GameObjects.Player~State}
                 */
                getState: function () {
                    /**
                     * @name GameCores.GameObjects.Player~State
                     * @property {number} hp 
                     * @property {number} maxHp 
                     * @property {string} nickname 
                     * @property {string} sex 
                     * @property {string} group 
                     * @property {string} name 
                     * @property {string} name1 ()
                     * @property {string} name2 ()
                     * @property {Array&lt;GameCores.GameObjects.Card>} handcards 
                     * @property {Array&lt;string>} gaintag gaintag
                     * @property {Array&lt;GameCores.GameObjects.Card>} equips 
                     * @property {Array&lt;GameCores.GameObjects.Card>} judges 
                     * @property {Array&lt;GameCores.GameObjects.Card>} specials 
                     * @property {Array&lt;string>} disableJudge 
                     * @property {Array&lt;(string|number)>} disableEquip ()
                     * @property {Array&lt;(string|undefined)>} views `views``judges`
                     * @property {number} position ()
                     * @property {number} hujia 
                     * @property {(boolean|undefined)} side `p1.side == p2.side`p1p2()()(vs)undefined
                     * @property {boolean} identityShown 
                     * @property {Array} identityNode [this.node.identity.innerHTML, this.node.identity.dataset.color] 
                     * @property {string} identity 
                     * @property {boolean} dead 
                     * @property {boolean} linked 
                     * @property {boolean} turnedover 
                     * @property {number} phaseNumber 
                     * @property {boolean} unseen
                     * @property {boolean} unseen2 
                     * @property {string} mode 
                     */
                    var state = {
                        hp: this.hp,
                        maxHp: this.maxHp,
                        nickname: this.nickname,
                        sex: this.sex,
                        group: this.group,
                        name: this.name,
                        name1: this.name1,
                        name2: this.name2,
                        handcards: this.getCards('hs'),
                        gaintag: [],
                        equips: this.getCards('e'),
                        judges: this.getCards('j'),
                        specials: this.getCards('s'),
                        disableJudge: this.storage._disableJudge,
                        disableEquip: this.storage.disableEquip,
                        views: [],
                        position: parseInt(this.dataset.position),
                        hujia: this.hujia,
                        side: this.side,
                        identityShown: this.identityShown,
                        identityNode: [this.node.identity.innerHTML, this.node.identity.dataset.color],
                        identity: this.identity,
                        dead: this.isDead(),
                        linked: this.isLinked(),
                        turnedover: this.isTurnedOver(),
                        phaseNumber: this.phaseNumber,
                        unseen: this.isUnseen(0),
                        unseen2: this.isUnseen(1),
                    }
                    for (var i = 0; i &lt; state.judges.length; i++) {
                        state.views[i] = state.judges[i].viewAs;
                    }
                    for (var i = 0; i &lt; state.handcards.length; i++) {
                        state.gaintag[i] = state.handcards[i].gaintag;
                    }
                    if (this.getModeState) {
                        state.mode = this.getModeState();
                    }
                    return state;
                },
                /**
                 * 
                 * @param {string} [str] `this.nickname``this.nickname`
                 * @returns {GameCores.GameObjects.Player} this self
                 */
                setNickname: function (str) {
                    this.node.nameol.innerHTML = (str || this.nickname || '').slice(0, 12);
                    return this;
                },
                /**
                 * [support online]
                 * @param {!string} name 
                 * @param {!string} name2 (){@link HTMLDivElement#setBackground}
                 * @param {?boolean} [video] truefalse
                 * @param {?boolean} [fakeme] true{@link ui.fakeme}false
                 */
                setAvatar: function (name, name2, video, fakeme) {
                    var node;
                    if (this.name2 == name) {
                        node = this.node.avatar2;
                        this.smoothAvatar(true, video);
                    }
                    else if (this.name == name) {
                        node = this.node.avatar;
                        this.smoothAvatar(false, video);
                    }
                    if (node) {
                        node.setBackground(name2, 'character');
                        if (this == game.me &amp;&amp; ui.fakeme &amp;&amp; fakeme !== false) {
                            ui.fakeme.style.backgroundImage = node.style.backgroundImage;
                        }
                        if (video != false) {
                            game.addVideo('setAvatar', this, [name, name2]);
                        }
                    }
                    game.broadcast(function (player, name, name2) {
                        player.setAvatar(name, name2, false);
                    }, this, name, name2);
                },
                /**
                 * 1s
                 * @param {!string} name 
                 * @param {Array&lt;string>} list ()
                 * @see {@link lib.element.player.setAvatar}
                 */
                setAvatarQueue: function (name, list) {
                    var node;
                    var player = this;
                    if (player.name2 == name) {
                        node = player.node.avatar2;
                    }
                    else {
                        node = player.node.avatar;
                    }
                    if (node._avatarqueue) {
                        for (var i = 0; i &lt; list.length; i++) {
                            node._avatarqueue.push(list[i]);
                        }
                    }
                    else {
                        var func = function () {
                            if (node._avatarqueue.length) {
                                player.setAvatar(name, node._avatarqueue.shift(), false, false);
                            }
                            else {
                                clearInterval(node._avatarqueueinterval);
                                delete node._avatarqueue;
                                delete node._avatarqueueinterval;
                                player.setAvatar(name, name, false, false);
                            }
                        };
                        node._avatarqueue = list.slice(0);
                        node._avatarqueueinterval = setInterval(func, 1000);
                        func();
                    }
                    game.addVideo('setAvatarQueue', this, [name, list]);
                },
                /**
                 * 
                 * @param {!string} skill 
                 * @param {!string} name (|)
                 */
                flashAvatar: function (skill, name) {
                    if (lib.skill[name] &amp;&amp; !lib.character[name]) {
                        var stop = false;
                        var list = lib.config.all.characters.slice(0);
                        for (var i in lib.characterPack) {
                            list.add(i);
                        }
                        for (var i = 0; i &lt; list.length; i++) {
                            for (var j in lib.characterPack[list[i]]) {
                                if (lib.characterPack[list[i]][j][3].contains(name)) {
                                    name = j;
                                    stop = true;
                                    break;
                                }
                            }
                            if (stop) {
                                break;
                            }
                        }
                    }
                    if (lib.character[this.name2] &amp;&amp; lib.character[this.name2][3].contains(skill)) {
                        this.setAvatarQueue(this.name2, [name]);
                    }
                    else {
                        this.setAvatarQueue(this.name, [name]);
                    }
                },
                /**
                 * 
                 * @param {!string} buff 
                 * @param {!string} skill 
                 * @param {!string} name (|)
                 */
                buffAvatar: function (buff,skill, name) {
                    if (lib.skill[name] &amp;&amp; !lib.character[name]) {
                        var stop = false;
                        var list = lib.config.all.characters.slice(0);
                        for (var i in lib.characterPack) {
                            list.add(i);
                        }
                        for (var i = 0; i &lt; list.length; i++) {
                            for (var j in lib.characterPack[list[i]]) {
                                if (lib.characterPack[list[i]][j][3].contains(name)) {
                                    name = j;
                                    stop = true;
                                    break;
                                }
                            }
                            if (stop) {
                                break;
                            }
                        }
                    }
                    if (lib.character[this.name2] &amp;&amp; lib.character[this.name2][3].contains(skill)) {
                        this.setAvatarQueue(this.name2, [name]);
                    }
                    else {
                        this.setAvatarQueue(this.name, [name]);
                    }
                },
                /**
                 * ()
                 * @returns {?GameCores.GameObjects.Player} this self(undefined)
                 */
                update: function () {
                    if (_status.video &amp;&amp; arguments.length == 0) return;
                    if (this.hp >= this.maxHp) this.hp = this.maxHp;
                    var hp = this.node.hp;
                    hp.style.transition = 'none';
                    game.broadcast(function (player, hp, maxHp, hujia) {
                        player.hp = hp;
                        player.maxHp = maxHp;
                        player.hujia = hujia;
                        player.update();
                    }, this, this.hp, this.maxHp, this.hujia);
                    if (!_status.video) {
                        if (this.hujia) {
                            this.markSkill('ghujia');
                        }
                        else {
                            this.unmarkSkill('ghujia');
                        }
                    }
                    if (!this.storage.nohp) {
                        var libHp = lib.character[(this.name &amp;&amp; this.name.indexOf('unknown') == 0) ? this.name1 : this.name];
                        if (this.maxHp == Infinity) {
                            hp.innerHTML = '';
                        }
                        else if (libHp &amp;&amp; libHp[2] &amp;&amp; get.infoHp(libHp[2]) &lt; 0) {
                            hp.innerHTML = this.hp + '/' + this.maxHp;
                            hp.classList.add('text');
                        }
                        else if (game.layout == 'default' &amp;&amp; this.maxHp > 14) {
                            hp.innerHTML = this.hp + '/' + this.maxHp;
                            hp.classList.add('text');
                        }
                        else if (get.is.newLayout() &amp;&amp;
                            (
                                this.maxHp > 9 ||
                                (this.maxHp > 5 &amp;&amp; this.classList.contains('minskin')) ||
                                ((game.layout == 'mobile' || game.layout == 'long') &amp;&amp; this.dataset.position == 0 &amp;&amp; this.maxHp > 7)
                            )) {
                            hp.innerHTML = this.hp + '&lt;br>/&lt;br>' + this.maxHp + '&lt;div>&lt;/div>';
                            if (this.hp == 0) {
                                hp.lastChild.classList.add('lost');
                            }
                            hp.classList.add('textstyle');
                            // hp.classList.remove('long');
                        }
                        else {
                            hp.innerHTML = '';
                            hp.classList.remove('text');
                            hp.classList.remove('textstyle');
                            while (this.maxHp > hp.childNodes.length) {
                                ui.create.div(hp);
                            }
                            while (Math.max(0, this.maxHp) &lt; hp.childNodes.length) {
                                hp.removeChild(hp.lastChild);
                            }
                            for (var i = 0; i &lt; this.maxHp; i++) {
                                var index = i;
                                if (get.is.newLayout()) {
                                    index = this.maxHp - i - 1;
                                }
                                if (i &lt; this.hp) {
                                    hp.childNodes[index].classList.remove('lost');
                                }
                                else {
                                    hp.childNodes[index].classList.add('lost');
                                }
                            }
                            // if(this.maxHp==9){
                            //     hp.classList.add('long');
                            // }
                            // else{
                            //     hp.classList.remove('long');
                            // }
                        }
                        if (hp.classList.contains('room')) {
                            hp.dataset.condition = 'high';
                        }
                        else if (this.hp == 0) {
                            hp.dataset.condition = '';
                        }
                        else if (this.hp > Math.round(this.maxHp / 2) || this.hp === this.maxHp) {
                            hp.dataset.condition = 'high';
                        }
                        else if (this.hp > Math.floor(this.maxHp / 3)) {
                            hp.dataset.condition = 'mid';
                        }
                        else {
                            hp.dataset.condition = 'low';
                        }

                        setTimeout(function () {
                            hp.style.transition = '';
                        });
                    }
                    var numh = this.countCards('h');
                    if (_status.video) {
                        numh = arguments[0];
                    }
                    if (numh >= 10) {
                        numh = numh.toString();
                        this.node.count.dataset.condition = 'low';
                        this.node.count.innerHTML = numh[0] + '&lt;br>' + numh[1];
                    }
                    else {
                        if (numh > 5) {
                            this.node.count.dataset.condition = 'higher';
                        }
                        else if (numh > 2) {
                            this.node.count.dataset.condition = 'high';
                        }
                        else if (numh > 0) {
                            this.node.count.dataset.condition = 'mid';
                        }
                        else {
                            this.node.count.dataset.condition = 'none';
                        }
                        this.node.count.innerHTML = numh;
                    }
                    if (this.updates) {
                        for (var i = 0; i &lt; lib.element.player.updates.length; i++) {
                            lib.element.player.updates[i](this);
                        }
                    }
                    if (!_status.video) {
                        game.addVideo('update', this, [this.countCards('h'), this.hp, this.maxHp, this.hujia]);
                    }
                    this.updateMarks();
                    return this;
                },
                /**
                 * (|0)`undefined`
                 * `undefined`
                 * 
                 * @param {!string} i `this.storage[i]`
                 * @param {?number} [num] 0 **1** 
                 * @param {?boolean} [log] truefalse
                 */
                removeMark: function (i, num, log) {
                    if (typeof num != 'number' || !num) num = 1;
                    if (typeof this.storage[i] != 'number' || !this.storage[i]) return;
                    if (num > this.storage[i]) num = this.storage[i];
                    this.storage[i] -= num;
                    if (log !== false) {
                        var str = false;
                        var info = get.info(i);
                        if (info &amp;&amp; info.intro &amp;&amp; (info.intro.name || info.intro.name2)) str = info.intro.name2 || info.intro.name;
                        else str = lib.translate[i];
                        if (str) game.log(this, '', get.cnNumber(num), '', '#g' + str + '');
                    }
                    this.syncStorage(i);
                    this[this.storage[i] ? 'markSkill' : 'unmarkSkill'](i);
                },
                /**
                 * 
                 *  0 
                 * 
                 * @param {!string} i `this.storage[i]`
                 * @param {?number} [num] 0 **1** 
                 * @param {?boolean} [log] truefalse
                 */
                addMark: function (i, num, log) {
                    if (typeof num != 'number' || !num) num = 1;
                    if (typeof this.storage[i] != 'number') this.storage[i] = 0;
                    this.storage[i] += num;
                    if (log !== false) {
                        var str = false;
                        var info = get.info(i);
                        if (info &amp;&amp; info.intro &amp;&amp; (info.intro.name || info.intro.name2)) str = info.intro.name2 || info.intro.name;
                        else str = lib.translate[i];
                        if (str) game.log(this, '', get.cnNumber(num), '', '#g' + str + '');
                    }
                    this.syncStorage(i);
                    this.markSkill(i);
                },
                /**
                 * 
                 * @param {?string} [i] 0
                 * @returns {!number}
                 */
                countMark: function (i) {
                    if (this.storage[i] == undefined) return 0;
                    if (typeof this.storage[i] == 'number') return this.storage[i];
                    if (Array.isArray(this.storage[i])) return this.storage[i].length;
                    return 0;
                },
                /**
                 * 
                 * false
                 * @param {!string} i `this.storage[i]`
                 * @returns {!boolean}
                 */
                hasMark: function (i) {
                    return this.countMark(i) > 0;
                },
                /**
                 * `this`
                 * @param {!string} i 
                 * @param {?boolean} [storage] true()false
                 */
                updateMark: function (i, storage) {
                    if (!this.marks[i]) {
                        if (lib.skill[i] &amp;&amp; lib.skill[i].intro &amp;&amp; (this.storage[i] || lib.skill[i].intro.markcount)) {
                            this.markSkill(i);
                            if (!this.marks[i]) return this;
                        }
                        else {
                            return this;
                        }
                    }
                    if (storage &amp;&amp; this.storage[i]) {
                        this.syncStorage(i);
                    }
                    if (i == 'ghujia' || ((!this.marks[i].querySelector('.image') || this.storage[i + '_markcount']) &amp;&amp;
                        lib.skill[i] &amp;&amp; lib.skill[i].intro &amp;&amp; !lib.skill[i].intro.nocount &amp;&amp;
                        (this.storage[i] || lib.skill[i].intro.markcount))) {
                        this.marks[i].classList.add('overflowmark')
                        var num = 0;
                        if (typeof lib.skill[i].intro.markcount == 'function') {
                            num = lib.skill[i].intro.markcount(this.storage[i], this);
                        }
                        else if (typeof this.storage[i + '_markcount'] == 'number') {
                            num = this.storage[i + '_markcount'];
                        }
                        else if (i == 'ghujia') {
                            num = this.hujia;
                        }
                        else if (typeof this.storage[i] == 'number') {
                            num = this.storage[i];
                        }
                        else if (Array.isArray(this.storage[i])) {
                            num = this.storage[i].length;
                        }
                        if (num) {
                            if (!this.marks[i].markcount) {
                                this.marks[i].markcount = ui.create.div('.markcount.menubutton', this.marks[i]);
                            }
                            this.marks[i].markcount.innerHTML = num;
                        }
                        else if (this.marks[i].markcount) {
                            this.marks[i].markcount.delete();
                            delete this.marks[i].markcount;
                        }
                    }
                    else {
                        if (this.marks[i].markcount) {
                            this.marks[i].markcount.delete();
                            delete this.marks[i].markcount;
                        }
                        if (lib.skill[i].mark == 'auto') {
                            this.unmarkSkill(i);
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @param {?string} [skillname] ()
                 */
                updateMarks: function (connect) {
                    if (typeof connect == 'string' &amp;&amp; _status.connectMode &amp;&amp; !game.online) {
                        game.broadcast(function (player, storage, skill) {
                            player.storage[skill] = storage;
                            player.updateMarks();
                        }, this, this.storage[connect], connect);
                    }
                    for (var i in this.marks) {
                        this.updateMark(i);
                    }
                },
                num: function (arg1, arg2, arg3) {
                    if (get.itemtype(arg1) == 'position') {
                        return this.get(arg1, arg2, arg3).length;
                    }
                    else if (arg1 == 's') {
                        if (typeof arg2 == 'boolean') {
                            return game.expandSkills(this.getSkills(arg2).concat(lib.skill.global)).contains(arg3);
                        }
                        else {
                            return game.expandSkills(this.getSkills().concat(lib.skill.global)).contains(arg2);
                        }
                    }
                },
                line: function (target, config) {
                    if (get.itemtype(target) == 'players') {
                        for (var i = 0; i &lt; target.length; i++) {
                            this.line(target[i], config);
                        }
                    }
                    else if (get.itemtype(target) == 'player') {
                        if (target == this) return;
                        game.broadcast(function (player, target, config) {
                            player.line(target, config);
                        }, this, target, config);
                        game.addVideo('line', this, [target.dataset.position, config]);
                        game.linexy([
                            this.getLeft() + this.offsetWidth / 2,
                            this.getTop() + this.offsetHeight / 2,
                            target.getLeft() + target.offsetWidth / 2,
                            target.getTop() + target.offsetHeight / 2
                        ], config, true);
                    }
                },
                line2: function (targets, config) {
                    this.line(targets[0], config);
                    targets = targets.slice(0);
                    for (var i = 1; i &lt; targets.length; i++) {
                        (function (j) {
                            setTimeout(function () {
                                targets[j - 1].line(targets[j], config);
                            }, lib.config.duration * i);
                        }(i));
                    }
                },
                getNext: function () {
                    if (this.hasSkill('undist')) return null;
                    var target = this;
                    for (var i = 0; i &lt; game.players.length - 1; i++) {
                        target = target.next;
                        if (!target.hasSkill('undist')) {
                            return target;
                        }
                    }
                    return null;
                },
                getPrevious: function () {
                    if (this.hasSkill('undist')) return null;
                    var target = this;
                    for (var i = 0; i &lt; game.players.length - 1; i++) {
                        target = target.previous;
                        if (!target.hasSkill('undist')) {
                            return target;
                        }
                    }
                    return null;
                },
                countUsed: function (card, type) {
                    if (type === true) {
                        var num = 0;
                        var history = this.getHistory('useCard');
                        for (var i = 0; i &lt; history.length; i++) {
                            if (!card) num++;
                            else if (typeof card == 'string' &amp;&amp; history[i].card &amp;&amp; card == history[i].card.name) num++;
                            else if (typeof card == 'object' &amp;&amp; history[i].card &amp;&amp; card.name == history[i].card.name) num++;
                        }
                        return num;
                    }
                    var num;
                    var stat = this.getStat('card');
                    if (!card) {
                        num = 0;
                        for (var i in stat) {
                            if (typeof stat[i] == 'number'){ 
                                console.log(i,stat[i])
                                num += stat[i];}
                        }
                        return num;
                    }
                    if (typeof card == 'object') {
                        card = card.name;
                    }
                    num = stat[card];
                    if (typeof num != 'number') return 0;
                    return num;
                },
                countSkill: function (skill) {
                    var num = this.getStat('skill')[skill];
                    if (num == undefined) return 0;
                    return num;
                },
                getStockSkills: function (unowned, unique, hidden) {
                    var list = [];
                    if (lib.character[this.name] &amp;&amp; (hidden || !this.isUnseen(0))) {
                        list.addArray(lib.character[this.name][3]);
                    }
                    if (lib.character[this.name1] &amp;&amp; (hidden || !this.isUnseen(0))) {
                        list.addArray(lib.character[this.name1][3]);
                    }
                    if (lib.character[this.name2] &amp;&amp; (hidden || !this.isUnseen(1))) {
                        list.addArray(lib.character[this.name2][3]);
                    }
                    if (!unowned) {
                        for (var i = 0; i &lt; list.length; i++) {
                            if (!this.hasSkill(list[i])) {
                                list.splice(i--, 1);
                            }
                        }
                    }
                    if (!unique) {
                        for (var i = 0; i &lt; list.length; i++) {
                            var info = lib.skill[list[i]];
                            if (!info || info.unique || info.temp || info.sub || info.charlotte) {
                                list.splice(i--, 1);
                            }
                        }
                    }
                    return list;
                },
                /**
                 * (|||)
                 * @function lib.element.player.getCards
                 * @param {string} [position='h'] : [hesj]+
                 * @returns {!Array&lt;GameCores.GameObjects.Card>}
                 */
                /**
                 * 
                 * @function lib.element.player.getCards
                 * @variation 2
                 * @param {string} [position='h'] : [hesj]+
                 * @param {!string} [name] 
                 * @returns {!Array&lt;GameCores.GameObjects.Card>}
                 */
                /**
                 * 
                 * @function lib.element.player.getCards
                 * @variation 3
                 * @param {string} [position='h'] : [hesj]+
                 * @param {?Object} [cond] ()
                 * @param {...(Array&lt;(Object|string)>|string)} cond.'[keyname]' `cond[keyname] == card[keyname] || cond[keyname].contains(card[keyname])`
                 * @returns {!Array&lt;GameCores.GameObjects.Card>}
                 */
                /**
                 * getCards
                 * @callback lib.element.player.getCards~filterCard
                 * @param {!GameCores.GameObjects.Card} card 
                 * @returns {?boolean} truefalse
                 * @see {@link lib.element.player.getCards(4)}
                 */
                /**
                 * 
                 * @function lib.element.player.getCards
                 * @variation 4
                 * @param {string} [position='h'] : [hesj]+
                 * @param {?lib.element.player.getCards~filterCard} [filter] 
                 * @returns {!Array&lt;GameCores.GameObjects.Card>}
                 */
                getCards: function (arg1, arg2) {
                    if (typeof arg1 != 'string') {
                        arg1 = 'h';
                    }
                    var cards = [], cards1 = [];
                    var i, j;
                    for (i = 0; i &lt; arg1.length; i++) {
                        if (arg1[i] == 'h') {
                            for (j = 0; j &lt; this.node.handcards1.childElementCount; j++) {
                                if (!this.node.handcards1.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.handcards1.childNodes[j].classList.contains('glows')) {
                                    cards.push(this.node.handcards1.childNodes[j]);
                                }
                            }
                            for (j = 0; j &lt; this.node.handcards2.childElementCount; j++) {
                                if (!this.node.handcards2.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.handcards2.childNodes[j].classList.contains('glows')) {
                                    cards.push(this.node.handcards2.childNodes[j]);
                                }
                            }
                        }
                        else if (arg1[i] == 's') {
                            for (j = 0; j &lt; this.node.handcards1.childElementCount; j++) {
                                if (!this.node.handcards1.childNodes[j].classList.contains('removing') &amp;&amp; this.node.handcards1.childNodes[j].classList.contains('glows')) {
                                    cards.push(this.node.handcards1.childNodes[j]);
                                }
                            }
                            for (j = 0; j &lt; this.node.handcards2.childElementCount; j++) {
                                if (!this.node.handcards2.childNodes[j].classList.contains('removing') &amp;&amp; this.node.handcards2.childNodes[j].classList.contains('glows')) {
                                    cards.push(this.node.handcards2.childNodes[j]);
                                }
                            }
                        }
                        else if (arg1[i] == 'e') {
                            for (j = 0; j &lt; this.node.equips.childElementCount; j++) {
                                if (!this.node.equips.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.equips.childNodes[j].classList.contains('feichu')) {
                                    cards.push(this.node.equips.childNodes[j]);
                                }
                            }
                        }
                        else if (arg1[i] == 'j') {
                            for (j = 0; j &lt; this.node.judges.childElementCount; j++) {
                                if (!this.node.judges.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.judges.childNodes[j].classList.contains('feichu')) {
                                    cards.push(this.node.judges.childNodes[j]);
                                    if (this.node.judges.childNodes[j].viewAs &amp;&amp; arguments.length > 1) {
                                        this.node.judges.childNodes[j].tempJudge = this.node.judges.childNodes[j].name;
                                        this.node.judges.childNodes[j].name = this.node.judges.childNodes[j].viewAs;
                                        cards1.push(this.node.judges.childNodes[j]);
                                    }
                                }
                            }
                        }
                    }
                    if (arguments.length == 1) {
                        return cards;
                    }
                    if (arg2) {
                        for (i = 0; i &lt; cards.length; i++) {
                            if (!get.is.filterCardBy(cards[i], arg2)) {
                                cards.splice(i--, 1);
                            }
                        }
                    }
                    for (i = 0; i &lt; cards1.length; i++) {
                        if (cards1[i].tempJudge) {
                            cards1[i].name = cards1[i].tempJudge;
                            delete cards1[i].tempJudge;
                        }
                    }
                    return cards;
                },
                getDiscardableCards: function (player, arg1, arg2) {
                    var cards = this.getCards(arg1, arg2);
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (!lib.filter.canBeDiscarded(cards[i], player, this)) {
                            cards.splice(i--, 1);
                        }
                    }
                    return cards;
                },
                getGainableCards: function (player, arg1, arg2) {
                    var cards = this.getCards(arg1, arg2);
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (!lib.filter.canBeGained(cards[i], player, this)) {
                            cards.splice(i--, 1);
                        }
                    }
                    return cards;
                },
                getGainableSkills: function (func) {
                    var list = [];
                    var names = [this.name, this.name1, this.name2];
                    for (var i = 0; i &lt; names.length; i++) {
                        list.addArray(get.gainableSkillsName(names[i], func));
                    }
                    return list;
                },
                countCards: function (arg1, arg2) {
                    return this.getCards(arg1, arg2).length;
                },
                countDiscardableCards: function (player, arg1, arg2) {
                    return this.getDiscardableCards(player, arg1, arg2).length;
                },
                countGainableCards: function (player, arg1, arg2) {
                    return this.getGainableCards(player, arg1, arg2).length;
                },
                getOriginalSkills: function () {
                    var skills = [];
                    if (lib.character[this.name] &amp;&amp; !this.isUnseen(0)) {
                        skills.addArray(lib.character[this.name][3]);
                    }
                    if (this.name2 &amp;&amp; lib.character[this.name2] &amp;&amp; !this.isUnseen(1)) {
                        skills.addArray(lib.character[this.name2][3]);
                    }
                    return skills;
                },
                /**
                 * 
                 * 
                 * @param {!string} skill 
                 * @param {*} arg2 'e'
                 * @param {*} arg3 false
                 * @param {*} arg4 false
                 * @returns {!Array&lt;string>}
                 */
                getSkills: function (arg2, arg3, arg4) {
                    var skills = this.skills.slice(0);
                    var es = [];
                    var i, j;
                    if (arg3 !== false) {
                        for (i = 0; i &lt; this.node.equips.childElementCount; i++) {
                            if (!this.node.equips.childNodes[i].classList.contains('removing')) {
                                var equipskills = get.info(this.node.equips.childNodes[i], false).skills;
                                if (equipskills) {
                                    es.addArray(equipskills);
                                }
                            }
                        }
                        if (arg2 == 'e') {
                            return es;
                        }
                    }
                    for (var i in this.additionalSkills) {
                        if (Array.isArray(this.additionalSkills[i]) &amp;&amp; (arg2 || i.indexOf('hidden:') !== 0)) {
                            for (j = 0; j &lt; this.additionalSkills[i].length; j++) {
                                if (this.additionalSkills[i][j]) {
                                    skills.add(this.additionalSkills[i][j]);
                                }
                            }
                        }
                        else if (this.additionalSkills[i] &amp;&amp; typeof this.additionalSkills[i] == 'string') {
                            skills.add(this.additionalSkills[i]);
                        }
                    }
                    for (var i in this.tempSkills) {
                        skills.add(i);
                    }
                    if (arg2) skills.addArray(this.hiddenSkills);
                    if (arg3 !== false) skills.addArray(es);
                    for (var i in this.forbiddenSkills) {
                        skills.remove(i);
                    }
                    if (arg4 !== false) {
                        skills = game.filterSkills(skills, this, es);
                    }
                    return skills;
                },
                /**
                 * (||)
                 * Regex: [hej]|he|hj|ej|hej
                 * @typedef {string} GameCores.PlayerCardPosition
                 * @see {@link GameCores.CardPosition}
                 */
                /**
                 * (|||) TODO
                 * @param {('s'|GameCores.PlayerCardPosition)} position 
                 * @param {*} arg2
                 * @param {*} arg3
                 * @param {*} arg4
                 * @returns {Array&lt;GameCores.GameObjects.Card>}
                 * @see {@link GameCores.PlayerCardPosition}
                 * @example
                 * let cards = player.get('he')//
                 * 
                 * 
                 */
                get: function (arg1, arg2, arg3, arg4) {
                    var i, j;
                    if (arg1 == 's') {
                        var skills = this.skills.slice(0);
                        var es = [];
                        if (arg3 !== false) {
                            for (i = 0; i &lt; this.node.equips.childElementCount; i++) {
                                if (!this.node.equips.childNodes[i].classList.contains('removing') &amp;&amp; !this.node.equips.childNodes[i].classList.contains('feichu')) {
                                    var equipskills = get.info(this.node.equips.childNodes[i]).skills;
                                    if (equipskills) {
                                        es.addArray(equipskills);
                                    }
                                }
                            }
                            if (arg2 == 'e') {
                                return es;
                            }
                        }
                        for (var i in this.additionalSkills) {
                            if (Array.isArray(this.additionalSkills[i])) {
                                for (j = 0; j &lt; this.additionalSkills[i].length; j++) {
                                    if (this.additionalSkills[i][j]) {
                                        skills.add(this.additionalSkills[i][j]);
                                    }
                                }
                            }
                            else if (this.additionalSkills[i] &amp;&amp; typeof this.additionalSkills[i] == 'string') {
                                skills.add(this.additionalSkills[i]);
                            }
                        }
                        for (var i in this.tempSkills) {
                            skills.add(i);
                        }
                        if (arg2) skills.addArray(this.hiddenSkills);
                        if (arg3 !== false) skills.addArray(es);
                        for (var i in this.forbiddenSkills) {
                            skills.remove(i);
                        }
                        if (arg4 !== false) {
                            skills = game.filterSkills(skills, this, es);
                        }
                        return skills;
                    }
                    else if (get.is.pos(arg1)) {
                        var cards = [], cards1 = [];
                        for (i = 0; i &lt; arg1.length; i++) {
                            if (arg1[i] == 'h') {
                                for (j = 0; j &lt; this.node.handcards1.childElementCount; j++) {
                                    if (!this.node.handcards1.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.handcards1.childNodes[j].classList.contains('feichu') &amp;&amp; !this.node.handcards1.childNodes[j].classList.contains('glows')) {
                                        cards.push(this.node.handcards1.childNodes[j]);
                                    }
                                }
                                for (j = 0; j &lt; this.node.handcards2.childElementCount; j++) {
                                    if (!this.node.handcards2.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.handcards2.childNodes[j].classList.contains('feichu') &amp;&amp; !this.node.handcards2.childNodes[j].classList.contains('glows')) {
                                        cards.push(this.node.handcards2.childNodes[j]);
                                    }
                                }
                            }
                            else if (arg1[i] == 'e') {
                                for (j = 0; j &lt; this.node.equips.childElementCount; j++) {
                                    if (!this.node.equips.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.equips.childNodes[j].classList.contains('feichu')) {
                                        cards.push(this.node.equips.childNodes[j]);
                                    }
                                }
                                if (arguments.length == 2 &amp;&amp; typeof arg2 == 'string' &amp;&amp; /1|2|3|4|5/.test(arg2)) {
                                    for (j = 0; j &lt; cards.length; j++) {
                                        if (get.subtype(cards[j]) == 'equip' + arg2) return cards[j];
                                    }
                                    return;
                                }
                            }
                            else if (arg1[i] == 'j') {
                                for (j = 0; j &lt; this.node.judges.childElementCount; j++) {
                                    if (!this.node.judges.childNodes[j].classList.contains('removing') &amp;&amp; !this.node.judges.childNodes[j].classList.contains('feichu')) {
                                        cards.push(this.node.judges.childNodes[j]);
                                        if (this.node.judges.childNodes[j].viewAs &amp;&amp; arguments.length > 1) {
                                            this.node.judges.childNodes[j].tempJudge = this.node.judges.childNodes[j].name;
                                            this.node.judges.childNodes[j].name = this.node.judges.childNodes[j].viewAs;
                                            cards1.push(this.node.judges.childNodes[j]);
                                        }
                                    }
                                }
                            }
                        }
                        if (arguments.length == 1) {
                            return cards;
                        }
                        if (arg2 != undefined) {
                            if (typeof arg3 == 'function') {
                                var cards2 = cards.slice(0);
                                cards.sort(function (a, b) {
                                    return arg3(b, cards2) - arg3(a, cards2);
                                });
                            }
                            if (typeof arg2 == 'string') {
                                for (i = 0; i &lt; cards.length; i++) {
                                    if (cards[i].name != arg2) {
                                        cards.splice(i, 1); i--;
                                    }
                                }
                            }
                            else if (typeof arg2 == 'object') {
                                for (i = 0; i &lt; cards.length; i++) {
                                    for (j in arg2) {
                                        if (j == 'type') {
                                            if (typeof arg2[j] == 'object') {
                                                if (arg2[j].contains(get.type(cards[i])) == false) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                            else if (typeof arg2[j] == 'string') {
                                                if (get.type(cards[i]) != arg2[j]) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                        }
                                        else if (j == 'subtype') {
                                            if (typeof arg2[j] == 'object') {
                                                if (arg2[j].contains(get.subtype(cards[i])) == false) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                            else if (typeof arg2[j] == 'string') {
                                                if (get.subtype(cards[i]) != arg2[j]) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                        }
                                        else if (j == 'color') {
                                            if (typeof arg2[j] == 'object') {
                                                if (arg2[j].contains(get.color(cards[i])) == false) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                            else if (typeof arg2[j] == 'string') {
                                                if (get.color(cards[i]) != arg2[j]) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                        }
                                        else if (j == 'suit') {
                                            if (typeof arg2[j] == 'object') {
                                                if (arg2[j].contains(get.suit(cards[i])) == false) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                            else if (typeof arg2[j] == 'string') {
                                                if (get.suit(cards[i]) != arg2[j]) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                        }
                                        else if (j == 'number') {
                                            if (typeof arg2[j] == 'object') {
                                                if (arg2[j].contains(get.number(cards[i])) == false) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                            else if (typeof arg2[j] == 'string') {
                                                if (get.number(cards[i]) != arg2[j]) {
                                                    cards.splice(i, 1); i--; break;
                                                }
                                            }
                                        }
                                        else if (typeof arg2[j] == 'object') {
                                            if (arg2[j].contains(cards[i][j]) == false) {
                                                cards.splice(i, 1); i--; break;
                                            }
                                        }
                                        else if (typeof arg2[j] == 'string') {
                                            if (cards[i][j] != arg2[j]) {
                                                cards.splice(i, 1); i--; break;
                                            }
                                        }
                                    }
                                }
                            }
                            else if (typeof arg2 == 'number' &amp;&amp; arg2 > 0) {
                                cards.splice(arg2);
                            }
                            else if (typeof arg2 == 'function') {
                                for (i = 0; i &lt; cards.length; i++) {
                                    if (!arg2(cards[i])) {
                                        cards.splice(i, 1); i--;
                                    }
                                }
                            }
                        }
                        for (i = 0; i &lt; cards1.length; i++) {
                            if (cards1[i].tempJudge) {
                                cards1[i].name = cards1[i].tempJudge;
                                delete cards1[i].tempJudge;
                            }
                        }
                        if (arg2 === 0) return cards[0];
                        if (typeof arg3 == 'number') {
                            if (arg3 == 0) return cards[0];
                            cards.splice(arg3);
                        }
                        if (typeof arg4 == 'number') {
                            if (arg4 == 0) return cards[0];
                            cards.splice(arg4);
                        }
                        return cards;
                    }
                },
                /**
                 * ()({@link lib.element.player.updateMarks})
                 * @param {!string} skill 
                 */
                syncStorage: function (skill) {
                    switch (get.itemtype(this.storage[skill])) {
                        case 'cards': game.addVideo('storage', this, [skill, get.cardsInfo(this.storage[skill]), 'cards']); break;
                        case 'card': game.addVideo('storage', this, [skill, get.cardInfo(this.storage[skill]), 'card']); break;
                        default:
                            try {
                                game.addVideo('storage', this, [skill, JSON.parse(JSON.stringify(this.storage[skill]))]);
                            }
                            catch (e) {
                                console.log(this.storage[skill]);
                            }
                    }
                },
                syncSkills: function () {
                    game.broadcast(function (player, skills) {
                        player.applySkills(skills);
                    }, this, get.skillState(this));
                },
                playerfocus: function (time) {
                    time = time || 1000;
                    this.classList.add('playerfocus');
                    ui.arena.classList.add('playerfocus');
                    var that = this;
                    setTimeout(function () {
                        that.classList.remove('playerfocus');
                        ui.arena.classList.remove('playerfocus');
                    }, time);
                    game.addVideo('playerfocus', this, time);
                    game.broadcast(function (player, time) {
                        player.playerfocus(time);
                    }, this, time);
                    return this;
                },
                /**
                 * ()({@link lib.element.player.updateMarks})
                 * @param {!string} skill 
                 */
                setIdentity: function (identity) {
                    if (!identity) identity = this.identity;
                    if (get.is.jun(this)) {
                        this.node.identity.firstChild.innerHTML = '';
                    }
                    else {
                        this.node.identity.firstChild.innerHTML = get.translation(identity);
                    }
                    this.node.identity.dataset.color = identity;
                    return this;
                },
                insertPhase: function (skill, insert) {
                    var evt = _status.event.getParent('phase');
                    var next;
                    if (evt &amp;&amp; evt.parent &amp;&amp; evt.parent.next) {
                        evt = evt.parent;
                        next = game.createEvent('phase', null, evt);
                    }
                    else if (_status.event.parent &amp;&amp; _status.event.parent.next) {
                        evt = _status.event.parent;
                        next = game.createEvent('phase', null, evt);
                    }
                    else {
                        evt = null;
                        next = game.createEvent('phase');
                    }
                    if (evt &amp;&amp; insert &amp;&amp; evt.next.contains(next)) {
                        evt.next.remove(next);
                        evt.next.unshift(next);
                    }
                    next.player = this;
                    next.skill = skill || _status.event.name;
                    next.setContent('phase');
                    return next;
                },
                insertEvent: function (name, content, arg) {
                    var evt = _status.event.getParent('phase');
                    var next;
                    if (evt &amp;&amp; evt.parent &amp;&amp; evt.parent.next) {
                        next = game.createEvent(name, null, evt.parent);
                    }
                    else {
                        next = game.createEvent(name);
                    }
                    for (var i in arg) {
                        next[i] = arg[i];
                    }
                    next.player = this;
                    next.setContent(content);
                    return next;
                },
                phase: function (skill, stageList) {
                    var next = game.createEvent('phase');
                    next.player = this;
                    next.setContent('phase');
                    if (!_status.roundStart) {
                        _status.roundStart = this;
                    }
                    if (skill) {
                        next.skill = skill;
                    }
                    if (stageList) {
                        next.stageList = stageList;
                    }
                    return next;
                },
                phaseZhunbei: function () {
                    var next = game.createEvent('phaseZhunbei');
                    next.player = this;
                    next.setContent('emptyEvent');
                    return next;
                },
                phaseJudge: function () {
                    var next = game.createEvent('phaseJudge');
                    next.player = this;
                    next.setContent('phaseJudge');
                    return next;
                },
                phaseDraw: function () {
                    var next = game.createEvent('phaseDraw');
                    next.player = this;
                    next.num = 2;
                    if ((get.config('first_less') || _status.connectMode || _status.first_less_forced) &amp;&amp; game.phaseNumber == 1 &amp;&amp; _status.first_less) {
                        next.num--;
                    }
                    next.setContent('phaseDraw');
                    return next;
                },
                phaseUse: function () {
                    var next = game.createEvent('phaseUse');
                    next.player = this;
                    next.setContent('phaseUse');
                    return next;
                },
                phaseDiscard: function () {
                    var next = game.createEvent('phaseDiscard');
                    next.player = this;
                    next.setContent('phaseDiscard');
                    return next;
                },
                phaseJieshu: function () {
                    var next = game.createEvent('phaseJieshu');
                    next.player = this;
                    next.setContent('emptyEvent');
                    return next;
                },
                chooseToUse: function (use) {
                    var next = game.createEvent('chooseToUse');
                    next.player = this;
                    if (arguments.length == 1 &amp;&amp; get.objtype(arguments[0]) == 'object') {
                        for (var i in use) {
                            next[i] = use[i];
                        }
                    }
                    else {
                        for (var i = 0; i &lt; arguments.length; i++) {
                            if (typeof arguments[i] == 'number' || get.itemtype(arguments[i]) == 'select') {
                                next.selectTarget = arguments[i];
                            }
                            else if ((typeof arguments[i] == 'object' &amp;&amp; arguments[i]) || typeof arguments[i] == 'function') {
                                if (get.itemtype(arguments[i]) == 'player' || next.filterCard) {
                                    next.filterTarget = arguments[i];
                                }
                                else next.filterCard = arguments[i];
                            }
                            else if (typeof arguments[i] == 'boolean') {
                                next.forced = arguments[i];
                            }
                            else if (typeof arguments[i] == 'string') {
                                next.prompt = arguments[i];
                            }
                        }
                    }
                    if (typeof next.filterCard == 'object') {
                        next.filterCard = get.filter(next.filterCard);
                    }
                    if (typeof next.filterTarget == 'object') {
                        next.filterTarget = get.filter(next.filterTarget, 2);
                    }
                    if (next.filterCard == undefined) {
                        next.filterCard = lib.filter.filterCard;
                    }
                    if (next.selectCard == undefined) {
                        next.selectCard = [1, 1];
                    }
                    if (next.filterTarget == undefined) {
                        next.filterTarget = lib.filter.filterTarget;
                    }
                    if (next.selectTarget == undefined) {
                        next.selectTarget = lib.filter.selectTarget;
                    }
                    next.position = 'hs';
                    if (next.ai1 == undefined) next.ai1 = get.order;
                    if (next.ai2 == undefined) next.ai2 = get.effect_use;
                    next.setContent('chooseToUse');
                    next._args = Array.from(arguments);
                    return next;
                },
                chooseToRespond: function () {
                    var next = game.createEvent('chooseToRespond');
                    next.player = this;
                    var filter;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            next.selectCard = [arguments[i], arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectCard = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            next.position = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.filterCard) next.ai = arguments[i];
                            else next.filterCard = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                            next.filterCard = get.filter(arguments[i]);
                            filter = arguments[i];
                        }
                        else if (arguments[i] == 'nosource') {
                            next.nosource = true;
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                    }
                    if (next.filterCard == undefined) next.filterCard = lib.filter.all;
                    if (next.selectCard == undefined) next.selectCard = [1, 1];
                    if (next.source == undefined &amp;&amp; !next.nosource) next.source = _status.event.player;
                    if (next.ai == undefined) next.ai = get.unuseful2;
                    if (next.prompt != false) {
                        if (typeof next.prompt == 'string') {
                            //next.dialog=next.prompt;
                        }
                        else {
                            var str = '' + get.cnNumber(next.selectCard[0]) + ''
                            if (filter) {
                                if (filter.name) {
                                    str += get.translation(filter.name);
                                }
                                else {
                                    str += '';
                                }
                            }
                            else {
                                str += '';
                            }
                            if (_status.event.getParent().name == 'useCard') {
                                var cardname = _status.event.name;
                                if (lib.card[cardname] &amp;&amp; lib.translate[cardname]) {
                                    str += '' + lib.translate[cardname];
                                }
                            }
                            next.prompt = str;
                        }
                    }
                    next.position = 'hs';
                    next.setContent('chooseToRespond');
                    next._args = Array.from(arguments);
                    return next;
                },
                chooseToDiscard: function () {
                    var next = game.createEvent('chooseToDiscard');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            next.selectCard = [arguments[i], arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectCard = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'dialog') {
                            next.dialog = arguments[i];
                            next.prompt = false;
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            next.position = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.filterCard) next.ai = arguments[i];
                            else next.filterCard = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                            next.filterCard = get.filter(arguments[i]);
                        }
                        else if (typeof arguments[i] == 'string') {
                            get.evtprompt(next, arguments[i]);
                        }
                        if (arguments[i] === null) {
                            for (var i = 0; i &lt; arguments.length; i++) {
                                console.log(arguments[i]);
                            }
                        }
                    }
                    if (next.isMine() == false &amp;&amp; next.dialog) next.dialog.style.display = 'none';
                    if (next.filterCard == undefined) next.filterCard = lib.filter.all;
                    if (next.selectCard == undefined) next.selectCard = [1, 1];
                    if (next.ai == undefined) next.ai = get.unuseful;
                    next.autochoose = function () {
                        if (!this.forced) return false;
                        if (typeof this.selectCard == 'function') return false;
                        var cards = this.player.getCards(this.position);
                        var num = cards.length;
                        for (var i = 0; i &lt; cards.length; i++) {
                            if (!lib.filter.cardDiscardable(cards[i], this.player, this)) num--;
                        }
                        return get.select(this.selectCard)[0] >= num;
                    }
                    next.setContent('chooseToDiscard');
                    next._args = Array.from(arguments);
                    return next;
                },
                chooseToCompare: function (target, check) {
                    var next = game.createEvent('chooseToCompare');
                    next.player = this;
                    if (Array.isArray(target)) {
                        next.targets = target;
                        if (check) next.ai = check;
                        else next.ai = function (card) {
                            if (typeof card == 'string' &amp;&amp; lib.skill[card]) {
                                var ais = lib.skill[card].check || function () { return 0 };
                                return ais();
                            }
                            var addi = (get.value(card) >= 8 &amp;&amp; get.type(card) != 'equip') ? -10 : 0;
                            if (card.name == 'du') addi += 5;
                            var source = _status.event.source;
                            var player = _status.event.player;
                            var getn = function (card) {
                                if (player.hasSkill('tianbian') &amp;&amp; get.suit(card) == 'heart') return 13;
                                return get.number(card);
                            }
                            if (source &amp;&amp; source != player &amp;&amp; get.attitude(player, source) > 1) {
                                return -getn(card) - get.value(card) / 2 + addi;
                            }
                            return getn(card) - get.value(card) / 2 + addi;
                        }
                        next.setContent('chooseToCompareMultiple');
                    }
                    else {
                        next.target = target;
                        if (check) next.ai = check;
                        else next.ai = function (card) {
                            if (typeof card == 'string' &amp;&amp; lib.skill[card]) {
                                var ais = lib.skill[card].check || function () { return 0 };
                                return ais();
                            }
                            var player = get.owner(card);
                            var getn = function (card) {
                                if (player.hasSkill('tianbian') &amp;&amp; get.suit(card) == 'heart') return 13;
                                return get.number(card);
                            }
                            var event = _status.event.getParent();
                            var to = (player == event.player ? event.target : event.player);
                            var addi = (get.value(card) >= 8 &amp;&amp; get.type(card) != 'equip') ? -10 : 0;
                            if (card.name == 'du') addi += 5;
                            if (player == event.player) {
                                if (get.attitude(player, to) > 0 &amp;&amp; event.small) {
                                    return -getn(card) - get.value(card) / 2 + addi;
                                }
                                return getn(card) - get.value(card) / 2 + addi;
                            }
                            else {
                                if (get.attitude(player, to) > 0 &amp;&amp; !event.small) {
                                    return -getn(card) - get.value(card) / 2 + addi;
                                }
                                return getn(card) - get.value(card) / 2 + addi;
                            }
                        }
                        next.setContent('chooseToCompare');
                    }
                    next._args = Array.from(arguments);
                    return next;
                },
                discoverSkill: function (list) {
                    var next = game.createEvent('discoverSkill');
                    next.player = this;
                    next.setContent('discoverSkill');
                    next.list = list;
                    for (var i = 1; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.num = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                        else if (typeof arguments[i] === 'function') {
                            next.ai = arguments[i];
                        }
                    }
                },
                chooseSkill: function (target) {
                    var next = game.createEvent('chooseSkill');
                    next.player = this;
                    next.setContent('chooseSkill');
                    next.target = target;
                    for (var i = 1; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            next.func = arguments[i];
                        }
                    }
                },
                discoverCard: function (list) {
                    var next = game.createEvent('discoverCard');
                    next.player = this;
                    next.setContent('discoverCard');
                    next.list = list || lib.inpile.slice(0);
                    next.forced = true;
                    for (var i = 1; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            switch (arguments[i]) {
                                case 'use': next.use = true; break;
                                case 'nogain': next.nogain = true; break;
                                default: next.prompt = arguments[i];
                            }
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.num = arguments[i];
                        }
                        else if (typeof arguments[i] === 'function') {
                            next.ai = arguments[i];
                        }
                    }
                    return next;
                },
                chooseCardButton: function () {
                    var cards, prompt, forced, select;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') cards = arguments[i];
                        else if (typeof arguments[i] == 'boolean') forced = arguments[i];
                        else if (typeof arguments[i] == 'string') prompt = arguments[i];
                        else if (get.itemtype(arguments[i]) == 'select' || typeof arguments[i] == 'number') select = arguments[i];
                    }
                    if (prompt == undefined) prompt = '';
                    return this.chooseButton(forced, select, 'hidden', [prompt, cards, 'hidden']);
                },
                chooseVCardButton: function () {
                    var list, prompt, forced, select, notype = false;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (Array.isArray(arguments[i])) {
                            list = arguments[i];
                        }
                        else if (arguments[i] == 'notype') {
                            notype = true;
                        }
                        else if (typeof arguments[i] == 'boolean') forced = arguments[i];
                        else if (typeof arguments[i] == 'string') prompt = arguments[i];
                        else if (get.itemtype(arguments[i]) == 'select' || typeof arguments[i] == 'number') select = arguments[i];
                    }
                    for (var i = 0; i &lt; list.length; i++) {
                        list[i] = [notype ? '' : (get.subtype(list[i]) || get.type(list[i])), '', list[i]];
                    }
                    if (prompt == undefined) prompt = '';
                    return this.chooseButton(forced, select, 'hidden', [prompt, [list, 'vcard'], 'hidden']);
                },
                chooseButton: function () {
                    var next = game.createEvent('chooseButton');
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'dialog') {
                            next.dialog = arguments[i];
                            next.closeDialog = true;
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectButton = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.selectButton = [arguments[i], arguments[i]];
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.ai) next.filterButton = arguments[i];
                            else next.ai = arguments[i];
                        }
                        else if (Array.isArray(arguments[i])) {
                            next.createDialog = arguments[i];
                        }
                    }
                    next.player = this;
                    if (typeof next.forced != 'boolean') next.forced = false;
                    if (next.isMine() == false &amp;&amp; next.dialog) next.dialog.style.display = 'none';
                    if (next.filterButton == undefined) next.filterButton = lib.filter.filterButton;
                    if (next.selectButton == undefined) next.selectButton = [1, 1];
                    if (next.ai == undefined) next.ai = function () { return 1 };
                    next.setContent('chooseButton');
                    next._args = Array.from(arguments);
                    next.forceDie = true;
                    return next;
                },
                chooseButtonOL: function (list, callback, ai) {
                    var next = game.createEvent('chooseButtonOL');
                    next.list = list;
                    next.setContent('chooseButtonOL');
                    next.ai = ai;
                    next.callback = callback;
                    next._args = Array.from(arguments);
                    return next;
                },
                chooseCardOL: function () {
                    var next = game.createEvent('chooseCardOL');
                    next._args = [];
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'players') {
                            next.list = arguments[i].slice(0);
                        }
                        else {
                            next._args.push(arguments[i]);
                        }
                    }
                    next.setContent('chooseCardOL');
                    next._args.add('glow_result');
                    return next;
                },
                chooseCard: function (choose) {
                    var next = game.createEvent('chooseCard');
                    next.player = this;
                    if (arguments.length == 1 &amp;&amp; get.is.object(choose)) {
                        for (var i in choose) {
                            next[i] = choose[i];
                        }
                    }
                    else {
                        for (var i = 0; i &lt; arguments.length; i++) {
                            if (typeof arguments[i] == 'number') {
                                next.selectCard = [arguments[i], arguments[i]];
                            }
                            else if (get.itemtype(arguments[i]) == 'select') {
                                next.selectCard = arguments[i];
                            }
                            else if (typeof arguments[i] == 'boolean') {
                                next.forced = arguments[i];
                            }
                            else if (get.itemtype(arguments[i]) == 'position') {
                                next.position = arguments[i];
                            }
                            else if (typeof arguments[i] == 'function') {
                                if (next.filterCard) next.ai = arguments[i];
                                else next.filterCard = arguments[i];
                            }
                            else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                                next.filterCard = get.filter(arguments[i]);
                            }
                            else if (arguments[i] == 'glow_result') {
                                next.glow_result = true;
                            }
                            else if (typeof arguments[i] == 'string') {
                                get.evtprompt(next, arguments[i]);
                            }
                        }
                    }
                    if (next.filterCard == undefined) next.filterCard = lib.filter.all;
                    if (next.selectCard == undefined) next.selectCard = [1, 1];
                    if (next.ai == undefined) next.ai = get.unuseful3;
                    next.setContent('chooseCard');
                    next._args = Array.from(arguments);
                    return next;
                },
                chooseUseTarget: function () {
                    var next = game.createEvent('chooseUseTarget');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'players') {
                            next.targets = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            next.targets = [arguments[i]];
                        }
                        else if (get.is.object(arguments[i]) &amp;&amp; arguments[i].name) {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            if (arguments[i] == 'nopopup') {
                                next.nopopup = true;
                            }
                            else if (arguments[i] == 'noanimate') {
                                next.animate = false;
                            }
                            else if (arguments[i] == 'nothrow') {
                                next.throw = false;
                            }
                            else if (arguments[i] == 'nodistance') {
                                next.nodistance = true;
                            }
                            else if (arguments[i] == 'noTargetDelay') {
                                next.noTargetDelay = true;
                            }
                            else if (arguments[i] == 'nodelayx') {
                                next.nodelayx = true;
                            }
                            else if (lib.card[arguments[i]] &amp;&amp; !next.card) {
                                next.card = { name: arguments[i], isCard: true };
                            }
                            else get.evtprompt(next, arguments[i]);
                        }
                        else if (arguments[i] === true) {
                            next.forced = true;
                        }
                        else if (arguments[i] === false) {
                            next.addCount = false;
                        }
                    }
                    if (!next.targets) next.targets = game.players.slice(0);
                    if (next.cards == undefined) {
                        if (get.itemtype(next.card) == 'card') {
                            next.cards = [next.card];
                        }
                        else next.cards = [];
                    }
                    else if (next.card == undefined) {
                        if (next.cards) {
                            next.card = next.cards[0];
                        }
                    }
                    next.setContent('chooseUseTarget');
                    next._args = Array.from(arguments);
                    return next;
                    // Fully Online-Ready! Enjoy It!
                },
                chooseTarget: function () {
                    var next = game.createEvent('chooseTarget');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            next.selectTarget = [arguments[i], arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectTarget = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'dialog') {
                            next.dialog = arguments[i];
                            next.prompt = false;
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.filterTarget) next.ai = arguments[i];
                            else next.filterTarget = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            get.evtprompt(next, arguments[i]);
                        }
                    }
                    if (next.filterTarget == undefined) next.filterTarget = lib.filter.all;
                    if (next.selectTarget == undefined) next.selectTarget = [1, 1];
                    if (next.ai == undefined) next.ai = get.attitude2;
                    next.setContent('chooseTarget');
                    next._args = Array.from(arguments);
                    next.forceDie = true;
                    return next;
                },
                chooseCardTarget: function (choose) {
                    var next = game.createEvent('chooseCardTarget');
                    next.player = this;
                    if (arguments.length == 1) {
                        for (var i in choose) {
                            next[i] = choose[i];
                        }
                    }
                    if (typeof next.filterCard == 'object') {
                        next.filterCard = get.filter(next.filterCard);
                    }
                    if (typeof next.filterTarget == 'object') {
                        next.filterTarget = get.filter(next.filterTarget, 2);
                    }
                    if (next.filterCard == undefined || next.filterCard === true) {
                        next.filterCard = lib.filter.all;
                    }
                    if (next.selectCard == undefined) {
                        next.selectCard = 1;
                    }
                    if (next.filterTarget == undefined || next.filterTarget === true) {
                        next.filterTarget = lib.filter.all;
                    }
                    if (next.selectTarget == undefined) {
                        next.selectTarget = 1;
                    }
                    if (next.ai1 == undefined) next.ai1 = get.unuseful2;
                    if (next.ai2 == undefined) next.ai2 = get.attitude2;
                    next.setContent('chooseCardTarget');
                    next._args = Array.from(arguments);
                    return next;
                },
                chooseControlList: function () {
                    var list = [];
                    var prompt = null;
                    var forced = 'cancel2';
                    var func = null;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'string') {
                            if (!prompt) {
                                prompt = arguments[i];
                            }
                            else {
                                list.push(arguments[i]);
                            }
                        }
                        else if (Array.isArray(arguments[i])) {
                            list = arguments[i];
                        }
                        else if (arguments[i] === true) {
                            forced = null;
                        }
                        else if (typeof arguments[i] == 'function') {
                            func = arguments[i];
                        }
                    }
                    return this.chooseControl(forced, func).set('choiceList', list).set('prompt', prompt);
                },
                chooseControl: function () {
                    var next = game.createEvent('chooseControl');
                    next.controls = [];
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'string') {
                            if (arguments[i] == 'dialogcontrol') {
                                next.dialogcontrol = true;
                            }
                            else if (arguments[i] == 'seperate') {
                                next.seperate = true;
                            }
                            else {
                                next.controls.push(arguments[i]);
                            }
                        }
                        else if (Array.isArray(arguments[i])) {
                            next.controls = next.controls.concat(arguments[i]);
                        }
                        else if (typeof arguments[i] == 'function') {
                            next.ai = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.choice = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'dialog') {
                            next.dialog = arguments[i];
                        }
                    }
                    next.player = this;
                    if (next.choice == undefined) next.choice = 0;
                    next.setContent('chooseControl');
                    next._args = Array.from(arguments);
                    next.forceDie = true;
                    return next;
                },
                chooseBool: function () {
                    var next = game.createEvent('chooseBool');
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'boolean') {
                            next.choice = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            next.ai = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            get.evtprompt(next, arguments[i]);
                        }
                        else if (get.itemtype(arguments[i]) == 'dialog') {
                            next.dialog = arguments[i];
                        }
                        if (next.choice == undefined) next.choice = true;
                    }
                    next.player = this;
                    next.setContent('chooseBool');
                    next._args = Array.from(arguments);
                    next.forceDie = true;
                    return next;
                },
                chooseDrawRecover: function () {
                    var next = game.createEvent('chooseDrawRecover', false);
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            if (typeof next.num1 == 'number') {
                                next.num2 = arguments[i];
                            }
                            else {
                                next.num1 = arguments[i];
                            }
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            next.ai = arguments[i];
                        }
                    }
                    if (typeof next.num1 != 'number') {
                        next.num1 = 1;
                    }
                    if (typeof next.num2 != 'number') {
                        next.num2 = 1;
                    }
                    next.setContent('chooseDrawRecover');
                    return next;
                },
                choosePlayerCard: function () {
                    var next = game.createEvent('choosePlayerCard');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.target = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.selectButton = [arguments[i], arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectButton = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            next.position = arguments[i];
                        }
                        else if (arguments[i] == 'visible') {
                            next.visible = true;
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.ai) next.filterButton = arguments[i];
                            else next.ai = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                            next.filterButton = get.filter(arguments[i]);
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                    }
                    if (next.filterButton == undefined) next.filterButton = lib.filter.all;
                    if (next.position == undefined) next.position = 'he';
                    if (next.selectButton == undefined) next.selectButton = [1, 1];
                    if (next.ai == undefined) next.ai = function (button) {
                        var val = get.buttonValue(button);
                        if (get.attitude(_status.event.player, get.owner(button.link)) > 0) return -val;
                        return val;
                    };
                    next.setContent('choosePlayerCard');
                    next._args = Array.from(arguments);
                    return next;
                },
                discardPlayerCard: function () {
                    var next = game.createEvent('discardPlayerCard');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.target = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.selectButton = [arguments[i], arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectButton = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            next.position = arguments[i];
                        }
                        else if (arguments[i] == 'visible') {
                            next.visible = true;
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.ai) next.filterButton = arguments[i];
                            else next.ai = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                            next.filterButton = get.filter(arguments[i]);
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                    }
                    if (next.filterButton == undefined) next.filterButton = lib.filter.all;
                    if (next.position == undefined) next.position = 'he';
                    if (next.selectButton == undefined) next.selectButton = [1, 1];
                    if (next.ai == undefined) next.ai = function (button) {
                        var val = get.buttonValue(button);
                        if (get.attitude(_status.event.player, get.owner(button.link)) > 0) return -val;
                        return val;
                    };
                    next.setContent('discardPlayerCard');
                    next._args = Array.from(arguments);
                    return next;
                },
                gainPlayerCard: function () {
                    var next = game.createEvent('gainPlayerCard');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.target = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.selectButton = [arguments[i], arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'select') {
                            next.selectButton = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            next.position = arguments[i];
                        }
                        else if (arguments[i] == 'visible') {
                            next.visible = true;
                        }
                        else if (arguments[i] == 'visibleMove') {
                            next.visibleMove = true;
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.ai) next.filterButton = arguments[i];
                            else next.ai = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i]) {
                            next.filterButton = get.filter(arguments[i]);
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.prompt = arguments[i];
                        }
                    }
                    if (next.filterButton == undefined) next.filterButton = lib.filter.all;
                    if (next.position == undefined) next.position = 'he';
                    if (next.selectButton == undefined) next.selectButton = [1, 1];
                    if (next.ai == undefined) next.ai = function (button) {
                        var val = get.buttonValue(button);
                        if (get.attitude(_status.event.player, get.owner(button.link)) > 0) return -val;
                        return val;
                    };
                    next.setContent('gainPlayerCard');
                    next._args = Array.from(arguments);
                    return next;
                },
                showHandcards: function (str) {
                    var next = game.createEvent('showHandcards');
                    next.player = this;
                    if (typeof str == 'string') {
                        next.prompt = str;
                    }
                    next.setContent('showHandcards');
                    next._args = Array.from(arguments);
                    return next;
                },
                showCards: function (cards, str) {
                    var next = game.createEvent('showCards');
                    next.player = this;
                    next.str = str;
                    if (typeof cards == 'string') {
                        str = cards;
                        cards = next.str;
                        next.str = str;
                    }
                    if (get.itemtype(cards) == 'card') next.cards = [cards];
                    else if (get.itemtype(cards) == 'cards') next.cards = cards.slice(0);
                    else _status.event.next.remove(next);
                    next.setContent('showCards');
                    next._args = Array.from(arguments);
                    return next;
                },
                viewCards: function (str, cards) {
                    var next = game.createEvent('viewCards');
                    next.player = this;
                    next.str = str;
                    next.cards = cards.slice(0);
                    next.setContent('viewCards');
                    next._args = Array.from(arguments);
                    return next;
                },
                viewHandcards: function (target) {
                    var cards = target.getCards('h');
                    if (cards.length) {
                        return this.viewCards(get.translation(target) + '', cards);
                    }
                    else {
                        return false;
                    }
                },
                canMoveCard: function (withatt, nojudge, moveHandcard) {
                    var player = this;
                    return game.hasPlayer(function (current) {
                        var att = get.sgn(get.attitude(player, current));
                        if (!withatt || att != 0) {
                            var es = current.getCards('e');
                            for (var i = 0; i &lt; es.length; i++) {
                                if (game.hasPlayer(function (current2) {
                                    if (withatt) {
                                        if (get.sgn(get.value(es[i], current)) != -att) return false;
                                        var att2 = get.sgn(get.attitude(player, current2));
                                        if (att == att2 || att2 != get.sgn(get.effect(current2, es[i], player, current2))) return false;
                                    }
                                    return current != current2 &amp;&amp; !current2.isMin() &amp;&amp; current2.isEmpty(get.subtype(es[i]));
                                })) {
                                    return true;
                                }
                            }
                        }
                        if (!nojudge &amp;&amp; (!withatt || att > 0)) {
                            var js = current.getCards('j');
                            for (var i = 0; i &lt; js.length; i++) {
                                if (game.hasPlayer(function (current2) {
                                    if (withatt) {
                                        var att2 = get.attitude(player, current2);
                                        if (att2 >= 0) return false;
                                    }
                                    return current != current2 &amp;&amp; current2.canAddJudge(js[i]);
                                })) {
                                    return true;
                                }
                            }
                        }
                        if (moveHandcard == true) {
                            if (current.countCards('h') > 0) return true;
                        }
                    });
                },
                moveCard: function () {
                    var next = game.createEvent('moveCard');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            get.evtprompt(next, arguments[i]);
                        }
                        else if (typeof arguments[i] == 'function') {
                            if (next.sourceFilterTarget) next.ai = arguments[i];
                            else next.sourceFilterTarget = arguments[i];
                        }
                        else if (Array.isArray(arguments[i])) {
                            for (var j = 0; j &lt; arguments[i].length; j++) {
                                if (typeof arguments[i][j] != 'string') break;
                            }
                            if (j == arguments[i].length) {
                                next.targetprompt = arguments[i];
                            }
                        }
                    }
                    next.setContent('moveCard');
                    next._args = Array.from(arguments);
                    return next;
                },
                /**
                 * `chooseToUse`
                 * @function
                 * @param {*} result `chooseToUse`
                 * @param {?GameCores.Bases.Event} [event] 
                 */
                useResult: function (result, event) {
                    event = event || _status.event;
                    if (result._sendskill) {
                        lib.skill[result._sendskill[0]] = result._sendskill[1];
                    }
                    if (event.onresult) {
                        event.onresult(result);
                    }
                    if (result.skill) {
                        var info = get.info(result.skill);
                        if (info.onuse) {
                            info.onuse(result, this);
                        }
                        if (info.direct &amp;&amp; !info.clearTime) {
                            _status.noclearcountdown = true;
                        }
                    }
                    if (event.logSkill) {
                        if (typeof event.logSkill == 'string') {
                            this.logSkill(event.logSkill);
                        }
                        else if (Array.isArray(event.logSkill)) {
                            this.logSkill.apply(this, event.logSkill);
                        }
                    }
                    if (result.card || !result.skill) {
                        result.used = result.card || result.cards[0];
                        var next = this.useCard(result.card, result.cards, result.targets, result.skill);
                        next.oncard = event.oncard;
                        next.respondTo = event.respondTo;
                        if (event.addCount === false) {
                            next.addCount = false;
                        }
                        return next;
                    }
                    else if (result.skill) {
                        result.used = result.skill;
                        return this.useSkill(result.skill, result.cards, result.targets);
                    }
                },
                useCard: function () {
                    var next = game.createEvent('useCard');
                    next.player = this;
                    next.num = 0;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'players') {
                            next.targets = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            next.targets = [arguments[i]];
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i] &amp;&amp; arguments[i].name) {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            if (arguments[i] == 'noai') {
                                next.noai = true;
                            }
                            else if (arguments[i] == 'nowuxie') {
                                next.nowuxie = true;
                            }
                            else {
                                next.skill = arguments[i];
                            }
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.addCount = arguments[i];
                        }
                    }
                    if (next.cards == undefined) {
                        if (get.itemtype(next.card) == 'card') {
                            next.cards = [next.card];
                        }
                        else next.cards = [];
                    }
                    else if (next.card == undefined) {
                        if (next.cards) {
                            next.card = next.cards[0];
                        }
                    }
                    if (!next.targets) {
                        next.targets = [];
                    }
                    if (next.card) {
                        next.card = get.autoViewAs(next.card, false, next.player);
                        var info = get.info(next.card);
                        if (info.changeTarget) {
                            info.changeTarget(next.player, next.targets);
                        }
                        if (info.singleCard) {
                            next._targets = next.targets.slice(0);
                            next.target = next.targets[0];
                            next.addedTargets = next.targets.splice(1);
                            if (next.addedTargets.length) {
                                next.addedTarget = next.addedTargets[0];
                            }
                        }
                        if (!next.card.isCard &amp;&amp; next.cards.length) {
                            next.card.cards = next.cards.slice(0);
                        }
                    }
                    for (var i = 0; i &lt; next.targets.length; i++) {
                        if (get.attitude(this, next.targets[i]) >= -1 &amp;&amp; get.attitude(this, next.targets[i]) &lt; 0) {
                            if (!this.ai.tempIgnore) this.ai.tempIgnore = [];
                            this.ai.tempIgnore.add(next.targets[i]);
                        }
                    }
                    if (typeof this.logAi == 'function' &amp;&amp; !next.noai &amp;&amp; !get.info(next.card).noai) {
                        var postAi = get.info(next.card).postAi;
                        if (postAi &amp;&amp; postAi(next.targets)) {
                            next.postAi = true;
                        }
                        else {
                            this.logAi(next.targets, next.card);
                        }
                    }
                    next.stocktargets = next.targets.slice(0);
                    next.setContent('useCard');
                    return next;
                },
                useSkill: function () {
                    var next = game.createEvent('useSkill');
                    next.player = this;
                    next.num = 0;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'players') {
                            next.targets = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.skill = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.addCount = arguments[i];
                        }
                    }
                    if (next.cards == undefined) {
                        next.cards = [];
                    }
                    if (next.skill &amp;&amp; get.info(next.skill) &amp;&amp; get.info(next.skill).changeTarget) {
                        get.info(next.skill).changeTarget(next.player, next.targets);
                    }
                    if (next.targets) {
                        for (var i = 0; i &lt; next.targets.length; i++) {
                            if (get.attitude(this, next.targets[i]) >= -1 &amp;&amp; get.attitude(this, next.targets[i]) &lt; 0) {
                                if (!this.ai.tempIgnore) this.ai.tempIgnore = [];
                                this.ai.tempIgnore.add(next.targets[i]);
                            }
                        }
                        if (typeof this.logAi == 'function') {
                            this.logAi(next.targets, next.skill);
                        }
                    }
                    else {
                        next.targets = [];
                    }
                    next.setContent('useSkill');
                    return next;
                },
                drawTo: function (num, args) {
                    var num2 = num - this.countCards('h');
                    if (!num2) return;
                    var next = this.draw(num2);
                    if (Array.isArray(args)) {
                        for (var i = 0; i &lt; args.length; i++) {
                            if (get.itemtype(args[i]) == 'player') {
                                next.source = args[i];
                            }
                            else if (typeof args[i] == 'boolean') {
                                next.animate = args[i];
                            }
                            else if (args[i] == 'nodelay') {
                                next.animate = false;
                                next.$draw = true;
                            }
                            else if (args[i] == 'visible') {
                                next.visible = true;
                            }
                            else if (args[i] == 'bottom') {
                                next.bottom = true;
                            }
                            else if (typeof args[i] == 'object' &amp;&amp; args[i] &amp;&amp; args[i].drawDeck != undefined) {
                                next.drawDeck = args[i].drawDeck;
                            }
                        }
                    }
                    return next;
                },
                draw: function () {
                    var next = game.createEvent('draw');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.num = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.animate = arguments[i];
                        }
                        else if (arguments[i] == 'nodelay') {
                            next.animate = false;
                            next.$draw = true;
                        }
                        else if (arguments[i] == 'visible') {
                            next.visible = true;
                        }
                        else if (arguments[i] == 'bottom') {
                            next.bottom = true;
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i] &amp;&amp; arguments[i].drawDeck != undefined) {
                            next.drawDeck = arguments[i].drawDeck;
                        }
                    }
                    if (next.num == undefined) next.num = 1;
                    if (next.num &lt;= 0) _status.event.next.remove(next);
                    next.setContent('draw');
                    if (lib.config.mode == 'stone' &amp;&amp; _status.mode == 'deck' &amp;&amp;
                        next.drawDeck == undefined &amp;&amp; !next.player.isMin() &amp;&amp; next.num > 1) {
                        next.drawDeck = 1;
                    }
                    return next;
                },
                randomDiscard: function () {
                    var position = 'he', num = 1, delay = null;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            num = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            position = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            delay = arguments[i];
                        }
                    }
                    var cards = this.getCards(position).randomGets(num);
                    if (cards.length) {
                        var next = this.discard(cards, 'notBySelf');
                        if (typeof delay == 'boolean') {
                            next.delay = delay;
                        }
                    }
                    return cards;
                },
                randomGain: function () {
                    var position = 'he', num = 1, target = null, line = false;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            num = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'position') {
                            position = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            target = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            line = arguments[i];
                        }
                    }
                    if (target) {
                        var cards = target.getCards(position).randomGets(num);
                        if (cards.length) {
                            if (line) {
                                this.line(target, 'green');
                            }
                            this.gain(cards, target, 'log', 'bySelf');
                            target.$giveAuto(cards, this);
                        }
                        return cards;
                    }
                    return [];
                },
                discard: function () {
                    var next = game.createEvent('discard');
                    next.player = this;
                    next.num = 0;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.cards = [arguments[i]];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.animate = arguments[i];
                        }
                        else if (get.objtype(arguments[i]) == 'div') {
                            next.position = arguments[i];
                        }
                        else if (arguments[i] == 'notBySelf') {
                            next.notBySelf = true;
                        }
                    }
                    if (next.cards == undefined) _status.event.next.remove(next);
                    next.setContent('discard');
                    return next;
                },
                respond: function () {
                    var next = game.createEvent('respond');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i] &amp;&amp; arguments[i].name) {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') next.animate = arguments[i];
                        else if (arguments[i] == 'highlight') next.highlight = true;
                        else if (arguments[i] == 'noOrdering') next.noOrdering = true;
                        else if (typeof arguments[i] == 'string') next.skill = arguments[i];
                    }
                    if (next.cards == undefined) {
                        if (get.itemtype(next.card) == 'card') {
                            next.cards = [next.card];
                        }
                        else {
                            next.cards = [];
                        }
                    }
                    else if (next.card == undefined) {
                        if (next.cards) {
                            next.card = next.cards[0];
                            if (!next.skill) {
                                next.card = get.autoViewAs(next.card, null, next.player);
                            }
                        }
                    }
                    next.setContent('respond');
                    return next;
                },
                swapHandcards: function (target, cards1, cards2) {
                    var next = game.createEvent('swapHandcards', false);
                    next.player = this;
                    next.target = target;
                    if (cards1) next.cards1 = cards1;
                    if (cards2) next.cards2 = cards2;
                    next.setContent('swapHandcards');
                    return next;
                },
                directequip: function (cards) {
                    for (var i = 0; i &lt; cards.length; i++) {
                        this.$equip(cards[i]);
                    }
                    if (!_status.video) {
                        game.addVideo('directequip', this, get.cardsInfo(cards));
                    }
                },
                directgain: function (cards, broadcast, gaintag) {
                    var hs = this.getCards('hs');
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (hs.contains(cards[i])) {
                            cards.splice(i--, 1);
                        }
                    }
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].fix();
                        if (gaintag) cards[i].addGaintag(gaintag);
                        var sort = lib.config.sort_card(cards[i]);
                        if (this == game.me) {
                            cards[i].classList.add('drawinghidden');
                        }
                        if (get.is.singleHandcard() || sort > 0) {
                            this.node.handcards1.insertBefore(cards[i], this.node.handcards1.firstChild);
                        }
                        else {
                            this.node.handcards2.insertBefore(cards[i], this.node.handcards2.firstChild);
                        }
                    }
                    if (this == game.me || _status.video) ui.updatehl();
                    if (!_status.video) {
                        game.addVideo('directgain', this, get.cardsInfo(cards));
                        this.update();
                    }
                    if (broadcast !== false) game.broadcast(function (player, cards) {
                        player.directgain(cards);
                    }, this, cards);
                    return this;
                },
                /**
                 * 
                 * @param {Array&lt;GameCores.GameObjects.Card>} cards (|)
                 * @param {?boolean} [broadcast] trueh{@link game.broadcast}false
                 * @param {string} [gaintag] `card.gaintag=`
                 */
                directgains: function (cards, broadcast, gaintag) {
                    var hs = this.getCards('hs');
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (hs.contains(cards[i])) {
                            cards.splice(i--, 1);
                        }
                    }
                    var addLast = function (card, node) {
                        if (gaintag) {
                            for (var i = 0; i &lt; node.childNodes.length; i++) {
                                var add = node.childNodes[node.childNodes.length - i - 1];
                                if (!add.classList.contains('glows')) break;
                                if (add.hasGaintag(gaintag)) {
                                    node.insertBefore(card, add.nextSibling);
                                    return;
                                }
                            }
                        }
                        node.appendChild(card);
                    }
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].fix();
                        cards[i].remove();
                        if (gaintag) cards[i].addGaintag(gaintag);
                        cards[i].classList.add('glows');
                        if (this == game.me) {
                            cards[i].classList.add('drawinghidden');
                        }
                        if (get.is.singleHandcard()) {
                            addLast(cards[i], this.node.handcards1);
                        }
                        else {
                            addLast(cards[i], this.node.handcards2);
                        }
                    }
                    if (this == game.me || _status.video) ui.updatehl();
                    if (!_status.video) {
                        game.addVideo('directgains', this, get.cardsInfo(cards));
                        this.update();
                    }
                    if (broadcast !== false) game.broadcast(function (player, cards, gaintag) {
                        player.directgains(cards, null, gaintag);//[recommend] use false instead of null
                    }, this, cards, gaintag);
                    return this;
                },
                gainMultiple: function (targets, position) {
                    var next = game.createEvent('gainMultiple', false);
                    next.setContent('gainMultiple');
                    next.player = this;
                    next.targets = targets;
                    next.position = position || 'h';
                    return next;
                },
                gain: function () {
                    var next = game.createEvent('gain');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.cards = [arguments[i]];
                        }
                        else if (arguments[i] === 'log') {
                            next.log = true;
                        }
                        else if (arguments[i] == 'fromStorage') {
                            next.fromStorage = true;
                        }
                        else if (arguments[i] == 'bySelf') {
                            next.bySelf = true;
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.animate = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.delay = arguments[i];
                        }
                    }
                    if (next.animate == 'gain2' || next.animate == 'draw2') {
                        if (!next.hasOwnProperty('log')) {
                            next.log = true;
                        }
                    }
                    next.setContent('gain');
                    next.getl = function (player) {
                        var that = this;
                        var map = {
                            player: player,
                            hs: [],
                            es: [],
                            js: [],
                            ss: [],
                            cards: [],
                            cards2: [],
                        };
                        player.getHistory('lose', function (evt) {
                            if (evt.parent == that) {
                                map.hs.addArray(evt.hs);
                                map.es.addArray(evt.es);
                                map.js.addArray(evt.js);
                                map.ss.addArray(evt.ss);
                                map.cards.addArray(evt.cards);
                                map.cards2.addArray(evt.cards2);
                            }
                        });
                        if (map.cards.length > 0 || map.ss.length > 0) return map;
                    };
                    next.gaintag = [];
                    return next;
                },
                give: function (cards, target, visible) {
                    var next = target.gain(cards, this);
                    next.animate = visible ? 'give' : 'giveAuto';
                },
                lose: function () {
                    var next = game.createEvent('lose');
                    next.player = this;
                    next.forceDie = true;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.cards = [arguments[i]];
                        }
                        else if (get.objtype(arguments[i]) == 'div') {
                            next.position = arguments[i];
                        }
                        else if (arguments[i] == 'toStorage') {
                            next.toStorage = true;
                        }
                        else if (arguments[i] == 'visible') {
                            next.visible = true;
                        }
                        else if (arguments[i] == 'insert') {
                            next.insert_card = true;
                        }
                    }
                    if (next.cards) {
                        var hej = this.getCards('hejs');
                        for (var i = 0; i &lt; next.cards.length; i++) {
                            if (!hej.contains(next.cards[i])) {
                                next.cards.splice(i--, 1);
                            }
                        }
                    }
                    if (!next.cards || !next.cards.length) {
                        _status.event.next.remove(next);
                    }
                    else {
                        if (next.position == undefined) next.position = ui.discardPile;
                        next.cards = next.cards.slice(0);
                    }
                    next.setContent('lose');
                    next.getl = function (player) {
                        if (this.getlx !== false &amp;&amp; this.player == player) return this;
                    };
                    return next;
                },
                damage: function () {
                    var next = game.createEvent('damage');
                    //next.forceDie=true;
                    next.player = this;
                    var nocard, nosource;
                    var event = _status.event;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.num = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i] &amp;&amp; arguments[i].name) {
                            next.card = arguments[i];
                        }
                        else if (arguments[i] == 'nocard') {
                            nocard = true;
                        }
                        else if (arguments[i] == 'nosource') {
                            nosource = true;
                        }
                        else if (arguments[i] == 'notrigger') {
                            next._triggered = null;
                            next.notrigger = true;
                        }
                        else if (get.itemtype(arguments[i]) == 'nature') {
                            next.nature = arguments[i];
                        }
                    }
                    if (next.card == undefined &amp;&amp; !nocard) next.card = event.card;
                    if (next.cards == undefined &amp;&amp; !nocard) next.cards = event.cards;
                    if (next.source == undefined &amp;&amp; !nosource) next.source = event.player;
                    if (next.source &amp;&amp; next.source.isDead()) delete next.source;
                    if (next.num == undefined) next.num = 1;
                    if (next.nature == 'poison') delete next._triggered;
                    next.setContent('damage');
                    next.filterStop = function () {
                        if (this.source &amp;&amp; this.source.isDead()) delete this.source;
                        if (this.num &lt;= 0) {
                            delete this.filterStop;
                            this.trigger('damageZero');
                            this.finish();
                            this._triggered = null;
                            return true;
                        }
                    };
                    return next;
                },
                recover: function () {
                    var next = game.createEvent('recover');
                    next.player = this;
                    var nocard, nosource;
                    var event = _status.event;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'cards') {
                            next.cards = arguments[i].slice(0);
                        }
                        else if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (typeof arguments[i] == 'object' &amp;&amp; arguments[i] &amp;&amp; arguments[i].name) {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'number') {
                            next.num = arguments[i];
                        }
                        else if (arguments[i] == 'nocard') {
                            nocard = true;
                        }
                        else if (arguments[i] == 'nosource') {
                            nosource = true;
                        }
                    }
                    if (next.card == undefined &amp;&amp; !nocard) next.card = event.card;
                    if (next.cards == undefined &amp;&amp; !nocard) next.cards = event.cards;
                    if (next.source == undefined &amp;&amp; !nosource) next.source = event.player;
                    if (next.num == undefined) next.num = 1;
                    if (next.num &lt;= 0) _status.event.next.remove(next);
                    next.setContent('recover');
                    return next;
                },
                doubleDraw: function () {
                    if (get.is.changban()) return;
                    var next = game.createEvent('doubleDraw');
                    next.player = this;
                    next.setContent('doubleDraw');
                    return next;
                },
                loseHp: function (num) {
                    var next = game.createEvent('loseHp');
                    next.num = num;
                    next.player = this;
                    if (next.num == undefined) next.num = 1;
                    next.setContent('loseHp');
                    return next;
                },
                loseMaxHp: function () {
                    var next = game.createEvent('loseMaxHp');
                    next.player = this;
                    var nosource;
                    var event = _status.event;
                    next.num = 1;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (typeof arguments[i] === 'number') {
                            next.num = arguments[i];
                        }
                        else if (typeof arguments[i] === 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (arguments[i] == 'nosource') {
                            nosource = true;
                        }
                    }
                    if (next.source == undefined &amp;&amp; !nosource) next.source = event.player;
                    next.setContent('loseMaxHp');
                    return next;
                },
                gainMaxHp: function () {
                    var next = game.createEvent('gainMaxHp');
                    next.player = this;
                    var nosource;
                    var event = _status.event;
                    next.num = 1;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] === 'number') {
                            next.num = arguments[i];
                        }
                        else if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (typeof arguments[i] === 'boolean') {
                            next.forced = arguments[i];
                        }
                        else if (arguments[i] == 'nosource') {
                            nosource = true;
                        }
                    }
                    if (next.source == undefined &amp;&amp; !nosource) next.source = event.player;
                    next.setContent('gainMaxHp');
                    return next;
                },
                changeHp: function (num, popup) {
                    var next = game.createEvent('changeHp', false);
                    next.num = num;
                    if (popup != undefined) next.popup = popup;
                    next.player = this;
                    next.setContent('changeHp');
                    return next;
                },

                changeHujia: function (num, type) {
                    var next = game.createEvent('changeHujia');
                    if (typeof num != 'number') {
                        num = 1;
                    }
                    next.num = num;
                    next.player = this;
                    if (type) next.type = type;
                    next.setContent('changeHujia');
                    return next;
                },
                getBuff: function () {
                    var list = [1, 2, 3, 4, 5, 6];
                    var nodelay = false;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            list.remove(arguments[i]);
                        }
                        else if (arguments[i] === false) {
                            nodelay = true;
                        }
                    }
                    if (this.isHealthy()) {
                        list.remove(2);
                    }
                    if (!this.countCards('j')) {
                        list.remove(5);
                    }
                    if (!this.isLinked() &amp;&amp; !this.isTurnedOver()) {
                        list.remove(6);
                    }
                    if (this.hasSkill('qianxing')) {
                        list.remove(4);
                    }
                    switch (list.randomGet()) {
                        case 1: this.draw(nodelay ? 'nodelay' : 1); break;
                        case 2: this.recover(); break;
                        case 3: this.changeHujia(); break;
                        case 4: this.tempHide();
                        case 5: this.discard(this.getCards('j')).delay = (!nodelay); break;
                        case 6: {
                            if (this.isLinked()) this.link();
                            if (this.isTurnedOver()) this.turnOver();
                            break;
                        }
                    }
                    return this;
                },
                getDebuff: function () {
                    var list = [1, 2, 3, 4, 5, 6];
                    var nodelay = false;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'number') {
                            list.remove(arguments[i]);
                        }
                        else if (arguments[i] === false) {
                            nodelay = true;
                        }
                    }
                    if (this.countCards('he') == 0) {
                        list.remove(1);
                    }
                    if (this.isLinked()) {
                        list.remove(4);
                    }
                    if (this.hasSkill('fengyin')) {
                        list.remove(5);
                    }
                    if (this.hp == 1) {
                        list.remove(3);
                        if (list.length > 1) list.remove(2);
                    }
                    if (!list.length) return this;
                    var num = list.randomGet();
                    switch (list.randomGet()) {
                        case 1: this.randomDiscard(nodelay ? false : 'he'); break;
                        case 2: this.loseHp(); break;
                        case 3: this.damage(); break;
                        case 4: if (!this.isLinked()) this.link(); break;
                        case 5: this.addTempSkill('fengyin', { player: 'phaseAfter' }); break;
                        case 6: {
                            var list = [];
                            for (var i = 0; i &lt; lib.inpile.length; i++) {
                                var info = lib.card[lib.inpile[i]];
                                if (info.type == 'delay' &amp;&amp; !info.cancel &amp;&amp; !this.hasJudge(lib.inpile[i])) {
                                    list.push(lib.inpile[i]);
                                }
                            }
                            if (list.length) {
                                var card = game.createCard(list.randomGet());
                                this.addJudge(card);
                                this.$draw(card);
                                if (!nodelay) game.delay();
                            }
                            else {
                                this.getDebuff(6);
                            }
                            break;
                        }
                    }
                    return this;
                },
                dying: function (reason) {
                    if (this.nodying || this.hp > 0 || this.isDying()) return;
                    var next = game.createEvent('dying');
                    next.player = this;
                    next.reason = reason;
                    if (reason &amp;&amp; reason.source) next.source = reason.source;
                    next.setContent('dying');
                    next.filterStop = function () {
                        if (this.player.hp > 0) {
                            delete this.filterStop;
                            return true;
                        }
                    };
                    return next;
                },
                die: function (reason) {
                    var next = game.createEvent('die');
                    next.player = this;
                    next.reason = reason;
                    if (reason) next.source = reason.source;
                    next.setContent('die');
                    return next;
                },
                revive: function (hp, log) {
                    if (log !== false) game.log(this, '');
                    if (this.maxHp &lt; 1) this.maxHp = 1;
                    if (hp) this.hp = hp;
                    else {
                        this.hp = 1;
                    }
                    game.addVideo('revive', this);
                    this.classList.remove('dead');
                    this.removeAttribute('style');
                    this.node.avatar.style.transform = '';
                    this.node.avatar2.style.transform = '';
                    this.node.hp.show();
                    this.node.equips.show();
                    this.node.count.show();
                    this.update();
                    var player;
                    player = this.previousSeat;
                    while (player.isDead()) player = player.previousSeat;
                    player.next = this;
                    this.previous = player;
                    player = this.nextSeat;
                    while (player.isDead()) player = player.nextSeat;
                    player.previous = this;
                    this.next = player;
                    game.players.add(this);
                    game.dead.remove(this);
                    if (this == game.me) {
                        if (ui.auto) ui.auto.show();
                        if (ui.wuxie) ui.wuxie.show();
                        if (ui.revive) {
                            ui.revive.close();
                            delete ui.revive;
                        }
                        if (ui.exit) {
                            ui.exit.close();
                            delete ui.exit;
                        }
                        if (ui.swap) {
                            ui.swap.close();
                            delete ui.swap;
                        }
                        if (ui.restart) {
                            ui.restart.close();
                            delete ui.restart;
                        }
                        if (ui.continue_game) {
                            ui.continue_game.close();
                            delete ui.continue_game;
                        }
                    }
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                isMad: function () {
                    return this.hasSkill('mad');
                },
                /**
                 * 
                 * 
                 * @param {(string|Object)} [end] 'phaseAfter'
                 */
                goMad: function (end) {
                    if (end) {
                        this.addTempSkill('mad', end);
                    }
                    else {
                        this.addSkill('mad');
                    }
                    game.log(this, '');
                },
                /**
                 * 
                 */
                unMad: function () {
                    this.removeSkill('mad');
                },
                tempHide: function () {
                    this.addTempSkill('qianxing', { player: 'phaseBegin' });
                },
                addExpose: function (num) {
                    if (typeof this.ai.shown == 'number' &amp;&amp; !this.identityShown &amp;&amp; this.ai.shown &lt; 1) {
                        this.ai.shown += num;
                        if (this.ai.shown > 0.95) {
                            this.ai.shown = 0.95;
                        }
                    }
                    return this;
                },
                equip: function (card, arg2) {
                    if (get.type(card) != 'equip') return;
                    var next = game.createEvent('equip');
                    next.card = card;
                    if (get.is.object(next.card) &amp;&amp; get.itemtype(next.card.cards) == 'cards' &amp;&amp; get.name(next.card.cards[0]) == next.card.name &amp;&amp; next.card.cards.length == 1) next.card = next.card.cards[0];
                    next.player = this;
                    if (arg2) {
                        if (arg2 === true) {
                            next.draw = true;
                        } else {
                            next.cards = arg2;
                        }
                    }
                    if (!next.cards) next.cards = [next.card];
                    if (get.itemtype(next.cards) == 'card') next.cards = [next.cards];
                    next.setContent(lib.element.content.equip);
                    next.getl = function (player) {
                        var that = this;
                        var map = {
                            player: player,
                            hs: [],
                            es: [],
                            js: [],
                            ss: [],
                            cards: [],
                            cards2: [],
                        };
                        player.getHistory('lose', function (evt) {
                            if (evt.parent == that) {
                                map.hs.addArray(evt.hs);
                                map.es.addArray(evt.es);
                                map.js.addArray(evt.js);
                                map.ss.addArray(evt.ss);
                                map.cards.addArray(evt.cards);
                                map.cards2.addArray(evt.cards2);
                            }
                        });
                        if (map.cards.length > 0 || map.ss.length > 0) return map;
                    };
                    return next;
                },
                addJudge: function (card, cards) {
                    var next = game.createEvent('addJudge');
                    next.card = card;
                    next.cards = cards;
                    if (next.cards == undefined) next.cards = [card];
                    if (get.itemtype(next.cards) == 'card') next.cards = [next.cards];
                    next.player = this;
                    next.setContent('addJudge');
                    next.getl = function (player) {
                        var that = this;
                        var map = {
                            player: player,
                            hs: [],
                            es: [],
                            js: [],
                            ss: [],
                            cards: [],
                            cards2: [],
                        };
                        player.getHistory('lose', function (evt) {
                            if (evt.parent == that) {
                                map.hs.addArray(evt.hs);
                                map.es.addArray(evt.es);
                                map.js.addArray(evt.js);
                                map.ss.addArray(evt.ss);
                                map.cards.addArray(evt.cards);
                                map.cards2.addArray(evt.cards2);
                            }
                        });
                        if (map.cards.length > 0 || map.ss.length > 0) return map;
                    };
                    return next;
                },
                canAddJudge: function (card) {
                    if (this.storage._disableJudge) return false;
                    var name;
                    if (typeof card == 'string') {
                        name = card;
                    }
                    else {
                        name = card.viewAs || card.name;
                    }
                    if (!name) return false;
                    if (this.hasJudge(name)) return false;
                    var mod = game.checkMod(card, this, this, 'unchanged', 'targetEnabled', this);
                    if (mod != 'unchanged') return mod;
                    return true;
                },
                addJudgeNext: function (card) {
                    if (!card.expired) {
                        var target = this.next;
                        var name = card.viewAs || card.name;
                        var bool = false;
                        for (var iwhile = 0; iwhile &lt; 20; iwhile++) {
                            if (target.canAddJudge(card)) {
                                bool = true; break;
                            }
                            target = target.next;
                        }
                        if (!bool) {
                            game.log(card, '');
                            game.cardsDiscard(card);
                        }
                        else {
                            if (card.name != name) {
                                target.addJudge(name, card);
                            }
                            else {
                                target.addJudge(card);
                            }
                        }
                    }
                    else {
                        card.expired = false;
                    }
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                judge: function () {
                    var next = game.createEvent('judge');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'card') {
                            next.card = arguments[i];
                        }
                        else if (typeof arguments[i] == 'string') {
                            next.skill = arguments[i];
                        }
                        else if (typeof arguments[i] == 'function') {
                            next.judge = arguments[i];
                        }
                        else if (typeof arguments[i] == 'boolean') {
                            next.clearArena = arguments[i];
                        }
                        else if (get.objtype(arguments[i]) == 'div') {
                            next.position = arguments[i];
                        }
                    }
                    if (next.card &amp;&amp; next.judge == undefined) {
                        next.judge = get.judge(next.card);
                    }
                    if (next.judge == undefined) next.judge = function () { return 0 };
                    if (next.position == undefined) next.position = ui.discardPile;
                    if (next.card) next.cardname = next.card.viewAs || next.card.name;

                    var str = '';
                    if (next.card) str = get.translation(next.card.viewAs || next.card.name);
                    else if (next.skill) str = get.translation(next.skill);
                    else str = get.translation(_status.event.name);
                    next.judgestr = str;
                    next.setContent('judge');
                    return next;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                turnOver: function (bool) {
                    if (typeof bool == 'boolean') {
                        if (bool) {
                            if (this.isTurnedOver()) return;
                        }
                        else {
                            if (!this.isTurnedOver()) return;
                        }
                    }
                    var next = game.createEvent('turnOver');
                    next.player = this;
                    var nosource;
                    var event = _status.event;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (arguments[i] == 'nosource') {
                            nosource = true;
                        }
                    }
                    if (next.source == undefined &amp;&amp; !nosource) next.source = event.player;
                    next.setContent('turnOver');
                    return next;
                },
                out: function (skill) {
                    if (typeof skill == 'number') {
                        this.outCount += skill;
                    }
                    else if (typeof skill == 'string') {
                        if (!this.outSkills) {
                            this.outSkills = [];
                        }
                        this.outSkills.add(skill);
                    }
                    else {
                        this.outCount++;
                    }
                    if (!this.classList.contains('out')) {
                        this.classList.add('out');
                        game.log(this, '');
                    }
                    if (!game.countPlayer()) {
                        game.over();
                    }
                },
                in: function (skill) {
                    if (this.isOut()) {
                        if (typeof skill == 'string') {
                            if (this.outSkills) {
                                this.outSkills.remove(skill);
                                if (!this.outSkills.length) {
                                    delete this.outSkills;
                                }
                            }
                        }
                        else if (typeof skill == 'number') {
                            this.outCount -= skill;
                        }
                        else {
                            if (skill === true) {
                                delete this.outSkills;
                            }
                            this.outCount = 0;
                        }
                        if (this.outCount &lt;= 0 &amp;&amp; !this.outSkills) {
                            this.outCount = 0;
                            this.classList.remove('out');
                            game.log(this, '');
                        }
                    }
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                link: function (bool) {
                    if (typeof bool == 'boolean') {
                        if (bool) {
                            if (this.isLinked()) return;
                        }
                        else {
                            if (!this.isLinked()) return;
                        }
                    }
                    var next = game.createEvent('link');
                    next.player = this;
                    var nosource;
                    var event = _status.event;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (get.itemtype(arguments[i]) == 'player') {
                            next.source = arguments[i];
                        }
                        else if (arguments[i] == 'nosource') {
                            nosource = true;
                        }
                    }
                    if (next.source == undefined &amp;&amp; !nosource) next.source = event.player;
                    next.setContent('link');
                    return next;
                },
                skip: function (name) {
                    this.skipList.add(name);
                },
                wait: function (callback) {
                    if (lib.node) {
                        if (typeof callback == 'function') {
                            callback._noname_waiting = true;
                            lib.node.torespond[this.playerid] = callback;
                        }
                        else {
                            lib.node.torespond[this.playerid] = '_noname_waiting';
                        }
                        clearTimeout(lib.node.torespondtimeout[this.playerid]);
                        if (this.ws &amp;&amp; !this.ws.closed) {
                            var player = this;
                            var time = parseInt(lib.configOL.choose_timeout) * 1000;
                            if (ui.arena &amp;&amp; ui.arena.classList.contains('choose-character') &amp;&amp; lib.configOL.chooseCharacter_timeout) {
                                time *= 5;
                            }
                            if (_status.event.getParent().skillHidden) {
                                for (var i = 0; i &lt; game.players.length; i++) {
                                    game.players[i].showTimer(time);
                                }
                                player._hide_all_timer = true;
                            }
                            else if (!_status.event._global_waiting) {
                                player.showTimer(time);
                            }
                            lib.node.torespondtimeout[this.playerid] = setTimeout(function () {
                                player.unwait('ai');
                                player.ws.ws.close();
                            }, time + 5000);
                        }
                    }
                },
                unwait: function (result) {
                    if (this._hide_all_timer) {
                        delete this._hide_all_timer;
                        for (var i = 0; i &lt; game.players.length; i++) {
                            game.players[i].hideTimer();
                        }
                    }
                    else if (!_status.event._global_waiting) {
                        this.hideTimer();
                    }
                    clearTimeout(lib.node.torespondtimeout[this.playerid]);
                    delete lib.node.torespondtimeout[this.playerid];
                    if (!lib.node.torespond.hasOwnProperty(this.playerid)) {
                        return;
                    }
                    var noresume = false;
                    var proceed = null;
                    if (typeof lib.node.torespond[this.playerid] == 'function' &amp;&amp; lib.node.torespond[this.playerid]._noname_waiting) {
                        proceed = lib.node.torespond[this.playerid](result, this);
                        if (proceed === false) {
                            noresume = true;
                        }
                    }
                    lib.node.torespond[this.playerid] = result;
                    for (var i in lib.node.torespond) {
                        if (lib.node.torespond[i] == '_noname_waiting') {
                            return;
                        }
                        else if (lib.node.torespond[i] &amp;&amp; lib.node.torespond[i]._noname_waiting) {
                            return;
                        }
                    }
                    _status.event.result = result;
                    _status.event.resultOL = lib.node.torespond;
                    lib.node.torespond = {};
                    if (typeof proceed == 'function') proceed();
                    else if (_status.paused &amp;&amp; !noresume) game.resume();
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                logSkill: function (name, targets, nature, logv, audio) {
                    if (get.itemtype(targets) == 'player') targets = [targets];
                    var nopop = false;
                    var popname = name;
                    if (Array.isArray(name)) {
                        popname = name[1];
                        name = name[0];
                    }
                    var checkShow = this.checkShow(name);
                    if (lib.translate[name]) {
                        this.trySkillAnimate(name, popname, checkShow);
                        if (typeof targets == 'object' &amp;&amp; targets.length) {
                            var str;
                            if (targets[0] == this) {
                                str = '#b';
                                if (targets.length > 1) {
                                    str += '';
                                    str += get.translation(targets.slice(1));
                                }
                            }
                            else str = targets;
                            game.log(this, '', str, '', '#p' + get.skillTranslation(name, this) + '');
                        }
                        else {
                            game.log(this, '', '#p' + get.skillTranslation(name, this) + '');
                        }
                    }
                    if (nature != false) {
                        if (nature === undefined) {
                            nature = 'green';
                        }
                        this.line(targets, nature);
                    }
                    var info = lib.skill[name];
                    if (info &amp;&amp; info.ai &amp;&amp; info.ai.expose != undefined &amp;&amp;
                        this.logAi &amp;&amp; (!targets || targets.length != 1 || targets[0] != this)) {
                        this.logAi(lib.skill[name].ai.expose);
                    }
                    if (info &amp;&amp; info.round) {
                        var roundname = name + '_roundcount';
                        this.storage[roundname] = game.roundNumber;
                        this.syncStorage(roundname);
                        this.markSkill(roundname);
                    }
                    if (audio !== false) {
                        game.trySkillAudio(name, this, true);
                    }
                    if (game.chess) {
                        this.chessFocus();
                    }
                    if (logv === true) {
                        game.logv(this, name, targets, null, true);
                    }
                    else if (info &amp;&amp; info.logv !== false) {
                        game.logv(this, name, targets);
                    }
                    if (this._hookTrigger) {
                        for (var i = 0; i &lt; this._hookTrigger.length; i++) {
                            var info = lib.skill[this._hookTrigger[i]].hookTrigger;
                            if (info &amp;&amp; info.log) {
                                info.log(this, name, targets);
                            }
                        }
                    }
                },
                unprompt: function () {
                    if (this.node.prompt) {
                        this.node.prompt.delete();
                        delete this.node.prompt;
                    }
                },
                prompt: function (str, nature) {
                    var node;
                    if (this.node.prompt) {
                        node = this.node.prompt;
                        node.innerHTML = '';
                        node.className = 'damage normal-font damageadded';
                    }
                    else {
                        node = ui.create.div('.damage.normal-font', this);
                        this.node.prompt = node;
                        ui.refresh(node);
                        node.classList.add('damageadded');
                    }
                    node.innerHTML = str;
                    node.dataset.nature = nature || 'soil';
                },
                prompt_old: function (name2, className) {
                    var node;
                    if (this.node.prompt) {
                        node = this.node.prompt;
                        node.innerHTML = '';
                        node.className = 'popup';
                    }
                    else {
                        node = ui.create.div('.popup', this.parentNode);
                        this.node.prompt = node;
                    }
                    node.dataset.position = this.dataset.position;
                    if (this.dataset.position == 0 || parseInt(this.dataset.position) == parseInt(ui.arena.dataset.number) / 2 ||
                        typeof name2 == 'number' || this.classList.contains('minskin')) {
                        node.innerHTML = name2;
                    }
                    else {
                        for (var i = 0; i &lt; name2.length; i++) {
                            node.innerHTML += name2[i] + '&lt;br/>';
                        }
                    }
                    if (className) {
                        node.classList.add(className);
                    }
                },
                /**
                 * 
                 * [recommend] {@link lib.element.player.$damagepop}{@link lib.element.player.$damagepop}
                 * @param {!string} name (||)
                 * @param {string} [classname='water'] 
                 * @param {?boolean} [nobroadcast] true
                 */
                popup: function (name, className, nobroadcast) {
                    var name2 = get.translation(name);
                    if (!name2) return;
                    this.$damagepop(name2, className || 'water', true, nobroadcast);
                },
                popup_old: function (name, className) {
                    var name2 = get.translation(name);
                    var node = ui.create.div('.popup', this.parentNode);
                    if (!name2) {
                        node.remove();
                        return node;
                    }
                    game.addVideo('popup', this, [name, className]);
                    node.dataset.position = this.dataset.position;
                    if (this.dataset.position == 0 || parseInt(this.dataset.position) == parseInt(ui.arena.dataset.number) / 2 ||
                        typeof name2 == 'number' || this.classList.contains('minskin')) {
                        node.innerHTML = name2;
                    }
                    else {
                        for (var i = 0; i &lt; name2.length; i++) {
                            node.innerHTML += name2[i] + '&lt;br/>';
                        }
                    }
                    if (className) {
                        node.classList.add(className);
                    }
                    this.popups.push(node);
                    if (this.popups.length > 1) {
                        node.hide();
                    }
                    else {
                        var that = this;
                        setTimeout(function () { that._popup(); }, 1000);
                    }
                    return node;
                },
                _popup: function () {
                    if (this.popups.length) {
                        this.popups.shift().delete();
                        if (this.popups.length) {
                            this.popups[0].show();
                            var that = this;
                            setTimeout(function () { that._popup(); }, 1000);
                        }
                    }
                },
                showTimer: function (time) {
                    if (!time &amp;&amp; lib.configOL) {
                        time = parseInt(lib.configOL.choose_timeout) * 1000;
                    }
                    // if(ui.arena&amp;&amp;ui.arena.classList.contains('choose-character')&amp;&amp;lib.configOL.chooseCharacter_timeout){
                    // 	time *= 5;
                    // }
                    if (_status.connectMode &amp;&amp; !game.online) {
                        game.broadcast(function (player, time) {
                            player.showTimer(time);
                        }, this, time);
                    }
                    if (this == game.me) {
                        return;
                    }
                    if (this.node.timer) {
                        this.node.timer.remove();
                    }
                    var timer = ui.create.div('.timerbar', this);
                    this.node.timer = timer;
                    ui.create.div(this.node.timer);
                    var bar = ui.create.div(this.node.timer);
                    ui.refresh(bar);
                    bar.style.transitionDuration = (time / 1000) + 's';
                    bar.style.width = 0;
                },
                hideTimer: function () {
                    if (_status.connectMode &amp;&amp; !game.online &amp;&amp; this.playerid) {
                        game.broadcast(function (player) {
                            player.hideTimer();
                        }, this);
                    }
                    if (this.node.timer) {
                        this.node.timer.delete();
                        delete this.node.timer;
                    }
                },
                markAuto: function (name, info) {
                    if (Array.isArray(info)) {
                        if (!Array.isArray(this.storage[name])) this.storage[name] = [];
                        this.storage[name].addArray(info);
                        this.markSkill(name);
                    }
                    else {
                        var storage = this.storage[name];
                        if (Array.isArray(storage)) {
                            this[storage.length > 0 ? 'markSkill' : 'unmarkSkill'](name);
                        }
                        else if (typeof storage == 'number') {
                            this[storage.length > 0 ? 'markSkill' : 'unmarkSkill'](name);
                        }
                    }
                },
                unmarkAuto: function (name, info) {
                    var storage = this.storage[name]
                    if (Array.isArray(info) &amp;&amp; Array.isArray(storage)) {
                        storage.removeArray(info.slice(0));
                        this.markAuto(name);
                    }
                },
                getStorage: function (name) {
                    return this.storage[name] || [];
                },
                markSkill: function (name, info, card) {
                    if (info === true) {
                        this.syncStorage(name);
                        info = null;
                    }
                    if (get.itemtype(card) == 'card') {
                        game.addVideo('markSkill', this, [name, get.cardInfo(card)]);
                    }
                    else {
                        game.addVideo('markSkill', this, [name]);
                    }
                    game.broadcastAll(function (storage, player, name, info, card) {
                        if (storage != undefined) {
                            player.storage[name] = storage;
                        }
                        if (!info) {
                            if (player.marks[name]) {
                                player.updateMarks();
                                return;
                            }
                            if (lib.skill[name]) {
                                info = lib.skill[name].intro;
                            }
                            if (!info) {
                                return;
                            }
                        }
                        if (player.marks[name]) {
                            player.marks[name].info = info;
                        }
                        else {
                            if (card) {
                                player.marks[name] = player.mark(card, info, name);
                            }
                            else {
                                player.marks[name] = player.mark(name, info);
                            }
                        }
                        player.updateMarks();
                    }, this.storage[name], this, name, info, card);
                    return this;
                },
                unmarkSkill: function (name) {
                    game.addVideo('unmarkSkill', this, name);
                    game.broadcast(function (player, name) {
                        if (player.marks[name]) {
                            player.marks[name].delete();
                            player.marks[name].style.transform += ' scale(0.2)';
                            delete player.marks[name];
                            ui.updatem(player);
                        }
                    }, this, name);
                    if (this.marks[name]) {
                        this.marks[name].delete();
                        this.marks[name].style.transform += ' scale(0.2)';
                        delete this.marks[name];
                        ui.updatem(this);
                        var info = lib.skill[name];
                        if (info &amp;&amp; info.intro &amp;&amp; info.intro.onunmark) {
                            if (info.intro.onunmark == 'throw') {
                                if (get.itemtype(this.storage[name]) == 'cards') {
                                    this.$throw(this.storage[name], 1000);
                                    game.cardsDiscard(this.storage[name]);
                                    game.log(this.storage[name], '');
                                    this.storage[name].length = 0;
                                }
                            }
                            else if (typeof info.intro.onunmark == 'function') {
                                info.intro.onunmark(this.storage[name], this);
                            }
                        }
                    }
                    return this;
                },
                markSkillCharacter: function (id, target, name, content) {
                    if (typeof target == 'object') {
                        target = target.name;
                    }
                    game.broadcastAll(function (player, target, name, content, id) {
                        if (player.marks[id]) {
                            player.marks[id].name = name + '_charactermark';
                            player.marks[id]._name = target;
                            player.marks[id].info = {
                                name: name,
                                content: content,
                                id: id
                            };
                            player.marks[id].setBackground(target, 'character');
                            game.addVideo('changeMarkCharacter', player, {
                                id: id,
                                name: name,
                                content: content,
                                target: target
                            });
                        }
                        else {
                            player.marks[id] = player.markCharacter(target, {
                                name: name,
                                content: content,
                                id: id
                            });
                            player.marks[id]._name = target;
                            game.addVideo('markCharacter', player, {
                                name: name,
                                content: content,
                                id: id,
                                target: target
                            });
                        }
                    }, this, target, name, content, id);
                    return this;
                },
                markCharacter: function (name, info, learn, learn2) {
                    if (typeof name == 'object') {
                        name = name.name;
                    }
                    var node;
                    if (name.indexOf('unknown') == 0) {
                        node = ui.create.div('.card.mark.drawinghidden');
                        ui.create.div('.background.skillmark', node).innerHTML = get.translation(name)[0];
                    }
                    else {
                        if (!lib.character[name]) return;
                        node = ui.create.div('.card.mark.drawinghidden').setBackground(name, 'character');
                    }
                    this.node.marks.insertBefore(node, this.node.marks.childNodes[1]);
                    node.name = name + '_charactermark';
                    if (!info) {
                        info = {};
                    }
                    if (!info.name) {
                        info.name = get.translation(name);
                    }
                    if (!info.content) {
                        info.content = get.skillintro(name, learn, learn2)
                    }
                    node.info = info;
                    node.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.card);
                    if (!lib.config.touchscreen) {
                        if (lib.config.hover_all) {
                            lib.setHover(node, ui.click.hoverplayer);
                        }
                        if (lib.config.right_info) {
                            node.oncontextmenu = ui.click.rightplayer;
                        }
                    }
                    ui.updatem(this);
                    return node;
                },
                /**
                 * 
                 * @function
                 * @param {(Array&lt;Card>|Card|string)} name 
                 * @param {*} info mark info
                 * @param {*} skill 
                 * @returns {*}
                 */
                mark: function (name, info, skill) {
                    if (get.itemtype(name) == 'cards') {
                        var marks = [];
                        for (var i = 0; i &lt; name.length; i++) {
                            marks.push(this.mark(name[i], info));
                        }
                        return marks;
                    }
                    else {
                        var node;
                        if (get.itemtype(name) == 'card') {
                            node = name.copy('mark');
                            node.classList.add('drawinghidden');
                            this.node.marks.insertBefore(node, this.node.marks.childNodes[1]);
                            node.suit = name.suit;
                            node.number = name.number;
                            // if(name.name&amp;&amp;lib.card[name.name]&amp;&amp;lib.card[name.name].markimage){
                            //     node.node.image.style.left=lib.card[name.name].markimage;
                            // }

                            if (name.classList.contains('fullborder')) {
                                node.classList.add('fakejudge');
                                node.classList.add('fakemark');
                                (node.querySelector('.background') || ui.create.div('.background', node)).innerHTML = lib.translate[name.name + '_bg'] || get.translation(name.name)[0];
                            }

                            name = name.name;
                        }
                        else {
                            node = ui.create.div('.card.mark.drawinghidden');
                            this.node.marks.insertBefore(node, this.node.marks.childNodes[1]);
                            var str = lib.translate[name + '_bg'];
                            if (!str || str[0] == '+' || str[0] == '-') {
                                str = get.translation(name)[0];
                            }
                            ui.create.div('.background.skillmark', node).innerHTML = str;
                            // node.style.fontFamily=lib.config.card_font;
                        }
                        node.name = name;
                        node.skill = skill || name;
                        if (typeof info == 'object') {
                            node.info = info;
                        }
                        else if (typeof info == 'string') {
                            node.markidentifer = info;
                        }
                        node.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.card);
                        if (!lib.config.touchscreen) {
                            if (lib.config.hover_all) {
                                lib.setHover(node, ui.click.hoverplayer);
                            }
                            if (lib.config.right_info) {
                                node.oncontextmenu = ui.click.rightplayer;
                            }
                        }
                        this.updateMarks();
                        ui.updatem(this);
                        return node;
                    }
                },
                /**
                 * 
                 * @function
                 * @param {*} name
                 * @param {*} info
                 */
                unmark: function (name, info) {
                    game.addVideo('unmarkname', this, name);
                    if (get.itemtype(name) == 'card') {
                        this.unmark(name.name, info);
                    }
                    else if (get.itemtype(name) == 'cards') {
                        for (var i = 0; i &lt; name.length; i++) {
                            this.unmark(name[i].name, info);
                        }
                    }
                    else {
                        for (var i = 0; i &lt; this.node.marks.childNodes.length; i++) {
                            if (this.node.marks.childNodes[i].name == name &amp;&amp;
                                (!info || this.node.marks.childNodes[i].markidentifer == info)) {
                                this.node.marks.childNodes[i].delete();
                                this.node.marks.childNodes[i].style.transform += ' scale(0.2)';
                                ui.updatem(this);
                                return;
                            }
                        }
                    }
                },
                addLink: function () {
                    if (get.is.linked2(this)) {
                        this.classList.add('linked2');
                    }
                    else {
                        this.classList.add('linked');
                    }
                },
                removeLink: function () {
                    if (get.is.linked2(this)) {
                        this.classList.remove('linked2');
                    }
                    else {
                        this.classList.remove('linked');
                    }
                },
                /**
                 * ()
                 * @returns {!boolean}
                 */
                canUse: function (card, target, distance, includecard) {
                    if (typeof card == 'string') card = { name: card, isCard: true };
                    var info = get.info(card);
                    if (info.multicheck &amp;&amp; !info.multicheck(card, this)) return false;
                    if (!lib.filter.cardEnabled(card, this)) return false;
                    if (distance !== false &amp;&amp; !lib.filter.targetInRange(card, this, target)) return false;
                    return lib.filter[includecard ? 'targetEnabledx' : 'targetEnabled'](card, this, target);
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                hasUseTarget: function (card, distance, includecard) {
                    var player = this;
                    return game.hasPlayer(function (current) {
                        return player.canUse(card, current, distance, includecard);
                    });
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                hasValueTarget: function () {
                    return this.getUseValue.apply(this, arguments) > 0;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                getUseValue: function (card, distance, includecard) {
                    if (typeof (card) == 'string') {
                        card = { name: card, isCard: true };
                    }
                    var player = this;
                    var targets = game.filterPlayer();
                    var value = [];
                    var min = 0;
                    var info = get.info(card);
                    if (!info || info.notarget) return 0;
                    var range;
                    var select = get.copy(info.selectTarget);
                    if (select == undefined) {
                        if (info.filterTarget == undefined) return true;
                        range = [1, 1];
                    }
                    else if (typeof select == 'number') range = [select, select];
                    else if (get.itemtype(select) == 'select') range = select;
                    else if (typeof select == 'function') range = select(card, player);
                    if (info.singleCard) range = [1, 1];
                    game.checkMod(card, player, range, 'selectTarget', player);
                    if (!range) return 0;

                    for (var i = 0; i &lt; targets.length; i++) {
                        if (player.canUse(card, targets[i], distance, includecard)) {
                            var eff = get.effect(targets[i], card, player, player);
                            value.push(eff);
                        }
                    }
                    value.sort(function (a, b) {
                        return b - a;
                    });
                    for (var i = 0; i &lt; value.length; i++) {
                        if (i == range[1] || range[1] != -1 &amp;&amp; value[i] &lt;= 0) break;
                        min += value[i];
                    }
                    return min;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                addSubPlayer: function (cfg) {
                    var skill = 'subplayer_' + cfg.name + '_' + get.id();
                    game.log(this, '', '#g' + get.translation(cfg.name))
                    cfg.hs = cfg.hs || [];
                    cfg.es = cfg.es || [];
                    cfg.skills = cfg.skills || [];
                    cfg.hp = cfg.hp || 1;
                    cfg.maxHp = cfg.maxHp || 1;
                    cfg.sex = cfg.sex || 'male';
                    cfg.group = cfg.group || 'qun';
                    cfg.skill = cfg.skill || _status.event.name;
                    if (!cfg.source) {
                        if (this.hasSkill(_status.event.name) &amp;&amp; this.name2 &amp;&amp; lib.character[this.name2] &amp;&amp;
                            lib.character[this.name2][3].contains(_status.event.name)) {
                            cfg.source = this.name2;
                        }
                        else {
                            cfg.source = this.name;
                        }
                    }
                    game.broadcastAll(function (player, skill, cfg) {
                        lib.skill[skill] = {
                            intro: {
                                content: cfg.intro || ''
                            },
                            mark: 'character',
                            subplayer: cfg.skill,
                            ai: {
                                subplayer: true
                            }
                        }
                        lib.character[skill] = [cfg.sex, cfg.group, cfg.maxHp, cfg.skills, ['character:' + cfg.name]];
                        lib.translate[skill] = cfg.caption || get.rawName(cfg.name);
                        player.storage[skill] = cfg;
                    }, this, skill, cfg);
                    game.addVideo('addSubPlayer', this, [skill, lib.skill[skill], lib.character[skill], lib.translate[skill], { name: cfg.name }]);
                    this.addSkill(skill);
                    return skill;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                removeSubPlayer: function (name) {
                    if (this.hasSkill('subplayer') &amp;&amp; this.name == name) {
                        this.exitSubPlayer(true);
                    }
                    else {
                        if (player.storage[name].onremove) {
                            player.storage[name].onremove(player);
                        }
                        this.removeSkill(name);
                        delete this.storage[name];
                        game.log(player, '', '#g' + name);
                        _status.event.trigger('removeSubPlayer');
                    }
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                callSubPlayer: function () {
                    if (this.hasSkill('subplayer')) return;
                    var next = game.createEvent('callSubPlayer');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'string') {
                            next.directresult = arguments[i];
                        }
                    }
                    next.setContent('callSubPlayer');
                    return next;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                toggleSubPlayer: function () {
                    if (!this.hasSkill('subplayer')) return;
                    var next = game.createEvent('toggleSubPlayer');
                    next.player = this;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'string') {
                            next.directresult = arguments[i];
                        }
                    }
                    next.setContent('toggleSubPlayer');
                    return next;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                exitSubPlayer: function (remove) {
                    if (!this.hasSkill('subplayer')) return;
                    var next = game.createEvent('exitSubPlayer');
                    next.player = this;
                    next.remove = remove;
                    next.setContent('exitSubPlayer');
                    return next;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                getSubPlayers: function (tag) {
                    var skills = this.getSkills();
                    var list = [];
                    for (var i = 0; i &lt; skills.length; i++) {
                        var name = skills[i];
                        var info = lib.skill[name];
                        if (tag &amp;&amp; info.subplayer != tag) continue;
                        if (info.ai &amp;&amp; info.ai.subplayer &amp;&amp; this.storage[name] &amp;&amp; this.storage[name].name) {
                            list.push(name);
                        }
                    }
                    return list;
                },
                /**
                 * info.global{@link lib.skill.global}
                 * @returns {!boolean}
                 */
                addSkillTrigger: function (skill, hidden, triggeronly) {
                    var info = lib.skill[skill];
                    if (!info) return;
                    if (typeof info.group == 'string') {
                        this.addSkillTrigger(info.group, hidden);
                    }
                    else if (Array.isArray(info.group)) {
                        for (var i = 0; i &lt; info.group.length; i++) {
                            this.addSkillTrigger(info.group[i], hidden);
                        }
                    }
                    if (!triggeronly) {
                        if (info.global &amp;&amp; (!hidden || info.globalSilent)) {
                            if (typeof info.global == 'string') {
                                game.addGlobalSkill(info.global, this);
                            }
                            else {
                                for (var j = 0; j &lt; info.global.length; j++) {
                                    game.addGlobalSkill(info.global[j], this);
                                }
                            }
                        }
                        if (this.initedSkills.contains(skill)) return this;
                        this.initedSkills.push(skill);
                        if (info.init &amp;&amp; !_status.video) {
                            info.init(this, skill);
                        }
                    }
                    if (info.trigger &amp;&amp; this.playerid) {
                        var playerid = this.playerid;
                        var setTrigger = function (i, evt) {
                            if (i == 'global') {
                                if (!lib.hook.globaltrigger[evt]) {
                                    lib.hook.globaltrigger[evt] = {};
                                }
                                if (!lib.hook.globaltrigger[evt][playerid]) {
                                    lib.hook.globaltrigger[evt][playerid] = [];
                                }
                                lib.hook.globaltrigger[evt][playerid].add(skill);
                            }
                            else {
                                var name = playerid + '_' + i + '_' + evt;
                                if (!lib.hook[name]) {
                                    lib.hook[name] = [];
                                }
                                lib.hook[name].add(skill);
                            }
                            lib.hookmap[evt] = true;
                        }
                        for (var i in info.trigger) {
                            if (typeof info.trigger[i] == 'string') {
                                setTrigger(i, info.trigger[i]);
                            }
                            else if (Array.isArray(info.trigger[i])) {
                                for (var j = 0; j &lt; info.trigger[i].length; j++) {
                                    setTrigger(i, info.trigger[i][j]);
                                }
                            }
                        }
                    }
                    if (info.hookTrigger) {
                        if (!this._hookTrigger) {
                            this._hookTrigger = [];
                        }
                        this._hookTrigger.add(skill);
                    }
                    if (_status.event &amp;&amp; _status.event.addTrigger) _status.event.addTrigger(skill, this);
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                addSkillLog: function (skill) {
                    this.addSkill(skill);
                    this.popup(skill);
                    game.log(this, '', '#g' + get.translation(skill) + '');
                },
                /**
                 * 
                 * @name lib.element.player.addSkill
                 * @function
                 * @param {Array&lt;string>} skills 
                 * @param {?boolean} [checkConflict] truefalse
                 * @param {?boolean} [nobroadcast] truefalse{@link game.broadcast}
                 * @returns {string} `skill`undefined
                 * @see {@link lib.element.player.addSkill(2)}
                 */
                /**
                 * 
                 * @name lib.element.player.addSkill
                 * @function
                 * @variation 2
                 * @param {!string} skill 
                 * @param {?boolean} [checkConflict] truefalse
                 * @param {?boolean} [nobroadcast] truefalse{@link game.broadcast}
                 * @returns {string} `skill`undefined
                 */
                addSkill: function (skill, checkConflict, nobroadcast) {
                    if (Array.isArray(skill)) {
                        for (var i = 0; i &lt; skill.length; i++) {
                            this.addSkill(skill[i]);
                        }
                    }
                    else {
                        if (this.skills.contains(skill)) return;
                        var info = lib.skill[skill];
                        if (!info) return;
                        if (!nobroadcast) {
                            game.broadcast(function (player, skill) {
                                player.skills.add(skill);
                            }, this, skill);
                        }
                        this.skills.add(skill);
                        this.addSkillTrigger(skill);
                        if (this.awakenedSkills.contains(skill)) {
                            this.awakenSkill(skill);
                            return;
                        }
                        if (info.init2 &amp;&amp; !_status.video) {
                            info.init2(this, skill);
                        }
                        if (info.mark) {
                            if (info.mark == 'card' &amp;&amp;
                                get.itemtype(this.storage[skill]) == 'card') {
                                this.markSkill(skill, null, this.storage[skill]);
                            }
                            else if (info.mark == 'card' &amp;&amp;
                                get.itemtype(this.storage[skill]) == 'cards') {
                                this.markSkill(skill, null, this.storage[skill][0]);
                            }
                            else if (info.mark == 'image') {
                                this.markSkill(skill, null, ui.create.card(null, 'noclick').init([null, null, skill]));
                            }
                            else if (info.mark == 'character') {
                                var intro = info.intro.content;
                                if (typeof intro == 'function') {
                                    intro = intro(this.storage[skill], this);
                                }
                                else if (typeof intro == 'string') {
                                    intro = intro.replace(/#/g, this.storage[skill]);
                                    intro = intro.replace(/&amp;/g, get.cnNumber(this.storage[skill]));
                                    intro = intro.replace(/\$/g, get.translation(this.storage[skill]));
                                }
                                var caption;
                                if (typeof info.intro.name == 'function') {
                                    caption = info.intro.name(this.storage[skill], this);
                                }
                                else if (typeof info.intro.name == 'string') {
                                    caption = info.name;
                                }
                                else {
                                    caption = get.translation(skill);
                                }
                                this.markSkillCharacter(skill, this.storage[skill], caption, intro);
                            }
                            else {
                                this.markSkill(skill);
                            }
                        }
                    }
                    if (checkConflict) this.checkConflict();
                    return skill;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                addAdditionalSkill: function (skill, skills, keep) {
                    if (this.additionalSkills[skill]) {
                        if (keep) {
                            if (typeof this.additionalSkills[skill] == 'string') {
                                this.additionalSkills[skill] = [this.additionalSkills[skill]];
                            }
                        }
                        else {
                            this.removeAdditionalSkill(skill);
                            this.additionalSkills[skill] = [];
                        }
                    }
                    else {
                        this.additionalSkills[skill] = [];
                    }
                    if (typeof skills == 'string') {
                        skills = [skills];
                    }
                    for (var i = 0; i &lt; skills.length; i++) {
                        this.addSkill(skills[i], null, true);
                        this.skills.remove(skills[i]);
                        this.additionalSkills[skill].push(skills[i]);
                    }
                    this.checkConflict();
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                removeAdditionalSkill: function (skill, target) {
                    if (this.additionalSkills[skill]) {
                        var additionalSkills = this.additionalSkills[skill];
                        if (Array.isArray(additionalSkills) &amp;&amp; typeof target == 'string') {
                            if (additionalSkills.contains(target)) {
                                additionalSkills.remove(target);
                                this.removeSkill(target);
                            }
                        }
                        else {
                            delete this.additionalSkills[skill];
                            if (typeof additionalSkills == 'string') {
                                this.removeSkill(additionalSkills);
                            }
                            else if (Array.isArray(additionalSkills)) {
                                for (var i = 0; i &lt; additionalSkills.length; i++) {
                                    this.removeSkill(additionalSkills[i]);
                                }
                            }
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                awakenSkill: function (skill, nounmark) {
                    if (!nounmark) this.unmarkSkill(skill);
                    this.disableSkill(skill + '_awake', skill);
                    this.awakenedSkills.add(skill);
                    if (this.storage[skill] === false) this.storage[skill] = true;
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                restoreSkill: function (skill, nomark) {
                    if (this.storage[skill] === true) this.storage[skill] = false;
                    this.awakenedSkills.remove(skill);
                    this.enableSkill(skill + '_awake', skill);
                    if (!nomark) this.markSkill(skill);
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                disableSkill: function (skill, skills) {
                    if (typeof skills == 'string') {
                        if (!this.disabledSkills[skills]) {
                            this.disabledSkills[skills] = [];
                            var info = get.info(skills);
                            if (info.ondisable &amp;&amp; info.onremove) {
                                info.onremove(this);
                            }
                        }
                        this.disabledSkills[skills].add(skill);
                        var group = lib.skill[skills].group;
                        if (typeof group == 'string' || Array.isArray(group)) {
                            this.disableSkill(skill, group);
                        }
                    }
                    else if (Array.isArray(skills)) {
                        for (var i = 0; i &lt; skills.length; i++) {
                            this.disableSkill(skill, skills[i]);
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                enableSkill: function (skill) {
                    for (var i in this.disabledSkills) {
                        this.disabledSkills[i].remove(skill);
                        if (this.disabledSkills[i].length == 0) {
                            delete this.disabledSkills[i];
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                checkMarks: function () {
                    var skills = this.getSkills();
                    game.expandSkills(skills);
                    for (var i in this.marks) {
                        if (!skills.contains(i) &amp;&amp; !this.marks[i].info.fixed) {
                            this.unmarkSkill(i);
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                addEquipTrigger: function (card) {
                    if (card) {
                        var info = get.info(card);
                        if (info.skills) {
                            for (var j = 0; j &lt; info.skills.length; j++) {
                                this.addSkillTrigger(info.skills[j]);
                            }
                        }
                    }
                    else {
                        var es = this.getCards('e');
                        for (var i = 0; i &lt; es.length; i++) {
                            this.addEquipTrigger(es[i]);
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                removeEquipTrigger: function (card, move) {
                    if (card) {
                        var info = get.info(card);
                        if (move === false) {
                            if (card.originalName) {
                                card.classList.remove('fakejudge');
                                if (get.type(card.originalName) == 'equip') {
                                    card.classList.remove(get.subtype(card.viewAs));
                                    card.classList.add(get.subtype(card.originalName));
                                } else {
                                    card.classList.remove(get.subtype(card.viewAs));
                                }
                                card.name = card.originalName;
                                delete card.viewAs;
                                delete card.originalName;
                            }
                        } else {
                            //	if(card.viewAs&amp;&amp;card.originalName&amp;&amp;card.originalName){
                            //		card.name = card.originalName
                            //	}
                        }
                        var skills = this.getSkills(null, false);
                        if (info.skills) {
                            for (var j = 0; j &lt; info.skills.length; j++) {
                                if (skills.contains(info.skills[j])) continue;
                                this.removeSkillTrigger(info.skills[j]);
                            }
                        }
                        if (info.clearLose &amp;&amp; typeof info.onLose == 'function') {
                            var next = game.createEvent('lose_' + card.name);
                            next.setContent(info.onLose);
                            next.player = this;
                            next.card = card;
                        }
                    }
                    else {
                        var es = this.getCards('e');
                        for (var i = 0; i &lt; es.length; i++) {
                            this.removeEquipTrigger(es[i]);
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                removeSkillTrigger: function (skill, triggeronly) {
                    var info = lib.skill[skill];
                    if (!info) return;
                    if (typeof info.group == 'string') {
                        this.removeSkillTrigger(info.group);
                    }
                    else if (Array.isArray(info.group)) {
                        for (var i = 0; i &lt; info.group.length; i++) {
                            this.removeSkillTrigger(info.group[i]);
                        }
                    }
                    if (!triggeronly) this.initedSkills.remove(skill);
                    if (info.trigger) {
                        var playerid = this.playerid;
                        var removeTrigger = function (i, evt) {
                            if (i == 'global') {
                                for (var j in lib.hook.globaltrigger) {
                                    if (lib.hook.globaltrigger[j][playerid]) {
                                        lib.hook.globaltrigger[j][playerid].remove(skill);
                                        if (lib.hook.globaltrigger[j][playerid].length == 0) {
                                            delete lib.hook.globaltrigger[j][playerid];
                                        }
                                        if (get.is.empty(lib.hook.globaltrigger[j])) {
                                            delete lib.hook.globaltrigger[j];
                                        }
                                    }
                                }
                            }
                            else {
                                var name = playerid + '_' + i + '_' + evt;
                                if (lib.hook[name]) {
                                    lib.hook[name].remove(skill);
                                    if (lib.hook[name].length == 0) {
                                        delete lib.hook[name];
                                    }
                                }
                            }
                        }
                        for (var i in info.trigger) {
                            if (typeof info.trigger[i] == 'string') {
                                removeTrigger(i, info.trigger[i]);
                            }
                            else if (Array.isArray(info.trigger[i])) {
                                for (var j = 0; j &lt; info.trigger[i].length; j++) {
                                    removeTrigger(i, info.trigger[i][j]);
                                }
                            }
                        }
                    }
                    if (info.hookTrigger) {
                        if (this._hookTrigger) {
                            this._hookTrigger.remove(skill);
                            if (!this._hookTrigger.length) {
                                delete this._hookTrigger;
                            }
                        }
                    }
                    return this;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                removeSkill: function (skill) {
                    if (!skill) return;
                    if (Array.isArray(skill)) {
                        for (var i = 0; i &lt; skill.length; i++) {
                            this.removeSkill(skill[i]);
                        }
                    }
                    else {
                        var info = lib.skill[skill];
                        if (info &amp;&amp; info.fixed &amp;&amp; arguments[1] !== true) return skill;
                        this.unmarkSkill(skill);
                        game.broadcastAll(function (player, skill) {
                            player.skills.remove(skill);
                            player.hiddenSkills.remove(skill);
                        }, this, skill);
                        this.checkConflict(skill);
                        delete this.tempSkills[skill];
                        if (info) {
                            if (info.onremove) {
                                if (typeof info.onremove == 'function') {
                                    info.onremove(this, skill);
                                }
                                else if (typeof info.onremove == 'string') {
                                    if (info.onremove == 'storage') {
                                        delete this.storage[skill];
                                    }
                                    else {
                                        var cards = this.storage[skill];
                                        if (get.itemtype(cards) == 'card') {
                                            cards = [cards];
                                        }
                                        if (get.itemtype(cards) == 'cards') {
                                            if (this.onremove == 'discard') {
                                                this.$throw(cards);
                                            }
                                            if (this.onremove == 'discard' || this.onremove == 'lose') {
                                                game.cardsDiscard(cards);
                                                delete this.storage[skill];
                                            }
                                        }
                                    }
                                }
                                else if (Array.isArray(info.onremove)) {
                                    for (var i = 0; i &lt; info.onremove.length; i++) {
                                        delete this.storage[info.onremove[i]];
                                    }
                                }
                                else if (info.onremove === true) {
                                    delete this.storage[skill];
                                }
                            }
                            this.removeSkillTrigger(skill);
                            if (!info.keepSkill) {
                                this.removeAdditionalSkill(skill);
                            }
                        }
                        this.enableSkill(skill + '_awake');
                    }
                    return skill;
                },
                /**
                 * 
                 * @param {!string} skill 
                 * @param {(string|Object|undefined)} [expire='phaseAfter'] `expire`'phaseAfter'
                 * @param {?boolean} [checkConflict] truefalse
                 * @returns {string} `skill`undefined
                 */
                addTempSkill: function (skill, expire, checkConflict) {
                    if (this.hasSkill(skill) &amp;&amp; this.tempSkills[skill] == undefined) return;
                    var noremove = this.skills.contains(skill);
                    this.addSkill(skill, checkConflict, true);
                    if (!noremove) this.skills.remove(skill);

                    if (!expire) {
                        expire = 'phaseAfter';
                    }
                    this.tempSkills[skill] = expire;

                    if (typeof expire == 'string') {
                        lib.hookmap[expire] = true;
                    }
                    else if (Array.isArray(expire)) {
                        for (var i = 0; i &lt; expire.length; i++) {
                            lib.hookmap[expire[i]] = true;
                        }
                    }
                    else if (get.objtype(expire) == 'object') {
                        var roles = ['player', 'source', 'target'];
                        for (var i = 0; i &lt; roles.length; i++) {
                            if (typeof expire[roles[i]] == 'string') {
                                lib.hookmap[expire[roles[i]]] = true;
                            }
                            else if (Array.isArray(expire[roles[i]])) {
                                for (var j = 0; j &lt; expire[roles[i]].length; j++) {
                                    lib.hookmap[expire[roles[i]][j]] = true;
                                }
                            }
                        }
                        if (expire.global) {
                            if (typeof expire.global == 'string') {
                                lib.hookmap[expire.global] = true;
                            }
                            else if (Array.isArray(expire.global)) {
                                for (var i = 0; i &lt; expire.global.length; i++) {
                                    lib.hookmap[expire.global[i]] = true;
                                }
                            }
                        }
                    }

                    for (var i in expire) {
                        if (typeof expire[i] == 'string') {
                            lib.hookmap[expire[i]] = true;
                        }
                        else if (Array.isArray(expire[i])) {
                            for (var j = 0; j &lt; expire.length; j++) {
                                lib.hookmap[expire[i][j]] = true;
                            }
                        }
                    }
                    return skill;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                attitudeTo: function (target) {
                    if (typeof get.attitude == 'function') return get.attitude(this, target);
                    return 0;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                clearSkills: function (all) {
                    var list = [];
                    var exclude = [];
                    for (var i = 0; i &lt; arguments.length; i++) {
                        exclude.push(arguments[i]);
                    }
                    for (i = 0; i &lt; this.skills.length; i++) {
                        if (lib.skill[this.skills[i]].superCharlotte) continue;
                        if (!all &amp;&amp; (lib.skill[this.skills[i]].temp || lib.skill[this.skills[i]].charlotte)) continue;
                        if (!exclude.contains(this.skills[i])) {
                            list.push(this.skills[i]);
                        }
                    }
                    if (all) {
                        for (var i in this.additionalSkills) {
                            this.removeAdditionalSkill(i);
                        }
                    }
                    this.removeSkill(list);
                    this.checkConflict();
                    this.checkMarks();
                    return list;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                checkConflict: function (skill) {
                    if (skill) {
                        if (this.forbiddenSkills[skill]) {
                            delete this.forbiddenSkills[skill];
                        }
                        else {
                            for (var i in this.forbiddenSkills) {
                                if (this.forbiddenSkills[i].remove(skill)) {
                                    if (!this.forbiddenSkills[i].length) {
                                        delete this.forbiddenSkills[i];
                                    }
                                }
                            }
                        }
                    }
                    else {
                        this.forbiddenSkills = {};
                        var forbid = [];
                        var getName = function (arr) {
                            var str = '';
                            for (var i = 0; i &lt; arr.length; i++) {
                                str += arr[i] + '+';
                            }
                            return str.slice(0, str.length - 1);
                        }
                        var forbidlist = lib.config.forbid.concat(lib.config.customforbid);
                        var skills = this.getSkills();
                        for (var i = 0; i &lt; forbidlist.length; i++) {
                            if (lib.config.customforbid.contains(forbidlist[i]) ||
                                !lib.config.forbidlist.contains(getName(forbidlist[i]))) {
                                for (var j = 0; j &lt; forbidlist[i].length; j++) {
                                    if (!skills.contains(forbidlist[i][j])) break;
                                }
                                if (j == forbidlist[i].length) {
                                    forbid.push(forbidlist[i]);
                                }
                            }
                        }
                        for (var i = 0; i &lt; forbid.length; i++) {
                            if (forbid[i][1] || this.name2) {
                                this.forbiddenSkills[forbid[i][0]] = this.forbiddenSkills[forbid[i][0]] || [];
                                if (forbid[i][1]) {
                                    this.forbiddenSkills[forbid[i][0]].add(forbid[i][1]);
                                }
                            }
                        }
                    }
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                getHistory: function (key, filter, last) {
                    if (!key) return this.actionHistory[this.actionHistory.length - 1];
                    if (!filter) return this.actionHistory[this.actionHistory.length - 1][key];
                    else {
                        var history = this.getHistory(key).slice(0);
                        if (last) history = history.slice(0, history.indexOf(last) + 1);
                        for (var i = 0; i &lt; history.length; i++) {
                            if (!filter(history[i])) history.splice(i--, 1);
                        }
                        return history;
                    }
                },
                hasHistory: function (key, filter, last) {
                    var history = this.getHistory(key).slice(0);
                    if (last) history = history.slice(0, history.indexOf(last) + 1);
                    for (var i = 0; i &lt; history.length; i++) {
                        if (filter(history[i])) return true;
                    }
                    return false;
                },
                /**
                 * ()
                 * @returns {Array}
                 */
                getLastHistory: function (key, filter, last) {
                    var history = false;
                    for (var i = this.actionHistory.length - 1; i >= 0; i--) {
                        if (this.actionHistory[i].isMe) {
                            history = this.actionHistory[i]; break;
                        }
                    }
                    if (!history) return null;
                    if (!key) return history;
                    if (!filter) return history[key];
                    else {
                        history = history.slice(0);
                        if (last) history = history.slice(0, history.indexOf(last) + 1);
                        for (var i = 0; i &lt; history.length; i++) {
                            if (!filter(history[i])) history.splice(i--, 1);
                        }
                        return history;
                    }
                },
                /**
                 *  TODO
                 * @returns {Array}
                 */
                getAllHistory: function (key, filter, last) {
                    var list = [];
                    var all = this.actionHistory;
                    for (var j = 0; j &lt; all.length; j++) {
                        if (!key || !all[j][key]) {
                            list.push(all[j]);
                        }
                        else {
                            if (!filter) list.addArray(all[j][key]);
                            else {
                                var history = all[j][key].slice(0);
                                if (last) history = history.slice(0, history.indexOf(last) + 1);
                                for (var i = 0; i &lt; history.length; i++) {
                                    if (filter(history[i])) list.push(history[i]);
                                }
                            }
                        }
                    }
                    return list;
                },
                hasAllHistory: function (key, filter, last) {
                    var list = [];
                    var all = this.actionHistory;
                    for (var j = 0; j &lt; all.length; j++) {
                        var history = all[j][key].slice(0);
                        if (last) history = history.slice(0, history.indexOf(last) + 1);
                        for (var i = 0; i &lt; history.length; i++) {
                            if (filter(history[i])) return true;
                        }
                    }
                    return false;
                },
                /**
                 * 
                 * @param {number} [idx=0] 0(e.g. `idx >= length`)null
                 * @returns {(GameCores.GameObjects.Card|null)} 
                 */
                getLastUsed: function (num) {
                    if (typeof num != 'number') num = 0;
                    var history = this.getHistory('useCard');
                    if (history.length &lt;= num) return null;
                    return history[history.length - num - 1];
                },
                /**
                 * `stat`
                 * @param {string} [key] `stat`
                 * @returns {?Object}
                 */
                getStat: function (key) {
                    if (!key) return this.stat[this.stat.length - 1];
                    return this.stat[this.stat.length - 1][key];
                },
                /**
                 * `stat` TODO
                 * @param {string} [key] `stat`
                 * @returns {?Object}
                 */
                getLastStat: function (key) {
                    var stat = false;
                    for (var i = this.stat.length - 1; i >= 0; i--) {
                        if (this.stat[i].isMe) {
                            stat = this.stat[i]; break;
                        }
                    }
                    if (!stat) return null
                    if (!key) return stat;
                    return stat[key];
                },
                /**
                 * TimeoutTimeout
                 * @param {(number|false)} [time=500] (ms)falseTimeoutTimeout
                 */
                queue: function (time) {
                    if (time == false) {
                        clearTimeout(this.queueTimeout);
                        this.queueCount = 0;
                        return;
                    }
                    if (time == undefined) time = 500;
                    var player = this;
                    player.queueCount++;
                    this.queueTimeout = setTimeout(function () {
                        player.queueCount--;
                        if (player.queueCount == 0) {
                            player.style.transform = '';
                            player.node.avatar.style.transform = '';
                            player.node.avatar2.style.transform = '';
                            if (game.chess) {
                                ui.placeChess(player, player.dataset.position);
                            }
                            if (player == game.me) ui.me.removeAttribute('style');
                        }
                    }, time)
                },
                /**
                 * **cardUsable**
                 * @param {!string} cardname 
                 * @param {boolean} [ignoreUsed] truefalse
                 * @returns {!number}
                 */
                getCardUsable: function (card, pure) {
                    var player = this;
                    if (typeof card == 'string') {
                        card = { name: card };
                    }
                    card = get.autoViewAs(card, null, player);
                    var num = get.info(card).usable;
                    if (typeof num == 'function') num = num(card, player);
                    num = game.checkMod(card, player, num, 'cardUsable', player);
                    if (typeof num != 'number') return Infinity;
                    if (!pure &amp;&amp; _status.currentPhase == player) {
                        return num - player.countUsed(card);
                    }
                    return num;
                },
                /**
                 * 
                 * @returns {!number}
                 */
                getAttackRange: function (raw) {
                    var player = this;
                    var range = 0;
                    if (raw) range = game.checkMod(player, player, range, 'globalFrom', player);
                    range = game.checkMod(player, player, range, 'attackFrom', player);
                    var equips = player.getCards('e', function (card) {
                        return !ui.selected.cards || !ui.selected.cards.contains(card);
                    });
                    for (var i = 0; i &lt; equips.length; i++) {
                        var info = get.info(equips[i]).distance;
                        if (!info) continue;
                        if (raw &amp;&amp; info.globalFrom) {
                            range += info.globalFrom;
                        }
                        if (info.attackFrom) {
                            range += info.attackFrom;
                        }
                    }
                    return (1 - range);
                },
                /**
                 * TODO
                 * @returns {!boolean}
                 */
                getGlobalFrom: function () {
                    var player = this;
                    var range = 0;
                    range = game.checkMod(player, player, range, 'globalFrom', player);
                    var equips = player.getCards('e', function (card) {
                        return !ui.selected.cards || !ui.selected.cards.contains(card);
                    });
                    for (var i = 0; i &lt; equips.length; i++) {
                        var info = get.info(equips[i]).distance;
                        if (!info) continue;
                        if (info.globalFrom) {
                            range += info.globalFrom;
                        }
                    }
                    return (-range);
                },
                /**
                 * TODO
                 * @returns {!boolean}
                 */
                getGlobalTo: function () {
                    var player = this;
                    var range = 0;
                    range = game.checkMod(player, player, range, 'globalTo', player);
                    var equips = player.getCards('e', function (card) {
                        return !ui.selected.cards || !ui.selected.cards.contains(card);
                    });
                    for (var i = 0; i &lt; equips.length; i++) {
                        var info = get.info(equips[i]).distance;
                        if (!info) continue;
                        if (info.globalTo) {
                            range += info.globalTo;
                        }
                    }
                    return (range);
                },
                /**
                 * **num****maxHandcardBase maxHandcard maxHandcardFinal****num****num****num**0
                 * @returns {!number} 
                 */
                getHandcardLimit: function () {
                    var num = Math.max(this.hp, 0);
                    num = game.checkMod(this, num, 'maxHandcardBase', this);
                    num = game.checkMod(this, num, 'maxHandcard', this);
                    num = game.checkMod(this, num, 'maxHandcardFinal', this);
                    return Math.max(0, num);
                },
                /**
                 * @callback lib.element.player~playerFilterPredicate
                 * @param {!GameCores.GameObjects.Player} player
                 * @returns {!boolean}
                 */
                /**
                 * 
                 * @name lib.element.player.getEnemies
                 * @function
                 * @param {lib.element.player~playerFilterPredicate} [predicate] 
                 * @returns {!GameCores.GameObjects.Player[]} 
                 */
                getEnemies: function (func) {
                    var player = this;
                    var targets;
                    var mode = get.mode();
                    if (mode == 'identity') {
                        if (_status.mode == 'purple') {
                            switch (player.identity) {
                                case 'bZhu': case 'bZhong': case 'rNei': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return ['rZhu', 'rZhong', 'bNei'].contains(target.identity);
                                }); break;
                                case 'rZhu': case 'rZhong': case 'bNei': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return ['bZhu', 'bZhong', 'rNei'].contains(target.identity);
                                }); break;
                                case 'rYe': case 'bYe': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return !['rYe', 'bYe'].contains(target.identity);
                                }); break;
                            }
                        }
                        else {
                            var num = get.population('fan');
                            switch (player.identity) {
                                case 'zhu': case 'zhong': case 'mingzhong': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    if (num >= 3) return target.identity == 'fan';
                                    return target.identity == 'nei' || target.identity == 'fan';
                                }); break;
                                case 'nei': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    if (num >= 3) return target.identity == 'fan';
                                    if (game.players.length == 2) return target != player;
                                    return target.identity == 'zhong' || target.identity == 'mingzhong' || target.identity == 'fan';
                                }); break;
                                case 'fan': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return target.identity != 'fan';
                                }); break;
                            }
                        }
                    }
                    else if (mode == 'guozhan') {
                        if (player.identity == 'ye') {
                            targets = game.filterPlayer(function (target) {
                                if (func &amp;&amp; !func(target)) return false;
                                return true;
                            });
                        }
                        else {
                            var group = lib.character[player.name1][1];
                            targets = game.filterPlayer(function (target) {
                                if (func &amp;&amp; !func(target)) return false;
                                return target.identity == 'ye' || lib.character[target.name1][1] != group;
                            });
                        }
                    }
                    else if (mode == 'doudizhu' || mode == 'longlaoguan') {
                        targets = game.filterPlayer(function (target) {
                            if (func &amp;&amp; !func(target)) return false;
                            return target.identity != player.identity;
                        });
                    }
                    else {
                        targets = game.filterPlayer(function (target) {
                            if (func &amp;&amp; !func(target)) return false;
                            return target.side != player.side;
                        });
                    }
                    targets.remove(player);
                    return targets;
                },
                /**
                 * 
                 * @name lib.element.player.getFriends
                 * @function
                 * @param {lib.element.player~playerFilterPredicate} predicate 
                 * @returns {!GameCores.GameObjects.Player[]} 
                 */
                /**
                 * 
                 * @name lib.element.player.getFriends
                 * @function
                 * @param {?boolean} hasSelf truefalse
                 * @returns {!GameCores.GameObjects.Player[]} 
                 */
                getFriends: function (func) {
                    var player = this;
                    var targets;
                    var mode = get.mode();
                    var self = false;
                    if (func === true) {
                        func = null;
                        self = true;
                    }
                    if (mode == 'identity') {
                        if (_status.mode == 'purple') {
                            switch (player.identity) {
                                case 'rZhu': case 'rZhong': case 'bNei': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return ['rZhu', 'rZhong', 'bNei'].contains(target.identity);
                                }); break;
                                case 'bZhu': case 'bZhong': case 'rNei': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return ['bZhu', 'bZhong', 'rNei'].contains(target.identity);
                                }); break;
                                case 'rYe': case 'bYe': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return ['rYe', 'bYe'].contains(target.identity);
                                }); break;
                            }
                        }
                        else {
                            switch (player.identity) {
                                case 'zhu': case 'zhong': case 'mingzhong': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return ['zhu', 'zhong', 'mingzhong'].contains(target.identity);
                                }); break;
                                case 'nei': targets = []; break;
                                case 'fan': targets = game.filterPlayer(function (target) {
                                    if (func &amp;&amp; !func(target)) return false;
                                    return target.identity == 'fan';
                                }); break;
                            }
                        }
                    }
                    else if (mode == 'guozhan') {
                        if (player.identity == 'ye') {
                            targets = [];
                        }
                        else {
                            var group = lib.character[player.name1][1];
                            targets = game.filterPlayer(function (target) {
                                if (func &amp;&amp; !func(target)) return false;
                                return target.identity != 'ye' &amp;&amp; lib.character[target.name1][1] == group;
                            });
                        }
                    }
                    else if (mode == 'doudizhu' || mode == 'longlaoguan') {
                        targets = game.filterPlayer(function (target) {
                            if (func &amp;&amp; !func(target)) return false;
                            return target.identity == player.identity;
                        });
                    }
                    else {
                        targets = game.filterPlayer(function (target) {
                            if (func &amp;&amp; !func(target)) return false;
                            return target.side == player.side;
                        });
                    }
                    if (self) {
                        targets.add(player);
                    }
                    else {
                        targets.remove(player);
                    }
                    return targets;
                },
                /**
                 * 
                 * @param {!GameCores.GameObjects.Player} player 
                 * @returns {!boolean}
                 */
                isEnemyOf: function () {
                    return !this.isFriendOf.apply(this, arguments);
                },
                /**
                 * 
                 * @param {!GameCores.GameObjects.Player} player 
                 * @returns {!boolean}
                 */
                isFriendOf: function (player) {
                    if (get.mode() == 'guozhan') {
                        if (this == player) return true;
                        if (this.storage.yexinjia_friend == player || player.storage.yexinjia_friend == this) return true;
                        if (this.identity == 'unknown' || this.identity == 'ye') return false;
                        if (player.identity == 'unknown' || player.identity == 'ye') return false;
                        return this.identity == player.identity;
                    }
                    if (get.mode() == 'doudizhu' || get.mode() == 'longlaoguan') {
                        return this.identity == player.identity;
                    }
                    if (this.side != undefined &amp;&amp; typeof player.side == 'boolean') {
                        return this.side == player.side;
                    }
                    return this == player;
                },
                /**
                 * 
                 * @param {!GameCores.GameObjects.Player} player 
                 * @returns {!boolean}
                 */
                isFriendsOf: function (player) {
                    return player.getFriends(true).contains(this);
                },
                /**
                 * 
                 * @param {!GameCores.GameObjects.Player} player 
                 * @returns {!boolean}
                 */
                isEnemiesOf: function (player) {
                    return player.getEnemies().contains(this);
                },
                /**
                 * 
                 * @returns {!boolean} truefalse
                 */
                isAlive: function () {
                    return this.classList.contains('dead') == false;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                isDead: function () {
                    return this.classList.contains('dead');
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                isDying: function () {
                    return _status.dying.contains(this) &amp;&amp; this.hp &lt;= 0 &amp;&amp; this.isAlive();
                },
                /**
                 * **HP**false
                 * @returns {!boolean}
                 */
                isDamaged: function () {
                    return this.hp &lt; this.maxHp &amp;&amp; !this.storage.nohp;
                },
                /**
                 * **HP**true
                 * @returns {!boolean}
                 */
                isHealthy: function () {
                    return this.hp == this.maxHp || this.storage.nohp;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMaxHp: function (equal) {
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].hp >= this.hp) return false;
                        }
                        else {
                            if (game.players[i].hp > this.hp) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMinHp: function (equal) {
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].hp &lt;= this.hp) return false;
                        }
                        else {
                            if (game.players[i].hp &lt; this.hp) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMaxCard: function (equal) {
                    var nh = this.countCards('he');
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].countCards('he') >= nh) return false;
                        }
                        else {
                            if (game.players[i].countCards('he') > nh) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMinCard: function (equal) {
                    var nh = this.countCards('he');
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].countCards('he') &lt;= nh) return false;
                        }
                        else {
                            if (game.players[i].countCards('he') &lt; nh) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMaxHandcard: function (equal) {
                    var nh = this.countCards('h');
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].countCards('h') >= nh) return false;
                        }
                        else {
                            if (game.players[i].countCards('h') > nh) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMinHandcard: function (equal) {
                    var nh = this.countCards('h');
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].countCards('h') &lt;= nh) return false;
                        }
                        else {
                            if (game.players[i].countCards('h') &lt; nh) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMaxEquip: function (equal) {
                    var nh = this.countCards('e');
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].countCards('e') >= nh) return false;
                        }
                        else {
                            if (game.players[i].countCards('e') > nh) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @param {boolean} [isUnique] truetruefalsetrue
                 * @returns {!boolean}
                 */
                isMinEquip: function (equal) {
                    var nh = this.countCards('e');
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut() || game.players[i] == this) continue;
                        if (equal) {
                            if (game.players[i].countCards('e') &lt;= nh) return false;
                        }
                        else {
                            if (game.players[i].countCards('e') &lt; nh) return false;
                        }
                    }
                    return true;
                },
                /**
                 * 
                 * @returns {!boolean} truefalse
                 */
                isLinked: function () {
                    if (get.is.linked2(this)) {
                        return this.classList.contains('linked2');
                    }
                    return this.classList.contains('linked');
                },
                /**
                 * 
                 * @returns {!boolean} truefalse
                 */
                isTurnedOver: function () {
                    return this.classList.contains('turnedover');
                },
                /**
                 * 
                 * @returns {!boolean} truefalse
                 */
                isOut: function () {
                    return this.classList.contains('out');
                },
                /**
                 * 
                 * @param {?boolean} [distance]
                 * @returns {!boolean}
                 */
                //TODO
                isMin: function (distance) {
                    if (distance &amp;&amp; lib.config.mode != 'stone') return false;
                    if (this.forcemin) return true;
                    return this.classList.contains('minskin') &amp;&amp; !game.chess;
                },
                /**
                 * (&amp;&amp;)
                 * @returns {!boolean} truefalse
                 */
                isIn: function () {
                    return this.classList.contains('dead') == false &amp;&amp; this.classList.contains('out') == false &amp;&amp; !this.removed;
                },
                /**
                 * true
                 * @param {number} num **0**: unseen; **1**: unseen2; **2**: unseen &amp;&amp; unseen2; **default**: unseen &amp;&amp; !unseen2 
                 * @returns {!boolean}
                 */
                isUnseen: function (num) {
                    switch (num) {
                        case 0: return this.classList.contains('unseen');
                        case 1: return this.classList.contains('unseen2');
                        case 2: return this.classList.contains('unseen') || this.classList.contains('unseen2');
                        default: return this.classList.contains('unseen') &amp;&amp; (!this.name2 || this.classList.contains('unseen2'));
                    }
                },
                /**
                 * 
                 * @param {?boolean} self truetruefalsefalse
                 * @param {GameCores.GameObjects.Player} [me] `me``game.me`
                 * @returns {!boolean}
                 */
                isUnderControl: function (self, me) {
                    me = (me || game.me);
                    var that = this._trueMe || this;
                    if (that.isMad() || game.notMe) return false;
                    if (this === me) {
                        if (self) return true;
                        return false;
                    }
                    if (that === me || this == me._trueMe) return true;
                    if (_status.connectMode) return false;
                    if (lib.config.mode == 'versus') {
                        if (_status.mode == 'three') return this.side == me.side;
                        if (_status.mode == 'standard') return lib.storage.single_control &amp;&amp; this.side == me.side;
                        if (_status.mode == 'four') return get.config('four_phaseswap') &amp;&amp; this.side == me.side;
                        if (_status.mode == 'two') return get.config('two_phaseswap') &amp;&amp; this.side == me.side;
                        return false;
                    }
                    else if (lib.config.mode == 'boss') {
                        if (me.side) return false;
                        return this.side == me.side &amp;&amp; get.config('single_control');
                    }
                    else if (game.chess) {
                        if (lib.config.mode == 'chess') {
                            if (_status.mode == 'combat' &amp;&amp; !get.config('single_control')) return false;
                        }
                        return this.side == me.side;
                    }
                    return false;
                },
                /**
                 * 
                 * false
                 * @returns {!boolean}
                 */
                isOnline: function () {
                    if (this.ws &amp;&amp; lib.node &amp;&amp; !this.ws.closed &amp;&amp; this.ws.inited &amp;&amp; !this.isAuto) {
                        return true;
                    }
                    return false;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                isOnline2: function () {
                    if (this.ws &amp;&amp; lib.node &amp;&amp; !this.ws.closed) {
                        return true;
                    }
                    return false;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                isOffline: function () {
                    if (this.ws &amp;&amp; lib.node &amp;&amp; this.ws.closed) {
                        return true;
                    }
                    return false;
                },
                checkShow: function (skill, showonly) {
                    var sourceSkill = get.info(skill);
                    var noshow = false;
                    if (sourceSkill &amp;&amp; sourceSkill.sourceSkill) {
                        skill = sourceSkill.sourceSkill;
                    }
                    if (lib.skill.global.contains(skill)) return false;
                    if (get.mode() != 'guozhan' || game.expandSkills(this.getSkills()).contains(skill)) {
                        if (showonly) {
                            return false;
                        }
                        else {
                            noshow = true;
                        }
                    }
                    var unseen0 = this.isUnseen(0);
                    var name1 = this.name1 || this.name;
                    if (lib.character[name1] &amp;&amp; (!showonly || unseen0)) {
                        var skills = game.expandSkills(lib.character[name1][3].slice(0));
                        if (skills.contains(skill)) {
                            if (!noshow &amp;&amp; this.isUnseen(0)) this.showCharacter(0);
                            return 'main';
                        }
                    }
                    var unseen1 = this.isUnseen(1);
                    var name2 = this.name2;
                    if (lib.character[name2] &amp;&amp; (!showonly || unseen1)) {
                        var skills = game.expandSkills(lib.character[name2][3].slice(0));
                        if (skills.contains(skill)) {
                            if (!noshow &amp;&amp; this.isUnseen(1)) this.showCharacter(1);
                            return 'vice';
                        }
                    }
                    return false;
                },
                /**
                 * 0
                 * **ignoredHandcard**`true`
                 * @param {?number} [num] 
                 * @returns {!number} 
                 */
                needsToDiscard: function (num) {
                    if (typeof num != 'number') num = 0;
                    var hs = this.getCards('h');
                    num += hs.length;
                    for (var i = 0; i &lt; hs.length; i++) {
                        if (game.checkMod(hs[i], this, false, 'ignoredHandcard', this) == true) {
                            num--;
                        }
                    }
                    return Math.max(0, num - this.getHandcardLimit());
                },
                distanceTo: function (target, method) {
                    return get.distance(this, target, method);
                },
                distanceFrom: function (target, method) {
                    return get.distance(target, this, method);
                },
                /**
                 * 
                 * (|)
                 * {@link lib.element.player.getSkills this.getSkills(arg2, arg3, arg4)}{@link game.expandSkills}
                 * @param {!string} skill 
                 * @param {*} arg2 'e'
                 * @param {*} arg3 false
                 * @param {*} arg4 false
                 * @returns {!boolean}
                 */
                hasSkill: function (skill, arg2, arg3, arg4) {
                    return game.expandSkills(this.getSkills(arg2, arg3, arg4)).contains(skill);
                },
                hasStockSkill: function (skill, arg1, arg2, arg3) {
                    return game.expandSkills(this.getStockSkills(arg1, arg2, arg3)).contains(skill);
                },
                hasZhuSkill: function (skill, player) {
                    if (!this.hasSkill(skill)) return false;
                    var mode = get.mode();
                    if (mode == 'identity' || (mode == 'versus' &amp;&amp; (_status.mode == 'four' || _status.mode == 'guandu'))) {
                        if (mode != 'identity') {
                            if (player &amp;&amp; this.side != player.side) return false;
                        }
                        if (_status.mode == 'purple') {
                            if (player &amp;&amp; this.identity.slice(0, 1) != player.identity.slice(0, 1)) return false;
                        }
                        if (this.isZhu == true) return true;
                        for (var i in this.storage) {
                            if (i.indexOf('zhuSkill_') == 0 &amp;&amp; this.storage[i].contains(skill)) return true;
                        }
                    }
                    return false;
                },
                hasGlobalTag: function (tag, arg) {
                    var skills = lib.skill.global.slice(0);
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var info = lib.skill[skills[i]];
                        if (info &amp;&amp; info.ai) {
                            if (info.ai.skillTagFilter &amp;&amp; info.ai[tag] &amp;&amp;
                                info.ai.skillTagFilter(this, tag, arg) === false) continue;
                            if (typeof info.ai[tag] == 'string') {
                                if (info.ai[tag] == arg) return true;
                            }
                            else if (info.ai[tag]) {
                                return true;
                            }
                        }
                    }
                    return false;
                },
                hasSkillTag: function (tag, hidden, arg, globalskill) {
                    var skills = this.getSkills(hidden);
                    if (globalskill) {
                        skills.addArray(lib.skill.global);
                    }
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var info = lib.skill[skills[i]];
                        if (info &amp;&amp; info.ai) {
                            if (info.ai.skillTagFilter &amp;&amp; info.ai[tag] &amp;&amp;
                                info.ai.skillTagFilter(this, tag, arg) === false) continue;
                            if (typeof info.ai[tag] == 'string') {
                                if (info.ai[tag] == arg) return true;
                            }
                            else if (info.ai[tag]) {
                                return true;
                            }
                        }
                    }
                    return false;
                },
                hasJudge: function (name) {
                    if (name &amp;&amp; typeof name == 'object') {
                        name = name.viewAs || name.name;
                    }
                    var judges = this.node.judges.childNodes;
                    for (var i = 0; i &lt; judges.length; i++) {
                        if (judges[i].classList.contains('removing')) continue;
                        if ((judges[i].viewAs || judges[i].name) == name) {
                            return true;
                        }
                    }
                    return false;
                },
                hasFriend: function () {
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isOut()) continue;
                        if (game.players[i] != this &amp;&amp; get.attitude(game.players[i], this) > 0) {
                            return true;
                        }
                    }
                    return false;
                },
                hasUnknown: function (num) {
                    var mode = get.mode();
                    if (typeof num != 'number') {
                        num = 0;
                    }
                    if (mode == 'identity' || mode == 'guozhan') {
                        for (var i = 0; i &lt; game.players.length; i++) {
                            if (game.players[i].ai.shown == 0 &amp;&amp; game.players[i] != this) {
                                num--;
                                if (num &lt;= 0) {
                                    return true;
                                }
                            }
                        }
                    }
                    return false;
                },
                isUnknown: function (player) {
                    var mode = get.mode();
                    if (mode == 'identity' || mode == 'guozhan') {
                        if (this.ai.shown == 0 &amp;&amp; this != player) {
                            return true;
                        }
                    }
                    return false;
                },
                //
                hasYami: function () {
                    if (this.countCards('h', { nature: 'yami' })) return true;
                    var skills = this.getSkills(true).concat(lib.skill.global);
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var ifo = get.info(skills[i]);
                        if (ifo.viewAs &amp;&amp; typeof ifo.viewAs != 'function' &amp;&amp; ifo.viewAs.nature == 'yami') {
                            if (!ifo.viewAsFilter || ifo.viewAsFilter(this)) {
                                return true;
                            }
                        }
                        else {
                            var hiddenYami = get.info(skills[i]).hiddenYami;
                            if (typeof hiddenYami == 'function' &amp;&amp; hiddenYami(this, false)) {
                                return true;
                            }
                        }
                    }
                    return false;
                },
                hasWuxie: function () {
                    if (this.countCards('hs', 'wuxie')) return true;
                    var skills = this.getSkills(true).concat(lib.skill.global);
                    game.expandSkills(skills);
                    for (var i = 0; i &lt; skills.length; i++) {
                        var ifo = get.info(skills[i]);
                        if (ifo.viewAs &amp;&amp; typeof ifo.viewAs != 'function' &amp;&amp; ifo.viewAs.name == 'wuxie') {
                            if (!ifo.viewAsFilter || ifo.viewAsFilter(this)) {
                                return true;
                            }
                        }
                        else {
                            var hiddenCard = get.info(skills[i]).hiddenCard;
                            if (typeof hiddenCard == 'function' &amp;&amp; hiddenCard(this, 'wuxie')) {
                                return true;
                            }
                        }
                    }
                    return false;
                },
                hasSha: function (respond, noauto) {
                    if (this.countCards('hs', 'sha')) return true;
                    if (this.countCards('hs', 'hufu')) return true;
                    if (!noauto &amp;&amp; this.countCards('hs', 'yuchanqian')) return true;
                    if (this.hasSkillTag('respondSha', true, respond ? 'respond' : 'use', true)) return true;
                    return false;
                },
                hasShan: function () {
                    if (this.countCards('hs', 'shan')) return true;
                    if (this.countCards('hs', 'hufu')) return true;
                    if (this.hasSkillTag('respondShan', true, null, true)) return true;
                    return false;
                },
                mayHaveShan: function () {
                    return this.hasShan();
                    // modify: After AngelBeats! -2nd Beat-
                },
                hasCard: function (name, position) {
                    if (typeof name == 'function') {
                        var hs = this.getCards(position);
                        for (var i = 0; i &lt; hs.length; i++) {
                            if (name(hs[i])) return true;
                        }
                    }
                    else {
                        if (this.countCards(position, name)) return true;
                    }
                    return false;
                },
                canEquip: function (name, replace) {
                    if (get.type(name) == 'card') {
                        name = get.equiptype(name);
                    }
                    var range = get.subtype(name);
                    if (this.isDisabled(range)) return false;
                    if (['equip3', 'equip4'].contains(range) &amp;&amp; this.getEquip(6)) return false;
                    if (!replace &amp;&amp; !this.isEmpty(range)) return false;
                    return true;
                },
                /**
                 * 
                 * |string|number|equip|
                 * |:----:|:----:|:---:|
                 * |equip1|1||
                 * |equip2|2||
                 * |equip3|3||
                 * |equip4|4||
                 * |equip5|5||
                 * |equip6|6||
                 * 
                 * @typedef {('equip[1-6]'|number)} GameCores.EquipType
                 */
                /**
                 * 
                 * @param {(GameCores.GameObjects.Card|'equip[0-9]'|number)} name ()`name`null[0-9]'equip[0-9]'[1-6]({@link GameCores.EquipType})
                 * @returns {(null|GameCores.GameObjects.Card)}
                 */
                getEquip: function (name) {
                    var es = this.getCards('e');
                    if (typeof name == 'object' &amp;&amp; get.info(name)) {
                        name = get.info(name).subtype;
                        if (name) {
                            name = parseInt(name[5]);
                        }
                    }
                    else if (typeof name == 'string' &amp;&amp; name.indexOf('equip') == 0 &amp;&amp; name.length == 6) {
                        name = parseInt(name[5]);
                    }
                    if (!name) {
                        return null;
                    }
                    for (var i = 0; i &lt; es.length; i++) {
                        if (typeof name === 'number') {
                            if (get.info(es[i]).subtype === 'equip' + name) {
                                return es[i];
                            }
                        }
                        else {
                            if (es[i].name === name) return es[i];
                            var source = get.info(es[i]).source;
                            if (Array.isArray(source) &amp;&amp; source.contains(name)) {
                                return es[i];
                            }
                        }
                    }
                    return null;
                },
                /**
                 * (|)
                 * @function
                 * @param {?string} name 
                 * @returns {(GameCores.GameObjects.Card|null)} null
                 */
                getJudge: function (name) {
                    var judges = this.node.judges.childNodes;
                    for (var i = 0; i &lt; judges.length; i++) {
                        if (judges[i].classList.contains('removing')) continue;
                        if ((judges[i].viewAs || judges[i].name) == name) {
                            return judges[i];
                        }
                    }
                    return null;
                },
                $drawAuto: function (cards, target) {
                    if (this.isUnderControl(true, target)) {
                        this.$draw(cards);
                    }
                    else {
                        this.$draw(cards.length);
                    }
                },
                $draw: function (num, init, config) {
                    if (init !== false &amp;&amp; init !== 'nobroadcast') {
                        game.broadcast(function (player, num, init, config) {
                            player.$draw(num, init, config)
                        }, this, num, init, config);
                    }
                    var cards, node;
                    if (get.itemtype(num) == 'cards') {
                        cards = num;
                        num = cards.length;
                    }
                    else if (get.itemtype(num) == 'card') {
                        cards = [num];
                        num = 1;
                    }
                    if (init !== false) {
                        if (cards) {
                            game.addVideo('drawCard', this, get.cardsInfo(cards));
                        }
                        else {
                            game.addVideo('draw', this, num);
                        }
                    }
                    if (cards) {
                        cards = cards.slice(0);
                        node = cards.shift().copy('thrown', 'drawingcard');
                    }
                    else {
                        node = ui.create.div('.card.thrown.drawingcard');
                    }
                    node.fixed = true;
                    node.hide();

                    var dx, dy;
                    if (game.chess) {
                        var rect = this.getBoundingClientRect();

                        if (rect.left &lt;= 80) {
                            dx = -10;
                            if (rect.top &lt;= 80) {
                                dy = -10;
                            }
                            else if (rect.top + rect.height + 80 >= ui.chessContainer.offsetHeight) {
                                dy = 10;
                            }
                            else {
                                dy = 0;
                            }
                        }
                        else if (rect.left + rect.width + 80 >= ui.chessContainer.offsetWidth) {
                            dx = 10;
                            if (rect.top &lt;= 80) {
                                dy = -10;
                            }
                            else if (rect.top + rect.height + 80 >= ui.chessContainer.offsetHeight) {
                                dy = 10;
                            }
                            else {
                                dy = 0;
                            }
                        }
                        else if (rect.top &lt;= 80) {
                            dx = 0;
                            dy = -10;
                        }
                        else if (rect.top + rect.height + 80 >= ui.chessContainer.offsetHeight) {
                            dx = 0;
                            dy = 10;
                        }
                        else {
                            dx = rect.left + this.offsetWidth / 2 - ui.arena.offsetWidth / 2;
                            dy = rect.top + this.offsetHeight / 2 - ui.arena.offsetHeight / 2;
                        }

                        var coeff = 240 / Math.sqrt(dx * dx + dy * dy);
                        dx *= coeff;
                        dy *= coeff;

                        node.style.left = (this.getLeft() + this.offsetWidth / 2 - 52 - dx) + 'px';
                        node.style.top = (this.getTop() + this.offsetHeight / 2 - 52 - dy) + 'px';
                        this.parentNode.appendChild(node);
                    }
                    else {
                        this.parentNode.appendChild(node);
                        node.style.left = 'calc(50% - 52px)';
                        node.style.top = 'calc(50% - 52px)';

                        dx = this.getLeft() + this.offsetWidth / 2 - 52 - node.offsetLeft;
                        dy = this.getTop() + this.offsetHeight / 2 - 52 - node.offsetTop;

                        if (get.is.mobileMe(this)) {
                            dx += get.cardOffset();
                            if (ui.arena.classList.contains('oblongcard')) {
                                dy -= 16;
                            }
                        }
                    }
                    node.style.transitionDuration = '0.8s';
                    ui.refresh(node);
                    if (typeof num == 'number' &amp;&amp; init !== false) {
                        config = {
                            total: num,
                            current: 1
                        }
                    }
                    if (config &amp;&amp; config.total > 1) {
                        var total = config.total, current = config.current;
                        var dxtotal;
                        if (total &lt;= 5) {
                            dxtotal = Math.min(80, (total - 1) * 20);
                            dx += -dxtotal + 2 * dxtotal * (current - 1) / (total - 1)
                        }
                        else {
                            var total2 = Math.floor(total / 2);
                            if (current &lt;= total2) {
                                total = total2;
                                dy -= 20;
                            }
                            else {
                                current -= total2;
                                total -= total2;
                                dy += 20;
                            }
                            dxtotal = Math.min(80, (total - 1) * 20);
                            dx += -dxtotal + 2 * dxtotal * (current - 1) / (total - 1)
                        }
                        config.current++;
                    }
                    if (node.style.transform &amp;&amp; node.style.transform != 'none' &amp;&amp; node.style.transform.indexOf('translate') == -1) {
                        node.style.transform += ' translate(' + dx + 'px,' + dy + 'px)';
                    }
                    else {
                        node.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';
                    }
                    node.show();

                    node.listenTransition(function () {
                        node.style.transitionDuration = '0.5s';
                        ui.refresh(node);
                        node.delete();
                    });
                    var that = this;
                    if (num &amp;&amp; num > 1) {
                        if (config &amp;&amp; config.total > 1) {
                            setTimeout(function () {
                                if (cards) {
                                    that.$draw(cards, false, config)
                                }
                                else {
                                    that.$draw(num - 1, false, config)
                                }
                            }, 50)
                        }
                        else {
                            setTimeout(function () {
                                if (cards) {
                                    that.$draw(cards, false, config)
                                }
                                else {
                                    that.$draw(num - 1, false, config)
                                }
                            }, 200);
                        }
                    }
                },
                $compareMultiple: function (card1, targets, cards) {
                    game.broadcast(function (player, card1, targets, cards) {
                        player.$compareMultiple(card1, targets, cards);
                    }, this, card1, targets, cards);
                    game.addVideo('compareMultiple', this, [get.cardInfo(card1), get.targetsInfo(targets), get.cardsInfo(cards)]);
                    var player = this;
                    var node1 = player.$throwxy2(card1,
                        'calc(50% - 52px)', 'calc(50% + 10px)', 'perspective(600px) rotateY(180deg)', true
                    );
                    if (lib.config.cardback_style != 'default') {
                        node1.style.transitionProperty = 'none';
                        ui.refresh(node1);
                        node1.classList.add('infohidden');
                        ui.refresh(node1);
                        node1.style.transitionProperty = '';
                    }
                    else {
                        node1.classList.add('infohidden');
                    }

                    node1.style.transform = 'perspective(600px) rotateY(180deg) translateX(0)';
                    var onEnd01 = function () {
                        node1.removeEventListener('webkitTransitionEnd', onEnd01);
                        setTimeout(function () {
                            node1.style.transition = 'all ease-in 0.3s';
                            node1.style.transform = 'perspective(600px) rotateY(270deg) translateX(52px)';
                            var onEnd = function () {
                                node1.classList.remove('infohidden');
                                node1.style.transition = 'all 0s';
                                ui.refresh(node1);
                                node1.style.transform = 'perspective(600px) rotateY(-90deg) translateX(52px)';
                                ui.refresh(node1);
                                node1.style.transition = '';
                                ui.refresh(node1);
                                node1.style.transform = '';
                                node1.removeEventListener('webkitTransitionEnd', onEnd);
                            }
                            node1.listenTransition(onEnd);
                        }, 300);
                    };
                    node1.listenTransition(onEnd01);

                    setTimeout(function () {
                        var left0 = -targets.length * 52 - (targets.length - 1) * 8;
                        for (var i = 0; i &lt; targets.length; i++) {
                            (function (target, card2, i) {
                                var left = left0 + i * 120;
                                var node2;
                                if (left &lt; 0) {
                                    node2 = target.$throwxy2(card2,
                                        'calc(50% - ' + (-left) + 'px)', 'calc(50% - 114px)', 'perspective(600px) rotateY(180deg)', true
                                    );
                                }
                                else {
                                    node2 = target.$throwxy2(card2,
                                        'calc(50% + ' + left + 'px)', 'calc(50% - 114px)', 'perspective(600px) rotateY(180deg)', true
                                    );
                                }
                                if (lib.config.cardback_style != 'default') {
                                    node2.style.transitionProperty = 'none';
                                    ui.refresh(node2);
                                    node2.classList.add('infohidden');
                                    ui.refresh(node2);
                                    node2.style.transitionProperty = '';
                                }
                                else {
                                    node2.classList.add('infohidden');
                                }
                                node2.style.transform = 'perspective(600px) rotateY(180deg) translateX(0)';
                                var onEnd02 = function () {
                                    node2.removeEventListener('webkitTransitionEnd', onEnd02);
                                    setTimeout(function () {
                                        node2.style.transition = 'all ease-in 0.3s';
                                        node2.style.transform = 'perspective(600px) rotateY(270deg) translateX(52px)';
                                        var onEnd = function () {
                                            node2.classList.remove('infohidden');
                                            node2.style.transition = 'all 0s';
                                            ui.refresh(node2);
                                            node2.style.transform = 'perspective(600px) rotateY(-90deg) translateX(52px)';
                                            ui.refresh(node2);
                                            node2.style.transition = '';
                                            ui.refresh(node2);
                                            node2.style.transform = '';
                                            node2.removeEventListener('webkitTransitionEnd', onEnd);
                                        }
                                        node2.listenTransition(onEnd);
                                    }, 200);
                                };
                                node2.listenTransition(onEnd02);
                            }(targets[i], cards[i], i))
                        }
                    }, 200);
                },
                $compare: function (card1, target, card2) {
                    game.broadcast(function (player, target, card1, card2) {
                        player.$compare(card1, target, card2);
                    }, this, target, card1, card2);
                    game.addVideo('compare', this, [get.cardInfo(card1), target.dataset.position, get.cardInfo(card2)]);
                    var player = this;
                    var node1 = player.$throwxy2(card1,
                        'calc(50% - 114px)', 'calc(50% - 52px)', 'perspective(600px) rotateY(180deg)', true
                    );
                    if (lib.config.cardback_style != 'default') {
                        node1.style.transitionProperty = 'none';
                        ui.refresh(node1);
                        node1.classList.add('infohidden');
                        ui.refresh(node1);
                        node1.style.transitionProperty = '';
                    }
                    else {
                        node1.classList.add('infohidden');
                    }

                    node1.style.transform = 'perspective(600px) rotateY(180deg) translateX(0)';
                    var onEnd01 = function () {
                        node1.removeEventListener('webkitTransitionEnd', onEnd01);
                        setTimeout(function () {
                            node1.style.transition = 'all ease-in 0.3s';
                            node1.style.transform = 'perspective(600px) rotateY(270deg) translateX(52px)';
                            var onEnd = function () {
                                node1.classList.remove('infohidden');
                                node1.style.transition = 'all 0s';
                                ui.refresh(node1);
                                node1.style.transform = 'perspective(600px) rotateY(-90deg) translateX(52px)';
                                ui.refresh(node1);
                                node1.style.transition = '';
                                ui.refresh(node1);
                                node1.style.transform = '';
                                node1.removeEventListener('webkitTransitionEnd', onEnd);
                            }
                            node1.listenTransition(onEnd);
                        }, 300);
                    };
                    node1.listenTransition(onEnd01);
                    setTimeout(function () {
                        var node2 = target.$throwxy2(card2,
                            'calc(50% + 10px)', 'calc(50% - 52px)', 'perspective(600px) rotateY(180deg)', true
                        );
                        if (lib.config.cardback_style != 'default') {
                            node2.style.transitionProperty = 'none';
                            ui.refresh(node2);
                            node2.classList.add('infohidden');
                            ui.refresh(node2);
                            node2.style.transitionProperty = '';
                        }
                        else {
                            node2.classList.add('infohidden');
                        }
                        node2.style.transform = 'perspective(600px) rotateY(180deg) translateX(0)';
                        var onEnd02 = function () {
                            node2.removeEventListener('webkitTransitionEnd', onEnd02);
                            setTimeout(function () {
                                node2.style.transition = 'all ease-in 0.3s';
                                node2.style.transform = 'perspective(600px) rotateY(270deg) translateX(52px)';
                                var onEnd = function () {
                                    node2.classList.remove('infohidden');
                                    node2.style.transition = 'all 0s';
                                    ui.refresh(node2);
                                    node2.style.transform = 'perspective(600px) rotateY(-90deg) translateX(52px)';
                                    ui.refresh(node2);
                                    node2.style.transition = '';
                                    ui.refresh(node2);
                                    node2.style.transform = '';
                                    node2.removeEventListener('webkitTransitionEnd', onEnd);
                                }
                                node2.listenTransition(onEnd);
                            }, 200);
                        };
                        node2.listenTransition(onEnd02);
                    }, 200);
                },
                $throw: function (card, time, init, nosource) {
                    if (typeof card == 'number') {
                        var tmp = card;
                        card = [];
                        while (tmp--) {
                            var cardx = ui.create.card();
                            cardx.classList.add('infohidden');
                            cardx.classList.add('infoflip');
                            card.push(cardx);
                        }
                    }
                    if (init !== false) {
                        if (init !== 'nobroadcast') {
                            game.broadcast(function (player, card, time, init, nosource) {
                                player.$throw(card, time, init, nosource);
                            }, this, card, time, init);
                        }
                        if (get.itemtype(card) != 'cards') {
                            if (get.itemtype(card) == 'card') {
                                card = [card];
                            }
                            else {
                                return;
                            }
                        }
                        game.addVideo('throw', this, [get.cardsInfo(card), time, nosource]);
                    }
                    if (game.chess) {
                        this.chessFocus();
                    }
                    if (get.itemtype(card) == 'cards') {
                        var node;
                        for (var i = 0; i &lt; card.length; i++) {
                            node = this.$throw(card[i], time, false, nosource);
                        }
                        return node;
                    }
                    else {
                        var node;
                        if (card == undefined || card.length == 0) return;
                        node = this.$throwordered(card.copy('thrown'), nosource);
                        if (time != undefined) {
                            node.fixed = true;
                            setTimeout(function () { node.delete() }, time);
                        }
                        lib.listenEnd(node);
                        return node;
                    }
                },
                $throwordered: function () {
                    return this.$throwordered2.apply(this, arguments);
                    // if(lib.config.low_performance){
                    //     return this.$throwordered2.apply(this,arguments);
                    // }
                    // else{
                    //     return this.$throwordered1.apply(this,arguments);
                    // }
                },
                $throwordered1: function (node, nosource) {
                    node.classList.add('thrown');
                    node.hide();
                    node.style.transitionProperty = 'left,top,opacity,transform';
                    for (var i = 0; i &lt; ui.thrown.length; i++) {
                        if (ui.thrown[i].parentNode != ui.arena ||
                            ui.thrown[i].classList.contains('removing')) {
                            ui.thrown.splice(i--, 1);
                        }
                    }
                    ui.thrown.push(node);
                    var uithrowns = ui.thrown.slice(0);
                    var tops;
                    if (game.chess) {
                        switch (Math.floor((ui.thrown.length - 1) / 4)) {
                            case 0:
                                tops = ['calc(50% - 82px)'];
                                break;
                            case 1:
                                tops = ['calc(50% - 139px)', 'calc(50% - 25px)'];
                                break;
                            case 2:
                                tops = ['calc(50% - 196px)', 'calc(50% - 82px)', 'calc(50% + 32px)'];
                                break;
                            default:
                                tops = ['calc(50% - 253px)', 'calc(50% - 139px)',
                                    'calc(50% - 25px)', 'calc(50% + 89px)'];
                        }
                    }
                    else {
                        switch (Math.floor((ui.thrown.length - 1) / 4)) {
                            case 0:
                                tops = ['calc(50% - 52px)'];
                                break;
                            case 1:
                                tops = ['calc(50% - 109px)', 'calc(50% + 5px)'];
                                break;
                            case 2:
                                tops = ['calc(50% - 166px)', 'calc(50% - 52px)', 'calc(50% + 62px)'];
                                break;
                            default:
                                tops = ['calc(50% - 223px)', 'calc(50% - 109px)',
                                    'calc(50% + 5px)', 'calc(50% + 119px)'];
                        }
                    }
                    while (uithrowns.length) {
                        var throwns = uithrowns.splice(0, Math.min(uithrowns.length, 4));
                        switch (throwns.length) {
                            case 1:
                                throwns[0].style.left = 'calc(50% - 52px)';
                                break;
                            case 2:
                                throwns[0].style.left = 'calc(50% - 109px)';
                                throwns[1].style.left = 'calc(50% + 5px)';
                                break;
                            case 3:
                                throwns[0].style.left = 'calc(50% - 166px)';
                                throwns[1].style.left = 'calc(50% - 52px)';
                                throwns[2].style.left = 'calc(50% + 62px)';
                                break;
                            case 4:
                                throwns[0].style.left = 'calc(50% - 223px)';
                                throwns[1].style.left = 'calc(50% - 109px)';
                                throwns[2].style.left = 'calc(50% + 5px)';
                                throwns[3].style.left = 'calc(50% + 119px)';
                                break;
                        }
                        var top;
                        if (tops.length) {
                            top = tops.shift();
                        }
                        else {
                            if (game.chess) {
                                top = 'calc(50% - 82px)';
                            }
                            else {
                                top = 'calc(50% - 52px)';
                            }
                        }
                        for (var i = 0; i &lt; throwns.length; i++) {
                            throwns[i].style.top = top;
                        }
                    }
                    if (nosource) {
                        node.style.transform = 'scale(0)';
                        node.classList.add('center');
                    }
                    else {
                        var parseCalc = function (str) {
                            var per = str.slice(str.indexOf('calc(') + 5, str.indexOf('%'));
                            var add = str.slice(str.indexOf('%') + 1, str.indexOf('px')).replace(/\s/g, '');
                            return [parseInt(per), parseInt(add)];
                        }
                        var nx = parseCalc(node.style.left);
                        var ny = parseCalc(node.style.top);
                        nx = nx[0] * ui.arena.offsetWidth / 100 + nx[1];
                        ny = ny[0] * ui.arena.offsetHeight / 100 + ny[1];
                        var dx, dy;
                        if (game.chess) {
                            var rect = this.getBoundingClientRect();
                            dx = rect.left + this.offsetWidth / 2 - 52 - nx;
                            dy = rect.top + this.offsetHeight / 2 - 52 - ny;
                        }
                        else {
                            dx = this.getLeft() + this.offsetWidth / 2 - 52 - nx;
                            dy = this.getTop() + this.offsetHeight / 2 - 52 - ny;
                            if (get.is.mobileMe(this)) {
                                dx += get.cardOffset();
                                if (ui.arena.classList.contains('oblongcard')) {
                                    dy -= 16;
                                }
                            }
                        }
                        if (node.style.transform &amp;&amp; node.style.transform != 'none' &amp;&amp; node.style.transform.indexOf('translate') == -1) {
                            node.style.transform += ' translate(' + dx + 'px,' + dy + 'px)';
                        }
                        else {
                            node.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';
                        }
                    }
                    ui.arena.appendChild(node);
                    ui.refresh(node);
                    node.style.transform = '';
                    node.show();
                    lib.listenEnd(node);
                    return node;
                },
                $throwordered2: function (node, nosource) {
                    node.classList.add('thrown');
                    node.classList.add('center');
                    node.hide();
                    node.style.transitionProperty = 'left,top,opacity,transform';

                    if (nosource) {
                        // node.style.transform='scale(0)';
                    }
                    else {
                        var nx = [50, -52];
                        var ny = [50, -52];
                        nx = nx[0] * ui.arena.offsetWidth / 100 + nx[1];
                        ny = ny[0] * ui.arena.offsetHeight / 100 + ny[1];
                        var dx, dy;
                        if (game.chess) {
                            var rect = this.getBoundingClientRect();
                            dx = rect.left + this.offsetWidth / 2 - 52 - nx;
                            dy = rect.top + this.offsetHeight / 2 - 52 - ny;
                        }
                        else {
                            dx = this.getLeft() + this.offsetWidth / 2 - 52 - nx;
                            dy = this.getTop() + this.offsetHeight / 2 - 52 - ny;
                            if (get.is.mobileMe(this)) {
                                dx += get.cardOffset();
                                if (ui.arena.classList.contains('oblongcard')) {
                                    dy -= 16;
                                }
                            }
                        }
                        if (node.style.transform &amp;&amp; node.style.transform != 'none' &amp;&amp; node.style.transform.indexOf('translate') == -1) {
                            node.style.transform += ' translate(' + dx + 'px,' + dy + 'px)';
                        }
                        else {
                            node.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';
                        }
                    }
                    ui.arena.appendChild(node);
                    ui.refresh(node);

                    for (var i = 0; i &lt; ui.thrown.length; i++) {
                        if (ui.thrown[i].parentNode != ui.arena ||
                            ui.thrown[i].classList.contains('removing')) {
                            ui.thrown.splice(i--, 1);
                        }
                    }
                    ui.thrown.push(node);
                    var uithrowns = ui.thrown.slice(0);
                    var tops;
                    switch (Math.floor((ui.thrown.length - 1) / 4)) {
                        case 0:
                            tops = [0];
                            break;
                        case 1:
                            tops = [-57, 57];
                            break;
                        case 2:
                            tops = [-114, 0, 114];
                            break;
                        default:
                            tops = [-171, -57, 57, 171];
                    }
                    while (uithrowns.length) {
                        var throwns = uithrowns.splice(0, Math.min(uithrowns.length, 4));
                        switch (throwns.length) {
                            case 1:
                                throwns[0]._transthrown = 'translate(0px,';
                                break;
                            case 2:
                                throwns[0]._transthrown = 'translate(-57px,';
                                throwns[1]._transthrown = 'translate(57px,';
                                break;
                            case 3:
                                throwns[0]._transthrown = 'translate(-114px,';
                                throwns[1]._transthrown = 'translate(0,';
                                throwns[2]._transthrown = 'translate(114px,';
                                break;
                            case 4:
                                throwns[0]._transthrown = 'translate(-171px,';
                                throwns[1]._transthrown = 'translate(-57px,';
                                throwns[2]._transthrown = 'translate(57px,';
                                throwns[3]._transthrown = 'translate(171px,';
                                break;
                        }
                        var top;
                        if (tops.length) {
                            top = tops.shift();
                        }
                        else {
                            top = 0;
                        }
                        if (game.chess) {
                            top -= 30;
                        }
                        for (var i = 0; i &lt; throwns.length; i++) {
                            throwns[i].style.transform = throwns[i]._transthrown + top + 'px)';
                            delete throwns[i]._transthrown;
                        }
                    }

                    node.show();
                    lib.listenEnd(node);
                    return node;
                },
                $throwxy: function (card, left, top) {
                    var node = card.copy('thrown', 'thrownhighlight');
                    node.dataset.position = this.dataset.position;
                    node.hide();
                    node.style.transitionProperty = 'left,top,opacity';

                    ui.arena.appendChild(node);
                    ui.refresh(node);
                    node.show();
                    node.style.left = left;
                    node.style.top = top;
                    lib.listenEnd(node);
                    return node;
                },
                $throwxy2: function (card, left, top, trans, flipx, flipy) {
                    if (game.chess) {
                        return this.$throwxy.apply(this, arguments);
                    }
                    var node = card.copy('thrown', 'thrownhighlight');
                    node.style.left = left;
                    node.style.top = top;
                    node.hide();
                    // node.style.transitionProperty='left,top,opacity,transform';

                    var parseCalc = function (str) {
                        var per = str.slice(str.indexOf('calc(') + 5, str.indexOf('%'));
                        var add = str.slice(str.indexOf('%') + 1, str.indexOf('px')).replace(/\s/g, '');
                        return [parseInt(per), parseInt(add)];
                    }
                    var nx = parseCalc(node.style.left);
                    var ny = parseCalc(node.style.top);
                    nx = nx[0] * ui.arena.offsetWidth / 100 + nx[1];
                    ny = ny[0] * ui.arena.offsetHeight / 100 + ny[1];
                    var dx = this.getLeft() + this.offsetWidth / 2 - 52 - nx;
                    var dy = this.getTop() + this.offsetHeight / 2 - 52 - ny;
                    if (flipx) dx = -dx;
                    if (flipy) dy = -dy;
                    if (trans) {
                        node.style.transform = trans + ' translate(' + dx + 'px,' + dy + 'px)';
                    }
                    else {
                        node.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';
                    }

                    ui.arena.appendChild(node);
                    ui.refresh(node);
                    node.show();
                    // node.style.transform=trans||'';
                    lib.listenEnd(node);
                    return node;
                },
                throwDice: function (num) {
                    if (typeof num != 'number') {
                        num = get.rand(6) + 1;
                        _status.event.num = num;
                    }
                    if (!game.online) {
                        game.pause();
                    }
                    game.broadcastAll(function (num) {
                        var diceContainer = ui.create.div('.fullsize.dice-container', ui.window);
                        ui.window.classList.add('dicepaused');
                        var dice = ui.create.div('.dice');
                        var side;

                        side = ui.create.div('.side.front', dice);
                        ui.create.div('.dot.center', side);
                        ui.create.div('.side.front.inner', dice);

                        side = ui.create.div('.side.top', dice);
                        ui.create.div('.dot.dtop.dleft', side);
                        ui.create.div('.dot.dbottom.dright', side);
                        ui.create.div('.side.top.inner', dice);

                        side = ui.create.div('.side.right', dice);
                        ui.create.div('.dot.dtop.dleft', side);
                        ui.create.div('.dot.center', side);
                        ui.create.div('.dot.dbottom.dright', side);
                        ui.create.div('.side.right.inner', dice);

                        side = ui.create.div('.side.left', dice);
                        ui.create.div('.dot.dtop.dleft', side);
                        ui.create.div('.dot.dtop.dright', side);
                        ui.create.div('.dot.dbottom.dleft', side);
                        ui.create.div('.dot.dbottom.dright', side);
                        ui.create.div('.side.left.inner', dice);

                        side = ui.create.div('.side.bottom', dice);
                        ui.create.div('.dot.center', side);
                        ui.create.div('.dot.dtop.dleft', side);
                        ui.create.div('.dot.dtop.dright', side);
                        ui.create.div('.dot.dbottom.dleft', side);
                        ui.create.div('.dot.dbottom.dright', side);
                        ui.create.div('.side.bottom.inner', dice);

                        side = ui.create.div('.side.back', dice);
                        ui.create.div('.dot.dtop.dleft', side);
                        ui.create.div('.dot.dtop.dright', side);
                        ui.create.div('.dot.dbottom.dleft', side);
                        ui.create.div('.dot.dbottom.dright', side);
                        ui.create.div('.dot.center dleft', side);
                        ui.create.div('.dot.center dright', side);
                        ui.create.div('.side.back.inner', dice);

                        ui.create.div('.side.cover.x', dice);
                        ui.create.div('.side.cover.y', dice);
                        ui.create.div('.side.cover.z', dice);

                        var map = {
                            1: [75, 0, 45],
                            2: [-15, 45, 0],
                            3: [165, -45, 90],
                            4: [345, -45, 90],
                            5: [345, -45, 180],
                            6: [255, 0, 135]
                        };
                        dice.roll = function (deg) {
                            if (typeof deg == 'number') {
                                dice.current[0] += deg;
                                deg = dice.current;
                            }
                            deg = deg.slice(0);
                            dice.current = deg;
                            this.style.transform = 'rotateX(' + deg[0] + 'deg) rotateY(' + deg[1] + 'deg) rotateZ(' + deg[2] + 'deg)';
                        };
                        dice.roll(map[num]);
                        diceContainer.appendChild(dice);
                        ui.refresh(dice);
                        dice.roll(1025);

                        dice.addEventListener('webkitTransitionEnd', function () {
                            if (!dice.over) {
                                dice.style.transition = 'transform 0.8s ease';
                                dice.roll(-20);
                                dice.over = true;
                            }
                            else if (!dice.resumed) {
                                setTimeout(function () {
                                    diceContainer.delete();
                                    ui.window.classList.remove('dicepaused');
                                }, 300);
                                if (!game.online) {
                                    setTimeout(game.resume, 800);
                                }
                                dice.resumed = true;
                            }
                        });
                    }, num);
                },
                $giveAuto: function (card, player) {
                    if (Array.isArray(card) &amp;&amp; card.length == 0) return;
                    var args = Array.from(arguments);
                    if (_status.connectMode || (!this.isUnderControl(true) &amp;&amp; !player.isUnderControl(true))) {
                        if (Array.isArray(card)) {
                            card = card.length;
                        }
                        else {
                            card = 1;
                        }
                        args[0] = card;
                    }
                    return this.$give.apply(this, args);
                },
                $give: function (card, player, log, init) {
                    if (init !== false) {
                        game.broadcast(function (source, card, player, init) {
                            source.$give(card, player, false, init);
                        }, this, card, player, init);
                        if (typeof card == 'number' &amp;&amp; card >= 0) {
                            game.addVideo('give', this, [card, player.dataset.position]);
                        }
                        else {
                            if (get.itemtype(card) == 'card') {
                                card = [card];
                            }
                            if (get.itemtype(card) == 'cards') {
                                game.addVideo('giveCard', this, [get.cardsInfo(card), player.dataset.position]);
                            }
                        }
                    }
                    if (get.itemtype(card) == 'cards') {
                        if (log != false &amp;&amp; !_status.video) {
                            game.log(player, '', this, '', card);
                        }
                        if (this.$givemod) {
                            this.$givemod(card, player);
                        }
                        else {
                            for (var i = 0; i &lt; card.length; i++) {
                                this.$give(card[i], player, false, false);
                            }
                        }
                    }
                    else if (typeof card == 'number' &amp;&amp; card >= 0) {
                        if (log != false &amp;&amp; !_status.video) {
                            game.log(player, '', this, '' + get.cnNumber(card) + '');
                        }
                        if (this.$givemod) {
                            this.$givemod(card, player);
                        }
                        else {
                            while (card--) this.$give('', player, false, false);
                        }
                    }
                    else {
                        if (log != false &amp;&amp; !_status.video) {
                            if (get.itemtype(card) == 'card' &amp;&amp; log != false) {
                                game.log(player, '', this, '', card);
                            }
                            else {
                                game.log(player, '', this, '');
                            }
                        }
                        if (this.$givemod) {
                            this.$givemod(card, player);
                        }
                        else {
                            var node;
                            if (get.itemtype(card) == 'card') {
                                node = card.copy('card', 'thrown', false);
                            }
                            else {
                                node = ui.create.div('.card.thrown');
                            }
                            // node.dataset.position=this.dataset.position;
                            node.fixed = true;
                            this.$throwordered(node);
                            // lib.listenEnd(node);
                            // node.hide();
                            // node.style.transitionProperty='left,top,opacity';
                            //
                            // node.style.transform='rotate('+(Math.random()*16-8)+'deg)';
                            //
                            // ui.arena.appendChild(node);
                            // ui.refresh(node);
                            // node.show();
                            // node.style.left='calc(50% - 52px '+((Math.random()-0.5&lt;0)?'+':'-')+' '+Math.random()*100+'px)';
                            // node.style.top='calc(50% - 52px '+((Math.random()-0.5&lt;0)?'+':'-')+' '+Math.random()*80+'px)';

                            node.listenTransition(function () {
                                var dx = player.getLeft() + player.offsetWidth / 2 - 52 - node.offsetLeft;
                                var dy = player.getTop() + player.offsetHeight / 2 - 52 - node.offsetTop;
                                if (node.style.transform &amp;&amp; node.style.transform != 'none' &amp;&amp; node.style.transform.indexOf('translate') == -1) {
                                    node.style.transform += ' translate(' + dx + 'px,' + dy + 'px)';
                                }
                                else {
                                    node.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';
                                }

                                node.delete();
                            });
                            // setTimeout(function(){
                            //     // node.removeAttribute('style');
                            //     // node.dataset.position=player.dataset.position;
                            //     var dx=player.offsetLeft+player.offsetWidth/2-52-node.offsetLeft;
                            //     var dy=player.offsetTop+player.offsetHeight/2-52-node.offsetTop;
                            //     if(node.style.transform&amp;&amp;node.style.transform!='none'&amp;&amp;node.style.transform.indexOf('translate')==-1){
                            //         node.style.transform+=' translate('+dx+'px,'+dy+'px)';
                            //     }
                            //     else{
                            //         node.style.transform='translate('+dx+'px,'+dy+'px)';
                            //     }
                            //
                            //     node.delete();
                            // },700);
                        }
                    }
                },
                $equip: function (card, viewAs) {
                    var originalName = card.originalName;
                    if (viewAs &amp;&amp; this.storage.disableEquip != undefined &amp;&amp; this.storage.disableEquip.contains(get.subtype(viewAs))) {
                        this.gain(card, 'gain2');
                        game.log(this, '');
                    }
                    else if (this.storage.disableEquip != undefined &amp;&amp; this.storage.disableEquip.contains(get.subtype(card))) {
                        this.gain(card, 'gain2');
                        game.log(this, '');
                    }
                    else {
                        var player = this;
                        game.broadcast(function (player, card, viewAs) {
                            player.$equip(card, viewAs);
                        }, player, card, viewAs);
                        card.fix();
                        card.style.transform = '';
                        card.classList.remove('drawinghidden');
                        delete card._transform;
                        //
                        card.originalName = originalName;
                        card.viewAs = viewAs;
                        if (viewAs &amp;&amp; viewAs != card.name) {
                            if (card.classList.contains('fullskin') || card.classList.contains('fullborder')) {
                                card.classList.add('fakejudge');
                                card.node.background.innerHTML = lib.translate[viewAs.name + '_bg'] || get.translation(viewAs)[0];
                            }
                            card.classList.remove(get.subtype(card));
                            card.classList.add(get.subtype(viewAs));
                            if (typeof viewAs == 'string') card.viewAs = viewAs;
                            else card.viewAs = viewAs.name;
                        }
                        else {
                            card.classList.remove('fakejudge');
                            delete card.viewAs;
                        }
                        //console.log(card.viewAs);
                        if (card.viewAs &amp;&amp; card.name != card.viewAs) {
                            if (!card.originalName) card.originalName = card.name;
                            card.name = card.viewAs;
                        }
                        var equipNum = get.equipNum(card);
                        var equipped = false;
                        for (var i = 0; i &lt; player.node.equips.childNodes.length; i++) {
                            if (get.equipNum(player.node.equips.childNodes[i]) >= equipNum) {
                                player.node.equips.insertBefore(card, player.node.equips.childNodes[i]);
                                equipped = true;
                                break;
                            }
                        }
                        if (!equipped) {
                            player.node.equips.appendChild(card);
                            if (_status.discarded) {
                                _status.discarded.remove(card);
                            }
                        }
                        var ecard = viewAs ? { name: viewAs } : card;
                        var info = get.info(ecard);
                        if (info.skills) {
                            for (var i = 0; i &lt; info.skills.length; i++) {
                                player.addSkillTrigger(info.skills[i]);
                            }
                        }
                        return player;
                    };
                },
                $gain: function (card, log, init) {
                    if (init !== false) {
                        game.broadcast(function (player, card, init) {
                            player.$gain(card, false, init);
                        }, this, card, init);
                        if (typeof card == 'number' &amp;&amp; card >= 0) {
                            game.addVideo('gain', this, card);
                        }
                        else {
                            if (get.itemtype(card) == 'card') {
                                card = [card];
                            }
                            if (get.itemtype(card) == 'cards') {
                                game.addVideo('gainCard', this, get.cardsInfo(card));
                            }
                            else {
                                game.addVideo('gain', this, 1);
                            }
                        }
                    }
                    if (get.itemtype(card) == 'cards') {
                        if (log != false &amp;&amp; !_status.video) {
                            game.log(this, '', card);
                        }
                        if (this.$gainmod) {
                            this.$gainmod(card);
                        }
                        else {
                            for (var i = 0; i &lt; card.length; i++) {
                                this.$gain(card[i], false, false);
                            }
                        }
                    }
                    else if (typeof card == 'number' &amp;&amp; card > 1) {
                        if (log != false &amp;&amp; !_status.video) {
                            game.log(this, '' + get.cnNumber(card) + '');
                        }
                        if (this.$gainmod) {
                            this.$gainmod(card);
                        }
                        else {
                            for (var i = 0; i &lt; card; i++) {
                                this.$gain(1, false, false);
                            }
                        }
                    }
                    else {
                        if (get.itemtype(card) == 'card' &amp;&amp; log != false &amp;&amp; !_status.video) {
                            game.log(this, '', card);
                        }
                        if (this.$gainmod) {
                            this.$gainmod(card);
                        }
                        else {
                            var node;
                            if (get.itemtype(card) == 'card') {
                                // node=this.$throwordered(card.copy(),true);
                                node = card.copy('thrown', false);
                            }
                            else {
                                // node=this.$throwordered(ui.create.div('.card.thrown'),true);
                                node = ui.create.div('.card.thrown');
                                node.moveTo = lib.element.card.moveTo;
                                node.moveDelete = lib.element.card.moveDelete;
                            }
                            node.fixed = true;
                            node.style.left = 'calc(50% - 52px ' + ((Math.random() - 0.5 &lt; 0) ? '+' : '-') + ' ' + Math.random() * 100 + 'px)';
                            node.style.top = 'calc(50% - 52px ' + ((Math.random() - 0.5 &lt; 0) ? '+' : '-') + ' ' + Math.random() * 100 + 'px)';
                            node.style.transform = 'scale(0)';
                            node.hide();
                            ui.arena.appendChild(node);
                            ui.refresh(node);
                            node.show();
                            node.style.transform = '';

                            lib.listenEnd(node);
                            var player = this;
                            setTimeout(function () {
                                node.moveDelete(player);
                            }, 700);
                        }
                    }
                },
                $gain2: function (cards, log) {
                    if (log === true) {
                        game.log(this, '', cards);
                    }
                    game.broadcast(function (player, cards) {
                        player.$gain2(cards);
                    }, this, cards);
                    if (get.itemtype(cards) == 'card') cards = [cards];
                    else if (get.itemtype(cards) != 'cards') return;
                    var list = [], list2 = [];
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (cards[i].clone &amp;&amp;
                            (cards[i].clone.parentNode == this.parentNode ||
                                cards[i].clone.parentNode == ui.arena) &amp;&amp;
                            parseFloat(getComputedStyle(cards[i].clone).opacity) > 0.3) {
                            cards[i].clone.moveDelete(this);
                            list2.push(cards[i].clone);
                        }
                        else {
                            list.push(cards[i]);
                        }
                    }
                    if (list2.length) {
                        game.addVideo('gain2', this, get.cardsInfo(list2));
                    }
                    if (list.length) {
                        this.$draw(list, 'nobroadcast');
                        return true;
                    }
                },
                /**
                 * 
                 */
                //TODO
                $skill: function (name, type, color, avatar) {
                    if (typeof type != 'string') type = 'legend';
                    if (!avatar) {
                        this.playerfocus(1500);
                        game.delay(2);
                    }
                    else {
                        game.addVideo('playerfocus2');
                        game.broadcastAll(function () {
                            ui.arena.classList.add('playerfocus');
                            setTimeout(function () {
                                ui.arena.classList.remove('playerfocus');
                            }, 1800)
                        });
                        game.delay(3);
                    }
                    var that = this;
                    setTimeout(function () {
                        game.broadcastAll(function (that, type, name, color, avatar) {
                            if (lib.config.animation &amp;&amp; !lib.config.low_performance) {
                                if (game.chess) {
                                    that['$' + type + '2'](1200);
                                }
                                else {
                                    that['$' + type](1200);
                                }
                            }
                            if (name) {
                                that.$fullscreenpop(name, color, avatar);
                            }
                        }, that, type, name, color, avatar);
                    }, avatar ? 0 : 300);
                },
                $fire: function () {
                    game.addVideo('flame', this, 'fire');
                    var left, top;
                    if (game.chess) {
                        var rect = this.getBoundingClientRect();
                        left = rect.left;
                        top = rect.top;
                    }
                    else {
                        left = this.getLeft();
                        top = this.getTop();
                    }
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 20, 700, 'fire');
                },
                $thunder: function () {
                    game.addVideo('flame', this, 'thunder');
                    var left, top;
                    if (game.chess) {
                        var rect = this.getBoundingClientRect();
                        left = rect.left;
                        top = rect.top;
                    }
                    else {
                        left = this.getLeft();
                        top = this.getTop();
                    }
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'thunder');
                },
                $rare2: function () {
                    game.addVideo('flame', this, 'rare2');
                    var rect = this.getBoundingClientRect();
                    var left = rect.left;
                    var top = rect.top + 15;
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'rare');
                },
                $epic2: function () {
                    game.addVideo('flame', this, 'epic2');
                    var rect = this.getBoundingClientRect();
                    var left = rect.left;
                    var top = rect.top + 15;
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'epic');
                },
                $legend2: function () {
                    game.addVideo('flame', this, 'legend2');
                    var rect = this.getBoundingClientRect();
                    var left = rect.left;
                    var top = rect.top + 15;
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'legend');
                },
                $rare: function (time) {
                    time = time || 700;
                    game.addVideo('flame', this, 'rare');
                    var left, top;
                    if (game.chess) {
                        left = this.getLeft() - ui.arena.offsetLeft;
                        top = this.getTop() - ui.arena.offsetTop;
                    }
                    else {
                        left = this.getLeft();
                        top = this.getTop();
                    }
                    if (this.classList.contains('minskin')) {
                        top += 15;
                    }
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, time, 'rare');
                },
                $epic: function (time) {
                    time = time || 700;
                    game.addVideo('flame', this, 'epic');
                    var left, top;
                    if (game.chess) {
                        left = this.getLeft() - ui.arena.offsetLeft;
                        top = this.getTop() - ui.arena.offsetTop;
                    }
                    else {
                        left = this.getLeft();
                        top = this.getTop();
                    }
                    if (this.classList.contains('minskin')) {
                        top += 15;
                    }
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, time, 'epic');
                },
                $legend: function (time) {
                    time = time || 700;
                    game.addVideo('flame', this, 'legend');
                    var left, top;
                    if (game.chess) {
                        left = this.getLeft() - ui.arena.offsetLeft;
                        top = this.getTop() - ui.arena.offsetTop;
                    }
                    else {
                        left = this.getLeft();
                        top = this.getTop();
                    }
                    if (this.classList.contains('minskin')) {
                        top += 15;
                    }
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, time, 'legend');
                },
                $coin: function () {
                    game.broadcast(function (player) {
                        if (!lib.config.low_performance) {
                            player.$coin();
                        }
                    }, this);
                    game.addVideo('flame', this, 'coin');
                    var left = this.getLeft() - ui.arena.offsetLeft;
                    var top = this.getTop() - ui.arena.offsetTop;
                    if (this.classList.contains('minskin')) {
                        top += 15;
                    }
                    top -= 25;
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'coin');
                },
                $dust: function () {
                    game.broadcast(function (player) {
                        if (!lib.config.low_performance) {
                            player.$dust();
                        }
                    }, this);
                    game.addVideo('flame', this, 'dust');
                    var left = this.getLeft() - ui.arena.offsetLeft;
                    var top = this.getTop() - ui.arena.offsetTop;
                    if (this.classList.contains('minskin')) {
                        top += 15;
                    }
                    top -= 25;
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'dust');
                },
                $recover: function () {
                    game.addVideo('flame', this, 'recover');
                    var left, top;
                    if (game.chess) {
                        var rect = this.getBoundingClientRect();
                        left = rect.left;
                        top = rect.top;
                    }
                    else {
                        left = this.getLeft();
                        top = this.getTop();
                    }
                    game.animate.flame(left + this.offsetWidth / 2,
                        top + this.offsetHeight - 30, 700, 'recover');
                },
                $fullscreenpop: function (str, nature, avatar, broadcast) {
                    if (broadcast !== false) game.broadcast(function (player, str, nature, avatar) {
                        player.$fullscreenpop(str, nature, avatar);
                    }, this, str, nature, avatar);
                    game.addVideo('fullscreenpop', this, [str, nature, avatar]);
                    var node = ui.create.div('.damage');
                    if (avatar &amp;&amp; this.node) {
                        if (avatar == 'vice') {
                            if (lib.character[this.name2]) {
                                avatar = this.node.avatar2;
                            }
                        }
                        else {
                            if (lib.character[this.name]) {
                                avatar = this.node.avatar;
                            }
                        }
                        if (!get.is.div(avatar)) {
                            avatar = false;
                        }
                    }
                    else {
                        avatar = false;
                    }
                    if (avatar) {
                        node.classList.add('fullscreenavatar');
                        ui.create.div('', ui.create.div(node));
                        // ui.create.div('',str.split('').join('&lt;br>'),ui.create.div('.text.textbg',node));
                        ui.create.div('', '&lt;div>' + str.split('').join('&lt;/div>&lt;br>&lt;div>') + '&lt;/div>', ui.create.div('.text', node));
                        node.firstChild.firstChild.style.backgroundImage = avatar.style.backgroundImage;
                        node.dataset.nature = nature || 'unknown';
                        var num = 0;
                        var nodes = node.lastChild.firstChild.querySelectorAll('div');
                        var interval = setInterval(function () {
                            if (num &lt; nodes.length) {
                                nodes[num].classList.add('flashtext');
                                num++;
                            }
                            else {
                                clearInterval(interval);
                            }
                        }, 100);
                    }
                    else {
                        avatar = false;
                        node.innerHTML = str;
                        node.dataset.nature = nature || 'soil';
                    }
                    if (avatar) {
                        var rect1 = ui.window.getBoundingClientRect();
                        var rect2 = this.getBoundingClientRect();
                        var dx = Math.round(2 * rect2.left + rect2.width - rect1.width);
                        var dy = Math.round(2 * rect2.top + rect2.height - rect1.height);
                        node.style.transform = 'scale(0.5) translate(' + dx + 'px,' + dy + 'px)';
                    }
                    ui.window.appendChild(node);
                    ui.refresh(node);
                    if (avatar) {
                        node.style.transform = 'scale(1)';
                        node.style.opacity = 1;
                    }
                    else {
                        node.classList.add('damageadded');
                    }
                    setTimeout(function () {
                        node.delete();
                        node.style.transform = 'scale(1.5)'
                    }, avatar ? 1600 : 1000);
                },
                /**
                 * 
                 * @param {(string|number)} num 
                 * @param {string} [nature='soil'] 
                 * @param {?boolean} font true`damage div``normal-font`false
                 * @param {?boolean} nobroadcast true`game.broadcast`false
                 */
                $damagepop: function (num, nature, font, nobroadcast) {
                    if (typeof num == 'number' || typeof num == 'string') {
                        game.addVideo('damagepop', this, [num, nature, font]);
                        if (nobroadcast !== false) game.broadcast(function (player, num, nature, font) {
                            player.$damagepop(num, nature, font);
                        }, this, num, nature, font);
                        var node = ui.create.div('.damage');
                        if (font) {
                            node.classList.add('normal-font');
                        }
                        if (typeof num == 'number' &amp;&amp; num > 0) {
                            if (num == Infinity) num = '+'
                            else num = '+' + num;
                        }
                        else if (num == -Infinity) num = '-';
                        node.innerHTML = num;
                        this.damagepopups.push(node);
                        node.dataset.nature = nature || 'soil';
                        if (this.damagepopups.length == 1) {
                            this.$damagepop();
                        }
                    }
                    else if (this.damagepopups.length) {
                        var node = this.damagepopups[0];
                        this.appendChild(node);
                        ui.refresh(node);
                        node.classList.add('damageadded');
                        node.listenTransition(function () {
                            setTimeout(function () {
                                node.delete();
                            }, 200);
                        });
                        // setTimeout(function(){
                        //     node.delete();
                        // },500);
                        var that = this;
                        setTimeout(function () {
                            that.damagepopups.shift();
                            that.$damagepop();
                        }, 500);
                    }
                },
                $damage: function (source) {
                    if (get.itemtype(source) == 'player') {
                        game.addVideo('damage', this, source.dataset.position);
                    }
                    else {
                        game.addVideo('damage', this);
                    }
                    game.broadcast(function (player, source) {
                        player.$damage(source);
                    }, this, source);
                    if (source &amp;&amp; source != this &amp;&amp; lib.config.damage_shake) {
                        var left, top;
                        if (source.getTop() == this.getTop()) {
                            left = 20;
                            top = 0;
                        }
                        else {
                            var ratio = (source.getLeft() - this.getLeft()) / (source.getTop() - this.getTop());
                            left = Math.abs(20 * ratio / Math.sqrt(1 + ratio * ratio));
                            top = Math.abs(20 / Math.sqrt(1 + ratio * ratio));
                        }
                        if (source.getLeft() - this.getLeft() > 0) left = -left;
                        if (source.getTop() - this.getTop() > 0) top = -top;
                        if (get.is.mobileMe(this)) {
                            if (this.classList.contains('linked')) {
                                this.node.avatar.style.transform = 'translate(' + left + 'px,' + top + 'px) rotate(-90deg)';
                                this.node.avatar2.style.transform = 'translate(' + left + 'px,' + top + 'px) rotate(-90deg)';
                            }
                            else {
                                this.node.avatar.style.transform = 'translate(' + left + 'px,' + top + 'px)';
                                this.node.avatar2.style.transform = 'translate(' + left + 'px,' + top + 'px)';
                            }
                        }
                        else if (this.classList.contains('linked') &amp;&amp; get.is.newLayout()) {
                            this.style.transform = 'translate(' + left + 'px,' + top + 'px) rotate(-90deg)';
                        }
                        else if (this._chesstransform) {
                            this.style.transform = 'translate(' + (left + this._chesstransform[0]) + 'px,' + (top + this._chesstransform[1]) + 'px)';
                        }
                        else {
                            this.style.transform = 'translate(' + left + 'px,' + top + 'px)';
                        }
                    }
                    else {
                        var zoom1 = 0.9, zoom2 = 0.95;
                        if (arguments[1] == 'phase') {
                            zoom1 = 1.05;
                            zoom2 = 1.05;
                        }
                        if (get.is.mobileMe(this)) {
                            if (this.classList.contains('linked')) {
                                this.node.avatar.style.transform = 'scale(' + zoom1 + ') rotate(-90deg)';
                                this.node.avatar2.style.transform = 'scale(' + zoom1 + ') rotate(-90deg)';
                            }
                            else {
                                this.node.avatar.style.transform = 'scale(' + zoom1 + ')';
                                this.node.avatar2.style.transform = 'scale(' + zoom1 + ')';
                            }
                        }
                        else if (this.classList.contains('linked') &amp;&amp; get.is.newLayout()) {
                            this.style.transform = 'scale(' + zoom2 + ') rotate(-90deg)';
                        }
                        else if (game.chess &amp;&amp; this._chesstransform) {
                            this.style.transform = 'translate(' + this._chesstransform[0] + 'px,' + this._chesstransform[1] + 'px) scale(' + zoom2 + ')';
                        }
                        else {
                            this.style.transform = 'scale(' + zoom2 + ')';
                        }
                    }
                    this.queue();
                },
                $die: function () {
                    game.addVideo('die', this);
                    game.broadcast(function (player) {
                        player.$die();
                    }, this);
                    if (lib.config.die_move != 'off') {
                        this.$dieflip(lib.config.die_move);
                    }
                    if (lib.element.player.$dieAfter) {
                        lib.element.player.$dieAfter.call(this);
                    }
                },
                $dieflip: function (type) {
                    var top0 = ui.window.offsetHeight / 2;
                    var left0 = ui.window.offsetWidth / 2;
                    var ratio = (left0 - this.getLeft()) / (top0 - this.getTop());
                    var left = Math.abs(50 * ratio / Math.sqrt(1 + ratio * ratio));
                    var top = Math.abs(50 / Math.sqrt(1 + ratio * ratio));
                    if (left0 - this.getLeft() > 0) left = -left;
                    if (top0 - this.getTop() > 0) top = -top;
                    if (get.is.mobileMe(this)) {
                        left = -Math.random() * 5 - 10;
                        top = Math.random() * 5 + 10;
                    }
                    if (this._chesstransform) {
                        left += this._chesstransform[0];
                        top += this._chesstransform[1];
                    }
                    var transform = 'translate(' + left + 'px,' + top + 'px) ' +
                        'rotate(' + (Math.random() * 20 - 10) + 'deg) ';
                    if (type == 'flip') {
                        if (game.layout == 'long' || game.layout == 'long2') {
                            transform += 'rotateY(180deg)';
                        }
                        else {
                            transform += ((Math.random() - 0.5 &lt; 0) ? 'rotateX(180deg)' : 'rotateY(180deg)');
                        }
                    }
                    if (get.is.mobileMe(this)) {
                        this.node.avatar.style.transform = transform;
                        this.node.avatar2.style.transform = transform;
                        this.style.transform = '';
                    }
                    else {
                        this.node.avatar.style.transform = '';
                        this.node.avatar2.style.transform = '';
                        this.style.transform = transform;
                    }
                    this.queue(false);
                },
                $phaseJudge: function (card) {
                    game.addVideo('phaseJudge', this, get.cardInfo(card));
                    var player = this;
                    var clone = player.$throw(card);
                    if (lib.config.low_performance &amp;&amp; card &amp;&amp; card.clone) {
                        var waitingForTransition = get.time();
                        _status.waitingForTransition = waitingForTransition;
                        card.clone.listenTransition(function () {
                            if (_status.waitingForTransition == waitingForTransition &amp;&amp; _status.paused) {
                                game.resume();
                            }
                        });
                        game.pause();
                    }
                    else {
                        game.delay();
                    }
                }
            },
            /**
             * .cardhasPositionadd/removeGaintag
             * 
             * @namespace
             * @mixin
             */
            card: {
                /**
                 * gain`this.node.gaintag`
                 * @param {(string|Array&lt;string>)} gaintag gain****gaingain
                 */
                addGaintag: function (gaintag) {
                    if (Array.isArray(gaintag)) this.gaintag = gaintag.slice(0);
                    else this.gaintag.add(gaintag);
                    var str = '';
                    for (var gi = 0; gi &lt; this.gaintag.length; gi++) {
                        str += get.translation(this.gaintag[gi]);
                        if (gi &lt; this.gaintag.length - 1) str += ' ';
                    }
                    this.node.gaintag.innerHTML = str;
                },
                /**
                 * gaingain`this.node.gaintag`
                 * @param {(string|true)} tag gaingaintruegain
                 */
                removeGaintag: function (tag) {
                    if (tag === true) {
                        if (this.gaintag &amp;&amp; this.gaintag.length || this.node.gaintag.innerHTML.length) this.addGaintag([]);
                    }
                    else if (this.hasGaintag(tag)) {
                        this.gaintag.remove(tag);
                        this.addGaintag(this.gaintag);
                    }
                },
                /**
                 * gain
                 * @param {!string} tag gain
                 * @returns {!boolean}
                 */
                hasGaintag: function (tag) {
                    if (['ming_', 'an_'].contains(tag)) {
                        return this.gaintag &amp;&amp; this.gaintag.filter(function (gain) {
                            return gain.indexOf(tag) == 0;
                        }).length;
                    }
                    else return this.gaintag &amp;&amp; this.gaintag.contains(tag);
                },
                /**
                 * 
                 * info.global{@link lib.skill.global}
                 * @function
                 * @param {(Array|Object)} card TODO
                 * @returns {!GameCores.GameObjects.Card} this self
                 */
                init: function (card) {
                    if (Array.isArray(card)) {
                        if (card[2] == 'huosha') {
                            card[2] = 'sha';
                            card[3] = 'fire';
                        }
                        if (card[2] == 'leisha') {
                            card[2] = 'sha';
                            card[3] = 'thunder';
                        }
                        if (card[2] == 'kamisha') {
                            card[2] = 'sha';
                            card[3] = 'kami';
                        }
                        if (card[2] == 'icesha') {
                            card[2] = 'sha';
                            card[3] = 'ice';
                        }
                        if (card[2] == 'haisha') {
                            card[2] = 'sha';
                            card[3] = 'ocean';
                        }
                        if (card[2] == 'yamisha') {
                            card[2] = 'sha';
                            card[3] = 'yami';
                        }
                        if (card[2] == 'haitao') {
                            card[2] = 'tao';
                            card[3] = 'ocean';
                        }
                        if (card[2] == 'haijiu') {
                            card[2] = 'jiu';
                            card[3] = 'ocean';
                        }
                    }
                    else if (typeof card == 'object') {
                        card = [card.suit, card.number, card.name, card.nature];
                        card[5] = card.specialEffects
                    }
                    var cardnum = card[1] || '';
                    if (parseInt(cardnum) == cardnum) cardnum = parseInt(cardnum);
                    if ([1, 11, 12, 13, 14].contains(cardnum)) {
                        cardnum = { '1': 'A', '11': 'J', '12': 'Q', '13': 'K', '14': '' }[cardnum]
                    }
                    if (!lib.card[card[2]]) {
                        lib.card[card[2]] = {};
                    }
                    var info = lib.card[card[2]];
                    if (info.global &amp;&amp; !this.classList.contains('button')) {
                        if (Array.isArray(info.global)) {
                            while (info.global.length) {
                                game.addGlobalSkill(info.global.shift());
                            }
                        }
                        else if (typeof info.global == 'string') {
                            game.addGlobalSkill(info.global);
                        }
                        delete info.global;
                    }
                    if (this.name) {
                        this.classList.remove('epic');
                        this.classList.remove('legend');
                        this.classList.remove('gold');
                        this.classList.remove('unique');
                        this.style.background = '';
                        var subtype = get.subtype(this);
                        if (subtype) {
                            this.classList.remove(subtype);
                        }
                    }
                    if (info.epic) {
                        this.classList.add('epic');
                    }
                    else if (info.legend) {
                        this.classList.add('legend');
                    }
                    else if (info.gold) {
                        this.classList.add('gold');
                    }
                    else if (info.unique) {
                        this.classList.add('unique');
                    }
                    var bg = card[2];
                    if (info.cardimage) {
                        bg = info.cardimage;
                    }
                    var img = lib.card[bg].image;
                    if (img) {
                        if (img.indexOf('db:') == 0) {
                            img = img.slice(3);
                        }
                        else if (img.indexOf('ext:') != 0) {
                            img = null;
                        }
                    }
                    this.classList.remove('fullskin');
                    this.classList.remove('fullimage');
                    this.classList.remove('fullborder');
                    this.dataset.cardName = card[2];
                    this.dataset.cardType = info.type || '';
                    this.dataset.cardSubype = info.subtype || '';
                    this.dataset.cardMultitarget = info.multitarget ? '1' : '0';
                    this.node.name.dataset.nature = '';
                    this.node.info.classList.remove('red');
                    if (!lib.config.hide_card_image &amp;&amp; lib.card[bg].fullskin) {
                        this.classList.add('fullskin');
                        if (img) {
                            if (img.indexOf('ext:') == 0) {
                                this.node.image.setBackgroundImage(img.replace(/ext:/, 'extension/'));
                            }
                            else {
                                this.node.image.setBackgroundDB(img);
                            }
                        }
                        else {
                            if (lib.card[bg].modeimage) {
                                this.node.image.setBackgroundImage('image/mode/' + lib.card[bg].modeimage + '/card/' + bg + '.png');
                            }
                            else {
                                if (bg.indexOf('rm_') == 0) {
                                    var bg = bg.slice(3);
                                    this.node.image.setBackgroundImage('image/replace/' + bg + '.png');
                                }
                                else if (lib.config.replace_image) {
                                    this.node.image.setBackgroundImage('image/replace/' + bg + '.png');
                                }
                                else {
                                    this.node.image.setBackgroundImage('image/card/' + bg + '.png');
                                }
                            }
                        }
                    }
                    else if (lib.card[bg].image == 'background') {
                        if (card[3]) this.node.background.setBackground(bg + '_' + card[3], 'card');
                        else this.node.background.setBackground(bg, 'card');
                    }
                    else if (lib.card[bg].fullimage) {
                        this.classList.add('fullimage');
                        if (img) {
                            if (img.indexOf('ext:') == 0) {
                                this.setBackgroundImage(img.replace(/ext:/, 'extension/'));
                                this.style.backgroundSize = 'cover';
                            }
                            else {
                                this.setBackgroundDB(img);
                            }
                        }
                        else if (lib.card[bg].image) {
                            if (lib.card[bg].image.indexOf('character:') == 0) {
                                this.setBackground(lib.card[bg].image.slice(10), 'character');
                            }
                            else {
                                this.setBackground(lib.card[bg].image);
                            }
                        }
                        else {
                            var cardPack = lib.cardPack['mode_' + get.mode()];
                            if (Array.isArray(cardPack) &amp;&amp; cardPack.contains(bg)) {
                                this.setBackground('mode/' + get.mode() + '/card/' + bg);
                            }
                            else {
                                this.setBackground('card/' + bg);
                            }
                        }
                    }
                    else if (lib.card[bg].fullborder) {
                        this.classList.add('fullborder');
                        if (lib.card[bg].fullborder == 'gold') {
                            this.node.name.dataset.nature = 'metalmm';
                        }
                        else if (lib.card[bg].fullborder == 'silver') {
                            this.node.name.dataset.nature = 'watermm';
                        }
                        if (!this.node.avatar) {
                            this.node.avatar = ui.create.div('.cardavatar');
                            this.insertBefore(this.node.avatar, this.firstChild);
                        }
                        if (!this.node.framebg) {
                            this.node.framebg = ui.create.div('.cardframebg');
                            this.node.framebg.dataset.auto = lib.card[bg].fullborder;
                            this.insertBefore(this.node.framebg, this.firstChild);
                        }
                        if (img) {
                            if (img.indexOf('ext:') == 0) {
                                this.node.avatar.setBackgroundImage(img.replace(/ext:/, 'extension/'));
                                this.node.avatar.style.backgroundSize = 'cover';
                            }
                            else {
                                this.node.avatar.setBackgroundDB(img);
                            }
                        }
                        else if (lib.card[bg].image) {
                            if (lib.card[bg].image.indexOf('character:') == 0) {
                                this.node.avatar.setBackground(lib.card[bg].image.slice(10), 'character');
                            }
                            else {
                                this.node.avatar.setBackground(lib.card[bg].image);
                            }
                        }
                        else {
                            var cardPack = lib.cardPack['mode_' + get.mode()];
                            if (Array.isArray(cardPack) &amp;&amp; cardPack.contains(bg)) {
                                this.node.avatar.setBackground('mode/' + get.mode() + '/card/' + bg);
                            }
                            else {
                                this.node.avatar.setBackground('card/' + bg);
                            }
                        }
                    }
                    else if (lib.card[bg].image == 'card') {
                        if (card[3]) this.setBackground(bg + '_' + card[3], 'card');
                        else this.setBackground(bg, 'card');
                    }
                    else if (typeof lib.card[bg].image == 'string' &amp;&amp; !lib.card[bg].fullskin) {
                        if (img) {
                            if (img.indexOf('ext:') == 0) {
                                this.setBackgroundImage(img.replace(/ext:/, 'extension/'));
                                this.style.backgroundSize = 'cover';
                            }
                            else {
                                this.setBackgroundDB(img);
                            }
                        }
                        else {
                            this.setBackground(lib.card[bg].image);
                        }
                    }
                    else {
                        this.node.background.innerHTML = lib.translate[bg + '_cbg'] || lib.translate[bg + '_bg'] || get.translation(bg)[0];
                        // this.node.background.style.fontFamily=lib.config.card_font;
                        if (this.node.background.innerHTML.length > 1) this.node.background.classList.add('tight');
                        else this.node.background.classList.remove('tight');
                    }
                    if ((bg == 'wuxingpan' || !lib.card[bg].fullborder) &amp;&amp; this.node.avatar &amp;&amp; this.node.framebg) {
                        this.node.avatar.remove();
                        this.node.framebg.remove();
                        delete this.node.avatar;
                        delete this.node.framebg;
                    }
                    if (info.noname &amp;&amp; !this.classList.contains('button')) {
                        this.node.name.style.display = 'none';
                    }
                    if (info.color) {
                        this.style.color = info.color;
                    }
                    if (info.textShadow) {
                        this.style.textShadow = info.textShadow;
                    }
                    if (info.opacity) {
                        this.node.info.style.opacity = info.opacity;
                        this.node.name.style.opacity = info.opacity;
                    }
                    if (info.modinfo) {
                        this.node.info.innerHTML = info.modinfo;
                    }
                    else {
                        this.node.info.innerHTML = get.translation(card[0]) + '&lt;span> &lt;/span>' + cardnum;
                    }
                    if (info.addinfo) {
                        if (!this.node.addinfo) {
                            this.node.addinfo = ui.create.div('.range', this);
                        }
                        this.node.addinfo.innerHTML = info.addinfo;
                    }
                    else if (this.node.addinfo) {
                        this.node.addinfo.remove();
                        delete this.node.addinfo;
                    }
                    if (card[0] == 'heart' || card[0] == 'diamond') {
                        this.node.info.classList.add('red');
                    }
                    this.node.name.innerHTML = '';
                    this.node.image.className = 'image';
                    var name = get.translation(card[2]);
                    if (name.length == 1) {
                        if (card[3] == 'fire') {
                            name = '' + name;
                            this.node.image.classList.add('fire');
                        }
                        else if (card[3] == 'thunder') {
                            name = '' + name;
                            this.node.image.classList.add('thunder');
                        }
                        else if (card[3] == 'kami') {
                            name = '' + name;
                            this.node.image.classList.add('kami');
                        }
                        else if (card[3] == 'ice') {
                            name = '' + name;
                            this.node.image.classList.add('ice');
                        }
                        else if (card[3] == 'ocean') {
                            name = '' + name;
                            this.node.image.classList.add('ocean');
                        }
                        else if (card[3] == 'yami') {
                            name = '' + name;
                            this.node.image.classList.add('yami');
                        }
                    } else {
                        if (card[3] == 'fire') {
                            this.node.image.classList.add('fire');
                        }
                        else if (card[3] == 'thunder') {
                            this.node.image.classList.add('thunder');
                        }
                        else if (card[3] == 'kami') {
                            this.node.image.classList.add('kami');
                        }
                        else if (card[3] == 'ice') {
                            this.node.image.classList.add('ice');
                        }
                        else if (card[3] == 'ocean') {
                            name = name.replace(name.charAt(0), '');
                            this.node.image.classList.add('ocean');
                        }
                        else if (card[3] == 'yami') {
                            name = name.replace(name.charAt(0), '');
                            this.node.image.classList.add('yami');
                        }
                    }
                    for (var i = 0; i &lt; name.length; i++) {
                        this.node.name.innerHTML += name[i] + '&lt;br/>';
                    }
                    if (name.length >= 5) {
                        this.node.name.classList.add('long');
                        if (name.length >= 7) {
                            this.node.name.classList.add('longlong');
                        }
                    }
                    this.node.name2.innerHTML = get.translation(card[0]) + cardnum + ' ' + name;
                    this.suit = card[0];
                    this.number = parseInt(card[1]) || 0;
                    this.name = card[2];
                    this.classList.add('card');
                    if (card[3]) {
                        if (lib.nature.contains(card[3])) this.nature = card[3];
                        this.classList.add(card[3]);
                    }
                    else if (this.nature) {
                        this.classList.remove(this.nature);
                        delete this.nature;
                    }
                    if (info.subtype) this.classList.add(info.subtype);
                    if (this.inits) {
                        for (var i = 0; i &lt; lib.element.card.inits.length; i++) {
                            lib.element.card.inits[i](this);
                        }
                    }
                    if (typeof info.init == 'function') info.init();
                    this.node.range.innerHTML = '';
                    switch (get.subtype(this)) {
                        case 'equip1':
                            var added = false;
                            if (lib.card[this.name] &amp;&amp; lib.card[this.name].distance) {
                                var dist = lib.card[this.name].distance;
                                if (dist.attackFrom) {
                                    added = true;
                                    this.node.range.innerHTML = ': ' + (-dist.attackFrom + 1);
                                }
                            }
                            if (!added) {
                                this.node.range.innerHTML = ': 1';
                            }
                            break;
                        case 'equip3':
                            if (info.distance &amp;&amp; info.distance.globalTo) {
                                this.node.range.innerHTML = ': ' + info.distance.globalTo;
                                this.node.name2.innerHTML += '+';
                            }
                            break;
                        case 'equip4':
                            if (info.distance &amp;&amp; info.distance.globalFrom) {
                                this.node.range.innerHTML = ': ' + (-info.distance.globalFrom);
                                this.node.name2.innerHTML += '-';
                            }
                            break;
                    }
                    var specialEffects = [];
                    if (Array.isArray(card[5])) {
                        specialEffects.addArray(card[5]);
                    }
                    if (this.node.image.parentNode.classList.length > 0)
                        this.node.image.parentNode.classList.forEach(element => {
                            if (element.indexOf("card_") != -1) {
                                this.node.image.parentNode.classList.remove(element);
                            }
                        });
                    if (specialEffects.length) {
                        for (var i = 0; i &lt; specialEffects.length; i++) {
                            this.node.image.parentNode.classList.add(specialEffects[i]);
                        }
                        this.specialEffects = specialEffects;
                    }
                    if (_status.connectMode &amp;&amp; !game.online &amp;&amp; lib.cardOL &amp;&amp; !this.cardid) {
                        this.cardid = get.id();
                        lib.cardOL[this.cardid] = this;
                    }
                    if (!_status.connectMode &amp;&amp; !_status.video) {
                        this.cardid = get.id();
                    }
                    var tags = [];
                    if (Array.isArray(card[4])) {
                        tags.addArray(card[4]);
                    }
                    if (this.cardid) {
                        if (!_status.cardtag) {
                            _status.cardtag = {};
                        }
                        for (var i in _status.cardtag) {
                            if (_status.cardtag[i].contains(this.cardid)) {
                                tags.add(i);
                            }
                        }
                        if (tags.length) {
                            var tagstr = ' &lt;span class="cardtag">';
                            for (var i = 0; i &lt; tags.length; i++) {
                                var tag = tags[i];
                                if (!_status.cardtag[tag]) {
                                    _status.cardtag[tag] = [];
                                }
                                _status.cardtag[tag].add(this.cardid);
                                tagstr += lib.translate[tag + '_tag'];
                            }
                            tagstr += '&lt;/span>';
                            this.node.range.innerHTML += tagstr;
                        }
                    }
                    return this;
                },
                /**
                 * `ui.me`()
                 * @param {?boolean} [bool] truetranslate`translateY(-20px)`
                 * @param {?number} [delay] `delay`(ms)0
                 */
                updateTransform: function (bool, delay) {
                    if (delay) {
                        var that = this;
                        setTimeout(function () {
                            that.updateTransform(that.classList.contains('selected'));
                        }, delay);
                    }
                    else {
                        if (_status.event.player != game.me) return;
                        if (this._transform &amp;&amp; this.parentNode &amp;&amp; this.parentNode.parentNode &amp;&amp;
                            this.parentNode.parentNode.parentNode == ui.me &amp;&amp;
                            (!_status.mousedown || _status.mouseleft) &amp;&amp;
                            (!this.parentNode.parentNode.classList.contains('scrollh') || (game.layout == 'long2' || game.layout == 'nova'))) {
                            if (bool) {
                                this.style.transform = this._transform + ' translateY(-20px)';
                            }
                            else {
                                this.style.transform = this._transform || '';
                            }
                        }
                    }
                },
                aiexclude: function () {
                    _status.event._aiexclude.add(this);
                },
                getSource: function (name) {
                    if (this.name == name) return true;
                    var info = lib.card[this.name];
                    if (info &amp;&amp; Array.isArray(info.source)) {
                        return info.source.contains(name);
                    }
                    return false;
                },
                moveDelete: function (player) {
                    this.fixed = true;
                    if (!this._listeningEnd || this._transitionEnded) {
                        this.moveTo(player);
                        var that = this;
                        setTimeout(function () {
                            that.delete();
                        }, 200);
                    }
                    else {
                        this._onEndMoveDelete = player;
                    }
                },
                moveTo: function (player) {
                    this.fixed = true;
                    var dx, dy;
                    if (this.classList.contains('center')) {
                        var nx = [50, -52];
                        var ny = [50, -52];
                        nx = nx[0] * ui.arena.offsetWidth / 100 + nx[1];
                        ny = ny[0] * ui.arena.offsetHeight / 100 + ny[1];
                        dx = player.getLeft() + player.offsetWidth / 2 - 52 - nx;
                        dy = player.getTop() + player.offsetHeight / 2 - 52 - ny;
                    }
                    else {
                        this.style.left = this.offsetLeft + 'px';
                        this.style.top = this.offsetTop + 'px';

                        dx = player.getLeft() + player.offsetWidth / 2 - 52 - this.offsetLeft;
                        dy = player.getTop() + player.offsetHeight / 2 - 52 - this.offsetTop;
                    }
                    if (get.is.mobileMe(player)) {
                        dx += get.cardOffset();
                        if (ui.arena.classList.contains('oblongcard')) {
                            dy -= 16;
                        }
                    }


                    if (this.style.transform &amp;&amp; this.style.transform != 'none' &amp;&amp; this.style.transform.indexOf('translate') == -1) {
                        this.style.transform += ' translate(' + dx + 'px,' + dy + 'px)';
                    }
                    else {
                        this.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';
                    }
                    return this;
                },
                copy: function () {
                    var node = this.cloneNode(true);
                    node.style.transform = '';
                    node.name = this.name;
                    node.suit = this.suit;
                    node.number = this.number;
                    node.classList.remove('hidden');
                    node.classList.remove('start');
                    node.classList.remove('thrown');
                    node.classList.remove('selectable');
                    node.classList.remove('selected');
                    node.classList.remove('removing');
                    node.classList.remove('drawinghidden');
                    node.classList.remove('glows');
                    node.node = {
                        name: node.querySelector('.name'),
                        info: node.querySelector('.info'),
                        intro: node.querySelector('.intro'),
                        background: node.querySelector('.background'),
                        image: node.querySelector('.image'),
                        gaintag: node.querySelector('.gaintag'),
                    }
                    node.node.gaintag.innerHTML = '';
                    var clone = true;
                    var position;
                    for (var i = 0; i &lt; arguments.length; i++) {
                        if (typeof arguments[i] == 'string') node.classList.add(arguments[i]);
                        else if (get.objtype(arguments[i]) == 'div') position = arguments[i];
                        else if (typeof arguments[i] == 'boolean') clone = arguments[i];
                    }
                    node.moveTo = lib.element.card.moveTo;
                    node.moveDelete = lib.element.card.moveDelete;
                    if (clone) this.clone = node;
                    if (position) position.appendChild(node);
                    return node;
                },
                uncheck: function (skill) {
                    if (skill) this._uncheck.add(skill);
                    this.classList.add('uncheck');
                },
                recheck: function (skill) {
                    if (skill) this._uncheck.remove(skill);
                    else this._uncheck.length = 0;
                    if (this._uncheck.length == 0) this.classList.remove('uncheck');
                },
                discard: function (bool) {
                    if (!this.destroyed) {
                        ui.discardPile.appendChild(this);
                    }
                    this.fix();
                    this.classList.remove('glow');
                    if (bool === false) {
                        ui.cardPile.insertBefore(this, ui.cardPile.childNodes[Math.floor(Math.random() * ui.cardPile.childNodes.length)]);
                    }
                    else {
                        if (_status.discarded) {
                            _status.discarded.add(this);
                        }
                    }
                },
                hasTag: function (tag) {
                    if (this.cardid &amp;&amp; _status.cardtag &amp;&amp; _status.cardtag[tag] &amp;&amp; _status.cardtag[tag].contains(this.cardid)) {
                        return true;
                    }
                    return false;
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                hasPosition: function () {
                    return ['h', 'e', 'j'].contains(get.position(this));
                },
                /**
                 * 
                 * @returns {!boolean}
                 */
                isInPile: function () {
                    return ['c', 'd'].contains(get.position(this));
                }
            },
            /**
             * 
             * @name element.button
             * @type {!Object}
             */
            button: {
                exclude: function () {
                    if (_status.event.excludeButton == undefined) {
                        _status.event.excludeButton = [];
                    }
                    _status.event.excludeButton.add(this);
                }
            },
            /**
             * setContentfinish
             * 
             * @namespace
             * @mixin
             */
            event: {
                changeToZero: function () {
                    this.num = 0;
                    this.numFixed = true;
                },
                /**
                 * 
                 * @function
                 */
                finish: function () {
                    this.finished = true;
                },
                /**
                 * 
                 * 
                 * @function
                 * @param {?boolean} all {@link lib.element.event.untrigger}
                 * @param {?GameCores.GameObjects.Player} player {@link lib.element.event.untrigger}
                 * @param {?string} notrigger 'notrigger'****`${this.name}Cancelled`
                 */
                cancel: function (arg1, arg2, notrigger) {
                    this.untrigger.call(this, arguments);//??
                    this.finish();
                    if (notrigger != 'notrigger') {
                        this.trigger(this.name + 'Cancelled');
                        if (this.player &amp;&amp; lib.phaseName.contains(this.name)) this.player.getHistory('skipped').add(this.name)
                    }
                },
                /**
                 * 
                 * @function
                 * @param {!number} step 
                 */
                goto: function (step) {
                    this.step = step - 1;
                },
                /**
                 * ()
                 * @function
                 */
                redo: function () {
                    this.step--;
                },
                setHiddenSkill: function (skill) {
                    if (!this.player) return this;
                    var hidden = this.player.hiddenSkills.slice(0);
                    game.expandSkills(hidden);
                    if (hidden.contains(skill)) this.set('hsskill', skill);
                    return this;
                },
                /**
                 * Event
                 * `this[key] = value``this._set.push([key, value])`
                 * @function lib.element.event.set
                 * @param {!string} key 
                 * @param {?Object} value 
                 * @returns {GameCores.GameObjects.Event} this self
                 */
                /**
                 * Event
                 * {@link lib.element.event.set}Event
                 * @function lib.element.event.set
                 * @variation 2
                 * @param {!Array&lt;Array>} pairs 
                 * @param {!string} pairs[].'[0]' 
                 * @param {?Object} pairs[].'[1]' 
                 */
                set: function (key, value) {
                    if (arguments.length == 1 &amp;&amp; Array.isArray(arguments[0])) {
                        for (var i = 0; i &lt; arguments[0].length; i++) {
                            if (Array.isArray(arguments[0][i])) {
                                this.set(arguments[0][i][0], arguments[0][i][1]);
                            }
                        }
                    }
                    else {
                        if (typeof key != 'string') {
                            console.log('warning: using non-string object as event key');
                            console.log(key, value);
                            console.log(_status.event);
                        }
                        this[key] = value;
                        this._set.push([key, value]);
                    }
                    return this;
                },
                /**
                 * 
                 * @function
                 * @param {?GameCores.Bases.StateMachine} stateMachine 
                 * @returns {GameCores.Bases.Event} this self
                 */
                /**
                 * 
                 * @param {?string} name `lib.element.content[name]`{@link lib.element.content}
                 * @returns {GameCores.Bases.Event} this self
                 */
                setContent: function (name) {
                    if (typeof name == 'function') {
                        this.content = lib.init.parse(name);
                    }
                    else {
                        if (!lib.element.content[name]._parsed) {
                            lib.element.content[name] = lib.init.parse(lib.element.content[name]);
                            lib.element.content[name]._parsed = true;
                        }
                        this.content = lib.element.content[name];
                    }
                    return this;
                },
                getLogv: function () {
                    for (var i = 1; i &lt;= 3; i++) {
                        var event = this.getParent(i);
                        if (event &amp;&amp; event.logvid) return event.logvid;
                    }
                    return null;
                },
                send: function () {
                    this.player.send(function (name, args, set, event, skills) {
                        game.me.applySkills(skills);
                        var next = game.me[name].apply(game.me, args);
                        for (var i = 0; i &lt; set.length; i++) {
                            next.set(set[i][0], set[i][1]);
                        }
                        if (next._backupevent) {
                            next.backup(next._backupevent);
                        }
                        next._modparent = event;
                        game.resume();
                    }, this.name, this._args || [], this._set,
                        get.stringifiedResult(this.parent, 3), get.skillState(this.player));
                    this.player.wait();
                    game.pause();
                },
                /**
                 * (cardtarget, skill)
                 */
                resume: function () {
                    delete this._cardChoice;
                    delete this._targetChoice;
                    delete this._skillChoice;
                },
                /**
                 * 
                 * @function
                 * @param {(string|number)} [level]  | numberlevel_parent
                 * @param {?boolean} [forced] true{null}
                 * @returns {?GameCores.Bases.Event} _parent_modparentlevel_parent
                 */
                getParent: function (level, forced) {
                    var parent;
                    if (this._modparent &amp;&amp; game.online) {
                        parent = this._modparent;
                    }
                    else {
                        parent = this.parent;
                    }
                    var toreturn = {};
                    if (typeof level == 'string' &amp;&amp; forced == true) {
                        toreturn = null;
                    }
                    if (!parent) return toreturn;
                    if (typeof level == 'number') {
                        for (var i = 1; i &lt; level; i++) {
                            if (!parent) return toreturn;
                            parent = parent.parent;
                        }
                    }
                    else if (typeof level == 'string') {
                        for (var i = 0; i &lt; 20; i++) {
                            if (!parent) return toreturn;
                            if (parent.name == level) return parent;
                            parent = parent.parent;
                        }
                        if (!parent) return toreturn;
                    }
                    if (toreturn === null) {
                        return null;
                    }
                    return parent;
                },
                /**
                 * 
                 * @function
                 * @returns {?GameCores.Bases.Event} undefined/null
                 */
                getTrigger: function () {
                    return this.getParent()._trigger;
                },
                /**
                 * `this._rand`(undefined)
                 * @returns {!number} this._rand
                 */
                getRand: function (name) {
                    if (name) {
                        if (!this._rand_map) this._rand_map = {};
                        if (!this._rand_map[name]) this._rand_map[name] = Math.random();
                        return this._rand_map[name];
                    }
                    if (!this._rand) this._rand = Math.random();
                    return this._rand;
                },
                /**
                 * `${this.name}Inserted`
                 * @function
                 * @param {?GameCores.Bases.StateMachine} stateMachine 
                 * @param {?Object&lt;string, Object>} map 
                 * @returns {!GameCores.Bases.Event} 
                 */
                insert: function (func, map) {
                    var next = game.createEvent(this.name + 'Inserted', false, this);
                    next.setContent(func);
                    for (var i in map) {
                        next.set(i, map[i]);
                    }
                    return next;
                },
                /**
                 * `${this.name}Inserted`
                 * @function
                 * @param {?GameCores.Bases.StateMachine} stateMachine 
                 * @param {?Object&lt;string, Object>} map 
                 * @returns {!GameCores.Bases.Event} 
                 */
                insertAfter: function (func, map) {
                    var next = game.createEvent(this.name + 'Inserted', false, { next: [] });
                    this.after.push(next);
                    next.setContent(func);
                    for (var i in map) {
                        next.set(i, map[i]);
                    }
                    return next;
                },
                /**
                 * 
                 * @function
                 * @param {?string} skill ID
                 */
                backup: function (skill) {
                    this._backup = {
                        filterButton: this.filterButton,
                        selectButton: this.selectButton,
                        filterTarget: this.filterTarget,
                        selectTarget: this.selectTarget,
                        filterCard: this.filterCard,
                        selectCard: this.selectCard,
                        position: this.position,
                        forced: this.forced,
                        fakeforce: this.fakeforce,
                        _aiexclude: this._aiexclude,
                        complexSelect: this.complexSelect,
                        complexCard: this.complexCard,
                        complexTarget: this.complexTarget,
                        _cardChoice: this._cardChoice,
                        _targetChoice: this._targetChoice,
                        _skillChoice: this._skillChoice,
                        ai1: this.ai1,
                        ai2: this.ai2,
                    }
                    if (skill) {
                        var info = get.info(skill);
                        this.skill = skill;
                        this._aiexclude = [];
                        if (typeof info.viewAs == 'function') {
                            if (info.filterButton != undefined) this.filterButton = get.filter(info.filterButton);
                            if (info.selectButton != undefined) this.selectButton = info.selectButton;
                            if (info.filterTarget != undefined) this.filterTarget = get.filter(info.filterTarget);
                            if (info.selectTarget != undefined) this.selectTarget = info.selectTarget;
                            if (info.filterCard != undefined) {
                                if (info.ignoreMod) this.ignoreMod = true;
                                this.filterCard2 = get.filter(info.filterCard);
                                this.filterCard = function (card, player, event) {
                                    var evt = event || _status.event;
                                    if (!evt.ignoreMod &amp;&amp; player) {
                                        var mod = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                                        if (mod != 'unchanged') return mod;
                                        if (evt._backup &amp;&amp; evt._backup.filterCard) {
                                            var cardx2 = lib.skill[evt.skill].viewAs(ui.selected.cards.concat([card]), player);
                                            if (get.is.object(cardx2)) {
                                                var cardx = get.autoViewAs(cardx2, ui.selected.cards.concat([card]));
                                                if (!get.filter(evt._backup.filterCard)(cardx, player, evt)) return false;
                                            }
                                        }
                                    }
                                    return get.filter(evt.filterCard2).apply(this, arguments);
                                };
                            }
                            if (info.selectCard != undefined) this.selectCard = info.selectCard;
                            if (info.position != undefined) this.position = info.position;
                            if (info.forced != undefined) this.forced = info.forced;
                            if (info.complexSelect != undefined) this.complexSelect = info.complexSelect;
                            if (info.complexCard != undefined) this.complexCard = info.complexCard;
                            if (info.complexTarget != undefined) this.complexTarget = info.complexTarget;
                            if (info.ai1 != undefined) this.ai1 = info.ai1;
                            if (info.ai2 != undefined) this.ai2 = info.ai2;
                        }
                        else if (info.viewAs) {
                            if (info.filterButton != undefined) this.filterButton = get.filter(info.filterButton);
                            if (info.selectButton != undefined) this.selectButton = info.selectButton;
                            if (info.filterTarget != undefined) this.filterTarget = get.filter(info.filterTarget);
                            if (info.selectTarget != undefined) this.selectTarget = info.selectTarget;
                            if (info.filterCard != undefined) {
                                if (info.ignoreMod) this.ignoreMod = true;
                                this.filterCard2 = get.filter(info.filterCard);
                                this.filterCard = function (card, player, event) {
                                    var evt = event || _status.event;
                                    if (!evt.ignoreMod &amp;&amp; player) {
                                        var mod = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                                        if (mod != 'unchanged') return mod;
                                        if (evt._backup &amp;&amp; evt._backup.filterCard) {
                                            var cardx = get.autoViewAs(lib.skill[evt.skill].viewAs, ui.selected.cards.concat([card]));
                                            if (!get.filter(evt._backup.filterCard)(cardx, player, evt)) return false;
                                        };
                                    }
                                    return get.filter(evt.filterCard2).apply(this, arguments);
                                };
                            }
                            if (info.selectCard != undefined) this.selectCard = info.selectCard;
                            if (info.position != undefined) this.position = info.position;
                            if (info.forced != undefined) this.forced = info.forced;
                            if (info.complexSelect != undefined) this.complexSelect = info.complexSelect;
                            if (info.complexCard != undefined) this.complexCard = info.complexCard;
                            if (info.complexTarget != undefined) this.complexTarget = info.complexTarget;
                            if (info.ai1 != undefined) this.ai1 = info.ai1;
                            if (info.ai2 != undefined) this.ai2 = info.ai2;
                        }
                        else {
                            this.filterButton = info.filterButton ? get.filter(info.filterButton) : undefined;
                            this.selectButton = info.selectButton;
                            this.filterTarget = info.filterTarget ? get.filter(info.filterTarget) : undefined;
                            this.selectTarget = info.selectTarget;
                            this.filterCard = info.filterCard ? get.filter(info.filterCard) : undefined;
                            this.selectCard = info.selectCard;
                            this.position = info.position;
                            this.forced = info.forced;
                            this.complexSelect = info.complexSelect;
                            this.complexCard = info.complexCard;
                            this.complexTarget = info.complexTarget;
                            if (info.ai1 != undefined) this.ai1 = info.ai1;
                            if (info.ai2 != undefined) this.ai2 = info.ai2;
                        }
                        delete this.fakeforce;
                    }
                    delete this._cardChoice;
                    delete this._targetChoice;
                    delete this._skillChoice;
                },
                restore: function () {
                    if (this._backup) {
                        this.filterButton = this._backup.filterButton;
                        this.selectButton = this._backup.selectButton;
                        this.filterTarget = this._backup.filterTarget;
                        this.selectTarget = this._backup.selectTarget;
                        this.filterCard = this._backup.filterCard;
                        this.selectCard = this._backup.selectCard;
                        this.position = this._backup.position;
                        this.forced = this._backup.forced;
                        this.fakeforce = this._backup.fakeforce;
                        this._aiexclude = this._backup._aiexclude;
                        this.complexSelect = this._backup.complexSelect;
                        this.complexCard = this._backup.complexCard;
                        this.complexTarget = this._backup.complexTarget;
                        this.ai1 = this._backup.ai1;
                        this.ai2 = this._backup.ai2;
                        this._cardChoice = this._backup._cardChoice;
                        this._targetChoice = this._backup._targetChoice;
                        this._skillChoice = this._backup._skillChoice;
                    }
                    delete this.skill;
                    delete this.ignoreMod;
                    delete this.filterCard2;
                },
                isMine: function () {
                    return (this.player &amp;&amp; this.player == game.me &amp;&amp; !_status.auto &amp;&amp; !this.player.isMad() &amp;&amp; !game.notMe);
                },
                isOnline: function () {
                    return (this.player &amp;&amp; this.player.isOnline());
                },
                notLink: function () {
                    return this.getParent().name != '_lianhuan' &amp;&amp; this.getParent().name != '_lianhuan2';
                },
                isPhaseUsing: function (player) {
                    var evt = this.getParent('phaseUse');
                    if (!evt || evt.name != 'phaseUse') return false;
                    return !player || player == evt.player;
                },
                addTrigger: function (skill, player) {
                    if (!player) return;
                    var evt = this;
                    while (true) {
                        var evt = evt.getParent('arrangeTrigger');
                        if (!evt || evt.name != 'arrangeTrigger' || !evt.map) return;
                        if (typeof skill == 'string') skill = [skill];
                        game.expandSkills(skill);
                        var filter = function (content) {
                            if (typeof content == 'string') return content == triggername;
                            return content.contains(triggername);
                        };
                        var trigger = evt._trigger;
                        var triggername = evt.triggername;
                        var map = false;
                        if (evt.doing &amp;&amp; evt.doing.player == player) map = evt.doing;
                        else {
                            for (var i = 0; i &lt; evt.map.length; i++) {
                                if (evt.map[i].player == player) { map = evt.map[i]; break; }
                            }
                        }
                        if (!map) return;
                        var func = function (skillx) {
                            var info = lib.skill[skillx];
                            var bool = false;
                            for (var i in info.trigger) {
                                if (filter(info.trigger[i])) { bool = true; break }
                            }
                            if (!bool) return;
                            var priority = 0;
                            if (info.priority) {
                                priority = info.priority * 100;
                            }
                            if (info.silent) {
                                priority++;
                            }
                            if (info.equipSkill) priority -= 25;
                            if (info.cardSkill) priority -= 50;
                            if (info.ruleSkill) priority -= 75;
                            var toadd = [skillx, player, priority];
                            if (map.list2) {
                                for (var i = 0; i &lt; map.list2.length; i++) {
                                    if (map.list2[i][0] == toadd[0] &amp;&amp; map.list2[i][1] == toadd[1]) return;
                                }
                            };
                            for (var i = 0; i &lt; map.list.length; i++) {
                                if (map.list[i][0] == toadd[0] &amp;&amp; map.list[i][1] == toadd[1]) return;
                            }
                            map.list.add(toadd);
                            map.list.sort(function (a, b) {
                                return b[2] - a[2];
                            });
                        }
                        for (var j = 0; j &lt; skill.length; j++) {
                            func(skill[j]);
                        }
                    }
                },
                /**
                 * 
                 * @param {!string} name trigger name
                 */
                trigger: function (name) {
                    //??
                    if (_status.video) return;
                    ///
                    if ((this.name === 'gain' || this.name === 'lose') &amp;&amp; !_status.gameDrawed) return;
                    // [recommend] why here//??
                    /**
                     * true
                     * @name _status.gameDrawed
                     * @type {?true}
                     */
                    if (name === 'gameDrawEnd') _status.gameDrawed = true;
                    if (name === 'gameStart') {
                        if (_status.brawl &amp;&amp; _status.brawl.gameStart) {
                            _status.brawl.gameStart();
                        }
                        if (lib.config.show_cardpile) {
                            ui.cardPileButton.style.display = '';
                        }
                        /**
                         * true
                         * @name _status.gameStarted
                         * @type {?true}
                         */
                        _status.gameStarted = true;
                        game.showHistory();
                    }
                    //hookmaphookmaphookmap
                    if (!lib.hookmap[name] &amp;&amp; !lib.config.compatiblemode) return;
                    //?? ?
                    if (!game.players || !game.players.length) return;
                    var event = this;
                    //?? ?
                    //??
                    var start = false;
                    var starts = [_status.currentPhase, event.source, event.player, game.me, game.players[0]];
                    for (var i = 0; i &lt; starts.length; i++) {
                        if (get.itemtype(starts[i]) == 'player') {
                            start = starts[i]; break;
                        }
                    }
                    if (!start) return;
                    //start
                    if (!game.players.contains(start)) {
                        start = game.findNext(start);
                    }
                    var list = [];
                    var list2 = [];
                    var mapx = [];
                    var allbool = false;
                    var roles = ['player', 'source', 'target'];
                    var listAdded;
                    var mapxx;
                    var addList = function (skill, player) {
                        if (listAdded[skill]) return;
                        if (player.forbiddenSkills[skill]) return;
                        if (player.disabledSkills[skill]) return;
                        listAdded[skill] = true;
                        var info = lib.skill[skill];
                        var num = 0;
                        if (info.priority) {
                            num = info.priority * 100;
                        }
                        if (info.silent) {
                            num++;
                        }
                        if (info.equipSkill) num -= 30;
                        if (info.ruleSkill) num -= 30;
                        if (info.firstDo) {
                            list.push([skill, player, num]);
                            list.sort(function (a, b) {
                                return b[2] - a[2];
                            });
                            allbool = true;
                            return;
                        }
                        else if (info.lastDo) {
                            list2.push([skill, player, num]);
                            list2.sort(function (a, b) {
                                return b[2] - a[2];
                            });
                            allbool = true;
                            return;
                        }
                        mapxx.list.push([skill, player, num]);
                        mapxx.list.sort(function (a, b) {
                            return b[2] - a[2];
                        });
                        allbool = true;
                    };
                    var totalPopulation = game.players.length + game.dead.length + 1;
                    var player = start;
                    var globalskill = 'global_' + name;
                    var map = _status.connectMode ? lib.playerOL : game.playerMap;
                    for (var iwhile = 0; iwhile &lt; totalPopulation; iwhile++) {
                        var id = player.playerid;
                        var mapxx = {
                            player: player,
                            list: [],
                            list2: [],
                        };
                        listAdded = {};
                        var notemp = player.skills.slice(0);
                        for (var j in player.additionalSkills) {
                            if (j.indexOf('hidden:') != 0) notemp.addArray(player.additionalSkills[j]);
                        }
                        for (var j in player.tempSkills) {
                            if (notemp.contains(j)) return;
                            var expire = player.tempSkills[j];
                            if (expire === name ||
                                (Array.isArray(expire) &amp;&amp; expire.contains(name)) ||
                                (typeof expire === 'function' &amp;&amp; expire(event, player, name))) {
                                delete player.tempSkills[j];
                                player.removeSkill(j);
                            }
                            else if (get.objtype(expire) === 'object') {
                                for (var i = 0; i &lt; roles.length; i++) {
                                    if (expire[roles[i]] &amp;&amp; player === event[roles[i]] &amp;&amp;
                                        (expire[roles[i]] === name || (Array.isArray(expire[roles[i]]) &amp;&amp; expire[roles[i]].contains(name)))) {
                                        delete player.tempSkills[j];
                                        player.removeSkill(j);
                                    }
                                }
                            }
                        }
                        if (lib.config.compatiblemode) {
                            (function () {
                                var skills = player.getSkills(true).concat(lib.skill.global);
                                game.expandSkills(skills);
                                for (var i = 0; i &lt; skills.length; i++) {
                                    var info = get.info(skills[i]);
                                    if (info &amp;&amp; info.trigger) {
                                        var trigger = info.trigger;
                                        var add = false;
                                        if (trigger.player) {
                                            if (typeof trigger.player === 'string') {
                                                if (trigger.player === name) add = true;
                                            }
                                            else if (trigger.player.contains(name)) add = true;
                                        }
                                        if (trigger.target) {
                                            if (typeof trigger.target === 'string') {
                                                if (trigger.target === name) add = true;
                                            }
                                            else if (trigger.target.contains(name)) add = true;
                                        }
                                        if (trigger.source) {
                                            if (typeof trigger.source === 'string') {
                                                if (trigger.source === name) add = true;
                                            }
                                            else if (trigger.source.contains(name)) add = true;
                                        }
                                        if (trigger.global) {
                                            if (typeof trigger.global === 'string') {
                                                if (trigger.global === name) add = true;
                                            }
                                            else if (trigger.global.contains(name)) add = true;
                                        }
                                        if (add) {
                                            addList(skills[i], player);
                                        }
                                    }
                                }
                            }());
                        }
                        else {
                            for (var i = 0; i &lt; roles.length; i++) {
                                var triggername = player.playerid + '_' + roles[i] + '_' + name;
                                if (lib.hook[triggername]) {
                                    for (var j = 0; j &lt; lib.hook[triggername].length; j++) {
                                        addList(lib.hook[triggername][j], player);
                                    }
                                }
                                triggername = roles[i] + '_' + name;
                                if (lib.hook.globalskill[triggername]) {
                                    for (var j = 0; j &lt; lib.hook.globalskill[triggername].length; j++) {
                                        addList(lib.hook.globalskill[triggername][j], player);
                                    }
                                }
                            }
                            if (lib.hook.globalskill[globalskill]) {
                                for (var j = 0; j &lt; lib.hook.globalskill[globalskill].length; j++) {
                                    addList(lib.hook.globalskill[globalskill][j], player);
                                }
                            }
                            for (var i in lib.hook.globaltrigger[name]) {
                                if (map[i] === player) {
                                    for (var j = 0; j &lt; lib.hook.globaltrigger[name][i].length; j++) {
                                        addList(lib.hook.globaltrigger[name][i][j], map[i]);
                                    }
                                }
                            }
                        }
                        mapx.push(mapxx);
                        player = player.nextSeat;
                        if (!player || player === start) {
                            break;
                        }
                    }

                    if (allbool) {
                        var next = game.createEvent('arrangeTrigger', false, event);
                        next.setContent('arrangeTrigger');
                        next.list = list;
                        next.list2 = list2;
                        next.map = mapx;
                        next._trigger = event;
                        next.triggername = name;
                        //next.starter=start;
                        event._triggering = next;
                    }
                },
                /**
                 * 
                 * @function
                 * @param {?boolean} all truefalse
                 * @param {?GameCores.GameObjects.Player} player 
                 */
                untrigger: function (all, player) {
                    var evt = this._triggering;
                    if (all) {
                        if (evt &amp;&amp; evt.map) {
                            for (var i = 0; i &lt; evt.map.length; i++) {
                                evt.map[i].list = [];
                            }
                            evt.list = [];
                            if (evt.doing) evt.doing.list = [];
                        };
                        this._triggered = 5;
                    }
                    else {
                        if (player) {
                            this._notrigger.add(player);
                            if (!evt || !evt.map) return;
                            for (var i = 0; i &lt; evt.map.length; i++) {
                                if (evt.map[i].player == player) evt.map[i].list.length = 0;
                            }
                        }
                    }
                }
            },
            /**
             * .dialogopen/close
             * ()
             * @name element.dialog
             * @type {!Object}
             */
            dialog: {
                add: function (item, noclick, zoom) {
                    if (typeof item == 'string') {
                        if (item.indexOf('###') == 0) {
                            var items = item.slice(3).split('###');
                            this.add(items[0], noclick, zoom);
                            this.addText(items[1], items[1].length &lt;= 20, zoom);
                        }
                        else if (noclick) {
                            var strstr = item;
                            item = ui.create.div('', this.content);
                            item.innerHTML = strstr;
                        }
                        else {
                            item = ui.create.caption(item, this.content);
                        }
                    }
                    else if (get.objtype(item) == 'div') {
                        this.content.appendChild(item);
                    }
                    else if (get.itemtype(item) == 'cards') {
                        var buttons = ui.create.div('.buttons', this.content);
                        if (zoom) buttons.classList.add('smallzoom');
                        this.buttons = this.buttons.concat(ui.create.buttons(item, 'card', buttons, noclick));
                    }
                    else if (get.itemtype(item) == 'players') {
                        var buttons = ui.create.div('.buttons', this.content);
                        if (zoom) buttons.classList.add('smallzoom');
                        this.buttons = this.buttons.concat(ui.create.buttons(item, 'player', buttons, noclick));
                    }
                    else {
                        var buttons = ui.create.div('.buttons', this.content);
                        if (zoom) buttons.classList.add('smallzoom');
                        this.buttons = this.buttons.concat(ui.create.buttons(item[0], item[1], buttons, noclick));
                    }
                    if (this.buttons.length) {
                        if (this.forcebutton !== false) this.forcebutton = true;
                        if (this.buttons.length > 3 || (zoom &amp;&amp; this.buttons.length > 5)) {
                            this.classList.remove('forcebutton-auto');
                        }
                        else if (!this.noforcebutton) {
                            this.classList.add('forcebutton-auto');
                        }
                    }
                    ui.update();
                    return item;
                },
                addText: function (str, center) {
                    if (center !== false) {
                        this.add('&lt;div class="text center">' + str + '&lt;/div>');
                    }
                    else {
                        this.add('&lt;div class="text">' + str + '&lt;/div>');
                    }
                    return this;
                },
                addSmall: function (item, noclick) {
                    return this.add(item, noclick, true);
                },
                addAuto: function (content) {
                    if (content &amp;&amp; content.length > 4 &amp;&amp; !this._hovercustomed) {
                        this.addSmall(content);
                    }
                    else {
                        this.add(content);
                    }
                },
                open: function () {
                    if (this.noopen) return;
                    for (var i = 0; i &lt; ui.dialogs.length; i++) {
                        if (ui.dialogs[i] == this) {
                            this.show();
                            this.refocus();
                            ui.dialogs.remove(this);
                            ui.dialogs.unshift(this);
                            ui.update();
                            return this;
                        }
                        if (ui.dialogs[i].static) ui.dialogs[i].unfocus();
                        else ui.dialogs[i].hide();
                    }
                    ui.dialog = this;
                    var translate;
                    if (lib.config.remember_dialog &amp;&amp; lib.config.dialog_transform &amp;&amp; !this.classList.contains('fixed')) {
                        translate = lib.config.dialog_transform;
                        this._dragtransform = translate;
                        this.style.transform = 'translate(' + translate[0] + 'px,' + translate[1] + 'px) scale(0.8)';
                    }
                    else {
                        this.style.transform = 'scale(0.8)';
                    }
                    this.style.transitionProperty = 'opacity,transform';
                    this.style.opacity = 0;
                    ui.arena.appendChild(this);
                    ui.dialogs.unshift(this);
                    ui.update();
                    ui.refresh(this);
                    if (lib.config.remember_dialog &amp;&amp; lib.config.dialog_transform &amp;&amp; !this.classList.contains('fixed')) {
                        this.style.transform = 'translate(' + translate[0] + 'px,' + translate[1] + 'px) scale(1)';
                    }
                    else {
                        this.style.transform = 'scale(1)';
                    }
                    this.style.opacity = 1;
                    var that = this;
                    setTimeout(function () {
                        that.style.transitionProperty = '';
                    }, 500);
                    return this;
                },
                close: function () {
                    ui.dialogs.remove(this);
                    this.delete();
                    if (ui.dialogs.length > 0) {
                        ui.dialog = ui.dialogs[0];
                        ui.dialog.show();
                        ui.dialog.refocus();
                        ui.update();
                    }
                    // if(ui.arenalog){
                    //     ui.arenalog.classList.remove('withdialog');
                    // }
                    return this;
                },
                setCaption: function (str) {
                    this.querySelector('.caption').innerHTML = str;
                    return this;
                }
            },
            /**
             * .control
             * 
             * @name element.control
             * @type {!Object}
             */
            control: {
                open: function () {
                    ui.control.insertBefore(this, _status.createControl || ui.confirm);
                    ui.controls.unshift(this);
                    if (this.childNodes.length) {
                        this.style.transition = 'opacity 0.5s';
                        ui.refresh(this);
                        this.style.transform = 'translateX(-' + (this.offsetWidth / 2) + 'px)';
                        this.style.opacity = 1;
                        ui.refresh(this);
                        this.style.transition = '';
                    }
                    else {
                        this.animate('controlpressdownx', 500);
                    }
                    ui.updatec();
                    return this;
                },
                add: function (item) {
                    var node = document.createElement('div');
                    this.appendChild(node);
                    node.link = item;
                    node.innerHTML = get.translation(item);
                    node.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.control);
                },
                close: function () {
                    this.animate('controlpressdownx', 500);

                    ui.controls.remove(this);
                    this.delete();

                    setTimeout(ui.updatec, 100);


                    if (ui.confirm == this) delete ui.confirm;
                    if (ui.skills == this) delete ui.skills;
                    if (ui.skills2 == this) delete ui.skills2;
                    if (ui.skills3 == this) delete ui.skills3;
                },
                replace: function () {
                    // this.animate('controlpressdownx',500);
                    if (this.replaceTransition === false) {
                        this.style.transitionProperty = 'none';
                        ui.refresh(this);
                    }

                    while (this.childNodes.length) this.firstChild.remove();
                    var i, controls;
                    if (Array.isArray(arguments[0])) controls = arguments[0];
                    else controls = arguments;
                    delete this.custom;
                    for (i = 0; i &lt; controls.length; i++) {
                        if (typeof controls[i] == 'function') {
                            this.custom = controls[i];
                        }
                        else {
                            this.add(controls[i]);
                        }
                    }
                    if (this.childNodes.length) {
                        var width = 0;
                        for (i = 0; i &lt; this.childNodes.length; i++) width += this.childNodes[i].offsetWidth;
                        ui.refresh(this);
                        this.style.width = width + 'px';
                    }
                    ui.updatec();
                    if (this.replaceTransition === false) {
                        var that = this;
                        setTimeout(function () {
                            that.style.transitionProperty = '';
                        }, 200);
                    }
                    return this;
                }
            },
            /**
             * 
             * @name element.client
             * @type {!Object}
             */
            client: {
                send: function () {
                    if (this.closed) return this;
                    var args = Array.from(arguments);
                    if (typeof args[0] == 'function') {
                        args.unshift('exec');
                    }
                    for (var i = 1; i &lt; args.length; i++) {
                        args[i] = get.stringifiedResult(args[i]);
                    }
                    try {
                        this.ws.send(JSON.stringify(args));
                    }
                    catch (e) {
                        this.ws.close();
                    }
                    return this;
                },
                close: function () {
                    lib.node.clients.remove(this);
                    lib.node.observing.remove(this);
                    if (ui.removeObserve &amp;&amp; !lib.node.observing.length) {
                        ui.removeObserve.remove();
                        delete ui.removeObserve;
                    }
                    this.closed = true;
                    if (_status.waitingForPlayer) {
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].playerid == this.id) {
                                game.connectPlayers[i].uninitOL();
                                delete game.connectPlayers[i].playerid;
                            }
                        }
                        if (game.onlinezhu == this.id) {
                            game.onlinezhu = null;
                        }
                        game.updateWaiting();
                    }
                    else if (lib.playerOL[this.id]) {
                        var player = lib.playerOL[this.id];
                        player.setNickname(player.nickname + ' - ');
                        game.broadcast(function (player) {
                            player.setNickname(player.nickname + ' - ');
                        }, player);
                        player.unwait('ai');
                    }

                    if (window.isNonameServer) {
                        document.querySelector('#server_count').innerHTML = lib.node.clients.length;
                    }
                    return this;
                }
            },
            /**
             * Node Web Server listeners and callbacks
             * @name element.nodews
             * @type {!Object}
             */
            nodews: {
                send: function (message) {
                    game.send('server', 'send', this.wsid, message);
                },
                on: function (type, func) {
                    this['on' + type] = func;
                },
                close: function () {
                    game.send('server', 'close', this.wsid);
                }
            },
            /**
             * Web Server
             * @name element.ws
             * @type {!Object}
             */
            ws: {
                onopen: function () {
                    if (_status.connectCallback) {
                        _status.connectCallback(true);
                        delete _status.connectCallback;
                    }
                },
                onmessage: function (messageevent) {
                    if (messageevent.data == 'heartbeat') {
                        this.send('heartbeat');
                        return;
                    }
                    var message;
                    try {
                        message = JSON.parse(messageevent.data);
                        if (!Array.isArray(message) ||
                            typeof lib.message.client[message[0]] !== 'function') {
                            throw ('err');
                        }
                        for (var i = 1; i &lt; message.length; i++) {
                            message[i] = get.parsedResult(message[i]);
                        }
                    }
                    catch (e) {
                        console.log(e);
                        console.log('invalid message: ' + messageevent.data);
                        return;
                    }
                    lib.message.client[message.shift()].apply(null, message);
                },
                onerror: function (e) {
                    if (this._nocallback) return;
                    if (_status.connectCallback) {
                        _status.connectCallback(false);
                        delete _status.connectCallback;
                    }
                    else {
                        alert('');
                    }
                },
                onclose: function () {
                    if (this._nocallback) return;
                    if (_status.connectCallback) {
                        _status.connectCallback(false);
                        delete _status.connectCallback;
                    }
                    if (game.online || game.onlineroom) {
                        if ((game.servermode || game.onlinehall) &amp;&amp; _status.over) {

                        }
                        else {
                            localStorage.setItem(lib.configprefix + 'directstart', true);
                            game.reload();
                        }
                    }
                    else {
                        // game.saveConfig('reconnect_info');
                    }
                    game.online = false;
                    game.ws = null;
                }
            }
        },
        //
        card: {
            list: [],
            //
            pss_paper: {
                type: 'pss',
                fullskin: true,
            },
            pss_scissor: {
                type: 'pss',
                fullskin: true,
            },
            pss_stone: {
                type: 'pss',
                fullskin: true,
            },
            //
            feichu_equip1: {
                type: "equip",
                subtype: "equip1",
            },
            feichu_equip2: {
                type: "equip",
                subtype: "equip2",
            },
            feichu_equip3: {
                type: "equip",
                subtype: "equip3",
            },
            feichu_equip4: {
                type: "equip",
                subtype: "equip4",
            },
            feichu_equip5: {
                type: "equip",
                subtype: "equip5",
            },
            disable_judge: {},
            //
            group_wei: { fullskin: true },
            group_shu: { fullskin: true },
            group_wu: { fullskin: true },
            group_qun: { fullskin: true },
            group_key: { fullskin: true },
            group_jin: { fullskin: true },
            group_holo: { fullskin: true, },
            group_nijisanji: { fullskin: true, },
            group_VirtuaReal: { fullskin: true, },
            group_upd8: { fullskin: true, },
            group_paryi: { fullskin: true, },
            group_kagura: { fullskin: true, },
            group_nanashi: { fullskin: true, },
            group_psp: { fullskin: true, },
            group_asoul: { fullskin: true, },
            group_nori: { fullskin: true, },
            group_vwp: { fullskin: true, },
            group_chaos: { fullskin: true, },
            group_xuyan: { fullskin: true, },
            group_xuefeng: { fullskin: true, },
        },
        /**
         * 
         * @namespace
         */
        filter: {
            all: function () {
                return true;
            },
            buttonIncluded: function (button) {
                return !(_status.event.excludeButton &amp;&amp; _status.event.excludeButton.contains(button));
            },
            filterButton: function (button) {
                return true;
            },
            /**
             * AB
             * @function
             * @param {!GameCores.GameObjects.Card} card 
             * @param {!GameCores.GameObjects.Player} player (A)
             * @param {!GameCores.GameObjects.Player} target (B)
             * @returns {!boolean} truefalse
             */
            cardSavable: function (card, player, target) {
                var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                if (mod2 != 'unchanged') return mod2;
                var mod = game.checkMod(card, player, target, 'unchanged', 'cardSavable', player);
                if (mod != 'unchanged') return mod;
                var savable = get.info(card).savable;
                if (typeof savable == 'function') savable = savable(card, player, target);
                return savable;
            },
            /**
             * trigger
             * @function
             * @param {!GameCores.Bases.Event} event 
             * @param {!GameCores.GameObjects.Player} player ()
             * @param {!string} name /triggername
             * @param {!string} skill ID
             * @returns {!boolean} truefalse
             */
            filterTrigger: function (event, player, name, skill) {
                if (player._hookTrigger) {
                    for (var i = 0; i &lt; player._hookTrigger.length; i++) {
                        var info = lib.skill[player._hookTrigger[i]].hookTrigger;
                        if (info) {
                            if (info.block &amp;&amp; info.block(event, player, name, skill)) {
                                return false;
                            }
                        }
                    }
                }
                var fullskills = game.expandSkills(player.getSkills().concat(lib.skill.global));
                var info = get.info(skill);
                if ((info.noHidden || get.mode() != 'guozhan') &amp;&amp; !fullskills.contains(skill)) {
                    return false;
                }
                if (!info.trigger) return false;
                var bool = false;
                var has = function (obj) {
                    if (typeof obj == 'string') return obj == name;
                    else if (obj.contains(name)) return true;
                    return false;
                }
                for (var i in info.trigger) {//check trigger
                    if ((i == 'global' || player == event[i]) &amp;&amp; has(info.trigger[i])) {
                        bool = true; break;
                    }
                }
                if (!bool) return false;
                if (info.filter &amp;&amp; !info.filter(event, player, name)) {
                    return false;
                }
                if (event._notrigger.contains(player) &amp;&amp; !lib.skill.global.contains(skill)) {
                    return false;
                }
                if (typeof info.usable == 'number' &amp;&amp; player.hasSkill('counttrigger') &amp;&amp;
                    player.storage.counttrigger &amp;&amp; player.storage.counttrigger[skill] >= info.usable) {
                    return false;
                }
                if (info.round &amp;&amp; (info.round - (game.roundNumber - player.storage[skill + '_roundcount']) > 0)) {
                    return false;
                }
                return true;
            },
            characterDisabled: function (i, libCharacter) {
                if (!lib.character[i] || lib.character[i][4] &amp;&amp; lib.character[i][4].contains('forbidai')) return true;
                if (lib.character[i][4] &amp;&amp; lib.character[i][4].contains('unseen')) return true;
                if (lib.config.forbidai.contains(i)) return true;
                if (lib.characterFilter[i] &amp;&amp; !lib.characterFilter[i](get.mode())) return true;
                if (_status.connectMode) {
                    if (lib.configOL.banned.contains(i) || lib.connectBanned.contains(i)) return true;
                    if (lib.configOL.protect_beginner &amp;&amp; get.is.banForBeginner(i)) return true;
                    var double_character = false;
                    if (lib.configOL.mode == 'guozhan') {
                        double_character = true;
                    }
                    else if (lib.configOL.double_character &amp;&amp; (lib.configOL.mode == 'identity' || lib.configOL.mode == 'stone')) {
                        double_character = true;
                    }
                    else if (lib.configOL.double_character_jiange &amp;&amp; (lib.configOL.mode == 'versus' &amp;&amp; _status.mode == 'jiange')) {
                        double_character = true;
                    }
                    if (double_character &amp;&amp; lib.config.forbiddouble.contains(i)) {
                        return true;
                    }
                    // if(lib.configOL.ban_weak){
                    //     if(lib.config.replacecharacter[i]&amp;&amp;libCharacter&amp;&amp;libCharacter[lib.config.replacecharacter[i]]) return true;
                    //     if(lib.config.forbidall.contains(i)) return true;
                    //     if(!double_character&amp;&amp;get.rank(i,true)&lt;=2){
                    //         return true;
                    //     }
                    // }
                    // if(lib.configOL.ban_strong&amp;&amp;get.rank(i,true)>=8){
                    //     return true;
                    // }
                }
                else {
                    if (lib.config.banned.contains(i)) return true;
                    var double_character = false;
                    if (get.mode() == 'guozhan') {
                        double_character = true;
                    }
                    else if (get.config('double_character') &amp;&amp; (lib.config.mode == 'identity' || lib.config.mode == 'stone')) {
                        double_character = true;
                    }
                    else if (get.config('double_character_jiange') &amp;&amp; (lib.config.mode == 'versus' &amp;&amp; _status.mode == 'jiange')) {
                        double_character = true;
                    }
                    if (double_character &amp;&amp; lib.config.forbiddouble.contains(i)) {
                        return true;
                    }
                    // if(get.config('ban_weak')){
                    //     if(lib.config.replacecharacter[i]&amp;&amp;lib.character[lib.config.replacecharacter[i]]) return true;
                    //     if(lib.config.forbidall.contains(i)) return true;
                    //     if(!double_character&amp;&amp;get.rank(i,true)&lt;=2){
                    //         return true;
                    //     }
                    // }
                    // if(get.config('ban_strong')&amp;&amp;get.rank(i,true)>=8){
                    //     return true;
                    // }
                }
            },
            characterDisabled2: function (i) {
                var info = lib.character[i];
                if (!info) return true;
                if (info[4]) {
                    if (info[4].contains('boss')) return true;
                    if (info[4].contains('hiddenboss')) return true;
                    if (info[4].contains('minskin')) return true;
                    if (info[4].contains('unseen')) return true;
                    if (info[4].contains('forbidai') &amp;&amp; (!_status.event.isMine || !_status.event.isMine())) return true;
                    if (lib.characterFilter[i] &amp;&amp; !lib.characterFilter[i](get.mode())) return true;
                }
                return false;
            },
            skillDisabled: function (skill) {
                if (!lib.translate[skill] || !lib.translate[skill + '_info']) return true;
                var info = lib.skill[skill];
                if (info &amp;&amp; !info.unique &amp;&amp; !info.temp &amp;&amp; !info.sub &amp;&amp; !info.fixed &amp;&amp; !info.vanish) {
                    return false;
                }
                return true;
            },
            cardEnabled: function (card, player, event) {
                if (player == undefined) player = _status.event.player;
                if (!player) return false;
                var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                if (mod2 != 'unchanged') return mod2;
                card = get.autoViewAs(card, null, player);
                if (event === 'forceEnable') {
                    var mod = game.checkMod(card, player, 'unchanged', 'cardEnabled', player);
                    if (mod != 'unchanged') return mod;
                    return true;
                }
                else {
                    var filter = get.info(card).enable;
                    if (!filter) return;
                    var mod = game.checkMod(card, player, 'unchanged', 'cardEnabled', player);
                    if (mod != 'unchanged') return mod;
                    if (typeof filter == 'boolean') return filter;
                    if (typeof filter == 'function') return filter(card, player, event);
                }
            },
            cardRespondable: function (card, player, event) {
                event = event || _status.event;
                if (event.name != 'chooseToRespond') return true;
                var source = event.getParent().player;
                if (source &amp;&amp; source != player) {
                    if (source.hasSkillTag('norespond', false, [card, player, event], true)) {
                        return false;
                    }
                }
                if (player == undefined) player = _status.event.player;
                var mod2 = game.checkMod(card, player, 'unchanged', 'cardEnabled2', player);
                if (mod2 != 'unchanged') return mod2;
                var mod = game.checkMod(card, player, 'unchanged', 'cardRespondable', player);
                if (mod != 'unchanged') return mod;
                return true;
            },
            cardUsable2: function (card, player, event) {
                card = get.autoViewAs(card, null, player);
                var info = get.info(card);
                if (info.updateUsable == 'phaseUse') {
                    event = event || _status.event;
                    if (player != _status.event.player) return true;
                    if (event.getParent().name != 'phaseUse') return true;
                    if (event.getParent().player != player) return true;
                }
                var num = info.usable;
                if (typeof num == 'function') num = num(card, player);
                num = game.checkMod(card, player, num, 'cardUsable', player);
                if (typeof num != 'number') return true;
                else return (player.countUsed(card) &lt; num);
            },
            cardUsable: function (card, player, event) {
                card = get.autoViewAs(card, null, player);
                var info = get.info(card);
                event = event || _status.event;
                if (player != _status.event.player) return true;
                if (info.updateUsable == 'phaseUse') {
                    if (event.getParent().name != 'phaseUse') return true;
                    if (event.getParent().player != player) return true;
                }
                event.addCount_extra = true;
                var num = info.usable;
                if (typeof num == 'function') num = num(card, player);
                num = game.checkMod(card, player, num, 'cardUsable', player);
                if (typeof num != 'number') return true;
                if (player.countUsed(card) &lt; num) return true;
                if (game.hasPlayer(function (current) {
                    return game.checkMod(card, player, current, false, 'cardUsableTarget', player);
                })) {
                    return true;
                }
                return false;
            },
            cardDiscardable: function (card, player, event) {
                event = event || _status.event;
                if (typeof event != 'string') event = event.getParent().name;
                var mod = game.checkMod(card, player, event, 'unchanged', 'cardDiscardable', player);
                if (mod != 'unchanged') return mod;
                return true;
            },
            canBeDiscarded: function (card, player, target, event) {
                event = event || _status.event;
                if (typeof event != 'string') event = event.getParent().name;
                var mod = game.checkMod(card, player, target, event, 'unchanged', 'canBeDiscarded', target);
                if (mod != 'unchanged') return mod;
                return true;
            },
            canBeGained: function (card, player, target, event) {
                event = event || _status.event;
                if (typeof event != 'string') event = event.getParent().name;
                var mod = game.checkMod(card, player, target, event, 'unchanged', 'canBeGained', target);
                if (mod != 'unchanged') return mod;
                return true;
            },
            cardAiIncluded: function (card) {
                if (_status.event.isMine()) return true;
                return (_status.event._aiexclude.contains(card) == false);
            },
            filterCard: function (card, player, event) {
                var info = get.info(card);
                //if(info.toself&amp;&amp;!lib.filter.targetEnabled(card,player,player)) return false;
                if (player == undefined) player = _status.event.player;
                if (!lib.filter.cardEnabled(card, player, event) || !lib.filter.cardUsable(card, player, event)) return false;
                if (info.notarget) return true;
                var range;
                var select = get.copy(info.selectTarget);
                if (select == undefined) {
                    if (info.filterTarget == undefined) return true;
                    range = [1, 1];
                }
                else if (typeof select == 'number') range = [select, select];
                else if (get.itemtype(select) == 'select') range = select;
                else if (typeof select == 'function') range = select(card, player);
                game.checkMod(card, player, range, 'selectTarget', player);
                if (!range || range[1] != -1) return true;
                var filterTarget = (event &amp;&amp; event.filterTarget) ? event.filterTarget : lib.filter.filterTarget;
                return game.hasPlayer(function (current) {
                    return filterTarget(card, player, current);
                });
            },
            targetEnabledx: function (card, player, target) {
                if (!card) return false;
                if (_status.event.addCount_extra &amp;&amp; !lib.filter.cardUsable2(card, player) &amp;&amp; !game.checkMod(card, player, target, false, 'cardUsableTarget', player)) return false;
                return lib.filter.targetEnabled.apply(this, arguments);
            },
            targetEnabled: function (card, player, target) {
                if (!card) return false;
                var info = get.info(card);
                var filter = info.filterTarget;
                var mod = game.checkMod(card, player, target, 'unchanged', 'playerEnabled', player);
                if (mod == false) return false;
                if (!info.singleCard || ui.selected.targets.length == 0) {
                    var mod = game.checkMod(card, player, target, 'unchanged', 'targetEnabled', target);
                    if (mod != 'unchanged') return mod;
                }
                if (typeof filter == 'boolean') return filter;
                if (typeof filter == 'function') return filter(card, player, target);
            },
            targetEnabled2: function (card, player, target) {
                if (lib.filter.targetEnabled(card, player, target)) return true;
                if (!card) return false;

                if (game.checkMod(card, player, target, 'unchanged', 'playerEnabled', player) == false) return false;
                if (game.checkMod(card, player, target, 'unchanged', 'targetEnabled', target) == false) return false;

                var filter = get.info(card).modTarget;
                if (typeof filter == 'boolean') return filter;
                if (typeof filter == 'function') return filter(card, player, target);
                return false;
            },
            targetEnabled3: function (card, player, target) {
                if (!card) return false;
                var info = get.info(card);

                if (info.filterTarget == true) return true;
                if (typeof info.filterTarget == 'function' &amp;&amp; info.filterTarget(card, player, target)) return true;

                if (info.modTarget == true) return true;
                if (typeof info.modTarget == 'function' &amp;&amp; info.modTarget(card, player, target)) return true;
                return false;
            },
            targetInRange: function (card, player, target) {
                var mod = game.checkMod(card, player, target, 'unchanged', 'targetInRange', player);
                var extra = 0;
                if (mod != 'unchanged') {
                    if (typeof mod == 'boolean') return mod;
                    if (typeof mod == 'number') extra = mod;
                }
                var info = get.info(card);
                var range = info.range;
                var outrange = info.outrange;
                if (range == undefined &amp;&amp; outrange == undefined) return true;

                if (player.hasSkill('undist') || target.hasSkill('undist')) return false;
                for (var i in range) {
                    if (i == 'attack') {
                        if (player.inRange(target)) return true;
                        var range2 = player.getAttackRange();
                        if (range2 &lt;= 0) return false;
                        var distance = get.distance(player, target) + extra;
                        if (range[i] &lt;= distance - range2) return false;
                    }
                    else {
                        var distance = get.distance(player, target, i) + extra;
                        if (range[i] &lt; distance) return false;
                    }
                }
                for (var i in outrange) {
                    if (i == 'attack') {
                        var range2 = player.getAttackRange();
                        if (range2 &lt;= 0) return false;
                        var distance = get.distance(player, target) + extra;
                        if (outrange[i] > distance - range2 + 1) return false;
                    }
                    else {
                        var distance = get.distance(player, target, i) + extra;
                        if (outrange[i] > distance) return false;
                    }
                }
                return true;
            },
            filterTarget: function (card, player, target) {
                return (lib.filter.targetEnabledx(card, player, target) &amp;&amp;
                    lib.filter.targetInRange(card, player, target));
            },
            filterTarget2: function (card, player, target) {
                return (lib.filter.targetEnabled2(card, player, target) &amp;&amp;
                    lib.filter.targetInRange(card, player, target));
            },
            notMe: function (card, player, target) {
                return player != target;
            },
            isMe: function (card, player, target) {
                return player == target;
            },
            attackFrom: function (card, player, target) {
                return get.distance(player, target, 'attack') &lt;= 1;
            },
            globalFrom: function (card, player, target) {
                return get.distance(player, target) &lt;= 1;
            },
            selectCard: function () {
                return [1, 1];
            },
            selectTarget: function () {
                var card = get.card(), player = get.player();
                if (card == undefined) return;
                var range;
                var select = get.copy(get.info(card).selectTarget);
                if (select == undefined) {
                    if (get.info(card).filterTarget == undefined) return [0, 0];
                    range = [1, 1];
                }
                else if (typeof select == 'number') range = [select, select];
                else if (get.itemtype(select) == 'select') range = select;
                else if (typeof select == 'function') range = select(card, player);
                game.checkMod(card, player, range, 'selectTarget', player);
                return range;
            },
            judge: function (card, player, target) {
                var judges = target.getCards('j');
                for (var i = 0; i &lt; judges.length; i++) {
                    if ((judges[i].viewAs || judges[i].name) == card.name) return false;
                }
                return true;
            },
            autoRespondSha: function () {
                return !this.player.hasSha(true);
            },
            autoRespondShan: function () {
                return !this.player.hasShan();
            },
            wuxieSwap: function (event) {
                if (event.type == 'wuxie') {
                    if (ui.wuxie &amp;&amp; ui.wuxie.classList.contains('glow')) {
                        return true;
                    }
                    if (ui.tempnowuxie &amp;&amp; ui.tempnowuxie.classList.contains('glow') &amp;&amp; event.state > 0) {
                        var triggerevent = event.getTrigger();
                        if (triggerevent) {
                            if (ui.tempnowuxie._origin == triggerevent.parent.id) {
                                return true;
                            }
                        }
                        else if (ui.tempnowuxie._origin == _status.event.id2) {
                            return true;
                        }
                    }
                    if (!_status.connectMode &amp;&amp; lib.config.wuxie_self &amp;&amp; event.getParent().state) {
                        var tw = event.getTrigger().parent;
                        if (tw.player.isUnderControl(true) &amp;&amp; !tw.player.hasSkillTag('noautowuxie') &amp;&amp;
                            tw.targets &amp;&amp; tw.targets.length == 1 &amp;&amp; !tw.noai) {
                            return true;
                        }
                    }
                }
            }
        },
        /**
         * 
         * @name sort
         * @namespace
         */
        sort: {
            /**
             * 
             * @name sort.character
             * @function
             */
            character: function (a, b) {
                var getGroup = function (name) {
                    var group = get.is.double(name, true);
                    if (group) return group[0];
                    return lib.character[name][1];
                },
                    groupSort = function (name) {
                        if (!lib.character[name]) return 50;
                        var group = getGroup(name);
                        if (group == 'shen') return -1;
                        if (group == 'vtuber') return 40;
                        if (group == 'clubs') return 41;
                        var list = get.groups();
                        if (list.contains(group)) return list.indexOf(group);
                        return 49;
                    };
                var del = groupSort(a) - groupSort(b);
                if (del != 0) return del;
                var aa = a, bb = b;
                if (a.indexOf('_') != -1) {
                    a = a.slice(a.indexOf('_') + 1);
                }
                if (b.indexOf('_') != -1) {
                    b = b.slice(b.indexOf('_') + 1);
                }
                if (a != b) {
                    return a > b ? 1 : -1;
                }
                return aa > bb ? 1 : -1;
            },
            /**
             * 
             * @name sort.card
             * @function
             */
            card: function (a, b) {
                var typeSort = function (name) {
                    var type = get.type(name);
                    if (!type) return 10;
                    if (type == 'basic') return -1;
                    if (type == 'trick') return 0;
                    if (type == 'delay') return 1;
                    if (type == 'equip') {
                        var type2 = get.subtype(name);
                        if (type2 &amp;&amp; type2.slice) return 1 + parseInt(type2.slice(5) || 7);
                        return 8.5
                    }
                    return 9;
                }
                var del = typeSort(a) - typeSort(b);
                if (del != 0) return del;
                var aa = a, bb = b;
                if (a.indexOf('_') != -1) {
                    a = a.slice(a.indexOf('_') + 1);
                }
                if (b.indexOf('_') != -1) {
                    b = b.slice(b.indexOf('_') + 1);
                }
                if (a != b) {
                    return a > b ? 1 : -1;
                }
                return aa > bb ? 1 : -1;
            },
            random: function () {
                return (Math.random() - 0.5);
            },
            /**
             * 
             * @name sort.seat
             * @function
             */
            seat: function (a, b) {
                var player = lib.tempSortSeat || _status.event.player;
                var delta = get.distance(player, a, 'absolute') - get.distance(player, b, 'absolute');
                if (delta) return delta;
                delta = parseInt(a.dataset.position) - parseInt(b.dataset.position);
                if (player.side == game.me.side) return delta;
                return -delta;
            },
            position: function (a, b) {
                return parseInt(a.dataset.position) - parseInt(b.dataset.position);
            },
            priority: function (a, b) {
                var i1 = get.info(a[0]), i2 = get.info(b[0]);
                if (i1.priority == undefined) i1.priority = 0;
                if (i2.priority == undefined) i2.priority = 0;
                if (i1.priority == i2.priority) {
                    if (i1.forced == undefined &amp;&amp; i2.forced == undefined) return 0;
                    if (i1.forced &amp;&amp; i2.forced) return 0;
                    if (i1.forced) return 1;
                    if (i2.forced) return -1;
                }
                return i2.priority - i1.priority;
            },
            number: function (a, b) {
                return get.number(a) - get.number(b);
            },
            number2: function (a, b) {
                return get.number(b) - get.number(a);
            },
            capt: function (a, b) {
                var aa = a, bb = b;
                if (aa.indexOf('_') != -1) {
                    aa = aa.slice(aa.indexOf('_') + 1);
                }
                if (bb.indexOf('_') != -1) {
                    bb = bb.slice(bb.indexOf('_') + 1);
                }
                if (aa != bb) {
                    return aa > bb ? 1 : -1;
                }
                return a > b ? 1 : -1;
            },
            name: function (a, b) {
                if (a > b) return 1;
                if (a &lt; b) return -1;
                return 0;
            }
        },
        /**
         * {@link GameCores}
         * @namespace
         */
        skill: {
            //
            _shengjie: {
                enable: 'phaseUse',
                usable: 1,
                filter: function (event, player) {
                    return player.canShengjie(player.getCards('h'));
                },
                content: function () {
                    'step 0'
                    player.chooseShengjie(player.getCards('h'));
                    'step 1'
                    if (result.bool) {
                        player.lose(result.cards, ui.discardPile, 'visible');
                        player.$throw(result.cards);
                        game.log(player, '', result.cards, '');
                        event.star = result.star;
                    }
                    if (!result.bool) {
                        var skill = player.getStat().skill;
                        skill._shengjie--;
                        if (typeof skill._shengjietried == 'number') {
                            skill._shengjietried++;
                        }
                        else {
                            skill._shengjietried = 1;
                        }
                    }
                    'step 2'
                    if (event.star) {
                        player.gain(event.star, 'gain2').gaintag.add('_shengjie');
                    }
                },
                ai: {
                    basic: {
                        order: 6
                    },
                    result: {
                        player: function (player) {
                            if (player.getStat().skill._shengjietried >= 10) {
                                return 0;
                            }
                            return 0;
                        }
                    }
                }
            },
            //
            _yingbian: {
                trigger: { player: 'useCard1' },
                forced: true,
                popup: false,
                firstDo: true,
                ruleSkill: true,
                forceLoad: true,
                filter: function (event, player) {
                    if (event.card.yingbian) return false;
                    var bool = player.hasSkillTag('forceYingbian');
                    var card = event.card;
                    if (get.cardtag(card, 'yingbian_kongchao') &amp;&amp; (!player.countCards('h') || bool)) return true;
                    if (get.cardtag(card, 'yingbian_canqu') &amp;&amp; (player.hp == 1 || bool)) return true;
                    if (get.cardtag(card, 'yingbian_fujia') &amp;&amp; (player.isMaxHandcard() || bool)) return true;
                    if (get.cardtag(card, 'yingbian_zhuzhan')) return true;
                    return false;
                },
                content: function () {
                    'step 0'
                    var card = trigger.card;
                    event.card = card;
                    var bool = false;
                    if (get.cardtag(card, 'yingbian_kongchao') &amp;&amp; !player.countCards('h')) {
                        player.popup('', 'soil');
                        bool = true;
                    }
                    else if (get.cardtag(card, 'yingbian_canqu') &amp;&amp; player.hp == 1) {
                        player.popup('', 'fire');
                        bool = true;
                    }
                    else if (get.cardtag(card, 'yingbian_fujia') &amp;&amp; player.isMaxHandcard()) {
                        player.popup('', 'orange');
                        bool = true;
                    }
                    else if (player.hasSkillTag('forceYingbian')) {
                        player.popup('', 'metal');
                        bool = true;
                    }
                    if (bool) {
                        game.log(player, '', card, '');
                        event.goto(10);
                    }
                    'step 1'
                    event._global_waiting = true;
                    event.send = function (player, card, source, targets, id, id2, skillState) {
                        if (skillState) {
                            player.applySkills(skillState);
                        }
                        var type = get.type2(card);
                        var str = get.translation(source);
                        if (targets &amp;&amp; targets.length) {
                            str += '';
                            str += get.translation(targets);
                        }
                        str += '';
                        var next = player.chooseCard({
                            filterCard: function (card) {
                                return get.type2(card) == type &amp;&amp; lib.filter.cardDiscardable.apply(this, arguments);
                            },
                            prompt: str += (get.translation(card) + '' + get.translation(type) + ''),
                            position: 'h',
                            _global_waiting: true,
                            id: id,
                            id2: id2,
                            ai: function (cardx) {
                                var info = get.info(card);
                                if (info &amp;&amp; info.ai &amp;&amp; info.ai.yingbian) {
                                    var ai = info.ai.yingbian(card, source, targets, player);
                                    if (!ai) return 0;
                                    return ai - get.value(cardx);
                                }
                                else if (get.attitude(player, source) &lt;= 0) return 0;
                                return 5 - get.value(cardx);
                            },
                        });
                        if (game.online) {
                            _status.event._resultid = id;
                            game.resume();
                        }
                    };
                    'step 2'
                    var type = get.type2(card);
                    var list = game.filterPlayer(function (current) {
                        if (current == player) return false;
                        if (!current.countCards('h')) return false;
                        return _status.connectMode || current.countCards('h', function (cardx) {
                            return get.type2(cardx) == type;
                        })
                    });
                    event.list = list;
                    event.id = get.id();
                    list.sort(function (a, b) {
                        return get.distance(event.source, a, 'absolute') - get.distance(event.source, b, 'absolute');
                    });
                    'step 3'
                    if (event.list.length == 0) {
                        event.finish();
                        return;
                    }
                    else if (_status.connectMode &amp;&amp; (event.list[0].isOnline() || event.list[0] == game.me)) {
                        event.goto(5);
                    }
                    else {
                        event.current = event.list.shift();
                        event.send(event.current, event.card, player, trigger.targets, event.id, trigger.parent.id);
                    }
                    'step 4'
                    if (result.bool) {
                        event.zhuzhanresult = event.current;
                        event.zhuzhanresult2 = result;
                        if (event.current != game.me) game.delayx();
                        event.goto(9);
                    }
                    else {
                        event.goto(3);
                    }
                    'step 5'
                    var id = event.id;
                    var sendback = function (result, player) {
                        if (result &amp;&amp; result.id == id &amp;&amp; !event.zhuzhanresult &amp;&amp; result.bool) {
                            event.zhuzhanresult = player;
                            event.zhuzhanresult2 = result;
                            game.broadcast('cancel', id);
                            if (_status.event.id == id &amp;&amp; _status.event.name == 'chooseCard' &amp;&amp; _status.paused) {
                                return (function () {
                                    event.resultOL = _status.event.resultOL;
                                    ui.click.cancel();
                                    if (ui.confirm) ui.confirm.close();
                                });
                            }
                        }
                        else {
                            if (_status.event.id == id &amp;&amp; _status.event.name == 'chooseCard' &amp;&amp; _status.paused) {
                                return (function () {
                                    event.resultOL = _status.event.resultOL;
                                });
                            }
                        }
                    };

                    var withme = false;
                    var withol = false;
                    var list = event.list;
                    for (var i = 0; i &lt; list.length; i++) {
                        if (list[i].isOnline()) {
                            withol = true;
                            list[i].wait(sendback);
                            list[i].send(event.send, list[i], event.card, player, trigger.targets, event.id, trigger.parent.id, get.skillState(list[i]));
                            list.splice(i--, 1);
                        }
                        else if (list[i] == game.me) {
                            withme = true;
                            event.send(list[i], event.card, player, trigger.targets, event.id, trigger.parent.id);
                            list.splice(i--, 1);
                        }
                    }
                    if (!withme) {
                        event.goto(7);
                    }
                    if (_status.connectMode) {
                        if (withme || withol) {
                            for (var i = 0; i &lt; game.players.length; i++) {
                                if (game.players[i] != player) game.players[i].showTimer();
                            }
                        }
                    }
                    event.withol = withol;
                    'step 6'
                    if (result &amp;&amp; result.bool &amp;&amp; !event.zhuzhanresult) {
                        game.broadcast('cancel', event.id);
                        event.zhuzhanresult = game.me;
                        event.zhuzhanresult2 = result;
                    }
                    'step 7'
                    if (event.withol &amp;&amp; !event.resultOL) {
                        game.pause();
                    }
                    'step 8'
                    for (var i = 0; i &lt; game.players.length; i++) {
                        game.players[i].hideTimer();
                    }
                    'step 9'
                    if (event.zhuzhanresult) {
                        var target = event.zhuzhanresult;
                        target.line(player, 'green');
                        target.discard(event.zhuzhanresult2.cards);
                        target.popup('', 'wood');
                        game.log(target, '', player, '');
                        target.addExpose(0.2);
                    }
                    else event.finish();
                    'step 10'
                    trigger.card.yingbian = true;
                    var info = get.info(trigger.card);
                    if (info &amp;&amp; info.yingbian) info.yingbian(trigger);
                    player.addTempSkill('yingbian_changeTarget');
                },
            },
            yingbian_changeTarget: {
                trigger: { player: 'useCard2' },
                forced: true,
                popup: false,
                filter: function (event, player) {
                    if (event.yingbian_removeTarget &amp;&amp; event.targets &amp;&amp; event.targets.length > 1) return true;
                    if (!event.yingbian_addTarget) return false;
                    var info = get.info(event.card);
                    if (info.allowMultiple == false) return false;
                    if (event.targets &amp;&amp; !info.multitarget) {
                        if (game.hasPlayer(function (current) {
                            return !event.targets.contains(current) &amp;&amp; lib.filter.targetEnabled2(event.card, player, current) &amp;&amp; lib.filter.targetInRange(event.card, player, current);
                        })) {
                            return true;
                        }
                    }
                    return false;
                },
                content: function () {
                    'step 0'
                    if (trigger.yingbian_addTarget) player.chooseTarget('' + get.translation(trigger.card) + '', function (card, player, target) {
                        var trigger = _status.event.getTrigger();
                        var card = trigger.card;
                        return !trigger.targets.contains(target) &amp;&amp; lib.filter.targetEnabled2(card, player, target) &amp;&amp; lib.filter.targetInRange(card, player, target);
                    }).set('ai', function (target) {
                        var player = _status.event.player;
                        var card = _status.event.getTrigger().card;
                        return get.effect(target, card, player, player);
                    });
                    else event.goto(2);
                    'step 1'
                    if (result.bool) {
                        var target = result.targets[0];
                        player.line(target, 'green');
                        game.log(player, '', target, '', trigger.card, '');
                        trigger.targets.add(target);
                    }
                    'step 2'
                    if (trigger.yingbian_removeTarget &amp;&amp; trigger.targets.length > 1) player.chooseTarget('' + get.translation(trigger.card) + '', function (card, player, target) {
                        var trigger = _status.event.getTrigger();
                        return trigger.targets.contains(target);
                    }).set('ai', function (target) {
                        var player = _status.event.player;
                        var card = _status.event.getTrigger().card;
                        return -get.effect(target, card, player, player);
                    });
                    else event.finish();
                    'step 3'
                    if (result.bool) {
                        var target = result.targets[0];
                        player.line(target, 'green');
                        game.log(player, '', target, '', trigger.card, '');
                        trigger.targets.remove(target);
                    }
                },
            },
            //
            _showHiddenCharacter: {
                trigger: { player: ['changeHp', 'phaseBeginStart', 'loseMaxHpBegin'] },
                firstDo: true,
                forced: true,
                popup: false,
                priority: 25,
                filter: function (event, player, name) {
                    return player.isUnseen(2) &amp;&amp; get.mode() != 'guozhan';
                },
                content: function () {
                    player.showCharacter(2);
                    player.removeSkill('g_hidden_ai');
                },
            },
            _kamisha: {
                trigger: { source: 'damageBegin2' },
                //forced:true,
                popup: false,
                prompt: function (event, player) {
                    return '' + get.translation(event.player) + '' + get.cnNumber(event.num) + '';
                },
                filter: function (event, player) {
                    return event.nature == 'kami' &amp;&amp; event.num > 0;
                },
                ruleSkill: true,
                check: function (event, player) {
                    var att = get.attitude(player, event.player);
                    if (event.player.hp == event.player.maxHp) return att &lt; 0;
                    if (event.player.hp == event.player.maxHp - 1 &amp;&amp;
                        (event.player.maxHp &lt;= 3 || event.player.hasSkillTag('maixie'))) return att &lt; 0;
                    return att > 0;
                },
                content: function () {
                    trigger.cancel();
                    trigger.player.loseMaxHp(trigger.num).source = player;
                },
            },
            //
            _oceansha: {
                trigger: { source: 'damageBegin4' },
                forced: true,
                priority: 7,
                logTarget: 'player',
                equipSkill: false,
                ruleSkill: true,
                filter: function (event, player) {
                    return event.nature == 'ocean' &amp;&amp; event.num > 0 &amp;&amp; event.player.hujia > 0;
                },
                ruleSkill: true,
                content: function () {
                    trigger.num++;
                    trigger.oceanAddDam = true;
                },
            },
            //
            _yamisha: {
                trigger: { player: 'useCardToPlayered' },
                forced: true,
                priority: 7,
                logTarget: 'target',
                equipSkill: false,
                ruleSkill: true,
                filter: function (event, player) {
                    return event.card.nature == 'yami' &amp;&amp; event.target.countCards('h') > player.countCards('h');
                },
                ruleSkill: true,
                content: function () {
                    trigger.getParent().directHit.add(trigger.target);
                    trigger.getParent().yamiDirect = true;
                },
            },
            _yamisha2: {
                trigger: { player: 'phaseJieshu' },
                priority: 1,
                popup: false,
                forced: true,
                ruleSkill: true,
                filter: function (event, player) {
                    if (event.getParent().noyami) return false;
                    if (event.player.hasSkillTag('playernoyami', false, event)) return false;
                    return game.countPlayer(function (cur) {
                        return cur.hasYami();
                    })
                },
                content: function () {
                    'step 0'
                    event.target = trigger.player;
                    event.state = true;
                    event._global_waiting = true;
                    event.filterCard = function (card, player) {
                        if (get.nature(card) != 'yami') return false;
                        return lib.filter.cardEnabled(card, player, 'forceEnable');
                    };
                    event.send = function (player, state, target, id, skillState) {
                        if (skillState) {
                            player.applySkills(skillState);
                        }
                        state = state ? 1 : -1;
                        var str = '';
                        if (target) {
                            str += '' + get.translation(target);
                        }
                        str += '';

                        var next = player.chooseToUse({
                            filterCard: function (card, player) {
                                if (get.nature(card) != 'yami') return false;
                                return player.canUse(card, target, false);
                            },
                            filterTarget: target,
                            prompt: str,
                            type: 'yami',//
                            state: state,
                            _global_waiting: true,
                            ai1: function () {
                                if (target) {
                                    var triggerevent = _status.event.getTrigger();
                                    if (triggerevent &amp;&amp; triggerevent.parent &amp;&amp;
                                        triggerevent.parent.postAi &amp;&amp;
                                        triggerevent.player.isUnknown(_status.event.player)) {
                                        return 0;
                                    }
                                    if (Math.abs(get.attitude(_status.event.player, target)) &lt; 0) return Math.random() - 0.2;
                                }
                                else {
                                    return 0;
                                }
                            },
                            id: id,
                        });
                        if (event.stateplayer &amp;&amp; event.statecard) next.set('respondTo', [event.stateplayer]);
                        if (game.online) {
                            _status.event._resultid = id;
                            game.resume();
                        }
                        else {
                            next.nouse = true;
                        }
                    };
                    event.settle = function () {
                        /*if(!event.state){
                            trigger.cancel();
                            trigger.result = {yamied: true};
                        }*/
                        event.finish();
                    };
                    'step 1'
                    var list = game.filterPlayer(function (current) {
                        if (current == event.target) return false;
                        if (event.noyami) return false;
                        if (event.directHit &amp;&amp; event.directHit.contains(current)) return false;
                        return current.hasYami();
                    });
                    event.list = list;
                    event.id = get.id();
                    list.sort(function (a, b) {
                        return get.distance(event.target, a, 'absolute') - get.distance(event.target, b, 'absolute');
                    });
                    'step 2'
                    if (event.list.length == 0) {
                        event.settle();
                    }
                    else if (_status.connectMode &amp;&amp; (event.list[0].isOnline() || event.list[0] == game.me)) {
                        event.goto(4);
                    }
                    else {
                        event.current = event.list.shift();
                        event.send(event.current, event.state, event.target, event.id);
                    }
                    'step 3'
                    if (result.bool) {
                        event.yamiresult = event.current;
                        event.yamiresult2 = result;
                        event.goto(8);
                    }
                    else {
                        event.goto(2);
                    }
                    'step 4'
                    var id = event.id;
                    var sendback = function (result, player) {
                        if (result &amp;&amp; result.id == id &amp;&amp; !event.yamiresult &amp;&amp; result.bool) {
                            event.yamiresult = player;
                            event.yamiresult2 = result;
                            game.broadcast('cancel', id);
                            if (_status.event.id == id &amp;&amp; _status.event.name == 'chooseToUse' &amp;&amp; _status.paused) {
                                return (function () {
                                    event.resultOL = _status.event.resultOL;
                                    ui.click.cancel();
                                    if (ui.confirm) ui.confirm.close();
                                });
                            }
                        }
                        else {
                            if (_status.event.id == id &amp;&amp; _status.event.name == 'chooseToUse' &amp;&amp; _status.paused) {
                                return (function () {
                                    event.resultOL = _status.event.resultOL;
                                });
                            }
                        }
                    };

                    var withme = false;
                    var withol = false;
                    var list = event.list;
                    for (var i = 0; i &lt; list.length; i++) {
                        if (list[i].isOnline()) {
                            withol = true;
                            list[i].wait(sendback);
                            list[i].send(event.send, list[i], event.state, event.target, event.id, get.skillState(list[i]));
                            list.splice(i--, 1);
                        }
                        else if (list[i] == game.me) {
                            withme = true;
                            event.send(list[i], event.state, event.target, event.id);
                            list.splice(i--, 1);
                        }
                    }
                    if (!withme) {
                        event.goto(6);
                    }
                    if (_status.connectMode) {
                        if (withme || withol) {
                            for (var i = 0; i &lt; game.players.length; i++) {
                                game.players[i].showTimer();
                            }
                        }
                    }
                    event.withol = withol;
                    'step 5'
                    if (result &amp;&amp; result.bool &amp;&amp; !event.yamiresult) {
                        game.broadcast('cancel', event.id);
                        event.yamiresult = game.me;
                        event.yamiresult2 = result;
                    }
                    'step 6'
                    if (event.withol &amp;&amp; !event.resultOL) {
                        game.pause();
                    }
                    'step 7'
                    for (var i = 0; i &lt; game.players.length; i++) {
                        game.players[i].hideTimer();
                    }
                    'step 8'
                    if (event.yamiresult) {
                        var next = event.yamiresult.useResult(event.yamiresult2);
                        if (event.stateplayer) next.respondTo = [event.stateplayer, event];
                    }
                    'step 9'
                    if (event.yamiresult) {
                        if (result) {
                            // event.noyami=result.noyami;
                            // event.directHit=result.directHit;
                            // event.stateplayer=event.yamiresult;
                            // if(event.yamiresult2&amp;&amp;event.yamiresult2.used){
                            // 	event.statecard=event.yamiresult2.used;
                            // }
                            // else{
                            // 	event.statecard=true;
                            // }
                            event.goto(1);
                        }
                        else event.settle();
                    }
                    else if (event.list.length) {
                        event.goto(2);
                    }
                    else {
                        event.settle();
                    }
                    delete event.resultOL;
                    delete event.yamiresult;
                    delete event.yamiresult2;
                }
            },
            aozhan: {
                charlotte: true,
                mod: {
                    targetEnabled: function (card) {
                        if (card.name == 'tao' &amp;&amp; (card.isCard &amp;&amp; card.cardid || get.itemtype(card) == 'card')) return false;
                    },
                    cardSavable: function (card) {
                        if (card.name == 'tao' &amp;&amp; (card.isCard &amp;&amp; card.cardid || get.itemtype(card) == 'card')) return false;
                    },
                },
                group: ["aozhan_sha", "aozhan_shan"],
                subSkill: {
                    sha: {
                        enable: ["chooseToUse", "chooseToRespond"],
                        filterCard: {
                            name: "tao",
                        },
                        viewAs: {
                            name: "sha",
                            isCard: true,
                        },
                        viewAsFilter: function (player) {
                            if (!player.countCards('hs', 'tao')) return false;
                        },
                        position: 'hs',
                        prompt: "",
                        check: function () { return 1 },
                        ai: {
                            respondSha: true,
                            skillTagFilter: function (player) {
                                if (!player.countCards('hs', 'tao')) return false;
                            },
                            order: function () {
                                return get.order({ name: 'sha' }) - 0.1;
                            },
                        },
                        sub: true,
                    },
                    shan: {
                        enable: ["chooseToRespond", "chooseToUse"],
                        filterCard: {
                            name: "tao",
                        },
                        viewAs: {
                            name: "shan",
                            isCard: true,
                        },
                        prompt: "",
                        check: function () { return 1 },
                        viewAsFilter: function (player) {
                            if (!player.countCards('hs', 'tao')) return false;
                        },
                        position: 'hs',
                        ai: {
                            respondShan: true,
                            skillTagFilter: function (player) {
                                if (!player.countCards('hs', 'tao')) return false;
                            },
                        },
                        sub: true,
                    },
                },
            },
            /**
             * _
             * 
             * @type {!Array&lt;string>}
             * @see {@link game.addGlobalSkill}
             */
            global: [],
            globalmap: {},
            storage: {},
            undist: {},
            others: {},
            zhu: {},
            zhuSkill: {},
            land_used: {},
            unequip: { ai: { unequip: true } },
            subplayer: {
                trigger: { player: 'dieBefore' },
                forced: true,
                priority: -9,
                onremove: true,
                mark: 'character',
                intro: {
                    content: function (storage, player) {
                        if (typeof storage.intro2 == 'string') return storage.intro2;
                        if (typeof storage.intro2 == 'function') return storage.intro2(storage, player);
                        return ''
                    },
                    name: function (storage) {
                        return get.rawName(storage.name);
                    }
                },
                content: function () {
                    trigger.cancel();
                    var evt = trigger.getParent('damage');
                    if (evt.player == player) {
                        evt.untrigger(false, player);
                    }
                    player.exitSubPlayer(true);
                },
                ai: {
                    nosave: true
                }
            },
            autoswap: {
                firstDo: true,
                trigger: {
                    player: ['playercontrol', 'chooseToUseBegin', 'chooseToRespondBegin', 'chooseToDiscardBegin', 'chooseToCompareBegin',
                        'chooseButtonBegin', 'chooseCardBegin', 'chooseTargetBegin', 'chooseCardTargetBegin', 'chooseControlBegin',
                        'chooseBoolBegin', 'choosePlayerCardBegin', 'discardPlayerCardBegin', 'gainPlayerCardBegin']
                },
                forced: true,
                priority: 100,
                forceDie: true,
                popup: false,
                filter: function (event, player) {
                    if (event.autochoose &amp;&amp; event.autochoose()) return false;
                    if (lib.filter.wuxieSwap(event)) return false;
                    if (_status.auto || !player.isUnderControl()) return false;
                    return true;
                },
                content: function () {
                    game.swapPlayerAuto(player);
                },
            },
            dualside: {
                subSkill: {
                    turn: {
                        trigger: { player: ['turnOverAfter', 'dieBefore'] },
                        silent: true,
                        filter: function (event, player) {
                            if (player.storage.dualside_over) return false;
                            return Array.isArray(player.storage.dualside);
                        },
                        content: function () {
                            var cfg = player.storage.dualside;
                            var bool = player.isTurnedOver();
                            if (trigger.name == 'die') {
                                bool = !bool;
                            }
                            if (bool) {
                                cfg[1] = player.hp;
                                cfg[2] = player.maxHp;
                                player.reinit(cfg[0], cfg[3], [cfg[4], cfg[5]]);
                                player.unmarkSkill('dualside');
                                player.markSkillCharacter('dualside', { name: cfg[0] }, '', '' + cfg[1] + '/' + cfg[2]);
                            }
                            else {
                                cfg[4] = player.hp;
                                cfg[5] = player.maxHp;
                                player.reinit(cfg[3], cfg[0], [cfg[1], cfg[2]]);
                                player.unmarkSkill('dualside');
                                player.markSkillCharacter('dualside', { name: cfg[3] }, '', '' + cfg[4] + '/' + cfg[5]);
                            }

                            if (trigger.name == 'die') {
                                trigger.cancel();
                                delete player.storage.dualside;
                                player.storage.dualside_over = true;
                                player.unmarkSkill('dualside');
                            }
                        }
                    },
                    init: {
                        trigger: { global: 'gameStart', player: 'enterGame' },
                        silent: true,
                        content: function () {
                            var list = [player.name, player.name1, player.name2];
                            for (var i = 0; i &lt; list.length; i++) {
                                if (list[i] &amp;&amp; lib.character[list[i]]) {
                                    var info = lib.character[list[i]];
                                    if (info[3].contains('dualside') &amp;&amp; info[4]) {
                                        player.storage.dualside = [list[i], player.hp, player.maxHp];
                                        for (var j = 0; j &lt; info[4].length; j++) {
                                            if (info[4][j].indexOf('dualside:') == 0) {
                                                var name2 = info[4][j].slice(9);
                                                var info2 = lib.character[name2];
                                                player.storage.dualside.push(name2);
                                                player.storage.dualside.push(get.infoHp(info2[2]));
                                                player.storage.dualside.push(get.infoMaxHp(info2[2]));
                                            }
                                        }
                                    }
                                }
                            }
                            var cfg = player.storage.dualside;
                            if (get.mode() == 'guozhan') {
                                if (player.name1 == cfg[0]) {
                                    player.showCharacter(0);
                                }
                                else {
                                    player.showCharacter(1);
                                }
                            }
                            player.markSkillCharacter('dualside', { name: cfg[3] }, '', '' + cfg[4] + '/' + cfg[5]);
                        }
                    }
                },
                group: ['dualside_init', 'dualside_turn']
            },
            _disableJudge: {
                marktext: "",
                intro: {
                    content: "",
                },
                mod: {
                    targetEnabled: function (card, player, target) {
                        if (target.storage._disableJudge &amp;&amp; get.type(card) == 'delay') return false;
                    },
                },
            },
            "_disableEquip": {
                marktext: "",
                intro: {
                    content: function (storage, player, skill) {
                        var str = '';
                        for (var i = 0; i &lt; player.storage.disableEquip.length; i++) {
                            str += '' + get.translation(player.storage.disableEquip[i]) + '';
                        };
                        str = str.slice(1, str.length)
                        str = '' + str;
                        return str;
                    },
                },
                mod: {
                    targetEnabled: function (card, player, target) {
                        if (target.isDisabled(get.subtype(card))) return false;
                    },
                },
                trigger: {
                    player: ['disableEquipBefore', 'enableEquipBefore', 'enterGame'],
                    global: 'gameStart',
                },
                forced: true,
                popup: false,
                filter: function (event, player) {
                    return player.storage.disableEquip == undefined;
                },
                content: function () {
                    player.storage.disableEquip = [];
                },
            },
            /**
             * _
             * 
             */
            fengyin: {
                init: function (player, skill) {
                    player.addSkillBlocker(skill);
                },
                onremove: function (player, skill) {
                    player.removeSkillBlocker(skill);
                },
                charlotte: true,
                skillBlocker: function (skill, player) {
                    return !lib.skill[skill].charlotte &amp;&amp; !get.is.locked(skill, player);
                },
                mark: true,
                intro: {
                    content: function (storage, player, skill) {
                        var list = player.getSkills(null, false, false).filter(function (i) {
                            return lib.skill.fengyin.skillBlocker(i, player);
                        });
                        if (list.length) return '' + get.translation(list);
                        return '';
                    }
                }
            },
            /**
             * _
             * 
             */
            baiban: {
                init: function (player, skill) {
                    player.addSkillBlocker(skill);
                },
                onremove: function (player, skill) {
                    player.removeSkillBlocker(skill);
                },
                charlotte: true,
                skillBlocker: function (skill, player) {
                    return !lib.skill[skill].charlotte;
                },
                mark: true,
                intro: {
                    content: function (storage, player, skill) {
                        var list = player.getSkills(null, false, false).filter(function (i) {
                            return lib.skill.baiban.skillBlocker(i, player);
                        });
                        if (list.length) return '' + get.translation(list);
                        return '';
                    }
                }
            },
            qianxing: {
                mark: true,
                nopop: true,
                init: function (player) {
                    game.log(player, '', '');
                },
                intro: {
                    content: ''
                },
                mod: {
                    targetEnabled: function (card, player, target) {
                        if (player != target) return false;
                    }
                }
            },
            /**
             * _
             * 
             */
            mianyi: {
                trigger: { player: 'damageBefore' },
                mark: true,
                forced: true,
                init: function (player) {
                    game.log(player, '', '');
                },
                content: function () {
                    trigger.cancel();
                },
                ai: {
                    noyami: true,
                    nofire: true,
                    nothunder: true,
                    noocean: true,
                    nodamage: true,
                    effect: {
                        target: function (card, player, target, current) {
                            if (get.tag(card, 'damage')) return [0, 0];
                        }
                    },
                },
                intro: {
                    content: ''
                }
            },
            mad: {
                mark: true,
                locked: true,
                intro: {
                    content: '',
                    name: '',
                    onunmark: function (storage, player) {
                        game.log(player, '');
                    }
                }
            },
            ghujia: {
                intro: {
                    content: function (content, player) {
                        return '' + get.cnNumber(player.hujia) + '';
                    }
                }
            },
            counttrigger: {
                trigger: { global: 'phaseAfter' },
                silent: true,
                charlotte: true,
                priority: -100,
                content: function () {
                    player.removeSkill('counttrigger');
                    delete player.storage.counttrigger;
                }
            },
            _recovercheck: {
                trigger: { player: 'recoverBefore' },
                forced: true,
                priority: 100,
                firstDo: true,
                popup: false,
                filter: function (event, player) {
                    return player.hp >= player.maxHp;
                },
                content: function () {
                    trigger.cancel();
                },
            },
            /**
             * _
             * 
             */
            _turnover: {
                trigger: { player: 'phaseBefore' },
                forced: true,
                priority: 100,
                popup: false,
                firstDo: true,
                content: function () {
                    'step 0'
                    if ((player == _status.roundStart || _status.roundSkipped) &amp;&amp; !trigger.skill) {
                        event.trigger('roundEnd');
                    }
                    'step 1'
                    if (player.isTurnedOver()) {
                        trigger.cancel();
                        player.turnOver();
                        player.phaseSkipped = true;
                    }
                    else {
                        player.phaseSkipped = false;
                    }
                    'step 2'
                    if ((player == _status.roundStart || _status.roundSkipped) &amp;&amp; !trigger.skill) {
                        delete _status.roundSkipped;
                        game.roundNumber++;
                        trigger._roundStart = true;
                        game.updateRoundNumber();
                        for (var i = 0; i &lt; game.players.length; i++) {
                            if (game.players[i].isOut() &amp;&amp; game.players[i].outCount > 0) {
                                game.players[i].outCount--;
                                if (game.players[i].outCount == 0 &amp;&amp; !game.players[i].outSkills) {
                                    game.players[i].in();
                                }
                            }
                        }
                        event.trigger('roundStart');
                    }
                },
            },
            /**
             * _
             * {@link ui.clear}ui
             */
            _usecard: {
                trigger: { global: 'useCardAfter' },
                forced: true,
                popup: false,
                priority: -100,
                lastDo: true,
                filter: function (event) {
                    return !event._cleared &amp;&amp; event.card.name != 'wuxie';
                },
                content: function () {
                    game.broadcastAll(function () {
                        ui.clear();
                    });
                    event._cleared = true;
                }
            },
            /**
             * _
             * 
             */
            _discard: {
                trigger: { global: 'discardAfter' },
                forced: true,
                popup: false,
                priority: -100,
                lastDo: true,
                filter: function (event) {
                    return ui.todiscard[event.discardid] ? true : false;
                },
                content: function () {
                    game.broadcastAll(function (id) {
                        var todiscard = ui.todiscard[id];
                        delete ui.todiscard[id];
                        if (todiscard) {
                            var time = 1000;
                            if (typeof todiscard._discardtime == 'number') {
                                time += todiscard._discardtime - get.time();
                            }
                            if (time &lt; 0) {
                                time = 0;
                            }
                            setTimeout(function () {
                                for (var i = 0; i &lt; todiscard.length; i++) {
                                    todiscard[i].delete();
                                }
                            }, time);
                        }
                    }, trigger.discardid);
                }
            },
            _save: {
                //trigger:{source:'dying2',player:'dying2'},
                priority: 5,
                forced: true,
                popup: false,
                filter: function (event, player) {
                    //if(!event.player.isDying()) return false;
                    //if(event.source&amp;&amp;event.source.isIn()&amp;&amp;event.source!=player) return false;
                    //return true;
                    return false;
                },
                content: function () {
                    "step 0"
                    event.dying = trigger.player;
                    if (!event.acted) event.acted = [];
                    "step 1"
                    if (trigger.player.isDead()) {
                        event.finish();
                        return;
                    }
                    event.acted.push(player);
                    var str = get.translation(trigger.player) + '';
                    var str2 = '' + trigger.player.hp;
                    if (lib.config.tao_enemy &amp;&amp; event.dying.side != player.side &amp;&amp; lib.config.mode != 'identity' &amp;&amp; lib.config.mode != 'guozhan' &amp;&amp; !event.dying.hasSkillTag('revertsave')) {
                        event._result = { bool: false }
                    }
                    else if (player.canSave(event.dying)) {
                        player.chooseToUse({
                            filterCard: function (card, player, event) {
                                event = event || _status.event;
                                return lib.filter.cardSavable(card, player, event.dying);
                            },
                            filterTarget: trigger.player,
                            prompt: str,
                            prompt2: str2,
                            ai1: function (card) {
                                if (typeof card == 'string') {
                                    var info = get.info(card);
                                    if (info.ai &amp;&amp; info.ai.order) {
                                        if (typeof info.ai.order == 'number') {
                                            return info.ai.order;
                                        }
                                        else if (typeof info.ai.order == 'function') {
                                            return info.ai.order();
                                        }
                                    }
                                }
                                return 1;
                            },
                            ai2: get.effect_use,
                            type: 'dying',
                            targetRequired: true,
                            dying: event.dying
                        });
                    }
                    else {
                        event._result = { bool: false }
                    }
                    "step 2"
                    if (result.bool) {
                        if (trigger.player.hp &lt;= 0 &amp;&amp; !trigger.player.nodying &amp;&amp; trigger.player.isAlive() &amp;&amp; !trigger.player.isOut() &amp;&amp; !trigger.player.removed) event.goto(0);
                        else trigger.untrigger();
                    }
                    else {
                        for (var i = 0; i &lt; 20; i++) {
                            if (event.acted.contains(event.player.next)) {
                                break;
                            }
                            else {
                                event.player = event.player.next;
                                if (!event.player.isOut()) {
                                    event.goto(1);
                                    break;
                                }
                            }
                        }
                    }
                }
            },
            _ismin: {
                mod: {
                    cardEnabled: function (card, player) {
                        if (player.isMin()) {
                            if (get.type(card) == 'equip') return false;
                        }
                    }
                }
            },
            /**
             * _
             * 
             */
            _chongzhu: {
                enable: 'phaseUse',
                logv: false,
                visible: true,
                prompt: '',
                filter: function (event, player) {
                    return player.hasCard(function (card) {
                        return lib.skill._chongzhu.filterCard(card, player);
                    });
                },
                filterCard: function (card, player) {
                    var mod = game.checkMod(card, player, 'unchanged', 'cardChongzhuable', player);
                    if (mod != 'unchanged') return mod;
                    var info = get.info(card);
                    if (typeof info.chongzhu == 'function') {
                        return info.chongzhu(event, player);
                    }
                    return info.chongzhu;
                },
                prepare: function (cards, player) {
                    player.$throw(cards, 1000);
                    game.log(player, '', cards, '');
                },
                check: function (card) {
                    // if(get.type(card)=='stonecharacter'&amp;&amp;_status.event.player.countCards('h',{type:'stonecharacter'})&lt;=1){
                    //     return 0;
                    // }
                    return 1;
                },
                discard: false,
                loseTo: 'discardPile',
                delay: 0.5,
                content: function () {
                    "step 0"
                    if (lib.config.mode == 'stone' &amp;&amp; _status.mode == 'deck' &amp;&amp;
                        !player.isMin() &amp;&amp; get.type(cards[0]).indexOf('stone') == 0) {
                        var list = get.stonecard(1, player.career);
                        if (list.length) {
                            player.gain(game.createCard(list.randomGet()), 'draw');
                        }
                        else {
                            player.draw({ drawDeck: 1 })
                        }
                    }
                    else if (get.subtype(cards[0]) == 'spell_gold') {
                        var list = get.libCard(function (info) {
                            return info.subtype == 'spell_silver';
                        });
                        if (list.length) {
                            player.gain(game.createCard(list.randomGet()), 'draw');
                        }
                        else {
                            player.draw();
                        }
                    }
                    else if (get.subtype(cards[0]) == 'spell_silver') {
                        var list = get.libCard(function (info) {
                            return info.subtype == 'spell_bronze';
                        });
                        if (list.length) {
                            player.gain(game.createCard(list.randomGet()), 'draw');
                        }
                        else {
                            player.draw();
                        }
                    }
                    else {
                        player.draw();
                    }
                },
                ai: {
                    basic: {
                        order: 6
                    },
                    result: {
                        player: 1,
                    },
                }
            },
            /**
             * _
             * 
             */
            _lianhuan: {
                trigger: { player: 'damageAfter' },
                filter: function (event, player) {
                    return event.lianhuanable == true;
                },
                forced: true,
                popup: false,
                logv: false,
                forceDie: true,
                //priority:-5,
                content: function () {
                    "step 0"
                    event.logvid = trigger.getLogv();
                    "step 1"
                    event.targets = game.filterPlayer(function (current) {
                        return current != event.player &amp;&amp; current.isLinked();
                    });
                    lib.tempSortSeat = _status.currentPhase || player;
                    event.targets.sort(lib.sort.seat);
                    delete lib.tempSortSeat;
                    event._args = [trigger.num, trigger.nature, trigger.cards, trigger.card];
                    if (trigger.source) event._args.push(trigger.source);
                    else event._args.push("nosource");
                    "step 2"
                    if (event.targets.length) {
                        var target = event.targets.shift();
                        if (target.isLinked()) target.damage.apply(target, event._args.slice(0));
                        event.redo();
                    }
                },
            },
            _lianhuan4: {
                trigger: { player: 'changeHp' },
                priority: -10,
                forced: true,
                popup: false,
                forceDie: true,
                filter: function (event, player) {
                    var evt = event.getParent();
                    return evt &amp;&amp; evt.name == 'damage' &amp;&amp; evt.nature &amp;&amp; lib.linked.contains(evt.nature) &amp;&amp; player.isLinked();
                },
                content: function () {
                    var overNature = trigger.getParent().oceanAddDam || false;
                    if (trigger.getParent(2).type == 'card' &amp;&amp; get.nature(trigger.getParent(2).card) == 'yami' &amp;&amp; trigger.getParent(3).yamiDirect) overNature = true;
                    if (!overNature) {
                        player.link();
                        if (trigger.getParent().notLink()) trigger.getParent().lianhuanable = true;
                    }
                }
            }
        },
        character: {},
        /**
         * 
         * @type {!Object}
         */
        perfectPair: {},
        cardPile: {},
        /**
         * 
         * @type {!Object}
         */
        message: {
            server: {
                init: function (version, config, banned_info) {
                    if (lib.node.banned.contains(banned_info)) {
                        this.send('denied', 'banned');
                    }
                    else if (config.id &amp;&amp; lib.playerOL &amp;&amp; lib.playerOL[config.id]) {
                        var player = lib.playerOL[config.id];
                        player.setNickname();
                        player.ws = this;
                        player.isAuto = false;
                        this.id = config.id;
                        game.broadcast(function (player) {
                            player.setNickname();
                        }, player);
                        this.send('reinit', lib.configOL, get.arenaState(), game.getState ? game.getState() : {}, game.ip, null, _status.onreconnect, _status.cardtag);
                    }
                    else if (version != lib.versionOL) {
                        this.send('denied', 'version');
                        lib.node.clients.remove(this);
                        this.closed = true;
                    }
                    else if (!_status.waitingForPlayer) {
                        if (game.phaseNumber &amp;&amp; lib.configOL.observe) {
                            lib.node.observing.push(this);
                            this.send('reinit', lib.configOL, get.arenaState(), game.getState ? game.getState() : {}, game.ip, game.players[0].playerid, null, _status.cardtag);
                            if (!ui.removeObserve) {
                                ui.removeObserve = ui.create.system('', function () {
                                    lib.configOL.observe = false;
                                    if (game.onlineroom) {
                                        game.send('server', 'config', lib.configOL);
                                    }
                                    while (lib.node.observing.length) {
                                        lib.node.observing.shift().ws.close();
                                    }
                                    this.remove();
                                    delete ui.removeObserve;
                                }, true);
                            }
                        }
                        else {
                            this.send('denied', 'gaming');
                            lib.node.clients.remove(this);
                            this.closed = true;
                        }
                    }
                    else if (lib.node.clients.length - (window.isNonameServer ? 1 : 0) >= parseInt(lib.configOL.number)) {
                        this.send('denied', 'number');
                        lib.node.clients.remove(this);
                        this.closed = true;
                    }
                    else {
                        if (config) {
                            this.avatar = config.avatar;
                            this.nickname = config.nickname;
                        }
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].classList.contains('unselectable2')) continue;
                            if (game.connectPlayers[i] != game.me &amp;&amp; !game.connectPlayers[i].playerid) {
                                game.connectPlayers[i].playerid = this.id;
                                game.connectPlayers[i].initOL(this.nickname, this.avatar);
                                game.connectPlayers[i].ws = this;
                                break;
                            }
                        }
                        this.send('init', this.id, lib.configOL, game.ip, window.isNonameServer, game.roomId);
                    }
                },
                inited: function () {
                    this.inited = true;
                    if (_status.waitingForPlayer) {
                        game.updateWaiting();
                    }
                },
                reinited: function () {
                    this.inited = true;
                },
                result: function (result) {
                    if (lib.node.observing.contains(this)) return;
                    var player = lib.playerOL[this.id];
                    if (player) {
                        player.unwait(result);
                    }
                },
                startGame: function () {
                    if (this.id == game.onlinezhu) {
                        game.resume();
                    }
                },
                changeRoomConfig: function (config) {
                    if (this.id == game.onlinezhu) {
                        game.broadcastAll(function (config) {
                            for (var i in config) {
                                lib.configOL[i] = config[i];
                            }
                            if (ui.connectStartBar) {
                                ui.connectStartBar.firstChild.innerHTML = get.modetrans(lib.configOL, true);
                            }
                        }, config);
                        if (lib.configOL.mode == 'identity' &amp;&amp; lib.configOL.identity_mode == 'zhong' &amp;&amp; game.connectPlayers) {
                            for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                game.connectPlayers[i].classList.remove('unselectable2');
                            }
                            lib.configOL.number = 8;
                            game.updateWaiting();
                        }
                        if (game.onlineroom) {
                            game.send('server', 'config', lib.configOL);
                        }
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].playerid == this.id) {
                                game.connectPlayers[i].chat('');
                            }
                        }
                    }
                },
                changeNumConfig: function (num, index, bool) {
                    if (this.id == game.onlinezhu) {
                        lib.configOL.number = num;
                        game.send('server', 'config', lib.configOL);
                        if (game.connectPlayers &amp;&amp; game.connectPlayers[index]) {
                            if (bool) {
                                game.connectPlayers[index].classList.add('unselectable2');
                            }
                            else {
                                game.connectPlayers[index].classList.remove('unselectable2');
                            }
                            game.updateWaiting();
                        }
                    }
                },
                throwEmotion: function (target, emotion) {
                    if (lib.node.observing.contains(this)) return;
                    var player = lib.playerOL[this.id];
                    if (player) {
                        player.throwEmotion(target, emotion);
                    }
                },
                emotion: function (id, pack, emotion) {
                    if (lib.node.observing.contains(this)) return;
                    var that = this;
                    if (!this.id || (!lib.playerOL[this.id] &amp;&amp; (!game.connectPlayers || !function () {
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].playerid == that.id) {
                                return true;
                            }
                        }
                        return false;
                    }()))) return;
                    var player;
                    if (lib.playerOL[id]) {
                        player = lib.playerOL[id];
                    }
                    else if (game.connectPlayers) {
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].playerid == id) {
                                player = game.connectPlayers[i]; break;
                            }
                        }
                    }
                    if (player) lib.element.player.emotion.apply(player, [pack, emotion]);
                },
                chat: function (id, str) {
                    var that = this;
                    if (!this.id || (!lib.playerOL[this.id] &amp;&amp; (!game.connectPlayers || !function () {
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].playerid == that.id) {
                                return true;
                            }
                        }
                        return false;
                    }()))) return;
                    var player;
                    if (lib.playerOL[id]) {
                        player = lib.playerOL[id];
                    }
                    else if (game.connectPlayers) {
                        for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                            if (game.connectPlayers[i].playerid == id) {
                                player = game.connectPlayers[i]; break;
                            }
                        }
                    }
                    if (player) lib.element.player.chat.call(player, str);
                },
                giveup: function (player) {
                    if (lib.node.observing.contains(this) || !player || !player._giveUp) return;
                    _status.event.next.length = 0;
                    game.createEvent('giveup', false).setContent(function () {
                        game.log(player, '');
                        player.popup('');
                        player.die('nosource');
                    }).player = player;
                },
                auto: function () {
                    if (lib.node.observing.contains(this)) return;
                    var player = lib.playerOL[this.id];
                    if (player) {
                        player.isAuto = true;
                        player.setNickname(player.nickname + ' - ');
                        game.broadcast(function (player) {
                            player.setNickname(player.nickname + ' - ');
                        }, player);
                    }
                },
                unauto: function () {
                    if (lib.node.observing.contains(this)) return;
                    var player = lib.playerOL[this.id];
                    if (player) {
                        player.isAuto = false;
                        player.setNickname(player.nickname);
                        game.broadcast(function (player) {
                            player.setNickname(player.nickname);
                        }, player);
                    }
                },
                exec: function (func) {
                    // if(typeof func=='function'){
                    //     var args=Array.from(arguments);
                    //     args.shift();
                    //     func.apply(this,args);
                    // }
                },
                log: function () {
                    var items = [];
                    try {
                        for (var i = 0; i &lt; arguments.length; i++) {
                            eval('items.push(' + arguments[i] + ')');
                        }
                    }
                    catch (e) {
                        this.send('log', ['err']);
                        return;
                    }
                    this.send('log', items);
                }
            },
            client: {
                log: function (arr) {
                    if (Array.isArray(arr)) {
                        for (var i = 0; i &lt; arr.length; i++) {
                            console.log(arr[i]);
                        }
                    }
                },
                opened: function () {
                    game.send('init', lib.versionOL, {
                        id: game.onlineID,
                        avatar: lib.config.connect_avatar,
                        nickname: get.connectNickname()
                    }, lib.config.banned_info);
                    if (ui.connecting &amp;&amp; !ui.connecting.splashtimeout) {
                        ui.connecting.firstChild.innerHTML = '';
                    }
                },
                onconnection: function (id) {
                    var ws = { wsid: id };
                    for (var i in lib.element.nodews) {
                        ws[i] = lib.element.nodews[i];
                    }
                    lib.wsOL[id] = ws;
                    lib.init.connection(ws);
                },
                onmessage: function (id, message) {
                    if (lib.wsOL[id]) {
                        lib.wsOL[id].onmessage(message);
                    }
                },
                onclose: function (id) {
                    if (lib.wsOL[id]) {
                        lib.wsOL[id].onclose();
                    }
                },
                selfclose: function () {
                    if (game.online || game.onlineroom) {
                        if ((game.servermode || game.onlinehall) &amp;&amp; _status.over) {
                            // later
                        }
                        else {
                            game.saveConfig('tmp_user_roomId');
                        }
                    }
                    game.ws.close();
                },
                reloadroom: function (forced) {
                    if (window.isNonameServer &amp;&amp; (forced || !_status.protectingroom)) {
                        game.reload();
                    }
                },
                createroom: function (index, config, mode) {
                    game.online = false;
                    game.onlineroom = true;
                    game.roomId = index;
                    lib.node = {};
                    if (config &amp;&amp; mode &amp;&amp; window.isNonameServer) {
                        if (mode == 'auto') {
                            mode = lib.configOL.mode;
                        }
                        game.switchMode(mode, config);
                    }
                    else {
                        game.switchMode(lib.configOL.mode);
                    }
                    ui.create.connecting(true);
                },
                enterroomfailed: function () {
                    alert('');
                    _status.enteringroom = false;
                    ui.create.connecting(true);
                },
                roomlist: function (list, events, clients, wsid) {
                    game.send('server', 'key', [game.onlineKey, lib.version]);
                    game.online = true;
                    game.onlinehall = true;
                    lib.config.recentIP.remove(_status.ip);
                    lib.config.recentIP.unshift(_status.ip);
                    lib.config.recentIP.splice(5);
                    if (!lib.config.reconnect_info || lib.config.reconnect_info[0] != _status.ip) {
                        game.saveConfig('reconnect_info', [_status.ip, null]);
                    }
                    game.saveConfig('recentIP', lib.config.recentIP);
                    _status.connectMode = true;

                    game.clearArena();
                    game.clearConnect();
                    ui.pause.hide();
                    ui.auto.hide();

                    clearTimeout(_status.createNodeTimeout);
                    game.send('server', 'changeAvatar', get.connectNickname(), lib.config.connect_avatar);

                    var proceed = function () {
                        game.ip = get.trimip(_status.ip);
                        ui.create.connectRooms(list);
                        if (events) {
                            ui.connectEvents = ui.create.div('.forceopaque.menubutton.large.connectevents.pointerdiv', '', ui.window, ui.click.connectEvents);
                            ui.connectEventsCount = ui.create.div('.forceopaque.menubutton.icon.connectevents.highlight.hidden', '', ui.window);
                            ui.connectClients = ui.create.div('.forceopaque.menubutton.large.connectevents.pointerdiv.left', '', ui.window, ui.click.connectClients);
                            ui.connectClientsCount = ui.create.div('.forceopaque.menubutton.icon.connectevents.highlight.left', '1', ui.window);
                            ui.createRoomButton = ui.create.div('.forceopaque.menubutton.large.connectevents.pointerdiv.left2', '', ui.window, function () {
                                if (!_status.creatingroom) {
                                    _status.creatingroom = true;
                                    ui.click.connectMenu();
                                }
                            });
                            if (events.length) {
                                ui.connectEventsCount.innerHTML = events.filter(function (evt) {
                                    return evt.creator == game.onlineKey || !get.is.banWords(evt.content)
                                }).length;
                                ui.connectEventsCount.show();
                            }
                        }
                        game.wsid = wsid;
                        lib.message.client.updaterooms(list, clients);
                        lib.message.client.updateevents(events);
                        ui.exitroom = ui.create.system('', function () {
                            game.saveConfig('tmp_owner_roomId');
                            game.saveConfig('tmp_user_roomId');
                            if (ui.rooms) {
                                game.saveConfig('reconnect_info');
                            }
                            else {
                                if (lib.config.reconnect_info) {
                                    lib.config.reconnect_info.length = 1;
                                    game.saveConfig('reconnect_info', lib.config.reconnect_info);
                                }
                            }
                            game.reload();
                        }, true);

                        var findRoom = function (id) {
                            for (var room of ui.rooms) {
                                if (room.key == id) return room;
                            }
                            return false;
                        };
                        if (typeof lib.config.tmp_owner_roomId == 'string') {
                            if (typeof game.roomId != 'string' &amp;&amp; !findRoom(lib.config.tmp_owner_roomId)) {
                                lib.configOL.mode = lib.config.connect_mode;
                                game.roomId = lib.config.tmp_owner_roomId;
                            }
                            game.saveConfig('tmp_owner_roomId');
                        }
                        if (typeof lib.config.tmp_user_roomId == 'string') {
                            if (typeof game.roomId != 'string') {
                                if (findRoom(lib.config.tmp_user_roomId)) {
                                    game.roomId = lib.config.tmp_user_roomId;
                                }
                                else {
                                    ui.create.connecting();
                                    (function () {
                                        var n = 10;
                                        var id = lib.config.tmp_user_roomId;
                                        var interval = setInterval(function () {
                                            if (n > 0) {
                                                n--;
                                                if (findRoom(id)) {
                                                    clearInterval(interval);
                                                    game.send('server', 'enter', id, get.connectNickname(), lib.config.connect_avatar);
                                                }
                                            }
                                            else {
                                                ui.create.connecting(true);
                                                clearInterval(interval);
                                            }
                                        }, 500);
                                    }());
                                }
                            }
                            game.saveConfig('tmp_user_roomId');
                        }

                        if (window.isNonameServer) {
                            var cfg = 'pagecfg' + window.isNonameServer;
                            if (lib.config[cfg]) {
                                lib.configOL = lib.config[cfg][0];
                                game.send('server', 'server', lib.config[cfg].slice(1));
                                game.saveConfig(cfg);
                                _status.protectingroom = true;
                                setTimeout(function () {
                                    _status.protectingroom = false;
                                    if (!lib.node || !lib.node.clients || !lib.node.clients.length) {
                                        game.reload();
                                    }
                                }, 15000);
                            }
                            else {
                                game.send('server', 'server');
                            }
                        }
                        else if (typeof game.roomId == 'string') {
                            var room = findRoom(game.roomId);
                            if (game.roomIdServer &amp;&amp; room &amp;&amp; (room.serving || !room.version)) {
                                console.log();
                                if (lib.config.reconnect_info) {
                                    lib.config.reconnect_info[2] = null;
                                    game.saveConfig('reconnect_info', lib.config.reconnect_info);
                                }
                            }
                            else {
                                ui.create.connecting();
                                game.send('server', (game.roomId == game.onlineKey) ? 'create' : 'enter', game.roomId, get.connectNickname(), lib.config.connect_avatar);
                            }
                        }
                        lib.init.onfree();
                    }
                    if (_status.event.parent) {
                        game.forceOver('noover', proceed);
                    }
                    else {
                        proceed();
                    }
                },
                updaterooms: function (list, clients) {
                    if (ui.rooms) {
                        var map = {}, map2 = {};
                        for (var i of ui.rooms) map2[i.key] = true;
                        for (var i of list) {
                            if (!i) continue;
                            map[i[4]] = i;
                        }
                        ui.window.classList.add('more_room');
                        for (var i = 0; i &lt; ui.rooms.length; i++) {
                            if (!map[ui.rooms[i].key]) {
                                ui.rooms[i].remove();
                                ui.rooms.splice(i--, 1);
                            }
                            else ui.rooms[i].initRoom(list[i]);
                        }
                        for (var i of list) {
                            if (!i) continue;
                            map[i[4]] = i;
                            if (!map2[i[4]]) {
                                var player = ui.roombase.add('&lt;div class="popup text pointerdiv" style="width:calc(100% - 10px);display:inline-block;white-space:nowrap">&lt;/div>');
                                player.roomindex = i;
                                player.initRoom = lib.element.player.initRoom;
                                player.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.connectroom);
                                player.initRoom(i);
                                ui.rooms.push(player);
                            }
                        }
                    }
                    lib.message.client.updateclients(clients, true);
                },
                updateclients: function (clients, bool) {
                    if (clients &amp;&amp; ui.connectClients) {
                        ui.connectClients.info = clients;
                        ui.connectClientsCount.innerHTML = clients.length;
                    }
                    if (_status.connectClientsCallback) {
                        _status.connectClientsCallback();
                    }
                },
                updateevents: function (events) {
                    if (events &amp;&amp; ui.connectEvents) {
                        ui.connectEvents.info = events;
                        var num = events.filter(function (evt) {
                            return typeof evt.creator == 'string' &amp;&amp; (evt.creator == game.onlineKey || !get.is.banWords(evt.content))
                        }).length;
                        if (num) {
                            ui.connectEventsCount.innerHTML = num;
                            ui.connectEventsCount.show();
                        }
                        else {
                            ui.connectEventsCount.hide();
                        }
                        if (_status.connectEventsCallback) {
                            _status.connectEventsCallback();
                        }
                    }
                },
                eventsdenied: function (reason) {
                    var str = '';
                    if (reason == 'total') {
                        str += '20';
                    }
                    else if (reason == 'time') {
                        str += '';
                    }
                    else if (reason == 'ban') {
                        str += '';
                    }
                    alert(str);
                },
                init: function (id, config, ip, servermode, roomId) {
                    game.online = true;
                    game.onlineID = id;
                    game.ip = ip;
                    game.servermode = servermode;
                    game.roomId = roomId;
                    if (game.servermode) {
                        game.saveConfig('reconnect_info', [_status.ip, id, game.roomId]);
                    }
                    else {
                        game.saveConfig('reconnect_info', [_status.ip, id]);
                        game.saveConfig('tmp_user_roomId', roomId);
                    }
                    lib.config.recentIP.remove(_status.ip);
                    lib.config.recentIP.unshift(_status.ip);
                    lib.config.recentIP.splice(5);
                    game.saveConfig('recentIP', lib.config.recentIP);
                    _status.connectMode = true;
                    lib.configOL = config;
                    lib.playerOL = {};
                    lib.cardOL = {};

                    game.clearArena();
                    game.finishCards();
                    ui.create.roomInfo();
                    ui.create.chat();
                    if (game.servermode) {
                        ui.create.connectPlayers(get.modetrans(config, true));
                    }
                    else {
                        ui.create.connectPlayers(ip);
                    }
                    ui.pause.hide();
                    ui.auto.hide();
                    game.clearConnect();
                    clearTimeout(_status.createNodeTimeout);

                    var proceed = function () {
                        game.loadModeAsync(config.mode, function (mode) {
                            for (var i in mode.ai) {
                                if (typeof mode.ai[i] == 'object') {
                                    if (ai[i] == undefined) ai[i] = {};
                                    for (var j in mode.ai[i]) {
                                        ai[i][j] = mode.ai[i][j];
                                    }
                                }
                                else {
                                    ai[i] = mode.ai[i];
                                }
                            }
                            for (var i in mode.get) {
                                if (typeof mode.get[i] == 'object') {
                                    if (get[i] == undefined) get[i] = {};
                                    for (var j in mode.get[i]) {
                                        get[i][j] = mode.get[i][j];
                                    }
                                }
                                else {
                                    get[i] = mode.get[i];
                                }
                            }
                            for (var i in mode.translate) {
                                lib.translate[i] = mode.translate[i];
                            }
                            if (mode.game) {
                                game.getIdentityList = mode.game.getIdentityList;
                                game.updateState = mode.game.updateState;
                                game.getRoomInfo = mode.game.getRoomInfo;
                            }
                            if (mode.element &amp;&amp; mode.element.player) {
                                for (var i in mode.element.player) {
                                    lib.element.player[i] = mode.element.player[i];
                                }
                            }
                            if (mode.skill) {
                                for (var i in mode.skill) {
                                    lib.skill[i] = mode.skill[i];
                                }
                            }
                            if (mode.card) {
                                for (var i in mode.card) {
                                    lib.card[i] = mode.card[i];
                                }
                            }
                            game.finishCards();
                            if (mode.characterPack) {
                                for (var i in mode.characterPack) {
                                    lib.characterPack[i] = mode.characterPack[i];
                                }
                            }
                            _status.event = {
                                finished: true,
                                next: [],
                                after: []
                            };
                            _status.paused = false;
                            game.createEvent('game', false).setContent(lib.init.startOnline);
                            game.loop();
                            game.send('inited');
                            ui.create.connecting(true);
                        });
                    }
                    if (_status.event.parent) {
                        game.forceOver('noover', proceed);
                    }
                    else {
                        proceed();
                    }
                    for (var i in lib.characterPack) {
                        for (var j in lib.characterPack[i]) {
                            lib.character[j] = lib.character[j] || lib.characterPack[i][j];
                        }
                    }
                },
                reinit: function (config, state, state2, ip, observe, onreconnect, cardtag) {
                    ui.auto.show();
                    ui.pause.show();
                    game.clearConnect();
                    clearTimeout(_status.createNodeTimeout);
                    game.online = true;
                    game.ip = ip;
                    game.servermode = state.servermode;
                    game.roomId = state.roomId;
                    if (state.over) {
                        _status.over = true;
                    }
                    if (observe) {
                        game.observe = true;
                        game.onlineID = null;
                        game.roomId = null;
                    }
                    if (game.servermode &amp;&amp; !observe) {
                        game.saveConfig('reconnect_info', [_status.ip, game.onlineID, game.roomId]);
                    }
                    else {
                        game.saveConfig('reconnect_info', [_status.ip, game.onlineID]);
                        if (!observe) {
                            game.saveConfig('tmp_user_roomId', game.roomId);
                        }
                    }
                    _status.connectMode = true;
                    lib.configOL = config;
                    lib.playerOL = {};
                    lib.cardOL = {};

                    game.loadModeAsync(config.mode, function (mode) {
                        for (var i in mode.ai) {
                            if (typeof mode.ai[i] == 'object') {
                                if (ai[i] == undefined) ai[i] = {};
                                for (var j in mode.ai[i]) {
                                    ai[i][j] = mode.ai[i][j];
                                }
                            }
                            else {
                                ai[i] = mode.ai[i];
                            }
                        }
                        for (var i in mode.get) {
                            if (typeof mode.get[i] == 'object') {
                                if (get[i] == undefined) get[i] = {};
                                for (var j in mode.get[i]) {
                                    get[i][j] = mode.get[i][j];
                                }
                            }
                            else {
                                get[i] = mode.get[i];
                            }
                        }
                        for (var i in mode.translate) {
                            lib.translate[i] = mode.translate[i];
                        }
                        if (mode.game) {
                            game.getIdentityList = mode.game.getIdentityList;
                            game.updateState = mode.game.updateState;
                        }
                        if (mode.element &amp;&amp; mode.element.player) {
                            for (var i in mode.element.player) {
                                lib.element.player[i] = mode.element.player[i];
                            }
                        }
                        if (mode.skill) {
                            for (var i in mode.skill) {
                                lib.skill[i] = mode.skill[i];
                            }
                        }
                        game.finishCards();
                        if (mode.characterPack) {
                            for (var i in mode.characterPack) {
                                lib.characterPack[i] = mode.characterPack[i];
                            }
                        }
                        if (mode.onreinit) {
                            mode.onreinit();
                        }
                        _status.cardtag = get.parsedResult(cardtag);
                        state = get.parsedResult(state);
                        game.players = [];
                        game.dead = [];
                        for (var i in lib.characterPack) {
                            for (var j in lib.characterPack[i]) {
                                lib.character[j] = lib.character[j] || lib.characterPack[i][j];
                            }
                        }
                        game.clearArena();
                        game.finishCards();
                        if (!observe) {
                            ui.create.chat();
                            if (ui.exitroom) {
                                ui.exitroom.remove();
                                delete ui.exitroom;
                            }
                        }
                        else {
                            if (!ui.exitroom) {
                                ui.create.system('', function () {
                                    game.saveConfig('reconnect_info');
                                    game.reload();
                                }, true);
                            }
                            if (!lib.configOL.observe_handcard) {
                                ui.arena.classList.add('observe');
                            }
                        }
                        ui.arena.setNumber(state.number);
                        _status.mode = state.mode;
                        lib.inpile = state.inpile;
                        var pos = state.players[observe || game.onlineID].position;
                        for (var i in state.players) {
                            var info = state.players[i];
                            var player = ui.create.player(ui.arena).animate('start');
                            player.dataset.position = (info.position &lt; pos) ? info.position - pos + parseInt(state.number) : info.position - pos;
                            if (i == observe || i == game.onlineID) {
                                game.me = player;
                            }
                            if (player.setModeState) {
                                player.setModeState(info);
                            }
                            else {
                                player.init(info.name1, info.name2);
                            }
                            if (!info.unseen) player.classList.remove('unseen');
                            if (!info.unseen2) player.classList.remove('unseen2');
                            if (!player.isUnseen(2) &amp;&amp; player.storage.nohp) {
                                delete player.storage.nohp;
                                player.node.hp.show();
                            }
                            player.playerid = i;
                            player.nickname = info.nickname;
                            player.changeGroup(info.group, false, false);
                            player.identity = info.identity;
                            player.identityShown = info.identityShown;
                            player.hp = info.hp;
                            player.maxHp = info.maxHp;
                            player.hujia = info.hujia;
                            player.sex = info.sex;
                            player.side = info.side;
                            player.phaseNumber = info.phaseNumber,
                                player.setNickname();
                            if (info.dead) {
                                player.classList.add('dead');
                                if (lib.config.die_move) {
                                    player.$dieflip();
                                }
                                if (lib.element.player.$dieAfter) {
                                    lib.element.player.$dieAfter.call(player);
                                }
                                game.dead.push(player);
                            }
                            else {
                                game.players.push(player);
                            }
                            if (info.linked) {
                                player.addLink();
                            }
                            if (info.turnedover) {
                                player.classList.add('turnedover');
                            }
                            if (info.disableJudge) {
                                player.$disableJudge();
                            }
                            if (Array.isArray(info.disableEquip)) {
                                for (var ii = 0; ii &lt; info.disableEquip.length; ii++) {
                                    player.$disableEquip(info.disableEquip[ii]);
                                }
                            }

                            player.directgain(info.handcards);
                            lib.playerOL[i] = player;
                            for (var i = 0; i &lt; info.equips.length; i++) {
                                player.$equip(info.equips[i]);
                            }
                            for (var i = 0; i &lt; info.handcards.length; i++) {
                                info.handcards[i].addGaintag(info.gaintag[i]);
                            }
                            for (var i = 0; i &lt; info.specials.length; i++) {
                                info.specials[i].classList.add('glows');
                            }
                            for (var i = 0; i &lt; info.judges.length; i++) {
                                if (info.views[i] &amp;&amp; info.views[i] != info.judges[i]) {
                                    info.judges[i].classList.add('fakejudge');
                                    info.judges[i].viewAs = info.views[i];
                                    info.judges[i].node.background.innerHTML = lib.translate[info.views[i] + '_bg'] || get.translation(info.views[i])[0]
                                }
                                player.node.judges.appendChild(info.judges[i]);
                            }
                            ui.updatej(player);
                            if (!player.setModeState) {
                                if (!game.getIdentityList &amp;&amp; info.identityNode) {
                                    player.node.identity.innerHTML = info.identityNode[0];
                                    player.node.identity.dataset.color = info.identityNode[1];
                                }
                                else if (player == game.me || player.identityShown || observe) {
                                    player.setIdentity();
                                    player.forceShown = true;
                                }
                                else {
                                    player.setIdentity('cai');
                                }
                                if (!lib.configOL.observe_handcard &amp;&amp; (lib.configOL.mode == 'identity' || lib.configOL.mode == 'guozhan')) {
                                    if (observe &amp;&amp; !player.identityShown) {
                                        player.setIdentity('cai');
                                        player.forceShown = false;
                                    }
                                }
                            }
                            player.update();
                        }
                        game.arrangePlayers();
                        ui.create.me(true);

                        _status.event = {
                            finished: true,
                            next: [],
                            after: []
                        };
                        _status.paused = false;
                        _status.dying = get.parsedResult(state.dying) || [];

                        if (game.updateState) {
                            game.updateState(state2);
                        }
                        var next = game.createEvent('game', false);
                        next.setContent(lib.init.startOnline);
                        if (observe) {
                            next.custom.replace.target = function (player) {
                                if (!lib.configOL.observe_handcard &amp;&amp; lib.configOL.mode == 'guozhan') {
                                    return;
                                }
                                if (player.isAlive()) {
                                    if (!game.me.identityShown &amp;&amp; lib.configOL.mode == 'guozhan') {
                                        game.me.node.identity.firstChild.innerHTML = '';
                                        game.me.node.identity.dataset.color = 'unknown';
                                    }
                                    game.swapPlayer(player);
                                    if (!game.me.identityShown &amp;&amp; lib.configOL.mode == 'guozhan') {
                                        game.me.node.identity.firstChild.innerHTML = '';
                                    }
                                }
                            }
                        }
                        else {
                            if (Array.isArray(onreconnect)) {
                                onreconnect.shift().apply(this, onreconnect);
                            }
                        }
                        game.loop();
                        game.send('reinited');
                        game.showHistory();
                        _status.gameStarted = true;
                        if (lib.config.show_cardpile) {
                            ui.cardPileButton.style.display = '';
                        }
                        if (!observe &amp;&amp; game.me &amp;&amp; (game.me.isDead() || _status.over)) {
                            ui.create.exit();
                        }
                        ui.updatehl();
                        ui.create.connecting(true);
                    });
                },
                exec: function (func) {
                    var key = game.onlineKey;
                    if (typeof func == 'function') {
                        var args = Array.from(arguments);
                        args.shift();
                        func.apply(this, args);
                    }
                    if (key) {
                        game.onlineKey = key;
                        localStorage.setItem(lib.configprefix + 'key', game.onlineKey);
                    }
                },
                denied: function (reason) {
                    switch (reason) {
                        case 'version':
                            alert('');
                            game.saveConfig('tmp_owner_roomId');
                            game.saveConfig('tmp_user_roomId');
                            game.saveConfig('reconnect_info');
                            break;
                        case 'gaming': alert(''); break;
                        case 'number': alert(''); break;
                        case 'banned': alert(''); break;
                        case 'key':
                            alert('');
                            game.saveConfig('tmp_owner_roomId');
                            game.saveConfig('tmp_user_roomId');
                            game.saveConfig('reconnect_info');
                            break;
                        case 'offline':
                            if (_status.paused &amp;&amp; _status.event.name == 'game') {
                                setTimeout(game.resume, 500);
                            }
                            break;
                    }
                    game.ws.close();
                    if (_status.connectDenied) {
                        _status.connectDenied();
                    }
                },
                cancel: function (id) {
                    if (_status.event.id == id &amp;&amp; _status.event.isMine() &amp;&amp; _status.paused &amp;&amp; _status.imchoosing) {
                        ui.click.cancel();
                        if (ui.confirm) {
                            ui.confirm.close();
                        }
                        if (_status.event.result) {
                            _status.event.result.id = id;
                        }
                    }
                },
                closeDialog: function (id) {
                    var dialog = get.idDialog(id);
                    if (dialog) {
                        dialog.close();
                    }
                },
                createDialog: function (id) {
                    var args = Array.from(arguments);
                    args.shift();
                    ui.create.dialog.apply(this, args).videoId = id;
                },
                gameStart: function () {
                    for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                        game.connectPlayers[i].delete();
                    }
                    delete game.connectPlayers;
                    if (ui.connectStartButton) {
                        ui.connectStartButton.delete();
                        delete ui.connectStartButton;
                    }
                    if (ui.connectStartBar) {
                        ui.connectStartBar.delete();
                        delete ui.connectStartBar;
                    }
                    if (ui.roomInfo) {
                        ui.roomInfo.remove();
                        delete ui.roomInfo;
                    }
                    if (ui.exitroom) {
                        ui.exitroom.remove();
                        delete ui.exitroom;
                    }
                    ui.auto.show();
                    ui.pause.show();
                    if (lib.config.show_cardpile) {
                        ui.cardPileButton.style.display = '';
                    }
                    _status.gameStarted = true;
                    game.showHistory();
                },
                updateWaiting: function (map) {
                    if (!game.connectPlayers) return;
                    if (!lib.translate.zhu) {
                        lib.translate.zhu = '';
                    }
                    game.onlinezhu = false;
                    _status.waitingForPlayer = true;
                    for (var i = 0; i &lt; map.length; i++) {
                        if (map[i] == 'disabled') {
                            game.connectPlayers[i].classList.add('unselectable2');
                        }
                        else {
                            game.connectPlayers[i].classList.remove('unselectable2');
                            if (map[i]) {
                                game.connectPlayers[i].initOL(map[i][0], map[i][1]);
                                game.connectPlayers[i].playerid = map[i][2];
                                if (map[i][3] == 'zhu') {
                                    game.connectPlayers[i].setIdentity('zhu');
                                    if (map[i][2] == game.onlineID) {
                                        game.onlinezhu = true;
                                        if (ui.roomInfo) {
                                            ui.roomInfo.innerHTML = '';
                                        }
                                        if (ui.connectStartButton) {
                                            ui.connectStartButton.innerHTML = '';
                                        }
                                    }
                                }
                                else {
                                    game.connectPlayers[i].node.identity.firstChild.innerHTML = '';
                                }
                            }
                            else {
                                game.connectPlayers[i].uninitOL();
                                delete game.connectPlayers[i].playerid;
                            }
                        }
                    }
                }
            }
        },
        /**
         * 
         * @type {('red'|'black'|'none')}
         */
        color: ['red', 'black', 'none'],
        /**
         * 
         * @type {('club'|'spade'|'diamond'|'heart')}
         */
        suit: ['club', 'spade', 'diamond', 'heart'],
        /**
         * 
         * @type {('A'|'2'|'3'|'4'|'5'|'6'|'7'|'8'|'9'|'X'|'J'|'Q'|'K')}
         */
        number: ['A', '2', '3', '4', '5', '6', '7', '8', '9', 'X', 'J', 'Q', 'K'],
        /**
         * 
         * |string|Group Name|
         * |:----:|:--------:|
         * |vtuber||
         * |clubs||
         * |wei||
         * |shu||
         * |wu||
         * |qun||
         * |jin||
         * |shen||
         * |holo|Hololive|
         * |nijisanji||
         * |dotlive||
         * |upd8|U|
         * |eilene||
         * |paryi||
         * |kagura||
         * |nori||
         * |vwp||
         * |nanashi|774 inc.|
         * |VirtuaReal|VirtuaReal|
         * |psp|psplive|
         * |asoul|A-SOUL|
         * |chaos|Chaos Live|
         * |xuefeng||
         * |vshojo|Vshojo|
         * @type {string}
         */
        group: [
            'vtuber', 'clubs',
            'wei', 'shu', 'wu', 'qun', 'jin', 'shen',
            'holo', 'nijisanji', 'dotlive', 'upd8', 'eilene', 'paryi', 'kagura', 'nori', 'vwp', 'nanashi',
            'VirtuaReal', 'psp', 'asoul', 'xuyan', 'chaos', 'xuefeng', 'hunmiao', 'ego', 'chidori', 'lucca',
            'vshojo'
        ],
        /**
         * shen
         * group
         * @type {string}
         */
        group2: ['qun', 'holo', 'nijisanji', 'VirtuaReal', 'nori', 'paryi', 'upd8', 'kagura', 'nanashi', 'psp', 'asoul', 'vwp', 'xuyan', 'chaos', 'xuefeng'],
        /**
         * 
         * @type {('fire'|'thunder'|'poison'|'ocean'|'ice'|'kami'|'yami')}
         */
        nature: ['fire', 'thunder', 'poison', 'ocean', 'ice', 'kami', 'yami'],
        /**
         *  - TODO
         * @type {string}
         */
        linked: ['fire', 'thunder', 'ocean', 'ice', 'kami', 'yami'],
        /**
         * 
         * @constant
         */
        groupnature: {
            shen: 'thunder',
            wei: 'water',
            shu: 'soil',
            wu: 'wood',
            qun: 'metal',
            western: 'thunder',
            key: 'key',
            jin: 'thunder',
            ye: 'thunder',
            holo: 'soil',
            upd8: 'metal',
            dotlive: 'wood',
            nijisanji: 'water',
            VirtuaReal: 'ocean',
            HappyElements: 'ocean',
            eilene: 'thunder',
            paryi: 'ice',
            kagura: 'ocean',
            nanashi: 'wood',
            psp: 'fire',
            asoul: 'fire',
            nori: 'key',
            vwp: 'key',
            vshojo: 'metal',
            xuyan: 'ice',
            chaos: 'ocean',
            xuefeng: 'ocean',
            hunmiao: 'ocean',
            ego: 'ocean',
            chidori: 'wood',
            lucca: 'wood',

            vtuber: 'metal',
            clubs: 'ice',
        },
        /**
         * 
         * 
         * @type {string}
         */
        phaseName: ['phaseZhunbei', 'phaseJudge', 'phaseDraw', 'phaseUse', 'phaseDiscard', 'phaseJieshu'],
        /**
         *  - TODO
         * @type {string}
         */
        quickVoice: [
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
            '',
        ],

    };
    /**
     * 
     * {@link game.loop}
     * @namespace
     * @global
     */
    var game = /**@lends game */ {
        /**
         * __
         * @param {!object} event dialog
         * @param {!Player} target 
         * @param {boolean} [directh] 'blank'directhtrue
         * @param {?string} [type] 'canBeDiscarded' | 'canBeGained'
         * @param {?function} [callback] 
         */
        showPlayerCard: function(event,target,directh,type,callback) {
            if (!event.dialog) return;
            let player = event.player || _status.event.player, position = event.position || 'h';
            for (let i = 0; i &lt; event.position.length; i++) {
                if (event.position[i] == 'h') {
                    let ms = target.getCards('h', function (card) {
                        if (type &amp;&amp; !lib.filter[type](card, player, target)) return false;
                        if (target.isUnderControl(true)) return true;
                        if (card.hasGaintag('an_')) return false;
                        if (event.visible || player.hasSkillTag('viewHandcard', null, target, true)) {
                            return true;
                        }
                        return card.hasGaintag('ming_');
                    });
                    if (ms.length > 0) {
                        event.dialog.addText('');
                        ms.randomSort();
                        event.dialog.add(ms);
                        directh = false;
                    }
                    let ans = target.getCards('h', function (card) {
                        if (type &amp;&amp; !lib.filter[type](card, player, target)) return false;
                        if (ms.contains(card)) return false;
                        return true;
                    });
                    if (ans.length > 0) {
                        event.dialog.addText((ms.length?'':''));
                        ans.randomSort();
                        event.dialog.add([ans, 'blank']);
                    }
                }
                else if (event.position[i] == 'e') {
                    let es = target.getCards('e', function (card) {
                        if (type &amp;&amp; !lib.filter[type](card, player, target)) return false;
                        return true;
                    });
                    if (es.length) {
                        event.dialog.addText('');
                        event.dialog.add(es);
                        directh = false;
                    }
                }
                else if (event.position[i] == 'j') {
                    let js = target.getCards('j', function (card) {
                        if (type &amp;&amp; !lib.filter[type](card, player, target)) return false;
                        return true;
                    });
                    if (js.length) {
                        event.dialog.addText('');
                        event.dialog.add(js);
                        directh = false;
                    }
                }
            }
            callback &amp;&amp; callback(event);
            return directh;
        },
        //galgame
        galgameMod: function () {
            var galgame = { text: {}, game: game };
            var gal0 = function () {
                /**
                * @description :
                * @author  date 2021/2/12
                */
                galgame.sce = function (shijian) {
                    var game = galgame.game;
                    var next = game.createEvent('sce', false);
                    next.shijian = shijian;
                    next.setContent(galgame.sces);
                    return next;
                }
                galgame.backgroundMusic = document.createElement("audio");
                galgame.backgroundMusic.addEventListener("ended", function () {
                    galgame.backgroundMusic.currentTime = 0;
                    galgame.backgroundMusic.play();
                });
                galgame.audio = document.createElement("audio");
                galgame.end = function () {
                    var game = galgame.game;
                    galgame.audio.pause();
                    galgame.backgroundMusic.pause();
                    game.resume();
                }
                galgame.cg = function (src, callback) {
                    var cg = document.createElement("video");
                    cg.setAttribute("width", "100%");
                    cg.setAttribute("height", "100%");
                    cg.setAttribute("src", src);
                    cg.setAttribute("autoplay", "autoplay");
                    cg.addEventListener("ended", callback);
                    cg.addEventListener("loadedmetadata", function () {
                        this.onclick = function () {
                            this.play();
                            this.currentTime = this.duration;
                        }
                    });
                    return cg;
                }
                galgame.sces = function () {
                    var game = galgame.game;
                    var color = {};
                    var beijing = ui.create.div('.scedi', ui.window);
                    var booth = {};
                    booth.node = ui.create.div(".scetu", beijing);
                    var node = ui.create.div('.sce', beijing);
                    var drive = ui.create.div('.drive', beijing);
                    var tou = ui.create.div('.tou', node);
                    var txt = ui.create.div('.txt', node);
                    var right = ui.create.div(node);
                    var name = ui.create.div('.name', tou);
                    var name2 = ui.create.div('.name', right);
                    var num = 0,
                        i = 0;
                    var bofang = function () {
                        if (!galgame.text[event.shijian]) return;
                        console.log(galgame.text[event.shijian],num)
                        var arr = galgame.text[event.shijian][num].split(':');
                        if (arr[0] == "background") {
                            if (arr[1] == "none") {
                                beijing.style.backgroundImage = "";
                            } else {
                                beijing.setBackgroundImage('galgame/' + arr[1]);
                            }
                            num++;
                            bofang();
                            return;
                        } else if (arr[0] == "booth") {
                            if (arr[6] || (arr[1] == "none" &amp;&amp; arr[2])) {
                                if (!booth[arr[6]]) {
                                    booth[arr[6]] = ui.create.div(".scetu", beijing);
                                }
                                if (arr[1] == "none") {
                                    booth[arr[2]].hide();
                                } else {
                                    if (booth[arr[6]].classList.contains("hidden")) booth.show();
                                    booth[arr[6]].style.width = parseInt(arr[2]) + "px";
                                    booth[arr[6]].style.height = parseInt(arr[3]) + "px";
                                    booth[arr[6]].style.left = parseInt(arr[4]) + "%";
                                    booth[arr[6]].style.top = parseInt(arr[5]) + "%";
                                    booth[arr[6]].setBackgroundImage('extension/' + arr[1]);
                                }
                            } else {
                                if (arr[1] == "none") {
                                    booth.node.hide();
                                } else {
                                    if (booth.node.classList.contains("hidden")) booth.show();
                                    booth.node.style.width = parseInt(arr[2]) + "px";
                                    booth.node.style.height = parseInt(arr[3]) + "px";
                                    booth.node.style.left = parseInt(arr[4]) + "%";
                                    booth.node.style.top = parseInt(arr[5]) + "%";
                                    booth.node.setBackgroundImage('extension/' + arr[1]);
                                }
                            }
                            num++;
                            bofang();
                            return;
                        } else if (arr[0] == "color") {
                            if (arr[1] == "text") {
                                node.style.backgroundColor = arr[2];
                            }
                            if (arr[1] == "choose") {
                                if (arr[3]) {
                                    color[arr[3]] = arr[2];
                                } else {
                                    color.every = arr[2];
                                }
                            }
                            num++;
                            bofang();
                            return;
                        } else if (arr[0] == "music") {
                            ui.backgroundMusic.pause();
                            galgame.backgroundMusic.src = lib.assetURL + "galgame/" + arr[1];
                            galgame.backgroundMusic.play();
                            num++;
                            bofang();
                            return;
                        } else if (arr[0] == "audio") {
                            galgame.audio.src = lib.assetURL + "galgame/" + arr[1];
                            galgame.audio.play();
                            num++;
                            bofang();
                            return;
                        } else if (arr[0] == "cg") {
                            ui.backgroundMusic.pause();
                            galgame.backgroundMusic.pause();
                            var di = ui.create.div('.cg');
                            var cg = galgame.cg(lib.assetURL + "galgame/" + arr[1], function () {
                                beijing.removeChild(di);
                                ui.backgroundMusic.play();
                                bofang();
                            });
                            di.appendChild(cg);
                            beijing.appendChild(di);
                            num++;
                            return;
                        } else if (arr[0] == "choose") {
                            var choose = ui.create.div('.choose', beijing);
                            for (var j = 1; j &lt; arr.length; j++) {
                                var sele = ui.create.div('.sele', choose);
                                sele.onclick = function () {
                                    _status.event.result = {
                                        bool: this.innerText,
                                    }
                                    ui.window.removeChild(beijing);
                                    ui.backgroundMusic.play();
                                    galgame.end();
                                };
                                sele.innerHTML = arr[j];
                                if (color.every) sele.style.backgroundColor = color.every;
                                if (color[j]) sele.style.backgroundColor = color[j];
                            }
                            return;
                        } else if (arr[0] == "right") {
                            if (arr[1] != "none") {
                                if (!right.classList.contains("galright")) {
                                    right.classList.add("galright");
                                }
                                if (!txt.classList.contains("txt2")) {
                                    txt.classList.add("txt2");
                                }
                                right.setBackgroundImage('galgame/' + arr[1]);
                                if (arr[2] == "none") {
                                    name2.innerHTML = "";
                                } else {
                                    name2.innerHTML = arr[2];
                                }
                                if (arr[3]) {
                                    if (arr[3] == "left") {
                                        if (!tou.classList.contains("yingyin")) {
                                            tou.classList.add("yingyin");
                                        }
                                        if (right.classList.contains("yingyin")) {
                                            right.classList.remove("yingyin");
                                        }
                                    }
                                    if (arr[3] == "right") {
                                        if (tou.classList.contains("yingyin")) {
                                            tou.classList.remove("yingyin");
                                        }
                                        if (!right.classList.contains("yingyin")) {
                                            right.classList.add("yingyin");
                                        }
                                    }
                                } else {
                                    if (tou.classList.contains("yingyin")) {
                                        tou.classList.remove("yingyin");
                                    }
                                    if (right.classList.contains("yingyin")) {
                                        right.classList.remove("yingyin");
                                    }
                                }
                            } else {
                                right.classList.remove("galright");
                                txt.classList.remove("txt2");
                                if (tou.classList.contains("yingyin")) {
                                    tou.remove("yingyin");
                                }
                                if (right.classList.contains("yingyin")) {
                                    right.remove("yingyin");
                                }
                                name2.innerHTML = "";
                            }
                            num++;
                            bofang();
                            return;
                        }
                        tou.show();
                        if (arr[0] == "none") {
                            tou.hide();
                        } else if (arr[0] == "sp") {
                            tou.setBackgroundImage("galgame/" + arr[3]);
                            name.innerHTML = arr[2];
                        } else {
                            tou.setBackground(arr[0], "character");
                            name.innerHTML = get.rawName([arr[0]]);
                        }
                        function skip0(e) {
                            if (e.ctrlKey) {
                                window.status = 'skip';
                            }
                        }
                        function skip1(e) {
                            if (e.keyCode=='17') {
                                window.status = '';
                            }
                        }
                        var skipfun0 = function(e){
                            skip0(e);
                        }
                        var skipfun1 = function(e){
                            skip1(e);
                        }
                        var link = arr[1].replace(/@/g, lib.config.connect_nickname);
                        var show = function () {
                            if (link[i] == "&lt;") {
                                for (var j = i; j &lt; link.length; j++) {
                                    if (link[j] == ">") {
                                        if (link[j + 1] &amp;&amp; link[j + 1] == "&lt;") {
                                            continue;
                                        }
                                        i = j + 1;
                                        break;
                                    }
                                }
                            }
                            var str = link.substr(0, i);
                            txt.innerHTML = str;
                            i++;
                            if (i &lt;= link.length) {
                                window.addEventListener('keydown',skipfun0);
                                window.addEventListener('keyup',skipfun1);
                                if (window.status == 'skip') {
                                    setTimeout(show, 200);
                                }
                                else {
                                    let t = setTimeout(show, 1000);
                                    drive.onclick = function () {
                                        clearTimeout(t);
                                        show();
                                    }
                                }
                            } else {
                                if (num &lt; galgame.text[event.shijian].length) {
                                    if (window.status == 'skip') {
                                        i = 0;
                                        galgame.audio.pause();
                                        bofang();
                                        window.status = '';
                                    }
                                    drive.onclick = function () {
                                        this.onclick = false;
                                        i = 0;
                                        galgame.audio.pause();
                                        bofang();
                                    }
                                } else {
                                    window.removeEventListener('keydown',skipfun0);
                                    window.removeEventListener('keyup',skipfun1);
                                    if (window.status == 'skip') {
                                        ui.backgroundMusic.play();
                                        ui.window.removeChild(beijing);
                                        galgame.end();
                                        window.status = '';
                                    }
                                    drive.onclick = function () {
                                        ui.backgroundMusic.play();
                                        ui.window.removeChild(beijing);
                                        galgame.end();
                                    }
                                }
                            }
                        }
                        show();
                        num++;
                    }
                    bofang();
                    game.pause();
                }
            }();
            lib.init.json(lib.assetURL + 'galgame/galgame.json', function (text) {
                for (var i in text) {
                    galgame.text[i] = text[i];
                }
                lib.init.css(lib.assetURL + 'galgame', 'galgame');
            });

            game.galgame = galgame;
        },
        loseAsync: function (arg) {
            var next = game.createEvent('loseAsync');
            next.getl = function (player) {
                var that = this;
                var map = {
                    player: player,
                    hs: [],
                    es: [],
                    js: [],
                    ss: [],
                    cards: [],
                    cards2: [],
                };
                player.getHistory('lose', function (evt) {
                    if (evt.parent == that) {
                        map.hs.addArray(evt.hs);
                        map.es.addArray(evt.es);
                        map.js.addArray(evt.js);
                        map.ss.addArray(evt.ss);
                        map.cards.addArray(evt.cards);
                        map.cards2.addArray(evt.cards2);
                    }
                });
                if (map.cards.length > 0 || map.ss.length > 0) return map;
            };
            if (arg &amp;&amp; get.is.object(arg)) {
                for (var i in arg) next[i] = arg[i];
            }
            return next;
        },
        //
        getRarity: function (name) {
            var rank = lib.rank.rarity;
            if (rank.beginner.contains(name)) return 'beginner';
            if (rank.legend.contains(name)) return 'legend';
            if (rank.epic.contains(name)) return 'epic';
            if (rank.rare.contains(name)) return 'rare';
            if (get.mode() != 'chess' &amp;&amp; rank.junk.contains(name)) return 'junk';
            return 'common';
        },
        getGlobalHistory: function (key, filter) {
            if (!key) return _status.globalHistory[_status.globalHistory.length - 1];
            if (!filter) return _status.globalHistory[_status.globalHistory.length - 1][key];
            else {
                var history = game.getGlobalHistory(key).slice(0);
                for (var i = 0; i &lt; history.length; i++) {
                    if (!filter(history[i])) history.splice(i--, 1);
                }
                return history;
            }
        },
        cardsDiscard: function (cards) {
            var type = get.itemtype(cards);
            if (type != 'cards' &amp;&amp; type != 'card') return;
            var next = game.createEvent('cardsDiscard');
            next.cards = type == 'cards' ? cards.slice(0) : [cards];
            next.setContent('cardsDiscard');
            return next;
        },
        cardsGotoOrdering: function (cards) {
            var type = get.itemtype(cards);
            if (type != 'cards' &amp;&amp; type != 'card') return;
            var next = game.createEvent('cardsGotoOrdering');
            next.cards = type == 'cards' ? cards.slice(0) : [cards];
            next.setContent('cardsGotoOrdering');
            return next;
        },
        cardsGotoSpecial: function (cards, bool) {
            var type = get.itemtype(cards);
            if (type != 'cards' &amp;&amp; type != 'card') return;
            var next = game.createEvent('cardsGotoSpecial');
            next.cards = type == 'cards' ? cards.slice(0) : [cards];
            if (bool === false) next.notrigger = true;
            next.setContent('cardsGotoSpecial');
            return next;
        },
        online: false,
        onlineID: null,
        onlineKey: null,
        showHistory: function (pause) {
            if (lib.config.show_history == 'left') {
                ui.window.classList.add('leftbar');
            }
            else if (lib.config.show_history == 'right') {
                ui.window.classList.add('rightbar');
            }
            if (pause != false &amp;&amp; ui.pause) {
                ui.pause.show();
            }
        },
        createBackground: function (src, blur) {
            var current = document.body.querySelector('.background.upper');
            if (current) {
                current.delete();
            }
            var node = ui.create.div('.background.blurbg', document.body);
            node.setBackgroundImage(src);
            node.style.backgroundSize = 'cover';
            if (blur) {
                node.classList.add('paused')
            }
            return node;
        },
        changeLand: function (url, player) {
            game.addVideo('changeLand', player, url);
            if (url.indexOf('/') === -1) {
                url = 'image/card/' + url;
            }
            if (url.indexOf('.png') == -1 &amp;&amp; url.indexOf('.jpg') == -1) {
                url += '.jpg';
            }
            var name = url.slice(url.lastIndexOf('/') + 1, url.lastIndexOf('.'));
            var skill = name + '_skill';
            var node = ui.create.div('.background.upper.land');
            node.setBackgroundImage(url);
            node.destroy = function () {
                if (this.skill) {
                    game.removeGlobalSkill(this.skill);
                    if (this.system) {
                        this.system.remove();
                    }
                }
                this.classList.add('hidden');
                var node = this;
                setTimeout(function () {
                    node.remove();
                }, 3000);
                if (ui.land == this) {
                    ui.land = null;
                }
            }
            if (ui.land) {
                document.body.insertBefore(node, ui.land);
                ui.land.destroy();
            }
            else {
                node.classList.add('hidden');
                document.body.insertBefore(node, ui.window);
                ui.refresh(node);
                node.classList.remove('hidden');
            }
            ui.land = node;
            if (name) {
                node.name = name;
                node.skill = skill;
                if (player) {
                    node.player = player;
                    player.addTempSkill('land_used');
                }
                node.system = ui.create.system(lib.translate[skill], null, true, true);
                lib.setPopped(node.system, function () {
                    var uiintro = ui.create.dialog('hidden');
                    var str = '';
                    if (player) {
                        str = '' + get.translation(player);
                    }
                    var caption = uiintro.addText(str);
                    caption.style.margin = '0';
                    uiintro._place_text = uiintro.add('&lt;div class="text">' + lib.translate[skill + '_info'] + '&lt;/div>');
                    uiintro.add(ui.create.div('.placeholder.slim'));
                    return uiintro;
                }, 200);
                game.addGlobalSkill(skill);
            }
        },
        checkFileList: function (updates, proceed) {
            var n = updates.length;
            if (!n) {
                proceed(n);
            }
            for (var i = 0; i &lt; updates.length; i++) {
                if (lib.node &amp;&amp; lib.node.fs) {
                    lib.node.fs.access(__dirname + '/' + updates[i], (function (entry) {
                        return function (err) {
                            if (!err) {
                                var stat = lib.node.fs.statSync(__dirname + '/' + entry);
                                if (stat.size == 0) {
                                    err = true;
                                }
                            }
                            if (err) {
                                n--;
                                if (n == 0) {
                                    proceed();
                                }
                            }
                            else {
                                n--;
                                updates.remove(entry);
                                if (n == 0) {
                                    proceed();
                                }
                            }
                        }
                    }(updates[i])));
                }
                else {
                    resolveLocalFileSystemURL(lib.assetURL + updates[i], (function (name) {
                        return function (entry) {
                            n--;
                            updates.remove(name);
                            if (n == 0) {
                                proceed();
                            }
                        }
                    }(updates[i])), function () {
                        n--;
                        if (n == 0) {
                            proceed();
                        }
                    });
                }
            }
        },
        replaceHandcards: function () {
            var next = game.createEvent('replaceHandcards');
            if (Array.isArray(arguments[0])) {
                next.players = arguments[0];
            }
            else {
                next.players = [];
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (get.itemtype(arguments[i]) == 'player') {
                        next.players.push(arguments[i]);
                    }
                }
            }
            if (_status.connectMode) {
                next.setContent('replaceHandcardsOL');
            }
            else {
                next.setContent('replaceHandcards');
            }
        },
        removeCard: function (name) {
            for (var i = 0; i &lt; lib.card.list.length; i++) {
                if (lib.card.list[i][2] == name) {
                    lib.card.list.splice(i--, 1);
                }
            }
            var list = [];
            for (var i = 0; i &lt; ui.cardPile.childElementCount; i++) {
                if (ui.cardPile.childNodes[i].name == name) {
                    list.push(ui.cardPile.childNodes[i]);
                }
            }
            for (var i = 0; i &lt; list.length; i++) {
                list[i].remove();
            }
        },
        randomMapOL: function (type) {
            if (type == 'hidden') {
                ui.arena.classList.add('playerhidden');
            }
            game.prepareArena();
            if (window.isNonameServer) {
                game.me = ui.create.player();
            }
            var list = [];
            for (var i = 0; i &lt; game.players.length; i++) {
                if (game.players[i] != game.me) {
                    list.push(game.players[i]);
                }
            }
            var map = [];
            for (var i = 0; i &lt; lib.node.clients.length; i++) {
                if (!list.length) break;
                if (lib.configOL.observe_race) var current = list.shift();
                else var current = list.randomRemove();
                current.ws = lib.node.clients[i];
                current.playerid = current.ws.id;
                current.nickname = current.ws.nickname;
                current.setNickname();
            }
            if (!window.isNonameServer) {
                game.me.playerid = get.id();
                game.me.nickname = get.connectNickname();
                game.me.setNickname();
            }
            for (var i = 0; i &lt; game.players.length; i++) {
                if (!game.players[i].playerid) {
                    game.players[i].playerid = get.id();
                }
                map.push([game.players[i].playerid, game.players[i].nickname]);
                lib.playerOL[game.players[i].playerid] = game.players[i];
            }
            game.broadcast(function (map, config, hidden) {
                if (hidden) {
                    ui.arena.classList.add('playerhidden');
                }
                lib.configOL = config;
                ui.create.players();
                ui.create.me();
                game.me.playerid = game.onlineID;
                game.me.nickname = get.connectNickname();
                for (var i = 0; i &lt; map.length; i++) {
                    if (map[i][0] == game.me.playerid) {
                        map = map.concat(map.splice(0, i));
                        break;
                    }
                }
                for (var i = 0; i &lt; game.players.length; i++) {
                    game.players[i].playerid = map[i][0];
                    game.players[i].nickname = map[i][1];
                    game.players[i].setNickname();
                    lib.playerOL[game.players[i].playerid] = game.players[i];
                }
                _status.mode = lib.configOL[lib.configOL.mode + '_mode'];
            }, map, lib.configOL, type == 'hidden');
            _status.mode = lib.configOL[lib.configOL.mode + '_mode'];
            game.chooseCharacterOL();
        },
        closeMenu: function () {
            if (ui.menuContainer &amp;&amp; !ui.menuContainer.classList.contains('hidden')) {
                ui.click.configMenu();
            }
        },
        closeConnectMenu: function () {
            if (ui.connectMenuContainer &amp;&amp; !ui.connectMenuContainer.classList.contains('hidden')) {
                ui.click.connectMenu();
            }
        },
        closePopped: function () {
            if (ui.currentpopped) {
                if (ui.currentpopped._uiintro) {
                    ui.currentpopped._uiintro.delete();
                    delete ui.currentpopped._uiintro;
                }
                delete ui.currentpopped;
            }
        },
        broadcast: function () {
            if (!lib.node || !lib.node.clients || game.online) return;
            for (var i = 0; i &lt; lib.node.clients.length; i++) {
                if (lib.node.clients[i].inited) {
                    lib.node.clients[i].send.apply(lib.node.clients[i], arguments);
                }
            }
        },
        broadcastAll: function () {
            if (game.online) return;
            var argc = arguments.length;
            var args = new Array(argc);
            for (var i = 0; i &lt; argc; i++) {
                args[i] = arguments[i];
            }
            game.broadcast.apply(this, args);
            var func = args.shift();
            if (typeof func == 'string') {
                func = lib.message.client[func];
            }
            if (typeof func == 'function') {
                func.apply(this, args);
            }
        },
        syncState: function () {
            var state = null;
            if (game.getState) {
                state = game.getState();
            }
            game.broadcast(function (state, current, number) {
                if (game.updateState &amp;&amp; state) game.updateState(state);
                _status.currentPhase = current;
                game.phaseNumber = number;
            }, state, _status.currentPhase, game.phaseNumber);
        },
        updateWaiting: function () {
            var map = [];
            for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                var player = game.connectPlayers[i];
                if (player.playerid) {
                    if (!game.onlinezhu) {
                        game.onlinezhu = player.playerid;
                        game.send('server', 'changeAvatar', player.nickname, player.avatar);
                        _status.onlinenickname = player.nickname;
                        _status.onlineavatar = player.avatar;
                    }
                    map[i] = [player.nickname, player.avatar, player.playerid];
                    if (player.playerid == game.onlinezhu) {
                        map[i].push('zhu');
                    }
                }
                else if (player.classList.contains('unselectable2')) {
                    map[i] = 'disabled';
                }
                else {
                    map[i] = null;
                }
            }
            game.broadcast('updateWaiting', map);
        },
        waitForPlayer: function (func) {
            var next = game.createEvent('waitForPlayer', false);
            next.func = func;
            next.setContent('waitForPlayer');
        },
        countDown: function (time, onEnd) {
            time = parseInt(time);
            if (!time) return;
            if (time &lt;= 0) return;
            var current = time;
            ui.timer.set(current, 1);
            _status.countDown = setInterval(function () {
                if (--current) {
                    ui.timer.set(current, current / time);
                }
                else {
                    ui.timer.set(0, 0);
                    clearInterval(_status.countDown);
                    delete _status.countDown;
                    if (onEnd) onEnd();
                }
            }, 1000);
        },
        countChoose: function (clear) {
            if (_status.imchoosing) {
                return;
            }
            _status.imchoosing = true;
            if (_status.connectMode &amp;&amp; !_status.countDown) {
                ui.timer.show();
                var num;
                //
                if (_status.event &amp;&amp; _status.event.name == 'chooseToUse' &amp;&amp; _status.event.type == 'phase' &amp;&amp;
                    _status.event.player &amp;&amp; _status.event.player.forceCountChoose &amp;&amp;
                    typeof _status.event.player.forceCountChoose.phaseUse == 'number') {
                    num = _status.event.player.forceCountChoose.phaseUse;
                }
                else if (_status.connectMode) {
                    num = lib.configOL.choose_timeout;
                    if (ui.arena &amp;&amp; ui.arena.classList.contains('choose-character') &amp;&amp; lib.configOL.chooseCharacter_timeout) {
                        num = parseInt(num) * 5;
                    }
                }
                else {
                    num = get.config('choose_timeout');
                }
                game.countDown(parseInt(num), function () {
                    ui.click.auto();
                    ui.timer.hide();
                });
                if (!game.online &amp;&amp; game.me) {
                    if (_status.event.getParent().skillHidden) {
                        for (var i = 0; i &lt; game.players.length; i++) {
                            game.players[i].showTimer();
                        }
                        game.me._hide_all_timer = true;
                    }
                    else if (!_status.event._global_waiting) {
                        game.me.showTimer();
                    }
                }
            }
            else if (_status.event.player.forceCountChoose &amp;&amp; _status.event.isMine() &amp;&amp; !_status.countDown) {
                var info = _status.event.player.forceCountChoose;
                var num;
                if (_status.event.name == 'chooseToUse' &amp;&amp; _status.event.type == 'phase' &amp;&amp; typeof info.phaseUse == 'number') {
                    num = info.phaseUse;
                }
                else if (typeof info[_status.event.name] == 'number') {
                    num = info[_status.event.name]
                }
                else if (info.default) {
                    num = info.default;
                }
                else return;
                var finish = function () {
                    if (_status.event.endButton) {
                        if (_status.event.skill) {
                            ui.click.cancel();
                        }
                        ui.click.cancel();
                    }
                    else {
                        if (ui.confirm &amp;&amp; ui.confirm.str) {
                            if (ui.confirm.str.indexOf('c') != -1) {
                                ui.click.cancel();
                            }
                            else if (ui.confirm.str.indexOf('o') != -1) {
                                ui.click.ok();
                            }
                        }
                        else if (['chooseControl', 'chooseBool'].contains(_status.event.name) &amp;&amp; _status.paused) {
                            _status.event.result = 'ai';
                            game.resume();
                        }
                        else {
                            ui.click.auto('forced');
                            setTimeout(function () {
                                ui.click.auto('forced');
                            }, 200);
                        }
                    }
                    ui.timer.hide();
                };
                if (!num) {
                    ui.timer.hide();
                    game.uncheck();
                    setTimeout(finish, 200);
                }
                else {
                    ui.timer.show();
                    game.countDown(num, finish);
                }
            }
        },
        stopCountChoose: function () {
            if (_status.countDown) {
                clearInterval(_status.countDown);
                delete _status.countDown;
                ui.timer.hide();
            }
            if (_status.connectMode &amp;&amp; !game.online &amp;&amp; game.me) {
                if (game.me._hide_all_timer) {
                    delete game.me._hide_all_timer;
                    for (var i = 0; i &lt; game.players.length; i++) {
                        game.players[i].hideTimer();
                    }
                }
                else if (!_status.event._global_waiting) {
                    game.me.hideTimer();
                }
            }
        },
        connect: function (ip, callback) {
            if (game.online) return;
            var withport = false;
            var index = ip.lastIndexOf(':');
            if (index != -1) {
                index = parseFloat(ip.slice(index + 1));
                if (index &amp;&amp; Math.floor(index) == index) {
                    withport = true;
                }
            }
            if (!withport) {
                //ip=ip+':8080';
                if ('https:' != document.location.protocol)
                    ip = ip + ':8080';
            }
            _status.connectCallback = callback;
            try {
                if (game.ws) {
                    game.ws._nocallback = true;
                    game.ws.close();
                    delete game.ws;
                }
                var ishttps = 'https:' == document.location.protocol ? true : false;
                if (ishttps) {
                    //alert("https");
                    game.ws = new WebSocket('wss://' + ip + '/wss/');
                } else {
                    //alert("http");
                    game.ws = new WebSocket('ws://' + ip + '');
                }
                //game.ws=new WebSocket('ws://'+ip+'');
            }
            catch (e) {
                alert('');
                if (callback) {
                    callback(false);
                }
                return;
            }
            game.ws.onopen = lib.element.ws.onopen;
            game.ws.onmessage = lib.element.ws.onmessage;
            game.ws.onerror = lib.element.ws.onerror;
            game.ws.onclose = lib.element.ws.onclose;
            _status.ip = ip;
        },
        send: function () {
            if (game.observe &amp;&amp; arguments[0] != 'reinited') return;
            if (game.ws) {
                var args = Array.from(arguments);
                if (typeof args[0] == 'function') {
                    args.unshift('exec');
                }
                game.ws.send(JSON.stringify(get.stringifiedResult(args)));
            }
        },
        sendTo: function (id, message) {
            var ws = { wsid: id };
            for (var i in lib.element.nodews) {
                ws[i] = lib.element.nodews[i];
            }
            var client = {
                ws: ws,
                id: ws.wsid,
                closed: false
            };
            for (var i in lib.element.client) {
                client[i] = lib.element.client[i];
            }
            client.send(message);
        },
        createServer: function () {
            lib.node.clients = [];
            lib.node.banned = [];
            lib.node.observing = [];
            lib.node.torespond = {};
            lib.node.torespondtimeout = {};
            lib.playerOL = {};
            lib.cardOL = {};
            lib.wsOL = {};
            ui.create.roomInfo();
            ui.create.chat();

            if (game.onlineroom) {

            }
            else {
                var WebSocketServer = require('ws').Server;
                var wss = new WebSocketServer({ port: 8080 });

                game.ip = get.ip();

                wss.on('connection', lib.init.connection);
            }
        },
        playAudio: function () {
            if (_status.video &amp;&amp; arguments[1] != 'video') return;
            var str = '';
            var onerror = null;
            for (var i = 0; i &lt; arguments.length; i++) {
                if (typeof arguments[i] === 'string' || typeof arguments[i] == 'number') {
                    str += '/' + arguments[i];
                }
                else if (typeof arguments[i] == 'function') {
                    onerror = arguments[i]
                }
                if (_status.video) break;
            }
            if (!lib.config.repeat_audio &amp;&amp; _status.skillaudio.contains(str)) return;
            _status.skillaudio.add(str);
            game.addVideo('playAudio', null, str);
            setTimeout(function () {
                _status.skillaudio.remove(str);
            }, 1000);
            var audio = document.createElement('audio');
            audio.autoplay = true;
            audio.volume = lib.config.volumn_audio / 8;
            if (str.indexOf('.mp3') != -1 || str.indexOf('.ogg') != -1) {
                audio.src = lib.assetURL + 'audio' + str;
            }
            else {
                audio.src = lib.assetURL + 'audio' + str + '.mp3';
            }
            audio.addEventListener('ended', function () {
                this.remove();
            });
            audio.onerror = function () {
                if (this._changed) {
                    this.remove();
                    if (onerror) {
                        onerror();
                    }
                }
                else {
                    this.src = lib.assetURL + 'audio' + str + '.ogg';
                    this._changed = true;
                }
            };
            ui.window.appendChild(audio);
            return audio;
        },
        trySkillAudio: function (skill, player, directaudio) {
            game.broadcast(game.trySkillAudio, skill, player, directaudio);
            var info = get.info(skill);
            if (!info) return;
            if ((!info.direct || directaudio) &amp;&amp; lib.config.background_speak &amp;&amp;
                (!lib.skill.global.contains(skill) || lib.skill[skill].forceaudio)) {
                var audioname = skill;
                if (info.audioname2 &amp;&amp; info.audioname2[player.name]) {
                    audioname = info.audioname2[player.name];
                    info = lib.skill[audioname];
                }
                var audioinfo = info.audio;
                if (typeof audioinfo == 'string' &amp;&amp; lib.skill[audioinfo]) {
                    audioname = audioinfo;
                    audioinfo = lib.skill[audioname].audio;
                }
                if (typeof audioinfo == 'string') {
                    if (audioinfo.indexOf('ext:') == 0) {
                        audioinfo = audioinfo.split(':');
                        if (audioinfo.length == 3) {
                            if (audioinfo[2] == 'true') {
                                game.playAudio('..', 'extension', audioinfo[1], audioname);
                            }
                            else {
                                audioinfo[2] = parseInt(audioinfo[2]);
                                if (audioinfo[2]) {
                                    game.playAudio('..', 'extension', audioinfo[1], audioname + Math.ceil(audioinfo[2] * Math.random()));
                                }
                            }
                        }
                        return;
                    }
                }
                else if (Array.isArray(audioinfo)) {
                    audioname = audioinfo[0];
                    audioinfo = audioinfo[1];
                }
                if (Array.isArray(info.audioname) &amp;&amp; player) {
                    if (info.audioname.contains(player.name)) {
                        audioname += '_' + player.name;
                    }
                    else if (info.audioname.contains(player.name1)) {
                        audioname += '_' + player.name1;
                    }
                    else if (info.audioname.contains(player.name2)) {
                        audioname += '_' + player.name2;
                    }
                }
                if (typeof audioinfo == 'number') {
                    console.log(audioname)
                    game.playAudio('skill', audioname + Math.ceil(audioinfo * Math.random()));
                }
                else if (audioinfo) {
                    game.playAudio('skill', audioname);
                }
                else if (true &amp;&amp; info.audio !== false) {
                    game.playSkillAudio(audioname);
                }
            }
        },
        playSkillAudio: function (name, index) {
            if (_status.video &amp;&amp; arguments[1] != 'video') return;
            if (!lib.config.repeat_audio &amp;&amp; _status.skillaudio.contains(name)) return;
            game.addVideo('playSkillAudio', null, name);
            if (name.indexOf('|') &lt; name.lastIndexOf('|')) {
                name = name.slice(name.lastIndexOf('|') + 1);
            }
            _status.skillaudio.add(name);
            setTimeout(function () {
                _status.skillaudio.remove(name);
            }, 1000);
            var str = 'audio/skill/';
            var audio = document.createElement('audio');
            audio.autoplay = true;
            audio.volume = lib.config.volumn_audio / 8;
            audio.src = lib.assetURL + str + name + '.mp3';
            audio.addEventListener('ended', function () {
                this.remove();
            });
            if (typeof index != 'number') {
                index = Math.ceil(Math.random() * 2);
            }
            audio._changed = 1;
            audio.onerror = function () {
                switch (this._changed) {
                    case 1: {
                        audio.src = lib.assetURL + str + name + '.ogg';
                        this._changed = 2;
                        break;
                    }
                    case 2: {
                        audio.src = lib.assetURL + str + name + index + '.mp3';
                        this._changed = 3;
                        break;
                    }
                    case 3: {
                        audio.src = lib.assetURL + str + name + index + '.ogg';
                        this._changed = 4;
                        break;
                    }
                    default: {
                        this.remove();
                    }
                }
            };
            ui.window.appendChild(audio);
        },
        playBackgroundMusic: function () {
            if (lib.config.background_music == 'music_off') {
                ui.backgroundMusic.src = '';
            }
            else if (_status._aozhan == true &amp;&amp; lib.config.mode_config.guozhan.aozhan_bgm != 'disabled') {
                var aozhan = lib.config.mode_config.guozhan.aozhan_bgm;
                ui.backgroundMusic.src = lib.assetURL + 'audio/background/aozhan_' + aozhan + '.mp3';
            }
            else {
                var music = lib.config.background_music;
                if (music == 'music_random') {
                    music = lib.config.all.background_music.randomGet('music_off', 'music_random', _status.currentMusic);
                }
                _status.currentMusic = music;
                if (music == 'music_custom') {
                    if (lib.config.background_music_src) {
                        ui.backgroundMusic.src = lib.config.background_music_src;
                    }
                }
                else {
                    ui.backgroundMusic.src = lib.assetURL + 'audio/background/' + music + '.mp3';
                }
            }
        },
        /**
         * (||)
         * @param {!string} type 
         * @param {!function} content 
         */
        import: function (type, content) {
            if (type == 'extension') {
                game.loadExtension(content);
            }
            else {
                if (!lib.imported[type]) {
                    lib.imported[type] = {};
                }
                var content2 = content(lib, game, ui, get, ai, _status);
                if (content2.name) {
                    lib.imported[type][content2.name] = content2;
                    delete content2.name;
                }
            }
        },
        loadExtension: function (obj) {
            var noeval = false;
            if (typeof obj == 'function') {
                obj = obj(lib, game, ui, get, ai, _status);
                noeval = true;
            }
            lib.extensionMenu['extension_' + obj.name] = {
                enable: {
                    name: '',
                    init: true
                }
            };
            if (obj.package &amp;&amp; obj.package.author) {
                lib.extensionMenu['extension_' + obj.name].author = {
                    name: '' + obj.package.author,
                    clear: true,
                    nopointer: true,
                }
            }
            if (obj.package &amp;&amp; obj.package.intro) {
                lib.extensionMenu['extension_' + obj.name].intro = {
                    name: obj.package.intro,
                    clear: true,
                    nopointer: true,
                }
            }
            for (var i in obj.config) {
                lib.extensionMenu['extension_' + obj.name][i] = obj.config[i];
            }
            for (var i in obj.help) {
                lib.help[i] = obj.help[i];
            }
            if (obj.editable !== false &amp;&amp; lib.config.show_extensionmaker) {
                lib.extensionMenu['extension_' + obj.name].edit = {
                    name: '',
                    clear: true,
                    onclick: function () {
                        if (game.editExtension &amp;&amp; lib.extensionPack &amp;&amp; lib.extensionPack[obj.name]) {
                            game.editExtension(obj.name);
                        }
                        else {
                            alert('')
                        }
                    }
                }
            }
            lib.extensionMenu['extension_' + obj.name].delete = {
                name: '',
                clear: true,
                onclick: function () {
                    if (this.innerHTML == '&lt;span>&lt;/span>') {
                        var prefix = 'extension_' + obj.name;
                        var page = this.parentNode;
                        var start = page.parentNode.previousSibling;
                        page.remove();
                        if (start) {
                            for (var i = 0; i &lt; start.childElementCount; i++) {
                                if (start.childNodes[i].link == page) {
                                    var active = false;
                                    if (start.childNodes[i].classList.contains('active')) {
                                        active = true;
                                    }
                                    start.childNodes[i].remove();
                                    if (active) {
                                        start.firstChild.classList.add('active');
                                        start.nextSibling.appendChild(start.firstChild.link);
                                    }
                                    break;
                                }
                            }
                        }
                        game.removeExtension(obj.name);
                        if (obj.onremove) {
                            obj.onremove();
                        }
                    }
                    else {
                        this.innerHTML = '&lt;span>&lt;/span>';
                        var that = this;
                        setTimeout(function () {
                            that.innerHTML = '&lt;span>&lt;/span>';
                        }, 1000);
                    }
                }
            }

            if (!_status.importingExtension) {
                if (obj &amp;&amp; lib.config['extension_' + obj.name + '_enable']) {
                    if (!noeval) lib.init.eval(obj);
                    var cfg = {};
                    for (var j in lib.config) {
                        if (j.indexOf('extension_' + obj.name) == 0 &amp;&amp;
                            j != 'extension_' + obj.name) {
                            cfg[j.slice(11 + obj.name.length)] = lib.config[j];
                        }
                    }
                    try {
                        if (obj.package) {
                            lib.extensionPack[obj.name] = obj.package;
                            lib.extensionPack[obj.name].files = obj.files || {};
                            if (!lib.extensionPack[obj.name].files.character) {
                                lib.extensionPack[obj.name].files.character = [];
                            }
                            if (!lib.extensionPack[obj.name].files.card) {
                                lib.extensionPack[obj.name].files.card = [];
                            }
                            if (!lib.extensionPack[obj.name].files.skill) {
                                lib.extensionPack[obj.name].files.skill = [];
                            }
                        }
                        else {
                            lib.extensionPack[obj.name] = {};
                        }
                        lib.extensionPack[obj.name].code = {
                            content: obj.content,
                            precontent: obj.precontent,
                            help: obj.help,
                            config: obj.config
                        }
                        if (obj.precontent) {
                            _status.extension = obj.name;
                            obj.precontent(cfg);
                            delete _status.extension;
                        }
                        if (obj.content) {
                            lib.extensions.push([obj.name, obj.content, cfg, _status.evaluatingExtension, obj.package || {}]);
                        }
                    }
                    catch (e) {
                        console.log(e);
                    }
                }
            }
            else {
                game.importedPack = obj;
            }
        },
        createDir: function (dir, success, error) {
            var nullFC = function () { };
            success = success || nullFC;
            error = error || nullFC;
            dir = dir.split("/");
            if (window.resolveLocalFileSystemURL) {
                window.resolveLocalFileSystemURL(lib.assetURL, function (entry) {
                    (function redo(entry) {
                        var i = dir.shift();
                        entry.getDirectory(i, { create: true }, function (dirEntry) {
                            if (dir.length) redo(dirEntry);
                            else success();
                        });
                    })(entry);
                }, error);
            }
            else {
                var fs = require("fs");
                var str = __dirname;
                (function redo() {
                    str += "/";
                    str += dir.shift();
                    fs.exists(str, function (exists) {
                        if (exists) {
                            //
                            if (dir.length) redo();
                            else success();
                        }
                        else {
                            fs.mkdir(str, function () {
                                if (dir.length) redo();
                                else success();
                            });
                        }
                    });
                })();
            }
        },
        importExtension: function (data, finishLoad, exportext, pkg) {
            if (!window.JSZip) {
                lib.init.js(lib.assetURL + 'game', 'jszip', function () {
                    game.importExtension(data, finishLoad, exportext, pkg);
                });
            }
            else if (get.objtype(data) == 'object') {
                //
                var zip = new JSZip();
                var filelist = [];
                var filelist2 = [];
                if (data._filelist) {
                    filelist2 = data._filelist;
                    delete data._filelist;
                }
                for (var i in data) {
                    zip.file(i, data[i]);
                    filelist.push(i);
                }
                if (exportext) {
                    if (pkg) {
                        filelist.remove('extension.js');
                        pkg.files = filelist.slice(0);
                        pkg.files.addArray(filelist2);
                        pkg.size = zip.generate({ type: "arraybuffer" }).byteLength;
                        if (pkg.size &lt; 1000) {
                            pkg.size = pkg.size + 'B';
                        }
                        else if (pkg.size &lt; 1000000) {
                            pkg.size = Math.round(pkg.size / 1000) + 'KB';
                        }
                        else {
                            pkg.size = Math.round(pkg.size / 100000) / 10 + 'MB';
                        }
                        var pkgstr = 'extension["' + exportext + '"]={\n';
                        for (var i in pkg) {
                            var pkgfrag;
                            if (i == 'files') {
                                var pkgjs = JSON.stringify(pkg[i]);
                                var pkgfrag = '';
                                var pkgbuffer = 0;
                                for (var j = 0; j &lt; pkgjs.length; j++) {
                                    pkgfrag += pkgjs[j];
                                    pkgbuffer++;
                                    if (pkgbuffer >= 80 &amp;&amp; pkgjs[j] == ',' &amp;&amp; pkgjs[j - 1] == '"') {
                                        pkgfrag += '\n\t\t';
                                        pkgbuffer = 0;
                                    }
                                }
                            }
                            else {
                                pkgfrag = JSON.stringify(pkg[i]);
                            }
                            pkgstr += '\t' + i + ':' + pkgfrag + ',\n'
                        }
                        pkgstr = pkgstr.slice(0, pkgstr.length - 2);
                        pkgstr += '\n};';
                        zip.file('package.js', pkgstr);
                    }
                    var blob = zip.generate({ type: "blob" });
                    var fileNameToSaveAs = exportext;
                    fileNameToSaveAs = fileNameToSaveAs.replace(/\\|\/|\:|\?|\"|\*|&lt;|>|\|/g, '.');
                    fileNameToSaveAs += '.zip';

                    if (lib.device) {
                        var directory;
                        if (lib.device == 'android') {
                            directory = cordova.file.externalDataDirectory;
                        }
                        else {
                            directory = cordova.file.documentsDirectory;
                        }
                        window.resolveLocalFileSystemURL(directory, function (entry) {
                            entry.getFile(fileNameToSaveAs, { create: true }, function (fileEntry) {
                                fileEntry.createWriter(function (fileWriter) {
                                    fileWriter.onwriteend = function () {
                                        alert('' + directory + fileNameToSaveAs);
                                    }
                                    fileWriter.write(blob)
                                });
                            });
                        });
                    }
                    else {
                        var downloadLink = document.createElement("a");
                        downloadLink.download = fileNameToSaveAs;
                        downloadLink.innerHTML = "Download File";
                        downloadLink.href = window.URL.createObjectURL(blob);
                        downloadLink.click();
                    }

                    if (typeof finishLoad == 'function') {
                        finishLoad();
                    }
                }
                else {
                    game.importExtension.apply(this, [zip.generate({ type: 'arraybuffer' }), finishLoad]);
                }
            }
            else {
                //
                function UHP() {
                    alert("");
                };
                var zip = new JSZip();
                try {
                    zip.load(data);
                    // alert(zip.file('/.js').asText())
                    var str = zip.file('extension.js').asText();
                    if (str === "" || undefined) throw ('');
                    _status.importingExtension = true;
                    eval(str);
                    _status.importingExtension = false;
                    if (!game.importedPack) throw ('err');
                    var extname = game.importedPack.name;
                    if (lib.config.all.plays.contains(extname)) {
                        throw ('');
                    }
                    if (lib.config.extensions.contains(extname)) {
                        game.removeExtension(extname, true);
                    }
                    lib.config.extensions.add(extname);
                    game.saveConfig('extensions', lib.config.extensions);
                    game.saveConfig('extension_' + extname + '_enable', true);
                    for (var i in game.importedPack.config) {
                        if (game.importedPack.config[i] &amp;&amp; game.importedPack.config[i].hasOwnProperty('init')) {
                            game.saveConfig('extension_' + extname + '_' + i, game.importedPack.config[i].init);
                        }
                    }
                    if (game.download) {
                        var filelist = [];
                        for (var i in zip.files) {
                            //alert(zip.files[i].dir+i)
                            if (!zip.files[i].dir &amp;&amp; i[0] != '.' &amp;&amp; i[0] != '_') {
                                filelist.push(i);
                            }
                        }
                        //alert(filelist)
                        if (lib.node &amp;&amp; lib.node.fs) {
                            //
                            //nodeJS
                            game.ensureDirectory('extension/' + extname, function () {
                                var writeFile = function (e) {
                                    if (e) {
                                        finishLoad();
                                        UHP();
                                        return;
                                    }
                                    if (filelist.length) {
                                        var filename = filelist.shift();
                                        //filename  ...dir+/+file
                                        var zipdir = filename;
                                        filename = filename.split("/");
                                        var name = filename.pop();
                                        if (filename.length) game.createDir('extension/' + extname + "/" + filename.join("/"), function () {
                                            //
                                            Letgo(filename.join("/") + "/" + name);
                                        }, UHP);
                                        else Letgo(name);
                                        function Letgo(name) {
                                            lib.node.fs.writeFile(__dirname + '/extension/' + extname + "/" + name, zip.file(zipdir).asNodeBuffer(), null, writeFile);
                                        }
                                    }
                                    else {
                                        finishLoad();
                                    }
                                }
                                writeFile();
                            });
                        }
                        else {
                            window.resolveLocalFileSystemURL(lib.assetURL, function (entry) {
                                entry.getDirectory('extension/' + extname, { create: true }, function (dirEntry) {
                                    //
                                    writeFile();
                                    function writeFile() {
                                        if (filelist.length) {
                                            var filename = filelist.shift();
                                            //filename  ...dir+/+file
                                            var zipdir = filename;
                                            filename = filename.split("/");
                                            var name = filename.pop();
                                            if (filename.length) game.createDir('extension/' + extname + "/" + filename.join("/"), function () {
                                                Letgo(filename.join("/") + "/" + name);
                                            }, UHP);
                                            else Letgo(name);
                                            function Letgo(name) {
                                                dirEntry.getFile(name, { create: true }, function (fileEntry) {
                                                    fileEntry.createWriter(function (fileWriter) {
                                                        fileWriter.onwriteend = writeFile;
                                                        fileWriter.write(zip.file(zipdir).asArrayBuffer());
                                                    });
                                                }, UHP);
                                            }
                                        }
                                        else {
                                            finishLoad();
                                        }
                                    };

                                });
                            });
                        }
                    }
                    else {
                        localStorage.setItem(lib.configprefix + 'extension_' + extname, str);
                        var imglist = [];
                        for (var i in zip.files) {
                            if (i[0] != '.' &amp;&amp; i[0] != '_') {
                                if (i.indexOf('.jpg') != -1 || i.indexOf('.png') != -1) {
                                    imglist.push(i);
                                }
                            }
                        }
                        if (imglist.length &amp;&amp; lib.db) {
                            lib.config.extensionInfo[extname] = {
                                image: imglist
                            }
                            game.saveConfig('extensionInfo', lib.config.extensionInfo);
                            for (var i = 0; i &lt; imglist.length; i++) {
                                var imgname = imglist[i];
                                var str = zip.file(imgname).asArrayBuffer();
                                if (str) {
                                    var blob = new Blob([str]);
                                    var fileReader = new FileReader();
                                    fileReader.onload = (function (imgname) {
                                        return function (fileLoadedEvent) {
                                            var data = fileLoadedEvent.target.result;
                                            game.putDB('image', 'extension-' + extname + ':' + imgname, data);
                                        };
                                    }(imgname))
                                    fileReader.readAsDataURL(blob, "UTF-8");
                                }
                            }
                        }
                        finishLoad();
                    }
                    delete game.importedPack;
                }
                catch (e) {
                    console.log(e);
                    alert('');
                    return false;
                }
            }
        },
        export: function (textToWrite, name) {
            var textFileAsBlob = new Blob([textToWrite], { type: 'text/plain' });
            var fileNameToSaveAs = name || 'noname';
            fileNameToSaveAs = fileNameToSaveAs.replace(/\\|\/|\:|\?|\"|\*|&lt;|>|\|/g, '.');

            if (lib.device) {
                var directory;
                if (lib.device == 'android') {
                    directory = cordova.file.externalDataDirectory;
                }
                else {
                    directory = cordova.file.documentsDirectory;
                }
                window.resolveLocalFileSystemURL(directory, function (entry) {
                    entry.getFile(fileNameToSaveAs, { create: true }, function (fileEntry) {
                        fileEntry.createWriter(function (fileWriter) {
                            fileWriter.onwriteend = function () {
                                alert('' + directory + fileNameToSaveAs);
                            }
                            fileWriter.write(textFileAsBlob)
                        });
                    });
                });
            }
            else {
                var downloadLink = document.createElement("a");
                downloadLink.download = fileNameToSaveAs;
                downloadLink.innerHTML = "Download File";
                downloadLink.href = window.URL.createObjectURL(textFileAsBlob);
                downloadLink.click();
            }
        },
        multiDownload2: function (list, onsuccess, onerror, onfinish, process, dev) {
            list = list.slice(0);
            var download = function () {
                if (list.length) {
                    var current = list.shift();
                    var current2;
                    if (typeof process == 'function') {
                        current2 = process(current);
                    }
                    else {
                        current2 = current;
                    }
                    if (current.indexOf('theme') == 0) {
                        game.print(current.slice(6));
                    }
                    else if (current.indexOf('image/skin') == 0) {
                        game.print(current.slice(11));
                    }
                    else {
                        game.print(current.slice(current.lastIndexOf('/') + 1));
                    }
                    game.download(current, current2, function () {
                        if (onsuccess) onsuccess(list.length);
                        download();
                    }, function () {
                        if (onerror) onerror(list.length);
                        download();
                    }, dev);
                }
                else {
                    if (onfinish) onfinish();
                }
            }
            download();
        },
        multiDownload: function (list, onsuccess, onerror, onfinish, process, dev) {
            if (lib.config.dev) game.print(get.url());
            var args = Array.from(arguments);
            if (list.length &lt;= 3) {
                game.multiDownload2.apply(this, args);
            }
            else {
                var num = Math.round(list.length / 3);
                var left = 3;
                args[3] = function () {
                    left--;
                    if (left == 0) {
                        onfinish();
                    }
                };
                setTimeout(function () {
                    args[0] = list.slice(0, num); game.multiDownload2.apply(game, args);
                });
                setTimeout(function () {
                    args[0] = list.slice(num, 2 * num); game.multiDownload2.apply(this, args);
                }, 200);
                setTimeout(function () {
                    args[0] = list.slice(2 * num); game.multiDownload2.apply(this, args);
                }, 400);
            }
        },
        fetch: function (url, onload, onerror, onprogress) {
            var tmpName = '~tmp' + get.id();
            game.download(encodeURI(url), tmpName, function () {
                game.readFile(tmpName, function (data) {
                    onload(data);
                    game.removeFile(tmpName);
                }, onerror);
            }, onerror, null, onprogress);
        },
        playVideo: function (time, mode) {
            if (!_status.replayvideo) {
                localStorage.setItem(lib.configprefix + 'playbackmode', lib.config.mode);
            }
            game.saveConfig('mode', mode);
            localStorage.setItem(lib.configprefix + 'playback', time);
            game.reload();
        },
        playVideoContent: function (video) {
            var next = game.createEvent('video', false);
            next.video = video;
            ui.system.style.display = 'none';
            ui.system.hide();
            ui.arena.style.display = 'none';
            ui.arena.hide();
            ui.window.classList.remove('leftbar');
            ui.window.classList.remove('rightbar');
            ui.historybar.style.display = 'none';
            _status.event = next;
            _status.paused = false;
            _status.paused2 = false;
            _status.over = false;
            _status.video = true;
            clearTimeout(_status.timeout);

            for (var i in lib.characterPack) {
                for (var j in lib.characterPack[i]) {
                    lib.character[j] = lib.character[j] || lib.characterPack[i][j];
                }
            }
            next.setContent('playVideoContent');
            game.loop();
        },
        /**
         * ()
         * @type {!Object}
         */
        videoContent: {
            arrangeLib: function (content) {
                for (var i in content) {
                    for (var j in content[i]) {
                        lib[i][j] = content[i][j];
                    }
                }
            },
            jiuNode: function (player, bool) {
                //Powered by 
                if (bool) {
                    if (!player.node.jiu &amp;&amp; lib.config.jiu_effect) {
                        player.node.jiu = ui.create.div('.playerjiu', player.node.avatar);
                        player.node.jiu2 = ui.create.div('.playerjiu', player.node.avatar2);
                    }
                }
                else {
                    if (player.node.jiu) {
                        player.node.jiu.delete();
                        player.node.jiu2.delete();
                        delete player.node.jiu;
                        delete player.node.jiu2;
                    }
                }
            },
            init: function (players) {
                if (game.chess) return;
                if (lib.config.mode == 'versus') {
                    players.bool = players.pop();
                }
                ui.arena.setNumber(players.length);
                ui.arena.classList.add('video');
                game.players.length = 0;
                game.dead.length = 0;
                ui.create.players(players.length);
                game.me = game.players[0];
                ui.handcards1 = game.me.node.handcards1;
                ui.handcards2 = game.me.node.handcards2;
                ui.handcards1Container.appendChild(ui.handcards1);
                ui.handcards2Container.appendChild(ui.handcards2);
                if (lib.config.mode == 'versus') {
                    if (players.bool) {
                        ui.arena.setNumber(parseInt(ui.arena.dataset.number) + 1);
                        for (var i = 0; i &lt; game.players.length; i++) {
                            game.players[i].dataset.position = parseInt(game.players[i].dataset.position) + 1;
                        }
                        game.singleHandcard = true;
                        ui.arena.classList.add('single-handcard');
                        ui.window.classList.add('single-handcard');
                        ui.fakeme = ui.create.div('.fakeme.avatar', ui.me);
                    }
                    ui.arena.style.display = '';
                    ui.refresh(ui.arena);
                    ui.arena.show();
                }
                else if (lib.config.mode == 'boss') {
                    if (!players.boss) {
                        game.singleHandcard = true;
                        ui.arena.classList.add('single-handcard');
                        ui.window.classList.add('single-handcard');
                        ui.fakeme = ui.create.div('.fakeme.avatar', ui.me);
                    }
                    ui.arena.setNumber(8);
                }
                ui.updatehl();
                for (var i = 0; i &lt; players.length; i++) {
                    if (lib.config.mode == 'identity') {
                        game.players[i].init(players[i].name, players[i].name2);
                        game.players[i].setIdentity(players[i].identity);
                    }
                    else if (lib.config.mode == 'doudizhu' || lib.config.mode == 'longlaoguan' || lib.config.mode == 'single') {
                        game.players[i].init(players[i].name, players[i].name2);
                        game.players[i].setIdentity(players[i].identity);
                    }
                    else if (lib.config.mode == 'stone') {
                        game.players[i].init(players[i].name, players[i].name2);
                        game.players[i].classList.add('noidentity');
                        game.players[i].updateActCount(null, players[i].count, 0);
                    }
                    else if (lib.config.mode == 'boss') {
                        game.players[i].init(players[i].name, players[i].name2);
                        game.players[i].setIdentity(players[i].identity);
                        game.players[i].dataset.position = players[i].position;
                        game.players[i].node.action.innerHTML = '';
                    }
                    else if (lib.config.mode == 'versus') {
                        game.players[i].init(players[i].name, players[i].name2);
                        game.players[i].node.identity.firstChild.innerHTML = players[i].identity;
                        game.players[i].node.identity.dataset.color = players[i].color;
                        game.players[i].node.action.innerHTML = '';
                    }
                    else if (lib.config.mode == 'guozhan') {
                        game.players[i].name = players[i].name;
                        game.players[i].name1 = players[i].name1;
                        game.players[i].name2 = players[i].name2;

                        game.players[i].sex = 'unknown';
                        game.players[i].identity = 'unknown';

                        lib.translate[game.players[i].name] = players[i].translate;
                        game.players[i].init(players[i].name1, players[i].name2);

                        game.players[i].classList.add('unseen_v');
                        game.players[i].classList.add('unseen2_v');
                        if (game.players[i] != game.me) {
                            game.players[i].node.identity.firstChild.innerHTML = '';
                            game.players[i].node.identity.dataset.color = 'unknown';
                        }
                        else {
                            game.players[i].setIdentity(game.players[i].group);
                        }
                    }
                }
                for (var i = 0; i &lt; game.players.length; i++) {
                    game.playerMap[game.players[i].dataset.position] = game.players[i];
                }

                if (lib.config.mode == 'versus') {
                    if (players.bool) {
                        game.onSwapControl();
                    }
                }
                else if (lib.config.mode == 'boss') {
                    if (!players.boss) {
                        game.onSwapControl();
                    }
                    ui.arena.style.display = '';
                    ui.refresh(ui.arena);
                    ui.arena.show();
                    ui.updatehl();
                }
            },
            newcard: function (content) {
                if (content) {
                    lib.translate[content.name] = content.translate;
                    lib.translate[content.name + '_info'] = content.info;
                    lib.card[content.name] = {};
                    lib.card[content.name].cardimage = content.card
                    for (var i in lib.card[content.card]) {
                        lib.card[content.name][i] = lib.card[content.card][i];
                    }
                    if (content.legend) {
                        lib.card[content.name].legend = true;
                    }
                    else if (content.epic) {
                        lib.card[content.name].epic = true;
                    }
                    else if (content.unique) {
                        lib.card[content.name].unique = true;
                    }
                }
            },
            changeLand: function (player, url) {
                game.changeLand(url, player);
            },
            destroyLand: function () {
                if (ui.land) {
                    ui.land.destroy();
                }
            },
            playAudio: function (str) {
                game.playAudio(str, 'video');
            },
            playSkillAudio: function (name) {
                game.playSkillAudio(name, 'video');
            },
            phaseChange: function (player) {
                if (player) {
                    var glowing = document.querySelector('.glow_phase');
                    if (glowing) {
                        glowing.classList.remove('glow_phase');
                    }
                    if (lib.config.glow_phase) {
                        player.classList.add('glow_phase');
                        // player.dataset.glow_phase=lib.config.glow_phase;
                    }
                }
                else {
                    console.log(player);
                }
            },
            playerfocus: function (player, time) {
                if (player &amp;&amp; player.playerfocus) {
                    player.playerfocus(time);
                }
                else {
                    console.log(player);
                }
            },
            playerfocus2: function () {
                ui.arena.classList.add('playerfocus');
                setTimeout(function () {
                    ui.arena.classList.remove('playerfocus');
                }, 1500)
            },
            identityText: function (player, str) {
                if (player &amp;&amp; str) {
                    player.node.identity.firstChild.innerHTML = str;
                }
                else {
                    console.log(player);
                }
            },
            identityColor: function (player, str) {
                if (player &amp;&amp; str) {
                    player.node.identity.dataset.color = str;
                }
                else {
                    console.log(player);
                }
            },
            chessSwap: function (content) {
                var me = game.playerMap[content[0]];
                var player = game.playerMap[content[1]];
                if (me) {
                    me.classList.remove('current_action');
                }
                if (player) {
                    player.classList.add('current_action');
                }
            },
            chessgainmod: function (player, num) {
                if (Array.isArray(num)) {
                    num = get.infoCards(num);
                }
                if (player &amp;&amp; player.$gainmod) {
                    player.$gainmod(num);
                }
                else {
                    console.log(player);
                }
            },
            moveTo: function (player, pos) {
                if (player &amp;&amp; player.moveTo &amp;&amp; pos) {
                    player.moveTo(pos[0], pos[1]);
                }
                else {
                    console.log(player)
                }
            },
            addObstacle: function (pos) {
                if (pos) {
                    game.addObstacle(pos[0], pos[1]);
                }
            },
            removeObstacle: function (pos) {
                game.removeObstacle(pos);
            },
            moveObstacle: function (pos) {
                if (pos) {
                    game.moveObstacle(pos[0], pos[1], pos[2]);
                }
            },
            colorObstacle: function (pos) {
                if (pos) {
                    game.colorObstacle(pos[0], pos[1]);
                }
            },
            thrownhighlight1: function () {
                ui.arena.classList.add('thrownhighlight');
            },
            thrownhighlight2: function () {
                ui.arena.classList.remove('thrownhighlight');
            },
            chessFocus: function (player) {
                if (player) {
                    player.chessFocus();
                }
                else {
                    console.log('chessFocus');
                }
            },
            removeTreasure: function (pos) {
                if (game.playerMap[pos]) {
                    game.playerMap[pos].delete();
                    delete game.playerMap[pos];
                }
                else {
                    console.log(pos);
                }
            },
            initobs: function (obs) {
                if (obs) {
                    for (var i = 0; i &lt; obs.length; i++) {
                        game.addObstacle(obs[i]);
                    }
                }
                else {
                    console.log(obs);
                }
            },
            stonePosition: function (content) {
                var player = game.playerMap[content[0]];
                if (player) {
                    delete game.playerMap[content[0]];
                    player.dataset.position = content[1];
                    game.playerMap[content[1]] = player;
                }
                else {
                    console.log(content);
                }
            },
            bossSwap: function (player, name) {
                if (player &amp;&amp; name) {
                    player.delete();
                    var noboss = false;
                    if (name[0] == '_') {
                        name = name.slice(1);
                        noboss = true;
                    }
                    var boss = ui.create.player().init(name);
                    boss.dataset.position = player.dataset.position;
                    game.playerMap[player.dataset.position] = boss;
                    if (game.me == player) {
                        game.me = boss;
                    }
                    game.players.push(boss);
                    game.arrangePlayers();
                    if (!noboss) {
                        game.boss = boss;
                        boss.setIdentity('zhu');
                        boss.identity = 'zhu';
                    }
                    else {
                        boss.setIdentity('zhong');
                        boss.identity = 'zhong';
                    }
                    ui.arena.appendChild(boss.animate('zoominanim'));
                }
            },
            stoneSwap: function (info) {
                var player = ui.create.player();
                player.classList.add('noidentity');
                player.dataset.position = info.position;
                player.animate(info.me ? 'replaceme' : 'replaceenemy');
                player.actcount = info.actcount;
                player.init(info.name, info.name2);
                game.players.push(player);
                player.updateActCount(null, info.actcount, 0);
                ui.arena.appendChild(player);
                game.playerMap[player.dataset.position] = player;
                game.arrangePlayers();
            },
            chess_tongshuai: function (player, content) {
                if (player &amp;&amp; player.storage) {
                    player.storage.tongshuai.owned = content;
                }
                else {
                    console.log(player);
                }
            },
            chess_tongshuai_skill: function (player, content) {
                if (player &amp;&amp; content) {
                    if (player.marks.tongshuai.firstChild) {
                        player.marks.tongshuai.firstChild.remove();
                    }
                    player.marks.tongshuai.setBackground(content[0], 'character');
                    player.additionalSkills.tongshuai = content[1];
                }
                else {
                    console.log(player);
                }
            },
            smoothAvatar: function (player, vice) {
                if (player &amp;&amp; player.node) {
                    if (vice) {
                        if (player.node.avatar2) {
                            player.smoothAvatar(vice);
                        }
                    }
                    else {
                        if (player.node.avatar) {
                            player.smoothAvatar(vice);
                        }
                    }
                }
            },
            setAvatar: function (player, content) {
                if (player &amp;&amp; content &amp;&amp; content.length == 2) {
                    player.setAvatar(content[0], content[1])
                }
            },
            setAvatarQueue: function (player, content) {
                if (player &amp;&amp; content &amp;&amp; content.length == 2) {
                    player.setAvatarQueue(content[0], content[1])
                }
            },
            addSubPlayer: function (player, content) {
                if (player &amp;&amp; content &amp;&amp; content[0] &amp;&amp; content[1] &amp;&amp;
                    content[2] &amp;&amp; content[3] &amp;&amp; content[4]) {
                    var skill = content[0];
                    lib.skill[skill] = content[1];
                    lib.character[skill] = content[2];
                    lib.translate[skill] = content[3];
                    player.storage[skill] = content[4];
                }
            },
            arenaNumber: function (content) {
                ui.arena.dataset.number = content;
            },
            reinit: function (source, content) {
                if (source &amp;&amp; content) {
                    source.uninit();
                    source.init(content[0]);
                    source.node.identity.dataset.color = content[1];
                }
                else {
                    console.log(source);
                }
            },
            reinit2: function (source, name) {
                if (source &amp;&amp; name) {
                    source.init(name);
                }
                else {
                    console.log(source);
                }
            },
            reinit3: function (source, content) {
                if (source &amp;&amp; content) {
                    var info1 = lib.character[content.from];
                    var info2 = lib.character[content.to];
                    if (content.avatar2) {
                        source.name2 = content.to;
                        if (source.isUnseen(0)) {
                            source.sex = info2[0];
                        }
                        source.node.avatar2.setBackground(content.to, 'character');
                        source.node.name2.innerHTML = get.slimName(content.to);
                    }
                    else {
                        source.name = content.to;
                        source.sex = info2[0];
                        source.node.avatar.setBackground(content.to, 'character');
                        source.node.name.innerHTML = get.slimName(content.to);
                    }
                    source.maxHp = content.hp;
                    this.update();
                    for (var i = 0; i &lt; info1[3].length; i++) {
                        source.removeSkill(info1[3][i]);
                    }
                    for (var i = 0; i &lt; info2[3].length; i++) {
                        source.addSkill(info2[3][i]);
                    }
                }
            },
            skill: function (player, content) {
                if (typeof content == 'string') {
                    lib.skill[content].video(player);
                }
                else if (Array.isArray(content)) {
                    lib.skill[content[0]].video(player, content[1]);
                }
                else {
                    console.log(player, content)
                }
            },
            addFellow: function (content) {
                var player = game.addFellow(content[0], content[1], content[2]);
                game.playerMap[player.dataset.position] = player;
            },
            windowzoom1: function () {
                ui.window.style.transition = 'all 0.5s';
                ui.window.classList.add('zoomout3');
                ui.window.hide();
            },
            windowzoom2: function () {
                ui.window.style.transition = 'all 0s';
                ui.refresh(ui.window);
            },
            windowzoom3: function () {
                ui.window.classList.remove('zoomout3');
                ui.window.classList.add('zoomin3');
            },
            windowzoom4: function () {
                ui.window.style.transition = 'all 0.5s';
                ui.refresh(ui.window);
                ui.window.show();
                ui.window.classList.remove('zoomin3');
            },
            windowzoom5: function () {
                ui.window.style.transition = '';
            },
            updateActCount: function (player, content) {
                if (player &amp;&amp; content) {
                    player.updateActCount(content[0], content[1], content[2]);
                }
                else {
                    console.log(player);
                }
            },
            setIdentity: function (player, identity) {
                if (player &amp;&amp; identity) {
                    player.setIdentity(identity);
                }
                else {
                    console.log(num);
                }
            },
            showCharacter: function (player, num) {
                if (player &amp;&amp; player.classList) {
                    switch (num) {
                        case 0:
                            player.classList.remove('unseen_v');
                            break;
                        case 1:
                            player.classList.remove('unseen2_v');
                            break;
                        case 2:
                            player.classList.remove('unseen_v');
                            player.classList.remove('unseen2_v');
                            break;
                    }
                    if (!player.classList.contains('unseen_v') &amp;&amp; (!player.name2 || !player.classList.contains('unseen2_v')) &amp;&amp; player.storage.nohp) {
                        delete player.storage.nohp;
                        player.node.hp.show();
                        player.update();
                    }
                }
                else {
                    console.log(num);
                }
            },
            hidePlayer: function (player) {
                if (player) {
                    player.hide();
                }
            },
            deleteHandcards: function (player) {
                if (player) {
                    player.node.handcards1.delete();
                    player.node.handcards2.delete();
                }
            },
            hideCharacter: function (player, num) {
                if (player &amp;&amp; player.classList) {
                    switch (num) {
                        case 0:
                            player.classList.add('unseen_v');
                            break;
                        case 1:
                            player.classList.add('unseen2_v');
                            break;
                        case 2:
                            player.classList.add('unseen_v');
                            player.classList.add('unseen2_v');
                            break;
                    }
                }
                else {
                    console.log(num);
                }
            },
            popup: function (player, info) {
                if (player &amp;&amp; info) {
                    player.popup(info[0], info[1]);
                }
                else {
                    console.log(player);
                }
            },
            log: function (str) {
                game.log(str);
            },
            draw: function (player, info) {
                if (player &amp;&amp; player.$draw) {
                    player.$draw(info);
                }
                else {
                    console.log(player);
                }
            },
            drawCard: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$draw(get.infoCards(info));
                }
                else {
                    console.log(player);
                }
            },
            throw: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$throw(get.infoCards(info[0]), info[1], null, info[2]);
                }
                else {
                    console.log(player);
                }
            },
            compare: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$compare(get.infoCard(info[0]), game.playerMap[info[1]], get.infoCard(info[2]));
                }
                else {
                    console.log(player);
                }
            },
            compareMultiple: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$compareMultiple(get.infoCard(info[0]), get.infoTargets(info[1]), get.infoCards(info[2]));
                }
                else {
                    console.log(player);
                }
            },
            give: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$give(info[0], game.playerMap[info[1]]);
                }
                else {
                    console.log(player);
                }
            },
            giveCard: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$give(get.infoCards(info[0]), game.playerMap[info[1]]);
                }
                else {
                    console.log(player);
                }
            },
            gain: function (player, info) {
                if (player &amp;&amp; player.$gain) {
                    player.$gain(info);
                }
                else {
                    console.log(player);
                }
            },
            gainCard: function (player, info) {
                if (player &amp;&amp; info) {
                    player.$gain(get.infoCards(info));
                }
                else {
                    console.log(player);
                }
            },
            gain2: function (player, cards) {
                if (player &amp;&amp; player.$draw) {
                    var nodeList = document.querySelectorAll('#arena>.card,#chess>.card');
                    var nodes = [];
                    for (var i = 0; i &lt; nodeList.length; i++) {
                        nodes.push(nodeList[i]);
                    }
                    for (var i = 0; i &lt; cards.length; i++) {
                        for (var j = 0; j &lt; nodes.length; j++) {
                            if (cards[i][2] == nodes[j].name &amp;&amp; cards[i][0] == nodes[j].suit &amp;&amp; cards[i][1] == nodes[j].number) {
                                nodes[j].moveDelete(player);
                                cards.splice(i--, 1);
                                nodes.splice(j--, 1);
                                break;
                            }
                        }
                    }
                    if (cards.length) {
                        player.$draw(get.infoCards(cards));
                    }
                }
                else {
                    console.log(player);
                }
            },
            deletenode: function (player, cards, method) {
                if (cards) {
                    var nodeList = document.querySelectorAll('#arena>.card,#chess>.card');
                    var nodes = [];
                    for (var i = 0; i &lt; nodeList.length; i++) {
                        nodes.push(nodeList[i]);
                    }
                    for (var i = 0; i &lt; cards.length; i++) {
                        for (var j = 0; j &lt; nodes.length; j++) {
                            if (cards[i][2] == nodes[j].name &amp;&amp; cards[i][0] == nodes[j].suit &amp;&amp; cards[i][1] == nodes[j].number) {
                                nodes[j].delete();
                                if (method == 'zoom') {
                                    nodes[j].style.transform = 'scale(0)';
                                }
                                cards.splice(i--, 1);
                                nodes.splice(j--, 1);
                                break;
                            }
                        }
                    }
                }
                else {
                    console.log(player, cards);
                }
            },
            highlightnode: function (player, card) {
                if (card) {
                    var nodeList = document.querySelectorAll('#arena>.card,#chess>.card');
                    var nodes = [];
                    for (var i = 0; i &lt; nodeList.length; i++) {
                        nodes.push(nodeList[i]);
                    }
                    for (var j = nodes.length - 1; j >= 0; j--) {
                        if (card[2] == nodes[j].name &amp;&amp; card[0] == nodes[j].suit &amp;&amp; card[1] == nodes[j].number) {
                            nodes[j].classList.add('thrownhighlight');
                            break;
                        }
                    }
                }
                else {
                    console.log(player, cards);
                }
            },
            uiClear: function () {
                ui.clear();
            },
            judge1: function (player, content) {
                if (player &amp;&amp; content) {
                    var judging = get.infoCard(content[0]);
                    if (game.chess) {
                        judging.copy('thrown', 'center', 'thrownhighlight', ui.arena).animate('start');
                    }
                    else {
                        player.$throwordered(judging.copy('thrownhighlight'), true);
                    }

                    ui.create.dialog(content[1]).videoId = content[2];
                    ui.arena.classList.add('thrownhighlight');
                }
                else {
                    console.log(player);
                }
            },
            centernode: function (content) {
                get.infoCard(content).copy('thrown', 'center', 'thrownhighlight', ui.arena).animate('start');
            },
            judge2: function (videoId) {
                for (var i = 0; i &lt; ui.dialogs.length; i++) {
                    if (ui.dialogs[i].videoId == videoId) {
                        ui.dialogs[i].close();
                    }
                }
                ui.arena.classList.remove('thrownhighlight');
            },
            unmarkname: function (player, name) {
                if (player &amp;&amp; player.unmark) {
                    player.unmark(name);
                }
                else {
                    console.log(player);
                }
            },
            unmark: function (player, name) {
                if (player &amp;&amp; player.marks &amp;&amp; player.marks[name]) {
                    player.marks[name].delete();
                    player.marks[name].style.transform += ' scale(0.2)';
                    delete player.marks[name];
                    ui.updatem(this);
                }
            },
            flame: function (player, type) {
                if (player &amp;&amp; type) {
                    player['$' + type]();
                }
                else {
                    console.log(player);
                }
            },
            throwEmotion: function (player, content) {
                if (player &amp;&amp; content) {
                    player.$throwEmotion(game.playerMap[content[0]], content[1]);
                }
                else {
                    console.log(player);
                }
            },
            addGaintag: function (player, content) {
                if (player &amp;&amp; content) {
                    var checkMatch = function (l1, l2) {
                        for (var i = 0; i &lt; l1.length; i++) {
                            for (var j = 0; j &lt; l2.length; j++) {
                                if (l2[j].suit == l1[i][0] &amp;&amp; l2[j].number == l1[i][1] &amp;&amp; l2[j].name == l1[i][2]) {
                                    l2[j].addGaintag(content[1]);
                                    l2.splice(j--, 1);
                                    break;
                                }
                            }
                        }
                    }
                    checkMatch(content[0], player.getCards('h'));
                }
                else {
                    console.log(player);
                }
            },
            removeGaintag: function (player, content) {
                if (player &amp;&amp; content) {
                    player.removeGaintag(content);
                }
                else {
                    console.log(player);
                }
            },
            line: function (player, content) {
                if (player &amp;&amp; content) {
                    player.line(game.playerMap[content[0]], content[1]);
                }
                else {
                    console.log(player);
                }
            },
            fullscreenpop: function (player, content) {
                if (player &amp;&amp; content) {
                    player.$fullscreenpop(content[0], content[1], content[2]);
                }
                else {
                    console.log(player);
                }
            },
            damagepop: function (player, content) {
                if (player &amp;&amp; content) {
                    player.$damagepop(content[0], content[1], content[2]);
                }
                else {
                    console.log(player);
                }
            },
            damage: function (player, source) {
                if (player &amp;&amp; player.$damage) {
                    player.$damage(game.playerMap[source]);
                }
                else {
                    console.log(player);
                }
            },
            diex: function (player) {
                if (!player) {
                    console.log('diex');
                    return;
                }
                var cards = player.getCards('hej');
                for (var i = 0; i &lt; cards.length; i++) {
                    cards[i].discard();
                }
                while (player.node.marks.childNodes.length > 1) {
                    player.node.marks.lastChild.remove();
                }
                player.classList.add('dead');
                player.classList.remove('turnedover');
                player.classList.remove('out');
                player.node.count.innerHTML = '0';
                player.node.hp.hide();
                player.node.equips.hide();
                player.node.count.hide();
                player.previous.next = player.next;
                player.next.previous = player.previous;
                game.players.remove(player);
                game.dead.push(player);
                if (lib.config.mode == 'stone') {
                    setTimeout(function () {
                        player.delete();
                    }, 500);
                }
            },
            tafangMe: function (player) {
                if (player) {
                    game.me = player;
                    ui.me.lastChild.show();
                    ui.create.fakeme();
                    ui.handcards1 = player.node.handcards1.animate('start').fix();
                    ui.handcards2 = player.node.handcards2.animate('start').fix();
                    ui.handcards1Container.appendChild(ui.handcards1);
                    ui.handcards2Container.appendChild(ui.handcards2);
                    ui.updatehl();
                    game.setChessInfo();
                }
            },
            deleteChessPlayer: function (player) {
                if (player) {
                    player.delete();
                    delete game.playerMap[player.dataset.position];
                    game.players.remove(player);
                    for (var i = 0; i &lt; ui.phasequeue.length; i++) {
                        if (ui.phasequeue[i].link == player) {
                            ui.phasequeue[i].remove();
                            ui.phasequeue.splice(i, 1);
                            break;
                        }
                    }
                }
            },
            addChessPlayer: function (content) {
                game.addChessPlayer.apply(this, content);
            },
            die: function (player) {
                if (!player) {
                    console.log('die');
                    return;
                }
                player.$die();
                if (game.chess) {
                    delete lib.posmap[player.dataset.position];
                    setTimeout(function () {
                        player.delete();
                    }, 500);
                    for (var i = 0; i &lt; ui.phasequeue.length; i++) {
                        if (ui.phasequeue[i].link == player) {
                            ui.phasequeue[i].remove();
                            ui.phasequeue.splice(i, 1);
                            break;
                        }
                    }
                }
            },
            revive: function (player) {
                if (!player) {
                    console.log('revive');
                    return;
                }
                player.classList.remove('dead');
                player.node.hp.show();
                player.node.equips.show();
                player.node.count.show();
                player.node.avatar.style.transform = '';
                player.node.avatar2.style.transform = '';
                player.removeAttribute('style');
            },
            update: function (player, info) {
                if (player &amp;&amp; info) {
                    player.hp = info[1];
                    player.maxHp = info[2];
                    player.hujia = info[3];
                    player.update(info[0]);
                }
                else {
                    console.log(player);
                }
            },
            phaseJudge: function (player, card) {
                if (player &amp;&amp; card) {
                    // player.$phaseJudge(get.infoCard(card));
                }
                else {
                    console.log(player);
                }
            },
            directgain: function (player, cards) {
                if (player &amp;&amp; cards) {
                    player.directgain(get.infoCards(cards));
                }
                else {
                    console.log(player);
                }
            },
            directgains: function (player, cards) {
                if (player &amp;&amp; cards) {
                    player.directgains(get.infoCards(cards));
                }
                else {
                    console.log(player);
                }
            },
            directequip: function (player, cards) {
                if (player &amp;&amp; cards) {
                    player.directequip(get.infoCards(cards));
                }
                else {
                    console.log(player);
                }
            },
            gain12: function (player, cards12) {
                if (player &amp;&amp; cards12) {
                    var cards1 = get.infoCards(cards12[0]);
                    var cards2 = get.infoCards(cards12[1]);
                    for (var i = 0; i &lt; cards1.length; i++) {
                        cards1[i].classList.add('drawinghidden');
                        cards1[i].addGaintag(cards12[2]);
                        player.node.handcards1.insertBefore(cards1[i], player.node.handcards1.firstChild);
                    }
                    for (var i = 0; i &lt; cards2.length; i++) {
                        cards2[i].classList.add('drawinghidden');
                        cards2[i].addGaintag(cards12[2]);
                        player.node.handcards2.insertBefore(cards2[i], player.node.handcards2.firstChild);
                    }
                    ui.updatehl();
                }
                else {
                    console.log(player);
                }
            },
            equip: function (player, card) {
                if (player &amp;&amp; card) {
                    player.$equip(get.infoCard(card));
                }
                else {
                    console.log(player);
                }
            },
            addJudge: function (player, content) {
                if (player &amp;&amp; content) {
                    var card = get.infoCard(content[0]);
                    card.viewAs = content[1];
                    if (card.viewAs &amp;&amp; card.viewAs != card.name &amp;&amp; (card.classList.contains('fullskin') || card.classList.contains('fullborder'))) {
                        card.classList.add('fakejudge');
                        card.node.background.innerHTML = lib.translate[card.viewAs + '_bg'] || get.translation(card.viewAs)[0]
                    }
                    card.classList.add('drawinghidden');
                    player.node.judges.insertBefore(card, player.node.judges.firstChild);
                    ui.updatej(player);
                }
                else {
                    console.log(player);
                }
            },
            markCharacter: function (player, content) {
                if (player &amp;&amp; content) {
                    if (game.playerMap[content.target]) {
                        content.target = game.playerMap[content.target];
                    }
                    var mark = player.markCharacter(content.target, content);
                    if (content.id) {
                        player.marks[content.id] = mark;
                    }
                }
                else {
                    console.log(player);
                }
            },
            changeMarkCharacter: function (player, content) {
                if (player &amp;&amp; content &amp;&amp; player.marks[content.id]) {
                    player.marks[content.id].info = {
                        name: content.name,
                        content: content.content
                    };
                    player.marks[content.id].setBackground(content.target, 'character');
                }
            },
            mark: function (player, content) {
                if (player &amp;&amp; content) {
                    var mark = player.mark(content.id, content);
                }
                else {
                    console.log(player);
                }
            },
            markSkill: function (player, content) {
                if (player &amp;&amp; content) {
                    if (content[1]) {
                        player.markSkill(content[0], null, get.infoCard(content[1]));
                    }
                    else {
                        player.markSkill(content[0]);
                    }
                }
                else {
                    console.log(player);
                }
            },
            unmarkSkill: function (player, name) {
                if (player &amp;&amp; player.unmarkSkill) {
                    player.unmarkSkill(name);
                }
                else {
                    console.log(player);
                }
            },
            storage: function (player, content) {
                if (player &amp;&amp; content) {
                    if (content[2]) {
                        switch (content[2]) {
                            case 'cards': content[1] = get.infoCards(content[1]); break;
                            case 'card': content[1] = get.infoCard(content[1]); break;
                        }
                    }
                    player.storage[content[0]] = content[1];
                }
                else {
                    console.log(player);
                }
            },
            markId: function (player, content) {
                if (player &amp;&amp; content) {
                    player.mark(get.infoCard(content[0]), content[1]);
                }
                else {
                    console.log(player);
                }
            },
            unmarkId: function (player, content) {
                if (player &amp;&amp; content) {
                    player.unmark(get.infoCard(content[0]), content[1]);
                }
                else {
                    console.log(player);
                }
            },
            lose: function (player, info) {
                if (player &amp;&amp; info) {
                    var hs = info[0] || [], es = info[1] || [], js = info[2] || [], ss = info[3] || [];
                    var phs = player.getCards('h'), pes = player.getCards('e'), pjs = player.getCards('j'), pss = player.getCards('s');
                    var checkMatch = function (l1, l2) {
                        for (var i = 0; i &lt; l1.length; i++) {
                            for (var j = 0; j &lt; l2.length; j++) {
                                if (l2[j].suit == l1[i][0] &amp;&amp; l2[j].number == l1[i][1] &amp;&amp; l2[j].name == l1[i][2]) {
                                    l2[j].remove();
                                    l2.splice(j--, 1);
                                    break;
                                }
                            }
                        }
                    }
                    checkMatch(hs, phs);
                    checkMatch(es, pes);
                    checkMatch(js, pjs);
                    checkMatch(ss, pss);
                    ui.updatehl();
                }
                else {
                    console.log(player);
                }
            },
            loseAfter: function (player) {
                if (!player) {
                    console.log('loseAfter');
                    return;
                }
            },
            link: function (player, bool) {
                if (player &amp;&amp; player.classList) {
                    if (bool) {
                        player.addLink();
                    }
                    else {
                        player.removeLink();
                    }
                }
                else {
                    console.log(player);
                }
            },
            turnOver: function (player, bool) {
                if (player &amp;&amp; player.classList) {
                    if (bool) {
                        player.classList.add('turnedover');
                    }
                    else {
                        player.classList.remove('turnedover');
                    }
                }
                else {
                    console.log(player);
                }
            },
            showCards: function (player, info) {
                if (info) {
                    var dialog = ui.create.dialog(info[0], get.infoCards(info[1]));
                    setTimeout(function () {
                        dialog.close();
                    }, 1000);
                }
                else {
                    console.log(player);
                }
            },
            cardDialog: function (content) {
                if (Array.isArray(content)) {
                    ui.create.dialog(content[0], get.infoCards(content[1])).videoId = content[2];
                }
                else if (typeof content == 'number') {
                    for (var i = 0; i &lt; ui.dialogs.length; i++) {
                        if (ui.dialogs[i].videoId == content) {
                            ui.dialogs[i].close();
                            return;
                        }
                    }
                }
            },
            changeSeat: function (player, info) {
                if (player &amp;&amp; player.getBoundingClientRect &amp;&amp; player.changeSeat) {
                    player.changeSeat(info);
                    game.playerMap = {};
                    var players = game.players.concat(game.dead);
                    for (var i = 0; i &lt; players.length; i++) {
                        game.playerMap[players[i].dataset.position] = players[i];
                    }
                }
            },
            dialogCapt: function (content) {
                for (var i = 0; i &lt; ui.dialogs.length; i++) {
                    if (ui.dialogs[i].videoId == content[0]) {
                        ui.dialogs[i].content.firstChild.innerHTML = content[1];
                        return;
                    }
                }
            },
            swapSeat: function (content) {
                var player1 = game.playerMap[content[0]];
                var player2 = game.playerMap[content[1]];
                if (!player1 || !player2) {
                    console.log(content);
                    return;
                }
                var temp1, pos, i, num;
                temp1 = player1.dataset.position;
                player1.dataset.position = player2.dataset.position;
                player2.dataset.position = temp1;
                game.arrangePlayers();
                if (player1.dataset.position == '0' || player2.dataset.position == '0') {
                    pos = parseInt(player1.dataset.position);
                    if (pos == 0) pos = parseInt(player2.dataset.position);
                    num = game.players.length + game.dead.length;
                    for (i = 0; i &lt; game.players.length; i++) {
                        temp1 = parseInt(game.players[i].dataset.position) - pos;
                        if (temp1 &lt; 0) temp1 += num;
                        game.players[i].dataset.position = temp1;
                    }
                    for (i = 0; i &lt; game.dead.length; i++) {
                        temp1 = parseInt(game.dead[i].dataset.position) - pos;
                        if (temp1 &lt; 0) temp1 += num;
                        game.dead[i].dataset.position = temp1;
                    }
                }
                game.playerMap = {};
                var players = game.players.concat(game.dead);
                for (var i = 0; i &lt; players.length; i++) {
                    game.playerMap[players[i].dataset.position] = players[i];
                }
            },
            removeTafangPlayer: function () {
                ui.fakeme.hide();
                ui.handcards1Container.innerHTML = '';
                ui.handcards2Container.innerHTML = '';
                game.me = ui.create.player();
            },
            swapControl: function (player, hs) {
                if (player &amp;&amp; player.node) {
                    var cards = get.infoCards(hs);
                    player.node.handcards1.innerHTML = '';
                    player.node.handcards2.innerHTML = '';
                    player.directgain(cards, false);

                    game.me.node.handcards1.remove();
                    game.me.node.handcards2.remove();

                    ui.handcards1 = player.node.handcards1.animate('start').fix();
                    ui.handcards2 = player.node.handcards2.animate('start').fix();
                    ui.handcards1Container.insertBefore(ui.handcards1, ui.handcards1Container.firstChild);
                    ui.handcards2Container.insertBefore(ui.handcards2, ui.handcards2Container.firstChild);

                    game.me = player;
                    ui.updatehl();
                    if (game.chess) {
                        ui.create.fakeme();
                    }
                }
                else {
                    console.log(player);
                }
            },
            onSwapControl: function () {
                game.onSwapControl();
            },
            swapPlayer: function (player, hs) {
                if (player &amp;&amp; player.node) {
                    var cards = get.infoCards(hs);
                    player.node.handcards1.innerHTML = '';
                    player.node.handcards2.innerHTML = '';
                    player.directgain(cards, false);

                    var pos = parseInt(player.dataset.position);
                    var num = game.players.length + game.dead.length;
                    var players = game.players.concat(game.dead);
                    var temp;
                    for (var i = 0; i &lt; players.length; i++) {
                        temp = parseInt(players[i].dataset.position) - pos;
                        if (temp &lt; 0) temp += num;
                        players[i].dataset.position = temp;
                    }
                    game.me.node.handcards1.remove();
                    game.me.node.handcards2.remove();
                    game.me = player;
                    ui.handcards1 = player.node.handcards1.animate('start').fix();
                    ui.handcards2 = player.node.handcards2.animate('start').fix();
                    ui.handcards1Container.appendChild(ui.handcards1);
                    ui.handcards2Container.appendChild(ui.handcards2);

                    ui.updatehl();

                    game.playerMap = {};
                    var players = game.players.concat(game.dead);
                    for (var i = 0; i &lt; players.length; i++) {
                        game.playerMap[players[i].dataset.position] = players[i];
                    }
                }
                else {
                    console.log(player);
                }
            },
            over: function (str) {
                var dialog = ui.create.dialog('hidden');
                dialog.noforcebutton = true;
                dialog.content.innerHTML = str;
                dialog.forcebutton = true;
                dialog.open();
                if (game.chess) {
                    dialog.classList.add('center');
                }
                if ((game.layout == 'long2' || game.layout == 'nova') &amp;&amp; !game.chess) {
                    ui.arena.classList.add('choose-character');
                    if (ui.me) ui.me.hide();
                    if (ui.mebg) ui.mebg.hide()
                    if (ui.autonode) ui.autonode.hide();
                    if (lib.config.radius_size != 'off') {
                        if (ui.historybar) ui.historybar.style.borderRadius = '0 0 0 4px';
                    }
                }
            }
        },
        reload: function () {
            if (_status) {
                if (_status.reloading) return;
                _status.reloading = true;
            }
            if (_status.video &amp;&amp; !_status.replayvideo) {
                localStorage.removeItem(lib.configprefix + 'playbackmode');
            }
            localStorage.setItem('show_splash_off', true);
            if (lib.status.reload) {
                _status.waitingToReload = true;
            }
            else {
                window.location.reload();
            }
        },
        reload2: function () {
            lib.status.reload--;
            if (lib.status.reload == 0 &amp;&amp; lib.ondb2.length) {
                var command = lib.ondb2.shift();
                game[command[0]].apply(game, command[1]);
            }
            if (lib.status.reload == 0 &amp;&amp; lib.ondb.length) {
                var command = lib.ondb.shift();
                game[command[0]].apply(game, command[1]);
            }
            if (lib.status.reload == 0) {
                if (_status.waitingToReload) {
                    window.location.reload();
                    delete _status.waitingToReload;
                }
            }
        },
        exit: function () {
            if (lib.device == 'ios') {
                game.saveConfig('mode');
                if (_status) {
                    if (_status.reloading) return;
                    _status.reloading = true;
                }
                if (_status.video &amp;&amp; !_status.replayvideo) {
                    localStorage.removeItem(lib.configprefix + 'playbackmode');
                }
                window.location.reload();
            }
            else {
                if (navigator.app &amp;&amp; navigator.app.exitApp) {
                    navigator.app.exitApp();
                }
            }
        },
        open: function (url) {
            if (lib.device) {
                if (cordova.InAppBrowser) {
                    cordova.InAppBrowser.open(url, '_system');
                }
                else {
                    ui.create.iframe(url);
                }
            }
            else {
                window.open(url);
            }
        },
        reloadCurrent: function () {
            game.saveConfig('continue_name', [game.me.name1 || game.me.name, game.me.name2]);
            game.saveConfig('mode', lib.config.mode);
            localStorage.setItem(lib.configprefix + 'directstart', true);
            game.reload();
        },
        update: function (func) {
            lib.updates.push(func);
            if (lib.updates.length === 1) {
                game.run();
            }
            return func;
        },
        unupdate: function (func) {
            lib.updates.remove(func);
        },
        stop: function () {
            cancelAnimationFrame(lib.status.frameId);
        },
        run: function () {
            if (lib.updates.length) {
                cancelAnimationFrame(lib.status.frameId);
                lib.status.frameId = requestAnimationFrame(function (time) {
                    if (lib.status.time !== 0) {
                        lib.status.delayed += time - lib.status.time;
                    }
                    lib.status.frameId = requestAnimationFrame(lib.run);
                });
            }
        },
        addVideo: function (type, player, content) {
            if (_status.video || game.online) return;
            if (!_status.videoInited) {
                if (type == 'arrangeLib') {
                    lib.video.push({
                        type: type,
                        player: player,
                        content: content,
                        delay: 0
                    });
                }
                return;
            }
            if (type == 'storage' &amp;&amp; player &amp;&amp; player.updateMarks) {
                player.updateMarks();
            }
            if (game.getVideoName) {
                var time = get.time();
                if (!_status.lastVideoLog) {
                    _status.lastVideoLog = time;
                }
                if (get.itemtype(player) == 'player') {
                    player = player.dataset.position;
                }
                lib.video.push({
                    type: type,
                    player: player,
                    content: content,
                    delay: time - _status.lastVideoLog
                });
                _status.lastVideoLog = time;
            }
        },
        draw: function (func) {
            lib.canvasUpdates.push(func);
            if (!lib.status.canvas) {
                lib.status.canvas = true;
                game.update(lib.updateCanvas);
            }
        },
        vibrate: function (time) {
            if (typeof navigator.vibrate == 'function') {
                navigator.vibrate(time || 500);
            }
        },
        prompt: function () {
            var str, forced, callback, noinput = false, str2 = '';
            for (var i = 0; i &lt; arguments.length; i++) {
                if (arguments[i] == 'alert') {
                    forced = true;
                    callback = function () { };
                    noinput = true;
                }
                else if (typeof arguments[i] == 'string') {
                    if (arguments[i].indexOf('###') == 0) {
                        var list = arguments[i].slice(3).split('###');
                        str = list[0];
                        str2 = list[1];
                    }
                    else str = arguments[i];
                }
                else if (typeof arguments[i] == 'boolean') {
                    forced = arguments[i];
                }
                else if (typeof arguments[i] == 'function') {
                    callback = arguments[i];
                }
            }
            if (!callback) {
                return;
            }
            //try{
            //    if(noinput){
            //        throw('e');
            //    }
            //    var result=prompt(str);
            //    callback(result);
            //}
            //catch(e){
            var promptContainer = ui.create.div('.popup-container', ui.window, function () {
                if (this.clicked) {
                    this.clicked = false;
                }
                else {
                    clickCancel();
                }
            });
            var dialogContainer = ui.create.div('.prompt-container', promptContainer);
            var dialog = ui.create.div('.menubg', ui.create.div(dialogContainer), function () {
                promptContainer.clicked = true;
            });
            var strnode = ui.create.div('', str || '', dialog);
            var input = ui.create.node('input', ui.create.div(dialog));
            input.value = str2;
            if (noinput) {
                input.style.display = 'none';
            }
            var controls = ui.create.div(dialog);
            var clickConfirm = function () {
                if (noinput) {
                    promptContainer.remove();
                }
                else if (input.value) {
                    callback(input.value);
                    promptContainer.remove();
                }
            }
            var clickCancel = function () {
                if (!forced) {
                    callback(false);
                    promptContainer.remove();
                }
            }
            var confirmNode = ui.create.div('.menubutton.large.disabled', '', controls, clickConfirm);
            if (!forced) {
                ui.create.div('.menubutton.large', '', controls, clickCancel);
            }
            if (noinput) {
                confirmNode.classList.remove('disabled');
            }
            else {
                input.onkeydown = function (e) {
                    if (e.keyCode == 13) {
                        clickConfirm();
                    }
                    else if (e.keyCode == 27) {
                        clickCancel();
                    }
                }
                input.onkeyup = function () {
                    if (input.value) {
                        confirmNode.classList.remove('disabled');
                    }
                    else {
                        confirmNode.classList.remove('disabled');
                    }
                }
                input.focus();
            }
            //}
        },
        alert: function (str) {
            game.prompt(str, 'alert');
        },
        print: function () {
            if (!_status.toprint) {
                _status.toprint = [];
            }
            _status.toprint.push(Array.from(arguments));
        },
        animate: {
            window: function (num) {
                switch (num) {
                    case 1: {
                        ui.window.style.transition = 'all 0.5s';
                        ui.window.classList.add('zoomout3');
                        ui.window.hide();
                        game.addVideo('windowzoom1');
                        game.delay(0, 500);
                        break;
                    }
                    case 2: {
                        ui.window.style.transition = 'all 0s';
                        ui.refresh(ui.window);
                        game.addVideo('windowzoom2');
                        game.pause();
                        setTimeout(function () {
                            ui.window.classList.remove('zoomout3');
                            ui.window.classList.add('zoomin3');
                            game.addVideo('windowzoom3');
                            setTimeout(function () {
                                ui.window.style.transition = 'all 0.5s';
                                ui.refresh(ui.window);
                                ui.window.show();
                                ui.window.classList.remove('zoomin3');
                                game.addVideo('windowzoom4');
                                setTimeout(function () {
                                    ui.window.style.transition = '';
                                    game.addVideo('windowzoom5');
                                    game.resume();
                                }, 500);
                            }, 100);
                        }, 100);
                        break;
                    }
                }
            },
            flame: function (x, y, duration, type) {
                var particles = [];
                var particle_count = 50;
                if (type == 'thunder' || type == 'recover') {
                    particle_count = 30;
                }
                else if (type == 'coin' || type == 'dust') {
                    particle_count = 50;
                }
                else if (type == 'legend') {
                    particle_count = 120;
                }
                else if (type == 'epic') {
                    particle_count = 80;
                }
                else if (type == 'rare') {
                    particle_count = 50;
                }
                for (var i = 0; i &lt; particle_count; i++) {
                    particles.push(new particle());
                }
                function particle() {
                    this.speed = { x: -1 + Math.random() * 2, y: -5 + Math.random() * 5 };
                    if (type == 'thunder' || type == 'coin' || type == 'dust') {
                        this.speed.y = -3 + Math.random() * 5;
                        this.speed.x = -2 + Math.random() * 4;
                    }
                    if (type == 'legend' || type == 'rare' || type == 'epic') {
                        this.speed.x *= 3;
                        this.speed.y *= 1.5;
                    }
                    this.location = { x: x, y: y };

                    this.radius = 0.5 + Math.random() * 1;

                    this.life = 10 + Math.random() * 10;
                    this.death = this.life;

                    switch (type) {
                        case 'thunder': {
                            this.b = 255;
                            this.r = Math.round(Math.random() * 255);
                            this.g = Math.round(Math.random() * 255);
                            this.x += Math.random() * 20 - 10;
                            this.y += Math.random() * 20 - 10;

                            break;
                        }
                        case 'fire': {
                            this.r = 255;
                            this.g = Math.round(Math.random() * 155);
                            this.b = 0;
                            break;
                        }
                        case 'coin': {
                            this.r = 255;
                            this.g = Math.round(Math.random() * 25 + 230);
                            this.b = Math.round(Math.random() * 100 + 50);
                            this.location.x += Math.round(Math.random() * 60) - 30;
                            this.location.y += Math.round(Math.random() * 40) - 20;
                            if (this.location.x &lt; x) {
                                this.speed.x = -Math.abs(this.speed.x);
                            }
                            else if (this.location.x > x) {
                                this.speed.x = Math.abs(this.speed.x);
                            }
                            this.life *= 1.3;
                            this.death *= 1.3;
                            break;
                        }
                        case 'dust': {
                            this.r = Math.round(Math.random() * 55) + 105;
                            this.g = Math.round(Math.random() * 55) + 150;
                            this.b = 255;
                            this.location.x += Math.round(Math.random() * 60) - 30;
                            this.location.y += Math.round(Math.random() * 40) - 20;
                            if (this.location.x &lt; x) {
                                this.speed.x = -Math.abs(this.speed.x);
                            }
                            else if (this.location.x > x) {
                                this.speed.x = Math.abs(this.speed.x);
                            }
                            this.life *= 1.3;
                            this.death *= 1.3;
                            break;
                        }
                        case 'legend': {
                            this.r = 255;
                            this.g = Math.round(Math.random() * 100 + 155);
                            this.b = Math.round(Math.random() * 100 + 50);
                            this.location.x += Math.round(Math.random() * 60) - 30;
                            this.location.y += Math.round(Math.random() * 40) - 20;
                            if (this.location.x &lt; x) {
                                this.speed.x = -Math.abs(this.speed.x);
                            }
                            else if (this.location.x > x) {
                                this.speed.x = Math.abs(this.speed.x);
                            }
                            this.speed.x /= 2;
                            this.speed.y /= 2;
                            this.life *= 2;
                            this.death *= 2;
                            break;
                        }
                        case 'epic': {
                            this.r = Math.round(Math.random() * 55) + 200;
                            this.g = Math.round(Math.random() * 100) + 55;
                            this.b = 255;
                            this.location.x += Math.round(Math.random() * 60) - 30;
                            this.location.y += Math.round(Math.random() * 40) - 20;
                            if (this.location.x &lt; x) {
                                this.speed.x = -Math.abs(this.speed.x);
                            }
                            else if (this.location.x > x) {
                                this.speed.x = Math.abs(this.speed.x);
                            }
                            this.speed.x /= 2;
                            this.speed.y /= 2;
                            this.life *= 2;
                            this.death *= 2;
                            break;
                        }
                        case 'rare': {
                            this.r = Math.round(Math.random() * 55) + 105;
                            this.g = Math.round(Math.random() * 55) + 150;
                            this.b = 255;
                            this.location.x += Math.round(Math.random() * 60) - 30;
                            this.location.y += Math.round(Math.random() * 40) - 20;
                            if (this.location.x &lt; x) {
                                this.speed.x = -Math.abs(this.speed.x);
                            }
                            else if (this.location.x > x) {
                                this.speed.x = Math.abs(this.speed.x);
                            }
                            this.speed.x /= 2;
                            this.speed.y /= 2;
                            this.life *= 2;
                            this.death *= 2;
                            break;
                        }
                        case 'recover': {
                            this.g = 255;
                            this.r = Math.round(Math.random() * 200 + 55);
                            this.b = Math.round(Math.random() * 155 + 55);
                            this.location.x += Math.round(Math.random() * 60) - 30;
                            this.location.y += Math.round(Math.random() * 40) - 20;
                            if (this.location.x &lt; x) {
                                this.speed.x = -Math.abs(this.speed.x);
                            }
                            else if (this.location.x > x) {
                                this.speed.x = Math.abs(this.speed.x);
                            }
                            this.speed.x /= 2;
                            this.speed.y /= 2;
                            this.life *= 2;
                            this.death *= 2;
                            break;
                        }
                        default: {
                            this.r = 255;
                            this.g = Math.round(Math.random() * 155);
                            this.b = 0;
                        }
                    }
                }

                game.draw(function (time, surface) {
                    surface.globalCompositeOperation = "source-over";
                    surface.globalCompositeOperation = "lighter";

                    for (var i = 0; i &lt; particles.length; i++) {
                        var p = particles[i];

                        surface.beginPath();
                        var middle = 0.5;
                        var radius = p.radius;
                        if (type == 'recover' || type == 'legend' || type == 'rare' ||
                            type == 'epic' || type == 'coin' || type == 'dust') {
                            middle = 0.7;
                            radius /= 3;
                        }

                        p.opacity = Math.round(p.death / p.life * 100) / 100
                        var gradient = surface.createRadialGradient(p.location.x, p.location.y, 0, p.location.x, p.location.y, p.radius);
                        gradient.addColorStop(0, "rgba(" + p.r + ", " + p.g + ", " + p.b + ", " + p.opacity + ")");
                        gradient.addColorStop(middle, "rgba(" + p.r + ", " + p.g + ", " + p.b + ", " + p.opacity + ")");
                        gradient.addColorStop(1, "rgba(" + p.r + ", " + p.g + ", " + p.b + ", 0)");
                        surface.fillStyle = gradient;
                        surface.arc(p.location.x, p.location.y, radius, Math.PI * 2, false);
                        surface.fill();
                        p.death--;
                        if (type == 'recover') {
                            p.radius += 0.5;
                        }
                        else if (type == 'coin' || type == 'dust') {
                            p.radius += 0.7;
                        }
                        else if (type == 'legend' || type == 'rare' || type == 'epic') {
                            p.radius += 0.5;
                        }
                        else {
                            p.radius++;
                        }
                        p.location.x += (p.speed.x);
                        p.location.y += (p.speed.y);

                        if (p.death &lt; 0 || p.radius &lt; 0) {
                            if (typeof duration == 'number' &amp;&amp; time + 500 >= duration) {
                                particles.splice(i--, 1);
                            }
                            else {
                                particles[i] = new particle();
                            }
                        }
                    }
                    if (particles.length == 0) {
                        return false;
                    }
                });
            }
        },
        linexy: function (path) {
            var from = [path[0], path[1]];
            var to = [path[2], path[3]];
            var total = typeof arguments[1] === 'number' ? arguments[1] : lib.config.duration * 2;
            var opacity = 1;
            var color = [255, 255, 255];
            var dashed = false;
            var drag = false;
            if (typeof arguments[1] == 'object') {
                for (var i in arguments[1]) {
                    switch (i) {
                        case 'opacity': opacity = arguments[1][i]; break;
                        case 'color': color = arguments[1][i]; break;
                        case 'dashed': dashed = arguments[1][i]; break;
                        case 'duration': total = arguments[1][i]; break;
                    }
                }
            }
            else if (arguments[1] == 'fire' || arguments[1] == 'thunder' || arguments[1] == 'ocean' || arguments[1] == 'green') {
                color = arguments[1];
            }
            if (color == 'fire') {
                color = [255, 146, 68];
            }
            else if (color == 'thunder') {
                color = [141, 216, 255];
            }
            else if (color == 'ocean') {
                color = [98, 146, 240];
            }
            else if (color == 'green') {
                color = [141, 255, 216];
            }
            var node;
            if (arguments[1] == 'drag') {
                color = [236, 201, 71];
                drag = true;
                if (arguments[2]) {
                    node = arguments[2]
                }
                else {
                    node = ui.create.div('.linexy.drag');
                    node.style.left = from[0] + 'px';
                    node.style.top = from[1] + 'px';
                    node.style.background = 'linear-gradient(transparent,rgba(' + color.toString() + ',' + opacity + '),rgba(' + color.toString() + ',' + opacity + '))';
                    if (game.chess) {
                        ui.chess.appendChild(node);
                    }
                    else {
                        ui.arena.appendChild(node);
                    }
                }
            }
            else {
                node = ui.create.div('.linexy.hidden');
                node.style.left = from[0] + 'px';
                node.style.top = from[1] + 'px';
                node.style.background = 'linear-gradient(transparent,rgba(' + color.toString() + ',' + opacity + '),rgba(' + color.toString() + ',' + opacity + '))';
                node.style.transitionDuration = (total / 3000) + 's';
            }
            var dy = to[1] - from[1];
            var dx = to[0] - from[0];
            var deg = Math.atan(Math.abs(dy) / Math.abs(dx)) / Math.PI * 180;
            if (dx >= 0) {
                if (dy &lt;= 0) {
                    deg += 90;
                }
                else {
                    deg = 90 - deg;
                }
            }
            else {
                if (dy &lt;= 0) {
                    deg = 270 - deg;
                }
                else {
                    deg += 270;
                }
            }
            if (drag) {
                node.style.transform = 'rotate(' + (-deg) + 'deg)';
                node.style.height = get.xyDistance(from, to) + 'px';
            }
            else {
                node.style.transform = 'rotate(' + (-deg) + 'deg) scaleY(0)';
                node.style.height = get.xyDistance(from, to) + 'px';
                if (game.chess) {
                    ui.chess.appendChild(node);
                }
                else {
                    ui.arena.appendChild(node);
                }
                ui.refresh(node);
                node.show();
                node.style.transform = 'rotate(' + (-deg) + 'deg) scaleY(1)';
                node.listenTransition(function () {
                    setTimeout(function () {
                        if (node.classList.contains('removing')) return;
                        node.delete();
                    }, total / 3);
                });
            }
            return node;
        },
        _linexy: function (path) {
            var from = [path[0], path[1]];
            var to = [path[2], path[3]];
            var total = typeof arguments[1] === 'number' ? arguments[1] : lib.config.duration * 2;
            var opacity = 1;
            var color = [255, 255, 255];
            var dashed = false;
            if (typeof arguments[1] == 'object') {
                for (var i in arguments[1]) {
                    switch (i) {
                        case 'opacity': opacity = arguments[1][i]; break;
                        case 'color': color = arguments[1][i]; break;
                        case 'dashed': dashed = arguments[1][i]; break;
                        case 'duration': total = arguments[1][i]; break;
                    }
                }
            }
            else if (arguments[1] == 'fire' || arguments[1] == 'thunder' || arguments[1] == 'ocean' || arguments[1] == 'green') {
                color = arguments[1];
            }
            if (color == 'fire') {
                color = [255, 146, 68];
            }
            else if (color == 'thunder') {
                color = [141, 216, 255];
            }
            else if (color == 'ocean') {
                color = [98, 146, 250];
            }
            else if (color == 'green') {
                color = [141, 255, 216];
            }
            var drawfunc = function (time, ctx) {
                var current;
                if (time &lt; total / 3) {
                    ctx.strokeStyle = 'rgba(' + color.toString() + ',' + opacity * (time / (total / 3)) + ')';
                    current = [from[0] + (to[0] - from[0]) * time / (total / 3),
                    from[1] + (to[1] - from[1]) * time / (total / 3)];
                }
                else if (time &lt;= total) {
                    current = to;
                    if (time > total / 1.5) {
                        ctx.strokeStyle = 'rgba(' + color.toString() + ',' + opacity * (1 - (time - total / 1.5) / (total - total / 1.5)) + ')';
                    }
                    else {
                        ctx.strokeStyle = 'rgba(' + color.toString() + ',' + opacity + ')';
                    }
                }
                else {
                    return false;
                }
                ctx.beginPath();
                if (dashed) {
                    ctx.lineCap = 'butt';
                    ctx.setLineDash([8, 2]);
                }
                else {
                    ctx.lineCap = 'round';
                }
                ctx.moveTo(from[0], from[1]);
                ctx.lineTo(current[0], current[1]);
                ctx.stroke();
            };
            if (arguments[2] &amp;&amp; game.chess) {
                game.draw2(drawfunc);
            }
            else {
                game.draw(drawfunc);
            }
        },
        /**
         * trigger`trigger``trigger`
         * @param {string} name trigger name
         * @param {*} skill ID
         * @param {GameCores.GameObjects.Player} player 
         * @param {GameCores.Bases.Event} event trigger
         */
        createTrigger: function (name, skill, player, event) {
            if (player.isOut() || player.removed) return;
            if (player.isDead() &amp;&amp; !lib.skill[skill].forceDie) return;
            var next = game.createEvent('trigger', false);
            next.skill = skill;
            next.player = player;
            next.triggername = name;
            next.forceDie = true;
            next._trigger = event;
            next.setContent('createTrigger');
        },
        /**
         * 
         * @function
         * @param {string} name 
         * @param {?boolean} [canTriggered] truefalse
         * @param {?GameCores.Bases.Event} [triggerevent] {@link _status.event}
         */
        createEvent: function (name, trigger, triggerevent) {
            /**
             * 
             * {@link game.createEvent}
             * @namespace GameCores.Bases.Event
             */
            var next =
            /**@lends GameCores.Bases.Event */
            {
                /**
                 * 
                 * @type {string}
                 */
                name: name,
                /**
                 * 
                 * @type {string}
                 * @default 0
                 */
                step: 0,
                /**
                 * truefalse
                 * @type {boolean}
                 * @default false
                 */
                finished: false,
                /**
                 * 
                 * @type {!GameCores.Bases.Event[]}
                 */
                next: [],
                /**
                 * After
                 * `skipList`
                 * @type {GameCores.Bases.Event[]}
                 */
                after: [],
                custom: {//??
                    add: {},
                    replace: {}
                },
                _aiexclude: [],
                /**
                 * 
                 * @type {GameCores.GameObjects.Player[]}
                 */
                _notrigger: [],
                /**
                 * 
                 * @type {?Object}
                 */
                _result: {},
                _set: [],
            }
            if (trigger !== false &amp;&amp; !game.online) next._triggered = 0;
            for (var i in lib.element.event) {
                next[i] = lib.element.event[i];
            }
            (triggerevent || _status.event).next.push(next);
            return next;
        },
        /**
         * 
         * @param {*} name 
         * @param {*} info 
         */
        //TODO
        addCharacter: function (name, info) {
            var extname = (_status.extension || info.extension);
            var imgsrc;
            if (_status.evaluatingExtension) {
                imgsrc = 'db:extension-' + extname + ':' + name + '.jpg';
            }
            else {
                imgsrc = 'ext:' + extname + '/' + name + '.jpg';
            }
            var character = [info.sex, info.group, info.hp, info.skills || [], [imgsrc]];
            if (info.tags) {
                character[4] = character[4].concat(info.tags);
            }
            lib.character[name] = character;
            var packname = 'mode_extension_' + extname;
            if (!lib.characterPack[packname]) {
                lib.characterPack[packname] = {};
            }
            lib.translate[name] = info.translate;
            lib.characterPack[packname][name] = character;
            lib.translate[packname + '_character_config'] = extname;
        },
        /**
         * 
         * @param {*} pack 
         * @param {*} packagename 
         */
        //TODO
        addCharacterPack: function (pack, packagename) {
            var extname = _status.extension || '';
            packagename = packagename || extname;
            for (var i in pack) {
                if (i == 'mode' || i == 'forbid') continue;
                for (var j in pack[i]) {
                    if (i == 'character') {
                        if (!pack[i][j][4]) {
                            pack[i][j][4] = [];
                        }
                        var imgsrc;
                        if (_status.evaluatingExtension) {
                            imgsrc = 'db:extension-' + extname + ':' + j + '.jpg';
                        }
                        else {
                            imgsrc = 'ext:' + extname + '/' + j + '.jpg';
                        }
                        pack[i][j][4].push(imgsrc);
                        if (pack[i][j][4].contains('boss') ||
                            pack[i][j][4].contains('hiddenboss')) {
                            lib.config.forbidai.add(j);
                        }
                        if (lib.config.forbidai_user &amp;&amp; lib.config.forbidai_user.contains(j)) {
                            lib.config.forbidai.add(j);
                        }
                        for (var l = 0; l &lt; pack[i][j][3].length; l++) {
                            lib.skilllist.add(pack[i][j][3][l]);
                        }
                    }
                    else if (i == 'skill') {
                        if (typeof pack[i][j].audio == 'number' || typeof pack[i][j].audio == 'boolean') {
                            pack[i][j].audio = 'ext:' + extname + ':' + pack[i][j].audio;
                        }
                    }
                    if (lib[i][j] == undefined) {
                        lib[i][j] = pack[i][j];
                    }
                }
            }
            var packname = 'mode_extension_' + packagename;
            lib.characterPack[packname] = pack.character;
            lib.translate[packname + '_character_config'] = packagename;
        },
        /**
         * 
         */
        //TODO
        addCard: function (name, info, info2) {
            var extname = (_status.extension || info2.extension);
            if (info.audio == true) {
                info.audio = 'ext:' + extname;
            }
            if (info.fullskin) {
                if (_status.evaluatingExtension) {
                    info.image = 'db:extension-' + extname + ':' + name + '.png';
                }
                else {
                    info.image = 'ext:' + extname + '/' + name + '.png';
                }
            }
            else if (info.fullimage) {
                if (_status.evaluatingExtension) {
                    info.image = 'db:extension-' + extname + ':' + name + '.jpg';
                }
                else {
                    info.image = 'ext:' + extname + '/' + name + '.jpg';
                }
            }
            lib.card[name] = info;
            lib.translate[name] = info2.translate;
            lib.translate[name + '_info'] = info2.description;
            if (typeof info2.number == 'number') {
                var suits = ['heart', 'spade', 'diamond', 'club'];
                if (info2.color == 'red') {
                    suits = ['heart', 'diamond'];
                }
                else if (info2.color == 'black') {
                    suits = ['club', 'spade'];
                }
                for (var i = 0; i &lt; info2.number; i++) {
                    lib.card.list.push([suits[Math.floor(Math.random() * suits.length)], Math.ceil(Math.random() * 13), name]);
                }
            }
            var packname = 'mode_extension_' + extname;
            if (!lib.cardPack[packname]) {
                lib.cardPack[packname] = [];
                lib.translate[packname + '_card_config'] = extname;
            }
            lib.cardPack[packname].push(name);
        },
        /**
         * 
         * @param {Object} pack 
         * @param {string} packagename 
         */
        //TODO
        addCardPack: function (pack, packagename) {
            var extname = _status.extension || '';
            packagename = packagename || extname;
            var packname = 'mode_extension_' + packagename;
            lib.cardPack[packname] = [];
            lib.translate[packname + '_card_config'] = packagename;
            for (var i in pack) {
                if (i == 'mode' || i == 'forbid') continue;
                if (i == 'list') {
                    for (var j = 0; j &lt; pack[i].length; j++) {
                        lib.card.list.push(pack[i][j]);
                    }
                    continue;
                }
                for (var j in pack[i]) {
                    if (i == 'card') {
                        if (pack[i][j].audio == true) {
                            pack[i][j].audio = 'ext:' + extname;
                        }
                        if (pack[i][j].fullskin) {
                            if (_status.evaluatingExtension) {
                                pack[i][j].image = 'db:extension-' + extname + ':' + j + '.png';
                            }
                            else {
                                pack[i][j].image = 'ext:' + extname + '/' + j + '.png';
                            }
                        }
                        else if (pack[i][j].fullimage) {
                            if (_status.evaluatingExtension) {
                                pack[i][j].image = 'db:extension-' + extname + ':' + j + '.jpg';
                            }
                            else {
                                pack[i][j].image = 'ext:' + extname + '/' + j + '.jpg';
                            }
                        }
                        lib.cardPack[packname].push(j);
                    }
                    else if (i == 'skill') {
                        if (typeof pack[i][j].audio == 'number' || typeof pack[i][j].audio == 'boolean') {
                            pack[i][j].audio = 'ext:' + extname + ':' + pack[i][j].audio;
                        }
                    }
                    if (lib[i][j] == undefined) lib[i][j] = pack[i][j];
                }
            }
        },
        /**
         * 
         */
        //TODO
        addSkill: function (name, info, translate, description) {
            if (lib.skill[name]) {
                return false;
            }
            if (typeof info.audio == 'number' || typeof info.audio == 'boolean') {
                info.audio = 'ext:' + _status.extension + ':' + info.audio;
            }
            lib.skill[name] = info;
            lib.translate[name] = translate;
            lib.translate[name + '_info'] = description;
            return true;
        },
        /**
         * Mode
         * @param {string} name 
         * @param {string} info 
         * @param {string} info2
         * @deprecated [never used] 
         */
        addMode: function (name, info, info2) {
            lib.config.all.mode.push(name);
            lib.translate[name] = info2.translate;
            var imgsrc;
            var extname = _status.extension || info2.extension;
            if (_status.evaluatingExtension) {
                imgsrc = 'extension-' + extname + ':' + name + '.jpg';
            }
            else {
                imgsrc = 'ext:' + extname + '/' + name + '.jpg';
            }
            lib.mode[name] = {
                name: info2.translate,
                config: info2.config,
                splash: imgsrc,
                fromextension: true
            }
            lib.init['setMode_' + name] = function () {
                game.import('mode', function (lib, game, ui, get, ai, _status) {
                    info.name = name;
                    return info;
                });
            }
            if (!lib.config.extensionInfo[extname]) {
                lib.config.extensionInfo[extname] = {};
            }
            if (!lib.config.extensionInfo[extname].mode) {
                lib.config.extensionInfo[extname].mode = [];
            }
            if (lib.config.extensionInfo[extname].mode.indexOf(name) == -1) {
                lib.config.extensionInfo[extname].mode.push(name);
            }
            game.saveConfig('extensionMode', lib.config.extensionInfo);
        },
        /**
         * 
         * @param {string} skill 
         * @param {?string} player 
         * @deprecated [never used] 
         */
        addGlobalSkill: function (skill, player) {
            var info = lib.skill[skill];
            if (!info) return false;
            lib.skill.global.add(skill);
            if (player) {
                if (!lib.skill.globalmap[skill]) {
                    lib.skill.globalmap[skill] = [];
                }
                lib.skill.globalmap[skill].add(player);
            }
            if (info.trigger) {
                var setTrigger = function (i, evt) {
                    var name = i + '_' + evt;
                    if (!lib.hook.globalskill[name]) {
                        lib.hook.globalskill[name] = [];
                    }
                    lib.hook.globalskill[name].add(skill);
                    lib.hookmap[evt] = true;
                }
                for (var i in info.trigger) {
                    if (typeof info.trigger[i] == 'string') {
                        setTrigger(i, info.trigger[i]);
                    }
                    else if (Array.isArray(info.trigger[i])) {
                        for (var j = 0; j &lt; info.trigger[i].length; j++) {
                            setTrigger(i, info.trigger[i][j]);
                        }
                    }
                }
            }
            return true;
        },
        removeGlobalSkill: function (skill) {
            lib.skill.global.remove(skill);
            delete lib.skill.globalmap[skill];
            for (var i in lib.hook.globalskill) {
                lib.hook.globalskill[i].remove(skill);
            }
        },
        //
        resetSkills: function () {
            for (var i = 0; i &lt; game.players.length; i++) {
                for (var j in game.players[i].tempSkills) {
                    game.players[i].removeSkill(j);
                }
                var skills = game.players[i].getSkills();
                for (var j = 0; j &lt; skills.length; j++) {
                    if (lib.skill[skills[j]].vanish) {
                        game.players[i].removeSkill(skills[j]);
                    }
                }
                game.players[i].in(true);
            }
            ui.clear();
        },
        removeExtension: function (extname, keepfile) {
            var prefix = 'extension_' + extname;
            for (var i in lib.config) {
                if (i.indexOf(prefix) == 0) {
                    game.saveConfig(i);
                }
            }
            localStorage.removeItem(lib.configprefix + prefix);
            game.deleteDB('data', prefix);
            lib.config.extensions.remove(extname);
            game.saveConfig('extensions', lib.config.extensions);
            var modelist = lib.config.extensionInfo[extname];
            if (modelist) {
                if (modelist.image) {
                    for (var i = 0; i &lt; modelist.image.length; i++) {
                        game.deleteDB('image', 'extension-' + extname + ':' + modelist.image[i]);
                    }
                }
                if (modelist.mode) {
                    for (var i = 0; i &lt; modelist.mode.length; i++) {
                        game.clearModeConfig(modelist.mode[i]);
                    }
                }
                delete lib.config.extensionInfo[extname];
                game.saveConfig('extensionInfo', lib.config.extensionInfo);
            }
            if (game.download &amp;&amp; !keepfile) {
                if (lib.node &amp;&amp; lib.node.fs) {
                    try {
                        lib.node.fs.readdir(__dirname + '/extension/' + extname, function (err, list) {
                            if (err) {
                                return;
                            }
                            var removeFile = function () {
                                if (list.length) {
                                    var filename = list.shift();
                                    lib.node.fs.unlink(__dirname + '/extension/' + extname + '/' + filename, removeFile);
                                }
                                else {
                                    try {
                                        lib.node.fs.rmdir(__dirname + '/extension/' + extname, function () { });
                                    }
                                    catch (e) { }
                                }
                            }
                            removeFile();
                        });
                    }
                    catch (e) { }
                }
                else {
                    window.resolveLocalFileSystemURL(lib.assetURL + 'extension/' + extname, function (entry) {
                        entry.removeRecursively();
                    });
                }
            }
        },
        addRecentCharacter: function () {
            var list = get.config('recentCharacter') || [];
            for (var i = 0; i &lt; arguments.length; i++) {
                if (lib.character[arguments[i]]) {
                    list.remove(arguments[i]);
                    list.unshift(arguments[i]);
                }
            }
            var num = parseInt(lib.config.recent_character_number);
            if (list.length > num) {
                list.splice(num);
            }
            game.saveConfig('recentCharacter', list, true);
        },
        createCard: function (name, suit, number, nature, tags, specialEffects) {
            if (typeof name == 'object') {
                nature = name.nature;
                number = name.number;
                suit = name.suit;
                name = name.name;
                if (tags) tags = name.tags;
                if (specialEffects) specialEffects = name.specialEffects;
            }
            if (typeof name != 'string') {
                name = 'sha';
            }
            var noclick = false;
            if (suit == 'noclick') {
                noclick = true;
                suit = null;
            }
            if (!lib.card[name]) console.log(name);
            if (!suit &amp;&amp; lib.card[name] &amp;&amp; lib.card[name].cardcolor) {
                suit = lib.card[name].cardcolor;
            }
            if (!nature &amp;&amp; lib.card[name] &amp;&amp; lib.card[name].cardnature) {
                nature = lib.card[name].cardnature;
            }
            if (typeof suit != 'string') {
                suit = ['heart', 'diamond', 'club', 'spade'].randomGet();
            }
            else if (suit == 'black') {
                suit = Math.random() &lt; 0.5 ? 'club' : 'spade';
            }
            else if (suit == 'red') {
                suit = Math.random() &lt; 0.5 ? 'diamond' : 'heart';
            }
            if (typeof number != 'number' &amp;&amp; typeof number != 'string') {
                number = Math.ceil(Math.random() * 13);
            }
            var card;
            if (noclick) {
                card = ui.create.card(ui.special, 'noclick', true);
            }
            else {
                card = ui.create.card(ui.special);
            }
            card.storage.vanish = true;
            return card.init([suit, number, name, nature, tags, specialEffects]);
        },
        createCard2: function () {
            var card = game.createCard.apply(this, arguments);
            delete card.storage.vanish;
            return card;
        },
        forceOver: function (bool, callback) {
            _status.event.next.length = 0;
            var next = game.createEvent('finish_game');
            next.bool = bool;
            next.callback = callback;
            next.setContent('forceOver');
            if (_status.paused) {
                game.uncheck();
                game.resume();
            }
        },
        over: function (result) {
            if (_status.over) return;
            if (game.me._trueMe) game.swapPlayer(game.me._trueMe);
            var i, j, k, num, table, tr, td, dialog;
            _status.over = true;
            ui.control.show();
            ui.clear();
            game.stopCountChoose();
            if (ui.time3) {
                clearInterval(ui.time3.interval);
            }
            if ((game.layout == 'long2' || game.layout == 'nova') &amp;&amp; !game.chess) {
                ui.arena.classList.add('choose-character');
                ui.me.hide();
                ui.mebg.hide()
                ui.autonode.hide();
                if (lib.config.radius_size != 'off') {
                    ui.historybar.style.borderRadius = '0 0 0 4px';
                }
            }
            if (game.online) {
                var dialog = ui.create.dialog();
                dialog.noforcebutton = true;
                dialog.content.innerHTML = result;
                dialog.forcebutton = true;
                var result2 = arguments[1];
                if (result2 == true) {
                    dialog.content.firstChild.innerHTML = '';
                }
                else if (result2 == false) {
                    dialog.content.firstChild.innerHTML = '';
                }
                ui.update();
                dialog.add(ui.create.div('.placeholder'));
                for (var i = 0; i &lt; game.players.length; i++) {
                    var hs = game.players[i].getCards('h');
                    if (hs.length) {
                        dialog.add('&lt;div class="text center">' + get.translation(game.players[i]) + '&lt;/div>');
                        dialog.addSmall(hs);
                    }
                }

                for (var j = 0; j &lt; game.dead.length; j++) {
                    var hs = game.dead[j].getCards('h');
                    if (hs.length) {
                        dialog.add('&lt;div class="text center">' + get.translation(game.dead[j]) + '&lt;/div>');
                        dialog.addSmall(hs);
                    }
                }

                dialog.add(ui.create.div('.placeholder.slim'));
                if (lib.config.background_audio) {
                    if (result2 === true) {
                        game.playAudio('effect', 'win');
                    }
                    else if (result2 === false) {
                        game.playAudio('effect', 'lose');
                    }
                    else {
                        game.playAudio('effect', 'tie');
                    }
                }
                if (!ui.exit) {
                    ui.create.exit();
                }
                if (ui.giveup) {
                    ui.giveup.remove();
                    delete ui.giveup;
                }
                if (game.servermode) {
                    ui.exit.firstChild.innerHTML = '';
                    setTimeout(function () {
                        ui.exit.firstChild.innerHTML = '';
                        _status.roomtimeout = true;
                        lib.config.reconnect_info[2] = null;
                        game.saveConfig('reconnect_info', lib.config.reconnect_info);
                    }, 10000);
                }
                if (ui.tempnowuxie) {
                    ui.tempnowuxie.close();
                    delete ui.tempnowuxie;
                }
                if (ui.auto) ui.auto.hide();
                if (ui.wuxie) ui.wuxie.hide();
                if (game.getIdentityList) {
                    for (var i = 0; i &lt; game.players.length; i++) {
                        game.players[i].setIdentity();
                    }
                }
                return;
            }
            if (lib.config.background_audio) {
                if (result === true) {
                    game.playAudio('effect', 'win');
                }
                else if (result === false) {
                    game.playAudio('effect', 'lose');
                }
                else {
                    game.playAudio('effect', 'tie');
                }
            }
            var resultbool = result;
            if (typeof resultbool !== 'boolean') {
                resultbool = null;
            }
            if (result === true) result = '';
            if (result === false) result = '';
            if (result == undefined) result = '';
            dialog = ui.create.dialog(result);
            dialog.noforcebutton = true;
            dialog.forcebutton = true;
            if (game.addOverDialog) {
                game.addOverDialog(dialog, result);
            }
            if (typeof _status.coin == 'number' &amp;&amp; !_status.connectMode) {
                var coeff = Math.random() * 0.4 + 0.8;
                var added = 0;
                var betWin = false;
                if (result == '') {
                    if (_status.betWin) {
                        betWin = true;
                        _status.coin += 10;
                    }
                    _status.coin += 20;
                    if (_status.additionalReward) {
                        _status.coin += _status.additionalReward();
                    }
                    switch (lib.config.mode) {
                        case 'identity': {
                            switch (game.me.identity) {
                                case 'zhu': case 'zhong': case 'mingzhong':
                                    if (get.config('enhance_zhu')) {
                                        added = 10;
                                    }
                                    else {
                                        added = 20;
                                    }
                                    break;
                                case 'fan':
                                    if (get.config('enhance_zhu')) {
                                        added = 16;
                                    }
                                    else {
                                        added = 8;
                                    }
                                    break;
                                case 'nei':
                                    added = 40;
                                    break;
                            }
                            added = added * (game.players.length + game.dead.length) / 8;
                            break;
                        }
                        case 'guozhan':
                            if (game.me.identity == 'ye') {
                                added = 8;
                            }
                            else {
                                added = 5 / get.totalPopulation(game.me.identity);
                            }
                            added = added * (game.players.length + game.dead.length);
                            break;
                        case 'versus':
                            if (_status.friend) {
                                added = 5 * (game.players.length + _status.friend.length);
                            }
                            break;
                        default:
                            added = 10;
                    }
                }
                else {
                    added = 10;
                }
                if (lib.config.mode == 'chess' &amp;&amp; _status.mode == 'combat' &amp;&amp; get.config('additional_player')) {
                    added = 2;
                }
                _status.coin += added * coeff;
                if (_status.coinCoeff) {
                    _status.coin *= _status.coinCoeff;
                }
                _status.coin = Math.ceil(_status.coin);
                dialog.add(ui.create.div('', '' + _status.coin + ''));
                if (betWin) {
                    game.changeCoin(20);
                    dialog.content.appendChild(document.createElement('br'));
                    dialog.add(ui.create.div('', '10'));
                }
                game.changeCoin(_status.coin);
            }
            if (get.mode() == 'versus' &amp;&amp; _status.ladder) {
                var mmr = _status.ladder_mmr;
                mmr += 10 - get.rank(game.me.name, true) * 2;
                if (result == '') {
                    mmr = 20 + Math.round(mmr);
                    if (mmr > 40) {
                        mmr = 40;
                    }
                    else if (mmr &lt; 10) {
                        mmr = 10;
                    }
                    dialog.add(ui.create.div('', ' ' + mmr + ' '));
                }
                else {
                    mmr = -30 + Math.round(mmr / 2);
                    if (mmr > -20) {
                        mmr = -20;
                    }
                    else if (mmr &lt; -35) {
                        mmr = -35;
                    }
                    if (lib.storage.ladder.current &lt; 900) {
                        mmr = Math.round(mmr / 4);
                    }
                    else if (lib.storage.ladder.current &lt; 1400) {
                        mmr = Math.round(mmr / 2);
                    }
                    else if (lib.storage.ladder.current &lt; 2000) {
                        mmr = Math.round(mmr / 1.5);
                    }
                    else if (lib.storage.ladder.current > 2500) {
                        mmr = Math.round(mmr * 1.5);
                    }
                    dialog.add(ui.create.div('', ' ' + (-mmr) + ' '));
                }
                if (_status.ladder_tmp) {
                    lib.storage.ladder.current += 40;
                    delete _status.ladder_tmp;
                }
                lib.storage.ladder.current += mmr;
                if (lib.storage.ladder.top &lt; lib.storage.ladder.current) {
                    lib.storage.ladder.top = lib.storage.ladder.current;
                }
                game.save('ladder', lib.storage.ladder);
                if (ui.ladder &amp;&amp; game.getLadderName) {
                    ui.ladder.innerHTML = game.getLadderName(lib.storage.ladder.current);
                }
            }
            // if(true){
            var tableData = [];
            if (game.players.length) {
                table = document.createElement('table');
                tr = document.createElement('tr');
                tr.appendChild(document.createElement('td'));
                td = document.createElement('td');
                td.innerHTML = '';
                tr.appendChild(td);
                td = document.createElement('td');
                td.innerHTML = '';
                tr.appendChild(td);
                td = document.createElement('td');
                td.innerHTML = '';
                tr.appendChild(td);
                td = document.createElement('td');
                td.innerHTML = '';
                tr.appendChild(td);
                td = document.createElement('td');
                td.innerHTML = '';
                tr.appendChild(td);
                table.appendChild(tr);
                for (i = 0; i &lt; game.players.length; i++) {
                    var uploadDataRow = {}
                    tr = document.createElement('tr');
                    td = document.createElement('td');
                    td.innerHTML = get.translation(game.players[i]);
                    uploadDataRow.name = game.players[i].name; //
                    uploadDataRow.transName = td.innerHTML; //
                    uploadDataRow.nickname = game.players[i].nickname;//
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.players[i].stat.length; j++) {
                        if (game.players[i].stat[j].damage != undefined) num += game.players[i].stat[j].damage;
                    }
                    td.innerHTML = num;
                    uploadDataRow.damage = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.players[i].stat.length; j++) {
                        if (game.players[i].stat[j].damaged != undefined) num += game.players[i].stat[j].damaged;
                    }
                    td.innerHTML = num;
                    uploadDataRow.damaged = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.players[i].stat.length; j++) {
                        if (game.players[i].stat[j].gain != undefined) num += game.players[i].stat[j].gain;
                    }
                    td.innerHTML = num;
                    uploadDataRow.gain = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.players[i].stat.length; j++) {
                        for (k in game.players[i].stat[j].card) {
                            num += game.players[i].stat[j].card[k];
                        }
                    }
                    td.innerHTML = num;
                    uploadDataRow.card = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.players[i].stat.length; j++) {
                        if (game.players[i].stat[j].kill != undefined) num += game.players[i].stat[j].kill;
                    }
                    td.innerHTML = num;
                    uploadDataRow.kill = num; //
                    tr.appendChild(td);
                    table.appendChild(tr);
                    uploadDataRow.identity = get.translation(game.players[i].identity) //
                    uploadDataRow.alive = true; //
                    if (get.mode() == 'identity') {	//
                        if (game.zhu.isAlive()) {
                            if (game.players[i].identity == 'fan' || game.players[i].identity == 'nei') {
                                uploadDataRow.winner = false;
                            }
                            else {
                                uploadDataRow.winner = true;
                            }
                        }
                        else {
                            if (game.players.length == 1) {
                                if (game.players[i].identity == 'zhong')
                                    uploadDataRow.winner = false;
                                else
                                    uploadDataRow.winner = true;
                            }
                            else {
                                if (game.players[i].identity == 'fan') {
                                    uploadDataRow.winner = true;
                                }
                                else
                                    uploadDataRow.winner = false;
                            }
                        }
                    }
                    else if (get.mode() == 'guozhan') {
                        uploadDataRow.winner = true;
                    }
                    else {
                        uploadDataRow.winner = true;
                    }
                    tableData.push(uploadDataRow)
                }
                dialog.add(ui.create.div('.placeholder'));
                dialog.content.appendChild(table);
            }
            if (game.dead.length) {
                table = document.createElement('table');
                table.style.opacity = '0.5';
                if (game.players.length == 0) {
                    tr = document.createElement('tr');
                    tr.appendChild(document.createElement('td'));
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    table.appendChild(tr);
                }
                for (i = 0; i &lt; game.dead.length; i++) {
                    var uploadDataRow = {}
                    tr = document.createElement('tr');
                    td = document.createElement('td');
                    td.innerHTML = get.translation(game.dead[i]);
                    uploadDataRow.name = game.dead[i].name;//
                    uploadDataRow.transName = td.innerHTML; //
                    uploadDataRow.nickname = game.dead[i].nickname;//
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.dead[i].stat.length; j++) {
                        if (game.dead[i].stat[j].damage != undefined) num += game.dead[i].stat[j].damage;
                    }
                    td.innerHTML = num;
                    uploadDataRow.damage = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.dead[i].stat.length; j++) {
                        if (game.dead[i].stat[j].damaged != undefined) num += game.dead[i].stat[j].damaged;
                    }
                    td.innerHTML = num;
                    uploadDataRow.damaged = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.dead[i].stat.length; j++) {
                        if (game.dead[i].stat[j].gain != undefined) num += game.dead[i].stat[j].gain;
                    }
                    td.innerHTML = num;
                    uploadDataRow.gain = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.dead[i].stat.length; j++) {
                        for (k in game.dead[i].stat[j].card) {
                            num += game.dead[i].stat[j].card[k];
                        }
                    }
                    td.innerHTML = num;
                    uploadDataRow.card = num; //
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.dead[i].stat.length; j++) {
                        if (game.dead[i].stat[j].kill != undefined) num += game.dead[i].stat[j].kill;
                    }
                    td.innerHTML = num;
                    uploadDataRow.kill = num; //
                    tr.appendChild(td);
                    table.appendChild(tr);
                    uploadDataRow.identity = get.translation(game.dead[i].identity); //
                    uploadDataRow.alive = false; //
                    if (get.mode() == 'identity') {	//
                        if (game.zhu.isAlive()) {
                            if (game.dead[i].identity == 'fan' || game.dead[i].identity == 'nei') {
                                uploadDataRow.winner = false;
                            }
                            else {
                                uploadDataRow.winner = true;
                            }
                        }
                        else {
                            if (game.players.length == 1) {
                                if (game.players[0].identity == 'nei') {
                                    uploadDataRow.winner = false;
                                }
                                else if (game.players[0].identity == 'fan') {
                                    if (game.dead[i].identity == 'fan')
                                        uploadDataRow.winner = true;
                                    else
                                        uploadDataRow.winner = false;
                                }
                            }
                            else {
                                if (game.dead[i].identity == 'fan') {
                                    uploadDataRow.winner = true;
                                }
                                else
                                    uploadDataRow.winner = false;
                            }
                        }
                    }
                    else if (get.mode() == 'guozhan') {
                        if (game.players[0] &amp;&amp; (game.dead[i].identity == game.players[0])) {
                            if (game.dead[i].identity != 'ye') {
                                uploadDataRow.winner = true;
                            }
                            else {
                                uploadDataRow.winner = false;
                            }
                        }
                        else
                            uploadDataRow.winner = false;
                    }
                    else {
                        if (game.players[0] &amp;&amp; (game.dead[i].identity == game.players[0])) {
                            if (game.dead[i].identity != 'ye') {
                                uploadDataRow.winner = true;
                            }
                            else {
                                uploadDataRow.winner = false;
                            }
                        }
                    }
                    tableData.push(uploadDataRow)
                }
                dialog.add(ui.create.div('.placeholder'));
                dialog.content.appendChild(table);
            }
            var nowType = 'other'
            if (get.mode() == 'identity') nowType = 'identity'
            else if (get.mode() == 'guozhan') nowType = 'guozhan'
            var uploadData = { type: nowType, playerRecords: tableData }
            if (game.onlinezhu) {
                try {
                    var xhr = new XMLHttpRequest();
                    var sendForm = new FormData();
                    sendForm.append('data', JSON.stringify(uploadData))
                    xhr.open('post', 'https://data.vtuberkill.com/game-records/', (e) => { console.log(e) })
                    xhr.send(sendForm);
                }
                catch (e) {
                    console.log(e);
                }
            }
            if (game.additionaldead &amp;&amp; game.additionaldead.length) {
                table = document.createElement('table');
                table.style.opacity = '0.5';
                for (i = 0; i &lt; game.additionaldead.length; i++) {
                    tr = document.createElement('tr');
                    td = document.createElement('td');
                    td.innerHTML = get.translation(game.additionaldead[i]);
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.additionaldead[i].stat.length; j++) {
                        if (game.additionaldead[i].stat[j].damage != undefined) num += game.additionaldead[i].stat[j].damage;
                    }
                    td.innerHTML = num;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.additionaldead[i].stat.length; j++) {
                        if (game.additionaldead[i].stat[j].damaged != undefined) num += game.additionaldead[i].stat[j].damaged;
                    }
                    td.innerHTML = num;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.additionaldead[i].stat.length; j++) {
                        if (game.additionaldead[i].stat[j].gain != undefined) num += game.additionaldead[i].stat[j].gain;
                    }
                    td.innerHTML = num;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.additionaldead[i].stat.length; j++) {
                        for (k in game.additionaldead[i].stat[j].card) {
                            num += game.additionaldead[i].stat[j].card[k];
                        }
                    }
                    td.innerHTML = num;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    num = 0;
                    for (j = 0; j &lt; game.additionaldead[i].stat.length; j++) {
                        if (game.additionaldead[i].stat[j].kill != undefined) num += game.additionaldead[i].stat[j].kill;
                    }
                    td.innerHTML = num;
                    tr.appendChild(td);
                    table.appendChild(tr);
                }
                dialog.add(ui.create.div('.placeholder'));
                dialog.content.appendChild(table);
            }
            // }
            dialog.add(ui.create.div('.placeholder'));

            var clients = game.players.concat(game.dead);
            for (var i = 0; i &lt; clients.length; i++) {
                if (clients[i].isOnline2()) {
                    clients[i].send(game.over, dialog.content.innerHTML, game.checkOnlineResult(clients[i]));
                }
            }

            dialog.add(ui.create.div('.placeholder'));

            for (var i = 0; i &lt; game.players.length; i++) {
                if (!_status.connectMode &amp;&amp; game.players[i].isUnderControl(true) &amp;&amp; game.layout != 'long2') continue;
                var hs = game.players[i].getCards('h');
                if (hs.length) {
                    dialog.add('&lt;div class="text center">' + get.translation(game.players[i]) + '&lt;/div>');
                    dialog.addSmall(hs);
                }
            }
            for (var i = 0; i &lt; game.dead.length; i++) {
                if (!_status.connectMode &amp;&amp; game.dead[i].isUnderControl(true) &amp;&amp; game.layout != 'long2') continue;
                var hs = game.dead[i].getCards('h');
                if (hs.length) {
                    dialog.add('&lt;div class="text center">' + get.translation(game.dead[i]) + '&lt;/div>');
                    dialog.addSmall(hs);
                }
            }
            dialog.add(ui.create.div('.placeholder.slim'));
            game.addVideo('over', null, dialog.content.innerHTML);
            var vinum = parseInt(lib.config.video);
            if (!_status.video &amp;&amp; vinum &amp;&amp; game.getVideoName &amp;&amp; window.indexedDB &amp;&amp; _status.videoInited) {
                var store = lib.db.transaction(['video'], 'readwrite').objectStore('video');
                var videos = lib.videos.slice(0);
                for (var i = 0; i &lt; videos.length; i++) {
                    if (videos[i].starred) {
                        videos.splice(i--, 1);
                    }
                }
                for (var deletei = 0; deletei &lt; 5; deletei++) {
                    if (videos.length >= vinum) {
                        var toremove = videos.pop();
                        lib.videos.remove(toremove);
                        store.delete(toremove.time);
                    }
                    else {
                        break;
                    }
                }
                var me = game.me || game.players[0];
                if (!me) return;
                var newvid = {
                    name: game.getVideoName(),
                    mode: lib.config.mode,
                    video: lib.video,
                    win: result == '',
                    name1: me.name1 || me.name,
                    name2: me.name2,
                    time: lib.getUTC(new Date())
                };
                var modecharacters = lib.characterPack['mode_' + get.mode()];
                if (modecharacters) {
                    if (get.mode() == 'guozhan') {
                        if (modecharacters[newvid.name1]) {
                            if (newvid.name1.indexOf('gz_shibing') == 0) {
                                newvid.name1 = newvid.name1.slice(3, 11);
                            }
                            else {
                                newvid.name1 = newvid.name1.slice(3);
                            }
                        }
                        if (modecharacters[newvid.name2]) {
                            if (newvid.name2.indexOf('gz_shibing') == 0) {
                                newvid.name2 = newvid.name2.slice(3, 11);
                            }
                            else {
                                newvid.name2 = newvid.name2.slice(3);
                            }
                        }
                    }
                    else {
                        if (modecharacters[newvid.name1]) {
                            newvid.name1 = get.mode() + '::' + newvid.name1;
                        }
                        if (modecharacters[newvid.name2]) {
                            newvid.name2 = get.mode() + '::' + newvid.name2;
                        }
                    }
                }
                if (newvid.name1 &amp;&amp; newvid.name1.indexOf('subplayer_') == 0) {
                    newvid.name1 = newvid.name1.slice(10, newvid.name1.lastIndexOf('_'));
                }
                if (newvid.name2 &amp;&amp; newvid.name2.indexOf('subplayer_') == 0) {
                    newvid.name1 = newvid.name2.slice(10, newvid.name1.lastIndexOf('_'));
                }
                lib.videos.unshift(newvid);
                store.put(newvid);
                ui.create.videoNode(newvid, true);
            }
            // _status.auto=false;
            if (ui.auto) {
                // ui.auto.classList.remove('glow');
                ui.auto.hide();
            }
            if (ui.wuxie) ui.wuxie.hide();
            if (ui.giveup) {
                ui.giveup.remove();
                delete ui.giveup;
            }

            if (lib.config.test_game &amp;&amp; !_status.connectMode) {
                if (typeof lib.config.test_game !== 'string') {
                    switch (lib.config.mode) {
                        case 'identity': game.saveConfig('mode', 'guozhan'); break;
                        case 'guozhan': game.saveConfig('mode', 'versus'); break;
                        case 'versus': game.saveConfig('mode', 'boss'); break;
                        case 'boss': game.saveConfig('mode', 'chess'); break;
                        case 'chess': game.saveConfig('mode', 'stone'); break;
                        case 'stone': game.saveConfig('mode', 'identity'); break;
                    }
                }
                setTimeout(game.reload, 500);
            }
            if (game.controlOver) {
                game.controlOver(); return;
            }
            if (!_status.brawl) {
                if (lib.config.mode == 'boss') {
                    ui.create.control('', function () {
                        var pointer = game.boss;
                        var map = { boss: game.me == game.boss, links: [] };
                        for (var iwhile = 0; iwhile &lt; 10; iwhile++) {
                            pointer = pointer.nextSeat;
                            if (pointer == game.boss) {
                                break;
                            }
                            if (!pointer.side) {
                                map.links.push(pointer.name);
                            }
                        }
                        game.saveConfig('continue_name_boss', map);
                        game.saveConfig('mode', lib.config.mode);
                        localStorage.setItem(lib.configprefix + 'directstart', true);
                        game.reload();
                    });
                }
                else if (lib.config.mode == 'versus') {
                    if (_status.mode == 'standard' || _status.mode == 'three') {
                        ui.create.control('', function () {
                            game.saveConfig('continue_name_versus' + (_status.mode == 'three' ? '_three' : ''), {
                                friend: _status.friendBackup,
                                enemy: _status.enemyBackup,
                                color: _status.color
                            });
                            game.saveConfig('mode', lib.config.mode);
                            localStorage.setItem(lib.configprefix + 'directstart', true);
                            game.reload();
                        });
                    }
                }
                else if (!_status.connectMode &amp;&amp; get.config('continue_game') &amp;&amp; !ui.continue_game &amp;&amp; !_status.brawl &amp;&amp; !game.no_continue_game) {
                    ui.continue_game = ui.create.control('', game.reloadCurrent);
                }
            }
            if (!ui.restart) {
                if (game.onlineroom &amp;&amp; typeof game.roomId == 'number') {
                    ui.restart = ui.create.control('restart', function () {
                        game.broadcastAll(function () {
                            if (ui.exit) {
                                ui.exit.stay = true;
                                ui.exit.firstChild.innerHTML = '';
                            }
                        });
                        game.saveConfig('tmp_owner_roomId', game.roomId);
                        setTimeout(game.reload, 100);
                    });
                }
                else {
                    ui.restart = ui.create.control('restart', game.reload);
                }
            }
            if (ui.tempnowuxie) {
                ui.tempnowuxie.close();
                delete ui.tempnowuxie;
            }

            if (ui.revive) {
                ui.revive.close();
                delete ui.revive;
            }
            if (ui.swap) {
                ui.swap.close();
                delete ui.swap;
            }
            for (var i = 0; i &lt; lib.onover.length; i++) {
                lib.onover[i](resultbool);
            }
            if (game.addRecord) {
                game.addRecord(resultbool);
            }
            if (window.isNonameServer) {
                lib.configOL.gameStarted = false;
                game.saveConfig('pagecfg' + window.isNonameServer, [lib.configOL, game.roomId, _status.onlinenickname, _status.onlineavatar]);
                game.reload();
            }
            else if (_status.connectMode &amp;&amp; !game.online) {
                setTimeout(game.reload, 15000)
            }
        },
        /**
         * 
         * @function
         */
        loop: function () {
            var event = _status.event;
            var step = event.step;
            var source = event.source;
            var player = event.player;
            var target = event.target;
            var targets = event.targets;
            var card = event.card;
            var cards = event.cards;
            var skill = event.skill;
            var forced = event.forced;
            var num = event.num;
            var trigger = event._trigger;
            var result = event._result;
            if (_status.paused2 || _status.imchoosing) {
                if (!lib.status.dateDelaying) {
                    lib.status.dateDelaying = new Date();
                }
            }
            if (_status.paused || _status.paused2 || _status.over) {
                return;
            }
            if (_status.paused3) {
                _status.paused3 = 'paused';
                return;
            }
            if (lib.status.dateDelaying) {
                lib.status.dateDelayed += lib.getUTC(new Date()) - lib.getUTC(lib.status.dateDelaying);
                delete lib.status.dateDelaying;
            }
            if (event.next.length > 0) {
                var next = event.next.shift();
                if (next.player &amp;&amp; next.player.skipList.contains(next.name)) {
                    event.trigger(next.name + 'Skipped');
                    next.player.skipList.remove(next.name);
                    if (lib.phaseName.contains(next.name)) next.player.getHistory('skipped').add(next.name);
                }
                else {
                    /**
                     * _status.event.parent(event.parent)
                     * _status.event.next_status.event.after
                     * @name _status.event_parent
                     * @type {!Object}
                     */
                    next.parent = event;
                    /**
                     * _status.event.player(event.player)
                     * @name _status.event_player
                     * @type {!HTMLDivElement}
                     */
                    /**
                     * _status.event.target(event.target)
                     * @name _status.event_target
                     * @type {!HTMLDivElement}
                     */
                    _status.event = next;
                }
            }
            else if (event.finished) {
                if (event._triggered == 1) {
                    if (event.type == 'card') event.trigger('useCardToOmitted');
                    event.trigger(event.name + 'Omitted');
                    event._triggered = 4;
                }
                else if (event._triggered == 2) {
                    if (event.type == 'card') event.trigger('useCardToEnd');
                    event.trigger(event.name + 'End');
                    event._triggered = 3;
                }
                else if (event._triggered == 3) {
                    if (event.type == 'card') event.trigger('useCardToAfter');
                    event.trigger(event.name + 'After');
                    event._triggered++;
                }
                else if (event.after &amp;&amp; event.after.length) {
                    var next = event.after.shift();
                    if (next.player &amp;&amp; next.player.skipList.contains(next.name)) {
                        event.trigger(next.name + 'Skipped');
                        next.player.skipList.remove(next.name);
                        if (lib.phaseName.contains(next.name)) next.player.getHistory('skipped').add(next.name)
                    }
                    else {
                        next.parent = event;
                        _status.event = next;
                    }
                }
                else {
                    if (event.parent) {
                        if (event.result) {
                            event.parent._result = event.result;
                        }
                        _status.event = event.parent;
                    }
                    else {
                        return;
                    }
                }
            }
            else {
                if (event._triggered == 0) {
                    if (event.type == 'card') event.trigger('useCardToBefore');
                    event.trigger(event.name + 'Before');
                    event._triggered++;
                }
                else if (event._triggered == 1) {
                    if (event.type == 'card') event.trigger('useCardToBegin');
                    if (event.name == 'phase' &amp;&amp; !event._begun) {
                        var next = game.createEvent('phasing', false, event);
                        next.player = event.player;
                        next.skill = event.skill;
                        next.setContent('phasing');
                        event._begun = true;
                    }
                    else {
                        event.trigger(event.name + 'Begin');
                        event._triggered++;
                    }
                }
                else {
                    if (player &amp;&amp; player.classList.contains('dead') &amp;&amp; !event.forceDie &amp;&amp; event.name != 'phaseLoop') {
                        game.broadcastAll(function () {
                            while (_status.dieClose.length) {
                                _status.dieClose.shift().close();
                            }
                        });
                        if (event._oncancel) {
                            event._oncancel();
                        }
                        event.finish();
                    }
                    else if (player &amp;&amp; player.removed &amp;&amp; event.name != 'phaseLoop') {
                        event.finish();
                    }
                    else if (player &amp;&amp; player.isOut() &amp;&amp; event.name != 'phaseLoop' &amp;&amp; !event.includeOut) {
                        if (event.name == 'phase' &amp;&amp; player == _status.roundStart &amp;&amp; !event.skill) {
                            _status.roundSkipped = true;
                        }
                        event.finish();
                    }
                    else {
                        if (_status.withError || lib.config.compatiblemode || (_status.connectMode &amp;&amp; !lib.config.debug)) {
                            try {
                                event.content(event, step, source, player, target, targets,
                                    card, cards, skill, forced, num, trigger, result,
                                    _status, lib, game, ui, get, ai);
                            }
                            catch (e) {
                                game.print('' + event.name);
                                game.print(e.toString());
                                console.log(e);
                            }
                        }
                        else {
                            event.content(event, step, source, player, target, targets,
                                card, cards, skill, forced, num, trigger, result,
                                _status, lib, game, ui, get, ai);
                        }
                    }
                    event.step++;
                }
            }
            game.loop();
        },
        pause: function () {
            clearTimeout(_status.timeout);
            _status.paused = true;
        },
        pause2: function () {
            if (_status.connectMode) return;
            _status.paused2 = true;
        },
        resume: function () {
            if (_status.paused) {
                if (!_status.noclearcountdown) {
                    game.stopCountChoose();
                }
                _status.paused = false;
                delete _status.waitingForTransition;
                game.loop();
            }
        },
        resume2: function () {
            if (_status.connectMode) return;
            if (_status.paused2) {
                _status.paused2 = false;
                game.loop();
            }
        },
        delay: function (time, time2) {
            if (_status.paused) return;
            game.pause();
            if (typeof time != 'number') time = 1;
            if (typeof time2 != 'number') time2 = 0;
            time = time * lib.config.duration + time2;
            if (lib.config.speed == 'vvfast') time /= 3;
            _status.timeout = setTimeout(game.resume, time);
        },
        delayx: function (time, time2) {
            if (typeof time != 'number') time = 1;
            switch (lib.config.game_speed) {
                case 'vslow': time *= 2.5; break;
                case 'slow': time *= 1.5; break;
                case 'fast': time *= 0.7; break;
                case 'vfast': time *= 0.4; break;
                case 'vvfast': time *= 0.2; break;
            }
            return game.delay(time, time2);
        },
        /**
         * (`event.filterButton``event.filterCard``event.filterTarget`)
         * @param {?GameCores.Bases.Event} event null
         * @returns {(undefined|boolean)} undefinedtruefalse
         */
        check: function (event) {
            var i, j, range;
            if (event == undefined) event = _status.event;
            var custom = event.custom || {};
            var ok = true, auto = true;
            var player = event.player;
            var auto_confirm = lib.config.auto_confirm;
            var players = game.players.slice(0);
            if (event.deadTarget) players.addArray(game.dead);
            if (!event.filterButton &amp;&amp; !event.filterCard &amp;&amp; !event.filterTarget &amp;&amp; (!event.skill || !event._backup)) {
                if (event.choosing) {
                    _status.imchoosing = true;//??
                }
                return;
            }
            player.node.equips.classList.remove('popequip');
            //button
            if (event.filterButton) {
                var dialog = event.dialog;
                range = get.select(event.selectButton);
                var selectableButtons = false;
                if (event.forceAuto &amp;&amp; ui.selected.buttons.length == range[1]) auto = true;
                else if (range[0] != range[1] || range[0] > 1) auto = false;
                for (i = 0; i &lt; dialog.buttons.length; i++) {
                    if (dialog.buttons[i].classList.contains('unselectable')) continue;
                    if (event.filterButton(dialog.buttons[i], player) &amp;&amp; lib.filter.buttonIncluded(dialog.buttons[i])) {
                        if (ui.selected.buttons.length &lt; range[1]) {
                            dialog.buttons[i].classList.add('selectable');
                        }
                        else if (range[1] == -1) {
                            dialog.buttons[i].classList.add('selected');
                            ui.selected.buttons.add(dialog.buttons[i]);
                        }
                        else {
                            dialog.buttons[i].classList.remove('selectable');
                        }
                    }
                    else {
                        dialog.buttons[i].classList.remove('selectable');
                        if (range[1] == -1) {
                            dialog.buttons[i].classList.remove('selected');
                            ui.selected.buttons.remove(dialog.buttons[i]);
                        }
                    }
                    if (dialog.buttons[i].classList.contains('selected')) {
                        dialog.buttons[i].classList.add('selectable');
                    }
                    else if (!selectableButtons &amp;&amp; dialog.buttons[i].classList.contains('selectable')) {
                        selectableButtons = true;
                    }
                }
                if (ui.selected.buttons.length &lt; range[0]) {
                    if (!event.forced || selectableButtons) {
                        ok = false;
                    }
                    if (event.complexSelect || event.getParent().name == 'chooseCharacter' || event.getParent().name == 'chooseButtonOL') {
                        ok = false;
                    }
                }
                if (custom.add.button) {
                    custom.add.button();
                }
            }
            //card
            if (event.filterCard) {
                if (ok == false) {
                    game.uncheck('card');
                }
                else {
                    var cards = player.getCards(event.position);
                    var firstCheck = false;
                    range = get.select(event.selectCard);
                    if (!event._cardChoice &amp;&amp; typeof event.selectCard != 'function' &amp;&amp;
                        !event.complexCard &amp;&amp; range[1] != -1 &amp;&amp; !lib.config.compatiblemode) {
                        event._cardChoice = [];
                        firstCheck = true;
                    }
                    if (event.isMine() &amp;&amp; event.name == 'chooseToUse' &amp;&amp; event.parent.name == 'phaseUse' &amp;&amp; !event.skill &amp;&amp;
                        !event._targetChoice &amp;&amp; !firstCheck &amp;&amp; window.Map &amp;&amp; !lib.config.compatiblemode) {
                        event._targetChoice = new Map();
                        for (var i = 0; i &lt; event._cardChoice.length; i++) {
                            if (!lib.card[event._cardChoice[i].name].complexTarget) {
                                var targets = [];
                                for (var j = 0; j &lt; players.length; j++) {
                                    if (event.filterTarget(event._cardChoice[i], player, players[j])) {
                                        targets.push(players[j]);
                                    }
                                }
                                event._targetChoice.set(event._cardChoice[i], targets);
                            }
                        }
                    }
                    var selectableCards = false;
                    if (range[0] != range[1] || range[0] > 1) auto = false;
                    for (i = 0; i &lt; cards.length; i++) {
                        if (lib.config.cardtempname != 'off') {
                            var cardname = get.name(cards[i]);
                            var cardnature = get.nature(cards[i]);
                            if (cards[i].name != cardname || ((cardnature || cards[i].nature) &amp;&amp; cards[i].nature != cardnature)) {
                                if (!cards[i]._tempName) cards[i]._tempName = ui.create.div('.tempname', cards[i]);
                                var tempname = get.translation(cardname);
                                cards[i]._tempName.dataset.nature = 'fire';
                                if (cardname == 'sha') {
                                    if (cardnature) tempname = get.translation(cardnature) + tempname;
                                    if (cardnature == 'thunder') cards[i]._tempName.dataset.nature = 'thunder';
                                    if (cardnature == 'kami') cards[i]._tempName.dataset.nature = 'kami';
                                    if (cardnature == 'ice') cards[i]._tempName.dataset.nature = 'ice';
                                    if (cardnature == 'ocean') cards[i]._tempName.dataset.nature = 'ocean';
                                    if (cardnature == 'yami') cards[i]._tempName.dataset.nature = 'yami';
                                }
                                cards[i]._tempName.innerHTML = lib.config.cardtempname == 'default' ? get.verticalStr(tempname) : tempname;
                                cards[i]._tempName.tempname = tempname;
                            }
                        }
                        var nochess = true;
                        if (!lib.filter.cardAiIncluded(cards[i])) {
                            nochess = false;
                        }
                        else if (event._cardChoice &amp;&amp; !firstCheck) {
                            if (!event._cardChoice.contains(cards[i])) {
                                nochess = false;
                            }
                        }
                        else {
                            if (player.isOut() || !lib.filter.cardRespondable(cards[i], player) ||
                                cards[i].classList.contains('uncheck') ||
                                !event.filterCard(cards[i], player)) {
                                nochess = false;
                            }
                        }
                        if (nochess) {
                            if (ui.selected.cards.length &lt; range[1]) {
                                cards[i].classList.add('selectable');
                                if (event._cardChoice &amp;&amp; firstCheck) {
                                    event._cardChoice.push(cards[i]);
                                }
                            }
                            else if (range[1] == -1) {
                                cards[i].classList.add('selected');
                                cards[i].updateTransform(true);
                                ui.selected.cards.add(cards[i]);
                            }
                            else {
                                cards[i].classList.remove('selectable');
                            }
                        }
                        else {
                            cards[i].classList.remove('selectable');
                            if (range[1] == -1) {
                                cards[i].classList.remove('selected');
                                cards[i].updateTransform();
                                ui.selected.cards.remove(cards[i]);
                            }
                        }
                        if (cards[i].classList.contains('selected')) {
                            cards[i].classList.add('selectable');
                        }
                        else if (!selectableCards &amp;&amp; cards[i].classList.contains('selectable')) {
                            selectableCards = true;
                        }
                    }
                    if (ui.selected.cards.length &lt; range[0]) {
                        if (!event.forced || selectableCards || event.complexSelect) {
                            ok = false;
                        }
                    }

                    if (lib.config.popequip &amp;&amp; get.is.phoneLayout() &amp;&amp;
                        typeof event.position == 'string' &amp;&amp; event.position.indexOf('e') != -1 &amp;&amp;
                        player.node.equips.querySelector('.card.selectable')) {
                        player.node.equips.classList.add('popequip');
                        auto_confirm = false;
                    }
                }
                if (custom.add.card) {
                    custom.add.card();
                }
            }
            //player
            if (event.filterTarget) {
                if (ok == false) {
                    game.uncheck('target');
                }
                else {
                    var card = get.card();
                    var firstCheck = false;
                    range = get.select(event.selectTarget);
                    var selectableTargets = false;
                    if (range[0] != range[1] || range[0] > 1) auto = false;
                    for (i = 0; i &lt; players.length; i++) {
                        var nochess = true;
                        if (game.chess &amp;&amp; !event.chessForceAll &amp;&amp; player &amp;&amp; get.distance(player, players[i], 'pure') > 7) {
                            nochess = false;
                        }
                        else if (players[i].isOut()) {
                            nochess = false;
                        }
                        else if (event._targetChoice &amp;&amp; event._targetChoice.has(card)) {
                            var targetChoice = event._targetChoice.get(card);
                            if (!Array.isArray(targetChoice) || !targetChoice.contains(players[i])) {
                                nochess = false;
                            }
                        }
                        else if (!event.filterTarget(card, player, players[i])) {
                            nochess = false;
                        }
                        if (nochess) {
                            if (ui.selected.targets.length &lt; range[1]) {
                                players[i].classList.add('selectable');
                                if (Array.isArray(event._targetChoice)) {
                                    event._targetChoice.push(players[i]);
                                }
                            }
                            else if (range[1] == -1) {
                                players[i].classList.add('selected');
                                ui.selected.targets.add(players[i]);
                            }
                            else {
                                players[i].classList.remove('selectable');
                            }
                        }
                        else {
                            players[i].classList.remove('selectable');
                            if (range[1] == -1) {
                                players[i].classList.remove('selected');
                                ui.selected.targets.remove(players[i]);
                            }
                        }
                        if (players[i].classList.contains('selected')) {
                            players[i].classList.add('selectable');
                        }
                        else if (!selectableTargets &amp;&amp; players[i].classList.contains('selectable')) {
                            selectableTargets = true;
                        }
                        if (players[i].instance) {
                            if (players[i].classList.contains('selected')) {
                                players[i].instance.classList.add('selected');
                            }
                            else {
                                players[i].instance.classList.remove('selected');
                            }
                            if (players[i].classList.contains('selectable')) {
                                players[i].instance.classList.add('selectable');
                            }
                            else {
                                players[i].instance.classList.remove('selectable');
                            }
                        }
                    }
                    if (ui.selected.targets.length &lt; range[0]) {
                        if (!event.forced || selectableTargets || event.complexSelect) {
                            ok = false;
                        }
                    }
                    if (range[1] == -1 &amp;&amp; ui.selected.targets.length == 0 &amp;&amp; event.targetRequired) {
                        ok = false;
                    }
                }
                if (custom.add.target) {
                    custom.add.target();
                }
            }
            //skill
            if (!event.skill &amp;&amp; get.noSelected() &amp;&amp; !_status.noconfirm) {
                var skills = [], enable, info;
                var skills2;
                if (event._skillChoice) {
                    skills2 = event._skillChoice;
                    for (var i = 0; i &lt; skills2.length; i++) {
                        if (event.isMine() || !event._aiexclude.contains(skills2[i])) {
                            skills.push(skills2[i]);
                        }
                    }
                }
                else {
                    var skills2;
                    if (get.mode() == 'guozhan' &amp;&amp; player.hasSkillTag('nomingzhi', false, null, true)) {
                        skills2 = player.getSkills(false, true, false);
                    }
                    else {
                        skills2 = player.getSkills(true, true, false);
                    }
                    skills2 = game.filterSkills(skills2.concat(lib.skill.global), player, player.getSkills('e').concat(lib.skill.global));
                    event._skillChoice = [];
                    game.expandSkills(skills2);
                    for (i = 0; i &lt; skills2.length; i++) {
                        _status.event.skillBy = skills2[i];
                        info = get.info(skills2[i]);
                        enable = false;
                        if (typeof info.enable == 'function') enable = info.enable(event);
                        else if (typeof info.enable == 'object') enable = info.enable.contains(event.name);
                        else if (info.enable == 'phaseUse') enable = (event.type == 'phase');
                        else if (typeof info.enable == 'string') enable = (info.enable == event.name);
                        if (enable) {
                            if (!game.expandSkills(player.getSkills().concat(lib.skill.global)).contains(skills2[i]) &amp;&amp; (info.noHidden || get.mode() != 'guozhan' || player.hasSkillTag('nomingzhi', false, null, true))) enable = false;
                            if (info.filter &amp;&amp; !info.filter(event, player)) enable = false;
                            if (info.viewAs &amp;&amp; typeof info.viewAs != 'function' &amp;&amp; event.filterCard &amp;&amp; !event.filterCard(info.viewAs, player, event)) enable = false;
                            if (info.viewAs &amp;&amp; typeof info.viewAs != 'function' &amp;&amp; info.viewAsFilter &amp;&amp; info.viewAsFilter(player) == false) enable = false;
                            if (info.usable &amp;&amp; get.skillCount(skills2[i]) >= info.usable) enable = false;
                            if (info.chooseButton &amp;&amp; _status.event.noButton) enable = false;
                            if (info.round &amp;&amp; (player.storage[_status.event.skillBy + '_roundcount'] > 0)) enable = false;
                        }
                        if (enable) {
                            if (event.isMine() || !event._aiexclude.contains(skills2[i])) {
                                skills.add(skills2[i]);
                            }
                            event._skillChoice.add(skills2[i]);
                        }
                        delete _status.event.skillBy;
                    }
                }

                var globalskills = [];
                var globallist = lib.skill.global.slice(0);
                game.expandSkills(globallist);
                for (var i = 0; i &lt; skills.length; i++) {
                    if (globallist.contains(skills[i])) {
                        globalskills.push(skills.splice(i--, 1)[0]);
                    }
                }
                var equipskills = [];
                var ownedskills = player.getSkills(true, false);
                game.expandSkills(ownedskills);
                for (var i = 0; i &lt; skills.length; i++) {
                    if (!ownedskills.contains(skills[i])) {
                        equipskills.push(skills.splice(i--, 1)[0]);
                    }
                }
                if (equipskills.length) {
                    ui.create.skills3(equipskills);
                }
                else if (ui.skills3) {
                    ui.skills3.close();
                }
                if (skills.length) {
                    ui.create.skills(skills);
                }
                else if (ui.skills) {
                    ui.skills.close();
                }
                if (globalskills.length) {
                    ui.create.skills2(globalskills);
                }
                else if (ui.skills2) {
                    ui.skills2.close();
                }
            }
            else {
                if (ui.skills) {
                    ui.skills.close()
                }
                if (ui.skills2) {
                    ui.skills2.close()
                }
                if (ui.skills3) {
                    ui.skills3.close()
                }
            }
            //is multipled targets
            _status.multitarget = false;
            var skillinfo = get.info(_status.event.skill);
            if (_status.event.name == 'chooseToUse') {
                if (skillinfo &amp;&amp; skillinfo.multitarget &amp;&amp; !skillinfo.multiline) {
                    _status.multitarget = true;
                }
                if ((skillinfo &amp;&amp; skillinfo.viewAs &amp;&amp; typeof skillinfo.viewAs != 'function') || !_status.event.skill) {
                    var cardinfo = get.info(get.card());
                    if (cardinfo &amp;&amp; cardinfo.multitarget &amp;&amp; !cardinfo.multiline) {
                        _status.multitarget = true;
                    }
                }
            }
            else if (_status.event.multitarget) {
                _status.multitarget = true;
            }

            if (event.isMine()) {
                if (game.chess &amp;&amp; game.me &amp;&amp; get.config('show_distance')) {
                    for (var i = 0; i &lt; players.length; i++) {
                        if (players[i] == game.me) {
                            players[i].node.action.hide();
                        }
                        else {
                            players[i].node.action.show();
                            var dist = get.distance(game.me, players[i], 'pure');
                            var dist2 = get.distance(game.me, players[i]);
                            players[i].node.action.innerHTML = '' + dist2 + '/' + dist;
                            if (dist > 7) {
                                players[i].node.action.classList.add('thunder');
                            }
                            else {
                                players[i].node.action.classList.remove('thunder');
                            }
                        }
                    }
                }
                if (ok &amp;&amp; auto &amp;&amp; (auto_confirm || (skillinfo &amp;&amp; skillinfo.direct)) &amp;&amp; (!_status.mousedragging || !_status.mouseleft) &amp;&amp;
                    !_status.mousedown &amp;&amp; !_status.touchnocheck) {
                    if (ui.confirm) {
                        if (!skillinfo || !skillinfo.preservecancel) {
                            ui.confirm.close();
                        }
                    }
                    if (skillinfo &amp;&amp; skillinfo.preservecancel &amp;&amp; !ui.confirm) {
                        ui.create.confirm('c');
                    }
                    if (event.skillDialog == true) event.skillDialog = false;
                    ui.click.ok();
                    _status.mousedragging = null;
                }
                else {
                    ui.arena.classList.add('selecting');
                    if (event.filterTarget &amp;&amp; (!event.filterCard || !event.position || (typeof event.position == 'string' &amp;&amp; event.position.indexOf('e') == -1))) {
                        ui.arena.classList.add('tempnoe');
                    }
                    game.countChoose();
                    if (!_status.noconfirm &amp;&amp; !_status.event.noconfirm) {
                        if (!_status.mousedown || _status.mouseleft) {
                            var str = '';
                            if (ok) str += 'o';
                            if (!event.forced &amp;&amp; !event.fakeforce &amp;&amp; get.noSelected()) str += 'c';
                            ui.create.confirm(str);
                        }
                    }
                }
                if (ui.confirm &amp;&amp; ui.confirm.lastChild.link == 'cancel') {
                    if (_status.event.type == 'phase' &amp;&amp; !_status.event.skill) {
                        ui.confirm.lastChild.innerHTML = '';
                    }
                    else {
                        ui.confirm.lastChild.innerHTML = '';
                    }
                }
            }
            return ok;
        },
        uncheck: function () {
            var i, j;
            if (game.chess) {
                var shadows = ui.chessContainer.getElementsByClassName('playergrid temp');
                while (shadows.length) {
                    shadows[0].remove();
                }
            }
            var argc = arguments.length;
            var args = new Array(argc);
            for (var i = 0; i &lt; argc; i++) {
                args[i] = arguments[i];
            }
            if ((args.length == 0 || args.contains('card')) &amp;&amp; _status.event.player) {
                var cards = _status.event.player.getCards('hejs');
                for (j = 0; j &lt; cards.length; j++) {
                    cards[j].classList.remove('selected');
                    cards[j].classList.remove('selectable');
                    if (cards[j]._tempName) {
                        cards[j]._tempName.delete();
                        delete cards[j]._tempName;
                    }
                    cards[j].updateTransform();
                }
                ui.selected.cards.length = 0;
                _status.event.player.node.equips.classList.remove('popequip');
            }
            var players = game.players.slice(0);
            if (_status.event.deadTarget) players.addArray(game.dead);
            if ((args.length == 0 || args.contains('target'))) {
                for (j = 0; j &lt; players.length; j++) {
                    players[j].classList.remove('selected');
                    players[j].classList.remove('selectable');
                    if (players[j].instance) {
                        players[j].instance.classList.remove('selected');
                        players[j].instance.classList.remove('selectable');
                    }
                }
                ui.selected.targets.length = 0;
            }
            if ((args.length == 0 || args.contains('button')) &amp;&amp; _status.event.dialog &amp;&amp; _status.event.dialog.buttons) {
                for (var j = 0; j &lt; _status.event.dialog.buttons.length; j++) {
                    _status.event.dialog.buttons[j].classList.remove('selectable');
                    _status.event.dialog.buttons[j].classList.remove('selected');
                }
                ui.selected.buttons.length = 0;
            }
            if (args.length == 0) {
                ui.arena.classList.remove('selecting');
                ui.arena.classList.remove('tempnoe');
                _status.imchoosing = false;
                _status.lastdragchange.length = 0;
                _status.mousedragging = null;
                _status.mousedragorigin = null;

                while (ui.touchlines.length) {
                    ui.touchlines.shift().delete();
                }
            }
            ui.canvas.width = ui.arena.offsetWidth;
            ui.canvas.height = ui.arena.offsetHeight;
            for (var i = 0; i &lt; players.length; i++) {
                players[i].unprompt();
            }
            for (var i = 0; i &lt; _status.dragline.length; i++) {
                if (_status.dragline[i]) _status.dragline[i].remove();
            }
            ui.arena.classList.remove('dragging');
            _status.dragline.length = 0;
        },
        swapSeat: function (player1, player2, prompt, behind, noanimate) {
            if (noanimate) {
                player1.style.transition = 'all 0s';
                player2.style.transition = 'all 0s';
                ui.refresh(player1);
                ui.refresh(player2);
            }
            if (behind) {
                var totalPopulation = game.players.length + game.dead.length + 1;
                for (var iwhile = 0; iwhile &lt; totalPopulation; iwhile++) {
                    if (player1.next != player2) {
                        game.swapSeat(player1, player1.next, false, false);
                    }
                    else {
                        break;
                    }
                }
                if (prompt != false) {
                    game.log(player1, '', player2, '');
                }
            }
            else {
                game.addVideo('swapSeat', null, [player1.dataset.position, player2.dataset.position]);
                var temp1, pos, i, num;
                temp1 = player1.dataset.position;
                player1.dataset.position = player2.dataset.position;
                player2.dataset.position = temp1;
                game.arrangePlayers();
                if (!game.chess) {
                    if (player1.dataset.position == '0' || player2.dataset.position == '0') {
                        pos = parseInt(player1.dataset.position);
                        if (pos == 0) pos = parseInt(player2.dataset.position);
                        num = game.players.length + game.dead.length;
                        for (i = 0; i &lt; game.players.length; i++) {
                            temp1 = parseInt(game.players[i].dataset.position) - pos;
                            if (temp1 &lt; 0) temp1 += num;
                            game.players[i].dataset.position = temp1;
                        }
                        for (i = 0; i &lt; game.dead.length; i++) {
                            temp1 = parseInt(game.dead[i].dataset.position) - pos;
                            if (temp1 &lt; 0) temp1 += num;
                            game.dead[i].dataset.position = temp1;
                        }
                    }
                }
                if (prompt != false) {
                    game.log(player1, '', player2, '');
                }
            }
            if (noanimate) {
                setTimeout(function () {
                    player1.style.transition = '';
                    player2.style.transition = '';
                }, 200);
            }
        },
        swapPlayer: function (player, player2) {
            if (player2) {
                if (player == game.me) game.swapPlayer(player2);
                else if (player2 == game.me) game.swapPlayer(player);
            }
            else {
                if (player == game.me) return;
                var players = game.players.concat(game.dead);
                for (var i = 0; i &lt; players.length; i++) {
                    players[i].style.transition = 'all 0s';
                }
                game.addVideo('swapPlayer', player, get.cardsInfo(player.getCards('h')));
                if (!game.chess) {
                    var pos = parseInt(player.dataset.position);
                    var num = game.players.length + game.dead.length;
                    var players = game.players.concat(game.dead);
                    var temp;
                    for (var i = 0; i &lt; players.length; i++) {
                        temp = parseInt(players[i].dataset.position) - pos;
                        if (temp &lt; 0) temp += num;
                        players[i].dataset.position = temp;
                    }
                }
                game.me.node.handcards1.remove();
                game.me.node.handcards2.remove();
                var current = game.me;
                game.me = player;
                if (current.isDead()) {
                    current.$die();
                }
                ui.handcards1 = player.node.handcards1.animate('start').fix();
                ui.handcards2 = player.node.handcards2.animate('start').fix();
                ui.handcards1Container.appendChild(ui.handcards1);
                ui.handcards2Container.appendChild(ui.handcards2);

                ui.updatehl();
            }
            if (game.me.isAlive()) {
                if (ui.auto) ui.auto.show();
                if (ui.wuxie) ui.wuxie.show();
                if (ui.revive) {
                    ui.revive.close();
                    delete ui.revive;
                }
                if (ui.swap) {
                    ui.swap.close();
                    delete ui.swap;
                }
                if (ui.restart) {
                    ui.restart.close();
                    delete ui.restart;
                }
                if (ui.continue_game) {
                    ui.continue_game.close();
                    delete ui.continue_game;
                }
            }
            if (lib.config.mode == 'identity') {
                game.me.setIdentity(game.me.identity);
            }
            setTimeout(function () {
                for (var i = 0; i &lt; players.length; i++) {
                    players[i].style.transition = '';
                }
            }, 100);
        },
        swapControl: function (player) {
            if (player == game.me) return;

            game.me.node.handcards1.remove();
            game.me.node.handcards2.remove();

            game.me = player;
            ui.handcards1 = player.node.handcards1.animate('start').fix();
            ui.handcards2 = player.node.handcards2.animate('start').fix();
            ui.handcards1Container.insertBefore(ui.handcards1, ui.handcards1Container.firstChild);
            ui.handcards2Container.insertBefore(ui.handcards2, ui.handcards2Container.firstChild);
            ui.updatehl();
            game.addVideo('swapControl', player, get.cardsInfo(player.getCards('h')));

            if (game.me.isAlive()) {
                if (ui.auto) ui.auto.show();
                if (ui.wuxie) ui.wuxie.show();
                if (ui.revive) {
                    ui.revive.close();
                    delete ui.revive;
                }
                if (ui.swap) {
                    ui.swap.close();
                    delete ui.swap;
                }
                if (ui.restart) {
                    ui.restart.close();
                    delete ui.restart;
                }
                if (ui.continue_game) {
                    ui.continue_game.close();
                    delete ui.continue_game;
                }
            }
        },
        swapPlayerAuto: function (player) {
            if (game.modeSwapPlayer) {
                game.modeSwapPlayer(player);
            }
            else {
                game.swapPlayer(player);
            }
        },
        findNext: function (player) {
            var players = get.players(lib.sort.position);
            var position = parseInt(player.dataset.position);
            for (var i = 0; i &lt; players.length; i++) {
                if (parseInt(players[i].dataset.position) >= position) {
                    return players[i];
                }
            }
            return players[0];
        },
        loadModeAsync: function (name, callback) {
            window.game = game;
            var script = lib.init.js(lib.assetURL + 'mode', name, function () {
                if (!lib.config.dev) delete window.game;
                script.remove();
                var content = lib.imported.mode[name];
                delete lib.imported.mode[name];
                if (get.is.empty(lib.imported.mode)) {
                    delete lib.imported.mode;
                }
                callback(content);
            });
        },
        switchMode: function (name, configx) {
            if (!lib.layoutfixed.contains(name)) {
                if (lib.config.layout != game.layout) {
                    lib.init.layout(lib.config.layout);
                }
                else if (lib.config.mode == 'brawl') {
                    if (lib.config.player_border == 'normal' &amp;&amp; (game.layout == 'long' || game.layout == 'long2')) {
                        ui.arena.classList.add('lslim_player');
                    }
                }
            }
            window.game = game;
            var script = lib.init.js(lib.assetURL + 'mode', name, function () {
                if (!lib.config.dev) delete window.game;
                script.remove();
                var mode = lib.imported.mode;
                _status.sourcemode = lib.config.mode;
                lib.config.mode = name;

                var i, j, k;
                for (i in mode[lib.config.mode].element) {
                    if (!lib.element[i]) lib.element[i] = [];
                    for (j in mode[lib.config.mode].element[i]) {
                        if (j == 'init') {
                            if (!lib.element[i].inits) lib.element[i].inits = [];
                            lib.element[i].inits.push(mode[lib.config.mode].element[i][j]);
                        }
                        else {
                            lib.element[i][j] = mode[lib.config.mode].element[i][j];
                        }
                    }
                }
                for (i in mode[lib.config.mode].ai) {
                    if (typeof mode[lib.config.mode].ai[i] == 'object') {
                        if (ai[i] == undefined) ai[i] = {};
                        for (j in mode[lib.config.mode].ai[i]) {
                            ai[i][j] = mode[lib.config.mode].ai[i][j];
                        }
                    }
                    else {
                        ai[i] = mode[lib.config.mode].ai[i];
                    }
                }
                for (i in mode[lib.config.mode].ui) {
                    if (typeof mode[lib.config.mode].ui[i] == 'object') {
                        if (ui[i] == undefined) ui[i] = {};
                        for (j in mode[lib.config.mode].ui[i]) {
                            ui[i][j] = mode[lib.config.mode].ui[i][j];
                        }
                    }
                    else {
                        ui[i] = mode[lib.config.mode].ui[i];
                    }
                }
                for (i in mode[lib.config.mode].game) {
                    game[i] = mode[lib.config.mode].game[i];
                }
                for (i in mode[lib.config.mode].get) {
                    get[i] = mode[lib.config.mode].get[i];
                }
                if (game.onwash) {
                    lib.onwash.push(game.onwash);
                    delete game.onwash;
                }
                if (game.onover) {
                    lib.onover.push(game.onover);
                    delete game.onover;
                }
                lib.config.banned = lib.config[lib.config.mode + '_banned'] || [];
                lib.config.bannedcards = lib.config[lib.config.mode + '_bannedcards'] || [];

                for (i in mode[lib.config.mode]) {
                    if (i == 'element') continue;
                    if (i == 'game') continue;
                    if (i == 'ai') continue;
                    if (i == 'ui') continue;
                    if (i == 'get') continue;
                    if (i == 'config') continue;
                    if (i == 'start') continue;
                    if (i == 'startBefore') continue;
                    if (lib[i] == undefined) lib[i] = (Array.isArray(mode[lib.config.mode][i])) ? [] : {};
                    for (j in mode[lib.config.mode][i]) {
                        lib[i][j] = mode[lib.config.mode][i][j];
                    }
                }

                // var pilecfg=lib.config.customcardpile[get.config('cardpilename')];
                // if(pilecfg){
                //     lib.config.bannedpile=pilecfg[0]||{};
                //     lib.config.addedpile=pilecfg[1]||{};
                // }

                _status.event = {
                    finished: true,
                    next: [],
                    after: []
                };
                _status.paused = false;

                if (_status.connectMode &amp;&amp; lib.mode[name].connect) {
                    game.saveConfig('connect_mode', name);
                    game.clearConnect();
                    lib.configOL.mode = name;
                    if (configx) {
                        for (var i in configx) {
                            lib.configOL[i] = configx[i];
                        }
                    }
                    else {
                        for (var i in lib.mode[name].connect) {
                            if (i == 'update') continue;
                            lib.configOL[i.slice(8)] = get.config(i);
                        }
                        lib.configOL.characterPack = lib.connectCharacterPack.slice(0);
                        lib.configOL.cardPack = lib.connectCardPack.slice(0);
                        for (var i = 0; i &lt; lib.config.connect_characters.length; i++) {
                            lib.configOL.characterPack.remove(lib.config.connect_characters[i]);
                        }
                        for (var i = 0; i &lt; lib.config.connect_cards.length; i++) {
                            lib.configOL.cardPack.remove(lib.config.connect_cards[i]);
                        }
                        lib.configOL.banned = lib.config['connect_' + name + '_banned'];
                        lib.configOL.bannedcards = lib.config['connect_' + name + '_bannedcards'];
                    }
                    lib.configOL.version = lib.versionOL;
                    for (var i in lib.cardPackList) {
                        if (lib.configOL.cardPack.contains(i)) {
                            lib.card.list = lib.card.list.concat(lib.cardPackList[i]);
                        }
                    }
                    for (i = 0; i &lt; lib.card.list.length; i++) {
                        if (lib.card.list[i][2] == 'huosha') {
                            lib.card.list[i] = lib.card.list[i].slice(0);
                            lib.card.list[i][2] = 'sha';
                            lib.card.list[i][3] = 'fire';
                        }
                        else if (lib.card.list[i][2] == 'leisha') {
                            lib.card.list[i] = lib.card.list[i].slice(0);
                            lib.card.list[i][2] = 'sha';
                            lib.card.list[i][3] = 'thunder';
                        }
                        else if (lib.card.list[i][2] == 'haisha') {
                            lib.card.list[i] = lib.card.list[i].slice(0);
                            lib.card.list[i][2] = 'sha';
                            lib.card.list[i][3] = 'ocean';
                        }
                        else if (lib.card.list[i][2] == 'yamisha') {
                            lib.card.list[i] = lib.card.list[i].slice(0);
                            lib.card.list[i][2] = 'sha';
                            lib.card.list[i][3] = 'yami';
                        }
                        if (lib.card.list[i][2] == 'haitao') {
                            lib.card.list[i] = lib.card.list[i].slice(0);
                            lib.card.list[i][2] = 'tao';
                            lib.card.list[i][3] = 'ocean';
                        }
                        if (lib.card.list[i][2] == 'haijiu') {
                            lib.card.list[i] = lib.card.list[i].slice(0);
                            lib.card.list[i][2] = 'jiu';
                            lib.card.list[i][3] = 'ocean';
                        }
                        if (!lib.card[lib.card.list[i][2]]) {
                            lib.card.list.splice(i, 1); i--;
                        }
                        else if (lib.card[lib.card.list[i][2]].mode &amp;&amp;
                            lib.card[lib.card.list[i][2]].mode.contains(lib.config.mode) == false) {
                            lib.card.list.splice(i, 1); i--;
                        }
                    }
                }

                if (!lib.config.show_playerids || !game.showIdentity) {
                    ui.playerids.style.display = 'none';
                }
                else {
                    ui.playerids.style.display = '';
                }

                if (mode[lib.config.mode].startBefore) mode[lib.config.mode].startBefore();
                game.createEvent('game', false).setContent(mode[lib.config.mode].start);
                if (lib.mode[lib.config.mode] &amp;&amp; lib.mode[lib.config.mode].fromextension) {
                    var startstr = mode[lib.config.mode].start.toString();
                    if (startstr.indexOf('onfree') == -1) {
                        setTimeout(lib.init.onfree, 500);
                    }
                }
                delete lib.imported.mode[name];

                if (!lib.db) {
                    try {
                        lib.storage = JSON.parse(localStorage.getItem(lib.configprefix + lib.config.mode));
                        if (typeof lib.storage != 'object') throw ('err');
                        if (lib.storage == null) throw ('err');
                    }
                    catch (err) {
                        lib.storage = {};
                        localStorage.setItem(lib.configprefix + lib.config.mode, "{}");
                    }
                    game.loop();
                }
                else {
                    game.getDB('data', lib.config.mode, function (obj) {
                        lib.storage = obj || {};
                        game.loop();
                    });
                }
            });
        },
        loadMode: function (mode) {
            var next = game.createEvent('loadMode', false);
            next.mode = mode;
            next.setContent('loadMode');
        },
        loadPackage: function () {
            var next = game.createEvent('loadPackage');
            next.packages = [];
            for (var i = 0; i &lt; arguments.length; i++) {
                if (typeof arguments[i] == 'string') {
                    next.packages.push(arguments[i]);
                }
            }
            next.setContent('loadPackage');
        },
        phaseLoop: function (player) {
            var next = game.createEvent('phaseLoop');
            next.player = player;
            next.setContent('phaseLoop');
        },
        gameDraw: function (player, num) {
            var next = game.createEvent('gameDraw');
            next.player = player || game.me;
            if (num == undefined) next.num = 4;
            else next.num = num;
            next.setContent('gameDraw');
            return next;
        },
        chooseCharacterDouble: function () {
            var next = game.createEvent('chooseCharacter', false);
            var config, width, num, ratio, func, update, list, first;
            for (var i = 0; i &lt; arguments.length; i++) {
                if (typeof arguments[i] == 'number') {
                    if (!width) {
                        width = arguments[i];
                    }
                    else if (!num) {
                        num = arguments[i];
                    }
                    else {
                        ratio = arguments[i];
                    }
                }
                else if (typeof arguments[i] == 'function') {
                    if (!func) {
                        func = arguments[i];
                    }
                    else {
                        update = arguments[i];
                    }
                }
                else if (Array.isArray(arguments[i])) {
                    list = arguments[i];
                }
                else if (get.objtype(arguments[i]) == 'object') {
                    config = arguments[i];
                }
            }
            if (!config) {
                list = config;
                config = {};
            }
            config.width = config.width || width || 8;
            config.height = 4;
            config.size = config.width * config.height;
            config.num = config.num || num || 3;
            config.ratio = config.ratio || ratio || 1.2;
            config.update = config.update || update;
            if (!config.hasOwnProperty('first')) {
                if (typeof first == 'boolean') {
                    config.first = first;
                }
                else {
                    config.first = 'rand';
                }
            }
            if (!list) {
                list = [];
                for (var i in lib.character) {
                    if (typeof func == 'function') {
                        if (!func(i)) continue;
                    }
                    else {
                        if (lib.filter.characterDisabled(i)) continue;
                    }
                    list.push(i);
                }
            }
            next.config = config;
            next.list = list;
            next.setContent(function () {
                'step 0'
                event.nodes = [];
                event.avatars = [];
                event.friend = [];
                event.enemy = [];
                event.blank = [];
                for (var i = 0; i &lt; event.config.size; i++) {
                    event.nodes.push(ui.create.div('.shadowed.reduce_radius.choosedouble'));
                }
                event.moveAvatar = function (node, i) {
                    if (!node.classList.contains('moved')) {
                        event.blank.push(node.index);
                    }
                    event.nodes[node.index].style.display = '';
                    event.nodes[node.index].show();
                    clearTimeout(event.nodes[node.index].choosetimeout);
                    event.moveNode(node, i);
                    var nodex = event.nodes[node.index];
                    nodex.choosetimeout = setTimeout(function () {
                        nodex.hide();
                        nodex.choosetimeout = setTimeout(function () {
                            nodex.show();
                            nodex.style.display = 'none';
                        }, 300);
                    }, 400);
                };
                event.aiMove = function (friend) {
                    var list = [];
                    for (var i = 0; i &lt; event.avatars.length; i++) {
                        if (!event.avatars[i].classList.contains('moved')) {
                            list.push(event.avatars[i]);
                        }
                    }
                    for (var i = 0; i &lt; list.length; i++) {
                        if (Math.random() &lt; 0.7 || i == list.length - 1) {
                            if (friend) {
                                event.moveAvatar(list[i], event.friend.length + event.config.width * (event.config.height - 1));
                                event.friend.push(list[i]);
                            }
                            else {
                                event.moveAvatar(list[i], event.enemy.length);
                                event.enemy.push(list[i]);
                            }
                            list[i].classList.add('moved');
                            break;
                        }
                    }
                };
                event.promptbar = ui.create.div('.hidden', ui.window);
                event.promptbar.style.width = '100%';
                event.promptbar.style.left = 0;
                if (get.is.phoneLayout()) {
                    event.promptbar.style.top = '20px';
                }
                else {
                    event.promptbar.style.top = '58px';
                }
                event.promptbar.style.pointerEvents = 'none';
                event.promptbar.style.textAlign = 'center';
                event.promptbar.style.zIndex = '2';
                ui.create.div('.shadowed.reduce_radius', event.promptbar);
                event.promptbar.firstChild.style.fontSize = '18px';
                event.promptbar.firstChild.style.padding = '6px 10px';
                event.promptbar.firstChild.style.position = 'relative';
                event.prompt = function (str) {
                    event.promptbar.firstChild.innerHTML = str;
                    event.promptbar.show();
                };
                event.moveNode = function (node, i) {
                    var width = event.width, height = event.height, margin = event.margin;
                    var left = -(width + 10) * event.config.width / 2 + 5 + (i % event.config.width) * (width + 10);
                    var top = -(height + 10) * event.config.height / 2 + 5 + Math.floor(i / event.config.width) * (height + 10) + margin / 2;
                    node.style.transform = 'translate(' + left + 'px,' + top + 'px)';
                    node.index = i;
                };
                event.resize = function () {
                    var margin = 0;
                    if (!get.is.phoneLayout()) {
                        margin = 38;
                    }
                    var height = (ui.window.offsetHeight - 10 * (event.config.height + 1) - margin) / event.config.height;
                    var width = (ui.window.offsetWidth - 10 * (event.config.width + 1)) / event.config.width;
                    if (width * event.config.ratio &lt; height) {
                        height = width * event.config.ratio;
                    }
                    else {
                        width = height / event.config.ratio;
                    }
                    event.width = width;
                    event.height = height;
                    event.margin = margin;
                    for (var i = 0; i &lt; event.config.size; i++) {
                        event.moveNode(event.nodes[i], i);
                        event.nodes[i].style.width = width + 'px';
                        event.nodes[i].style.height = height + 'px';
                        if (event.avatars[i]) {
                            event.moveNode(event.avatars[i], event.avatars[i].index);
                            event.avatars[i].style.width = width + 'px';
                            event.avatars[i].style.height = height + 'px';
                            event.avatars[i].nodename.style.fontSize = Math.max(14, Math.round(width / 5.6)) + 'px';
                        }
                    }
                    if (event.deciding) {
                        var str = 'px,' + (event.margin / 2 - event.height * 0.5) + 'px)';
                        for (var i = 0; i &lt; event.friendlist.length; i++) {
                            event.friendlist[i].style.transform = 'scale(1.2) translate(' + (-(event.width + 14) * event.friendlist.length / 2 + 7 + i * (event.width + 14)) + str;
                        }
                    }
                };
                lib.onresize.push(event.resize);
                event.clickAvatar = function () {
                    if (event.deciding) {
                        if (this.index &lt; event.config.width) return;
                        if (event.friendlist.contains(this)) {
                            event.friendlist.remove(this);
                            event.moveNode(this, this.index);
                            this.nodename.innerHTML = get.slimName(this.link);
                        }
                        else {
                            event.friendlist.push(this);
                        }
                        if (event.friendlist.length == event.config.num) {
                            event.deciding = false;
                            event.prompt('');
                            setTimeout(game.resume, 1000);
                        }
                        if (event.config.update) {
                            for (var i = 0; i &lt; event.friendlist.length; i++) {
                                event.friendlist[i].nodename.innerHTML = event.config.update(i, event.friendlist.length) || event.friendlist[i].nodename.innerHTML;
                            }
                        }
                        var str = 'px,' + (event.margin / 2 - event.height * 0.5) + 'px)';
                        for (var i = 0; i &lt; event.friendlist.length; i++) {
                            event.friendlist[i].style.transform = 'scale(1.2) translate(' + (-(event.width + 14) * event.friendlist.length / 2 + 7 + i * (event.width + 14)) + str;
                        }
                    }
                    else {
                        if (!event.imchoosing) return;
                        if (event.replacing) {
                            this.link = event.replacing;
                            this.setBackground(event.replacing, 'character');

                            this.nodename.innerHTML = get.slimName(event.replacing);
                            this.nodename.dataset.nature = get.groupnature(lib.character[event.replacing][1]);

                            delete event.replacing;
                            if (this.classList.contains('moved')) {
                                event.custom.add.window();
                            }
                        }
                        if (this.classList.contains('moved')) return;
                        event.moveAvatar(this, event.friend.length + event.config.width * (event.config.height - 1));
                        event.friend.push(this.link);
                        this.classList.add('moved');
                        game.resume();
                    }
                };
                event.skipnode = ui.create.system('', function () {
                    this.remove();
                    event._skiprest = true;
                    if (event.imchoosing) {
                        game.resume();
                    }
                });
                if (get.config('change_choice')) {
                    event.replacenode = ui.create.system('', function () {
                        event.promptbar.hide();
                        while (event.avatars.length) {
                            event.avatars.shift().remove();
                        }
                        for (var i = 0; i &lt; event.config.size; i++) {
                            event.nodes[i].show();
                            event.nodes[i].style.display = '';
                            clearTimeout(event.nodes[i].choosetimeout);
                        }
                        delete event.list2;
                        event.friend.length = 0;
                        event.enemy.length = 0;
                        event.blank.length = 0;
                        event.redoing = true;
                        if (event.imchoosing) {
                            game.resume();
                        }
                    }, true);
                }
                if (get.config('change_choice')) {
                    event.reselectnode = ui.create.system('', function () {
                        event.promptbar.hide();
                        event.list2 = event.list2.concat(event.friend).concat(event.enemy);
                        event.friend.length = 0;
                        event.enemy.length = 0;
                        for (var i = 0; i &lt; event.avatars.length; i++) {
                            if (event.avatars[i].classList.contains('moved')) {
                                event.moveAvatar(event.avatars[i], event.blank.randomRemove());
                                event.avatars[i].classList.remove('moved');
                            }
                        }
                        event.redoing = true;
                        if (event.imchoosing) {
                            game.resume();
                        }
                    }, true);
                }
                if (get.config('free_choose')) {
                    var createCharacterDialog = function () {
                        event.freechoosedialog = ui.create.characterDialog();
                        event.freechoosedialog.style.height = '80%';
                        event.freechoosedialog.style.top = '10%';
                        event.freechoosedialog.style.transform = 'scale(0.8)';
                        event.freechoosedialog.style.transition = 'all 0.3s';
                        event.freechoosedialog.listen(function (e) {
                            if (!event.replacing) {
                                event.dialoglayer.clicked = true;
                            }
                        });
                        event.freechoosedialog.classList.add('pointerdialog');
                        event.dialoglayer = ui.create.div('.popup-container.hidden', function (e) {
                            if (this.classList.contains('removing')) return;
                            if (this.clicked) {
                                this.clicked = false;
                                return;
                            }
                            ui.window.classList.remove('modepaused');
                            this.delete();
                            e.stopPropagation();
                            event.freechoosedialog.style.transform = 'scale(0.8)';
                            if (event.replacing) {
                                event.prompt('' + get.translation(event.replacing) + '');
                            }
                            else {
                                if (event.side == 0) {
                                    event.prompt('');
                                }
                                else {
                                    event.prompt('');
                                }
                            }
                        });
                        event.dialoglayer.classList.add('modenopause');
                        event.dialoglayer.appendChild(event.freechoosedialog);
                        event.freechoosenode.classList.remove('hidden');
                    }

                    event.custom.replace.button = function (button) {
                        event.replacing = button.link;
                    };
                    event.custom.add.window = function () {
                        if (event.replacing) {
                            delete event.replacing;
                            if (event.side == 0) {
                                event.prompt('');
                            }
                            else {
                                event.prompt('');
                            }
                        }
                    };
                    event.freechoosenode = ui.create.system('', function () {
                        if (this.classList.contains('hidden')) return;
                        if (!event.imchoosing) {
                            event.prompt('');
                            return;
                        }
                        delete event.replacing;
                        ui.window.classList.add('modepaused');
                        ui.window.appendChild(event.dialoglayer);
                        ui.refresh(event.dialoglayer);
                        event.dialoglayer.show();
                        event.freechoosedialog.style.transform = 'scale(1)';
                        event.promptbar.hide();
                    }, true);
                    if (lib.onfree) {
                        event.freechoosenode.classList.add('hidden');
                        lib.onfree.push(createCharacterDialog);
                    }
                    else {
                        createCharacterDialog();
                    }
                }
                event.checkredo = function () {
                    if (event.redoing) {
                        event.goto(1);
                        delete event.redoing;
                        return true;
                    }
                };
                // if(ui.cardPileButton) ui.cardPileButton.style.display='none';
                ui.auto.hide();
                ui.wuxie.hide();
                event.resize();
                for (var i = 0; i &lt; event.config.size; i++) {
                    ui.window.appendChild(event.nodes[i]);
                }
                'step 1'
                var rand = event.config.first;
                if (rand == 'rand') {
                    rand = (Math.random() &lt; 0.5);
                }
                if (rand) {
                    _status.color = true;
                    event.side = 1;
                }
                else {
                    _status.color = false;
                    event.side = 3;
                }
                if (!event.list2) {
                    event.list2 = event.list.randomGets(event.config.width * 2);
                    for (var i = 0; i &lt; event.config.width * 2; i++) {
                        event.avatars.push(ui.create.div('.shadowed.shadowed2.reduce_radius.character.choosedouble', event.clickAvatar));
                        var name = event.list2[i];
                        event.avatars[i].setBackground(name, 'character');
                        event.avatars[i].link = name;
                        event.avatars[i].nodename = ui.create.div('.name', event.avatars[i], get.slimName(name));
                        event.avatars[i].nodename.style.fontFamily = lib.config.name_font;
                        event.avatars[i].index = i + event.config.width;
                        event.avatars[i].animate('start');
                        event.nodes[event.avatars[i].index].style.display = 'none';
                        event.avatars[i].nodename.dataset.nature = get.groupnature(lib.character[name][1]);
                        lib.setIntro(event.avatars[i]);
                    }
                    event.resize();
                    for (var i = 0; i &lt; event.avatars.length; i++) {
                        ui.window.appendChild(event.avatars[i]);
                    }
                    event.avatars.sort(function (a, b) {
                        return get.rank(b.link, true) - get.rank(a.link, true);
                    })
                }
                game.delay();
                lib.init.onfree();
                'step 2'
                if (event.checkredo()) return;
                if (event._skiprest) return;
                if (event.side &lt; 2) {
                    event.imchoosing = true;
                    if (event.side == 0) {
                        event.prompt('');
                    }
                    else {
                        event.prompt('');
                        event.fast = get.time();
                    }
                    game.pause();
                }
                else {
                    event.aiMove();
                    game.delay();
                }
                'step 3'
                if (typeof event.fast == 'number' &amp;&amp; get.time() - event.fast &lt;= 1000) {
                    event.fast = true;
                }
                else {
                    event.fast = false;
                }
                delete event.imchoosing;
                if (event.checkredo()) return;
                if (event._skiprest) {
                    while (event.enemy.length &lt; event.config.width) {
                        event.aiMove();
                    }
                    while (event.friend.length &lt; event.config.width) {
                        event.aiMove(true);
                    }
                }
                else if (event.friend.length + event.enemy.length &lt; event.config.width * 2 - 1) {
                    if (event.side == 1) {
                        game.delay(event.fast ? 1 : 2);
                        event.promptbar.hide();
                    }
                    event.side++;
                    if (event.side > 3) {
                        event.side = 0;
                    }
                    event.goto(2);
                }
                else {
                    event.promptbar.hide();
                    event.side++;
                    if (event.side > 3) {
                        event.side = 0;
                    }
                    if (event.side >= 2) {
                        game.delay()
                    }
                }
                'step 4'
                if (event.checkredo()) return;
                if (event.skipnode) event.skipnode.delete();
                if (event.replacenode) event.replacenode.delete();
                if (event.reselectnode) event.reselectnode.delete();
                if (event.freechoosenode) event.freechoosenode.delete();
                for (var i = 0; i &lt; event.avatars.length; i++) {
                    if (!event.avatars[i].classList.contains('moved')) {
                        if (event.side &lt; 2) {
                            event.moveAvatar(event.avatars[i], event.friend.length + event.config.width * (event.config.height - 1));
                            event.friend.push(event.avatars[i]);
                        }
                        else {
                            event.moveAvatar(event.avatars[i], event.enemy.length);
                            event.enemy.push(event.avatars[i]);
                        }
                        event.avatars[i].classList.add('moved');
                    }
                }
                game.delay();
                'step 5'
                event.prompt('' + get.cnNumber(event.config.num) + '');
                event.enemylist = [];
                for (var i = 0; i &lt; event.avatars.length; i++) {
                    if (event.avatars[i].index > event.config.width) {
                        event.avatars[i].classList.add('selecting');
                    }
                }
                var rand = [];
                for (var i = 0; i &lt; event.config.width; i++) {
                    for (var j = 0; j &lt; event.config.width - i; j++) {
                        rand.push(i);
                    }
                }
                for (var i = 0; i &lt; event.config.num; i++) {
                    var rand2 = rand.randomGet();
                    for (var j = 0; j &lt; rand.length; j++) {
                        if (rand[j] == rand2) {
                            rand.splice(j--, 1);
                        }
                    }
                    event.enemylist.push(event.enemy[rand2]);
                }
                event.enemylist.randomSort();
                event.friendlist = [];
                event.deciding = true;
                for (var i = 0; i &lt; event.config.size; i++) {
                    event.nodes[i].hide();
                }
                game.pause();
                'step 6'
                event.promptbar.delete();
                if (ui.cardPileButton) ui.cardPileButton.style.display = '';
                lib.onresize.remove(event.resize);
                ui.wuxie.show();
                ui.auto.show();
                for (var i = 0; i &lt; event.avatars.length; i++) {
                    event.avatars[i].delete();
                }
                for (var i = 0; i &lt; event.nodes.length; i++) {
                    event.nodes[i].delete();
                }
                event.result = { friend: [], enemy: [] };
                for (var i = 0; i &lt; event.config.num; i++) {
                    event.result.friend[i] = event.friendlist[i].link;
                    event.result.enemy[i] = event.enemylist[i].link;
                }
            });
        },
        updateRoundNumber: function () {
            game.broadcastAll(function (num1, num2, top) {
                if (ui.cardPileNumber) ui.cardPileNumber.innerHTML = num1 + ' : ' + num2;
                _status.pileTop = top;
            }, game.roundNumber, ui.cardPile.childNodes.length, ui.cardPile.firstChild);
        },
        asyncDraw: function (players, num, drawDeck, bottom) {
            for (var i = 0; i &lt; players.length; i++) {
                var num2 = 1;
                if (typeof num == 'number') {
                    num2 = num;
                }
                else if (Array.isArray(num)) {
                    num2 = num[i];
                }
                else if (typeof num == 'function') {
                    num2 = num(players[i]);
                }
                if (drawDeck &amp;&amp; drawDeck.drawDeck) {
                    players[i].draw(num2, false, drawDeck);
                }
                else {
                    if (bottom) players[i].draw(num2, 'nodelay', 'bottom');
                    else players[i].draw(num2, 'nodelay');
                }
            }
        },
        asyncDrawAuto: function (players, num, drawDeck) {
            if (players.length == 1) {
                var num2 = 1;
                if (typeof num == 'number') {
                    num2 = num;
                }
                else if (Array.isArray(num)) {
                    num2 = num[0];
                }
                else if (typeof num == 'function') {
                    num2 = num(players[0]);
                }
                if (drawDeck &amp;&amp; drawDeck.drawDeck) {
                    players[0].draw(num2, drawDeck);
                }
                else {
                    players[0].draw(num2);
                }
            }
            else {
                game.asyncDraw.apply(this, arguments);
            }
        },
        /**
         * `translate`ai
         * (_){@link lib.skill.global}
         * @param {string} i 
         * @param {*} [sub] 
         * @see{@link game.finishCards}
         */
        finishSkill: function (i, sub) {
            var j;
            var mode = get.mode();
            var info = lib.skill[i];
            if (info.alter) {
                lib.translate[i + '_info_origin'] = lib.translate[i + '_info'];
                if (!lib.config.vintageSkills.contains(i)) {
                    lib.translate[i + '_info'] = lib.translate[i + '_info_alter'];
                }
            }
            else if (lib.translate[i + '_info_' + mode]) {
                lib.translate[i + '_info'] = lib.translate[i + '_info_' + mode];
            }
            else if (lib.translate[i + '_info_zhu'] &amp;&amp; (mode == 'identity' || (mode == 'guozhan' &amp;&amp; _status.mode == 'four'))) {
                lib.translate[i + '_info'] = lib.translate[i + '_info_zhu'];
            }
            else if (lib.translate[i + '_info_combat'] &amp;&amp; get.is.versus()) {
                lib.translate[i + '_info'] = lib.translate[i + '_info_combat'];
            }
            if (info.forbid &amp;&amp; info.forbid.contains(mode)) {
                lib.skill[i] = {};
                if (lib.translate[i + '_info']) {
                    lib.translate[i + '_info'] = '';
                }
                return;
            }
            if (info.mode &amp;&amp; info.mode.contains(mode) == false) {
                lib.skill[i] = {};
                if (lib.translate[i + '_info']) {
                    lib.translate[i + '_info'] = '';
                }
                return;
            }
            if (info.available &amp;&amp; info.available(mode) == false) {
                lib.skill[i] = {};
                if (lib.translate[i + '_info']) {
                    lib.translate[i + '_info'] = '';
                }
                return;
            }
            if (info.viewAs &amp;&amp; typeof info.viewAs != 'function') {
                if (typeof info.viewAs == 'string') {
                    info.viewAs = { name: info.viewAs };
                }
                if (!lib.card[info.viewAs.name]) {
                    lib.skill[i] = {};
                    lib.translate[i + '_info'] = '';
                    return;
                }
                if (info.ai == undefined) info.ai = {};
                var skill = info.ai;
                var card = lib.card[info.viewAs.name].ai;
                for (j in card) {
                    if (skill[j] == undefined) skill[j] = card[j];
                    else if (typeof skill[j] == 'object') {
                        for (var k in card[j]) {
                            if (skill[j][k] == undefined) skill[j][k] = card[j][k];
                        }
                    }
                }
            }
            if (info.inherit) {
                var skill = lib.skill[info.inherit];
                for (j in skill) {
                    if (info[j] == undefined) {
                        if (j == 'audio' &amp;&amp; (typeof info[j] == 'number' || typeof info[j] == 'boolean')) {
                            info[j] = info.inherit;
                        }
                        else {
                            info[j] = skill[j];
                        }
                    }
                }
                if (lib.translate[i] == undefined) {
                    lib.translate[i] = lib.translate[info.inherit];
                }
                if (lib.translate[i + '_info'] == undefined) {
                    lib.translate[i + '_info'] = lib.translate[info.inherit + '_info'];
                }
            }
            if (info.limited) {
                if (info.mark === undefined) info.mark = true;
                if (!info.intro) info.intro = {};
                if (info.intro.content === undefined) info.intro.content = 'limited';
                if (info.skillAnimation === undefined) info.skillAnimation = true;
                if (info.init === undefined) info.init = function (player, skill) {
                    player.storage[skill] = false;
                }
            }
            if (info.subSkill &amp;&amp; !sub) {
                for (var j in info.subSkill) {
                    lib.skill[i + '_' + j] = info.subSkill[j];
                    lib.skill[i + '_' + j].sub = true;
                    if (info.subSkill[j].name) {
                        lib.translate[i + '_' + j] = info.subSkill[j].name;
                    }
                    else {
                        lib.translate[i + '_' + j] = lib.translate[i + '_' + j] || lib.translate[i];
                    }
                    if (info.subSkill[j].description) {
                        lib.translate[i + '_' + j + '_info'] = info.subSkill[j].description;
                    }
                    if (info.subSkill[j].marktext) {
                        lib.translate[i + '_' + j + '_bg'] = info.subSkill[j].marktext;
                    }
                    game.finishSkill(i + '_' + j, true);
                }
            }
            if (info.round) {
                var k = i + '_roundcount';
                if (typeof info.group == 'string') {
                    info.group = [info.group, k];
                }
                else if (Array.isArray(info.group)) {
                    info.group.add(k);
                }
                else {
                    info.group = [k];
                }
                lib.skill[k] = (function (round, name) {
                    return {
                        init: function (player) {
                            if (typeof player.storage[name] !== 'number') player.storage[name] = 1 - round;
                        },
                        intro: {
                            content: function (storage, player) {
                                var str = '';
                                var info = get.info(name.slice(0, name.indexOf('_roundcount')));
                                if (info &amp;&amp; info.addintro) {
                                    str += info.addintro(storage, player);
                                }
                                var num = round - (game.roundNumber - storage);
                                if (num > 0) {
                                    str += get.cnNumber(num) + '' + (info.roundtext || '');
                                }
                                else {
                                    str += '';
                                }
                                return str;
                            },
                            markcount: function (storage, player) {
                                var num = round - (game.roundNumber - storage);
                                if (num > 0) {
                                    return num;
                                }
                                return 0;
                            }
                        },
                        trigger: { global: 'roundStart' },
                        forced: true,
                        popup: false,
                        silent: true,
                        content: lib.element.content.resetRound
                    };
                }(info.round, k));
                lib.translate[k] = lib.translate[i] || '';
                lib.translate[k + '_bg'] = lib.translate[i + '_bg'] || lib.translate[k][0];
            }
            if (info.marktext) {
                lib.translate[i + '_bg'] = info.marktext;
            }
            if (info.silent) {
                if (!info.hasOwnProperty('forced')) info.forced = true;
                if (!info.hasOwnProperty('popup')) info.popup = false;
            }
            if (i[0] == '_') {
                game.addGlobalSkill(i);
            }
        },
        /**
         * (|)`translate`ai
         * @see {@link game.finishSkill}
         */
        finishCards: function () {
            _status.cardsFinished = true;
            var i, j, k;
            var mode = get.mode();
            for (i in lib.card) {
                if (lib.translate[i + '_info_' + mode]) {
                    lib.translate[i + '_info'] = lib.translate[i + '_info_' + mode];
                }
                else if (lib.translate[i + '_info_zhu'] &amp;&amp; (mode == 'identity' || (mode == 'guozhan' &amp;&amp; _status.mode == 'four'))) {
                    lib.translate[i + '_info'] = lib.translate[i + '_info_zhu'];
                }
                else if (lib.translate[i + '_info_combat'] &amp;&amp; get.is.versus()) {
                    lib.translate[i + '_info'] = lib.translate[i + '_info_combat'];
                }
                var card = lib.card[i];
                if (card.filterTarget &amp;&amp; card.selectTarget == undefined) {
                    card.selectTarget = 1;
                }
                if (card.autoViewAs) {
                    if (!card.ai) {
                        card.ai = {};
                    }
                    if (!card.ai.order) {
                        card.ai.order = lib.card[card.autoViewAs].ai.order;
                        if (!card.ai.order &amp;&amp; lib.card[card.autoViewAs].ai.basic) {
                            card.ai.order = lib.card[card.autoViewAs].ai.basic.order;
                        }
                    }
                }
                if (card.type == 'equip') {
                    if (card.enable == undefined) card.enable = true;
                    if (card.selectTarget == undefined) card.selectTarget = -1;
                    if (card.filterTarget == undefined) card.filterTarget = function (card, player, target) {
                        return target == player;
                    };
                    if (card.modTarget == undefined) card.modTarget = true;
                    if (card.allowMultiple == undefined) card.allowMultiple = false;
                    if (card.content == undefined) card.content = lib.element.content.equipCard;
                    if (card.toself == undefined) card.toself = true;
                    if (card.ai == undefined) card.ai = { basic: {} };
                    if (card.ai.basic == undefined) card.ai.basic = {};
                    if (card.ai.result == undefined) card.ai.result = { target: 1.5 };
                    if (card.ai.basic.order == undefined) card.ai.basic.order = function (card, player) {
                        if (player &amp;&amp; player.hasSkillTag('reverseEquip')) {
                            return 8.5 - get.equipValue(card, player) / 20;
                        }
                        else {
                            return 8 + get.equipValue(card, player) / 20;
                        }
                    };
                    if (card.ai.basic.useful == undefined) card.ai.basic.useful = 2;
                    if (card.subtype == 'equip3') {
                        if (card.ai.basic.equipValue == undefined) card.ai.basic.equipValue = 7;
                    }
                    else if (card.subtype == 'equip4') {
                        if (card.ai.basic.equipValue == undefined) card.ai.basic.equipValue = 4;
                    }
                    else {
                        if (card.ai.basic.equipValue == undefined) card.ai.basic.equipValue = 1;
                    }
                    if (card.ai.basic.value == undefined) card.ai.basic.value = function (card, player, index, method) {
                        if (player.isDisabled(get.subtype(card))) return 0.01;
                        var value = 0;
                        var info = get.info(card);
                        var current = player.getEquip(info.subtype);
                        if (current &amp;&amp; card != current) {
                            value = get.value(current, player);
                        }
                        var equipValue = info.ai.equipValue;
                        if (equipValue == undefined) {
                            equipValue = info.ai.basic.equipValue;
                        }
                        if (typeof equipValue == 'function') {
                            if (method == 'raw') return equipValue(card, player);//
                            if (method == 'raw2') return equipValue(card, player) - value;//`card`()
                            return Math.max(0.1, equipValue(card, player) - value);
                        }
                        if (typeof equipValue != 'number') equipValue = 0;
                        if (method == 'raw') return equipValue;
                        if (method == 'raw2') return equipValue - value;
                        return Math.max(0.1, equipValue - value);
                    }
                    if (!card.ai.result.keepAI) card.ai.result.target = function (player, target, card) {
                        return get.equipResult(player, target, card.name);
                    };
                }
                else if (card.type == 'delay') {
                    if (card.enable == undefined) card.enable = true;
                    if (card.filterTarget == undefined) card.filterTarget = lib.filter.judge;
                    if (card.content == undefined) card.content = lib.element.content.addJudgeCard;
                    if (card.allowMultiple == undefined) card.allowMultiple = false;
                }
            }
            for (i in lib.skill) {
                game.finishSkill(i);
            }
        },
        //Mod
        checkMod: function () {
            var name = arguments[arguments.length - 2];
            var skills = arguments[arguments.length - 1];
            if (skills.getSkills) {
                if (name != 'cardname') skills = skills.getSkills();
                else skills = skills.getSkills(null, false);
            }
            skills = skills.concat(lib.skill.global);
            game.expandSkills(skills);
            var arg = [], i, info;
            for (i = 0; i &lt; arguments.length - 2; i++) {
                arg.push(arguments[i]);
            }
            for (i = 0; i &lt; skills.length; i++) {
                info = get.info(skills[i]);
                if (info &amp;&amp; info.mod &amp;&amp; info.mod[name]) {
                    var result = info.mod[name].apply(this, arg);
                    if (typeof arg[arg.length - 1] != 'object' &amp;&amp; result != undefined) arg[arg.length - 1] = result;
                }
            }
            return arg[arg.length - 1];
        },
        prepareArena: function (num) {
            _status.prepareArena = true;
            game.showHistory(false);
            ui.create.players(num);
            ui.create.me();
            ui.create.cardsAsync();
            game.finishCards();
        },
        clearArena: function () {
            ui.control.innerHTML = '';
            ui.arenalog.innerHTML = '';
            var nodes = [];
            for (var i = 0; i &lt; ui.arena.childNodes.length; i++) {
                nodes.push(ui.arena.childNodes[i]);
            }
            for (var i = 0; i &lt; nodes.length; i++) {
                if (nodes[i] == ui.canvas) continue;
                if (nodes[i] == ui.control) continue;
                if (nodes[i] == ui.arenalog) continue;
                if (nodes[i] == ui.roundmenu) continue;
                if (nodes[i] == ui.timer) continue;
                if (nodes[i] == ui.autonode) continue;
                nodes[i].remove();
            }
            ui.sidebar.innerHTML = '';
            ui.cardPile.innerHTML = '';
            ui.discardPile.innerHTML = '';
            ui.special.innerHTML = '';
            ui.ordering.innerHTML = '';
            ui.playerids.remove();
            game.players.length = 0;
            game.dead.length = 0;
            game.me = null;
        },
        clearConnect: function () {
            if (ui.ipnode) {
                ui.ipnode.remove();
                delete ui.ipnode;
            }
            if (ui.iptext) {
                ui.iptext.remove();
                delete ui.iptext;
            }
            if (ui.ipbutton) {
                ui.ipbutton.remove();
                delete ui.ipbutton;
            }
            if (ui.recentIP) {
                ui.recentIP.remove();
                delete ui.recentIP;
            }
            if (ui.hall_button) {
                ui.hall_button.remove();
                delete ui.hall_button;
            }
            if (ui.startServer) {
                ui.startServer.remove();
                delete ui.startServer;
            }
            if (ui.rooms) {
                for (var i = 0; i &lt; ui.rooms.length; i++) {
                    ui.rooms[i].remove();
                }
                delete ui.rooms;
            }
            if (ui.roombase) {
                ui.roombase.remove();
                delete ui.roombase;
            }
            if (ui.connectEvents) {
                ui.connectEvents.remove();
                ui.connectEventsCount.remove();
                ui.connectClients.remove();
                ui.connectClientsCount.remove();
                ui.createRoomButton.remove();
                delete ui.connectEvents;
                delete ui.connectEventsCount;
                delete ui.connectClients;
                delete ui.connectClientsCount;
                delete ui.createRoomButton;
            }
        },
        log: function () {
            var str = '', str2 = '', logvid = null;
            for (var i = 0; i &lt; arguments.length; i++) {
                var itemtype = get.itemtype(arguments[i]);
                if (itemtype == 'player' || itemtype == 'players') {
                    str += '&lt;span class="bluetext">' + get.translation(arguments[i]) + '&lt;/span>';
                    str2 += get.translation(arguments[i]);
                }
                else if (itemtype == 'cards' || itemtype == 'card' || (typeof arguments[i] == 'object' &amp;&amp; arguments[i] &amp;&amp; arguments[i].name)) {
                    str += '&lt;span class="yellowtext">' + get.translation(arguments[i]) + '&lt;/span>';
                    str2 += get.translation(arguments[i]);
                }
                else if (typeof arguments[i] == 'object') {
                    if (arguments[i]) {
                        if (arguments[i].parentNode == ui.historybar) {
                            logvid = arguments[i].logvid;
                        }
                        else {
                            str += get.translation(arguments[i]);
                            str2 += get.translation(arguments[i]);
                        }
                    }
                }
                else if (typeof arguments[i] == 'string') {
                    if (arguments[i][0] == '' &amp;&amp; arguments[i][arguments[i].length - 1] == '') {
                        str += '&lt;span class="greentext">' + get.translation(arguments[i]) + '&lt;/span>';
                        str2 += get.translation(arguments[i]);
                    }
                    else if (arguments[i][0] == '#') {
                        var color = '';
                        switch (arguments[i][1]) {
                            case 'r': color = 'fire'; break;
                            case 'p': color = 'legend'; break;
                            case 'b': color = 'blue'; break;
                            case 'g': color = 'green'; break;
                            case 'y': color = 'yellow'; break;
                            case 'i': color = 'ice'; break;
                        }
                        str += '&lt;span class="' + color + 'text">' + get.translation(arguments[i].slice(2)) + '&lt;/span>';
                        str2 += get.translation(arguments[i].slice(2));
                    }
                    else {
                        str += get.translation(arguments[i]);
                        str2 += get.translation(arguments[i]);
                    }
                }
                else {
                    str += arguments[i];
                    str2 += arguments[i];
                }

            }
            var node = ui.create.div();
            node.innerHTML = lib.config.log_highlight ? str : str2;
            ui.sidebar.insertBefore(node, ui.sidebar.firstChild);
            game.addVideo('log', null, lib.config.log_highlight ? str : str2);
            game.broadcast(function (str, str2) {
                game.log(lib.config.log_highlight ? str : str2);
            }, str, str2);
            if (!_status.video &amp;&amp; !game.online) {
                if (!logvid) {
                    logvid = _status.event.getLogv();
                }
                if (logvid) {
                    game.logv(logvid, '&lt;div class="text center">' + lib.config.log_highlight ? str : str2 + '&lt;/div>');
                }
            }
            // if(lib.config.title) document.title=lib.config.log_highlight?str:str2;
            if (lib.config.show_log != 'off' &amp;&amp; !game.chess) {
                var nodeentry = node.cloneNode(true);
                ui.arenalog.insertBefore(nodeentry, ui.arenalog.firstChild);
                if (!lib.config.clear_log) {
                    while (ui.arenalog.childNodes.length &amp;&amp; ui.arenalog.scrollHeight > ui.arenalog.offsetHeight) {
                        ui.arenalog.lastChild.remove();
                    }
                }
                if (!lib.config.low_performance) {
                    nodeentry.style.transition = 'all 0s';
                    nodeentry.style.marginBottom = (-nodeentry.offsetHeight) + 'px';
                    ui.refresh(nodeentry);
                    nodeentry.style.transition = '';
                    nodeentry.style.marginBottom = '';
                }
                if (lib.config.clear_log) {
                    nodeentry.timeout = setTimeout(function () {
                        nodeentry.delete();
                    }, 1000);
                    for (var i = 0; i &lt; ui.arenalog.childElementCount; i++) {
                        if (!ui.arenalog.childNodes[i].timeout) {
                            ui.arenalog.childNodes[i].remove();
                        }
                    }
                }
            }
        },
        logv: function (player, card, targets, event, forced, logvid) {
            var node = ui.create.div('.hidden');
            node.node = {};
            logvid = logvid || get.id();
            if (!player) {
                player = _status.event.getParent().logvid;
                if (!player) return;
            }
            game.broadcast(function (player, card, targets, event, forced, logvid) {
                game.logv(player, card, targets, event, forced, logvid);
            }, player, card, targets, event, forced, logvid);
            if (typeof player == 'string') {
                for (var i = 0; i &lt; ui.historybar.childElementCount; i++) {
                    if (ui.historybar.childNodes[i].logvid == player) {
                        ui.historybar.childNodes[i].added.push(card); break;
                    }
                }
                return;
            }
            if (typeof card == 'string') {
                if (card != 'die') {
                    if (lib.skill[card] &amp;&amp; lib.skill[card].logv === false &amp;&amp; !forced) return;
                    if (!lib.translate[card]) return;
                }
                var avatar;
                if (!player.isUnseen(0)) {
                    avatar = player.node.avatar.cloneNode();
                }
                else if (!player.isUnseen(1)) {
                    avatar = player.node.avatar2.cloneNode();
                }
                else {
                    return;
                }
                node.node.avatar = avatar;
                avatar.style.transform = '';
                avatar.className = 'avatar';
                if (card == 'die') {
                    node.dead = true;
                    node.player = player;
                    var avatar2 = avatar.cloneNode();
                    avatar2.className = 'avatarbg grayscale1';
                    avatar.appendChild(avatar2);
                    avatar.style.opacity = 0.6;
                }
                else {
                    node.node.text = ui.create.div('', get.translation(card, 'skill'), avatar);
                    node.node.text.dataset.nature = 'water';
                    node.skill = card;
                }
                node.appendChild(avatar);
                if (card == 'die' &amp;&amp; targets &amp;&amp; targets != player) {
                    node.source = targets;
                    var avatar;
                    player = targets;
                    if (!player.isUnseen(0)) {
                        avatar = player.node.avatar.cloneNode();
                    }
                    else if (!player.isUnseen(1)) {
                        avatar = player.node.avatar2.cloneNode();
                    }
                    else if (get.mode() == 'guozhan' &amp;&amp; player.node &amp;&amp; player.node.name_seat) {
                        avatar = ui.create.div('.avatar.cardbg');
                        avatar.innerHTML = player.node.name_seat.innerHTML[0];
                    }
                    else {
                        return;
                    }
                    avatar.style.transform = '';
                    node.node.avatar2 = avatar;
                    avatar.classList.add('avatar2');
                    node.appendChild(avatar);
                }
            }
            else if (Array.isArray(card)) {
                node.cards = card[1];
                card = card[0];
                var info = [card.suit || '', card.number || '', card.name || '', card.nature || ''];
                if (!Array.isArray(node.cards) || !node.cards.length) {
                    node.cards = [ui.create.card(node, 'noclick', true).init(info)];
                }
                if (card.name == 'wuxie') {
                    if (ui.historybar.firstChild &amp;&amp; ui.historybar.firstChild.type == 'wuxie') {
                        ui.historybar.firstChild.players.push(player);
                        ui.historybar.firstChild.cards.addArray(node.cards);
                        return;
                    }
                    else {
                        node.type = 'wuxie';
                        node.players = [player];
                    }
                }
                if (card.copy) {
                    card.copy(node, false);
                }
                else {
                    card = ui.create.card(node, 'noclick', true);
                    card.init(info);
                }
                var avatar;
                if (!player.isUnseen(0)) {
                    avatar = player.node.avatar.cloneNode();
                }
                else if (!player.isUnseen(1)) {
                    avatar = player.node.avatar2.cloneNode();
                }
                else if (get.mode() == 'guozhan' &amp;&amp; player.node &amp;&amp; player.node.name_seat) {
                    avatar = ui.create.div('.avatar.cardbg');
                    avatar.innerHTML = player.node.name_seat.innerHTML[0];
                }
                else {
                    return;
                }
                node.node.avatar = avatar;
                avatar.style.transform = '';
                avatar.classList.add('avatar2');
                node.appendChild(avatar);

                if (targets &amp;&amp; targets.length == 1 &amp;&amp; targets[0] != player &amp;&amp; get.itemtype(targets[0]) == 'player') {
                    (function () {
                        var avatar2;
                        var target = targets[0];
                        if (!target.isUnseen(0)) {
                            avatar2 = target.node.avatar.cloneNode();
                        }
                        else if (!player.isUnseen(1)) {
                            avatar2 = target.node.avatar2.cloneNode();
                        }
                        else if (get.mode() == 'guozhan' &amp;&amp; target.node &amp;&amp; target.node.name_seat) {
                            avatar2 = ui.create.div('.avatar.cardbg');
                            avatar2.innerHTML = target.node.name_seat.innerHTML[0];
                        }
                        else {
                            return;
                        }
                        node.node.avatar2 = avatar2;
                        avatar2.style.transform = '';
                        avatar2.classList.add('avatar2');
                        avatar2.classList.add('avatar3');
                        node.insertBefore(avatar2, avatar);
                    }());
                }
            }
            if (targets &amp;&amp; targets.length) {
                if (targets.length == 1 &amp;&amp; targets[0] == player) {
                    node.targets = [];
                }
                else {
                    node.targets = targets;
                }
            }
            var fullheight = ui.historybar.offsetHeight;
            var num = Math.round((fullheight - 8) / 50);
            var margin = (fullheight - 42 * num) / (num + 1);
            node.style.transform = 'scale(0.8)';
            ui.historybar.insertBefore(node, ui.historybar.firstChild);
            ui.refresh(node);
            node.classList.remove('hidden');
            for (var i = 0; i &lt; ui.historybar.childElementCount; i++) {
                var current = ui.historybar.childNodes[i];
                if (i &lt; num) {
                    current.style.transform = 'scale(1) translateY(' + (margin + i * (42 + margin) - 4) + 'px)';
                }
                else {
                    if (!current.removetimeout) {
                        current.style.opacity = 0;
                        current.style.transform = 'scale(1) translateY(' + fullheight + 'px)';
                        current.removetimeout = setTimeout((function (current) {
                            return function () {
                                current.remove();
                            };
                        }(current)), 500);
                    }
                }
            }
            if (lib.config.touchscreen) {
                node.addEventListener('touchstart', ui.click.intro);
            }
            else {
                // node.addEventListener('mouseenter',ui.click.intro);
                node.addEventListener(lib.config.pop_logv ? 'mousemove' : 'click', ui.click.logv);
                node.addEventListener('mouseleave', ui.click.logvleave);
            }
            node.logvid = logvid;
            node.added = [];
            if (!game.online) {
                event = event || _status.event;
                event.logvid = node.logvid;
            }
            return node;
        },
        /**
         * IndexedDB(object store)
         * @param {string} type - 
         * @param {string} id - 
         * @param {any} item - /
         * @param {function} callback - 
         */
        putDB: function (type, id, item, callback) {
            if (!lib.db) return item;
            if (lib.status.reload) {
                lib[_status.dburgent ? 'ondb2' : 'ondb'].push(['putDB', Array.from(arguments)]);
                return;
            }
            lib.status.reload++;
            var put = lib.db.transaction([type], 'readwrite').objectStore(type).put(item, id);
            put.onsuccess = function () {
                if (callback) {
                    _status.dburgent = true;
                    callback.apply(this, arguments);
                    delete _status.dburgent;
                }
                game.reload2();
            };
        },
        /**
         * IndexedDB(object store)
         * @param {string} type - 
         * @param {string} id - 
         * @param {!function} callback - 
         */
        getDB: function (type, id, callback) {
            if (!lib.db) {
                callback(null);
                return;
            }
            if (!callback) return;
            if (lib.status.reload) {
                lib[_status.dburgent ? 'ondb2' : 'ondb'].push(['getDB', Array.from(arguments)]);
                return;
            }
            lib.status.reload++;
            var store = lib.db.transaction([type], 'readwrite').objectStore(type);
            if (id) {
                store.get(id).onsuccess = function (e) {
                    _status.dburgent = true;
                    callback(e.target.result);
                    delete _status.dburgent;
                    game.reload2();
                };
            }
            else {
                var obj = {};
                store.openCursor().onsuccess = function (e) {
                    var cursor = e.target.result;
                    if (cursor) {
                        obj[cursor.key] = cursor.value;
                        cursor.continue();
                    }
                    else {
                        _status.dburgent = true;
                        callback(obj);
                        delete _status.dburgent;
                        game.reload2();
                    }
                }
            }
        },
        /**
         * IndexedDB(object store)
         * @param {string} type - 
         * @param {string} id - 
         * @param {function} callback - 
         */
        deleteDB: function (type, id, callback) {
            if (!lib.db) {
                callback(false);
                return;
            }
            if (lib.status.reload) {
                lib[_status.dburgent ? 'ondb2' : 'ondb'].push(['deleteDB', Array.from(arguments)]);
                return;
            }
            if (arguments.length == 1) {
                game.getDB(type, null, function (obj) {
                    var store = lib.db.transaction([type], 'readwrite').objectStore(type);
                    for (var id in obj) {
                        lib.status.reload++;
                    }
                    for (var id in obj) {
                        store.delete(id).onsuccess = game.reload2;
                    }
                    game.reload2();
                });
            }
            else {
                lib.status.reload++;
                var store = lib.db.transaction([type], 'readwrite').objectStore(type);
                store.delete(id).onsuccess = function () {
                    if (callback) {
                        callback.apply(this, arguments);
                    }
                    game.reload2();
                };
            }
        },
        save: function (key, value, mode) {
            if (_status.reloading) return;
            mode = mode || lib.config.mode;
            if (!lib.db) {
                var config = {};
                if (key) {
                    try {
                        config = JSON.parse(localStorage.getItem(lib.configprefix + mode));
                        if (typeof config != 'object') throw 'err';
                    }
                    catch (err) {
                        config = {};
                    }
                    if (value == undefined) {
                        delete config[key];
                        if (mode == lib.config.mode) delete lib.storage[key];
                    }
                    else {
                        config[key] = value;
                        if (mode == lib.config.mode) lib.storage[key] = value;
                    }
                    config.version = lib.version;
                    localStorage.setItem(lib.configprefix + mode, JSON.stringify(config));
                }
                else {
                    localStorage.setItem(lib.configprefix + mode, JSON.stringify(lib.storage));
                }
            }
            else {
                if (key) {
                    if (mode == lib.config.mode) {
                        if (value == undefined) {
                            delete lib.storage[key];
                        }
                        else {
                            lib.storage[key] = value;
                        }
                        lib.storage.version = lib.version;
                        game.putDB('data', mode, lib.storage);
                    }
                    else {
                        game.getDB('data', mode, function (config) {
                            if (!config) config = {};
                            if (value == undefined) {
                                delete config[key];
                            }
                            else {
                                config[key] = value;
                            }
                            config.version = lib.version;
                            game.putDB('data', mode, config);
                        });
                    }
                }
                else {
                    game.putDB('data', mode, get.copy(lib.storage));
                }
            }
        },
        showChangeLog: function () {
            if (lib.version != lib.config.version || _status.extensionChangeLog) {
                var ul = document.createElement('ul');
                ul.style.textAlign = 'left';
                var caption;
                var players = null, cards = null;
                if (lib.version != lib.config.version) {
                    for (var i = 0; i &lt; lib.changeLog.length; i++) {
                        if (lib.changeLog[i].indexOf('players://') == 0) {
                            try {
                                players = JSON.parse(lib.changeLog[i].slice(10));
                            }
                            catch (e) {
                                players = null;
                            }
                        }
                        else if (lib.changeLog[i].indexOf('cards://') == 0) {
                            try {
                                cards = JSON.parse(lib.changeLog[i].slice(8));
                            }
                            catch (e) {
                                cards = null;
                            }
                        }
                        else {
                            var li = document.createElement('li');
                            li.innerHTML = lib.changeLog[i];
                            ul.appendChild(li);
                        }
                    }
                    caption = lib.version + '';
                }
                else {
                    caption = '';
                }
                game.saveConfig('version', lib.version);
                for (var i in _status.extensionChangeLog) {
                    var li = document.createElement('li');
                    li.innerHTML = i + '' + _status.extensionChangeLog[i];
                    ul.appendChild(li);
                }
                var dialog = ui.create.dialog(caption, 'hidden');
                var lic = ui.create.div(dialog.content);
                lic.style.display = 'block';
                ul.style.display = 'inline-block';
                ul.style.marginLeft = '-40px';
                lic.appendChild(ul);
                if (players) {
                    for (var i = 0; i &lt; players.length; i++) {
                        if (!lib.character[players[i]]) {
                            players.splice(i--, 1);
                        }
                    }
                    if (players.length) {
                        dialog.addSmall([players, 'character']);
                        dialog.classList.add('forcebutton');
                        dialog.classList.add('withbg');
                    }
                }
                if (cards) {
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (!lib.card[cards[i]]) {
                            cards.splice(i--, 1);
                        }
                    }
                    if (cards.length) {
                        for (var i = 0; i &lt; cards.length; i++) {
                            cards[i] = [get.translation(get.type(cards[i])), '', cards[i]]
                        }
                        dialog.addSmall([cards, 'vcard']);
                        dialog.classList.add('forcebutton');
                        dialog.classList.add('withbg');
                    }
                }
                dialog.open();
                var hidden = false;
                if (!ui.auto.classList.contains('hidden')) {
                    ui.auto.hide();
                    hidden = true;
                }
                game.pause();
                var control = ui.create.control('', function () {
                    dialog.close();
                    control.close();
                    if (hidden) ui.auto.show();
                    game.resume();
                });
                lib.init.onfree();
            }
        },
        showExtensionChangeLog: function (str, extname) {
            extname = extname || _status.extension;
            var cfg = 'extension_' + extname + '_changelog';
            if (lib.extensionPack[extname] &amp;&amp; lib.extensionPack[extname].version != lib.config[cfg]) {
                game.saveConfig(cfg, lib.extensionPack[extname].version);
                if (!_status.extensionChangeLog) {
                    _status.extensionChangeLog = {};
                    _status.extensionChangeLog[extname] = str;
                }
            }
        },
        /**
         * 
         * IndexedDBIndexedDB`{key:lib.configprefix + 'config', value:{key:value}}`localStorage
         * @function
         * @param {!string} key 
         * @param {?Object} value /
         * @param {?string} local (`lib.config.mode_config[local]`)(`lib.config`)
         * @param {function():void} callback 
         */
        saveConfig: function (key, value, local, callback) {
            if (_status.reloading) return;
            if (local) {
                var localmode;
                if (typeof local == 'string') {
                    localmode = local;
                }
                else {
                    localmode = lib.config.mode;
                }
                if (!lib.config.mode_config[localmode]) {
                    lib.config.mode_config[localmode] = {};
                }
                if (value == undefined) {
                    delete lib.config.mode_config[localmode][key];
                }
                else {
                    lib.config.mode_config[localmode][key] = value;
                }
                key += '_mode_config_' + localmode;
            }
            else {
                if (value == undefined) {
                    delete lib.config[key];
                }
                else {
                    lib.config[key] = value;
                }
            }
            if (!lib.db) {
                var config;
                try {
                    config = JSON.parse(localStorage.getItem(lib.configprefix + 'config'));
                    if (!config || typeof config != 'object') throw 'err'
                }
                catch (err) {
                    config = {};
                }
                if (value === undefined) {
                    delete config[key];
                }
                else {
                    config[key] = value;
                }
                localStorage.setItem(lib.configprefix + 'config', JSON.stringify(config));
                if (callback) {
                    callback();
                }
            }
            else {
                if (value == undefined) {
                    game.deleteDB('config', key, callback);
                }
                else {
                    game.putDB('config', key, value, callback);
                }
            }
        },
        /**
         * `lib.config[key]`
         * @function
         * @param {!string} key 
         * @see {@link game.saveConfig}
         */
        saveConfigValue: function (key) {
            game.saveConfig(key, lib.config[key]);
        },
        /**
         * 
         * @function
         * @param {!string} extension 
         * @param {!string} key `extension_${extension}_${key}`
         * @param {?Object} value
         * @see {@link game.saveConfig}
         */
        saveExtensionConfig: function (extension, key, value) {
            return game.saveConfig('extension_' + extension + '_' + key, value);
        },
        /**
         * 
         * @function
         * @param {!string} extension 
         * @param {!string} key 
         * @returns {?Object} 
         */
        getExtensionConfig: function (extension, key) {
            return lib.config['extension_' + extension + '_' + key];
        },
        /**
         * IndexedDB/localStoragemode
         * @function
         * @param {!string} mode mode
         */
        clearModeConfig: function (mode) {
            if (_status.reloading) return;
            if (!lib.db) {
                var config;
                try {
                    config = JSON.parse(localStorage.getItem(lib.configprefix + 'config'));
                    if (!config || typeof config != 'object') throw 'err'
                }
                catch (err) {
                    config = {};
                }
                for (var i in config) {
                    if (i.substr(i.indexOf('_mode_config') + 13) == mode) {
                        delete config[i];
                    }
                }
                localStorage.setItem(lib.configprefix + 'config', JSON.stringify(config));
                localStorage.removeItem(lib.configprefix + mode);
            }
            else {
                game.getDB('config', null, function (config) {
                    for (var i in config) {
                        if (i.substr(i.indexOf('_mode_config') + 13) == mode) {
                            game.saveConfig(i);
                        }
                    }
                });
            }
        },
        addPlayer: function (position, character, character2) {
            if (position &lt; 0 || position > game.players.length + game.dead.length || position == undefined) {
                position = Math.ceil(Math.random() * (game.players.length + game.dead.length));
            }
            var players = game.players.concat(game.dead);
            ui.arena.setNumber(players.length + 1);
            for (var i = 0; i &lt; players.length; i++) {
                if (parseInt(players[i].dataset.position) >= position) {
                    players[i].dataset.position = parseInt(players[i].dataset.position) + 1;
                }
            }
            var player = ui.create.player(ui.arena).animate('start');
            if (character) player.init(character, character2);
            game.players.push(player);
            player.dataset.position = position;
            game.arrangePlayers();
            return player;
        },
        addFellow: function (position, character, animation) {
            game.addVideo('addFellow', null, [position, character, animation]);
            var player = ui.create.player(ui.arena).animate(animation || 'start');
            player.dataset.position = position || game.players.length + game.dead.length;
            player.getId();
            if (character) player.init(character);
            game.players.push(player); game.arrangePlayers();
            return player;
        },
        triggerEnter: function (player) {
            var next = game.createEvent('enterGame', false);
            next.player = player;
            next.setContent(function () {
                event.trigger('enterGame');
            });
        },
        restorePlayer: function (player) {
            if (game.players.contains(player) || game.dead.contains(player)) return;
            var position = parseInt(player.dataset.position);
            if (position &lt; 0 || position > game.players.length + game.dead.length || position == undefined) {
                position = Math.ceil(Math.random() * (game.players.length + game.dead.length));
            }
            var players = game.players.concat(game.dead);
            ui.arena.setNumber(players.length + 1);
            for (var i = 0; i &lt; players.length; i++) {
                if (parseInt(players[i].dataset.position) >= position) {
                    players[i].dataset.position = parseInt(players[i].dataset.position) + 1;
                }
            }
            game.players.push(player);
            delete player.removed;
            player.removeAttribute('style');
            player.animate('start');
            ui.arena.appendChild(player);
            game.arrangePlayers();
            return player;
        },
        removePlayer: function (player) {
            if (_status.roundStart == player) {
                _status.roundStart = player.next || player.getNext() || game.players[0];
            }
            var players = game.players.concat(game.dead);
            player.style.left = player.getLeft() + 'px';
            player.style.top = player.getTop() + 'px';
            if (player == undefined) player = game.dead[0] || game.me.next;
            var position = parseInt(player.dataset.position);
            for (var i = 0; i &lt; players.length; i++) {
                if (parseInt(players[i].dataset.position) > position) {
                    players[i].dataset.position = parseInt(players[i].dataset.position) - 1;
                }
            }
            if (player.isAlive()) {
                player.next.previous = player.previous;
                player.previous.next = player.next;
            }
            player.nextSeat.previousSeat = player.previousSeat;
            player.previousSeat.nextSeat = player.nextSeat;
            player.delete();
            game.players.remove(player);
            game.dead.remove(player);
            ui.arena.setNumber(players.length - 1);
            player.removed = true;
            if (player == game.me) {
                ui.me.hide();
                ui.auto.hide();
                ui.wuxie.hide();
            }
            setTimeout(function () {
                player.removeAttribute('style');
            }, 500);
            return player;
        },
        replacePlayer: function (player, character, character2) {
            player.removed = true;
            var position = parseInt(player.dataset.position);
            game.players.remove(player);
            game.dead.remove(player);
            player.delete();
            var player2 = ui.create.player(ui.arena).animate('start');
            if (character) player2.init(character, character2);
            game.players.push(player2);
            player2.dataset.position = position;
            player2.nextSeat = player.nextSeat;
            player2.previousSeat = player.previousSeat;
            player2.nextSeat.previousSeat = player2;
            player2.previousSeat.nextSeat = player2;
            var player3 = player2.nextSeat;
            while (player3.isDead()) player3 = player3.nextSeat;
            player3.previous = player2;
            player2.next = player3;
            var player4 = player2.previousSeat;
            while (player4.isDead()) player4 = player4.previousSeat;
            player4.next = player2;
            player2.previous = player4;
            if (_status.roundStart == player) {
                _status.roundStart = player2;
            }
            return player2;
        },
        arrangePlayers: function () {
            if (game.chess &amp;&amp; game.me) {
                var friendCount = 0;
                var enemyCount = 0;
                var rand = Math.random() &lt; 0.5;
                for (var i = 0; i &lt; game.players.length; i++) {
                    if (game.players[i].side == game.me.side) {
                        if (rand) {
                            if (game.players[i] == game.friendZhu) {
                                game.players[i]._sortCount = -2;
                            }
                            else {
                                game.players[i]._sortCount = 2 * friendCount;
                            }
                        }
                        else {
                            if (game.players[i] == game.friendZhu) {
                                game.players[i]._sortCount = -1;
                            }
                            else {
                                game.players[i]._sortCount = 2 * friendCount + 1;
                            }
                        }
                        friendCount++;
                    }
                    else {
                        if (rand) {
                            if (game.players[i] == game.enemyZhu) {
                                game.players[i]._sortCount = -1;
                            }
                            else {
                                game.players[i]._sortCount = 2 * enemyCount + 1;
                            }
                        }
                        else {
                            if (game.players[i] == game.enemyZhu) {
                                game.players[i]._sortCount = -2;
                            }
                            else {
                                game.players[i]._sortCount = 2 * enemyCount;
                            }
                        }
                        enemyCount++;
                    }
                }
                game.players.sort(function (a, b) {
                    return a._sortCount - b._sortCount;
                });
                for (var i = 0; i &lt; game.players.length; i++) {
                    delete game.players[i]._sortCount;
                }
            }
            else {
                game.players.sort(lib.sort.position);
            }
            var players = game.players.concat(game.dead);
            players.sort(lib.sort.position);
            for (var i = 0; i &lt; players.length; i++) {
                if (i == 0) {
                    players[i].previousSeat = players[players.length - 1];
                }
                else {
                    players[i].previousSeat = players[i - 1];
                }
                if (i == players.length - 1) {
                    players[i].nextSeat = players[0];
                }
                else {
                    players[i].nextSeat = players[i + 1];
                }
            }
            for (var i = 0; i &lt; game.players.length; i++) {
                if (i == 0) {
                    game.players[i].previous = game.players[game.players.length - 1];
                }
                else {
                    game.players[i].previous = game.players[i - 1];
                }
                if (i == game.players.length - 1) {
                    game.players[i].next = game.players[0];
                }
                else {
                    game.players[i].next = game.players[i + 1];
                }
            }
        },
        /**
         * 
         * @param {!Array&lt;string>} skills 
         * @param {!HTMLDivElement} player 
         * @param {?Function} exclude 
         * @returns {Array&lt;string>} 
         */
        filterSkills: function (skills, player, exclude) {
            let out = skills.slice(0);
            for (let i in player.disabledSkills) {
                out.remove(i);
            }
            if (player.storage.skill_blocker &amp;&amp; player.storage.skill_blocker.length) {
                for (let i = 0; i &lt; out.length; i++) {
                    if ((!exclude || !exclude.contains(out[i])) &amp;&amp; get.is.blocked(out[i], player)) out.splice(i--, 1);
                }
            }
            return out;
        },
        /**
         * 
         * @param {!Array&lt;string>} skills 
         * @returns {Array&lt;string>} 
         */
        expandSkills: function (skills) {
            var skills2 = [];
            for (var i = 0; i &lt; skills.length; i++) {
                var info = get.info(skills[i]);
                if (info) {
                    if (info.group) skills2 = skills2.concat(info.group);
                }
                else {
                    console.log(skills[i]);
                }
            }
            for (var i = 0; i &lt; skills2.length; i++) {
                skills.add(skills2[i]);
            }
            return skills;
        },
        css: function (style) {
            for (var i in style) {
                if (ui.style[i]) ui.style[i].innerHTML = i + JSON.stringify(style[i]).replace(/"/g, "");
                else {
                    ui.style[i] = document.createElement('style');
                    ui.style[i].innerHTML = i + JSON.stringify(style[i]).replace(/"/g, "");
                    document.head.appendChild(ui.style[i]);
                }
            }
        },
        /**
         * 
         * @param {?Function} func 
         * @returns {!boolean} 
         */
        hasPlayer: function (func) {
            for (var i = 0; i &lt; game.players.length; i++) {
                if (game.players[i].isOut()) continue;
                if (func(game.players[i])) return true;
            }
            return false;
        },
        /**
         * 
         * @param {?Function} func 
         * @returns {!boolean} 
         */
        hasPlayer2: function (func) {
            var players = game.players.slice(0).concat(game.dead);
            for (var i = 0; i &lt; players.length; i++) {
                if (players[i].isOut()) continue;
                if (func(players[i])) return true;
            }
            return false;
        },
        /**
         * 
         * @param {?Function} func 
         * @returns {Array&lt;HTMLDivElement>} 
         */
        countPlayer: function (func) {
            var num = 0;
            if (typeof func != 'function') {
                func = lib.filter.all;
            }
            for (var i = 0; i &lt; game.players.length; i++) {
                if (game.players[i].isOut()) continue;
                var result = func(game.players[i]);
                if (typeof result == 'number') {
                    num += result;
                }
                else if (result) {
                    num++;
                }
            }
            return num;
        },
        /**
         * 
         * @param {?Function} func 
         * @returns {Array&lt;HTMLDivElement>} 
         */
        countPlayer2: function (func) {
            var num = 0;
            if (typeof func != 'function') {
                func = lib.filter.all;
            }
            var players = game.players.slice(0).concat(game.dead);
            for (var i = 0; i &lt; players.length; i++) {
                if (players[i].isOut()) continue;
                var result = func(players[i]);
                if (typeof result == 'number') {
                    num += result;
                }
                else if (result) {
                    num++;
                }
            }
            return num;
        },
        filterPlayer: function (func, list) {
            if (!Array.isArray(list)) {
                list = [];
            }
            if (typeof func != 'function') {
                func = lib.filter.all;
            }
            for (var i = 0; i &lt; game.players.length; i++) {
                if (game.players[i].isOut()) continue;
                if (func(game.players[i])) {
                    list.add(game.players[i]);
                }
            }
            return list;
        },
        filterPlayer2: function (func, list) {
            if (!Array.isArray(list)) {
                list = [];
            }
            if (typeof func != 'function') {
                func = lib.filter.all;
            }
            var players = game.players.slice(0).concat(game.dead);
            for (var i = 0; i &lt; players.length; i++) {
                if (players[i].isOut()) continue;
                if (func(players[i])) {
                    list.add(players[i]);
                }
            }
            return list;
        },
        findPlayer: function (func) {
            for (var i = 0; i &lt; game.players.length; i++) {
                if (game.players[i].isOut()) continue;
                if (func(game.players[i])) {
                    return game.players[i];
                }
            }
            return null;
        },
        findPlayer2: function (func) {
            var players = game.players.slice(0).concat(game.dead);
            for (var i = 0; i &lt; players.length; i++) {
                if (players[i].isOut()) continue;
                if (func(players[i])) {
                    return players[i];
                }
            }
            return null;
        },
        findCards: function (func, all) {
            var cards = [];
            for (var i in lib.card) {
                if (!lib.translate[i + '_info']) continue;
                if (lib.card[i].mode &amp;&amp; lib.card[i].mode.contains(lib.config.mode) == false) continue;
                if (!all &amp;&amp; !lib.inpile.contains(i)) continue;
                if (func(i, lib.card[i])) {
                    cards.push(i);
                }
            }
            return cards;
        },
        /**
         *  countPlayer 
         * @returns {!number} 
         */
        countGroup: function () {
            var list = lib.group.slice(0);
            return game.countPlayer(function (current) {
                if (list.contains(current.group)) {
                    list.remove(current.group);
                    return true;
                }
            });
        },
        players: [],
        dead: [],
        imported: [],
        playerMap: {},
        phaseNumber: 0,
        roundNumber: 0,
        shuffleNumber: 0,
    };
    /**
     * UI
     * @namespace
     * @global
     */
    var ui = /**@lends ui */ {
        updates: [],
        thrown: [],
        touchlines: [],
        todiscard: {},
        /**
         * 
         * @param {HTMLElement} node DOM
         */
        refresh: function (node) {
            void window.getComputedStyle(node, null).getPropertyValue("opacity");
        },
        /**
         * UI
         * @namespace
         */
        create: {
            connectRooms: function (list) {
                ui.rooms = [];
                ui.roombase = ui.create.dialog();
                ui.roombase.classList.add('fullwidth');
                ui.roombase.classList.add('fullheight');
                ui.roombase.classList.add('fixed');
                ui.roombase.classList.add('scroll1');
                ui.roombase.classList.add('scroll2');
                ui.roombase.classList.add('noupdate');
                for (var i = 0; i &lt; list.length; i++) {
                    var player = ui.roombase.add('&lt;div class="popup text pointerdiv" style="width:calc(100% - 10px);display:inline-block;white-space:nowrap">&lt;/div>');
                    player.roomindex = i;
                    player.initRoom = lib.element.player.initRoom;
                    player.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.connectroom);
                    player.initRoom(list[i]);
                    ui.rooms.push(player);
                }
            },
            rarity: function (button) {
                var rarity = game.getRarity(button.link);
                if (rarity != 'common' &amp;&amp; lib.config.show_rarity) {
                    var intro = button.node.intro;
                    intro.classList.add('showintro');
                    intro.style.fontFamily = 'yuanli';
                    intro.style.fontSize = '16px';
                    intro.style.bottom = '6px';
                    intro.style.left = '6px';
                    switch (rarity) {
                        case 'beginner': intro.dataset.nature = 'oceanm'; break;
                        case 'rare': intro.dataset.nature = 'thunderm'; break;
                        case 'epic': intro.dataset.nature = 'metalm'; break;
                        case 'legend': intro.dataset.nature = 'orangem'; break;
                        case 'junk': intro.dataset.nature = 'woodm'; break;
                    }
                    intro.innerHTML = get.translation(rarity);
                }
                if ((button.link == 'xushu' || button.link == 'xin_xushu') &amp;&amp; button.node &amp;&amp; button.node.name &amp;&amp; button.node.group) {
                    if (button.classList.contains('newstyle')) {
                        button.node.name.dataset.nature = 'watermm';
                        button.node.group.dataset.nature = 'water';
                    }
                    else button.node.group.style.backgroundColor = get.translation('weiColor');
                }
            },
            /**
             * `&lt;div>`
             * @function
             * @param {?string} selectors ididididnull
             * @param {?string} innerHTML HTMLnull
             * @param {?HTMLElement} parent null
             * @param {?number} referenceNode null
             * @param {?Object} style {@link HTMLDivElement#css}null
             * @param {?number[]} offsets {@link HTMLDivElement#setPosition}
             * @param {?function} clickCallback 
             * @returns {HTMLDivElement} div
             */
            div: function () {
                var str, innerHTML, position, position2, style, divposition, listen;
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'string') {
                        if (typeof str == 'string') {
                            innerHTML = arguments[i];
                        }
                        else {
                            str = arguments[i];
                        }
                    }
                    else if (get.objtype(arguments[i]) == 'div' ||
                        get.objtype(arguments[i]) == 'table' ||
                        get.objtype(arguments[i]) == 'tr' ||
                        get.objtype(arguments[i]) == 'td' ||
                        get.objtype(arguments[i]) == 'body') position = arguments[i];
                    else if (typeof arguments[i] == 'number') position2 = arguments[i];
                    else if (get.itemtype(arguments[i]) == 'divposition') divposition = arguments[i];
                    else if (typeof arguments[i] == 'object') style = arguments[i];
                    else if (typeof arguments[i] == 'function') listen = arguments[i];
                }
                if (str == undefined) str = '';
                var node = document.createElement('div');
                for (var i = 0; i &lt; str.length; i++) {
                    if (str[i] == '.') {
                        if (node.className.length != 0) {
                            node.className += ' ';
                        }
                        while (str[i + 1] != '.' &amp;&amp; str[i + 1] != '#' &amp;&amp; i + 1 &lt; str.length) {
                            node.className += str[i + 1];
                            i++;
                        }
                    }
                    else if (str[i] == '#') {
                        while (str[i + 1] != '.' &amp;&amp; str[i + 1] != '#' &amp;&amp; i + 1 &lt; str.length) {
                            node.id += str[i + 1];
                            i++;
                        }
                    }
                }
                if (position) {
                    if (typeof position2 == 'number' &amp;&amp; position.childNodes.length > position2) {
                        position.insertBefore(node, position.childNodes[position2]);
                    }
                    else {
                        position.appendChild(node);
                    }
                }
                if (style) node.css(style);
                if (divposition) node.setPosition(divposition);
                if (innerHTML) node.innerHTML = innerHTML;
                if (listen) node.listen(listen);
                return node;
            },
            filediv: function () {
                var args = Array.from(arguments);
                var func = null;
                for (var i = 0; i &lt; args.length; i++) {
                    if (typeof args[i] == 'function') {
                        func = args[i];
                        args.splice(i, 1);
                        break;
                    }
                }
                var div = ui.create.div.apply(this, args);
                var input = ui.create.node('input.fileinput');
                input.type = 'file';
                input.onchange = function (e) {
                    func.call(this, this.files[0], e);
                };
                div.appendChild(input);
                div.inputNode = input;
                return div;
            },
            node: function () {
                var tagName, str, innerHTML, position, position2, style, divposition, listen;
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'string') {
                        if (typeof tagName == 'string') {
                            innerHTML = arguments[i];
                        }
                        else {
                            tagName = arguments[i];
                        }
                    }
                    else if (get.objtype(arguments[i]) == 'div' ||
                        get.objtype(arguments[i]) == 'table' ||
                        get.objtype(arguments[i]) == 'tr' ||
                        get.objtype(arguments[i]) == 'td' ||
                        get.objtype(arguments[i]) == 'body') position = arguments[i];
                    else if (typeof arguments[i] == 'number') position2 = arguments[i];
                    else if (get.itemtype(arguments[i]) == 'divposition') divposition = arguments[i];
                    else if (typeof arguments[i] == 'object') style = arguments[i];
                    else if (typeof arguments[i] == 'function') listen = arguments[i];
                }
                if (tagName == undefined) {
                    tagName = 'div';
                }
                else {
                    var i1 = tagName.indexOf('.');
                    var i2 = tagName.indexOf('#');
                    if (i1 != -1 || i2 != -1) {
                        if (i2 != -1 &amp;&amp; i2 &lt; i1) {
                            i1 = i2;
                        }
                        str = tagName.slice(i1);
                        tagName = tagName.slice(0, i1);
                    }
                }
                var node = document.createElement(tagName);
                if (str) {
                    for (var i = 0; i &lt; str.length; i++) {
                        if (str[i] == '.') {
                            if (node.className.length != 0) {
                                node.className += ' ';
                            }
                            while (str[i + 1] != '.' &amp;&amp; str[i + 1] != '#' &amp;&amp; i + 1 &lt; str.length) {
                                node.className += str[i + 1];
                                i++;
                            }
                        }
                        else if (str[i] == '#') {
                            while (str[i + 1] != '.' &amp;&amp; str[i + 1] != '#' &amp;&amp; i + 1 &lt; str.length) {
                                node.id += str[i + 1];
                                i++;
                            }
                        }
                    }
                }
                if (position) {
                    if (typeof position2 == 'number' &amp;&amp; position.childNodes.length > position2) {
                        position.insertBefore(node, position.childNodes[position2]);
                    }
                    else {
                        position.appendChild(node);
                    }
                }
                if (style) HTMLDivElement.prototype.css.call(node, style);
                if (divposition) HTMLDivElement.prototype.setPosition.call(node, divposition);
                if (innerHTML) node.innerHTML = innerHTML;
                if (listen) node.onclick = listen;
                return node;
            },
            iframe: function (src) {
                var layer = document.createElement('div');
                layer.classList.add('poplayer');
                layer.style.zIndex = '100';
                layer.listen(function () {
                    this.remove();
                });
                layer.style.background = 'white';

                var webview = document.createElement('iframe');
                webview.src = src;
                webview.style.width = '100%';
                webview.style.height = '100%';
                webview.style.left = '0px';
                webview.style.top = '0px';
                webview.style.position = 'absolute';
                webview.style.border = 'none';
                layer.appendChild(webview);

                var backbutton = ui.create.div('.menubutton.round', '', layer, function () {
                    layer.remove();
                });
                backbutton.style.bottom = '10px';
                backbutton.style.right = '10px';
                backbutton.style.background = 'rgba(0,0,0,0.4)';
                backbutton.style.color = 'white';
                backbutton.style.textShadow = 'rgba(0,0,0,0.5) 0px 0px 2px';
                backbutton.style.boxShadow = 'rgba(0, 0, 0, 0.3) 0 0 0 1px, rgba(0, 0, 0, 0.3) 0 3px 10px';
                backbutton.style.position = 'fixed';

                ui.window.appendChild(layer);
            },
            identitycircle: function (list, target) {
                var container = ui.create.div('.identitycircle.menubg', target);
                var circle = ui.create.div(container);
                container.dataset.num = list.length;
                for (var i = 0; i &lt; list.length; i++) {
                    var sec1 = ui.create.div(circle);
                    sec1.dataset.color = list[i];
                    var sec2 = ui.create.div(circle);
                    sec2.dataset.color = list[i];
                    var deg1 = 360 / list.length * i;
                    var deg2 = 0;
                    if (list.length == 2) {
                        deg2 = 90;
                    }
                    else if (list.length == 3) {
                        deg2 = 30;
                    }
                    sec1.style.transform = 'rotate(' + deg1 + 'deg)';
                    sec2.style.transform = 'rotate(' + (deg1 + deg2) + 'deg)';
                }
            },
            chat: function () {
                var chat = ui.create.system('', null, true);
                ui.chatButton = chat;
                lib.setPopped(chat, ui.click.chat, 220);
            },
            exit: function () {
                if (!ui.exit) {
                    ui.exit = ui.create.control('', ui.click.exit);
                }
            },
            connecting: function (bool) {
                if (bool) {
                    ui.window.classList.remove('connecting');
                    if (ui.connecting) {
                        ui.connecting.delete();
                        delete ui.connecting;
                    }
                }
                else {
                    ui.window.classList.add('connecting');
                    ui.connecting = ui.create.div('.fullsize.connectlayer');
                    document.body.appendChild(ui.connecting);
                    ui.create.div('', '...', ui.connecting);
                    ui.connecting.splashtimeout = setTimeout(function () {
                        if (ui.connecting) {
                            delete ui.connecting.splashtimeout;
                        }
                    }, 300);
                    // setTimeout(function(){
                    //     if(ui.connecting){
                    //         ui.connecting.firstChild.show();
                    //     }
                    // },1000);
                }
            },
            roomInfo: function () {
                var chat = ui.create.system(game.online ? '' : '', function () {
                    if (!game.online || game.onlinezhu) {
                        ui.click.connectMenu();
                    }
                }, true);
                ui.roomInfo = chat;
                lib.setPopped(chat, function () {
                    if (game.getRoomInfo) {
                        var uiintro = ui.create.dialog('hidden');
                        game.getRoomInfo(uiintro);
                        return uiintro;
                    }
                }, 180);
            },
            templayer: function (time) {
                if (typeof time != 'number' || isNaN(time) || time == Infinity) {
                    time = 500;
                }
                var templayer = ui.create.div('.popup-container', ui.window);
                setTimeout(function () {
                    templayer.remove();
                }, time);
            },
            selectlist: function (list, init, position, onchange) {
                var select = document.createElement('select');
                for (var i = 0; i &lt; list.length; i++) {
                    var option = document.createElement('option');
                    if (Array.isArray(list[i])) {
                        option.value = list[i][0];
                        option.innerHTML = list[i][1];
                    }
                    else {
                        option.value = list[i];
                        option.innerHTML = list[i];
                    }
                    if (init == option.value) {
                        option.selected = 'selected';
                    }
                    select.appendChild(option);
                }
                if (position) {
                    position.appendChild(select);
                }
                if (onchange) {
                    select.onchange = onchange;
                }
                return select;
            },
            /**
             * 
             * @param {*} connectMenu 
             */
            menu: function (connectMenu) {
                var menuTimeout = null;
                if (!connectMenu &amp;&amp; !game.syncMenu) {
                    menuTimeout = setTimeout(lib.init.reset, 1000);
                }
                var menu, menuContainer;
                var startButton;
                var popupContainer;
                var closeMenu = function () {
                    if (popupContainer.noclose) {
                        popupContainer.noclose = false;
                        return;
                    }
                    popupContainer.classList.add('hidden');
                    if (popupContainer.onclose) {
                        popupContainer.onclose();
                    }
                };
                popupContainer = ui.create.div('.popup-container.hidden', ui.window, closeMenu);

                var openMenu = function (node, e, onclose) {
                    popupContainer.innerHTML = '';
                    var left = Math.round(e.clientX / game.documentZoom);
                    var zoom = get.is.phoneLayout ? 1.3 : 1;
                    popupContainer.appendChild(node);
                    // var rect=node.getBoundingClientRect();
                    if (node.classList.contains('visual')) {
                        // var num=node.querySelectorAll('.menu.visual>div').length;
                        // node.style.top=(e.y-node.offsetHeight/2+30)+'px';
                        for (var i = 0; i &lt; node.childElementCount; i++) {
                            if (node.childNodes[i].update) {
                                node.childNodes[i].update();
                            }
                        }
                        // if(node.offsetTop&lt;10){
                        //     node.style.top='10px';
                        // }
                    }
                    // else if(get.is.phoneLayout()&amp;&amp;rect.top*1.3+rect.height*1.3+20>ui.window.offsetHeight){
                    //     node.style.top=(ui.winheightdow.offsetHeight-20-rect.height*1.3)/1.3+'px';
                    // }
                    // if(e){
                    var height = node.offsetHeight;
                    var idealtop = e.clientY / game.documentZoom;
                    if (idealtop &lt; 10) {
                        idealtop = 10;
                    }
                    else if ((idealtop + height) * zoom + 10 > ui.window.offsetHeight) {
                        idealtop = (ui.window.offsetHeight - 10) / zoom - height;
                    }
                    node.style.top = idealtop + 'px';
                    node.style.left = left + 'px';
                    // }

                    popupContainer.classList.remove('hidden');
                    popupContainer.onclose = onclose;
                };
                var clickToggle = function () {
                    if (this.classList.contains('disabled')) return;
                    this.classList.toggle('on');
                    var config = this._link.config;
                    if (config.onclick) {
                        if (config.onclick.call(this, this.classList.contains('on')) === false) {
                            this.classList.toggle('on');
                        }
                    }
                    if (config.update) {
                        config.update();
                    }
                };
                var clickSwitcher = function () {
                    if (this.classList.contains('disabled')) return;
                    var node = this;
                    this.classList.add('on');
                    if (this._link.menu) {
                        var pos1 = this.lastChild.getBoundingClientRect();
                        var pos2 = ui.window.getBoundingClientRect();
                        if (this._link.menu.classList.contains('visual')) {
                            openMenu(this._link.menu, {
                                clientX: pos1.left + pos1.width + 5 - pos2.left,
                                clientY: pos1.top - pos2.top
                            }, function () {
                                node.classList.remove('on');
                            });
                        }
                        else if (this._link.menu.childElementCount > 10) {
                            openMenu(this._link.menu, {
                                clientX: pos1.left + pos1.width + 5 - pos2.left,
                                clientY: Math.min((ui.window.offsetHeight - 400) / 2, pos1.top - pos2.top)
                            }, function () {
                                node.classList.remove('on');
                            });
                            lib.setScroll(this._link.menu);
                        }
                        else {
                            openMenu(this._link.menu, {
                                clientX: pos1.left + pos1.width + 5 - pos2.left,
                                clientY: pos1.top - pos2.top
                            }, function () {
                                node.classList.remove('on');
                            });
                        }
                    }
                };
                var clickContainer = function () {
                    menuContainer.classList.add('hidden');
                    if (connectMenu) {
                        if (_status.enteringroom) {
                            _status.enteringroom = false;
                        }
                        if (_status.creatingroom) {
                            _status.creatingroom = false;
                        }
                        ui.window.classList.remove('shortcutpaused');
                    }
                    else {
                        game.resume2();
                        if (game.onresume2) {
                            game.onresume2();
                        }
                        ui.arena.classList.remove('menupaused');
                        ui.historybar.classList.remove('menupaused');
                        ui.window.classList.remove('touchinfohidden');
                        ui.config2.classList.remove('pressdown2');
                    }
                };
                var clickMenuItem = function () {
                    var node = this.parentNode._link;
                    var config = node._link.config;
                    node._link.current = this.link;
                    var tmpName = node.lastChild.innerHTML;
                    node.lastChild.innerHTML = config.item[this._link];
                    if (config.onclick) {
                        if (config.onclick.call(node, this._link, this) === false) {
                            node.lastChild.innerHTML = tmpName;
                        }
                    }
                    if (config.update) {
                        config.update();
                    }
                };
                var createMenu = function (tabs, config) {
                    var createPage = function (position) {
                        var node = ui.create.div(position);
                        lib.setScroll(ui.create.div('.left.pane', node));
                        lib.setScroll(ui.create.div('.right.pane', node));
                        return node;
                    };
                    var menu = ui.create.div('.main.menu.dialog.popped.static', config.position, function (e) {
                        e.stopPropagation();
                    });
                    if (connectMenu) {
                        menu.classList.add('center');
                        menuContainer.classList.add('centermenu');
                    }
                    var menuTab = ui.create.div('.menu-tab', menu);
                    var menuTabBar = ui.create.div('.menu-tab-bar', menu);
                    menuTabBar.style.left = (config.bar || 0) + 'px';
                    if (Math.round(2 * game.documentZoom) &lt; 2) {
                        menuTabBar.style.height = '3px';
                    }
                    var menuContent = ui.create.div('.menu-content', menu);
                    var clickTab = function () {
                        if (this.classList.contains('disabled')) return;
                        var active = this.parentNode.querySelector('.active');
                        if (active) {
                            active.classList.remove('active');
                            active._link.remove();
                        }
                        this.classList.add('active');
                        menuTabBar.style.transform = 'translateX(' + (this.getBoundingClientRect().left - this.parentNode.firstChild.getBoundingClientRect().left) / game.documentZoom + 'px)';
                        menuContent.appendChild(this._link);
                    };
                    ui.click.menuTab = function (tab) {
                        for (var i = 0; i &lt; menuTab.childNodes.length; i++) {
                            if (menuTab.childNodes[i].innerHTML == tab) {
                                clickTab.call(menuTab.childNodes[i]);
                                return;
                            }
                        }
                    };
                    var pages = [];
                    for (var i = 0; i &lt; tabs.length; i++) {
                        var active = (i === (config.init || 0));
                        pages[i] = createPage(active ? menuContent : null);
                        ui.create.div(active ? '.active' : '', tabs[i], menuTab, clickTab)._link = pages[i];
                    }
                    return {
                        menu: menu,
                        pages: pages
                    };
                };
                var createConfig = function (config, position) {
                    var node = ui.create.div('.config', config.name);
                    node._link = { config: config };
                    if (!config.clear) {
                        if (config.name != '') {
                            if (config.name == '') {
                                config.intro = 'AI'
                            }
                            else if (config.name == '') {
                                config.intro = 'AI'
                            }
                            else if (!config.intro) {
                                config.intro = '' + config.name;
                            }
                            lib.setIntro(node, function (uiintro) {
                                if (lib.config.touchscreen) _status.dragged = true;
                                uiintro.style.width = '170px';
                                var str = config.intro;
                                if (typeof str == 'function') {
                                    str = str();
                                }
                                uiintro._place_text = uiintro.add('&lt;div class="text" style="display:inline">' + str + '&lt;/div>');
                            });
                        }
                    }
                    else {
                        node.innerHTML = '&lt;span>' + config.name + '&lt;/span>';
                        if (!config.nopointer) {
                            node.classList.add('pointerspan');
                        }
                    }
                    if (config.item) {
                        if (typeof config.item == 'function') {
                            config.item = config.item();
                        }
                        if (Array.isArray(config.init)) {

                        }
                        else {
                            node.classList.add('switcher');
                            node.listen(clickSwitcher);
                            node._link.choosing = ui.create.div('', config.item[config.init], node);
                            node._link.menu = ui.create.div('.menu');
                            if (config.visualMenu) {
                                node._link.menu.classList.add('visual');
                                var updateVisual = function () {
                                    config.visualMenu(this, this._link, config.item[this._link], config);
                                };
                                var createNode = function (i, before) {
                                    var visualMenu = ui.create.div();
                                    if (config.visualBar) {
                                        if (before) {
                                            node._link.menu.insertBefore(visualMenu, before);
                                        }
                                        else {
                                            node._link.menu.insertBefore(visualMenu, node._link.menu.lastChild);
                                        }
                                    }
                                    else {
                                        node._link.menu.appendChild(visualMenu);
                                    }
                                    ui.create.div('.name', get.verticalStr(config.item[i]), visualMenu);
                                    visualMenu._link = i;
                                    if (config.visualMenu(visualMenu, i, config.item[i], config) !== false) {
                                        visualMenu.listen(clickMenuItem);
                                    }
                                    visualMenu.update = updateVisual;
                                };
                                if (config.visualBar) {
                                    var visualBar = ui.create.div(node._link.menu, function () {
                                        this.parentNode.parentNode.noclose = true;
                                    });
                                    node._link.menu.classList.add('withbar');
                                    config.visualBar(visualBar, config.item, createNode, node);
                                    visualBar.update = function () {
                                        config.visualBar(visualBar, config.item, createNode, node);
                                    }
                                }
                                for (var i in config.item) {
                                    createNode(i);
                                }
                                lib.setScroll(node._link.menu);
                                node._link.menu.updateBr = function () {
                                    var br = Array.from(this.querySelectorAll('.menu.visual>br'));
                                    while (br.length) {
                                        br.shift().remove();
                                    }
                                    var split = [];
                                    for (var i = 1; i &lt; this.childElementCount; i++) {
                                        if (i % 3 == 0) {
                                            split.push(this.childNodes[i]);
                                        }
                                    }
                                    for (var i = 0; i &lt; split.length; i++) {
                                        this.insertBefore(ui.create.node('br'), split[i]);
                                    }
                                }
                                node._link.menu.updateBr();
                            }
                            else {
                                for (var i in config.item) {
                                    var textMenu = ui.create.div('', config.item[i], node._link.menu, clickMenuItem);
                                    textMenu._link = i;
                                    if (config.textMenu) {
                                        config.textMenu(textMenu, i, config.item[i], config)
                                    }
                                    lib.setScroll(node._link.menu);
                                }
                            }
                            node._link.menu._link = node;
                            node._link.current = config.init;
                        }
                    }
                    else if (config.range) {

                    }
                    else if (config.clear) {
                        if (node.innerHTML.length >= 15) node.style.height = 'auto';
                        node.listen(clickToggle);
                    }
                    else if (config.input) {
                        node.classList.add('switcher');
                        var input = ui.create.div(node);
                        if (!config.fixed) {
                            input.contentEditable = true;
                            input.style.webkitUserSelect = 'text';
                        }
                        input.style.minWidth = '10px';
                        input.onkeydown = function (e) {
                            if (e.keyCode == 13) {
                                e.preventDefault();
                                e.stopPropagation();
                                input.blur();
                            }
                        };
                        if (config.name == '') {
                            input.innerHTML = config.init || '';
                            input.onblur = function () {
                                input.innerHTML = input.innerHTML.replace(/&lt;br>/g, '');
                                if (!input.innerHTML || get.is.banWords(input.innerHTML)) {
                                    input.innerHTML = '';
                                }
                                input.innerHTML = input.innerHTML.slice(0, 12);
                                game.saveConfig('connect_nickname', input.innerHTML);
                                game.saveConfig('connect_nickname', input.innerHTML, 'connect');
                            }
                        }
                        else if (config.name == '') {
                            input.innerHTML = config.init || lib.hallURL;
                            input.onblur = function () {
                                if (!input.innerHTML) {
                                    input.innerHTML = lib.hallURL;
                                }
                                input.innerHTML = input.innerHTML.replace(/&lt;br>/g, '');
                                game.saveConfig('hall_ip', input.innerHTML, 'connect');
                            }
                        }
                        else {
                            input.innerHTML = config.init;
                            input.onblur = config.onblur;
                        }
                    }
                    else {
                        node.classList.add('toggle');
                        node.listen(clickToggle);
                        ui.create.div(ui.create.div(node));
                        if (config.init == true) {
                            node.classList.add('on');
                        }
                    }
                    if (position) {
                        position.appendChild(node);
                    }
                    return node;
                };
                var updateActive, updateActiveCard;
                var menuUpdates = [];
                menuContainer = ui.create.div('.menu-container.hidden', ui.window, clickContainer);
                var menux;
                if (!connectMenu) {
                    ui.menuContainer = menuContainer;
                    ui.click.configMenu = function () {
                        ui.click.shortcut(false)
                        if (menuContainer.classList.contains('hidden')) {
                            ui.config2.classList.add('pressdown2');
                            ui.arena.classList.add('menupaused');
                            ui.historybar.classList.add('menupaused');
                            ui.window.classList.add('touchinfohidden');
                            menuContainer.classList.remove('hidden');
                            for (var i = 0; i &lt; menuUpdates.length; i++) {
                                menuUpdates[i]();
                            }
                        }
                        else {
                            clickContainer.call(menuContainer);
                        }
                    }
                    menux = createMenu(['', '', '', '', '', ''], {
                        position: menuContainer, bar: 40
                    });
                }
                else {
                    ui.connectMenuContainer = menuContainer;
                    ui.click.connectMenu = function () {
                        if (menuContainer.classList.contains('hidden')) {
                            if (_status.waitingForPlayer) {
                                startButton.innerHTML = '';
                                var start = menux.pages[0].firstChild;
                                for (var i = 0; i &lt; start.childNodes.length; i++) {
                                    if (start.childNodes[i].mode != lib.configOL.mode) {
                                        start.childNodes[i].classList.add('unselectable');
                                        start.childNodes[i].classList.remove('active');
                                        start.childNodes[i].link.remove();
                                    }
                                    else {
                                        start.childNodes[i].classList.add('active');
                                        start.nextSibling.appendChild(start.childNodes[i].link);
                                    }
                                }
                            }
                            ui.window.classList.add('shortcutpaused');
                            menuContainer.classList.remove('hidden');
                            for (var i = 0; i &lt; menuUpdates.length; i++) {
                                menuUpdates[i]();
                            }
                        }
                        else {
                            clickContainer.call(menuContainer);
                        }
                    }

                    menux = createMenu(['', '', ''], {
                        position: menuContainer, bar: 123
                    });
                    menu = menux.menu;
                }
                var menuxpages = menux.pages.slice(0);

                var copyObj = get.copy;

                (function () {
                    var start = menuxpages.shift();
                    var rightPane = start.lastChild;

                    startButton = ui.create.div('.menubutton.round.highlight', '', start, function () {
                        if (this.animating || this.classList.contains('dim')) {
                            return;
                        }
                        var active = this.parentNode.querySelector('.active');
                        if (active) {
                            if (connectMenu) {
                                if (_status.waitingForPlayer) {
                                    var config = {};
                                    for (var i in lib.mode[lib.configOL.mode].connect) {
                                        if (i == 'update') continue;
                                        config[i.slice(8)] = get.config(i, lib.configOL.mode);
                                    }
                                    if (game.online) {
                                        if (game.onlinezhu) {
                                            game.send('changeRoomConfig', config);
                                        }
                                    }
                                    else {
                                        game.broadcastAll(function (config) {
                                            for (var i in config) {
                                                lib.configOL[i] = config[i];
                                            }
                                        }, config);
                                        if (lib.configOL.mode == 'identity' &amp;&amp; lib.configOL.identity_mode == 'zhong' &amp;&amp; game.connectPlayers) {
                                            for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                                game.connectPlayers[i].classList.remove('unselectable2');
                                            }
                                            lib.configOL.number = 8;
                                            game.updateWaiting();
                                        }
                                        if (game.onlineroom) {
                                            game.send('server', 'config', lib.configOL);
                                        }
                                        game.connectPlayers[0].chat('');
                                    }
                                }
                                else if (_status.enteringroom || _status.creatingroom) {
                                    lib.configOL.mode = active.mode;
                                    if (_status.enteringroomserver) {
                                        game.saveConfig('connect_mode', lib.configOL.mode);

                                        var config = {};
                                        for (var i in lib.mode[lib.configOL.mode].connect) {
                                            if (i == 'update') continue;
                                            config[i.slice(8)] = get.config(i, lib.configOL.mode);
                                        }

                                        config.characterPack = lib.connectCharacterPack.slice(0);
                                        config.cardPack = lib.connectCardPack.slice(0);
                                        for (var i = 0; i &lt; lib.config.connect_characters.length; i++) {
                                            config.characterPack.remove(lib.config.connect_characters[i]);
                                        }
                                        for (var i = 0; i &lt; lib.config.connect_cards.length; i++) {
                                            config.cardPack.remove(lib.config.connect_cards[i]);
                                        }
                                        config.banned = lib.config['connect_' + active.mode + '_banned'];
                                        config.bannedcards = lib.config['connect_' + active.mode + '_bannedcards'];
                                        game.send('server', 'create', game.onlineKey, get.connectNickname(), lib.config.connect_avatar, config, active.mode);
                                    }
                                    else {
                                        game.send('server', 'create', game.onlineKey, get.connectNickname(), lib.config.connect_avatar);
                                    }
                                }
                                else {
                                    localStorage.setItem(lib.configprefix + 'directstart', true);
                                    game.saveConfig('directstartmode', active.mode);
                                    game.saveConfig('mode', 'connect');
                                    ui.exitroom = ui.create.system('', function () {
                                        game.saveConfig('directstartmode');
                                        game.reload();
                                    }, true);
                                    game.switchMode(active.mode);
                                }
                                clickContainer.call(menuContainer);
                            }
                            else {
                                game.saveConfig('mode', active.mode);
                                localStorage.setItem(lib.configprefix + 'directstart', true);
                                game.reload();
                            }
                        }
                    });

                    var clickMode = function () {
                        if (this.classList.contains('unselectable')) return;
                        var active = this.parentNode.querySelector('.active');
                        if (active === this) {
                            return;
                        }
                        active.classList.remove('active');
                        active.link.remove();
                        active = this;
                        this.classList.add('active');
                        rightPane.appendChild(this.link);
                        if (connectMenu) {
                            if (updateActive) updateActive();
                            if (updateActiveCard) updateActiveCard();
                        }
                    };

                    var createModeConfig = function (mode, position) {
                        var info = lib.mode[mode];
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', info.name, position, clickMode);
                        node.link = page;
                        node.mode = mode;
                        if (connectMenu) {
                            if (mode == lib.config.connect_mode) {
                                node.classList.add('active');
                            }
                        }
                        else {
                            if (mode == lib.config.mode) {
                                node.classList.add('active');
                            }
                        }
                        var map = {};
                        var infoconfig = connectMenu ? info.connect : info.config;
                        if (infoconfig) {
                            var hiddenNodes = [];
                            var config = lib.config.mode_config[mode] || {};
                            if (connectMenu) {
                                infoconfig.connect_choose_timeout = {
                                    name: '',
                                    init: '30',
                                    item: {
                                        '10': '10',
                                        '15': '15',
                                        '30': '30',
                                        '60': '60',
                                        '90': '90',
                                    },
                                    connect: true,
                                    frequent: true
                                };
                                infoconfig.connect_chooseCharacter_timeout = {
                                    name: '',
                                    init: true,
                                    connect: true
                                };
                                infoconfig.connect_observe = {
                                    name: '',
                                    init: true,
                                    connect: true
                                };
                                infoconfig.connect_observe_handcard = {
                                    name: '',
                                    init: false,
                                    connect: true
                                };
                                infoconfig.connect_protect_beginner = {
                                    name: '',
                                    init: true,
                                    connect: true
                                };
                                infoconfig.connect_observe_race = {
                                    name: '',
                                    init: false,
                                    connect: true
                                };
                            }
                            for (var j in infoconfig) {
                                if (j === 'update') {
                                    continue;
                                }
                                var cfg = copyObj(infoconfig[j]);
                                cfg._name = j;
                                cfg.mode = mode;
                                if (!config.hasOwnProperty(j)) {
                                    game.saveConfig(j, cfg.init, mode);
                                }
                                else {
                                    cfg.init = config[j];
                                }
                                if (!cfg.onclick) {
                                    cfg.onclick = function (result) {
                                        var cfg = this._link.config;
                                        game.saveConfig(cfg._name, result, mode);
                                        if (cfg.onsave) {
                                            cfg.onsave.call(this, result);
                                        }
                                        if (!_status.connectMode || game.online) {
                                            if (typeof cfg.restart == 'function') {
                                                if (cfg.restart()) {
                                                    startButton.classList.add('glowing');
                                                }
                                            }
                                            else if (cfg.restart) {
                                                startButton.classList.add('glowing');
                                            }
                                        }
                                    };
                                }
                                if (infoconfig.update) {
                                    cfg.update = function () {
                                        infoconfig.update(config, map);
                                    };
                                }
                                var cfgnode = createConfig(cfg);
                                map[j] = cfgnode;
                                if (cfg.frequent) {
                                    page.appendChild(cfgnode);
                                }
                                else {
                                    cfgnode.classList.add('auto-hide');
                                    hiddenNodes.push(cfgnode);
                                }
                            }
                            if (!connectMenu) {
                                var move = ui.create.div('.auto-hide.config', '&lt;div style="margin-right:10px" class="pointerdiv">&lt;/div>&lt;div class="pointerdiv">&lt;/div>');
                                move.firstChild.listen(function () {
                                    if (node.previousSibling) {
                                        node.parentNode.insertBefore(node, node.previousSibling);
                                        var order = [];
                                        for (var i = 0; i &lt; node.parentNode.childNodes.length; i++) {
                                            order.push(node.parentNode.childNodes[i].mode);
                                        }
                                        game.saveConfig('modeorder', order);
                                    }
                                });
                                move.lastChild.listen(function () {
                                    if (node.nextSibling) {
                                        if (node.nextSibling.nextSibling) {
                                            node.parentNode.insertBefore(node, node.nextSibling.nextSibling);
                                        }
                                        else {
                                            node.parentNode.insertBefore(node.nextSibling, node);
                                        }
                                        var order = [];
                                        for (var i = 0; i &lt; node.parentNode.childNodes.length; i++) {
                                            order.push(node.parentNode.childNodes[i].mode);
                                        }
                                        game.saveConfig('modeorder', order);
                                    }
                                });
                                hiddenNodes.push(move);
                            }
                            var expanded = false;
                            var hasexpand = true;
                            if (hiddenNodes.length) {
                                if (lib.config.fold_mode) {
                                    var clickmore = function (type) {
                                        if (type === 'expand' &amp;&amp; expanded) return;
                                        if (type === 'unexpand' &amp;&amp; !expanded) return;
                                        if (expanded) {
                                            this.classList.remove('on');
                                            this.parentNode.classList.remove('expanded');
                                        }
                                        else {
                                            this.classList.add('on');
                                            this.parentNode.classList.add('expanded');
                                        }
                                        expanded = !expanded;
                                    };
                                    var morenodes = ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', page);
                                    morenodes.listen(clickmore);
                                    morenodes._onclick = clickmore;
                                    page.morenodes = morenodes;
                                }
                                else {
                                    page.classList.add('expanded');
                                    if (!connectMenu) {
                                        page.classList.add('expanded2');
                                    }
                                }
                                for (var k = 0; k &lt; hiddenNodes.length; k++) {
                                    page.appendChild(hiddenNodes[k]);
                                }
                            }
                            else {
                                hasexpand = false;
                            }
                            if (!connectMenu) {
                                var hidemode = ui.create.div('.config.pointerspan', '&lt;span>&lt;/span>', page, function () {
                                    if (this.firstChild.innerHTML == '') {
                                        this.firstChild.innerHTML = '';
                                        lib.config.hiddenModePack.add(mode);
                                        if (!lib.config.prompt_hidepack) {
                                            alert('--');
                                            game.saveConfig('prompt_hidepack', true);
                                        }
                                    }
                                    else {
                                        this.firstChild.innerHTML = '';
                                        lib.config.hiddenModePack.remove(mode);
                                    }
                                    game.saveConfig('hiddenModePack', lib.config.hiddenModePack);
                                });
                                if (hasexpand) {
                                    hidemode.classList.add('auto-hide');
                                }
                            }
                            if (infoconfig.update) {
                                infoconfig.update(config, map);
                                node.update = function () {
                                    infoconfig.update(config, map);
                                }
                            }
                        }
                        if (connectMenu) {
                            menuUpdates.push(function () {
                                if (_status.waitingForPlayer) {
                                    if (map.connect_player_number) {
                                        map.connect_player_number.style.display = 'none';
                                    }
                                    if (map.connect_versus_mode) {
                                        map.connect_versus_mode.style.display = 'none';
                                    }
                                }
                            })
                        }
                        return node;
                    };
                    var modeorder = lib.config.modeorder || [];
                    for (var i in lib.mode) {
                        modeorder.add(i);
                    }
                    for (var i = 0; i &lt; modeorder.length; i++) {
                        if (connectMenu) {
                            if (!lib.mode[modeorder[i]].connect) continue;
                            if (!lib.config['connect_' + modeorder[i] + '_banned']) {
                                lib.config['connect_' + modeorder[i] + '_banned'] = [];
                            }
                            if (!lib.config['connect_' + modeorder[i] + '_bannedcards']) {
                                lib.config['connect_' + modeorder[i] + '_bannedcards'] = [];
                            }
                        }
                        if (lib.config.all.mode.contains(modeorder[i])) {
                            createModeConfig(modeorder[i], start.firstChild);
                        }
                    }
                    var active = start.firstChild.querySelector('.active');
                    if (!active) {
                        active = start.firstChild.firstChild;
                        active.classList.add('active');
                    }
                    rightPane.appendChild(active.link);
                    if (lib.config.fold_mode) {
                        rightPane.addEventListener('mousewheel', function (e) {
                            var morenodes = this.firstChild.morenodes;
                            if (morenodes) {
                                if (e.wheelDelta &lt; 0) {
                                    morenodes._onclick.call(morenodes, 'expand');
                                }
                                else if (this.scrollTop == 0) {
                                    morenodes._onclick.call(morenodes, 'unexpand');
                                }
                            }
                        }, { passive: true });
                    }
                }());

                (function () {
                    if (connectMenu) return;
                    var start = menuxpages.shift();
                    var rightPane = start.lastChild;

                    var clickMode = function () {
                        var active = this.parentNode.querySelector('.active');
                        if (active === this) {
                            return;
                        }
                        active.classList.remove('active');
                        active.link.remove();
                        active = this;
                        this.classList.add('active');
                        rightPane.appendChild(this.link);
                    };

                    var clickAutoSkill = function (bool) {
                        var name = this._link.config._name;
                        var list = lib.config.autoskilllist;
                        if (bool) {
                            list.remove(name);
                        }
                        else {
                            list.add(name);
                        }
                        game.saveConfig('autoskilllist', list);
                    };
                    var skilllistexpanded = game.expandSkills(lib.skilllist);
                    for (var i in lib.skill) {
                        if (!skilllistexpanded.contains(i)) continue;
                        if (lib.skill[i].frequent &amp;&amp; lib.translate[i]) {
                            lib.configMenu.skill.config[i] = {
                                name: lib.translate[i + '_noconf'] || lib.translate[i],
                                init: true,
                                type: 'autoskill',
                                onclick: clickAutoSkill,
                                intro: lib.translate[i + '_info']
                            }
                        }
                    }
                    var clickBanSkill = function (bool) {
                        var name = this._link.config._name;
                        var list = lib.config.forbidlist;
                        if (bool) {
                            list.remove(name);
                        }
                        else {
                            list.add(name);
                        }
                        game.saveConfig('forbidlist', list);
                    };
                    var forbid = lib.config.forbid;
                    if (!lib.config.forbidlist) {
                        game.saveConfig('forbidlist', []);
                    }
                    for (var i = 0; i &lt; forbid.length; i++) {
                        var skip = false;
                        var str = '';
                        var str2 = '';
                        var str3 = '';
                        for (var j = 0; j &lt; forbid[i].length; j++) {
                            if (!lib.skilllist.contains(forbid[i][j])) {
                                skip = true;
                                break;
                            }
                            str += get.translation(forbid[i][j]) + '+';
                            str2 += forbid[i][j] + '+';
                            str3 += get.translation(forbid[i][j]) + '' + lib.translate[forbid[i][j] + '_info'];
                            if (j &lt; forbid[i].length - 1) {
                                str3 += '&lt;div class="placeholder slim" style="display:block;height:8px">&lt;/div>';
                            }
                        }
                        if (skip) continue;
                        str = str.slice(0, str.length - 1);
                        str2 = str2.slice(0, str2.length - 1);

                        lib.configMenu.skill.config[str2] = {
                            name: str,
                            init: true,
                            type: 'banskill',
                            onclick: clickBanSkill,
                            intro: str3
                        }
                    }

                    var updateView = null;
                    var updateAppearence = null;
                    var createModeConfig = function (mode, position) {
                        var info = lib.configMenu[mode];
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', info.name, position, clickMode);
                        node.link = page;
                        node.mode = mode;
                        var map = {};
                        if (info.config) {
                            var hiddenNodes = [];
                            var autoskillNodes = [];
                            var banskillNodes = [];
                            var custombanskillNodes = [];
                            var banskill;

                            if (mode == 'skill') {
                                var autoskillexpanded = false;
                                var banskillexpanded = false;
                                ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                    if (autoskillexpanded) {
                                        this.classList.remove('on');
                                        for (var k = 0; k &lt; autoskillNodes.length; k++) {
                                            autoskillNodes[k].style.display = 'none';
                                        }
                                    }
                                    else {
                                        this.classList.add('on');
                                        for (var k = 0; k &lt; autoskillNodes.length; k++) {
                                            autoskillNodes[k].style.display = '';
                                        }
                                    }
                                    autoskillexpanded = !autoskillexpanded;
                                });
                                banskill = ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                    if (banskillexpanded) {
                                        this.classList.remove('on');
                                        for (var k = 0; k &lt; banskillNodes.length; k++) {
                                            banskillNodes[k].style.display = 'none';
                                        }
                                    }
                                    else {
                                        this.classList.add('on');
                                        for (var k = 0; k &lt; banskillNodes.length; k++) {
                                            banskillNodes[k].style.display = '';
                                        }
                                    }
                                    banskillexpanded = !banskillexpanded;
                                });

                                var banskilladd = ui.create.div('.config.indent', '&lt;span class="pointerdiv">...&lt;/span>', page, function () {
                                    this.nextSibling.classList.toggle('hidden');
                                });
                                banskilladd.style.display = 'none';
                                banskillNodes.push(banskilladd);

                                var banskilladdNode = ui.create.div('.config.indent.hidden.banskilladd', page);
                                banskilladdNode.style.display = 'none';
                                banskillNodes.push(banskilladdNode);

                                var matchBanSkill = function (skills1, skills2) {
                                    if (skills1.length != skills2.length) return false;
                                    for (var i = 0; i &lt; skills1.length; i++) {
                                        if (!skills2.contains(skills1[i])) return false;
                                    }
                                    return true;
                                }
                                var deleteCustomBanSkill = function () {
                                    for (var i = 0; i &lt; lib.config.customforbid.length; i++) {
                                        if (matchBanSkill(lib.config.customforbid[i], this.parentNode.link)) {
                                            lib.config.customforbid.splice(i--, 1);
                                            break;
                                        }
                                    }
                                    game.saveConfig('customforbid', lib.config.customforbid);
                                    this.parentNode.remove();
                                }
                                var createCustomBanSkill = function (skills) {
                                    var node = ui.create.div('.config.indent.toggle');
                                    node.style.display = 'none';
                                    node.link = skills;
                                    banskillNodes.push(node);
                                    custombanskillNodes.push(node);
                                    var str = get.translation(skills[0]);
                                    for (var i = 1; i &lt; skills.length; i++) {
                                        str += '+' + get.translation(skills[i]);
                                    }
                                    node.innerHTML = str;
                                    var span = document.createElement('span');
                                    span.classList.add('cardpiledelete');
                                    span.innerHTML = '';
                                    span.onclick = deleteCustomBanSkill;
                                    node.appendChild(span);
                                    page.insertBefore(node, banskilladdNode.nextSibling);
                                    return node;
                                };
                                for (var i = 0; i &lt; lib.config.customforbid.length; i++) {
                                    createCustomBanSkill(lib.config.customforbid[i]);
                                }
                                (function () {
                                    var list = [];
                                    for (var i in lib.character) {
                                        if (lib.character[i][3].length)
                                            list.push([i, lib.translate[i]]);
                                    }

                                    list.sort(function (a, b) {
                                        a = a[0]; b = b[0];
                                        var aa = a, bb = b;
                                        if (aa.indexOf('_') != -1) {
                                            aa = aa.slice(aa.indexOf('_') + 1);
                                        }
                                        if (bb.indexOf('_') != -1) {
                                            bb = bb.slice(bb.indexOf('_') + 1);
                                        }
                                        if (aa != bb) {
                                            return aa > bb ? 1 : -1;
                                        }
                                        return a > b ? 1 : -1;
                                    });

                                    var list2 = [];
                                    var skills = lib.character[list[0][0]][3];
                                    for (var i = 0; i &lt; skills.length; i++) {
                                        list2.push([skills[i], lib.translate[skills[i]]]);
                                    }

                                    var selectname = ui.create.selectlist(list, list[0], banskilladdNode);
                                    selectname.onchange = function () {
                                        var skills = lib.character[this.value][3];
                                        skillopt.innerHTML = '';
                                        for (var i = 0; i &lt; skills.length; i++) {
                                            var option = document.createElement('option');
                                            option.value = skills[i];
                                            option.innerHTML = lib.translate[skills[i]];
                                            skillopt.appendChild(option);
                                        }
                                    };
                                    selectname.style.maxWidth = '85px';
                                    var skillopt = ui.create.selectlist(list2, list2[0], banskilladdNode);

                                    var span = document.createElement('span');
                                    span.innerHTML = '';
                                    banskilladdNode.appendChild(span);
                                    var br = document.createElement('br');
                                    banskilladdNode.appendChild(br);

                                    var selectname2 = ui.create.selectlist(list, list[0], banskilladdNode);
                                    selectname2.onchange = function () {
                                        var skills = lib.character[this.value][3];
                                        skillopt2.innerHTML = '';
                                        for (var i = 0; i &lt; skills.length; i++) {
                                            var option = document.createElement('option');
                                            option.value = skills[i];
                                            option.innerHTML = lib.translate[skills[i]];
                                            skillopt2.appendChild(option);
                                        }
                                    };
                                    selectname2.style.maxWidth = '85px';
                                    var skillopt2 = ui.create.selectlist(list2, list2[0], banskilladdNode);
                                    var confirmbutton = document.createElement('button');
                                    confirmbutton.innerHTML = '';
                                    banskilladdNode.appendChild(confirmbutton);

                                    confirmbutton.onclick = function () {
                                        var skills = [skillopt.value, skillopt2.value];
                                        if (skills[0] == skills[1]) {
                                            skills.shift();
                                        }
                                        if (!lib.config.customforbid) return;
                                        for (var i = 0; i &lt; lib.config.customforbid.length; i++) {
                                            if (matchBanSkill(lib.config.customforbid[i], skills)) return;
                                        }
                                        lib.config.customforbid.push(skills);
                                        game.saveConfig('customforbid', lib.config.customforbid);
                                        createCustomBanSkill(skills).style.display = '';
                                    }
                                }());
                                page.style.paddingBottom = '10px';
                            }
                            var config = lib.config;
                            if (mode == 'appearence') {
                                updateAppearence = function () {
                                    info.config.update(config, map);
                                };
                            }
                            else if (mode == 'view') {
                                updateView = function () {
                                    info.config.update(config, map);
                                };
                            }
                            for (var j in info.config) {
                                if (j === 'update') {
                                    continue;
                                }
                                var cfg = copyObj(info.config[j]);
                                cfg._name = j;
                                if (!config.hasOwnProperty(j)) {
                                    if (cfg.type != 'autoskill' &amp;&amp; cfg.type != 'banskill') {
                                        game.saveConfig(j, cfg.init);
                                    }
                                }
                                else {
                                    cfg.init = config[j];
                                }
                                if (!cfg.onclick) {
                                    cfg.onclick = function (result) {
                                        var cfg = this._link.config;
                                        game.saveConfig(cfg._name, result);
                                        if (cfg.onsave) {
                                            cfg.onsave.call(this, result);
                                        }
                                    };
                                }
                                if (info.config.update) {
                                    if (mode == 'appearence' || mode == 'view') {
                                        cfg.update = function () {
                                            if (updateAppearence) {
                                                updateAppearence();
                                            }
                                            if (updateView) {
                                                updateView();
                                            }
                                        };
                                    }
                                    else {
                                        cfg.update = function () {
                                            info.config.update(config, map);
                                        };
                                    }
                                }
                                var cfgnode = createConfig(cfg);
                                if (cfg.type == 'autoskill') {
                                    autoskillNodes.push(cfgnode);
                                    // cfgnode.style.transition='all 0s';
                                    cfgnode.classList.add('indent');
                                    // cfgnode.hide();
                                    cfgnode.style.display = 'none';
                                }
                                else if (cfg.type == 'banskill') {
                                    banskillNodes.push(cfgnode);
                                    // cfgnode.style.transition='all 0s';
                                    cfgnode.classList.add('indent');
                                    // cfgnode.hide();
                                    cfgnode.style.display = 'none';
                                }
                                if (j == 'import_data_button') {
                                    ui.import_data_button = cfgnode;
                                    cfgnode.hide();
                                    cfgnode.querySelector('button').onclick = function () {
                                        var fileToLoad = this.previousSibling.files[0];
                                        if (fileToLoad) {
                                            var fileReader = new FileReader();
                                            fileReader.onload = function (fileLoadedEvent) {
                                                var data = fileLoadedEvent.target.result;
                                                if (!data) return;
                                                try {
                                                    data = JSON.parse(lib.init.decode(data));
                                                    if (!data || typeof data != 'object') {
                                                        throw ('err');
                                                    }
                                                    if (lib.db &amp;&amp; (!data.config || !data.data)) {
                                                        throw ('err');
                                                    }
                                                }
                                                catch (e) {
                                                    console.log(e);
                                                    alert('');
                                                    return;
                                                }
                                                alert('');
                                                if (!lib.db) {
                                                    var noname_inited = localStorage.getItem('noname_inited');
                                                    var onlineKey = localStorage.getItem(lib.configprefix + 'key');
                                                    localStorage.clear();
                                                    if (noname_inited) {
                                                        localStorage.setItem('noname_inited', noname_inited);
                                                    }
                                                    if (onlineKey) {
                                                        localStorage.setItem(lib.configprefix + 'key', onlineKey);
                                                    }
                                                    for (var i in data) {
                                                        localStorage.setItem(i, data[i]);
                                                    }
                                                }
                                                else {
                                                    for (var i in data.config) {
                                                        game.putDB('config', i, data.config[i]);
                                                        lib.config[i] = data.config[i];
                                                    }
                                                    for (var i in data.data) {
                                                        game.putDB('data', i, data.data[i]);
                                                    }
                                                }
                                                lib.init.background();
                                                game.reload();
                                            };
                                            fileReader.readAsText(fileToLoad, "UTF-8");
                                        }
                                    }
                                }
                                else if (j == 'import_music') {
                                    cfgnode.querySelector('button').onclick = function () {
                                        if (_status.music_importing) return;
                                        _status.music_importing = true;
                                        var fileToLoad = this.previousSibling.files[0];
                                        if (fileToLoad) {
                                            if (!lib.config.customBackgroundMusic) lib.config.customBackgroundMusic = {};
                                            var name = fileToLoad.name;
                                            if (name.indexOf('.') != -1) {
                                                name = name.slice(0, name.indexOf('.'));
                                            }
                                            var link = (game.writeFile ? 'cdv_' : 'custom_') + name;
                                            if (lib.config.customBackgroundMusic[link]) {
                                                if (!confirm('')) { _status.music_importing = false; return };
                                                for (var i = 1; i &lt; 1000; i++) {
                                                    if (!lib.config.customBackgroundMusic[link + '_' + i]) {
                                                        link = link + '_' + i; break;
                                                    }
                                                }
                                            }
                                            var callback = function () {
                                                var nodexx = ui.background_music_setting;
                                                var nodeyy = nodexx._link.menu;
                                                var nodezz = nodexx._link.config;
                                                var musicname = link.slice(link.indexOf('_') + 1);
                                                game.prompt('######' + musicname, true, function (str) {
                                                    if (str) musicname = str;
                                                    lib.config.customBackgroundMusic[link] = musicname;
                                                    lib.config.background_music = link;
                                                    lib.config.all.background_music.add(link);
                                                    game.saveConfig('background_music', link);
                                                    game.saveConfig('customBackgroundMusic', lib.config.customBackgroundMusic);
                                                    nodezz.item[link] = lib.config.customBackgroundMusic[link];
                                                    var textMenu = ui.create.div('', lib.config.customBackgroundMusic[link], nodeyy, clickMenuItem, nodeyy.childElementCount - 2);
                                                    textMenu._link = link;
                                                    nodezz.updatex.call(nodexx, []);
                                                    _status.music_importing = false;
                                                    if (!_status._aozhan) game.playBackgroundMusic();
                                                });
                                            };
                                            if (game.writeFile) {
                                                game.writeFile(fileToLoad, 'audio/background', link + '.mp3', callback);
                                            }
                                            else {
                                                game.putDB('audio', link, fileToLoad, callback);
                                            }
                                        }
                                    }
                                }
                                else if (j == 'extension_source') {
                                    ui.extension_source = cfgnode;
                                    cfgnode.updateInner = function () {
                                        this._link.choosing.innerHTML = lib.config.extension_source;
                                    }
                                }
                                map[j] = cfgnode;
                                if (!cfg.unfrequent) {
                                    if (cfg.type == 'autoskill') {
                                        page.insertBefore(cfgnode, banskill);
                                    }
                                    else {
                                        page.appendChild(cfgnode);
                                    }
                                }
                                else {
                                    // cfgnode.classList.add('auto-hide');
                                    hiddenNodes.push(cfgnode);
                                }
                            }
                            var expanded = false;
                            if (hiddenNodes.length) {
                                // ui.create.div('.config.more',' &lt;div>&amp;gt;&lt;/div>',page,function(){
                                //     if(expanded){
                                //                  this.classList.remove('on');
                                //                  this.parentNode.classList.remove('expanded');
                                //     }
                                //     else{
                                //                  this.classList.add('on');
                                //                  this.parentNode.classList.add('expanded');
                                //     }
                                //     expanded=!expanded;
                                // });
                                page.classList.add('morenodes');
                                for (var k = 0; k &lt; hiddenNodes.length; k++) {
                                    page.appendChild(hiddenNodes[k]);
                                }
                            }
                            if (info.config.update) {
                                info.config.update(config, map);
                            }
                        }
                        return node;
                    };

                    for (var i in lib.configMenu) {
                        if (i != 'others') createModeConfig(i, start.firstChild);
                    }
                    (function () {
                        if (!game.download &amp;&amp; !lib.device) return;
                        var page = ui.create.div('#create-extension');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.link = page;
                        node.mode = 'create';
                        var pageboard = ui.create.div(page);

                        var importextensionexpanded = false;
                        var importExtension;
                        var extensionnode = ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', pageboard, function () {
                            if (importextensionexpanded) {
                                this.classList.remove('on');
                                importExtension.style.display = 'none';
                            }
                            else {
                                this.classList.add('on');
                                importExtension.style.display = '';
                            }
                            importextensionexpanded = !importextensionexpanded;
                        });
                        extensionnode.style.padding = '13px 33px 4px';
                        extensionnode.style.left = '0px';
                        importExtension = ui.create.div('.new_character.export.import', pageboard);
                        importExtension.style.padding = '0px 33px 10px';
                        importExtension.style.display = 'none';
                        importExtension.style.width = '100%';
                        importExtension.style.textAlign = 'left';
                        ui.create.div('', '&lt;input type="file" accept="application/zip" style="width:153px">&lt;button>&lt;/button>', importExtension);
                        var promptnode = ui.create.div('', '&lt;div style="width:153px;font-size:small;margin-top:8px">', importExtension);
                        promptnode.style.display = 'none';
                        importExtension.firstChild.lastChild.onclick = function () {
                            if (promptnode.style.display != 'none') return;
                            var fileToLoad = this.previousSibling.files[0];
                            if (fileToLoad) {
                                promptnode.style.display = '';
                                promptnode.firstChild.innerHTML = '...';
                                var fileReader = new FileReader();
                                fileReader.onload = function (fileLoadedEvent) {
                                    var data = fileLoadedEvent.target.result;
                                    var loadData = function () {
                                        var zip = new JSZip();
                                        zip.load(data);
                                        var images = [], audios = [], fonts = [], directories = {}, directorylist = [];
                                        for (var i in zip.files) {
                                            var ext = i.slice(i.lastIndexOf('.') + 1);
                                            if (i.indexOf('audio/') == 0 &amp;&amp; (ext == 'mp3' || ext == 'ogg')) {
                                                audios.push(i);
                                            }
                                            else if (i.indexOf('font/') == 0 &amp;&amp; ext == 'ttf') {
                                                fonts.push(i);
                                            }
                                            else if (i.indexOf('image/') == 0 &amp;&amp; (ext == 'jpg' || ext == 'png')) {
                                                images.push(i);
                                            }
                                            else {
                                                continue;
                                            }
                                            var index = i.lastIndexOf('/');
                                            var str = i.slice(0, index);
                                            if (!directories[str]) {
                                                directories[str] = [];
                                                directorylist.push(str);
                                            }
                                            directories[str].push(i.slice(index + 1));
                                        }
                                        if (audios.length || fonts.length || images.length) {
                                            var str = '';
                                            if (audios.length) {
                                                str += audios.length + '';
                                            }
                                            if (fonts.length) {
                                                if (str.length) str += ''
                                                str += fonts.length + '';
                                            }
                                            if (images.length) {
                                                if (str.length) str += ''
                                                str += images.length + '';
                                            }
                                            var filelist = audios.concat(fonts).concat(images);
                                            if (filelist.length > 200) {
                                                str += '';
                                            }
                                            var assetLoaded = function () {
                                                promptnode.firstChild.innerHTML = '&lt;span class="hrefnode">&lt;/span>&lt;span class="closenode">&lt;/span>';
                                                promptnode.firstChild.querySelectorAll('span')[0].onclick = game.reload;
                                                promptnode.firstChild.querySelectorAll('span')[1].onclick = function () {
                                                    promptnode.style.display = 'none';
                                                }
                                            };
                                            if (confirm('' + str + '')) {
                                                promptnode.firstChild.innerHTML = '... &lt;span class="hrefnode">&lt;/span>';
                                                promptnode.firstChild.querySelector('span.hrefnode').onclick = ui.click.consoleMenu;
                                                if (lib.node &amp;&amp; lib.node.fs) {
                                                    var writeFile = function () {
                                                        if (filelist.length) {
                                                            var str = filelist.shift();
                                                            game.print(str.slice(str.lastIndexOf('/') + 1));
                                                            lib.node.fs.writeFile(__dirname + '/' + str, zip.files[str].asNodeBuffer(), null, writeFile);
                                                        }
                                                        else {
                                                            assetLoaded();
                                                        }
                                                    };
                                                    game.ensureDirectory(directorylist, writeFile);

                                                }
                                                else {
                                                    var getDirectory = function () {
                                                        if (directorylist.length) {
                                                            var dir = directorylist.shift();
                                                            var filelist = directories[dir];
                                                            window.resolveLocalFileSystemURL(lib.assetURL + dir, function (entry) {
                                                                var writeFile = function () {
                                                                    if (filelist.length) {
                                                                        var filename = filelist.shift();
                                                                        game.print(filename);
                                                                        entry.getFile(filename, { create: true }, function (fileEntry) {
                                                                            fileEntry.createWriter(function (fileWriter) {
                                                                                fileWriter.onwriteend = writeFile;
                                                                                fileWriter.onerror = function (e) {
                                                                                    game.print('Write failed: ' + e.toString());
                                                                                };
                                                                                fileWriter.write(zip.files[dir + '/' + filename].asArrayBuffer());
                                                                            });
                                                                        });
                                                                    }
                                                                    else {
                                                                        getDirectory();
                                                                    }
                                                                };
                                                                writeFile();
                                                            });
                                                        }
                                                        else {
                                                            assetLoaded();
                                                        }
                                                    };
                                                    game.ensureDirectory(directorylist, getDirectory);
                                                }
                                            }
                                            else {
                                                promptnode.style.display = 'none';
                                            }
                                        }
                                        else {
                                            alert('');
                                        }
                                    }
                                    if (!window.JSZip) {
                                        lib.init.js(lib.assetURL + 'game', 'jszip', loadData);
                                    }
                                    else {
                                        loadData();
                                    }
                                };
                                fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                            }
                        }

                        var dashboard = ui.create.div(pageboard);
                        var clickDash = function () {
                            ui.create.templayer();
                            pageboard.hide();
                            this.link.show();
                            if (this.link.init) {
                                this.link.init();
                            }
                        };
                        var createDash = function (str1, str2, node) {
                            var dash = ui.create.div('.menubutton.large.dashboard');
                            dashboard.appendChild(dash);
                            page.appendChild(node);
                            dash.link = node;
                            node.link = dash;
                            dash.listen(clickDash);
                            lib.setScroll(node);
                            ui.create.div('', str1, dash);
                            ui.create.div('', str2, dash);
                        };
                        var createDash2 = function (str1, str2, path, page) {
                            var dash = ui.create.div('.menubutton.large.dashboard.dashboard2');
                            page.appendChild(dash);
                            dash.listen(function () {
                                page.path = path;
                                enterDirectory(page, path);
                            });
                            ui.create.div('', str1, dash);
                            ui.create.div('', str2, dash);
                        };
                        var removeFile = function (selected, page) {
                            if (lib.node &amp;&amp; lib.node.fs) {
                                var unlink = function () {
                                    if (selected.length) {
                                        lib.node.fs.unlink(__dirname + '/' + selected.shift().path, unlink);
                                    }
                                    else {
                                        enterDirectory(page, page.currentpath);
                                    }
                                }
                                unlink();
                            }
                            else {
                                window.resolveLocalFileSystemURL(lib.assetURL + page.currentpath, function (entry) {
                                    var unlink = function () {
                                        if (selected.length) {
                                            entry.getFile(selected.shift().filename, { create: false }, function (fileEntry) {
                                                fileEntry.remove(unlink);
                                            });
                                        }
                                        else {
                                            enterDirectory(page, page.currentpath);
                                        }
                                    }
                                    unlink();
                                });
                            }
                        };
                        var clickDirectory = function () {
                            if (_status.dragged) return;
                            var page = this.parentNode.parentNode.parentNode;
                            if (page.deletebutton.classList.contains('active')) {
                                if (confirm('' + this.innerHTML + '')) {
                                    if (lib.node &amp;&amp; lib.node.fs) {
                                        try {
                                            var removeDirectory = function (path, callback) {
                                                lib.node.fs.readdir(__dirname + '/' + path, function (err, list) {
                                                    if (err) {
                                                        console.log(err);
                                                        return;
                                                    }
                                                    var removeFile = function () {
                                                        if (list.length) {
                                                            var filename = list.shift();
                                                            var url = __dirname + '/' + path + '/' + filename;
                                                            if (lib.node.fs.statSync(url).isDirectory()) {
                                                                removeDirectory(path + '/' + filename, removeFile);
                                                            }
                                                            else {
                                                                lib.node.fs.unlink(url, removeFile);
                                                            }
                                                        }
                                                        else {
                                                            lib.node.fs.rmdir(__dirname + '/' + path, callback);
                                                        }
                                                    }
                                                    removeFile();
                                                });
                                            };
                                            removeDirectory(this.path, function () {
                                                enterDirectory(page, page.currentpath);
                                            });
                                        }
                                        catch (e) {
                                            console.log(e);
                                        }
                                    }
                                    else {
                                        window.resolveLocalFileSystemURL(lib.assetURL + this.path, function (entry) {
                                            entry.removeRecursively(function () {
                                                enterDirectory(page, page.currentpath);
                                            });
                                        });
                                    }
                                }
                                return;
                            }
                            enterDirectory(page, this.path);
                        };
                        var clickFile = function () {
                            if (_status.dragged) return;
                            var page = this.parentNode.parentNode.parentNode;
                            if (page.deletebutton.classList.contains('active')) {
                                if (confirm('' + this.innerHTML + '')) {
                                    removeFile([this], page);
                                }
                                return;
                            }
                            this.classList.toggle('thundertext');
                            page.clicked = true;
                            if (this.ext == 'jpg' || this.ext == 'png') {
                                if (this.classList.contains('thundertext')) {
                                    if (!this.previewnode) {
                                        this.previewnode = document.createElement('img');
                                        this.previewnode.src = lib.assetURL + this.path;
                                        this.previewnode.width = '60';
                                        this.previewnode.style.maxHeight = '120px';
                                        this.parentNode.appendChild(this.previewnode);
                                    }
                                }
                                else {
                                    if (this.previewnode) {
                                        this.previewnode.remove();
                                        delete this.previewnode;
                                    }
                                }
                            }
                            else if (this.ext == 'mp3' || this.ext == 'ogg') {
                                if (this.classList.contains('thundertext')) {
                                    if (!this.previewnode) {
                                        this.previewnode = game.playAudio(this.path.slice(6));
                                    }
                                }
                                else {
                                    if (this.previewnode) {
                                        this.previewnode.remove();
                                        delete this.previewnode;
                                    }
                                }
                            }
                        };
                        var clickFileList = function () {
                            if (!this.parentNode) return;
                            if (this.parentNode.clicked) {
                                this.parentNode.clicked = false;
                            }
                            else {
                                var selected = Array.from(this.querySelectorAll('span.thundertext'));
                                for (var i = 0; i &lt; selected.length; i++) {
                                    selected[i].classList.remove('thundertext');
                                    if (selected[i].previewnode) {
                                        selected[i].previewnode.remove();
                                        delete selected[i].previewnode;
                                    }
                                }
                            }
                        };
                        var enterDirectory = function (page, path) {
                            page.innerHTML = '';
                            page.currentpath = path;
                            var backbutton = ui.create.div('.menubutton.round', '', page, function () {
                                page.clicked = false;
                                clickFileList.call(filelist);
                                if (page.path == path) {
                                    page.reset();
                                }
                                else {
                                    if (path.indexOf('/') == -1) {
                                        enterDirectory(page, '');
                                    }
                                    else {
                                        enterDirectory(page, path.slice(0, path.lastIndexOf('/')));
                                    }
                                }
                            });
                            backbutton.style.zIndex = 1;
                            backbutton.style.right = '10px';
                            backbutton.style.bottom = '15px';


                            var refresh = function () {
                                enterDirectory(page, path);
                            };
                            var addbutton = ui.create.div('.menubutton.round', '', page, function () {
                                var pos1 = this.getBoundingClientRect();
                                var pos2 = ui.window.getBoundingClientRect();
                                openMenu(this.menu, {
                                    clientX: pos1.left + pos1.width + 5 - pos2.left,
                                    clientY: pos1.top - pos2.top
                                });
                            });
                            addbutton.menu = ui.create.div('.menu');
                            ui.create.div('', '', addbutton.menu, function () {
                                popupContainer.noclose = true;
                            });
                            var createDir = function (str) {
                                if (lib.node &amp;&amp; lib.node.fs) {
                                    lib.node.fs.mkdir(__dirname + '/' + path + '/' + str, refresh);
                                }
                                else {
                                    window.resolveLocalFileSystemURL(lib.assetURL + path, function (entry) {
                                        entry.getDirectory(str, { create: true }, refresh);
                                    });
                                }
                            };
                            ui.create.div('', '', addbutton.menu, function () {
                                ui.create.templayer();
                                game.prompt('', function (str) {
                                    if (str) {
                                        createDir(str);
                                    }
                                });
                            });
                            var input = document.createElement('input');
                            input.className = 'fileinput';
                            input.type = 'file';
                            input.onchange = function () {
                                var fileToLoad = input.files[0];
                                game.print(fileToLoad.name);
                                if (fileToLoad) {
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (e) {
                                        game.writeFile(e.target.result, path, fileToLoad.name, refresh);
                                    };
                                    fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                                }
                            };
                            addbutton.menu.firstChild.appendChild(input);
                            addbutton.style.zIndex = 1;
                            addbutton.style.right = '10px';
                            addbutton.style.bottom = '80px';

                            var deletebutton = ui.create.div('.menubutton.round', '', page, function () {
                                if (!this.parentNode) return;
                                if (!this.classList.contains('active')) {
                                    var selected = Array.from(filelist.querySelectorAll('span.thundertext'));
                                    if (selected.length) {
                                        if (confirm('' + selected.length + '')) {
                                            removeFile(selected, page);
                                        }
                                    }
                                    else {
                                        this.classList.add('active');
                                    }
                                }
                                else {
                                    this.classList.remove('active');
                                }
                            });
                            deletebutton.style.zIndex = 1;
                            deletebutton.style.right = '10px';
                            deletebutton.style.bottom = '145px';

                            page.backbutton = backbutton;
                            page.addbutton = addbutton;
                            page.deletebutton = deletebutton;
                            var filelist = ui.create.div(page);
                            filelist.classList.add('file-container');
                            filelist.listen(clickFileList);
                            lib.setScroll(filelist);
                            game.getFileList(path, function (folders, files) {
                                var sort = function (a, b) {
                                    if (a > b) return 1;
                                    if (a &lt; b) return -1;
                                    return 0;
                                }
                                folders.sort(sort);
                                files.sort(sort);
                                var parent = path;
                                if (parent) {
                                    parent += '/';
                                }
                                for (var i = 0; i &lt; folders.length; i++) {
                                    if (!page.path &amp;&amp; folders[i] == 'app') continue;
                                    var entry = ui.create.div('', '&lt;span>' + folders[i], filelist);
                                    entry.firstChild.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickDirectory);
                                    entry.firstChild.path = parent + folders[i]
                                }
                                for (var i = 0; i &lt; files.length; i++) {
                                    if (!page.path) {
                                        if (files[i] == 'app.html') continue;
                                        if (files[i] == 'main.js') continue;
                                        if (files[i] == 'package.json') continue;
                                    }
                                    var entry = ui.create.div('', '&lt;span>' + files[i], filelist);
                                    entry.firstChild.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickFile);
                                    entry.firstChild.ext = files[i].slice(files[i].lastIndexOf('.') + 1);
                                    entry.firstChild.path = parent + files[i];
                                    entry.firstChild.filename = files[i];
                                }
                            });
                        };
                        var dash1 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            page.reset = function () {
                                page.innerHTML = '';
                                var backbutton = ui.create.div('.menubutton.round', '', page, function () {
                                    ui.create.templayer();
                                    page.hide();
                                    pageboard.show();
                                });
                                backbutton.style.zIndex = 1;
                                backbutton.style.right = '10px';
                                backbutton.style.bottom = '15px';
                                var placeholder = ui.create.div('.placeholder', page);
                                placeholder.style.position = 'relative';
                                placeholder.style.display = 'block';
                                placeholder.style.width = '100%';
                                placeholder.style.height = '14px';
                                createDash2('', '', 'image/character', page);
                                createDash2('', '', 'image/skin', page);
                                createDash2('', '', 'image/card', page);
                                createDash2('', '', 'image/mode', page);
                                createDash2('', '', 'image/splash', page);
                                createDash2('', '', 'image/background', page);
                            };
                            page.reset();
                            return page;
                        }());
                        var dash2 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            page.reset = function () {
                                page.innerHTML = '';
                                var backbutton = ui.create.div('.menubutton.round', '', page, function () {
                                    ui.create.templayer();
                                    page.hide();
                                    pageboard.show();
                                });
                                backbutton.style.zIndex = 1;
                                backbutton.style.right = '10px';
                                backbutton.style.bottom = '15px';
                                var placeholder = ui.create.div('.placeholder', page);
                                placeholder.style.position = 'relative';
                                placeholder.style.display = 'block';
                                placeholder.style.width = '100%';
                                placeholder.style.height = '14px';
                                createDash2('', '', 'audio/skill', page);
                                createDash2('', '', 'audio/card/male', page);
                                createDash2('', '', 'audio/card/female', page);
                                createDash2('', '', 'audio/die', page);
                                createDash2('', '', 'audio/effect', page);
                                createDash2('', '', 'audio/background', page);
                            };
                            page.reset();
                            return page;
                        }());
                        var dash3 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            page.path = 'font';
                            page.reset = function () {
                                ui.create.templayer();
                                page.hide();
                                pageboard.show();
                            };
                            page.init = function () {
                                enterDirectory(page, 'font');
                            };
                            return page;
                        }());
                        var dash4 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            page.path = '';
                            page.reset = function () {
                                ui.create.templayer();
                                page.hide();
                                pageboard.show();
                            };
                            page.init = function () {
                                enterDirectory(page, '');
                            };
                            return page;
                        }());
                        createDash('', '', dash1);
                        createDash('', '', dash2);
                        createDash('', '', dash3);
                        createDash('', '', dash4);
                    }());
                    createModeConfig('others', start.firstChild);

                    var active = start.firstChild.querySelector('.active');
                    if (!active) {
                        active = start.firstChild.firstChild;
                        active.classList.add('active');
                    }
                    rightPane.appendChild(active.link);
                }());

                (function () {
                    var start = menuxpages.shift();
                    var rightPane = start.lastChild;

                    var clickMode = function () {
                        var active = this.parentNode.querySelector('.active');
                        if (active) {
                            if (active === this) {
                                return;
                            }
                            active.classList.remove('active');
                            active.link.remove();
                        }
                        this.classList.add('active');
                        updateActive(this);
                        rightPane.appendChild(this.link);
                    };
                    updateActive = function (node) {
                        if (!node) {
                            node = start.firstChild.querySelector('.active');
                            if (!node) {
                                return;
                            }
                        }
                        for (var i = 0; i &lt; node.link.childElementCount; i++) {
                            if (node.link.childNodes[i].updateBanned) {
                                node.link.childNodes[i].updateBanned();
                            }
                        }
                    };
                    var updateNodes = function () {
                        for (var i = 0; i &lt; start.firstChild.childNodes.length; i++) {
                            var node = start.firstChild.childNodes[i];
                            if (node.link) {
                                if (node.mode.indexOf('mode_') == 0) continue;
                                if (node.mode == 'custom') continue;
                                if (connectMenu) {
                                    if (!lib.config.connect_characters.contains(node.mode)) {
                                        node.classList.remove('off');
                                        node.link.firstChild.classList.add('on');
                                    }
                                    else {
                                        node.classList.add('off');
                                        node.link.firstChild.classList.remove('on');
                                    }
                                }
                                else {
                                    if (lib.config.characters.contains(node.mode)) {
                                        node.classList.remove('off');
                                        node.link.firstChild.classList.add('on');
                                    }
                                    else {
                                        node.classList.add('off');
                                        node.link.firstChild.classList.remove('on');
                                    }
                                }
                            }
                        }
                    }
                    var togglePack = function (bool) {
                        var name = this._link.config._name;
                        if (connectMenu) {
                            if (!bool) {
                                lib.config.connect_characters.add(name);
                            }
                            else {
                                lib.config.connect_characters.remove(name);
                            }
                            game.saveConfig('connect_characters', lib.config.connect_characters);
                        }
                        else {
                            if (bool) {
                                lib.config.characters.add(name);
                            }
                            else {
                                lib.config.characters.remove(name);
                            }
                            game.saveConfig('characters', lib.config.characters);
                        }
                        updateNodes();
                    };

                    var createModeConfig = function (mode, position, position2) {
                        var info = lib.characterPack[mode];
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', lib.translate[mode + '_character_config'], position, clickMode);
                        if (node.innerHTML.length >= 5) {
                            node.classList.add('smallfont');
                        }
                        if (position2) {
                            position.insertBefore(node, position2);
                        }
                        node.link = page;
                        node.mode = mode;
                        page.node = node;
                        var list = [];
                        var boolAI = true;
                        var alterableSkills = [];
                        var alterableCharacters = [];
                        var charactersToAlter = [];
                        for (var i in info) {
                            if (info[i][4] &amp;&amp; info[i][4].contains('unseen')) continue;
                            if (connectMenu &amp;&amp; lib.connectBanned.contains(i)) continue;
                            if (connectMenu &amp;&amp; lib.configOL.protect_beginner &amp;&amp; get.is.banForBeginner(i)) return true;
                            list.push(i);
                            if (boolAI &amp;&amp; !lib.config.forbidai_user.contains(i)) boolAI = false;
                            for (var j = 0; j &lt; info[i][3].length; j++) {
                                if (!lib.skill[info[i][3][j]]) {
                                    continue;
                                }
                                if (lib.skill[info[i][3][j]].alter) {
                                    alterableSkills.add(info[i][3][j]);
                                    alterableCharacters.add(i);
                                    if (lib.config.vintageSkills.contains(info[i][3][j])) {
                                        charactersToAlter.add(i);
                                    }
                                }
                            }
                        }
                        alterableCharacters.sort();
                        var getGroup = function (name) {
                            var group = get.is.double(name, true);
                            if (group) return group[0];
                            return lib.character[name][1];
                        },
                            groupSort = function (name) {
                                if (!lib.character[name]) return 50;
                                var group = getGroup(name);
                                if (group == 'vtuber') return 40;
                                if (group == 'clubs') return 41;
                                var list = get.groups();
                                if (list.contains(group)) return list.indexOf(group);
                                return 49;
                            };
                        list.sort(function (a, b) {
                            var del = groupSort(a) - groupSort(b);
                            if (del != 0) return del;
                            var aa = a, bb = b;
                            if (a.indexOf('_') != -1) {
                                a = a.slice(a.lastIndexOf('_') + 1);
                            }
                            if (b.indexOf('_') != -1) {
                                b = b.slice(b.lastIndexOf('_') + 1);
                            }
                            if (a != b) {
                                return a > b ? 1 : -1;
                            }
                            return aa > bb ? 1 : -1;
                        });
                        var list2 = list.slice(0);
                        var cfgnode = createConfig({
                            name: '',
                            _name: mode,
                            init: lib.config.characters.contains(mode),
                            onclick: togglePack
                        });
                        var cfgnodeAI = createConfig({
                            name: '',
                            _name: mode,
                            init: boolAI,
                            intro: '',
                            onclick: function (bool) {
                                if (bool) {
                                    for (var i = 0; i &lt; list.length; i++) {
                                        lib.config.forbidai_user.add(list[i]);
                                    }
                                }
                                else {
                                    for (var i = 0; i &lt; list.length; i++) {
                                        lib.config.forbidai_user.remove(list[i]);
                                    }
                                }
                                game.saveConfig('forbidai_user', lib.config.forbidai_user);
                            },
                        });
                        if (mode.indexOf('mode_') != 0) {
                            cfgnodeAI.style.marginTop = '0px';
                            page.appendChild(cfgnode);
                            page.appendChild(cfgnodeAI);
                            if (alterableCharacters.length) {
                                var cfgnode2 = createConfig({
                                    name: '',
                                    _name: mode,
                                    init: charactersToAlter.length == 0,
                                    intro: '' + get.translation(alterableCharacters),
                                    onclick: function (bool) {
                                        if (bool) {
                                            for (var i = 0; i &lt; alterableSkills.length; i++) {
                                                lib.config.vintageSkills.remove(alterableSkills[i]);
                                                lib.translate[alterableSkills[i] + '_info'] = lib.translate[alterableSkills[i] + '_info_alter'];
                                            }
                                        }
                                        else {
                                            for (var i = 0; i &lt; alterableSkills.length; i++) {
                                                lib.config.vintageSkills.add(alterableSkills[i]);
                                                lib.translate[alterableSkills[i] + '_info'] = lib.translate[alterableSkills[i] + '_info_origin'];
                                            }
                                        }
                                        game.saveConfig('vintageSkills', lib.config.vintageSkills);
                                    }
                                });
                                cfgnode2.style.marginTop = '0px';
                                page.appendChild(cfgnode2);
                            }
                        }
                        else if (mode.indexOf('mode_extension') == 0) {
                            page.appendChild(cfgnodeAI);
                        }
                        else {
                            page.style.paddingTop = '8px';
                        }
                        var banCharacter = function (e) {
                            if (_status.clicked) {
                                _status.clicked = false;
                                return;
                            }
                            if (mode.indexOf('mode_') == 0 &amp;&amp; mode.indexOf('mode_extension_') != 0 &amp;&amp;
                                mode != 'mode_favourite' &amp;&amp; mode != 'mode_banned') {
                                if (!connectMenu &amp;&amp; lib.config.show_charactercard) {
                                    ui.click.charactercard(this.link, this, mode == 'mode_guozhan' ? 'guozhan' : true);
                                }
                                return;
                            }
                            ui.click.touchpop();
                            this._banning = connectMenu ? 'online' : 'offline';
                            if (!connectMenu &amp;&amp; lib.config.show_charactercard) {
                                ui.click.charactercard(this.link, this);
                            }
                            else {
                                ui.click.intro.call(this, e);
                            }
                            _status.clicked = false;
                            delete this._banning;
                        };
                        var updateBanned = function () {
                            var list;
                            if (connectMenu) {
                                var mode = menux.pages[0].firstChild.querySelector('.active');
                                if (mode &amp;&amp; mode.mode) {
                                    list = lib.config['connect_' + mode.mode + '_banned'];
                                }
                            }
                            else {
                                list = lib.config[get.mode() + '_banned'];
                            }
                            if (list &amp;&amp; list.contains(this.link)) {
                                this.classList.add('banned');
                            }
                            else {
                                this.classList.remove('banned');
                            }
                        };
                        if (lib.characterSort[mode]) {
                            var listb = [];
                            if (!connectMenu) {
                                listb = lib.config[get.mode() + '_banned'] || [];
                            }
                            else {
                                var modex = menux.pages[0].firstChild.querySelector('.active');
                                if (modex &amp;&amp; modex.mode) {
                                    listb = lib.config['connect_' + modex.mode + '_banned'];
                                }
                            }
                            for (var pak in lib.characterSort[mode]) {
                                var info = lib.characterSort[mode][pak];
                                var listx = [];
                                var boolx = false;
                                for (var ii = 0; ii &lt; list2.length; ii++) {
                                    if (info.contains(list2[ii])) {
                                        listx.add(list2[ii]);
                                        if (!listb.contains(list2[ii])) boolx = true;
                                        list2.splice(ii--, 1);
                                    }
                                }
                                if (listx.length) {
                                    var cfgnodeY = {
                                        name: lib.translate[pak],
                                        _name: pak,
                                        init: boolx,
                                        onclick: function (bool) {
                                            var banned = [];
                                            if (connectMenu) {
                                                var modex = menux.pages[0].firstChild.querySelector('.active');
                                                if (modex &amp;&amp; modex.mode) {
                                                    banned = lib.config['connect_' + modex.mode + '_banned'];
                                                }
                                            }
                                            else if (_status.connectMode) return;
                                            else banned = lib.config[get.mode() + '_banned'] || [];
                                            var listx = lib.characterSort[mode][this._link.config._name];
                                            if (bool) {
                                                for (var i = 0; i &lt; listx.length; i++) {
                                                    banned.remove(listx[i]);
                                                }
                                            }
                                            else {
                                                for (var i = 0; i &lt; listx.length; i++) {
                                                    banned.add(listx[i]);
                                                }
                                            }
                                            game.saveConfig(connectMenu ? ('connect_' + modex.mode + '_banned') : (get.mode() + '_banned'), banned);
                                            updateActive();
                                        },
                                    };
                                    if (mode.indexOf('mode_') == 0 &amp;&amp; mode.indexOf('mode_extension_') != 0 &amp;&amp; mode.indexOf('mode_guozhan') != 0) {
                                        cfgnodeY.clear = true;
                                        delete cfgnodeY.onclick;
                                    }
                                    var cfgnodeX = createConfig(cfgnodeY);
                                    page.appendChild(cfgnodeX);
                                    var buttons = ui.create.buttons(listx, 'character', page);
                                    for (var i = 0; i &lt; buttons.length; i++) {
                                        buttons[i].classList.add('noclick');
                                        buttons[i].listen(banCharacter);
                                        ui.create.rarity(buttons[i]);
                                        buttons[i].node.hp.style.transition = 'all 0s';
                                        buttons[i].node.hp._innerHTML = buttons[i].node.hp.innerHTML;
                                        if (mode != 'mode_banned') {
                                            buttons[i].updateBanned = updateBanned;
                                        }
                                    }
                                }
                            }
                            if (list2.length) {
                                var cfgnodeX = createConfig({
                                    name: '',
                                    _name: 'others',
                                    clear: true,
                                });
                                page.appendChild(cfgnodeX);
                                var buttons = ui.create.buttons(list2, 'character', page);
                                for (var i = 0; i &lt; buttons.length; i++) {
                                    buttons[i].classList.add('noclick');
                                    buttons[i].listen(banCharacter);
                                    ui.create.rarity(buttons[i]);
                                    buttons[i].node.hp.style.transition = 'all 0s';
                                    buttons[i].node.hp._innerHTML = buttons[i].node.hp.innerHTML;
                                    if (mode != 'mode_banned') {
                                        buttons[i].updateBanned = updateBanned;
                                    }
                                }
                            }
                        }
                        else {
                            var buttons = ui.create.buttons(list, 'character', page);
                            for (var i = 0; i &lt; buttons.length; i++) {
                                buttons[i].classList.add('noclick');
                                ui.create.rarity(buttons[i]);
                                buttons[i].listen(banCharacter);
                                buttons[i].node.hp.style.transition = 'all 0s';
                                buttons[i].node.hp._innerHTML = buttons[i].node.hp.innerHTML;
                                if (mode != 'mode_banned') {
                                    buttons[i].updateBanned = updateBanned;
                                }
                            }
                        }
                        page.classList.add('menu-buttons');
                        page.classList.add('leftbutton');
                        if (!connectMenu) {
                            if (mode.indexOf('mode_') != 0) {
                                ui.create.div('.config.pointerspan', '&lt;span>&lt;/span>', page, function () {
                                    if (this.firstChild.innerHTML == '') {
                                        this.firstChild.innerHTML = '';
                                        lib.config.hiddenCharacterPack.add(mode);
                                        if (!lib.config.prompt_hidepack) {
                                            alert('--');
                                            game.saveConfig('prompt_hidepack', true);
                                        }
                                    }
                                    else {
                                        this.firstChild.innerHTML = '';
                                        lib.config.hiddenCharacterPack.remove(mode);
                                    }
                                    game.saveConfig('hiddenCharacterPack', lib.config.hiddenCharacterPack);
                                });
                            }
                        }
                        return node;
                    };
                    if (lib.config.show_favourite_menu &amp;&amp; !connectMenu &amp;&amp; Array.isArray(lib.config.favouriteCharacter)) {
                        lib.characterPack.mode_favourite = {};
                        for (var i = 0; i &lt; lib.config.favouriteCharacter.length; i++) {
                            var favname = lib.config.favouriteCharacter[i];
                            if (lib.character[favname]) {
                                lib.characterPack.mode_favourite[favname] = lib.character[favname];
                            }
                        }
                        ui.favouriteCharacter = createModeConfig('mode_favourite', start.firstChild).link;
                        if (get.is.empty(lib.characterPack.mode_favourite)) {
                            ui.favouriteCharacter.node.style.display = 'none';
                        }
                        delete lib.characterPack.mode_favourite;
                    }
                    if (!connectMenu &amp;&amp; lib.config.show_ban_menu) {
                        lib.characterPack.mode_banned = {};
                        for (var i = 0; i &lt; lib.config.all.mode.length; i++) {
                            var banned = lib.config[lib.config.all.mode[i] + '_banned'];
                            if (banned) {
                                for (var j = 0; j &lt; banned.length; j++) {
                                    if (lib.character[banned[j]]) {
                                        lib.characterPack.mode_banned[banned[j]] = lib.character[banned[j]];
                                    }
                                }
                            }
                        }
                        var bannednode = createModeConfig('mode_banned', start.firstChild);
                        if (get.is.empty(lib.characterPack.mode_banned)) {
                            bannednode.style.display = 'none';
                        }
                        delete lib.characterPack.mode_banned;
                    }
                    var characterlist = connectMenu ? lib.connectCharacterPack : lib.config.all.characters;
                    for (var i = 0; i &lt; characterlist.length; i++) {
                        //if(['sololive'].contains(characterlist[i])) continue;
                        createModeConfig(characterlist[i], start.firstChild);
                    }
                    if (!connectMenu) {
                        for (var i in lib.characterPack) {
                            if (i.indexOf('mode_') == 0) {
                                createModeConfig(i, start.firstChild);
                            }
                        }
                    }
                    var active = start.firstChild.querySelector('.active');
                    if (!active) {
                        active = start.firstChild.firstChild;
                        if (active.style.display == 'none') {
                            active = active.nextSibling;
                            if (active.style.display == 'none') {
                                active = active.nextSibling;
                            }
                        }
                        active.classList.add('active');
                        updateActive(active);
                    }
                    rightPane.appendChild(active.link);

                    if (!connectMenu) {
                        var node1 = ui.create.div('.lefttext', '', start.firstChild, function () {
                            game.saveConfig('characters', lib.config.all.characters);
                            updateNodes();
                        });
                        var node2 = ui.create.div('.lefttext', '', start.firstChild, function () {
                            game.saveConfig('characters', lib.config.defaultcharacters);
                            updateNodes();
                        });
                        node1.style.marginTop = '12px';
                        node2.style.marginTop = '7px';
                    }

                    updateNodes();
                }());

                (function () {
                    var start = menuxpages.shift();
                    var rightPane = start.lastChild;
                    var pileCreated = false;
                    var recreatePile = function () {
                        lib.config.customcardpile[''] = [lib.config.bannedpile, lib.config.addedpile];
                        game.saveConfig('customcardpile', lib.config.customcardpile);
                        game.saveConfig('cardpilename', '', true);
                        pileCreated = false;
                    };

                    var clickMode = function () {
                        var active = this.parentNode.querySelector('.active');
                        if (active === this) {
                            return;
                        }
                        active.classList.remove('active');
                        active.link.remove();
                        active = this;
                        this.classList.add('active');
                        updateActiveCard(this);
                        if (this.mode == 'cardpile') {
                            this.create();
                        }
                        rightPane.appendChild(this.link);
                    };
                    updateActiveCard = function (node) {
                        if (!node) {
                            node = start.firstChild.querySelector('.active');
                            if (!node) {
                                return;
                            }
                        }
                        for (var i = 0; i &lt; node.link.childElementCount; i++) {
                            if (node.link.childNodes[i].updateBanned) {
                                node.link.childNodes[i].updateBanned();
                            }
                        }
                    };
                    var updateNodes = function () {
                        for (var i = 0; i &lt; start.firstChild.childNodes.length; i++) {
                            var node = start.firstChild.childNodes[i];
                            if (node.link) {
                                if (node.mode.indexOf('mode_') == 0) continue;
                                if (node.mode == 'custom') continue;
                                if (node.mode == 'cardpile') continue;
                                if (connectMenu) {
                                    if (!lib.config.connect_cards.contains(node.mode)) {
                                        node.classList.remove('off');
                                        node.link.firstChild.classList.add('on');
                                    }
                                    else {
                                        node.classList.add('off');
                                        node.link.firstChild.classList.remove('on');
                                    }
                                }
                                else {
                                    if (lib.config.cards.contains(node.mode)) {
                                        node.classList.remove('off');
                                        node.link.firstChild.classList.add('on');
                                    }
                                    else {
                                        node.classList.add('off');
                                        node.link.firstChild.classList.remove('on');
                                    }
                                }
                            }
                        }
                    }
                    var togglePack = function (bool) {
                        var name = this._link.config._name;
                        if (connectMenu) {
                            if (!bool) {
                                lib.config.connect_cards.add(name);
                            }
                            else {
                                lib.config.connect_cards.remove(name);
                            }
                            game.saveConfig('connect_cards', lib.config.connect_cards);
                        }
                        else {
                            if (bool) {
                                lib.config.cards.add(name);
                            }
                            else {
                                lib.config.cards.remove(name);
                            }
                            game.saveConfig('cards', lib.config.cards);
                        }
                        updateNodes();
                    };
                    var toggleCardPile = function (bool) {
                        var name = this._link.config._name;
                        var number = this._link.config._number;
                        if (!lib.config.bannedpile[name]) {
                            lib.config.bannedpile[name] = [];
                        }
                        if (bool) {
                            lib.config.bannedpile[name].remove(number);
                        }
                        else {
                            lib.config.bannedpile[name].add(number);
                        }
                        recreatePile();
                    }

                    var createModeConfig = function (mode, position) {
                        var info = lib.cardPack[mode];
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', lib.translate[mode + '_card_config'], position, clickMode);
                        if (node.innerHTML.length >= 5) {
                            node.classList.add('smallfont');
                        }
                        node.link = page;
                        node.mode = mode;
                        var list = [];
                        for (var i = 0; i &lt; info.length; i++) {
                            if (!lib.card[info[i]] || (lib.card[info[i]].derivation &amp;&amp; mode != 'mode_derivation')) continue;
                            list.push(['', get.translation(get.type(info[i], 'trick')), info[i]]);
                        }
                        var sortCard = function (card) {
                            var type = lib.card[card[2]].type;
                            var subtype = lib.card[card[2]].subtype;
                            if (lib.cardType[subtype]) {
                                return lib.cardType[subtype];
                            }
                            if (lib.cardType[type]) {
                                return lib.cardType[type];
                            }
                            switch (type) {
                                case 'basic': return 0;
                                case 'chess': return 1.5;
                                case 'trick': return 2;
                                case 'delay': return 3;
                                case 'equip': {
                                    switch (lib.card[card[2]].subtype) {
                                        case 'equip1': return 4.1;
                                        case 'equip2': return 4.2;
                                        case 'equip3': return 4.3;
                                        case 'equip4': return 4.4;
                                        case 'equip5': return 4.5;
                                        default: return 4;
                                    }
                                }
                                case 'zhenfa': return 5;
                                default: return 6;
                            }
                        }
                        list.sort(function (a, b) {
                            var sort1 = sortCard(a);
                            var sort2 = sortCard(b);
                            if (sort1 == sort2) {
                                return (b[2] &lt; a[2]) ? 1 : -1;
                            }
                            else if (sort1 > sort2) {
                                return 1;
                            }
                            else {
                                return -1;
                            }
                        });
                        var cfgnode = createConfig({
                            name: '',
                            _name: mode,
                            init: lib.config.cards.contains(mode),
                            onclick: togglePack
                        });
                        if (mode.indexOf('mode_') != 0) {
                            page.appendChild(cfgnode);
                        }
                        else {
                            page.style.paddingTop = '8px';
                        }
                        var banCard = function (e) {
                            if (_status.clicked) {
                                _status.clicked = false;
                                return;
                            }
                            if (mode.indexOf('mode_') == 0 &amp;&amp; mode.indexOf('mode_extension_') != 0 &amp;&amp; mode != 'mode_banned') {
                                return;
                            }
                            ui.click.touchpop();
                            this._banning = connectMenu ? 'online' : 'offline';
                            ui.click.intro.call(this, e);
                            _status.clicked = false;
                            delete this._banning;
                        };
                        var updateBanned = function () {
                            var list;
                            if (connectMenu) {
                                var mode = menux.pages[0].firstChild.querySelector('.active');
                                if (mode &amp;&amp; mode.mode) {
                                    list = lib.config['connect_' + mode.mode + '_bannedcards'];
                                }
                            }
                            else {
                                list = lib.config[get.mode() + '_bannedcards'];
                            }
                            if (list &amp;&amp; list.contains(this.link[2])) {
                                this.classList.add('banned');
                            }
                            else {
                                this.classList.remove('banned');
                            }
                        };
                        var buttons = ui.create.buttons(list, 'vcard', page);
                        for (var i = 0; i &lt; buttons.length; i++) {
                            buttons[i].classList.add('noclick');
                            buttons[i].listen(banCard);
                            if (mode != 'mode_banned') {
                                buttons[i].updateBanned = updateBanned;
                            }
                        }
                        page.classList.add('menu-buttons');
                        page.classList.add('leftbutton');
                        if (!connectMenu &amp;&amp; mode.indexOf('mode_') != 0) {
                            ui.create.div('.config.pointerspan', '&lt;span>&lt;/span>', page, function () {
                                if (this.firstChild.innerHTML == '') {
                                    this.firstChild.innerHTML = '';
                                    lib.config.hiddenCardPack.add(mode);
                                    if (!lib.config.prompt_hidepack) {
                                        alert('--');
                                        game.saveConfig('prompt_hidepack', true);
                                    }
                                }
                                else {
                                    this.firstChild.innerHTML = '';
                                    lib.config.hiddenCardPack.remove(mode);
                                }
                                game.saveConfig('hiddenCardPack', lib.config.hiddenCardPack);
                            });
                        }
                        if (mode.indexOf('mode_') != 0 &amp;&amp; lib.cardPile[mode]) {
                            var cardpileNodes = [];
                            var cardpileexpanded = false;
                            if (!lib.config.bannedpile[mode]) {
                                lib.config.bannedpile[mode] = [];
                            }
                            if (!lib.config.addedpile[mode]) {
                                lib.config.addedpile[mode] = [];
                            }
                            ui.create.div('.config.more.pile', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                if (cardpileexpanded) {
                                    this.classList.remove('on');
                                    for (var k = 0; k &lt; cardpileNodes.length; k++) {
                                        cardpileNodes[k].style.display = 'none';
                                    }
                                }
                                else {
                                    this.classList.add('on');
                                    for (var k = 0; k &lt; cardpileNodes.length; k++) {
                                        cardpileNodes[k].style.display = '';
                                    }
                                }
                                cardpileexpanded = !cardpileexpanded;
                            });
                            var cfgnode = ui.create.div(page, '.config.pointerspan.cardpilecfg.toggle');
                            var cfgaddcard = ui.create.node('button', '', '', cfgnode, function () {
                                this.parentNode.nextSibling.classList.toggle('hidden');
                            });
                            var cfgbancard = ui.create.node('button', '', '', cfgnode, function () {
                                for (var i = 0; i &lt; cardpileNodes.length; i++) {
                                    if (cardpileNodes[i].type == 'defaultcards' &amp;&amp; cardpileNodes[i].classList.contains('on')) {
                                        clickToggle.call(cardpileNodes[i]);
                                    }
                                }
                            });
                            var cfgenablecard = ui.create.node('button', '', '', cfgnode, function () {
                                for (var i = 0; i &lt; cardpileNodes.length; i++) {
                                    if (cardpileNodes[i].type == 'defaultcards' &amp;&amp; !cardpileNodes[i].classList.contains('on')) {
                                        clickToggle.call(cardpileNodes[i]);
                                    }
                                }
                            });
                            cfgbancard.style.marginLeft = '5px';
                            cfgenablecard.style.marginLeft = '5px';
                            cardpileNodes.push(cfgnode);
                            cfgnode.style.display = 'none';
                            cfgnode.classList.add('cardpilecfg');
                            cfgnode.classList.add('toggle');
                            cfgnode.style.marginTop = '5px';
                            page.appendChild(cfgnode);

                            var cardpileadd = ui.create.div('.config.toggle.hidden.cardpilecfg.cardpilecfgadd', page);
                            var pileaddlist = [];
                            for (var i = 0; i &lt; lib.config.cards.length; i++) {
                                if (!lib.cardPack[lib.config.cards[i]]) continue;
                                for (var j = 0; j &lt; lib.cardPack[lib.config.cards[i]].length; j++) {
                                    var cname = lib.cardPack[lib.config.cards[i]][j];
                                    pileaddlist.push([cname, get.translation(cname)]);
                                    if (cname == 'sha') {
                                        pileaddlist.push(['huosha', '']);
                                        pileaddlist.push(['leisha', '']);
                                        pileaddlist.push(['haisha', '']);
                                    }
                                    if (cname == 'tao') {
                                        pileaddlist.push(['haitao', '']);
                                    }
                                }
                            }
                            var cardpileaddname = ui.create.selectlist(pileaddlist, null, cardpileadd);
                            cardpileaddname.style.width = '75px';
                            cardpileaddname.style.marginRight = '2px';
                            cardpileaddname.style.marginLeft = '-1px';
                            var cardpileaddsuit = ui.create.selectlist([
                                ['heart', ''],
                                ['diamond', ''],
                                ['club', ''],
                                ['spade', ''],
                            ], null, cardpileadd);
                            cardpileaddsuit.style.width = '53px';
                            cardpileaddsuit.style.marginRight = '2px';
                            var cardpileaddnumber = ui.create.selectlist([
                                1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
                            ], null, cardpileadd);
                            cardpileaddnumber.style.width = '43px';
                            cardpileaddnumber.style.marginRight = '2px';
                            var button = document.createElement('button');
                            button.innerHTML = '';
                            button.style.width = '40px';
                            var deletecard = function () {
                                this.parentNode.remove();
                                var info = this.parentNode._info;
                                var list = lib.config.addedpile[mode];
                                for (var i = 0; i &lt; list.length; i++) {
                                    if (list[i][0] == info[0] &amp;&amp; list[i][1] == info[1] &amp;&amp; list[i][2] == info[2]) {
                                        list.splice(i, 1); break;
                                    }
                                }
                                recreatePile();
                            };
                            button.onclick = function () {
                                var card = [
                                    cardpileaddsuit.value,
                                    cardpileaddnumber.value,
                                    cardpileaddname.value,
                                ];
                                lib.config.addedpile[mode].push(card);
                                recreatePile();
                                var cfgnode = ui.create.div('.config.toggle.cardpilecfg');
                                cfgnode._info = card;
                                cfgnode.innerHTML = get.translation(card[2]) + ' ' + get.translation(card[0]) + card[1];
                                var cfgnodedelete = document.createElement('span');
                                cfgnodedelete.classList.add('cardpiledelete');
                                cfgnodedelete.innerHTML = '';
                                cfgnodedelete.onclick = deletecard;
                                cfgnode.appendChild(cfgnodedelete);
                                page.insertBefore(cfgnode, cardpileadd.nextSibling);
                            };
                            cardpileadd.appendChild(button);
                            cardpileadd.style.whiteSpace = 'nowrap';
                            cardpileNodes.push(cardpileadd);

                            for (var i = 0; i &lt; lib.config.addedpile[mode].length; i++) {
                                var card = lib.config.addedpile[mode][i];
                                var cfgnode = ui.create.div('.config.toggle.cardpilecfg');
                                cfgnode._info = card;
                                cfgnode.innerHTML = get.translation(card[2]) + ' ' + get.translation(card[0]) + card[1];
                                var cfgnodedelete = document.createElement('span');
                                cfgnodedelete.classList.add('cardpiledelete');
                                cfgnodedelete.innerHTML = '';
                                cfgnodedelete.onclick = deletecard;
                                cfgnode.appendChild(cfgnodedelete);
                                cfgnode.style.display = 'none';
                                cardpileNodes.push(cfgnode);
                                page.appendChild(cfgnode);
                            }

                            for (var i = 0; i &lt; lib.cardPile[mode].length; i++) {
                                var card = lib.cardPile[mode][i];
                                var cfgnode = createConfig({
                                    name: get.translation(card[2]) + ' ' + get.translation(card[0]) + card[1],
                                    _number: i,
                                    _name: mode,
                                    init: !lib.config.bannedpile[mode].contains(i),
                                    onclick: toggleCardPile
                                });
                                cfgnode.type = 'defaultcards';
                                cardpileNodes.push(cfgnode);
                                cfgnode.style.display = 'none';
                                cfgnode.classList.add('cardpilecfg');
                                page.appendChild(cfgnode);
                            }
                            ui.create.div('.menuplaceholder', page);
                        }
                        return node;
                    };
                    if (!connectMenu &amp;&amp; lib.config.show_ban_menu) {
                        lib.cardPack.mode_banned = [];
                        for (var i = 0; i &lt; lib.config.all.mode.length; i++) {
                            var banned = lib.config[lib.config.all.mode[i] + '_bannedcards'];
                            if (banned) {
                                for (var j = 0; j &lt; banned.length; j++) {
                                    lib.cardPack.mode_banned.add(banned[j]);
                                }
                            }
                        }
                        var bannednode = createModeConfig('mode_banned', start.firstChild);
                        if (lib.cardPack.mode_banned.length == 0) {
                            bannednode.style.display = 'none';
                        }
                        delete lib.cardPack.mode_banned;
                    }
                    for (var i = 0; i &lt; lib.config.all.cards.length; i++) {
                        if (connectMenu &amp;&amp; !lib.connectCardPack.contains(lib.config.all.cards[i])) continue;
                        createModeConfig(lib.config.all.cards[i], start.firstChild);
                    }
                    if (!connectMenu) {
                        for (var i in lib.cardPack) {
                            if (i.indexOf('mode_') == 0) {
                                createModeConfig(i, start.firstChild);
                            }
                        }
                    }
                    var active = start.firstChild.querySelector('.active');
                    if (!active) {
                        active = start.firstChild.firstChild;
                        if (active.style.display == 'none') {
                            active = active.nextSibling;
                        }
                        active.classList.add('active');
                        updateActiveCard(active);
                    }
                    rightPane.appendChild(active.link);

                    (function () {
                        if (connectMenu) return;
                        var page = ui.create.div('.menu-buttons');
                        var node = ui.create.div('.menubutton.large', '', clickMode);
                        start.firstChild.insertBefore(node, start.firstChild.querySelector('.lefttext'));
                        node.link = page;
                        node.mode = 'cardpile';
                        node.create = function () {
                            if (pileCreated) return;
                            pileCreated = true;
                            page.innerHTML = '';

                            var pileList = null;
                            var createList = function () {
                                if (pileList) {
                                    pileList.remove();
                                }
                                var list = [''];
                                if (lib.config.customcardpile['']) {
                                    list.push('');
                                }
                                for (var i in lib.config.customcardpile) {
                                    list.add(i);
                                }
                                var currentpile = get.config('cardpilename');
                                if (!currentpile) {
                                    if (list.contains('')) {
                                        currentpile = '';
                                    }
                                    else {
                                        currentpile = '';
                                    }
                                }
                                pileList = ui.create.selectlist(list, currentpile, pileChoose, function (e) {
                                    game.saveConfig('cardpilename', this.value, true);
                                    restart.style.display = '';
                                });
                                pileList.style.float = 'right';
                            }
                            var pileChoose = ui.create.div('.config.toggle.cardpilecfg.nomarginleft', '', page);
                            createList();

                            var pileDel = function () {
                                delete lib.config.customcardpile[this.parentNode.link];
                                this.parentNode.remove();
                                game.saveConfig('customcardpile', lib.config.customcardpile);
                                for (var i in lib.config.mode_config) {
                                    if (i == 'global') continue;
                                    if (lib.config.mode_config[i].cardpilename == this.parentNode.link) {
                                        game.saveConfig('cardpilename', null, i);
                                    }
                                }
                                createList();
                            };

                            var restart = ui.create.div('.config.more', '', game.reload, page);
                            restart.style.display = 'none';
                            var createPileNode = function (name) {
                                var node = ui.create.div('.config.toggle.cardpilecfg.nomarginleft', name);
                                node.link = name;
                                var del = document.createElement('span');
                                del.innerHTML = '';
                                del.classList.add('cardpiledelete');
                                del.onclick = pileDel;
                                node.appendChild(del);
                                if (name == '') {
                                    page.insertBefore(node, pileChoose.nextSibling);
                                }
                                else {
                                    page.insertBefore(node, restart);
                                }
                            };
                            for (var i in lib.config.customcardpile) {
                                createPileNode(i);
                            }
                            var exportCardPile;
                            ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                this.classList.toggle('on');
                                if (this.classList.contains('on')) {
                                    exportCardPile.classList.remove('hidden');
                                }
                                else {
                                    exportCardPile.classList.add('hidden');
                                }
                            });
                            exportCardPile = ui.create.div('.config.cardpileadd.indent', page);
                            exportCardPile.classList.add('hidden');
                            ui.create.div('', '&lt;input type="text">&lt;button>&lt;/button>', exportCardPile);
                            var input = exportCardPile.firstChild.lastChild.previousSibling;
                            input.value = '';
                            input.style.marginRight = '3px';
                            input.style.width = '120px';
                            exportCardPile.firstChild.lastChild.onclick = function () {
                                var name = input.value;
                                var ok = true;
                                if (lib.config.customcardpile[name] || name == '' || name == '') {
                                    for (var i = 1; i &lt;= 1000; i++) {
                                        if (!lib.config.customcardpile[name + '(' + i + ')']) {
                                            name = name + '(' + i + ')';
                                            break;
                                        }
                                    }
                                }
                                lib.config.customcardpile[name] = [lib.config.bannedpile, lib.config.addedpile];
                                delete lib.config.customcardpile[''];
                                for (var i in lib.mode) {
                                    if (lib.config.mode_config[i] &amp;&amp;
                                        (lib.config.mode_config[i].cardpilename == '' || !lib.config.mode_config[i].cardpilename)) {
                                        game.saveConfig('cardpilename', name, i);
                                    }
                                }
                                for (var i = 0; i &lt; page.childElementCount; i++) {
                                    if (page.childNodes[i].link == '') {
                                        page.childNodes[i].remove();
                                        break;
                                    }
                                }
                                game.saveConfig('customcardpile', lib.config.customcardpile);
                                createPileNode(name);
                                createList();
                            };
                        }
                    }());

                    if (!connectMenu) {
                        var node1 = ui.create.div('.lefttext', '', start.firstChild, function () {
                            game.saveConfig('cards', lib.config.all.cards);
                            updateNodes();
                        });
                        var node2 = ui.create.div('.lefttext', '', start.firstChild, function () {
                            game.saveConfig('cards', lib.config.defaultcards);
                            updateNodes();
                        });
                        node1.style.marginTop = '12px';
                        node2.style.marginTop = '7px';
                    }

                    updateNodes();
                }());

                (function () {
                    if (connectMenu) return;
                    var start = menuxpages.shift();
                    var rightPane = start.lastChild;

                    var clickMode = function () {
                        if (this.mode == 'get') {
                            this.update();
                        }
                        var active = this.parentNode.querySelector('.active');
                        if (active === this) {
                            return;
                        }
                        active.classList.remove('active');
                        active.link.remove();
                        active = this;
                        this.classList.add('active');
                        rightPane.appendChild(this.link);
                    };
                    ui.click.extensionTab = function (name) {
                        ui.click.menuTab('');
                        for (var i = 0; i &lt; start.firstChild.childElementCount; i++) {
                            if (start.firstChild.childNodes[i].innerHTML == name) {
                                clickMode.call(start.firstChild.childNodes[i]);
                                break;
                            }
                        }
                    }
                    var updateNodes = function () {
                        for (var i = 0; i &lt; start.firstChild.childNodes.length; i++) {
                            var node = start.firstChild.childNodes[i];
                            if (node.link) {
                                if (node.mode == 'get') continue;
                                if (node.mode == 'create') continue;
                                if (node.mode.indexOf('extension_') == 0) {
                                    if (lib.config[node.mode + '_enable']) {
                                        node.classList.remove('off');
                                        node.link.firstChild.classList.add('on');
                                    }
                                    else {
                                        node.classList.add('off');
                                        node.link.firstChild.classList.remove('on');
                                    }
                                }
                                else {
                                    if (lib.config.plays.contains(node.mode)) {
                                        node.classList.remove('off');
                                        node.link.firstChild.classList.add('on');
                                    }
                                    else {
                                        node.classList.add('off');
                                        node.link.firstChild.classList.remove('on');
                                    }
                                }
                            }
                        }
                    }
                    var togglePack = function (bool) {
                        var name = this._link.config._name;
                        if (name.indexOf('extension_') == 0) {
                            if (bool) {
                                game.saveConfig(name, true);
                            }
                            else {
                                game.saveConfig(name, false);
                            }
                        }
                        else {
                            name = name.slice(0, name.indexOf('_enable_playpackconfig'));
                            if (bool) {
                                lib.config.plays.add(name);
                            }
                            else {
                                lib.config.plays.remove(name);
                            }
                            game.saveConfig('plays', lib.config.plays);
                        }
                        if (this.onswitch) {
                            this.onswitch(bool);
                        }
                        updateNodes();
                    };

                    var createModeConfig = function (mode, position) {
                        var page = ui.create.div('');
                        page.style.paddingBottom = '10px';
                        var node;
                        if (mode.indexOf('extension_') == 0) {
                            node = ui.create.div('.menubutton.large', mode.slice(10), position, clickMode);
                        }
                        else {
                            node = ui.create.div('.menubutton.large', lib.translate[mode + '_play_config'], position, clickMode);
                        }
                        if (node.innerHTML.length >= 5) {
                            node.classList.add('smallfont');
                        }
                        node.link = page;
                        node.mode = mode;
                        for (var i in lib.extensionMenu[mode]) {
                            if (i == 'game') continue;
                            var cfg = copyObj(lib.extensionMenu[mode][i]);
                            var j;
                            if (mode.indexOf('extension_') == 0) {
                                j = mode + '_' + i;
                            }
                            else {
                                j = mode + '_' + i + '_playpackconfig';
                            }
                            cfg._name = j;
                            if (!lib.config.hasOwnProperty(j)) {
                                game.saveConfig(j, cfg.init);
                            }
                            else {
                                cfg.init = lib.config[j];
                            }

                            if (i == 'enable') {
                                cfg.onclick = togglePack;
                            }
                            else if (!lib.extensionMenu[mode][i].onclick) {
                                cfg.onclick = function (result) {
                                    var cfg = this._link.config;
                                    game.saveConfig(cfg._name, result);
                                };
                            }
                            var cfgnode = createConfig(cfg);
                            if (cfg.onswitch) {
                                cfgnode.onswitch = cfg.onswitch;
                            }
                            page.appendChild(cfgnode);
                        }
                        return node;
                    };
                    for (var i in lib.extensionMenu) {
                        if (lib.config.all.stockextension.contains(i) &amp;&amp; !lib.config.all.plays.contains(i)) continue;
                        if (lib.config.hiddenPlayPack.contains(i)) continue;
                        createModeConfig(i, start.firstChild);
                    }
                    (function () {
                        if (!lib.device &amp;&amp; !lib.db) return;
                        if (lib.config.show_extensionmaker == false) return;
                        var page = ui.create.div('#create-extension');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.link = page;
                        node.mode = 'create';
                        var pageboard = ui.create.div(page);
                        var inputExtLine = ui.create.div(pageboard);
                        inputExtLine.style.transition = 'all 0s';
                        inputExtLine.style.padding = '10px';
                        inputExtLine.style.height = '22px';
                        inputExtLine.style.lineHeight = '22px';
                        inputExtLine.style.whiteSpace = 'nowrap';
                        inputExtLine.style.overflow = 'visible';
                        var inputExtSpan = document.createElement('span');
                        inputExtSpan.innerHTML = '';
                        inputExtLine.appendChild(inputExtSpan);
                        var inputExtName = document.createElement('input');
                        inputExtName.type = 'text';
                        inputExtName.value = '';
                        inputExtName.style.width = '80px';
                        inputExtName.style.textAlign = 'center';
                        inputExtLine.appendChild(inputExtName);

                        var buttonConfirmOnclick = function () {
                            buttonConfirm.style.display = 'none';
                            inputExtSpan.style.display = 'none';
                            inputExtName.style.display = 'none';
                            authorExtLine.style.display = 'none';
                            introExtLine.style.display = 'none';
                            forumExtLine.style.display = 'none';
                            diskExtLine.style.display = 'none';
                            versionExtLine.style.display = 'none';
                            okExtLine.style.display = 'none';
                            inputExtLine.style.padding = '10px';
                            buttonRename.style.display = '';
                            buttonSave.style.display = '';
                            buttonReset.style.display = '';
                            buttonExport.style.display = '';
                            inputExtSpan.innerHTML = '';
                            inputExtName.style.width = '100px';
                            inputExtName.style.textAlign = '';

                            dashboard.style.display = '';
                        };
                        var createExtLine = function (str, str2) {
                            var infoExtLine = ui.create.div(pageboard);
                            infoExtLine.style.display = 'none';
                            infoExtLine.style.padding = '0 10px 10px 10px';
                            infoExtLine.style.height = '22px';
                            infoExtLine.style.lineHeight = '22px';
                            infoExtLine.style.whiteSpace = 'nowrap';
                            infoExtLine.style.overflow = 'visible';
                            if (typeof str == 'boolean') {
                                var inputConfirm = document.createElement('button');
                                inputConfirm.innerHTML = '';
                                inputConfirm.onclick = buttonConfirmOnclick;
                                infoExtLine.appendChild(inputConfirm);
                                return infoExtLine;
                            }
                            var infoExtSpan = document.createElement('span');
                            infoExtSpan.innerHTML = str + '';
                            infoExtLine.appendChild(infoExtSpan);
                            var infoExtName = document.createElement('input');
                            infoExtName.type = 'text';
                            infoExtName.style.width = '100px';
                            infoExtName.value = str2 || '';
                            infoExtLine.appendChild(infoExtName);
                            return infoExtLine;
                        };
                        var authorExtLine = createExtLine('', get.connectNickname());
                        var introExtLine = createExtLine('');
                        var versionExtLine = createExtLine('', '1.0');
                        var diskExtLine = createExtLine('');
                        var forumExtLine = createExtLine('');
                        var okExtLine = createExtLine(true);

                        game.editExtension = function (name) {
                            page.currentExtension = name || '';
                            inputExtName.value = page.currentExtension;
                            if (name &amp;&amp; lib.extensionPack[name]) {
                                authorExtLine.querySelector('input').value = lib.extensionPack[name].author || '';
                                introExtLine.querySelector('input').value = lib.extensionPack[name].intro || '';
                                diskExtLine.querySelector('input').value = lib.extensionPack[name].diskURL || '';
                                forumExtLine.querySelector('input').value = lib.extensionPack[name].forumURL || '';
                                versionExtLine.querySelector('input').value = lib.extensionPack[name].version || '';
                            }
                            else {
                                authorExtLine.querySelector('input').value = get.connectNickname() || '';
                                introExtLine.querySelector('input').value = '';
                                diskExtLine.querySelector('input').value = '';
                                forumExtLine.querySelector('input').value = '';
                                versionExtLine.querySelector('input').value = '1.0';
                            }
                            if (name) {
                                inputExtName.disabled = true;
                                buttonConfirm.style.display = 'none';
                                inputExtSpan.style.display = 'none';
                                inputExtName.style.display = 'none';
                                buttonRename.style.display = '';
                                buttonSave.style.display = '';
                                buttonReset.style.display = '';
                                buttonExport.style.display = '';
                            }
                            else {
                                inputExtName.disabled = false;
                                buttonConfirm.style.display = '';
                                inputExtSpan.innerHTML = '';
                                inputExtName.style.width = '80px';
                                inputExtName.style.textAlign = 'center';
                                inputExtSpan.style.display = '';
                                inputExtName.style.display = '';
                                buttonRename.style.display = 'none';
                                buttonSave.style.display = 'none';
                                buttonReset.style.display = 'none';
                                buttonExport.style.display = 'none';
                            }

                            dashboard.style.display = '';

                            exportExtLine.style.display = 'none';
                            shareExtLine.style.display = 'none';
                            authorExtLine.style.display = 'none';
                            introExtLine.style.display = 'none';
                            forumExtLine.style.display = 'none';
                            diskExtLine.style.display = 'none';
                            versionExtLine.style.display = 'none';
                            okExtLine.style.display = 'none';
                            inputExtLine.style.padding = '10px';
                            dash1.reset(name);
                            dash2.reset(name);
                            dash3.reset(name);
                            dash4.reset(name);
                            dash1.link.classList.remove('active');
                            dash2.link.classList.remove('active');
                            dash3.link.classList.remove('active');
                            dash4.link.classList.remove('active');
                            var active = node.parentNode.querySelector('.active');
                            if (active === node) {
                                return;
                            }
                            active.classList.remove('active');
                            active.link.remove();
                            node.classList.add('active');
                            rightPane.appendChild(node.link);
                        }
                        var processExtension = function (exportext) {
                            if (page.currentExtension) {
                                if (page.currentExtension != inputExtName.value &amp;&amp; !exportext) {
                                    game.removeExtension(page.currentExtension);
                                }
                            }
                            inputExtName.disabled = true;
                            setTimeout(function () {
                                var ext = {};
                                var config = null, help = null;
                                for (var i in dash4.content) {
                                    try {
                                        if (i == 'content' || i == 'precontent') {
                                            eval('ext[i]=' + dash4.content[i]);
                                            if (typeof ext[i] != 'function') {
                                                throw ('err');
                                            }
                                            else {
                                                ext[i] = ext[i].toString();
                                            }
                                        }
                                        else {
                                            eval(dash4.content[i]);
                                            eval('ext[i]=' + i);
                                            if (ext[i] == null || typeof ext[i] != 'object') {
                                                throw ('err');
                                            }
                                            else {
                                                ext[i] = JSON.stringify(ext[i]);
                                            }
                                        }
                                    }
                                    catch (e) {
                                        console.log(e);
                                        delete ext[i];
                                    }
                                }
                                page.currentExtension = inputExtName.value || '';
                                var str = '{name:"' + page.currentExtension + '"';
                                for (var i in ext) {
                                    str += ',' + i + ':' + ext[i];
                                }
                                dash2.content.pack.list = [];
                                for (var i = 0; i &lt; dash2.pile.childNodes.length; i++) {
                                    dash2.content.pack.list.push(dash2.pile.childNodes[i].link);
                                }
                                str += ',package:' + get.stringify({
                                    character: dash1.content.pack,
                                    card: dash2.content.pack,
                                    skill: dash3.content.pack,
                                    intro: introExtLine.querySelector('input').value || '',
                                    author: authorExtLine.querySelector('input').value || '',
                                    diskURL: diskExtLine.querySelector('input').value || '',
                                    forumURL: forumExtLine.querySelector('input').value || '',
                                    version: versionExtLine.querySelector('input').value || '',
                                });
                                var files = { character: [], card: [], skill: [] };
                                for (var i in dash1.content.image) {
                                    files.character.push(i);
                                }
                                for (var i in dash2.content.image) {
                                    files.card.push(i);
                                }
                                for (var i in dash3.content.audio) {
                                    files.skill.push(i);
                                }
                                str += ',files:' + JSON.stringify(files);
                                str += '}';
                                var extension = { 'extension.js': 'game.import("extension",function(lib,game,ui,get,ai,_status){return ' + str + '})' };
                                for (var i in dash1.content.image) {
                                    extension[i] = dash1.content.image[i];
                                }
                                for (var i in dash2.content.image) {
                                    extension[i] = dash2.content.image[i];
                                }
                                if (exportext) {
                                    var proexport = function () {
                                        game.importExtension(extension, null, page.currentExtension, {
                                            intro: introExtLine.querySelector('input').value || '',
                                            author: authorExtLine.querySelector('input').value || '',
                                            netdisk: diskExtLine.querySelector('input').value || '',
                                            forum: forumExtLine.querySelector('input').value || '',
                                            version: versionExtLine.querySelector('input').value || '',
                                        });
                                    };
                                    if (game.getFileList) {
                                        game.getFileList('extension/' + page.currentExtension, function (folders, files) {
                                            extension._filelist = files;
                                            proexport();
                                        });
                                    }
                                    else {
                                        proexport();
                                    }
                                }
                                else {
                                    game.importExtension(extension, function () {
                                        exportExtLine.style.display = '';
                                    });
                                }
                            }, 500);
                        };
                        var buttonConfirm = document.createElement('button');
                        buttonConfirm.innerHTML = '';
                        buttonConfirm.style.marginLeft = '5px';
                        buttonConfirm.onclick = buttonConfirmOnclick;
                        inputExtLine.appendChild(buttonConfirm);
                        var buttonRename = document.createElement('button');
                        buttonRename.innerHTML = '';
                        buttonRename.style.marginLeft = '2px';
                        buttonRename.style.marginRight = '2px';
                        buttonRename.style.display = 'none';
                        buttonRename.onclick = function () {
                            inputExtSpan.style.display = '';
                            inputExtName.style.display = '';
                            authorExtLine.style.display = '';
                            introExtLine.style.display = '';
                            forumExtLine.style.display = '';
                            diskExtLine.style.display = '';
                            versionExtLine.style.display = '';
                            okExtLine.style.display = 'block';
                            inputExtLine.style.padding = '20px 10px 10px 10px';
                            inputExtName.disabled = false;
                            buttonRename.style.display = 'none';
                            buttonSave.style.display = 'none';
                            buttonReset.style.display = 'none';
                            buttonExport.style.display = 'none';
                            inputExtSpan.innerHTML = '';
                            inputExtName.style.width = '100px';
                            inputExtName.style.textAlign = '';

                            dashboard.style.display = 'none';
                        };
                        inputExtLine.appendChild(buttonRename);
                        var buttonReset = document.createElement('button');
                        buttonReset.innerHTML = '';
                        buttonReset.style.marginLeft = '2px';
                        buttonReset.style.marginRight = '2px';
                        buttonReset.style.display = 'none';
                        buttonReset.onclick = function () {
                            if (confirm('')) {
                                game.editExtension();
                            }
                        };
                        inputExtLine.appendChild(buttonReset);
                        var buttonSave = document.createElement('button');
                        buttonSave.innerHTML = '';
                        buttonSave.style.marginLeft = '2px';
                        buttonSave.style.marginRight = '2px';
                        buttonSave.style.display = 'none';
                        buttonSave.onclick = function () {
                            dash1.link.classList.remove('active');
                            dash2.link.classList.remove('active');
                            dash3.link.classList.remove('active');
                            dash4.link.classList.remove('active');
                            processExtension();
                        };
                        inputExtLine.appendChild(buttonSave);
                        var buttonExport = document.createElement('button');
                        buttonExport.innerHTML = '';
                        buttonExport.style.marginLeft = '2px';
                        buttonExport.style.marginRight = '2px';
                        buttonExport.style.display = 'none';
                        buttonExport.onclick = function () {
                            processExtension(true);
                            if (lib.config.show_extensionshare) {
                                shareExtLine.style.display = '';
                            }
                        };
                        inputExtLine.appendChild(buttonExport);
                        var exportExtLine = ui.create.div(pageboard);
                        exportExtLine.style.display = 'none';
                        exportExtLine.style.width = 'calc(100% - 40px)';
                        exportExtLine.style.textAlign = 'left';
                        exportExtLine.style.marginBottom = '5px';
                        if (lib.device == 'ios') {
                            exportExtLine.innerHTML = '&lt;span class="closenode">&lt;/span>';
                            exportExtLine.querySelectorAll('span')[0].onclick = function () {
                                exportExtLine.style.display = 'none';
                            };
                        }
                        else {
                            exportExtLine.innerHTML = '&lt;span class="hrefnode">&lt;/span>&lt;span class="closenode">&lt;/span>';
                            exportExtLine.querySelectorAll('span')[0].onclick = game.reload;
                            exportExtLine.querySelectorAll('span')[1].onclick = function () {
                                exportExtLine.style.display = 'none';
                            };
                        }


                        var shareExtLine = ui.create.div(pageboard);
                        shareExtLine.style.display = 'none';
                        shareExtLine.style.width = 'calc(100% - 40px)';
                        shareExtLine.style.textAlign = 'left';
                        shareExtLine.style.marginBottom = '5px';
                        shareExtLine.innerHTML = '&lt;span class="hrefnode">&lt;/span>&lt;span class="closenode">&lt;/span>';
                        shareExtLine.querySelectorAll('span')[0].onclick = function () {
                            game.open('https://tieba.baidu.com/p/5439380222');
                        };
                        shareExtLine.querySelectorAll('span')[1].onclick = function () {
                            shareExtLine.style.display = 'none';
                        };

                        var dashboard = ui.create.div(pageboard);
                        var clickDash = function () {
                            ui.create.templayer();
                            pageboard.hide();
                            this.link.show();
                            if (this.link.init) {
                                this.link.init();
                            }
                        };
                        var createDash = function (str1, str2, node) {
                            var dash = ui.create.div('.menubutton.large.dashboard');
                            dashboard.appendChild(dash);
                            page.appendChild(node);
                            dash.link = node;
                            node.link = dash;
                            dash.listen(clickDash);
                            lib.setScroll(node);
                            ui.create.div('', str1, dash);
                            ui.create.div('', str2, dash);
                        };
                        var dash1 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            var currentButton = null;
                            page.init = function () {
                                if (!page.querySelector('.button.character')) {
                                    toggle.classList.add('on');
                                    newCharacter.style.display = '';
                                }
                            };
                            var updateButton = function () {
                                var name = page.querySelector('input.new_name').value;
                                if (!name) {
                                    editnode.classList.add('disabled');
                                    return;
                                }
                                name = name.split('|');
                                name = name[0];
                                if (currentButton) {
                                    if (currentButton.link != name) {
                                        if (lib.character[name] || page.content.pack.character[name]) {
                                            editnode.classList.add('disabled');
                                            return;
                                        }
                                    }
                                }
                                else {
                                    if (lib.character[name] || page.content.pack.character[name]) {
                                        editnode.classList.add('disabled');
                                        return;
                                    }
                                }
                                if (!fakeme.image) {
                                    if (!page.content.image[name + '.jpg']) {
                                        editnode.classList.add('disabled');
                                        return;
                                    }
                                }
                                editnode.classList.remove('disabled');
                            };
                            var clickButton = function () {
                                if (currentButton == this) {
                                    resetEditor();
                                    return;
                                }
                                resetEditor();
                                currentButton = this;
                                toggle.classList.add('on');
                                newCharacter.style.display = '';
                                fakeme.classList.add('inited');
                                fakeme.style.backgroundImage = this.style.backgroundImage;
                                if (page.content.pack.translate[this.link] != this.link) {
                                    newCharacter.querySelector('.new_name').value = this.link + '|' + page.content.pack.translate[this.link];
                                }
                                else {
                                    newCharacter.querySelector('.new_name').value = this.link;
                                }
                                var info = page.content.pack.character[this.link];
                                newCharacter.querySelector('.new_hp').value = info[2];
                                sexes.value = info[0];
                                groups.value = info[1];
                                if (info[4]) {
                                    for (var i = 0; i &lt; options.childNodes.length - 1; i++) {
                                        if (options.childNodes[i].lastChild &amp;&amp; info[4].contains(options.childNodes[i].lastChild.name)) {
                                            options.childNodes[i].lastChild.checked = true;
                                        }
                                        else if (options.childNodes[i].lastChild) {
                                            options.childNodes[i].lastChild.checked = false;
                                        }
                                    }
                                    for (var i = 0; i &lt; info[4].length; i++) {
                                        if (info[4][i].indexOf('des:') == 0) {
                                            newCharacter.querySelector('.new_des').value = info[4][i].slice(4);
                                        }
                                    }
                                }

                                var skills = info[3];
                                for (var i = 0; i &lt; skills.length; i++) {
                                    var node = document.createElement('button');
                                    node.skill = skills[i];
                                    node.onclick = deletenode;
                                    node.innerHTML = lib.translate[skills[i]];
                                    skillList.firstChild.appendChild(node);
                                }

                                toggle.innerHTML = ' &lt;div>&amp;gt;&lt;/div>';
                                editnode.innerHTML = '';
                                editnode.classList.remove('disabled');
                                delnode.innerHTML = '';
                                delnode.button = this;
                            }
                            var createButton = function (name, image) {
                                var button = ui.create.div('.button.character');
                                button.link = name;
                                button.image = image;
                                button.style.backgroundImage = 'url(' + image + ')';
                                button.style.backgroundSize = 'cover';
                                button.listen(clickButton);
                                button.classList.add('noclick');
                                button.nodename = ui.create.div(button, '.name', get.verticalStr(page.content.pack.translate[name]));
                                button.nodename.style.top = '8px';
                                page.insertBefore(button, page.childNodes[1]);
                            }
                            page.reset = function (name) {
                                resetEditor();
                                var buttons = page.querySelectorAll('.button.character');
                                var list = [];
                                for (var i = 0; i &lt; buttons.length; i++) {
                                    list.push(buttons[i]);
                                }
                                for (var i = 0; i &lt; list.length; i++) {
                                    list[i].remove();
                                }
                                if (lib.extensionPack[name]) {
                                    page.content.pack = lib.extensionPack[name].character || {
                                        character: {},
                                        translate: {}
                                    };
                                    page.content.image = {};
                                    for (var i in page.content.pack.character) {
                                        var file = i + '.jpg';
                                        var loadImage = function (file, data) {
                                            var img = new Image();
                                            img.crossOrigin = 'Anonymous';
                                            img.onload = function () {
                                                var canvas = document.createElement('CANVAS');
                                                var ctx = canvas.getContext('2d');
                                                var dataURL;
                                                canvas.height = this.height;
                                                canvas.width = this.width;
                                                ctx.drawImage(this, 0, 0);
                                                canvas.toBlob(function (blob) {
                                                    var fileReader = new FileReader();
                                                    fileReader.onload = function (e) {
                                                        page.content.image[file] = e.target.result;
                                                    };
                                                    fileReader.readAsArrayBuffer(blob, "UTF-8");
                                                });
                                            };
                                            img.src = data;
                                        }
                                        if (game.download) {
                                            var url = lib.assetURL + 'extension/' + name + '/' + file;
                                            createButton(i, url);
                                            if (lib.device == 'ios' || lib.device == 'android') {
                                                window.resolveLocalFileSystemURL(lib.assetURL + 'extension/' + name, function (entry) {
                                                    entry.getFile(file, {}, function (fileEntry) {
                                                        fileEntry.file(function (fileToLoad) {
                                                            var fileReader = new FileReader();
                                                            fileReader.onload = function (e) {
                                                                page.content.image[file] = e.target.result;
                                                            };
                                                            fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                                                        });
                                                    });
                                                });
                                            }
                                            else {
                                                loadImage(file, url);
                                            }
                                        }
                                        else {
                                            game.getDB('image', 'extension-' + name + ':' + file, (function (file, name) {
                                                return function (data) {
                                                    createButton(name, data);
                                                    loadImage(file, data);
                                                };
                                            }(file, i)))
                                        }
                                    }
                                }
                                else {
                                    page.content = {
                                        pack: {
                                            character: {},
                                            translate: {}
                                        },
                                        image: {}
                                    };
                                    toggle.classList.add('on');
                                    newCharacter.style.display = '';
                                }
                            };
                            ui.create.div('.config.more', '&lt;div style="transform:none;margin-right:3px">&lt;/div>', page, function () {
                                ui.create.templayer();
                                page.hide();
                                pageboard.show();
                            });
                            page.content = {
                                pack: {
                                    character: {},
                                    translate: {}
                                },
                                image: {}
                            };
                            var newCharacter;
                            var toggle = ui.create.div('.config.more.on', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                this.classList.toggle('on');
                                if (this.classList.contains('on')) {
                                    newCharacter.style.display = '';
                                }
                                else {
                                    newCharacter.style.display = 'none';
                                }
                            });
                            var resetEditor = function () {
                                currentButton = null;
                                toggle.classList.remove('on');
                                newCharacter.style.display = 'none';
                                fakeme.classList.remove('inited');
                                delete fakeme.image;
                                delete fakeme.image64;
                                fakeme.style.backgroundImage = '';
                                var inputs = newCharacter.querySelectorAll('input');
                                for (var i = 0; i &lt; inputs.length; i++) {
                                    inputs[i].value = '';
                                }
                                inputs = newCharacter.querySelectorAll('textarea');
                                for (var i = 0; i &lt; inputs.length; i++) {
                                    inputs[i].value = '';
                                }
                                skillList.firstChild.innerHTML = '';
                                toggle.innerHTML = ' &lt;div>&amp;gt;&lt;/div>';
                                editnode.innerHTML = '';
                                editnode.classList.add('disabled');
                                delnode.innerHTML = '';
                                delete delnode.button;
                            }

                            newCharacter = ui.create.div('.new_character', page);
                            var fakeme = ui.create.div('.avatar', newCharacter);

                            var input = document.createElement('input');
                            input.type = 'file';
                            input.accept = 'image/*';
                            input.className = 'fileinput';
                            input.onchange = function () {
                                var fileToLoad = input.files[0];
                                if (fileToLoad) {
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        fakeme.style.backgroundImage = 'url(' + data + ')';
                                        fakeme.image64 = data;
                                        fakeme.classList.add('inited');
                                        var fileReader = new FileReader();
                                        fileReader.onload = function (fileLoadedEvent) {
                                            fakeme.image = fileLoadedEvent.target.result;
                                            updateButton();
                                        };
                                        fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                }
                            }
                            fakeme.appendChild(input);

                            ui.create.div('.select_avatar', '', fakeme);

                            ui.create.div('.indent', '&lt;input class="new_name" type="text">', newCharacter).style.paddingTop = '8px';
                            ui.create.div('.indent', '&lt;input class="new_des" type="text">', newCharacter).style.paddingTop = '8px';
                            ui.create.div('.indent', '&lt;input class="new_hp" type="text">', newCharacter).style.paddingTop = '8px';
                            newCharacter.querySelector('input.new_name').onblur = updateButton;
                            var sexes = ui.create.selectlist([
                                ['male', ''],
                                ['female', ''],
                                ['none', ''],
                            ], null, ui.create.div('.indent', '', newCharacter));
                            var grouplist = [];
                            for (var i = 0; i &lt; lib.group.length; i++) {
                                grouplist.push([lib.group[i], get.translation(lib.group[i])]);
                            };
                            var groups = ui.create.selectlist(grouplist, null, ui.create.div('.indent', '', newCharacter));
                            var options = ui.create.div('.add_skill.options', '&lt;span>&lt;input type="checkbox" name="zhu">&lt;/span>&lt;span>BOSS&lt;input type="checkbox" name="boss">&lt;/span>&lt;span>&lt;input type="checkbox" name="forbidai">&lt;/span>&lt;br>&lt;span>&lt;input type="checkbox" name="hiddenSkill">&lt;/span>&lt;br>', newCharacter);
                            var addSkill = ui.create.div('.add_skill', '&lt;br>', newCharacter);
                            var list = [];
                            for (var i in lib.character) {
                                if (lib.character[i][3].length) {
                                    list.push([i, lib.translate[i]]);
                                }
                            }
                            list.sort(function (a, b) {
                                a = a[0]; b = b[0];
                                var aa = a, bb = b;
                                if (aa.indexOf('_') != -1) {
                                    aa = aa.slice(aa.indexOf('_') + 1);
                                }
                                if (bb.indexOf('_') != -1) {
                                    bb = bb.slice(bb.indexOf('_') + 1);
                                }
                                if (aa != bb) {
                                    return aa > bb ? 1 : -1;
                                }
                                return a > b ? 1 : -1;
                            });
                            var list2 = [];
                            var skills = lib.character[list[0][0]][3];
                            for (var i = 0; i &lt; skills.length; i++) {
                                list2.push([skills[i], lib.translate[skills[i]]]);
                            }
                            list.unshift(['current_extension', '']);

                            var selectname = ui.create.selectlist(list, list[1], addSkill);
                            page.selectname = selectname;
                            selectname.onchange = function () {
                                skillopt.innerHTML = '';
                                if (this.value == 'current_extension') {
                                    for (var i in dash3.content.pack.skill) {
                                        var option = document.createElement('option');
                                        option.value = i;
                                        option.innerHTML = dash3.content.pack.translate[i];
                                        skillopt.appendChild(option);
                                    }
                                }
                                else {
                                    var skills = lib.character[this.value][3];
                                    for (var i = 0; i &lt; skills.length; i++) {
                                        var option = document.createElement('option');
                                        option.value = skills[i];
                                        option.innerHTML = lib.translate[skills[i]];
                                        skillopt.appendChild(option);
                                    }
                                }
                            };
                            selectname.style.maxWidth = '85px';
                            var skillopt = ui.create.selectlist(list2, list2[0], addSkill);
                            skillopt.style.maxWidth = '60px';
                            page.skillopt = skillopt;
                            var addSkillButton = document.createElement('button');
                            addSkillButton.innerHTML = '';
                            addSkill.appendChild(addSkillButton);
                            page.addSkillButton = addSkillButton;
                            var deletenode = function () {
                                this.remove();
                            }
                            addSkillButton.onclick = function () {
                                for (var i = 0; i &lt; skillList.firstChild.childNodes.length; i++) {
                                    if (skillList.firstChild.childNodes[i].skill == skillopt.value) return;
                                }
                                var node = document.createElement('button');
                                node.skill = skillopt.value;
                                node.onclick = deletenode;
                                for (var i = 0; i &lt; skillopt.childElementCount; i++) {
                                    if (skillopt.childNodes[i].value == skillopt.value) {
                                        node.innerHTML = skillopt.childNodes[i].innerHTML; break;
                                    }
                                }
                                skillList.firstChild.appendChild(node);
                            };
                            var createSkillButton = document.createElement('button');
                            createSkillButton.innerHTML = '';
                            createSkillButton.style.marginLeft = '3px';
                            addSkill.appendChild(createSkillButton);
                            createSkillButton.onclick = function () {
                                ui.create.templayer();
                                page.hide();
                                dash3.show();
                                dash3.fromchar = 'add';
                                dash3.toggle.classList.add('on');
                                dash3.newSkill.style.display = '';
                            };
                            page.updateSkill = function () {
                                for (var i = 0; i &lt; skillList.firstChild.childNodes.length; i++) {
                                    var node = skillList.firstChild.childNodes[i];
                                    var skill = skillList.firstChild.childNodes[i].skill;
                                    if (dash3.content.pack.skill[skill]) {
                                        node.innerHTML = dash3.content.pack.translate[skill];
                                    }
                                    else if (lib.skill[skill]) {
                                        node.innerHTML = lib.translate[skill];
                                    }
                                    else {
                                        node.remove(); i--;
                                    }
                                }
                            };
                            var skillList = ui.create.div('.skill_list', newCharacter);
                            ui.create.div(skillList);
                            var editnode = ui.create.div('.menubutton.large.disabled', '', ui.create.div(skillList), function () {
                                var name = page.querySelector('input.new_name').value;
                                if (!name) {
                                    alert('\nid+|+id');
                                    return;
                                }
                                name = name.split('|');
                                var translate = name[1] || name[0];
                                name = name[0];
                                if (currentButton) {
                                    if (currentButton.link != name) {
                                        if (lib.character[name] || page.content.pack.character[name]) {
                                            alert('\nid+|+id');
                                            return;
                                        }
                                        page.content.image[name + '.jpg'] = page.content.image[currentButton.link + '.jpg'];
                                        delete page.content.image[currentButton.link + '.jpg'];
                                        delete page.content.pack.character[currentButton.link];
                                        delete page.content.pack.translate[currentButton.link];
                                        currentButton.link = name;
                                    }
                                }
                                else {
                                    if (lib.character[name] || page.content.pack.character[name]) {
                                        alert('\nid+|+id');
                                        return;
                                    }
                                }
                                if (fakeme.image) {
                                    page.content.image[name + '.jpg'] = fakeme.image;
                                }
                                else {
                                    if (!page.content.image[name + '.jpg']) {
                                        alert('');
                                        return;
                                    }
                                }
                                var hp = page.querySelector('input.new_hp').value;
                                if (hp == 'Infinity') hp = Infinity;
                                else if (hp.indexOf('/') == -1) hp = parseInt(hp) || 1;
                                var skills = [];
                                for (var i = 0; i &lt; skillList.firstChild.childNodes.length; i++) {
                                    skills.add(skillList.firstChild.childNodes[i].skill);
                                }
                                var tags = [];
                                for (var i = 0; i &lt; options.childNodes.length - 1; i++) {
                                    if (options.childNodes[i].lastChild &amp;&amp; options.childNodes[i].lastChild.checked) {
                                        tags.push(options.childNodes[i].lastChild.name);
                                    }
                                }
                                if (tags.contains('boss')) {
                                    tags.add('bossallowed');
                                }
                                var des = page.querySelector('input.new_des').value;
                                if (des) {
                                    tags.add('des:' + des);
                                }

                                page.content.pack.translate[name] = translate;
                                page.content.pack.character[name] = [sexes.value, groups.value, hp, skills, tags];
                                if (this.innerHTML == '') {
                                    createButton(name, fakeme.image64);
                                }
                                else if (currentButton) {
                                    if (fakeme.image64) {
                                        currentButton.image = fakeme.image64;
                                        currentButton.style.backgroundImage = 'url(' + fakeme.image64 + ')';
                                    }
                                    currentButton.nodename.innerHTML = get.verticalStr(translate);
                                }
                                resetEditor();
                                dash1.link.classList.add('active');
                            });
                            var delnode = ui.create.div('.menubutton.large', '', editnode.parentNode, function () {
                                if (this.innerHTML == '') {
                                    this.button.remove();
                                    var name = this.button.link;
                                    delete dash1.content.pack.character[name];
                                    delete dash1.content.pack.translate[name];
                                    delete dash1.content.image[name];
                                    dash1.link.classList.add('active');
                                }
                                resetEditor();
                            });
                            delnode.style.marginLeft = '13px';

                            return page;
                        }());
                        var dash2 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            var currentButton = null;
                            page.init = function () {
                                if (!page.querySelector('.button.card')) {
                                    toggle.classList.add('on');
                                    newCard.style.display = '';
                                }
                            };
                            var updateButton = function () {
                                var name = page.querySelector('input.new_name').value;
                                if (!name) {
                                    editnode.classList.add('disabled');
                                    return;
                                }
                                name = name.split('|');
                                name = name[0];
                                if (currentButton) {
                                    if (currentButton.link != name) {
                                        if (lib.card[name] || page.content.pack.card[name]) {
                                            editnode.classList.add('disabled');
                                            return;
                                        }
                                    }
                                }
                                else {
                                    if (lib.card[name] || page.content.pack.card[name]) {
                                        editnode.classList.add('disabled');
                                        return;
                                    }
                                }
                                if (!fakeme.image &amp;&amp; !fakeme.classList.contains('inited')) {
                                    editnode.classList.add('disabled');
                                    return;
                                }
                                editnode.classList.remove('disabled');
                            };
                            var clickButton = function () {
                                if (currentButton == this) {
                                    resetEditor();
                                    return;
                                }
                                resetEditor();
                                currentButton = this;
                                toggle.classList.add('on');
                                newCard.style.display = '';
                                fakeme.classList.add('inited');
                                delete fakeme.image;
                                delete fakeme.image64;
                                if (this.classList.contains('fullskin')) {
                                    fakeme.imagenode.style.backgroundImage = this.imagenode.style.backgroundImage;
                                    fakeme.classList.add('fullskin');
                                }
                                else {
                                    fakeme.style.backgroundImage = this.style.backgroundImage;
                                    fakeme.classList.remove('fullskin');
                                }
                                if (page.content.pack.translate[this.link] != this.link) {
                                    newCard.querySelector('.new_name').value = this.link + '|' + page.content.pack.translate[this.link];
                                }
                                else {
                                    newCard.querySelector('.new_name').value = this.link;
                                }
                                newCard.querySelector('.new_description').value = page.content.pack.translate[this.link + '_info'];
                                var info = page.content.pack.card[this.link];
                                container.code = 'card=' + get.stringify(info);

                                toggle.innerHTML = ' &lt;div>&amp;gt;&lt;/div>';
                                editnode.innerHTML = '';
                                editnode.classList.remove('disabled');
                                delnode.innerHTML = '';
                                delnode.button = this;
                            }
                            var createButton = function (name, image, fullskin) {
                                var button = ui.create.div('.button.card');
                                button.link = name;
                                button.image = image;
                                button.imagenode = ui.create.div('.image', button);
                                if (image) {
                                    if (fullskin) {
                                        button.imagenode.style.backgroundImage = 'url(' + image + ')';
                                        button.style.backgroundImage = '';
                                        button.style.backgroundSize = '';
                                        button.classList.add('fullskin');
                                    }
                                    else {
                                        button.style.color = 'white';
                                        button.style.textShadow = 'black 0 0 2px';
                                        button.imagenode.style.backgroundImage = '';
                                        button.style.backgroundImage = 'url(' + image + ')';
                                        button.style.backgroundSize = 'cover';
                                    }
                                }
                                button.listen(clickButton);
                                button.classList.add('noclick');
                                button.nodename = ui.create.div(button, '.name', get.verticalStr(page.content.pack.translate[name]));
                                page.insertBefore(button, page.childNodes[1]);
                            }
                            page.reset = function (name) {
                                resetEditor();
                                var buttons = page.querySelectorAll('.button.card');
                                var list = [];
                                for (var i = 0; i &lt; buttons.length; i++) {
                                    list.push(buttons[i]);
                                }
                                for (var i = 0; i &lt; list.length; i++) {
                                    list[i].remove();
                                }
                                if (lib.extensionPack[name]) {
                                    page.content.pack = lib.extensionPack[name].card || {
                                        card: {},
                                        translate: {}
                                    };
                                    page.content.image = {};
                                    if (Array.isArray(page.content.pack.list)) {
                                        for (var i = 0; i &lt; page.content.pack.list.length; i++) {
                                            var card = page.content.pack.list[i];
                                            var node = document.createElement('button');
                                            node.innerHTML = page.content.pack.translate[card[2]] + ' ' + lib.translate[card[0]] + card[1];
                                            node.name = card[2];
                                            node.link = card;
                                            pile.appendChild(node);
                                            node.onclick = function () {
                                                this.remove();
                                            }
                                        }
                                    }
                                    for (var i in page.content.pack.card) {
                                        var file;
                                        var fullskin = page.content.pack.card[i].fullskin ? true : false;
                                        if (fullskin) {
                                            file = i + '.png';
                                        }
                                        else {
                                            file = i + '.jpg';
                                        }
                                        var loadImage = function (file, data) {
                                            var img = new Image();
                                            img.crossOrigin = 'Anonymous';
                                            img.onload = function () {
                                                var canvas = document.createElement('CANVAS');
                                                var ctx = canvas.getContext('2d');
                                                var dataURL;
                                                canvas.height = this.height;
                                                canvas.width = this.width;
                                                ctx.drawImage(this, 0, 0);
                                                canvas.toBlob(function (blob) {
                                                    var fileReader = new FileReader();
                                                    fileReader.onload = function (e) {
                                                        page.content.image[file] = e.target.result;
                                                    };
                                                    fileReader.readAsArrayBuffer(blob, "UTF-8");
                                                });
                                            };
                                            img.src = data;
                                        }
                                        if (game.download) {
                                            var url = lib.assetURL + 'extension/' + name + '/' + file;
                                            createButton(i, url, fullskin);
                                            if (lib.device == 'ios' || lib.device == 'android') {
                                                window.resolveLocalFileSystemURL(lib.assetURL + 'extension/' + name, function (entry) {
                                                    entry.getFile(file, {}, function (fileEntry) {
                                                        fileEntry.file(function (fileToLoad) {
                                                            var fileReader = new FileReader();
                                                            fileReader.onload = function (e) {
                                                                page.content.image[file] = e.target.result;
                                                            };
                                                            fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                                                        });
                                                    });
                                                });
                                            }
                                            else {
                                                loadImage(file, url);
                                            }
                                        }
                                        else {
                                            game.getDB('image', 'extension-' + name + ':' + file, (function (file, name, fullskin) {
                                                return function (data) {
                                                    createButton(name, data, fullskin);
                                                    loadImage(file, data);
                                                };
                                            }(file, i, fullskin)))
                                        }
                                    }
                                }
                                else {
                                    page.content = {
                                        pack: {
                                            card: {},
                                            translate: {}
                                        },
                                        image: {}
                                    };
                                    toggle.classList.add('on');
                                    newCard.style.display = '';
                                }
                                updatePile();
                            };
                            ui.create.div('.config.more.margin-bottom', '&lt;div style="transform:none;margin-right:3px">&lt;/div>', page, function () {
                                ui.create.templayer();
                                page.hide();
                                pageboard.show();
                            });
                            page.content = {
                                pack: {
                                    card: {},
                                    translate: {},
                                    list: []
                                },
                                image: {}
                            };
                            var newCard;
                            var toggle = ui.create.div('.config.more.on', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                this.classList.toggle('on');
                                if (this.classList.contains('on')) {
                                    newCard.style.display = '';
                                }
                                else {
                                    newCard.style.display = 'none';
                                }
                            });
                            var resetEditor = function () {
                                currentButton = null;
                                toggle.classList.remove('on');
                                newCard.style.display = 'none';
                                fakeme.classList.remove('inited');
                                fakeme.classList.add('fullskin');
                                delete fakeme.image;
                                delete fakeme.image64;
                                fakeme.style.backgroundImage = '';
                                fakeme.imagenode.style.backgroundImage = '';
                                var inputs = newCard.querySelectorAll('input');
                                for (var i = 0; i &lt; inputs.length; i++) {
                                    inputs[i].value = '';
                                }
                                toggle.innerHTML = ' &lt;div>&amp;gt;&lt;/div>';
                                editnode.innerHTML = '';
                                editnode.classList.add('disabled');
                                delnode.innerHTML = '';
                                delete delnode.button;
                                container.code = 'card={\n    \n}\n\n\/*\n\ncard={\n    type:"basic",\n    enable:true,\n    filterTarget:true,\n    content:function(){\n        target.draw()\n    },\n    ai:{\n        order:1,\n        result:{\n            target:1\n        }\n    }\n}\n\n\n*\/';
                            }

                            newCard = ui.create.div('.new_character', page);
                            newCard.style.height = '173px';
                            var fakeme = ui.create.div('.card.fullskin', newCard);

                            var input = document.createElement('input');
                            input.type = 'file';
                            input.accept = 'image/*';
                            input.className = 'fileinput';
                            input.onchange = function () {
                                var fileToLoad = input.files[0];
                                if (fileToLoad) {
                                    var fileReader = new FileReader();
                                    var fullimage = (fileToLoad.name.indexOf('.jpg') != -1);
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        if (fullimage) {
                                            fakeme.imagenode.style.backgroundImage = '';
                                            fakeme.style.backgroundImage = 'url(' + data + ')';
                                            fakeme.classList.remove('fullskin');
                                        }
                                        else {
                                            fakeme.style.backgroundImage = '';
                                            fakeme.imagenode.style.backgroundImage = 'url(' + data + ')';
                                            fakeme.classList.add('fullskin');
                                        }
                                        fakeme.image64 = data;
                                        fakeme.classList.add('inited');
                                        var fileReader = new FileReader();
                                        fileReader.onload = function (fileLoadedEvent) {
                                            fakeme.image = fileLoadedEvent.target.result;
                                            updateButton();
                                        };
                                        fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                                    };
                                    fileReader.readAsDataURL(fileToLoad, "UTF-8");
                                }
                            }
                            fakeme.appendChild(input);

                            fakeme.imagenode = ui.create.div('.image', fakeme);
                            ui.create.div('.name', '&lt;br>&lt;br>&lt;br>', fakeme);

                            ui.create.div('.indent', '&lt;input class="new_name" type="text">', newCard).style.paddingTop = '8px';
                            ui.create.div('.indent', '&lt;input class="new_description" type="text">', newCard).style.paddingTop = '6px';
                            newCard.querySelector('input.new_name').onblur = updateButton;
                            var codeButton = document.createElement('button');
                            newCard.appendChild(codeButton);
                            codeButton.innerHTML = '';
                            codeButton.style.left = '123px';
                            codeButton.style.top = '66px';
                            codeButton.style.position = 'absolute';

                            var citeButton = document.createElement('button');
                            newCard.appendChild(citeButton);
                            citeButton.innerHTML = '';
                            citeButton.style.left = '123px';
                            citeButton.style.top = '90px';
                            citeButton.style.position = 'absolute';
                            citeButton.onclick = function () {
                                codeButton.style.display = 'none';
                                citeButton.style.display = 'none';
                                selectname.style.display = '';
                                confirmcontainer.style.display = '';
                            }

                            var list = [];
                            for (var i in lib.card) {
                                if (lib.translate[i]) {
                                    list.push([i, lib.translate[i]]);
                                }
                            }
                            list.sort(function (a, b) {
                                a = a[0]; b = b[0];
                                var aa = a, bb = b;
                                if (aa.indexOf('_') != -1) {
                                    aa = aa.slice(aa.indexOf('_') + 1);
                                }
                                if (bb.indexOf('_') != -1) {
                                    bb = bb.slice(bb.indexOf('_') + 1);
                                }
                                if (aa != bb) {
                                    return aa > bb ? 1 : -1;
                                }
                                return a > b ? 1 : -1;
                            });
                            var selectname = ui.create.selectlist(list, list[0], newCard);
                            selectname.style.left = '123px';
                            selectname.style.top = '66px';
                            selectname.style.position = 'absolute';
                            selectname.style.display = 'none';

                            var confirmcontainer = ui.create.div(newCard);
                            confirmcontainer.style.left = '123px';
                            confirmcontainer.style.top = '90px';
                            confirmcontainer.style.position = 'absolute';
                            confirmcontainer.style.display = 'none';

                            var citeconfirm = document.createElement('button');
                            citeconfirm.innerHTML = '';
                            confirmcontainer.appendChild(citeconfirm);
                            citeconfirm.onclick = function () {
                                codeButton.style.display = '';
                                citeButton.style.display = '';
                                selectname.style.display = 'none';
                                confirmcontainer.style.display = 'none';
                                container.code = 'card=' + get.stringify(lib.card[selectname.value]);
                                codeButton.onclick.call(codeButton);
                                if (lib.translate[selectname.value + '_info']) {
                                    newCard.querySelector('input.new_description').value = lib.translate[selectname.value + '_info'];
                                }
                            }

                            var citecancel = document.createElement('button');
                            citecancel.innerHTML = '';
                            citecancel.style.marginLeft = '3px';
                            confirmcontainer.appendChild(citecancel);
                            citecancel.onclick = function () {
                                codeButton.style.display = '';
                                citeButton.style.display = '';
                                selectname.style.display = 'none';
                                confirmcontainer.style.display = 'none';
                            }

                            codeButton.onclick = function () {
                                var node = container;
                                ui.window.classList.add('shortcutpaused');
                                ui.window.classList.add('systempaused');
                                window.saveNonameInput = saveInput;
                                if (node.aced) {
                                    ui.window.appendChild(node);
                                    node.editor.setValue(node.code, 1);
                                }
                                else if (lib.device == 'ios') {
                                    ui.window.appendChild(node);
                                    if (!node.textarea) {
                                        var textarea = document.createElement('textarea');
                                        editor.appendChild(textarea);
                                        node.textarea = textarea;
                                        lib.setScroll(textarea);
                                    }
                                    node.textarea.value = node.code;
                                }
                                else {
                                    var aceReady = function () {
                                        ui.window.appendChild(node);
                                        var mirror = window.CodeMirror(editor, {
                                            value: node.code,
                                            mode: "javascript",
                                            lineWrapping: !lib.config.touchscreen &amp;&amp; lib.config.mousewheel,
                                            lineNumbers: true,
                                            indentUnit: 4,
                                            autoCloseBrackets: true,
                                            theme: 'mdn-like'
                                        });
                                        lib.setScroll(editor.querySelector('.CodeMirror-scroll'));
                                        node.aced = true;
                                        node.editor = mirror;
                                    }
                                    if (!window.CodeMirror) {
                                        lib.init.js(lib.assetURL + 'game', 'codemirror', aceReady);
                                        lib.init.css(lib.assetURL + 'layout/default', 'codemirror');
                                    }
                                    else {
                                        aceReady();
                                    }
                                }
                            }

                            var container = ui.create.div('.popup-container.editor');
                            var editorpage = ui.create.div(container);
                            var discardConfig = ui.create.div('.editbutton', '', editorpage, function () {
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete(null);
                                delete window.saveNonameInput;
                            });
                            var saveInput = function () {
                                var code;
                                if (container.editor) {
                                    code = container.editor.getValue();
                                }
                                else if (container.textarea) {
                                    code = container.textarea.value;
                                }
                                try {
                                    var card = null;
                                    eval(code);
                                    if (card == null || typeof card != 'object') {
                                        throw ('err');
                                    }
                                }
                                catch (e) {
                                    if (e == 'err') {
                                        alert('');
                                    }
                                    else {
                                        alert('' + e + '')
                                    }
                                    return;
                                }
                                dash2.link.classList.add('active');
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete();
                                container.code = code;
                                delete window.saveNonameInput;
                            };
                            var saveConfig = ui.create.div('.editbutton', '', editorpage, saveInput);
                            var editor = ui.create.div(editorpage);
                            container.code = 'card={\n    \n}\n\n\/*\n\ncard={\n    type:"basic",\n    enable:true,\n    filterTarget:true,\n    content:function(){\n        target.draw()\n    },\n    ai:{\n        order:1,\n        result:{\n            target:1\n        }\n    }\n}\n\n\n*\/';

                            var editnode = ui.create.div('.menubutton.large.new_card.disabled', '', newCard, function () {
                                var name = page.querySelector('input.new_name').value;
                                if (!name) {
                                    alert('\nid+|+id');
                                    return;
                                }
                                name = name.split('|');
                                var translate = name[1] || name[0];
                                var info = page.querySelector('input.new_description').value;
                                name = name[0];
                                if (currentButton) {
                                    if (currentButton.link != name) {
                                        if (lib.card[name] || page.content.pack.card[name]) {
                                            alert('\nid+|+id');
                                            return;
                                        }
                                        var extname;
                                        if (currentButton.classList.contains('fullskin')) {
                                            extname = '.png';
                                        }
                                        else {
                                            extname = '.jpg';
                                        }
                                        page.content.image[name + extname] = page.content.image[currentButton.link + extname];
                                        delete page.content.image[currentButton.link + extname];
                                        delete page.content.pack.card[currentButton.link];
                                        delete page.content.pack.translate[currentButton.link];
                                        delete page.content.pack.translate[currentButton.link + '_info'];
                                        currentButton.link = name;
                                    }
                                }
                                else {
                                    if (lib.card[name] || page.content.pack.card[name]) {
                                        alert('\nid+|+id');
                                        return;
                                    }
                                }
                                if (fakeme.image) {
                                    if (fakeme.classList.contains('fullskin')) {
                                        page.content.image[name + '.png'] = fakeme.image;
                                        delete page.content.image[name + '.jpg'];
                                    }
                                    else {
                                        page.content.image[name + '.jpg'] = fakeme.image;
                                        delete page.content.image[name + '.png'];
                                    }
                                }
                                else if (!fakeme.classList.contains('inited')) {
                                    alert('');
                                    return;
                                }
                                page.content.pack.translate[name] = translate;
                                page.content.pack.translate[name + '_info'] = info;
                                try {
                                    var card = null;
                                    eval(container.code);
                                    if (card == null || typeof card != 'object') {
                                        throw ('err');
                                    }
                                    page.content.pack.card[name] = card;
                                }
                                catch (e) {
                                    page.content.pack.card[name] = {};
                                }
                                if (fakeme.classList.contains('inited')) {
                                    if (fakeme.classList.contains('fullskin')) {
                                        page.content.pack.card[name].fullskin = true;
                                        delete page.content.pack.card[name].fullimage;
                                    }
                                    else {
                                        page.content.pack.card[name].fullimage = true;
                                        delete page.content.pack.card[name].fullskin;
                                    }
                                }
                                if (this.innerHTML == '') {
                                    createButton(name, fakeme.image64, fakeme.classList.contains('fullskin'));
                                }
                                else if (currentButton) {
                                    if (fakeme.image64) {
                                        if (fakeme.classList.contains('fullskin')) {
                                            currentButton.style.color = '';
                                            currentButton.style.textShadow = '';
                                            currentButton.imagenode.style.backgroundImage = 'url(' + fakeme.image64 + ')';
                                            currentButton.style.backgroundImage = '';
                                            currentButton.style.backgroundSize = '';
                                            currentButton.classList.add('fullskin');
                                        }
                                        else {
                                            currentButton.style.color = 'white';
                                            currentButton.style.textShadow = 'black 0 0 2px';
                                            currentButton.imagenode.style.backgroundImage = '';
                                            currentButton.style.backgroundImage = 'url(' + fakeme.image64 + ')';
                                            currentButton.style.backgroundSize = 'cover';
                                            currentButton.classList.remove('fullskin');
                                        }
                                    }
                                    currentButton.nodename.innerHTML = get.verticalStr(translate);
                                }
                                resetEditor();
                                updatePile();
                                dash2.link.classList.add('active');
                            });
                            var delnode = ui.create.div('.menubutton.large.new_card_delete', '', editnode.parentNode, function () {
                                if (this.innerHTML == '') {
                                    this.button.remove();
                                    var name = this.button.link;
                                    delete dash2.content.pack.card[name];
                                    delete dash2.content.pack.translate[name];
                                    delete dash2.content.pack.translate[name + '_info'];
                                    delete dash2.content.image[name];
                                    updatePile();
                                    dash2.link.classList.add('active');
                                }
                                resetEditor();
                            });

                            var editPile;
                            var toggle2 = ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                this.classList.toggle('on');
                                if (this.classList.contains('on')) {
                                    editPile.style.display = '';
                                }
                                else {
                                    editPile.style.display = 'none';
                                }
                            });

                            editPile = ui.create.div('.edit_pile', page);
                            editPile.style.display = 'none';


                            var cardpileadd = ui.create.div('.config.toggle.cardpilecfg.cardpilecfgadd', editPile);
                            var pile = ui.create.div(editPile);
                            page.pile = pile;
                            var cardpileaddname = document.createElement('select');
                            var updatePile = function () {
                                cardpileaddname.innerHTML = '';
                                var list = [];
                                var list2 = [];
                                for (var i in page.content.pack.card) {
                                    list.push([i, page.content.pack.translate[i]]);
                                    list2.push(i);
                                }
                                if (list.length) {
                                    toggle2.style.display = '';
                                    if (toggle2.classList.contains('on')) {
                                        editPile.style.display = '';
                                    }
                                    else {
                                        editPile.style.display = 'none';
                                    }
                                    for (var i = 0; i &lt; list.length; i++) {
                                        var option = document.createElement('option');
                                        option.value = list[i][0];
                                        option.innerHTML = list[i][1];
                                        cardpileaddname.appendChild(option);
                                    }
                                    for (var i = 0; i &lt; pile.childNodes.length; i++) {
                                        if (!list2.contains(pile.childNodes[i].name)) {
                                            pile.childNodes[i].remove(); i--;
                                        }
                                    }
                                }
                                else {
                                    toggle2.style.display = 'none';
                                    editPile.style.display = 'none';
                                    pile.innerHTML = '';
                                }
                            };
                            updatePile();
                            cardpileadd.appendChild(cardpileaddname);
                            cardpileaddname.style.width = '75px';
                            cardpileaddname.style.marginRight = '2px';
                            cardpileaddname.style.marginLeft = '-1px';
                            var cardpileaddsuit = ui.create.selectlist([
                                ['heart', ''],
                                ['diamond', ''],
                                ['club', ''],
                                ['spade', ''],
                            ], null, cardpileadd);
                            cardpileaddsuit.style.width = '53px';
                            cardpileaddsuit.style.marginRight = '2px';
                            var cardpileaddnumber = ui.create.selectlist([
                                1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
                            ], null, cardpileadd);
                            cardpileaddnumber.style.width = '43px';
                            cardpileaddnumber.style.marginRight = '2px';
                            var button = document.createElement('button');
                            button.innerHTML = '';
                            button.style.width = '40px';
                            button.onclick = function () {
                                var card = [
                                    cardpileaddsuit.value,
                                    cardpileaddnumber.value,
                                    cardpileaddname.value,
                                ];
                                var node = document.createElement('button');
                                node.innerHTML = page.content.pack.translate[card[2]] + ' ' + lib.translate[card[0]] + card[1];
                                node.name = card[2];
                                node.link = card;
                                pile.appendChild(node);
                                node.onclick = function () {
                                    this.remove();
                                }
                            };
                            cardpileadd.appendChild(button);
                            cardpileadd.style.whiteSpace = 'nowrap';
                            cardpileadd.style.position = 'relative';
                            cardpileadd.style.right = '-4px';

                            return page;
                        }());
                        var dash3 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons.new_skill');
                            var updateButton = function () {
                                var name = page.querySelector('input.new_name').value;
                                if (!name) {
                                    editnode.classList.add('disabled');
                                    return;
                                }
                                name = name.split('|');
                                name = name[0];
                                if (currentButton) {
                                    if (currentButton.link != name) {
                                        if (lib.skill[name] || page.content.pack.skill[name]) {
                                            editnode.classList.add('disabled');
                                            return;
                                        }
                                    }
                                }
                                else {
                                    if (lib.skill[name] || page.content.pack.skill[name]) {
                                        editnode.classList.add('disabled');
                                        return;
                                    }
                                }
                                editnode.classList.remove('disabled');
                            };
                            page.init = function () {
                                if (!page.querySelector('.menubutton:not(.large)')) {
                                    toggle.classList.add('on');
                                    newSkill.style.display = '';
                                }
                            };
                            page.reset = function (name) {
                                resetEditor();
                                var buttons = page.querySelectorAll('.menubutton:not(.large)');
                                var list = [];
                                for (var i = 0; i &lt; buttons.length; i++) {
                                    list.push(buttons[i]);
                                }
                                for (var i = 0; i &lt; list.length; i++) {
                                    list[i].remove();
                                }
                                if (lib.extensionPack[name]) {
                                    page.content.pack = lib.extensionPack[name].skill || {
                                        skill: {},
                                        translate: {}
                                    };
                                    page.content.audio = {};
                                    for (var i in page.content.pack.skill) {
                                        createButton(i);
                                    }
                                    dash1.updateSkill();
                                }
                                else {
                                    page.content = {
                                        pack: {
                                            skill: {},
                                            translate: {}
                                        },
                                        audio: {}
                                    };
                                    toggle.classList.add('on');
                                    newSkill.style.display = '';
                                }
                            };
                            ui.create.div('.config.more.margin-bottom', '&lt;div style="transform:none;margin-right:3px">&lt;/div>', page, function () {
                                ui.create.templayer();
                                page.hide();
                                if (page.fromchar) {
                                    dash1.show();
                                    delete page.fromchar;
                                }
                                else {
                                    pageboard.show();
                                }
                            });
                            var currentButton = null;
                            var clickButton = function () {
                                if (currentButton == this) {
                                    resetEditor();
                                    return;
                                }
                                resetEditor();
                                currentButton = this;
                                toggle.classList.add('on');
                                newSkill.style.display = '';
                                if (page.content.pack.translate[this.link] != this.link) {
                                    newSkill.querySelector('.new_name').value = this.link + '|' + page.content.pack.translate[this.link];
                                }
                                else {
                                    newSkill.querySelector('.new_name').value = this.link;
                                }
                                newSkill.querySelector('.new_description').value = page.content.pack.translate[this.link + '_info'];
                                var info = page.content.pack.skill[this.link];
                                container.code = 'skill=' + get.stringify(info);

                                toggle.innerHTML = ' &lt;div>&amp;gt;&lt;/div>';
                                editnode.innerHTML = '';
                                editnode.classList.remove('disabled');
                                delnode.button = this;
                                delnode.innerHTML = '';
                            }
                            var createButton = function (name) {
                                var button = ui.create.div('.menubutton');
                                button.link = name;
                                button.innerHTML = page.content.pack.translate[name];
                                button.listen(clickButton);
                                page.insertBefore(button, page.childNodes[1]);
                            }
                            var newSkill;
                            var toggle = ui.create.div('.config.more.on', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                                this.classList.toggle('on');
                                if (this.classList.contains('on')) {
                                    newSkill.style.display = '';
                                }
                                else {
                                    newSkill.style.display = 'none';
                                }
                            });
                            page.toggle = toggle;
                            var resetEditor = function () {
                                currentButton = null;
                                toggle.classList.remove('on');
                                newSkill.style.display = 'none';
                                var inputs = newSkill.querySelectorAll('input');
                                for (var i = 0; i &lt; inputs.length; i++) {
                                    inputs[i].value = '';
                                }
                                var inputs = newSkill.querySelectorAll('textarea');
                                for (var i = 0; i &lt; inputs.length; i++) {
                                    inputs[i].value = '';
                                }
                                toggle.innerHTML = ' &lt;div>&amp;gt;&lt;/div>';
                                editnode.innerHTML = '';
                                editnode.classList.add('disabled');
                                delnode.innerHTML = '';
                                delete delnode.button;
                                container.code = 'skill={\n    \n}\n\n\/*\n\nskill={\n    trigger:{player:"phaseJieshuBegin"},\n    frequent:true,\n    content:function(){\n        player.draw()\n    }\n}\n\n\n*\/';
                                if (page.fromchar == 'add') {
                                    page.fromchar = true;
                                }
                            }

                            newSkill = ui.create.div('.new_character.new_skill', page);
                            page.newSkill = newSkill;
                            var namenode = ui.create.div('.config', '&lt;input class="new_name" type="text" style="width:120px">&lt;/input>', newSkill);
                            var descnode = ui.create.div('.config', '&lt;input class="new_description" type="text" style="width:120px">&lt;/input>', newSkill);
                            namenode.querySelector('input.new_name').onblur = updateButton;
                            var commandline = ui.create.div('.config', newSkill);
                            var editbutton = document.createElement('button');
                            editbutton.innerHTML = '';
                            commandline.appendChild(editbutton);
                            editbutton.onclick = function () {
                                var node = container;
                                ui.window.classList.add('shortcutpaused');
                                ui.window.classList.add('systempaused');
                                window.saveNonameInput = saveInput;
                                if (node.aced) {
                                    ui.window.appendChild(node);
                                    node.editor.setValue(node.code, 1);
                                }
                                else if (lib.device == 'ios') {
                                    ui.window.appendChild(node);
                                    if (!node.textarea) {
                                        var textarea = document.createElement('textarea');
                                        editor.appendChild(textarea);
                                        node.textarea = textarea;
                                        lib.setScroll(textarea);
                                    }
                                    node.textarea.value = node.code;
                                }
                                else {
                                    var aceReady = function () {
                                        ui.window.appendChild(node);
                                        var mirror = window.CodeMirror(editor, {
                                            value: node.code,
                                            mode: "javascript",
                                            lineWrapping: !lib.config.touchscreen &amp;&amp; lib.config.mousewheel,
                                            lineNumbers: true,
                                            indentUnit: 4,
                                            autoCloseBrackets: true,
                                            theme: 'mdn-like'
                                        });
                                        lib.setScroll(editor.querySelector('.CodeMirror-scroll'));
                                        node.aced = true;
                                        node.editor = mirror;
                                    }
                                    if (!window.ace) {
                                        lib.init.js(lib.assetURL + 'game', 'codemirror', aceReady);
                                        lib.init.css(lib.assetURL + 'layout/default', 'codemirror');
                                    }
                                    else {
                                        aceReady();
                                    }
                                }
                            }

                            var container = ui.create.div('.popup-container.editor');
                            var editorpage = ui.create.div(container);
                            var discardConfig = ui.create.div('.editbutton', '', editorpage, function () {
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete(null);
                                delete window.saveNonameInput;
                            });
                            var saveInput = function () {
                                var code;
                                if (container.editor) {
                                    code = container.editor.getValue();
                                }
                                else if (container.textarea) {
                                    code = container.textarea.value;
                                }
                                try {
                                    var skill = null;
                                    eval(code);
                                    if (skill == null || typeof skill != 'object') {
                                        throw ('err');
                                    }
                                }
                                catch (e) {
                                    if (e == 'err') {
                                        alert('');
                                    }
                                    else {
                                        alert('' + e + '')
                                    }
                                    return;
                                }
                                dash3.link.classList.add('active');
                                ui.window.classList.remove('shortcutpaused');
                                ui.window.classList.remove('systempaused');
                                container.delete();
                                container.code = code;
                                delete window.saveNonameInput;
                            };
                            var saveConfig = ui.create.div('.editbutton', '', editorpage, saveInput);
                            var editor = ui.create.div(editorpage);
                            container.code = 'skill={\n    \n}\n\n\/*\n\nskill={\n    trigger:{player:"phaseJieshuBegin"},\n    frequent:true,\n    content:function(){\n        player.draw()\n    }\n}\n\n\n*\/';

                            var citebutton = document.createElement('button');
                            citebutton.innerHTML = '';
                            commandline.appendChild(citebutton);
                            citebutton.onclick = function () {
                                editbutton.style.display = 'none';
                                citebutton.style.display = 'none';
                                selectname.style.display = '';
                                skillopt.style.display = '';
                                addSkillButton.style.display = '';
                                cancelSkillButton.style.display = '';
                            }

                            var list = [];
                            for (var i in lib.character) {
                                if (lib.character[i][3].length) {
                                    list.push([i, lib.translate[i]]);
                                }
                            }
                            list.sort(function (a, b) {
                                a = a[0]; b = b[0];
                                var aa = a, bb = b;
                                if (aa.indexOf('_') != -1) {
                                    aa = aa.slice(aa.indexOf('_') + 1);
                                }
                                if (bb.indexOf('_') != -1) {
                                    bb = bb.slice(bb.indexOf('_') + 1);
                                }
                                if (aa != bb) {
                                    return aa > bb ? 1 : -1;
                                }
                                return a > b ? 1 : -1;
                            });
                            list.push(['others', '']);
                            var list2 = [];
                            var skills = lib.character[list[0][0]][3];
                            for (var i = 0; i &lt; skills.length; i++) {
                                list2.push([skills[i], lib.translate[skills[i]]]);
                            }
                            var selectname = ui.create.selectlist(list, list[0], commandline);
                            var list3 = [];
                            for (var i in lib.skill) {
                                if (i != 'global' &amp;&amp; !get.is.empty(lib.skill[i]) &amp;&amp; !lib.skilllist.contains(i)) {
                                    list3.push(i);
                                }
                            }
                            list3.sort(function (a, b) {
                                return a > b ? 1 : -1;
                            });
                            selectname.onchange = function () {
                                var skills;
                                skillopt.innerHTML = '';
                                if (this.value == 'others') {
                                    skills = list3;
                                    for (var i = 0; i &lt; skills.length; i++) {
                                        var option = document.createElement('option');
                                        option.value = skills[i];
                                        option.innerHTML = skills[i];
                                        skillopt.appendChild(option);
                                    }
                                }
                                else {
                                    skills = lib.character[this.value][3];
                                    for (var i = 0; i &lt; skills.length; i++) {
                                        var option = document.createElement('option');
                                        option.value = skills[i];
                                        option.innerHTML = lib.translate[skills[i]];
                                        skillopt.appendChild(option);
                                    }
                                }
                            };
                            selectname.style.display = 'none';
                            selectname.style.maxWidth = '80px';
                            var skillopt = ui.create.selectlist(list2, list2[0], commandline);
                            skillopt.style.display = 'none';
                            skillopt.style.maxWidth = '60px';
                            var addSkillButton = document.createElement('button');
                            addSkillButton.style.display = 'none';
                            addSkillButton.innerHTML = '';
                            commandline.appendChild(addSkillButton);
                            addSkillButton.onclick = function () {
                                editbutton.style.display = '';
                                citebutton.style.display = '';
                                selectname.style.display = 'none';
                                skillopt.style.display = 'none';
                                addSkillButton.style.display = 'none';
                                cancelSkillButton.style.display = 'none';
                                container.code = 'skill=' + get.stringify(lib.skill[skillopt.value]);
                                editbutton.onclick.call(editbutton);
                                if (lib.translate[skillopt.value + '_info']) {
                                    newSkill.querySelector('input.new_description').value = lib.translate[skillopt.value + '_info'];
                                }
                            }
                            var cancelSkillButton = document.createElement('button');
                            cancelSkillButton.style.display = 'none';
                            cancelSkillButton.innerHTML = '';
                            commandline.appendChild(cancelSkillButton);
                            cancelSkillButton.onclick = function () {
                                editbutton.style.display = '';
                                citebutton.style.display = '';
                                selectname.style.display = 'none';
                                skillopt.style.display = 'none';
                                addSkillButton.style.display = 'none';
                                cancelSkillButton.style.display = 'none';
                            }

                            var editnode = ui.create.div('.menubutton.large.new_skill.disabled', '', function () {
                                var name = page.querySelector('input.new_name').value;
                                if (!name) {
                                    alert('\nid+|+id');
                                    return;
                                }
                                name = name.split('|');
                                var translate = name[1] || name[0];
                                var info = page.querySelector('input.new_description').value;
                                name = name[0];
                                if (currentButton) {
                                    if (currentButton.link != name) {
                                        if (lib.skill[name] || page.content.pack.skill[name]) {
                                            alert('\nid+|+id');
                                            return;
                                        }
                                        delete page.content.pack.skill[currentButton.link];
                                        delete page.content.pack.translate[currentButton.link];
                                        delete page.content.pack.translate[currentButton.link + '_info'];
                                        currentButton.link = name;
                                    }
                                }
                                else {
                                    if (lib.skill[name] || page.content.pack.skill[name]) {
                                        alert('\nid+|+id');
                                        return;
                                    }
                                }
                                page.content.pack.translate[name] = translate;
                                page.content.pack.translate[name + '_info'] = info;
                                try {
                                    var skill = null;
                                    eval(container.code);
                                    if (skill == null || typeof skill != 'object') {
                                        throw ('err');
                                    }
                                    page.content.pack.skill[name] = skill;
                                }
                                catch (e) {
                                    page.content.pack.skill[name] = {};
                                }
                                dash1.selectname.value = 'current_extension';
                                dash1.selectname.onchange.call(dash1.selectname);
                                if (this.innerHTML == '') {
                                    createButton(name);
                                    if (page.fromchar == 'add') {
                                        ui.create.templayer();
                                        page.hide();
                                        dash1.show();
                                        dash1.skillopt.value = name;
                                        dash1.addSkillButton.onclick();
                                        delete page.fromchar;
                                    }
                                }
                                else if (currentButton) {
                                    currentButton.innerHTML = translate;
                                }
                                resetEditor();
                                dash3.link.classList.add('active');
                                dash1.updateSkill();
                            }, newSkill);
                            var delnode = ui.create.div('.menubutton.large.new_card_delete', '', editnode.parentNode, function () {
                                if (this.innerHTML == '') {
                                    this.button.remove();
                                    var name = this.button.link;
                                    delete dash3.content.pack.skill[name];
                                    delete dash3.content.pack.translate[name];
                                    delete dash3.content.pack.translate[name + '_info'];
                                    dash3.link.classList.add('active');
                                    if (get.is.empty(dash3.content.pack.skill)) {
                                        dash1.selectname.value = dash1.selectname.childNodes[1].value;
                                    }
                                    dash1.selectname.onchange.call(dash1.selectname);
                                    dash1.updateSkill();
                                    resetEditor();
                                }
                                else if (page.fromchar == 'add') {
                                    ui.create.templayer();
                                    page.hide();
                                    dash1.show();
                                    delete page.fromchar;
                                    setTimeout(resetEditor, 600);
                                }
                                else {
                                    resetEditor();
                                }
                            });

                            page.content = {
                                pack: {
                                    skill: {},
                                    translate: {}
                                },
                                audio: {}
                            };
                            return page;
                        }());
                        var dash4 = (function () {
                            var page = ui.create.div('.hidden.menu-buttons');
                            ui.create.div('.config.more.margin-bottom', '&lt;div style="transform:none;margin-right:3px">&lt;/div>', page, function () {
                                ui.create.templayer();
                                page.hide();
                                pageboard.show();
                            });
                            page.reset = function (name) {
                                page.content = {};
                                if (lib.extensionPack[name]) {
                                    for (var i in dashes) {
                                        dashes[i].node.code = '';
                                    }
                                    for (var i in lib.extensionPack[name].code) {
                                        switch (typeof lib.extensionPack[name].code[i]) {
                                            case 'function': page.content[i] = lib.extensionPack[name].code[i].toString(); break;
                                            case 'object': page.content[i] = i + '=' + get.stringify(lib.extensionPack[name].code[i]); break;
                                        }
                                    }
                                    for (var i in page.content) {
                                        dashes[i].node.code = page.content[i] || '';
                                    }
                                }
                                else {
                                    dashes.content.node.code = 'function(config,pack){\n    \n}\n\n\/*\n\n12\n\n*\/';
                                    dashes.precontent.node.code = 'function(){\n    \n}\n\n\/*\n\n\n\n*\/';
                                    dashes.config.node.code = 'config={\n    \n}\n\n\/*\n\nconfig={\n    switcher_example:{\n    name:"",\n        init:"3",\n        item:{"1":"","2":"","3":""}\n    },\n    toggle_example:{\n        name:"",\n        init:true\n    }\n}\n{switcher_example:"3",toggle_example:true}\n\n*\/';
                                    dashes.help.node.code = 'help={\n    \n}\n\n\/*\n\nhelp={\n    "":"&lt;ul>&lt;li>1-1&lt;li>1-2&lt;/ul>&lt;ol>&lt;li>2-1&lt;li>2-2&lt;/ul>"\n}\n\n\n*\/';
                                }
                            };
                            var dashes = {};
                            var createCode = function (str1, str2, sub, func, link, str) {
                                var dash = ui.create.div('.menubutton.large.dashboard');
                                dashes[link] = dash;
                                sub.appendChild(dash);
                                dash.listen(func);
                                dash.link = link;
                                ui.create.div('', str1, dash);
                                ui.create.div('', str2, dash);
                                var container = ui.create.div('.popup-container.editor');
                                var editorpage = ui.create.div(container);
                                var discardConfig = ui.create.div('.editbutton', '', editorpage, function () {
                                    ui.window.classList.remove('shortcutpaused');
                                    ui.window.classList.remove('systempaused');
                                    container.delete(null);
                                    delete window.saveNonameInput;
                                });
                                var saveInput = function () {
                                    var code;
                                    if (container.editor) {
                                        code = container.editor.getValue();
                                    }
                                    else if (container.textarea) {
                                        code = container.textarea.value;
                                    }
                                    try {
                                        if (link == 'content' || link == 'precontent') {
                                            var func = null;
                                            eval('func=' + code);
                                            if (typeof func != 'function') {
                                                throw ('err');
                                            }
                                        }
                                        else if (link == 'config') {
                                            var config = null;
                                            eval(code);
                                            if (config == null || typeof config != 'object') {
                                                throw ('err');
                                            }
                                        }
                                        else if (link == 'help') {
                                            var help = null;
                                            eval(code);
                                            if (help == null || typeof help != 'object') {
                                                throw ('err');
                                            }
                                        }
                                    }
                                    catch (e) {
                                        if (e == 'err') {
                                            alert('');
                                        }
                                        else {
                                            alert('' + e + '')
                                        }
                                        return;
                                    }
                                    dash4.link.classList.add('active');
                                    ui.window.classList.remove('shortcutpaused');
                                    ui.window.classList.remove('systempaused');
                                    container.delete();
                                    container.code = code;
                                    page.content[link] = code;
                                    delete window.saveNonameInput;
                                };
                                var saveConfig = ui.create.div('.editbutton', '', editorpage, saveInput);
                                var editor = ui.create.div(editorpage);
                                container.code = str;
                                dash.editor = editor;
                                dash.node = container;
                                dash.saveInput = saveInput;
                                page.content[link] = str;
                            };
                            var clickCode = function () {
                                var node = this.node;
                                ui.window.classList.add('shortcutpaused');
                                ui.window.classList.add('systempaused');
                                window.saveNonameInput = this.saveInput;
                                if (node.aced) {
                                    ui.window.appendChild(node);
                                    node.editor.setValue(node.code, 1);
                                }
                                else if (lib.device == 'ios') {
                                    ui.window.appendChild(node);
                                    if (!node.textarea) {
                                        var textarea = document.createElement('textarea');
                                        this.editor.appendChild(textarea);
                                        node.textarea = textarea;
                                        lib.setScroll(textarea);
                                    }
                                    node.textarea.value = node.code;
                                }
                                else {
                                    var editor = this.editor;
                                    var aceReady = function () {
                                        ui.window.appendChild(node);
                                        var mirror = window.CodeMirror(editor, {
                                            value: node.code,
                                            mode: "javascript",
                                            lineWrapping: !lib.config.touchscreen &amp;&amp; lib.config.mousewheel,
                                            lineNumbers: true,
                                            indentUnit: 4,
                                            autoCloseBrackets: true,
                                            theme: 'mdn-like'
                                        });
                                        lib.setScroll(editor.querySelector('.CodeMirror-scroll'));
                                        node.aced = true;
                                        node.editor = mirror;
                                    }
                                    if (!window.ace) {
                                        lib.init.js(lib.assetURL + 'game', 'codemirror', aceReady);
                                        lib.init.css(lib.assetURL + 'layout/default', 'codemirror');
                                    }
                                    else {
                                        aceReady();
                                    }
                                }
                            };
                            page.content = {}
                            createCode('', '', page, clickCode, 'content', 'function(config,pack){\n    \n}\n\n\/*\n\n12\n\n*\/');
                            createCode('', '', page, clickCode, 'precontent', 'function(){\n    \n}\n\n\/*\n\n\n\n*\/');
                            createCode('', '', page, clickCode, 'config', 'config={\n    \n}\n\n\/*\n\nconfig={\n    switcher_example:{\n        name:"",\n        init:"3",\n           item:{"1":"","2":"","3":""}\n    },\n    toggle_example:{\n        name:"",\n        init:true\n    }\n}\n{switcher_example:"3",toggle_example:true}\n\n*\/');
                            createCode('', '', page, clickCode, 'help', 'help={\n    \n}\n\n\/*\n\nhelp={\n    "":"&lt;ul>&lt;li>1-1&lt;li>1-2&lt;/ul>&lt;ol>&lt;li>2-1&lt;li>2-2&lt;/ul>"\n}\n\n\n*\/');

                            return page;
                        }());
                        createDash('', '', dash1);
                        createDash('', '', dash2);
                        createDash('', '', dash3);
                        createDash('', '', dash4);
                    }());
                    (function () {
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.link = page;
                        node.mode = 'get';
                        page.listen(function () {
                            if (!page.currenttimeout) {
                                var active = page.querySelector('.videonode.current');
                                if (active) {
                                    active.classList.remove('current');
                                }
                            }
                        });
                        var importextensionexpanded = false;
                        page.style.paddingBottom = '10px';
                        var importExtension;
                        var extensionnode = ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>', page, function () {
                            if (importextensionexpanded) {
                                this.classList.remove('on');
                                importExtension.style.display = 'none';
                            }
                            else {
                                this.classList.add('on');
                                importExtension.style.display = '';
                            }
                            importextensionexpanded = !importextensionexpanded;
                        });
                        importExtension = ui.create.div('.new_character.export.import', page);
                        importExtension.style.marginLeft = '5px';
                        importExtension.style.marginTop = '5px';
                        importExtension.style.marginBottom = '5px';
                        importExtension.style.display = 'none';
                        importExtension.style.width = '100%';
                        importExtension.style.textAlign = 'left';
                        ui.create.div('', '&lt;input type="file" accept="application/zip" style="width:153px">&lt;button>&lt;/button>', importExtension);

                        var extensionURL;
                        var source = lib.config.extension_sources, index = lib.config.extension_source;
                        if (source &amp;&amp; source[index]) extensionURL = source[index];
                        else extensionURL = lib.updateURL.replace(/noname/g, 'noname-extension') + '/master/';

                        var reloadnode = ui.create.div('.config.toggle.pointerdiv', '', page, game.reload);
                        reloadnode.style.display = 'none';
                        var placeholder = ui.create.div('.config.toggle', page);
                        placeholder.style.height = 0;
                        placeholder.style.marginTop = '5px';

                        importExtension.firstChild.lastChild.onclick = function () {
                            var fileToLoad = this.previousSibling.files[0];
                            if (fileToLoad) {
                                var fileReader = new FileReader();
                                fileReader.onload = function (fileLoadedEvent) {
                                    var finishLoad = function () {
                                        extensionnode.innerHTML = '3';
                                        setTimeout(function () {
                                            extensionnode.innerHTML = '2';
                                            setTimeout(function () {
                                                extensionnode.innerHTML = '1';
                                                setTimeout(game.reload, 1000);
                                            }, 1000);
                                        }, 1000);
                                    };
                                    var data = fileLoadedEvent.target.result;
                                    if (game.importExtension(data, finishLoad) !== false) {
                                        importExtension.style.display = 'none';
                                    }
                                };
                                fileReader.readAsArrayBuffer(fileToLoad, "UTF-8");
                            }
                        }

                        var clickExtension = function () {
                            var active = this.parentNode.querySelector('.videonode.current');
                            if (active &amp;&amp; active != this) {
                                active.classList.remove('current');
                            }
                            this.classList.add('current');
                            clearTimeout(page.currenttimeout);
                            page.currenttimeout = setTimeout(function () {
                                delete page.currenttimeout;
                            }, 200);
                        };
                        var downloadExtension = function (e) {
                            if ((this.innerHTML != '' &amp;&amp; this.innerHTML != '') || !window.JSZip) return;
                            this.classList.remove('update');
                            if (e) {
                                e.stopPropagation();
                            }
                            node.updated = true;
                            var that = this;
                            var list = [];
                            var size = parseFloat(this.info.size) || 0;
                            if (size) {
                                if (this.info.size.indexOf('MB') != -1) {
                                    size *= 1024 * 1024;
                                }
                                else if (this.info.size.indexOf('KB') != -1) {
                                    size *= 1024;
                                }
                            }

                            this.innerHTML = '&lt;span>&lt;/span>&lt;div>&lt;/div>';
                            this.classList.add('nopointer');
                            this.classList.add('button-downloading');
                            var progress = ui.create.div('.button-progress', this);
                            ui.create.div(progress);
                            var url = extensionURL + this.info.name + '.zip';
                            var onprogress = function (byte, total) {
                                if (total) {
                                    size = total;
                                }
                                if (byte == -1) {
                                    byte = size;
                                }
                                progress.firstChild.style.width = Math.round(100 * byte / size) + '%';
                            };
                            var files = this.info.files || [];
                            for (var i = 0; i &lt; files.length; i++) {
                                files[i] = 'extension/' + that.info.name + '/' + files[i];
                            }
                            game.checkFileList(files, function () {
                                files.unshift('extension/' + that.info.name + '/extension.js');
                                for (var i = 0; i &lt; files.length; i++) {
                                    files[i] = extensionURL + that.info.name + '/' + files[i].slice(10 + that.info.name.length + 1);
                                }
                                var n1 = 0, n2 = files.length;
                                game.multiDownload(files, function () {
                                    n1++;
                                    onprogress(n1, n2);
                                }, function (e) {
                                    game.print('' + e.source);
                                }, function () {
                                    onprogress(-1);
                                    _status.importingExtension = true;
                                    window.game = game;
                                    lib.init.js(lib.assetURL + 'extension/' + that.info.name, 'extension', function () {
                                        if (!lib.config.dev) delete window.game;
                                        if (game.importedPack) {
                                            var extname = game.importedPack.name;
                                            if (lib.config.extensions.contains(extname)) {
                                                game.removeExtension(extname, true);
                                            }
                                            lib.config.extensions.add(extname);
                                            game.saveConfig('extensions', lib.config.extensions);
                                            game.saveConfig('extension_' + extname + '_enable', true);
                                            game.saveConfig('extension_' + extname + '_version', that.info.version);
                                            for (var i in game.importedPack.config) {
                                                if (game.importedPack.config[i] &amp;&amp; game.importedPack.config[i].hasOwnProperty('init')) {
                                                    game.saveConfig('extension_' + extname + '_' + i, game.importedPack.config[i].init);
                                                }
                                            }
                                            reloadnode.style.display = '';
                                            that.childNodes[0].innerHTML = '';
                                            that.childNodes[1].innerHTML = '';
                                            that.classList.remove('active');
                                            that.classList.remove('highlight');
                                            delete game.importedPack;
                                        }
                                        else {
                                            that.innerHTML = '';
                                            that.classList.add('nopointer');
                                        }
                                        _status.importingExtension = false;
                                    }, function () {
                                        that.innerHTML = '';
                                        that.classList.add('nopointer');
                                        _status.importingExtension = false;
                                    });
                                }, function (current) {
                                    return 'extension/' + current.slice(extensionURL.length);
                                });
                            });
                        };

                        node.update = function () {
                            if (this.updated) return;
                            if (!window.JSZip) {
                                lib.init.js(lib.assetURL + 'game', 'jszip');
                            }
                            var toremove = [];
                            for (var i = 0; i &lt; page.childElementCount; i++) {
                                if (page.childNodes[i].classList.contains('menubutton') || page.childNodes[i].classList.contains('loading')) {
                                    toremove.push(page.childNodes[i]);
                                }
                            }
                            for (var i = 0; i &lt; toremove.length; i++) {
                                toremove[i].remove();
                            }

                            var loading = ui.create.div('.loading.config.toggle', '...', page);
                            var loaded = function (list) {
                                var list = [];
                                var extension = window.extension;
                                for (var i in extension) {
                                    extension[i].name = i;
                                    list.push(extension[i]);
                                }
                                list.randomSort();
                                delete window.extension;
                                loading.style.display = 'none';
                                for (var i = 0; i &lt; list.length; i++) {
                                    var node = ui.create.div('.videonode.menubutton.extension.large', page, clickExtension);
                                    ui.create.div('.caption', list[i].name, node);
                                    ui.create.div('.text.author', '' + list[i].author + '&lt;span>(' + list[i].size + ')&lt;/span>', node);
                                    ui.create.div('.text', list[i].intro, node);
                                    var download = ui.create.div('.menubutton.text.active', '', node.firstChild);
                                    if (game.download) {
                                        if (list[i].netdisk) {
                                            var linknode = ui.create.div('.text', node);
                                            ui.create.node('span.hrefnode', '', function () {
                                                game.open(this.link);
                                            }, linknode).link = list[i].netdisk;
                                            if (list[i].forum) {
                                                ui.create.node('span', linknode).style.marginRight = '10px';
                                                ui.create.node('span.hrefnode', '', function () {
                                                    game.open(this.link);
                                                }, linknode).link = list[i].forum;
                                            }
                                        }
                                        else if (list[i].forum) {
                                            var linknode = ui.create.div('.text', node);
                                            ui.create.node('span.hrefnode', '', function () {
                                                game.open(this.link);
                                            }, linknode).link = list[i].forum;
                                        }
                                        download.listen(downloadExtension);
                                        if (lib.config.extensions.contains(list[i].name)) {
                                            download.classList.remove('active');
                                            if (lib.extensionPack[list[i].name] &amp;&amp; lib.extensionPack[list[i].name].version == list[i].version) {
                                                download.classList.add('transparent2');
                                                download.classList.remove('active');
                                                download.innerHTML = '';
                                            }
                                            else if (lib.config['extension_' + list[i].name + '_version'] != list[i].version) {
                                                download.innerHTML = '';
                                                download.classList.add('highlight');
                                                download.classList.add('update');
                                            }
                                            else {
                                                download.classList.add('transparent2');
                                                download.classList.remove('active');
                                                download.innerHTML = '';
                                            }
                                        }
                                        download.info = list[i];
                                    }
                                    else {
                                        if (list[i].forum) {
                                            var linknode = ui.create.div('.text', node);
                                            ui.create.node('span', linknode);
                                            ui.create.node('span.hrefnode', '', function () {
                                                game.open(this.link);
                                            }, linknode).link = list[i].forum;
                                        }
                                        download.listen(function () {
                                            game.open(this.link);
                                        });
                                        download.link = list[i].netdisk;
                                    }
                                }
                            };
                            window.extension = {};
                            if (game.download) {
                                lib.init.req(extensionURL + 'catalog.js', function () {
                                    try {
                                        eval(this.responseText);
                                        // if(!window.noname_extension_list){
                                        //     throw('err');
                                        // }
                                    }
                                    catch (e) {
                                        delete window.extension;
                                        loading.innerHTML = '';
                                        return;
                                    }
                                    loaded();
                                }, function () {
                                    delete window.extension;
                                    loading.innerHTML = '';
                                });
                            }
                            else {
                                lib.init.js(extensionURL.replace(/raw\.githubusercontent\.com/, 'rawgit.com') + 'catalog.js', null, loaded, function () {
                                    delete window.extension;
                                    loading.innerHTML = '';
                                });
                            }
                        };
                    }());
                    var active = start.firstChild.querySelector('.active');
                    if (!active) {
                        active = start.firstChild.firstChild;
                        active.classList.add('active');
                    }
                    rightPane.appendChild(active.link);
                    updateNodes();
                }());

                (function () {
                    if (connectMenu) return;
                    var start = menuxpages.shift();
                    var rightPane = start.lastChild;
                    var cheatButton = ui.create.div('.menubutton.round.highlight', '', start);
                    cheatButton.style.display = 'none';
                    var runButton = ui.create.div('.menubutton.round.highlight', '', start);
                    runButton.style.display = 'none';
                    var clearButton = ui.create.div('.menubutton.round.highlight', '', start);
                    clearButton.style.display = 'none';
                    clearButton.style.left = '275px';
                    var playButton = ui.create.div('.menubutton.round.highlight.hidden', '', start);
                    playButton.style.display = 'none';
                    playButton.style.left = '215px';
                    playButton.style.transition = 'opacity 0.3s';
                    var deleteButton = ui.create.div('.menubutton.round.highlight.hidden', '', start);
                    deleteButton.style.display = 'none';
                    deleteButton.style.left = '275px';
                    deleteButton.style.transition = 'opacity 0.3s';
                    var saveButton = ui.create.div('.menubutton.round.highlight.hidden', '', start);
                    saveButton.style.display = 'none';
                    saveButton.style.transition = 'opacity 0.3s';


                    var clickMode = function () {
                        if (this.classList.contains('off')) return;
                        var active = this.parentNode.querySelector('.active');
                        if (active === this) {
                            return;
                        }
                        if (active) {
                            active.classList.remove('active');
                            active.link.remove();
                        }
                        active = this;
                        this.classList.add('active');
                        rightPane.appendChild(this.link);
                        if (this.type == 'cheat') {
                            cheatButton.style.display = '';
                        }
                        else {
                            cheatButton.style.display = 'none';
                        }
                        if (this.type == 'cmd') {
                            runButton.style.display = '';
                            clearButton.style.display = '';
                        }
                        else {
                            runButton.style.display = 'none';
                            clearButton.style.display = 'none';
                        }
                        if (this.type == 'video') {
                            playButton.style.display = '';
                            saveButton.style.display = '';
                            deleteButton.style.display = '';
                        }
                        else {
                            playButton.style.display = 'none';
                            saveButton.style.display = 'none';
                            deleteButton.style.display = 'none';
                        }
                    };

                    ui.click.consoleMenu = function () {
                        ui.click.menuTab('');
                        clickMode.call(ui.commandnode);
                    };
                    (function () {
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.link = page;
                        page.classList.add('menu-help');
                        var ul = document.createElement('ul');
                        var li1 = document.createElement('li');
                        var li2 = document.createElement('li');
                        var li3 = document.createElement('li');
                        var trimurl = function (str) {
                            if (str == lib.updateURLS.github) {
                                return 'GitHub';
                            }
                            if (str == lib.updateURLS.coding) {
                                return 'Coding';
                            }
                            var index;
                            index = str.indexOf('://');
                            if (index != -1) {
                                str = str.slice(index + 3);
                            }
                            index = str.indexOf('/');
                            if (index != -1) {
                                str = str.slice(0, index);
                            }
                            if (str.length > 15) {
                                var list = str.split('.');
                                if (list.length > 1) {
                                    list.shift();
                                }
                                str = list[0];
                                for (var i = 1; i &lt; list.length; i++) {
                                    str += '.' + list[i];
                                }
                            }
                            if (str.length > 15) {
                                var list = str.split('.');
                                if (list.length > 1) {
                                    list.pop();
                                }
                                str = list[0];
                                for (var i = 1; i &lt; list.length; i++) {
                                    str += '.' + list[i];
                                }
                            }
                            return str;
                        }
                        li1.innerHTML = '' + lib.version + '&lt;p style="margin-top:8px;white-space:nowrap">&lt;/p>';
                        li2.innerHTML = '' + (lib.config.asset_version || '') + '&lt;p style="margin-top:8px">&lt;/p>';
                        li3.innerHTML = '&lt;span>' + trimurl(lib.config.updateURL || lib.updateURL) + '&lt;/span>&lt;p style="margin-top:8px">&lt;/p>';
                        li3.style.whiteSpace = 'nowrap';
                        li3.style.display = 'none';// coding

                        var button1, button2, button3, button4, button5;

                        game.checkForUpdate = function (forcecheck, dev) {
                            if (!dev &amp;&amp; button1.disabled) {
                                return;
                            }
                            else if (dev &amp;&amp; button3.disabled) {
                                return;
                            }
                            else if (!game.download) {
                                // alert('');
                                return;
                            }
                            else {
                                if (dev) {
                                    button3.innerHTML = '';
                                }
                                else {
                                    button1.innerHTML = '';
                                }
                                button3.disabled = true;
                                button1.disabled = true;

                                var goupdate = function (files, update) {
                                    lib.version = update.version;
                                    if (update.dev &amp;&amp; !lib.config.debug) {
                                        dev = 'nodev';
                                    }
                                    lib.init.req('game/source.js', function () {
                                        try {
                                            eval(this.responseText);
                                            if (!window.noname_source_list) {
                                                throw ('err');
                                            }
                                        }
                                        catch (e) {
                                            alert('');
                                            console.log(e);
                                            return;
                                        }

                                        var updates = window.noname_source_list;
                                        delete window.noname_source_list;
                                        if (Array.isArray(files)) {
                                            files.add('game/update.js');
                                            var files2 = [];
                                            for (var i = 0; i &lt; files.length; i++) {
                                                var str = files[i].indexOf('*');
                                                if (str != -1) {
                                                    str = files[i].slice(0, str);
                                                    files.splice(i--, 1);
                                                    for (var j = 0; j &lt; updates.length; j++) {
                                                        if (updates[j].indexOf(str) == 0) {
                                                            files2.push(updates[j]);
                                                        }
                                                    }
                                                }
                                            }
                                            updates = files.concat(files2);
                                        }
                                        for (var i = 0; i &lt; updates.length; i++) {
                                            if (updates[i].indexOf('theme/') == 0 &amp;&amp; updates[i].indexOf('.css') == -1) {
                                                updates.splice(i--, 1);
                                            }
                                            else if (updates[i].indexOf('node_modules/') == 0 &amp;&amp; !update.node) {
                                                updates.splice(i--, 1);
                                            }
                                        }

                                        if (!ui.arena.classList.contains('menupaused')) {
                                            ui.click.configMenu();
                                            ui.click.menuTab('');
                                        }
                                        var p = button1.parentNode;
                                        button1.remove();
                                        button3.remove();
                                        var span = document.createElement('span');
                                        var n1 = 0;
                                        var n2 = updates.length;
                                        span.innerHTML = '' + n1 + '/' + n2 + '';
                                        p.appendChild(span);
                                        var finish = function () {
                                            span.innerHTML = '' + n1 + '/' + n2 + '';
                                            p.appendChild(document.createElement('br'));
                                            var button = document.createElement('button');
                                            button.innerHTML = '';
                                            button.onclick = game.reload;
                                            button.style.marginTop = '8px';
                                            p.appendChild(button);
                                        }
                                        game.multiDownload(updates, function () {
                                            n1++;
                                            span.innerHTML = '' + n1 + '/' + n2 + '';
                                        }, function (e) {
                                            game.print('' + e.source);
                                        }, function () {
                                            setTimeout(finish, 500);
                                        }, null, dev);
                                    }, function () {
                                        alert('');
                                    }, true);
                                };

                                lib.init.req('game/update.js', function () {
                                    try {
                                        eval(this.responseText);
                                        if (!window.noname_update) {
                                            throw ('err');
                                        }
                                    }
                                    catch (e) {
                                        alert('');
                                        console.log(e);
                                        return;
                                    }

                                    var update = window.noname_update;
                                    delete window.noname_update;
                                    if (forcecheck === false) {
                                        if (update.version == lib.config.check_version) {
                                            return;
                                        }
                                    }
                                    game.saveConfig('check_version', update.version);
                                    var goon = true;
                                    if (!dev) {
                                        if (update.version.indexOf('beta') != -1 || update.version == lib.version) {
                                            goon = false;
                                        }
                                    }
                                    if (goon) {
                                        var files = null;
                                        var version = lib.version;
                                        if (Array.isArray(update.dev) &amp;&amp; dev) {
                                            files = update.dev;
                                        }
                                        else if (Array.isArray(update.files) &amp;&amp; update.update &amp;&amp; !dev) {
                                            var version1 = version.split('.');
                                            var version2 = update.update.split('.');
                                            for (var i = 0; i &lt; version1.length &amp;&amp; i &lt; version2.length; i++) {
                                                if (version2[i] > version1[i]) {
                                                    files = false; break;
                                                }
                                                else if (version1[i] > version2[i]) {
                                                    files = update.files.slice(0); break;
                                                }
                                            }
                                            if (files === null) {
                                                if (version1.length >= version2.length) {
                                                    files = update.files.slice(0);
                                                }
                                            }
                                        }
                                        var str;
                                        if (dev) {
                                            str = ''
                                        }
                                        else {
                                            str = '' + update.version + '';
                                        }
                                        if (navigator.notification &amp;&amp; navigator.notification.confirm) {
                                            var str2;
                                            if (dev) {
                                                str2 = str;
                                                str = '';
                                            }
                                            else {
                                                str2 = update.changeLog[0];
                                                for (var i = 1; i &lt; update.changeLog.length; i++) {
                                                    if (update.changeLog[i].indexOf('://') == -1) {
                                                        str2 += '' + update.changeLog[i];
                                                    }
                                                }
                                            }
                                            navigator.notification.confirm(
                                                str2,
                                                function (index) {
                                                    if (index == 1) {
                                                        goupdate(files, update);
                                                    }
                                                    else {
                                                        button1.disabled = false;
                                                        button1.innerHTML = '';
                                                        button3.disabled = false;
                                                        button3.innerHTML = '';
                                                    }
                                                },
                                                str,
                                                ['', '']
                                            );
                                        }
                                        else {
                                            if (confirm(str)) {
                                                goupdate(files, update);
                                            }
                                            else {
                                                button1.disabled = false;
                                                button1.innerHTML = '';
                                                button3.disabled = false;
                                                button3.innerHTML = '';
                                            }
                                        }
                                    }
                                    else {
                                        alert('');
                                        button1.disabled = false;
                                        button1.innerHTML = '';
                                        button3.disabled = false;
                                        button3.innerHTML = '';
                                    }
                                }, function () {
                                    if (forcecheck === false) {
                                        return;
                                    }
                                    alert('');
                                    button1.disabled = false;
                                    button1.innerHTML = '';
                                    button3.disabled = false;
                                    button3.innerHTML = '';
                                }, true);
                            }
                        };
                        game.checkForAssetUpdate = function (type) {
                            if (button2.disabled) {
                                return;
                            }
                            else if (game.download) {
                                button2.innerHTML = '';
                                button2.disabled = true;
                                lib.init.req('game/asset.js', function () {
                                    try {
                                        eval(this.responseText);
                                        if (!window.noname_asset_list || !window.noname_skin_list) {
                                            throw ('err');
                                        }
                                    }
                                    catch (e) {
                                        alert('');
                                        console.log(e);
                                        return;
                                    }

                                    var updates = window.noname_asset_list;
                                    delete window.noname_asset_list;
                                    var skins = window.noname_skin_list;
                                    delete window.noname_skin_list;
                                    var asset_version = updates.shift();

                                    var skipcharacter = [], skipcard = ['tiesuo_mark'];
                                    if (!lib.config.asset_full) {
                                        for (var i = 0; i &lt; lib.config.all.sgscharacters.length; i++) {
                                            var pack = lib.characterPack[lib.config.all.sgscharacters[i]];
                                            for (var j in pack) {
                                                skipcharacter.add(j);
                                            }
                                        }
                                        for (var i = 0; i &lt; lib.config.all.sgscards.length; i++) {
                                            var pack = lib.cardPack[lib.config.all.sgscards[i]];
                                            if (pack) {
                                                skipcard = skipcard.concat(pack);
                                            }
                                        }
                                    }
                                    for (var i = 0; i &lt; updates.length; i++) {
                                        switch (updates[i].slice(0, 5)) {
                                            case 'image': {
                                                if (!lib.config.asset_full) {
                                                    if (!lib.config.asset_image) {
                                                        updates.splice(i--, 1);
                                                    }
                                                    else {
                                                        if (updates[i].indexOf('image/character') == 0) {
                                                            if (updates[i].indexOf('jun_') != 16 &amp;&amp; updates[i].indexOf('gz_') != 16 &amp;&amp; !skipcharacter.contains(updates[i].slice(16, updates[i].lastIndexOf('.')))) {
                                                                updates.splice(i--, 1);
                                                            }
                                                        }
                                                        else if (updates[i].indexOf('image/card') == 0) {
                                                            if (updates[i].indexOf('qiaosi_card') != 11 &amp;&amp; !skipcard.contains(updates[i].slice(11, updates[i].lastIndexOf('.')))) {
                                                                updates.splice(i--, 1);
                                                            }
                                                        }
                                                        else if (updates[i].indexOf('image/mode/stone') == 0) {
                                                            updates.splice(i--, 1);
                                                        }
                                                    }
                                                }
                                                break;
                                            }
                                            case 'audio': {
                                                if (!lib.config.asset_audio) {
                                                    updates.splice(i--, 1);
                                                }
                                                break;
                                            }
                                            case 'font/': {
                                                if (!lib.config.asset_font) {
                                                    updates.splice(i--, 1);
                                                }
                                            }
                                        }
                                    }
                                    if (lib.config.asset_skin) {
                                        for (var i in skins) {
                                            for (var j = 1; j &lt;= skins[i]; j++) {
                                                updates.push('image/skin/' + i + '/' + j + '.jpg');
                                            }
                                        }
                                    }
                                    if (!ui.arena.classList.contains('menupaused')) {
                                        ui.click.configMenu();
                                        ui.click.menuTab('');
                                    }

                                    var proceed = function () {
                                        if (updates.length == 0) {
                                            game.print(updates);
                                            game.saveConfig('asset_version', asset_version);
                                            alert('');
                                            button2.disabled = false;
                                            button2.innerHTML = '';
                                            return;
                                        }
                                        var p = button2.parentNode;
                                        button2.remove();
                                        var span = document.createElement('span');
                                        span.style.whiteSpace = 'nowrap';
                                        var n1 = 0;
                                        var n2 = updates.length;
                                        span.innerHTML = '' + n1 + '/' + n2 + '';
                                        span1.remove();
                                        span2.remove();
                                        span2_check.remove();
                                        span3.remove();
                                        span3_check.remove();
                                        span4.remove();
                                        span4_check.remove();
                                        span5.remove();
                                        span5_check.remove();
                                        span6.remove();
                                        span6_check.remove();
                                        span2_br.remove();
                                        span3_br.remove();
                                        span4_br.remove();
                                        span5_br.remove();
                                        span6_br.remove();
                                        p.appendChild(span);

                                        var br6 = ui.create.node('br');
                                        var span7 = ui.create.div('.hrefnode', '');
                                        span7.style.marginTop = '6px';
                                        span7.listen(ui.click.consoleMenu);
                                        p.appendChild(br6);
                                        p.appendChild(span7);

                                        var finish = function () {
                                            if (n1 == n2) {
                                                game.saveConfig('asset_version', asset_version);
                                            }
                                            span.innerHTML = '' + n1 + '/' + n2 + '';
                                            p.appendChild(document.createElement('br'));
                                            var button = document.createElement('button');
                                            button.innerHTML = '';
                                            button.onclick = game.reload;
                                            button.style.marginTop = '8px';
                                            p.appendChild(button);
                                        }
                                        game.multiDownload(updates, function () {
                                            n1++;
                                            span.innerHTML = '' + n1 + '/' + n2 + '';
                                        }, function (e) {
                                            game.print('' + e.source);
                                        }, function () {
                                            setTimeout(finish, 500);
                                        });
                                    };
                                    game.checkFileList(updates, proceed);
                                }, function () {
                                    alert('');
                                    button2.disabled = false;
                                    button2.innerHTML = '';
                                }, true);
                            }
                            else {
                                alert('');
                            }
                        };

                        button1 = document.createElement('button');
                        button1.innerHTML = '';
                        button1.onclick = game.checkForUpdate;
                        li1.lastChild.appendChild(button1);

                        button3 = document.createElement('button');
                        button3.innerHTML = '';
                        button3.style.marginLeft = '5px';
                        button3.onclick = function () {
                            game.checkForUpdate(null, true);
                        };
                        // if(lib.config.dev){
                        //     li1.lastChild.appendChild(button3);
                        // }

                        (function () {
                            var updatep1 = li1.querySelector('p');
                            var updatep2 = li2;
                            var updatep3 = li3;
                            var updatep4 = node;
                            var updatepx = ui.create.node('p');
                            li1.appendChild(updatepx);
                            updatepx.style.display = 'none';
                            updatepx.style.whiteSpace = 'nowrap';
                            updatepx.style.marginTop = '8px';
                            var buttonx = ui.create.node('button', '', function () {
                                window.open('https://github.com/libccy/noname');
                            });
                            updatepx.appendChild(buttonx);
                            ui.updateUpdate = function () {
                                if (!game.download) {
                                    updatep1.style.display = 'none';
                                    updatep2.style.display = 'none';
                                    updatep3.style.display = 'none';
                                    updatepx.style.display = '';
                                    updatep4.innerHTML = '';
                                }
                                else {
                                    updatep1.style.display = '';
                                    updatep2.style.display = '';
                                    updatep3.style.display = 'none'; // coding
                                    updatepx.style.display = 'none';
                                    updatep4.innerHTML = '';
                                }
                            }
                            ui.updateUpdate();
                        }());

                        button4 = document.createElement('button');
                        button4.innerHTML = '';
                        button4.onclick = function () {
                            game.prompt('', function (str) {
                                if (str) {
                                    game.saveConfig('updateURL', str);
                                    li3.querySelector('span').innerHTML = trimurl(str);
                                    button5.style.display = '';
                                    button6.style.display = 'none';
                                }
                            });
                        };
                        // li3.lastChild.appendChild(button4);

                        var button6 = document.createElement('button');
                        button6.innerHTML = '';
                        button6.style.display = 'none';// coding
                        // button6.style.marginLeft='5px';
                        button6.onclick = function () {
                            game.saveConfig('updateURL', lib.mirrorURL);
                            button5.style.display = '';
                            button6.style.display = 'none';
                            li3.querySelector('span').innerHTML = trimurl(lib.mirrorURL);
                        };
                        li3.lastChild.appendChild(button6);

                        button5 = document.createElement('button');
                        button5.innerHTML = '';
                        // button5.style.marginLeft='5px';
                        button5.onclick = function () {
                            game.saveConfig('updateURL');
                            button5.style.display = 'none';
                            button6.style.display = '';
                            li3.querySelector('span').innerHTML = trimurl(lib.updateURL);
                        };
                        li3.lastChild.appendChild(button5);
                        if (!lib.config.updateURL) {
                            button5.style.display = 'none';
                        }
                        else {
                            button6.style.display = 'none';
                        }

                        button2 = document.createElement('button');
                        button2.innerHTML = '';
                        button2.onclick = game.checkForAssetUpdate;
                        li2.lastChild.appendChild(button2);

                        var span1 = ui.create.div('.config.more', ' &lt;div>&amp;gt;&lt;/div>');
                        span1.style.fontSize = 'small';
                        span1.style.display = 'inline';
                        span1.toggle = function () {
                            if (!this.classList.toggle('on')) {
                                game.saveConfig('asset_toggle_off', true);
                                span2.style.display = 'none';
                                span2_br.style.display = 'none';
                                span2_check.style.display = 'none';
                                span3.style.display = 'none';
                                span3_br.style.display = 'none';
                                span3_check.style.display = 'none';
                                span4.style.display = 'none';
                                span4_br.style.display = 'none';
                                span4_check.style.display = 'none';
                                span5.style.display = 'none';
                                span5_br.style.display = 'none';
                                span5_check.style.display = 'none';
                                span6.style.display = 'none';
                                span6_br.style.display = 'none';
                                span6_check.style.display = 'none';
                            }
                            else {
                                game.saveConfig('asset_toggle_off');
                                span2.style.display = '';
                                span2_br.style.display = '';
                                span2_check.style.display = '';
                                span3.style.display = '';
                                span3_br.style.display = '';
                                span3_check.style.display = '';
                                span4.style.display = '';
                                span4_br.style.display = '';
                                span4_check.style.display = '';
                                span5.style.display = '';
                                span5_br.style.display = '';
                                span5_check.style.display = '';
                                span6.style.display = '';
                                span6_br.style.display = '';
                                span6_check.style.display = '';
                            }
                        };
                        span1.listen(span1.toggle);
                        li2.lastChild.appendChild(span1);

                        var span6_br = ui.create.node('br');
                        li2.lastChild.appendChild(span6_br);

                        var span5 = ui.create.div('', '221MB');
                        span5.style.fontSize = 'small';
                        span5.style.lineHeight = '16px';
                        var span5_check = document.createElement('input');
                        span5_check.type = 'checkbox';
                        span5_check.style.marginLeft = '5px';
                        if (lib.config.asset_image) {
                            span5_check.checked = true;
                        }
                        span5_check.onchange = function () {
                            game.saveConfig('asset_image', this.checked);
                        }
                        var span2_br = ui.create.node('br');

                        var span4 = ui.create.div('', '56MB');
                        span4.style.fontSize = 'small';
                        span4.style.lineHeight = '16px';
                        li2.lastChild.appendChild(span4);
                        var span4_check = document.createElement('input');
                        span4_check.type = 'checkbox';
                        span4_check.style.marginLeft = '5px';
                        if (lib.config.asset_font) {
                            span4_check.checked = true;
                        }
                        span4_check.onchange = function () {
                            game.saveConfig('asset_font', this.checked);
                        }
                        li2.lastChild.appendChild(span4_check);
                        var span3_br = ui.create.node('br');
                        li2.lastChild.appendChild(span3_br);

                        var span3 = ui.create.div('', '172MB');
                        span3.style.fontSize = 'small';
                        span3.style.lineHeight = '16px';
                        li2.lastChild.appendChild(span3);
                        var span3_check = document.createElement('input');
                        span3_check.type = 'checkbox';
                        span3_check.style.marginLeft = '5px';
                        if (lib.config.asset_audio) {
                            span3_check.checked = true;
                        }
                        span3_check.onchange = function () {
                            game.saveConfig('asset_audio', this.checked);
                        }
                        li2.lastChild.appendChild(span3_check);
                        var span4_br = ui.create.node('br');
                        li2.lastChild.appendChild(span4_br);

                        var span2 = ui.create.div('', '261MB');
                        span2.style.fontSize = 'small';
                        span2.style.lineHeight = '16px';
                        li2.lastChild.appendChild(span2);
                        var span2_check = document.createElement('input');
                        span2_check.type = 'checkbox';
                        span2_check.style.marginLeft = '5px';
                        if (lib.config.asset_skin) {
                            span2_check.checked = true;
                        }
                        span2_check.onchange = function () {
                            game.saveConfig('asset_skin', this.checked);
                        }
                        li2.lastChild.appendChild(span2_check);
                        var span5_br = ui.create.node('br');
                        li2.lastChild.appendChild(span5_br);


                        li2.lastChild.appendChild(span5);
                        li2.lastChild.appendChild(span5_check);
                        li2.lastChild.appendChild(span2_br);

                        var span6 = ui.create.div('', '569MB');
                        span6.style.fontSize = 'small';
                        span6.style.lineHeight = '16px';
                        li2.lastChild.appendChild(span6);
                        var span6_check = document.createElement('input');
                        span6_check.type = 'checkbox';
                        span6_check.style.marginLeft = '5px';
                        if (lib.config.asset_full) {
                            span6_check.checked = true;
                        }
                        span6_check.onchange = function () {
                            game.saveConfig('asset_full', this.checked);
                        }
                        li2.lastChild.appendChild(span6_check);

                        span2.style.display = 'none';
                        span2_br.style.display = 'none';
                        span2_check.style.display = 'none';
                        span3.style.display = 'none';
                        span3_br.style.display = 'none';
                        span3_check.style.display = 'none';
                        span4.style.display = 'none';
                        span4_br.style.display = 'none';
                        span4_check.style.display = 'none';
                        span5.style.display = 'none';
                        span5_br.style.display = 'none';
                        span5_check.style.display = 'none';
                        span6.style.display = 'none';
                        span6_br.style.display = 'none';
                        span6_check.style.display = 'none';

                        ul.appendChild(li1);
                        ul.appendChild(li2);
                        ul.appendChild(li3);
                        page.appendChild(ul);


                        if (!lib.config.asset_toggle_off) {
                            span1.toggle();
                        }
                    }());
                    (function () {
                        var norow2 = function () {
                            var node = currentrow1;
                            if (!node) return false;
                            return node.innerHTML == '' || node.innerHTML == '' || node.innerHTML == '' || node.innerHTML == '';
                        };
                        var checkCheat = function () {
                            if (norow2()) {
                                for (var i = 0; i &lt; row2.childElementCount; i++) {
                                    row2.childNodes[i].classList.remove('selectedx');
                                    row2.childNodes[i].classList.add('unselectable');
                                }
                            }
                            else {
                                for (var i = 0; i &lt; row2.childElementCount; i++) {
                                    row2.childNodes[i].classList.remove('unselectable');
                                }
                            }
                            if (currentrow1 &amp;&amp; currentrow1.innerHTML == '') {
                                for (var i = 0; i &lt; row3.childNodes.length; i++) {
                                    if (row3.childNodes[i].dead) {
                                        row3.childNodes[i].style.display = '';
                                    }
                                    else {
                                        row3.childNodes[i].style.display = 'none';
                                        row3.childNodes[i].classList.remove('glow');
                                    }
                                    row3.childNodes[i].classList.remove('unselectable');
                                }
                            }
                            else {
                                for (var i = 0; i &lt; row3.childElementCount; i++) {
                                    if (currentrow1 &amp;&amp; currentrow1.innerHTML == '' &amp;&amp; row3.childNodes[i].link == game.me) {
                                        row3.childNodes[i].classList.add('unselectable');
                                    }
                                    else {
                                        row3.childNodes[i].classList.remove('unselectable');
                                    }
                                    if (!row3.childNodes[i].dead) {
                                        row3.childNodes[i].style.display = '';
                                    }
                                    else {
                                        row3.childNodes[i].style.display = 'none';
                                        row3.childNodes[i].classList.remove('glow');
                                    }
                                }
                            }
                            if (currentrow1 &amp;&amp; (currentrow2 || norow2()) &amp;&amp; row3.querySelector('.glow')) {
                                cheatButton.classList.add('glowing');
                                return true;
                            }
                            else {
                                cheatButton.classList.remove('glowing');
                                return false;
                            }
                        }
                        cheatButton.listen(function () {
                            if (checkCheat()) {
                                var num;
                                if (currentrow2) {
                                    switch (currentrow2.innerHTML) {
                                        case '': num = 1; break;
                                        case '': num = 2; break;
                                        case '': num = 3; break;
                                        case '': num = 4; break;
                                        case '': num = 5; break;
                                    }
                                }
                                var targets = [];
                                var buttons = row3.querySelectorAll('.glow');
                                for (var i = 0; i &lt; buttons.length; i++) {
                                    targets.push(buttons[i].link);
                                }
                                while (targets.length) {
                                    var target = targets.shift();
                                    switch (currentrow1.innerHTML) {
                                        case '': target.damage(num, 'nosource'); break;
                                        case '': target.recover(num, 'nosource'); break;
                                        case '': target.draw(num); break;
                                        case '': target.discard(target.getCards('he').randomGets(num)); break;
                                        case '': target.link(); break;
                                        case '': target.turnOver(); break;
                                        case '': target.revive(target.maxHp); break;
                                        case '': {
                                            if (_status.event.isMine()) {
                                                if (!ui.auto.classList.contains('hidden')) {
                                                    setTimeout(function () {
                                                        ui.click.auto();
                                                        setTimeout(function () {
                                                            ui.click.auto();
                                                            game.swapPlayer(target);
                                                        }, 500);
                                                    });
                                                }
                                            }
                                            else {
                                                game.swapPlayer(target);
                                            }
                                            break;
                                        }
                                    }
                                }
                                if (ui.coin) {
                                    game.changeCoin(-20);
                                }
                                clickContainer.call(menuContainer);
                            }
                        });

                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.link = page;
                        node.type = 'cheat';
                        page.classList.add('menu-sym');

                        var currentrow1 = null;
                        var row1 = ui.create.div('.menu-cheat', page);
                        var clickrow1 = function () {
                            if (this.classList.contains('unselectable')) return;
                            if (currentrow1 == this) {
                                this.classList.remove('selectedx');
                                currentrow1 = null;
                            }
                            else {
                                this.classList.add('selectedx');
                                if (currentrow1) {
                                    currentrow1.classList.remove('selectedx');
                                }
                                currentrow1 = this;
                                if (this.innerHTML == '') {
                                    for (var i = 0; i &lt; row3.childNodes.length; i++) {
                                        row3.childNodes[i].classList.remove('glow');
                                    }
                                }
                            }
                            checkCheat();
                        };
                        var nodedamage = ui.create.div('.menubutton', '', row1, clickrow1);
                        var noderecover = ui.create.div('.menubutton', '', row1, clickrow1);
                        var nodedraw = ui.create.div('.menubutton', '', row1, clickrow1);
                        var nodediscard = ui.create.div('.menubutton', '', row1, clickrow1);
                        var nodelink = ui.create.div('.menubutton', '', row1, clickrow1);
                        var nodeturnover = ui.create.div('.menubutton', '', row1, clickrow1);
                        var noderevive = ui.create.div('.menubutton', '', row1, clickrow1);
                        var nodereplace = ui.create.div('.menubutton', '', row1, clickrow1);
                        if (lib.config.mode != 'identity' &amp;&amp; lib.config.mode != 'guozhan' &amp;&amp; lib.config.mode != 'doudizhu') {
                            nodereplace.classList.add('unselectable');
                        }

                        var currentrow2 = null;
                        var row2 = ui.create.div('.menu-cheat', page);
                        var clickrow2 = function () {
                            if (this.classList.contains('unselectable')) return;
                            if (currentrow2 == this) {
                                this.classList.remove('selectedx');
                                currentrow2 = null;
                            }
                            else {
                                this.classList.add('selectedx');
                                if (currentrow2) {
                                    currentrow2.classList.remove('selectedx');
                                }
                                currentrow2 = this;
                            }
                            checkCheat();
                        };
                        var nodex1 = ui.create.div('.menubutton', '', row2, clickrow2);
                        var nodex2 = ui.create.div('.menubutton', '', row2, clickrow2);
                        var nodex3 = ui.create.div('.menubutton', '', row2, clickrow2);
                        var nodex4 = ui.create.div('.menubutton', '', row2, clickrow2);
                        var nodex5 = ui.create.div('.menubutton', '', row2, clickrow2);

                        var row3 = ui.create.div('.menu-buttons.leftbutton.commandbutton', page);
                        row3.style.marginTop = '3px';
                        var clickrow3 = function () {
                            if (this.classList.contains('unselectable')) return;
                            this.classList.toggle('glow');
                            if (currentrow1 &amp;&amp; currentrow1.innerHTML == '' &amp;&amp; this.classList.contains('glow')) {
                                if (this.link == game.me) {
                                    this.classList.remove('glow');
                                }
                                for (var i = 0; i &lt; row3.childElementCount; i++) {
                                    if (row3.childNodes[i] != this) {
                                        row3.childNodes[i].classList.remove('glow');
                                    }
                                }
                            }
                            checkCheat();
                        };
                        menuUpdates.push(function () {
                            if (_status.video || _status.connectMode || _status.yindao) {
                                node.classList.add('off');
                                if (node.classList.contains('active')) {
                                    node.classList.remove('active');
                                    node.link.remove();
                                    active = start.firstChild.firstChild;
                                    active.classList.add('active');
                                    rightPane.appendChild(active.link);
                                }

                                page.remove();
                                cheatButton.remove();
                                if (_status.video) node.remove();
                                return;
                            }
                            var list = [];
                            for (var i = 0; i &lt; game.players.length; i++) {
                                if (lib.character[game.players[i].name] || game.players[i].name1) {
                                    list.push(game.players[i]);
                                }
                            }
                            for (var i = 0; i &lt; game.dead.length; i++) {
                                if (lib.character[game.dead[i].name] || game.dead[i].name1) {
                                    list.push(game.dead[i]);
                                }
                            }
                            if (list.length) {
                                row1.show();
                                row2.show();
                                row3.innerHTML = '';
                                var buttons = ui.create.buttons(list, 'player', row3, true);
                                for (var i = 0; i &lt; buttons.length; i++) {
                                    buttons[i].listen(clickrow3);
                                    if (game.dead.contains(buttons[i].link)) {
                                        buttons[i].dead = true;
                                    }
                                }
                                checkCheat();
                            }
                            else {
                                row1.hide();
                                row2.hide();
                            }
                            if (lib.config.mode == 'identity' || lib.config.mode == 'guozhan' || lib.config.mode == 'doudizhu') {
                                if (game.notMe || (game.me &amp;&amp; (game.me._trueMe || game.hasPlayer(function (current) {
                                    return current._trueMe == game.me;
                                }))) || !game.phaseNumber || _status.qianlidanji) {
                                    nodereplace.classList.add('unselectable');
                                }
                                else if (_status.event.isMine() &amp;&amp; ui.auto.classList.contains('hidden')) {
                                    nodereplace.classList.add('unselectable');
                                }
                                else {
                                    nodereplace.classList.remove('unselectable');
                                }
                            }
                            if (game.dead.length == 0) {
                                noderevive.classList.add('unselectable');
                            }
                            else {
                                noderevive.classList.remove('unselectable');
                            }
                            checkCheat();
                        });
                    }());
                    (function () {
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        ui.commandnode = node;
                        node.type = 'cmd';
                        node.link = page;
                        page.classList.add('menu-sym');
                        menuUpdates.push(function () {
                            if (_status.connectMode) {
                                node.classList.add('off');
                                if (node.classList.contains('active')) {
                                    node.classList.remove('active');
                                    node.link.remove();
                                    active = start.firstChild.firstChild;
                                    active.classList.add('active');
                                    rightPane.appendChild(active.link);
                                }
                            }
                        });
                        var text = document.createElement('div');
                        text.style.width = '194px';
                        text.style.height = '124px';
                        text.style.padding = '3px';
                        text.style.borderRadius = '2px';
                        text.style.boxShadow = 'rgba(0, 0, 0, 0.2) 0 0 0 1px';
                        text.style.textAlign = 'left';
                        text.style.webkitUserSelect = 'initial';
                        text.style.overflow = 'scroll';
                        text.style.position = 'absolute';
                        text.style.left = '30px';
                        text.style.top = '50px';
                        text.style.wordBreak = 'break-all';
                        var pre = ui.create.node('pre.fullsize', text);
                        pre.style.margin = 0;
                        pre.style.padding = 0;
                        pre.style.position = 'relative';
                        lib.setScroll(pre);
                        page.appendChild(text);

                        // var caption=ui.create.div('','',page);
                        // caption.style.margin='6px';
                        // caption.style.position='absolute';
                        // caption.style.width='120px';
                        // caption.style.top='129px';
                        // caption.style.left='64px';
                        var text2 = document.createElement('input');
                        text2.style.width = '200px';
                        text2.style.height = '20px';
                        text2.style.padding = '0';
                        text2.style.position = 'absolute';
                        text2.style.top = '15px';
                        text2.style.left = '30px';
                        text2.style.resize = 'none';
                        text2.style.border = 'none';
                        text2.style.borderRadius = '2px';
                        text2.style.boxShadow = 'rgba(0, 0, 0, 0.2) 0 0 0 1px';
                        var g = {};
                        var logs = [];
                        var logindex = -1;
                        var cheat = lib.cheat;
                        var runCommand = function (e) {
                            if (text2.value &amp;&amp; !['up', 'down'].contains(text2.value)) {
                                logindex = -1;
                                logs.unshift(text2.value);
                            }
                            if (text2.value == 'cls') {
                                pre.innerHTML = '';
                                text2.value = '';
                            }
                            else if (text2.value == 'up') {
                                if (logindex + 1 &lt; logs.length) {
                                    text2.value = logs[++logindex];
                                }
                                else {
                                    text2.value = '';
                                }
                            }
                            else if (text2.value == 'down') {
                                if (logindex >= 0) {
                                    logindex--;
                                    if (logindex &lt; 0) {
                                        text2.value = '';
                                    }
                                    else {
                                        text2.value = logs[logindex];
                                    }
                                }
                                else {
                                    text2.value = '';
                                }
                            }
                            else if (text2.value.indexOf('') != -1 &amp;&amp; (text2.value.indexOf('') != -1 || text2.value.indexOf('') != -1 &amp;&amp; text2.value.indexOf('') != -1)) {
                                game.print('');
                                _status.keyVerified = true;
                                text2.value = '';
                            }
                            else {
                                if (!game.observe &amp;&amp; !game.online) {
                                    try {
                                        var result = eval(text2.value);
                                        game.print(result);
                                    }
                                    catch (e) {
                                        game.print(e);
                                    }
                                }
                                text2.value = '';
                            }
                        }
                        text2.addEventListener('keydown', function (e) {
                            if (e.keyCode == 13) {
                                runCommand();
                            }
                            else if (e.keyCode == 38) {
                                if (logindex + 1 &lt; logs.length) {
                                    text2.value = logs[++logindex];
                                }
                            }
                            else if (e.keyCode == 40) {
                                if (logindex >= 0) {
                                    logindex--;
                                    if (logindex &lt; 0) {
                                        text2.value = '';
                                    }
                                    else {
                                        text2.value = logs[logindex];
                                    }
                                }
                            }
                        });
                        page.appendChild(text2);
                        game.print = function () {
                            var textstr = '';
                            for (var i = 0; i &lt; arguments.length; i++) {
                                if (get.is.object(arguments[i])) {
                                    var argi = get.stringify(arguments[i]);
                                    if (argi &amp;&amp; argi.length &lt; 5000) {
                                        textstr += argi;
                                    }
                                    else {
                                        textstr += arguments[i].toString();
                                    }
                                }
                                else {
                                    textstr += arguments[i];
                                }
                                if (i &lt; arguments.length - 1) {
                                    textstr += ' ';
                                }
                            }
                            textstr += '&lt;br>';
                            pre.innerHTML += textstr;
                            text.scrollTop = text.scrollHeight;
                        }
                        if (_status.toprint) {
                            for (var i = 0; i &lt; _status.toprint.length; i++) {
                                game.print.apply(this, _status.toprint[i]);
                            }
                            delete _status.toprint;
                        }
                        runButton.listen(runCommand);
                        clearButton.listen(function () {
                            pre.innerHTML = '';
                        });
                    }());
                    (function () {
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.type = 'rec';
                        node.link = page;
                        page.style.paddingBottom = '10px';
                        var reset = function () {
                            if (this.innerHTML == '') {
                                this.innerHTML = '';
                                var that = this;
                                setTimeout(function () {
                                    that.innerHTML = '';
                                }, 1000);
                            }
                            else {
                                this.parentNode.previousSibling.remove();
                                this.parentNode.remove();
                                lib.config.gameRecord[this.parentNode.link] = { data: {} };
                                game.saveConfig('gameRecord', lib.config.gameRecord);
                            }
                        }
                        for (var i = 0; i &lt; lib.config.all.mode.length; i++) {
                            if (!lib.config.gameRecord[lib.config.all.mode[i]]) continue;
                            if (lib.config.gameRecord[lib.config.all.mode[i]].str) {
                                ui.create.div('.config.indent', lib.translate[lib.config.all.mode[i]], page).style.marginBottom = '-5px';
                                var item = ui.create.div('.config.indent', lib.config.gameRecord[lib.config.all.mode[i]].str + '&lt;span>&lt;/span>', page);
                                item.style.height = 'auto';
                                item.lastChild.addEventListener('click', reset);
                                item.lastChild.classList.add('pointerdiv');
                                item.link = lib.config.all.mode[i];
                            }
                        }
                    }());
                    (function () {
                        if (!window.indexedDB || window.nodb) return;
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, clickMode);
                        node.type = 'video';
                        node.link = page;

                        var store = lib.db.transaction(['video'], 'readwrite').objectStore('video');
                        lib.videos = [];
                        store.openCursor().onsuccess = function (e) {
                            var cursor = e.target.result;
                            if (cursor) {
                                lib.videos.push(cursor.value);
                                cursor.continue();
                            }
                            else {
                                lib.videos.sort(function (a, b) {
                                    return parseInt(b.time) - parseInt(a.time);
                                });
                                var clickcapt = function () {
                                    var current = this.parentNode.querySelector('.videonode.active');
                                    if (current &amp;&amp; current != this) {
                                        current.classList.remove('active');
                                    }
                                    if (this.classList.toggle('active')) {
                                        playButton.show();
                                        deleteButton.show();
                                        saveButton.show();
                                    }
                                    else {
                                        playButton.hide();
                                        deleteButton.hide();
                                        saveButton.hide();
                                    }
                                };
                                var staritem = function () {
                                    this.parentNode.classList.toggle('starred');
                                    var store = lib.db.transaction(['video'], 'readwrite').objectStore('video');
                                    if (this.parentNode.classList.contains('starred')) {
                                        this.parentNode.link.starred = true;
                                    }
                                    else {
                                        this.parentNode.link.starred = false;
                                    }
                                    store.put(this.parentNode.link);
                                }
                                var createNode = function (video, before) {
                                    var node = ui.create.div('.videonode.menubutton.large', clickcapt);
                                    node.link = video;
                                    var nodename1 = ui.create.div('.menubutton.videoavatar', node);
                                    nodename1.setBackground(video.name1, 'character');
                                    if (video.name2) {
                                        var nodename2 = ui.create.div('.menubutton.videoavatar2', node);
                                        nodename2.setBackground(video.name2, 'character');
                                    }
                                    var date = new Date(video.time);
                                    var str = date.getFullYear() + '.' + (date.getMonth() + 1) + '.' + (date.getDate()) + ' ' +
                                        date.getHours() + ':';
                                    var minutes = date.getMinutes();
                                    if (minutes &lt; 10) {
                                        str += '0';
                                    }
                                    str += minutes;
                                    ui.create.div('.caption', video.name[0], node);
                                    ui.create.div('.text', str + '&lt;br>' + video.name[1], node);
                                    if (video.win) {
                                        ui.create.div('.victory', '', node);
                                    }

                                    if (before) {
                                        page.insertBefore(node, page.firstChild);
                                    }
                                    else {
                                        page.appendChild(node);
                                    }
                                    ui.create.div('.video_star', '', node, staritem);
                                    if (video.starred) {
                                        node.classList.add('starred');
                                    }
                                }
                                for (var i = 0; i &lt; lib.videos.length; i++) {
                                    createNode(lib.videos[i]);
                                }
                                ui.create.videoNode = createNode;
                                var importVideoNode = ui.create.div('.config.switcher.pointerspan',
                                    '&lt;span class="underlinenode slim ">...&lt;/span>', function () {
                                        this.nextSibling.classList.toggle('hidden');
                                    }, page);
                                importVideoNode.style.marginLeft = '12px';
                                importVideoNode.style.marginTop = '3px';
                                var importVideo = ui.create.div('.config.hidden', page);
                                importVideo.style.whiteSpace = 'nowrap';
                                importVideo.style.marginBottom = '80px';
                                importVideo.style.marginLeft = '13px';
                                importVideo.style.width = 'calc(100% - 30px)';
                                importVideo.innerHTML = '&lt;input type="file" style="width:calc(100% - 40px)">' +
                                    '&lt;button style="width:40px">&lt;/button>';
                                importVideo.lastChild.onclick = function () {
                                    var fileToLoad = importVideo.firstChild.files[0];
                                    var fileReader = new FileReader();
                                    fileReader.onload = function (fileLoadedEvent) {
                                        var data = fileLoadedEvent.target.result;
                                        if (!data) return;
                                        try {
                                            data = JSON.parse(lib.init.decode(data));
                                        }
                                        catch (e) {
                                            console.log(e);
                                            alert('');
                                            return;
                                        }
                                        var store = lib.db.transaction(['video'], 'readwrite').objectStore('video');
                                        var videos = lib.videos.slice(0);
                                        for (var i = 0; i &lt; videos.length; i++) {
                                            if (videos[i].starred) {
                                                videos.splice(i--, 1);
                                            }
                                        }
                                        for (var deletei = 0; deletei &lt; 5; deletei++) {
                                            if (videos.length >= parseInt(lib.config.video) &amp;&amp; videos.length) {
                                                var toremove = videos.pop();
                                                lib.videos.remove(toremove);
                                                store.delete(toremove.time);
                                                for (var i = 0; i &lt; page.childNodes.length; i++) {
                                                    if (page.childNodes[i].link == toremove) {
                                                        page.childNodes[i].remove();
                                                        break;
                                                    }
                                                }
                                            }
                                            else {
                                                break;
                                            }
                                        }
                                        for (var i = 0; i &lt; lib.videos.length; i++) {
                                            if (lib.videos[i].time == data.time) {
                                                alert('');
                                                return;
                                            }
                                        }
                                        lib.videos.unshift(data);
                                        store.put(data);
                                        createNode(data, true);
                                    };
                                    fileReader.readAsText(fileToLoad, "UTF-8");
                                }

                                playButton.listen(function () {
                                    var current = this.parentNode.querySelector('.videonode.active');
                                    if (current) {
                                        game.playVideo(current.link.time, current.link.mode);
                                    }
                                });
                                deleteButton.listen(function () {
                                    var current = this.parentNode.querySelector('.videonode.active');
                                    if (current) {
                                        lib.videos.remove(current.link);
                                        var store = lib.db.transaction(['video'], 'readwrite').objectStore('video');
                                        store.delete(current.link.time);
                                        current.remove();
                                    }
                                });
                                saveButton.listen(function () {
                                    var current = this.parentNode.querySelector('.videonode.active');
                                    if (current) {
                                        game.export(lib.init.encode(JSON.stringify(current.link)),
                                            ' -  - ' + current.link.name[0] + ' - ' + current.link.name[1]);
                                    }
                                });

                                ui.updateVideoMenu = function () {
                                    var active = start.firstChild.querySelector('.active');
                                    if (active) {
                                        active.classList.remove('active');
                                        active.link.remove();
                                    }
                                    node.classList.add('active');
                                    rightPane.appendChild(page);
                                    playButton.style.display = '';
                                    deleteButton.style.display = '';
                                    saveButton.style.display = '';
                                }
                            }
                        };
                    }());


                    for (var i in lib.help) {
                        var page = ui.create.div('');
                        var node = ui.create.div('.menubutton.large', i, start.firstChild, clickMode);
                        node.type = 'help';
                        node.link = page;
                        node.style.display = 'none';
                        page.classList.add('menu-help');
                        page.innerHTML = lib.help[i];
                    }

                    if (!connectMenu) {
                        var node = ui.create.div('.menubutton.large', '', start.firstChild, function () {
                            var activex = start.firstChild.querySelector('.active');
                            if (this.innerHTML == '') {
                                cheatButton.style.display = 'none';
                                runButton.style.display = 'none';
                                clearButton.style.display = 'none';
                                playButton.style.display = 'none';
                                saveButton.style.display = 'none';
                                deleteButton.style.display = 'none';

                                this.innerHTML = '';
                                for (var i = 0; i &lt; start.firstChild.childElementCount; i++) {
                                    var nodex = start.firstChild.childNodes[i];
                                    if (nodex == node) continue;
                                    if (nodex.type == 'help') {
                                        nodex.style.display = '';
                                        if (activex &amp;&amp; activex.type != 'help') {
                                            activex.classList.remove('active');
                                            activex.link.remove();
                                            activex = null;
                                            nodex.classList.add('active');
                                            rightPane.appendChild(nodex.link);
                                        }
                                    }
                                    else {
                                        nodex.style.display = 'none';
                                    }
                                }
                            }
                            else {
                                this.innerHTML = '';
                                for (var i = 0; i &lt; start.firstChild.childElementCount; i++) {
                                    var nodex = start.firstChild.childNodes[i];
                                    if (nodex == node) continue;
                                    if (nodex.type != 'help') {
                                        nodex.style.display = '';
                                        if (activex &amp;&amp; activex.type == 'help') {
                                            activex.classList.remove('active');
                                            activex.link.remove();
                                            activex = null;
                                            clickMode.call(nodex);
                                        }
                                    }
                                    else {
                                        nodex.style.display = 'none';
                                    }
                                }
                            }
                        });
                    }

                    var active = start.firstChild.querySelector('.active');
                    if (!active) {
                        active = start.firstChild.firstChild;
                        active.classList.add('active');
                    }
                    rightPane.appendChild(active.link);
                }());

                if (menuTimeout) {
                    clearTimeout(menuTimeout);
                    delete window.resetExtension;
                    localStorage.removeItem(lib.configprefix + 'disable_extension', true);
                }
            },
            table: function () {
                var str, row, col, position, position2, fixed, style, divposition;
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'string') str = arguments[i];
                    else if (typeof arguments[i] == 'number') {
                        if (typeof row == 'number') {
                            if (typeof col == 'number') position2 = arguments[i];
                            else col = arguments[i];
                        }
                        else row = arguments[i];
                    }
                    else if (get.objtype(arguments[i]) == 'div' ||
                        get.objtype(arguments[i]) == 'table' ||
                        get.objtype(arguments[i]) == 'tr' ||
                        get.objtype(arguments[i]) == 'td' ||
                        get.objtype(arguments[i]) == 'body') position = arguments[i];
                    else if (typeof arguments[i] == 'boolean') fixed = arguments[i];
                    else if (get.itemtype(arguments[i]) == 'divposition') divposition = arguments[i];
                    else if (typeof arguments[i] == 'object') style = arguments[i];
                }
                if (str == undefined) str = '';
                var node = document.createElement('table');
                for (var i = 0; i &lt; str.length; i++) {
                    if (str[i] == '.') {
                        if (node.className.length != 0) {
                            node.className += ' ';
                        }
                        while (str[i + 1] != '.' &amp;&amp; str[i + 1] != '#' &amp;&amp; i + 1 &lt; str.length) {
                            node.className += str[i + 1];
                            i++;
                        }
                    }
                    else if (str[i] == '#') {
                        while (str[i + 1] != '.' &amp;&amp; str[i + 1] != '#' &amp;&amp; i + 1 &lt; str.length) {
                            node.id += str[i + 1];
                            i++;
                        }
                    }
                }
                var tr, td;
                for (var i = 0; i &lt; row; i++) {
                    tr = document.createElement('tr');
                    if (fixed) tr.style.height = (100 / row) + '%';
                    node.appendChild(tr);
                    for (var j = 0; j &lt; col; j++) {
                        td = document.createElement('td');
                        tr.appendChild(td);
                    }
                }
                if (position) {
                    if (typeof position2 == 'number' &amp;&amp; position.childNodes.length > position2) {
                        position.insertBefore(node, position.childNodes[position2]);
                    }
                    else {
                        position.appendChild(node);
                    }
                }
                return node;
            },
            giveup: function () {
                if (ui.giveup) return;
                if (!lib.config.show_giveup) return;
                ui.giveup = ui.create.system('', function () {
                    var player = game.me;
                    this.remove();
                    if (game.online) {
                        game.send('giveup', player);
                    }
                    else {
                        _status.event.next.length = 0;
                        game.createEvent('giveup', false).setContent(function () {
                            game.log(player, '');
                            player.popup('');
                            player.die('nosource');
                        }).player = player;
                    }
                    if (_status.paused &amp;&amp; _status.imchoosing &amp;&amp; !_status.auto) {
                        ui.click.auto();
                    }
                }, true, true);
            },
            groupControl: function (dialog) {
                return ui.create.control('qun',
                    'holo', 'nijisanji', 'dotlive', 'upd8', 'eilene', 'paryi', 'kagura', 'nori', 'vwp', 'nanashi',
                    'VirtuaReal', 'HappyElements', 'psp', 'asoul', 'xuyan', 'chaos', 'xuefeng','hunmiao', 'ego', 'chidori', 'lucca',
                    'vshojo', function (link, node) {//'wei','shu','wu','western','key',
                        if (link == '') {
                            dialog.currentcapt = '';
                            dialog.currentgroup = '';
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                dialog.buttons[i].style.display = '';
                            }
                        }
                        else {
                            if (node.classList.contains('thundertext')) {
                                dialog.currentgroup = null;
                                dialog.currentgroupnode = null;
                                node.classList.remove('thundertext');
                                for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                    if (dialog.currentcapt &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt)) {
                                        dialog.buttons[i].classList.add('nodisplay');
                                    }
                                    else {
                                        dialog.buttons[i].classList.remove('nodisplay');
                                    }
                                }
                            }
                            else {
                                if (dialog.currentgroupnode) {
                                    dialog.currentgroupnode.classList.remove('thundertext');
                                }
                                dialog.currentgroup = link;
                                dialog.currentgroupnode = node;
                                node.classList.add('thundertext');
                                for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                    if (dialog.buttons[i].group != link ||
                                        (dialog.currentcapt &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt))) {
                                        dialog.buttons[i].classList.add('nodisplay');
                                    }
                                    else {
                                        dialog.buttons[i].classList.remove('nodisplay');
                                    }
                                }
                            }
                        }
                    });
            },
            /**
             * 
             * @function
             * @returns {HTMLDivElement} 
             * @see {@link ui.create.characterDialog}
             */
            cardDialog: function () {
                var args = ['thisiscard'];
                for (var i = 0; i &lt; arguments.length; i++) {
                    args.push(arguments[i]);
                }
                return ui.create.characterDialog.apply(this, args);
            },
            characterDialog2: function (filter) {
                var list = [];
                for (var i in lib.character) {
                    if (lib.character[i][4].contains('minskin')) continue;
                    if (lib.character[i][4].contains('boss') || lib.character[i][4].contains('hiddenboss')) {
                        if (lib.config.mode == 'boss') continue;
                        if (!lib.character[i][4].contains('bossallowed')) continue;
                    }

                    if (lib.character[i][4].contains('stonehidden')) continue;
                    if (lib.config.banned.contains(i)) continue;
                    if (filter &amp;&amp; filter(i)) continue;
                    list.push(i);
                }
                var dialog = ui.create.dialog('hidden');
                dialog.classList.add('noupdate');
                dialog.classList.add('scroll1');
                dialog.classList.add('scroll2');
                dialog.classList.add('scroll3');
                list.sort(lib.sort.character);
                dialog.classList.add('character');
                dialog.classList.add('choose-character');
                var getPack = function (name) {
                    for (var i in lib.characterPack) {
                        if (lib.characterPack[i][name]) return i;
                    }
                    return null;
                }
                var packs = {};
                var packnode = ui.create.div('.packnode', dialog);
                lib.setScroll(packnode);
                var clickCapt = function () {
                    var active = this.parentNode.querySelector('.active');
                    if (active) {
                        active.classList.remove('active');
                    }
                    this.classList.add('active');
                    for (var i = 0; i &lt; dialog.buttons.length; i++) {
                        if (this.pack &amp;&amp; !this.pack.contains(dialog.buttons[i].link)) {
                            dialog.buttons[i].classList.add('nodisplay');
                        }
                        else {
                            dialog.buttons[i].classList.remove('nodisplay');
                        }
                    }
                }
                var createNode = function (packname) {
                    var translate;
                    var pack = null;
                    if (packname == '') {
                        pack = get.config('recentCharacter') || [];
                    }
                    else if (packname == '') {
                        pack = lib.config.favouriteCharacter;
                    }
                    var node = ui.create.div('.dialogbutton.menubutton.large', packname, packnode, clickCapt);
                    node.pack = pack;
                    return node;
                }
                dialog.add([list, 'character']);
                var bool = true;
                var node;
                var recent = get.config('recentCharacter');
                if (recent &amp;&amp; recent.length) {
                    node = createNode('');
                    if (lib.config.character_dialog_tool == '') {
                        clickCapt.call(node);
                        bool = false;
                    }
                }
                if (lib.config.favouriteCharacter.length) {
                    node = createNode('');
                    if (lib.config.character_dialog_tool == '') {
                        clickCapt.call(node);
                        bool = false;
                    }
                }
                var node = createNode('');
                if (lib.config.character_dialog_tool == 'all') {
                    clickCapt.call(node);
                    bool = false;
                }
                if (bool) {
                    clickCapt.call(packnode.firstChild);
                }

                var node = ui.create.div('.dialogbutton.menubutton.large', '', packnode);
                return dialog;
            },
            /**
             * 
             * @function
             * @param {?string} thisiscard 
             * @param {?string} heightset 
             * @param {?string} characterx 
             * @param {?function} filter 
             * @param {?boolean} noclick 
             * @returns {HTMLDivElement} 
             */
            characterDialog: function () {
                // if(lib.config.character_dialog_style=='newstyle'){
                //     for(var i=0;i&lt;arguments.length;i++){
                //                  if(arguments[i]=='thisiscard'){
                //                               break;
                //                  }
                //     }
                //     if(i==arguments.length){
                //                  return ui.create.characterDialog2.apply(this,arguments);
                //     }
                // }
                var filter, str, noclick, thisiscard, seperate, expandall, onlypack, heightset, precharacter, characterx;
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (arguments[i] === 'thisiscard') {
                        thisiscard = true;
                    }
                    else if (arguments[i] === 'expandall') {
                        expandall = true;
                    }
                    else if (arguments[i] === 'heightset') {
                        heightset = true;
                    }
                    else if (arguments[i] == 'precharacter') {
                        precharacter = true;
                    }
                    else if (arguments[i] == 'characterx') {
                        characterx = true;
                    }
                    else if (typeof arguments[i] == 'string' &amp;&amp; arguments[i].indexOf('onlypack:') == 0) {
                        onlypack = arguments[i].slice(9);
                    }
                    else if (typeof arguments[i] == 'object' &amp;&amp; typeof arguments[i].seperate == 'function') {
                        seperate = arguments[i].seperate;
                    }
                    else if (typeof arguments[i] === 'string') {
                        str = arguments[i];
                    }
                    else if (typeof arguments[i] === 'function') {
                        filter = arguments[i];
                    }
                    else if (typeof arguments[i] == 'boolean') {
                        noclick = arguments[i];
                    }
                }
                var list = [];
                var dialog;
                var node = ui.create.div('.caption.pointerspan');
                if (get.is.phoneLayout()) {
                    node.style.fontSize = '30px';
                }
                var namecapt = [];
                var getCapt = function (str) {
                    var capt;
                    if (str.indexOf('_') == -1) {
                        capt = str[0];
                    }
                    else {
                        capt = str[str.lastIndexOf('_') + 1];
                    }
                    capt = capt.toLowerCase();
                    if (!/[a-z]/i.test(capt)) {
                        capt = '';
                    }
                    return capt;
                }
                if (thisiscard) {
                    for (var i in lib.card) {
                        if (!lib.translate[i + '_info']) continue;
                        if (filter &amp;&amp; filter(i)) continue;
                        list.push(['', get.translation(lib.card[i].type), i]);
                        if (namecapt.indexOf(getCapt(i)) == -1) {
                            namecapt.push(getCapt(i));
                        }
                    }
                }
                else {
                    for (var i in lib.character) {
                        if (lib.character[i][4].contains('minskin')) continue;
                        if (lib.character[i][4].contains('boss') || lib.character[i][4].contains('hiddenboss')) {
                            if (lib.config.mode == 'boss') continue;
                            if (!lib.character[i][4].contains('bossallowed')) continue;
                        }

                        if (lib.character[i][4].contains('stonehidden')) continue;
                        if (lib.character[i][4].contains('unseen')) continue;
                        if (lib.config.banned.contains(i)) continue;
                        if (lib.characterFilter[i] &amp;&amp; !lib.characterFilter[i](get.mode())) continue;
                        if (filter &amp;&amp; filter(i)) continue;
                        list.push(i);
                        if (namecapt.indexOf(getCapt(i)) == -1) {
                            namecapt.push(getCapt(i));
                        }
                    }
                }
                namecapt.sort(function (a, b) {
                    return a > b ? 1 : -1;
                });
                if (!thisiscard) {
                    namecapt.remove('');
                    namecapt.push('newline');
                    for (var i in lib.characterDialogGroup) {
                        namecapt.push(i);
                    }
                }
                var newlined = false;
                var newlined2;
                var packsource;
                var clickCapt = function (e) {
                    if (_status.dragged) return;
                    if (dialog.currentcapt2 == '' &amp;&amp; dialog.currentcaptnode2 != this &amp;&amp; !dialog.currentcaptnode2.inited) {
                        dialog.currentcapt2 = null;
                        dialog.currentcaptnode2.classList.remove('thundertext');
                        dialog.currentcaptnode2.inited = true;
                        dialog.currentcaptnode2 = null;
                    }
                    if (this.alphabet) {
                        if (this.classList.contains('thundertext')) {
                            dialog.currentcapt = null;
                            dialog.currentcaptnode = null;
                            this.classList.remove('thundertext');
                            if (this.touchlink) {
                                this.touchlink.classList.remove('active');
                            }
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (dialog.currentgroup &amp;&amp; dialog.buttons[i].group != dialog.currentgroup) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentcapt2 &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt, true)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else {
                                    dialog.buttons[i].classList.remove('nodisplay');
                                }
                            }
                        }
                        else {
                            if (dialog.currentcaptnode) {
                                dialog.currentcaptnode.classList.remove('thundertext');
                                if (dialog.currentcaptnode.touchlink) {
                                    dialog.currentcaptnode.touchlink.classList.remove('active');
                                }
                            }
                            dialog.currentcapt = this.link;
                            dialog.currentcaptnode = this;
                            this.classList.add('thundertext');
                            if (this.touchlink) {
                                this.touchlink.classList.add('active');
                            }
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentcapt2 &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt, true)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentgroup &amp;&amp; dialog.buttons[i].group != dialog.currentgroup) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else {
                                    dialog.buttons[i].classList.remove('nodisplay');
                                }
                            }
                        }
                    }
                    else {
                        if (newlined2) {
                            newlined2.style.display = 'none';
                            if (!packsource.onlypack) {
                                packsource.classList.remove('thundertext');
                                if (!get.is.phoneLayout() || !lib.config.filternode_button) {
                                    packsource.innerHTML = '';
                                }
                            }
                        }
                        if (this.classList.contains('thundertext')) {
                            dialog.currentcapt2 = null;
                            dialog.currentcaptnode2 = null;
                            this.classList.remove('thundertext');
                            if (this.touchlink) {
                                this.touchlink.classList.remove('active');
                            }
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (dialog.currentgroup &amp;&amp; dialog.buttons[i].group != dialog.currentgroup) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentcapt &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else {
                                    dialog.buttons[i].classList.remove('nodisplay');
                                }
                            }
                        }
                        else {
                            if (dialog.currentcaptnode2) {
                                dialog.currentcaptnode2.classList.remove('thundertext');
                                if (dialog.currentcaptnode2.touchlink) {
                                    dialog.currentcaptnode2.touchlink.classList.remove('active');
                                }
                            }
                            dialog.currentcapt2 = this.link;
                            dialog.currentcaptnode2 = this;
                            this.classList.add('thundertext');
                            if (this.touchlink) {
                                this.touchlink.classList.add('active');
                            }
                            else if (this.parentNode == newlined2) {
                                packsource.innerHTML = this.innerHTML;
                                packsource.classList.add('thundertext');
                            }
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (dialog.currentcapt &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt, true)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentgroup &amp;&amp; dialog.buttons[i].group != dialog.currentgroup) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else {
                                    if (dialog.buttons[i].activate) {
                                        dialog.buttons[i].activate();
                                    }
                                    dialog.buttons[i].classList.remove('nodisplay');
                                }
                            }
                        }
                    }
                    if (dialog.seperate) {
                        for (var i = 0; i &lt; dialog.seperate.length; i++) {
                            if (!dialog.seperate[i].nextSibling.querySelector('.button:not(.nodisplay)')) {
                                dialog.seperate[i].style.display = 'none';
                                dialog.seperate[i].nextSibling.style.display = 'none';
                            }
                            else {
                                dialog.seperate[i].style.display = '';
                                dialog.seperate[i].nextSibling.style.display = '';
                            }
                        }
                    }
                    if (filternode) {
                        if (filternode.querySelector('.active')) {
                            packsource.classList.add('thundertext');
                        }
                        else {
                            packsource.classList.remove('thundertext');
                        }
                    }
                    if (e) e.stopPropagation();
                };
                for (i = 0; i &lt; namecapt.length; i++) {
                    if (namecapt[i] == 'newline') {
                        newlined = document.createElement('div');
                        newlined.style.marginTop = '5px';
                        newlined.style.display = 'block';
                        // newlined.style.fontFamily='xinwei';
                        if (get.is.phoneLayout()) {
                            newlined.style.fontSize = '32px';
                        }
                        else {
                            newlined.style.fontSize = '22px';
                        }
                        newlined.style.textAlign = 'center';
                        node.appendChild(newlined);
                    }
                    else if (newlined) {
                        var span = ui.create.div('.tdnode.pointerdiv.shadowed.reduce_radius');
                        span.style.margin = '3px';
                        span.style.width = 'auto';
                        span.innerHTML = ' ' + namecapt[i].toUpperCase() + ' ';
                        span.link = namecapt[i];
                        span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickCapt);
                        newlined.appendChild(span);
                        node[namecapt[i]] = span;
                        if (namecapt[i] == '') {
                            span._nature = 'fire';
                        }
                        else {
                            span._nature = 'wood';
                        }
                    }
                    else {
                        var span = document.createElement('span');
                        span.innerHTML = ' ' + namecapt[i].toUpperCase() + ' ';
                        span.link = namecapt[i];
                        span.alphabet = true;
                        span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickCapt);
                        node.appendChild(span);
                    }
                }
                if (!thisiscard) {
                    var groups = ['qun', 'holo', 'nijisanji', 'VirtuaReal', 'HappyElements', 'dotlive', 'upd8',
                        'eilene', 'paryi', 'kagura', 'nanashi', 'psp', 'asoul', 'nori', 'vwp',
                        'xuyan', 'chaos', 'xuefeng','hunmiao', 'ego', 'chidori', 'lucca',
                        'vshojo'
                    ];//'wei','shu','wu','key',
                    if (get.mode() == 'guozhan' || (get.mode() == 'versus' &amp;&amp; _status.mode != 'jiange')) groups = ['holo', 'nijisanji', 'vtuber', 'clubs'];
                    var bool1 = false;
                    var bool2 = false;
                    var bool3 = (get.mode() == 'guozhan' &amp;&amp; _status.forceKey != true &amp;&amp; get.config('onlyguozhan'));
                    var bool4 = false;
                    for (var i in lib.character) {
                        if (lib.character[i][1] == 'shen') {
                            bool1 = true;
                        }
                        if (bool3 || lib.character[i][1] == 'key') {
                            bool2 = true;
                        }
                        if (!bool4 &amp;&amp; get.is.double(i)) bool4 = true;
                        if (bool1 &amp;&amp; bool2 &amp;&amp; bool4) break;
                    }
                    if (bool1) groups.add('shen');
                    if (bool2 &amp;&amp; !bool3) groups.add('key');
                    if (bool4) groups.add('double');
                    var natures = ['water', 'soil', 'wood', 'metal'];
                    var span = document.createElement('span');
                    newlined.appendChild(span);
                    span.style.margin = '8px';
                    var clickGroup = function () {
                        if (_status.dragged) return;
                        if (dialog.currentcapt2 == '' &amp;&amp; dialog.currentcaptnode2 != this &amp;&amp; !dialog.currentcaptnode2.inited) {
                            dialog.currentcapt2 = null;
                            dialog.currentcaptnode2.classList.remove('thundertext');
                            dialog.currentcaptnode2.inited = true;
                            dialog.currentcaptnode2 = null;
                        }
                        var node = this, link = this.link;
                        if (node.classList.contains('thundertext')) {
                            dialog.currentgroup = null;
                            dialog.currentgroupnode = null;
                            node.classList.remove('thundertext');
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (dialog.currentcapt &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentcapt2 &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt, true)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else {
                                    dialog.buttons[i].classList.remove('nodisplay');
                                }
                            }
                        }
                        else {
                            if (dialog.currentgroupnode) {
                                dialog.currentgroupnode.classList.remove('thundertext');
                            }
                            dialog.currentgroup = link;
                            dialog.currentgroupnode = node;
                            node.classList.add('thundertext');
                            for (var i = 0; i &lt; dialog.buttons.length; i++) {
                                if (dialog.currentcapt &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentcapt2 &amp;&amp; dialog.buttons[i].capt != dialog.getCurrentCapt(dialog.buttons[i].link, dialog.buttons[i].capt, true)) {
                                    dialog.buttons[i].classList.add('nodisplay');
                                }
                                else if (dialog.currentgroup == 'double') {
                                    if (dialog.buttons[i]._changeGroup || dialog.buttons[i].group == 'ye') dialog.buttons[i].classList.remove('nodisplay');
                                    else dialog.buttons[i].classList.add('nodisplay');
                                }
                                else {
                                    if (dialog.buttons[i]._changeGroup || dialog.buttons[i].group == 'ye' || dialog.buttons[i].group != dialog.currentgroup) {
                                        dialog.buttons[i].classList.add('nodisplay');
                                    }
                                    else {
                                        dialog.buttons[i].classList.remove('nodisplay');
                                    }
                                }
                            }
                        }
                    };
                    for (var i = 0; i &lt; groups.length; i++) {
                        var span = ui.create.div('.tdnode.pointerdiv.shadowed.reduce_radius.reduce_margin');
                        span.style.margin = '3px';
                        newlined.appendChild(span);
                        span.innerHTML = lib.translate[groups[i] + '2'] ? get.translation(groups[i] + '2') : get.translation(groups[i]);
                        span.link = groups[i];
                        span._nature = natures[i];
                        span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickGroup);
                    }

                    var span = document.createElement('span');
                    newlined.appendChild(span);
                    span.style.margin = '8px';

                    packsource = ui.create.div('.tdnode.pointerdiv.shadowed.reduce_radius.reduce_margin');
                    packsource.style.margin = '3px';
                    newlined.appendChild(packsource);
                    var filternode = null;
                    var clickCaptNode = function (e) {
                        delete _status.filterCharacter;
                        ui.window.classList.remove('shortcutpaused');
                        filternode.delete();
                        filternode.classList.remove('shown');
                        clickCapt.call(this.link, e);
                    };
                    if (get.is.phoneLayout() &amp;&amp; lib.config.filternode_button) {
                        newlined.style.marginTop = '';
                        packsource.innerHTML = '';
                        filternode = ui.create.div('.popup-container.filter-character.modenopause');
                        ui.create.div(filternode);
                        filternode.listen(function (e) {
                            if (this.classList.contains('removing')) return;
                            delete _status.filterCharacter;
                            ui.window.classList.remove('shortcutpaused');
                            this.delete();
                            this.classList.remove('shown');
                            e.stopPropagation();
                        });
                        for (var i = 0; i &lt; node.childElementCount; i++) {
                            if (node.childNodes[i].tagName.toLowerCase() == 'span') {
                                node.childNodes[i].style.display = 'none';
                                node.childNodes[i].touchlink = ui.create.div(filternode.firstChild, clickCaptNode, '.menubutton.large.capt', node.childNodes[i].innerHTML);
                                node.childNodes[i].touchlink.link = node.childNodes[i];
                            }
                        }
                        ui.create.node('br', filternode.firstChild);
                    }
                    else {
                        if (onlypack) {
                            packsource.onlypack = true;
                            packsource.innerHTML = get.translation(onlypack + '_character_config');
                            packsource.style.display = 'none';
                            packsource.previousSibling.style.display = 'none';
                        }
                        else {
                            packsource.innerHTML = '';
                        }
                    }

                    newlined2 = document.createElement('div');
                    newlined2.style.marginTop = '5px';
                    newlined2.style.display = 'none';
                    newlined2.style.fontFamily = 'xinwei';
                    newlined2.classList.add('pointernode');
                    if (get.is.phoneLayout()) {
                        newlined2.style.fontSize = '32px';
                    }
                    else {
                        newlined2.style.fontSize = '22px';
                    }
                    newlined2.style.textAlign = 'center';
                    node.appendChild(newlined2);

                    packsource.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', function () {
                        if (packsource.onlypack) return;
                        if (_status.dragged) return;
                        if (get.is.phoneLayout() &amp;&amp; lib.config.filternode_button &amp;&amp; filternode) {
                            _status.filterCharacter = true;
                            ui.window.classList.add('shortcutpaused');
                            ui.window.appendChild(filternode);
                            ui.refresh(filternode);
                            filternode.classList.add('shown');
                            var dh = filternode.offsetHeight - filternode.firstChild.offsetHeight;
                            if (dh > 0) {
                                filternode.firstChild.style.top = (dh / 2) + 'px';
                            }
                            else {
                                filternode.firstChild.style.top = '';
                            }
                        }
                        else {
                            if (newlined2.style.display == 'none') {
                                newlined2.style.display = 'block';
                            }
                            else {
                                newlined2.style.display = 'none';
                            }
                        }
                    });
                    var packlist = [];
                    for (var i = 0; i &lt; lib.config.all.characters.length; i++) {
                        if (!lib.config.characters.contains(lib.config.all.characters[i])) continue;
                        packlist.push(lib.config.all.characters[i]);
                    }
                    for (var i in lib.characterPack) {
                        if (!lib.config.all.characters.contains(i)) {
                            packlist.push(i);
                        }
                    }
                    for (var i = 0; i &lt; packlist.length; i++) {
                        var span = document.createElement('div');
                        span.style.display = 'inline-block';
                        span.style.width = 'auto';
                        span.style.margin = '5px';
                        if (get.is.phoneLayout()) {
                            span.style.fontSize = '32px';
                        }
                        else {
                            span.style.fontSize = '22px';
                        }
                        span.innerHTML = lib.translate[packlist[i] + '_character_config'];
                        span.link = packlist[i];
                        span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickCapt);
                        newlined2.appendChild(span);
                        if (filternode &amp;&amp; !onlypack) {
                            span.touchlink = ui.create.div(filternode.firstChild, clickCaptNode, '.menubutton.large', span.innerHTML);
                            span.touchlink.link = span;
                        }
                    }
                }

                var groupSort;
                if (thisiscard) {
                    groupSort = function (name) {
                        var type = lib.card[name[2]].type;
                        if (lib.cardType[type]) {
                            return lib.cardType[type];
                        }
                        switch (type) {
                            case 'basic': return 0;
                            case 'chess': return 1.5;
                            case 'trick': return 2;
                            case 'delay': return 3;
                            case 'equip': return 4;
                            case 'zhenfa': return 5;
                            default: return 6;
                        }
                    };
                }
                else {
                    var getGroup = function (name) {
                        var group = get.is.double(name, true);
                        if (group) return group[0];
                        return lib.character[name][1];
                    },
                        groupSort = function (name) {
                            if (!lib.character[name]) return 50;
                            var group = getGroup(name);
                            if (group == 'vtuber') return 40;
                            if (group == 'clubs') return 41;
                            var list = get.groups();
                            if (list.contains(group)) return list.indexOf(group);
                            return 49;
                        };
                }
                list.sort(function (a, b) {
                    var del = groupSort(a) - groupSort(b);
                    if (del != 0) return del;
                    var aa = a, bb = b;
                    if (a.indexOf('_') != -1) {
                        a = a.slice(a.lastIndexOf('_') + 1);
                    }
                    if (b.indexOf('_') != -1) {
                        b = b.slice(b.lastIndexOf('_') + 1);
                    }
                    if (a != b) {
                        return a > b ? 1 : -1;
                    }
                    return aa > bb ? 1 : -1;
                });
                dialog = ui.create.dialog('hidden');
                dialog.classList.add('noupdate');
                dialog.classList.add('scroll1');
                dialog.classList.add('scroll2');
                dialog.classList.add('scroll3');
                dialog.addEventListener(lib.config.touchscreen ? 'touchend' : 'mouseup', function () {
                    _status.clicked2 = true;
                });
                if (heightset) {
                    dialog.style.height = ((game.layout == 'long2' || game.layout == 'nova') ? 380 : 350) + 'px';
                    dialog._scrollset = true;
                }
                dialog.getCurrentCapt = function (link, capt, noalph) {
                    var currentcapt = noalph ? this.currentcapt2 : this.currentcapt;
                    if (this.seperatelist &amp;&amp; noalph) {
                        if (this.seperatelist[currentcapt].contains(link)) return capt;
                        return null;
                    }
                    if (lib.characterDialogGroup[currentcapt]) {
                        return lib.characterDialogGroup[currentcapt](link, capt);
                    }
                    if (lib.characterPack[currentcapt]) {
                        if (lib.characterPack[currentcapt][link]) {
                            return capt;
                        }
                        return null;
                    }
                    return this.currentcapt;
                }
                if (str) {
                    dialog.add(str);
                }
                dialog.add(node);
                if (thisiscard) {
                    if (seperate) {
                        seperate = seperate(list);
                        dialog.seperate = [];
                        dialog.seperatelist = seperate.list;
                        if (dialog.seperatelist) {
                            newlined = document.createElement('div');
                            newlined.style.marginTop = '5px';
                            newlined.style.display = 'block';
                            newlined.style.fontFamily = 'xinwei';
                            if (get.is.phoneLayout()) {
                                newlined.style.fontSize = '32px';
                            }
                            else {
                                newlined.style.fontSize = '22px';
                            }
                            newlined.style.textAlign = 'center';
                            node.appendChild(newlined);
                            for (var i in dialog.seperatelist) {
                                var span = document.createElement('span');
                                span.style.margin = '3px';
                                span.innerHTML = i;
                                span.link = i;
                                span.seperate = true;
                                span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clickCapt);
                                newlined.appendChild(span);
                            }
                        }
                        for (var i in seperate) {
                            if (i == 'list') continue;
                            var link = '';
                            var linkcontent = seperate[i];
                            if (i.indexOf('_link:') != -1) {
                                link = i.slice(i.indexOf('_link:') + 6);
                                i = i.slice(0, i.indexOf('_link:'));
                            }
                            var nodesep = dialog.add(i);
                            nodesep.link = link;
                            dialog.seperate.push(nodesep);
                            dialog.add([linkcontent, 'vcard'], noclick);
                        }
                    }
                    else {
                        dialog.add([list, 'vcard'], noclick);
                    }
                }
                else {
                    if (precharacter) {
                        dialog.add([list, 'precharacter'], noclick);
                    }
                    else if (characterx) {
                        dialog.add([list, 'characterx'], noclick);
                    }
                    else {
                        dialog.add([list, 'character'], noclick);
                    }
                }
                dialog.add(ui.create.div('.placeholder'));
                for (i = 0; i &lt; dialog.buttons.length; i++) {
                    if (thisiscard) {
                        dialog.buttons[i].capt = getCapt(dialog.buttons[i].link[2]);
                    }
                    else {
                        dialog.buttons[i].group = lib.character[dialog.buttons[i].link][1];
                        dialog.buttons[i].capt = getCapt(dialog.buttons[i].link);
                    }
                }
                if (!expandall) {
                    if (!thisiscard &amp;&amp; (lib.characterDialogGroup[lib.config.character_dialog_tool] ||
                        lib.config.character_dialog_tool == '')) {
                        clickCapt.call(node[lib.config.character_dialog_tool]);
                    }
                }
                return dialog;
            },
            dialog: function () {
                var i, small = null;
                var hidden = false;
                var notouchscroll = false;
                var forcebutton = false;
                var dialog = ui.create.div('.dialog');
                dialog.contentContainer = ui.create.div('.content-container', dialog);
                dialog.content = ui.create.div('.content', dialog.contentContainer);
                dialog.bar1 = ui.create.div('.bar.top', dialog);
                dialog.bar2 = ui.create.div('.bar.bottom', dialog);
                dialog.buttons = [];
                for (i in lib.element.dialog) {
                    dialog[i] = lib.element.dialog[i];
                }
                for (i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'boolean') dialog.static = arguments[i];
                    else if (arguments[i] == 'hidden') hidden = true;
                    else if (arguments[i] == 'notouchscroll') notouchscroll = true;
                    else if (arguments[i] == 'forcebutton') forcebutton = true;
                    else if (arguments[i] == 'small') small = true;
                    else {
                        dialog.add(arguments[i], small, small);
                    }
                }
                if (!hidden) {
                    dialog.open();
                }
                if (!lib.config.touchscreen) dialog.contentContainer.onscroll = ui.update;
                if (!notouchscroll) {
                    dialog.contentContainer.ontouchstart = ui.click.dialogtouchStart;
                    dialog.contentContainer.ontouchmove = ui.click.touchScroll;
                    dialog.contentContainer.style.WebkitOverflowScrolling = 'touch';
                    dialog.ontouchstart = ui.click.dragtouchdialog;
                }
                if (forcebutton) {
                    dialog.forcebutton = true;
                    dialog.classList.add('forcebutton');
                }
                return dialog;
            },
            line2: function () {
                var node = ui.create.line.apply(this, arguments);
                node.classList.add('line2');
                return node;
            },
            line: function () {
                var two = false, func;
                var node = ui.create.div('.config');
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'string' || typeof arguments[i] == 'number') {
                        if (two) ui.create.div('.toggle', node).innerHTML = arguments[i];
                        else {
                            ui.create.div(node).innerHTML = arguments[i];
                            two = true;
                        }
                    }
                    else if (typeof arguments[i] == 'function') func = arguments[i];
                }
                if (func) {
                    for (var i = 0; i &lt; node.childNodes.length; i++) node.childNodes[i].listen(func);
                }
                return node;
            },
            switcher: function (name, current, current2) {
                var func;
                var node = ui.create.div('.config');
                ui.create.div(node).innerHTML = get.translation(name + '_config');
                var switcher = ui.create.div('.toggle.pointerdiv', node);
                switcher.name = name;
                for (var i = 0; i &lt; arguments.length; i++) {
                    if (typeof arguments[i] == 'function') {
                        func = arguments[i]; break;
                    }
                }
                if (typeof current == 'string') {
                    switcher.link = current;
                    switcher.innerHTML = get.translation(current);
                    switcher.contentEditable = true;
                    switcher.style.webkitUserSelect = 'text';
                    switcher.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.editor);
                }
                else if (typeof current == 'object') {
                    switcher.link = current2 || current[0];
                    switcher.innerHTML = get.translation(switcher.link);
                    switcher.choice = current;
                    switcher.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.switcher);
                }
                else {
                    if (current) {
                        switcher.classList.add('on');
                    }
                    switcher.classList.add('onoff');
                    ui.create.div(ui.create.div(switcher));
                    switcher.link = current ? true : false;
                    switcher.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.toggle);
                }
                if (func) switcher.additionalCommand = func;
                return node;
            },
            caption: function (str, position) {
                var caption = ui.create.div('.caption', position);
                caption.innerHTML = str;
                return caption;
            },
            /**
             * 
             * @function
             * @param {?Array} controls 
             * @param {?string} stayleft 
             * @param {?function} clickCallback 
             * @returns {HTMLDivElement} 
             */
            control: function () {
                var nc = !ui.control.querySelector('div:not(.removing):not(.stayleft)');
                // for(var i=0;i&lt;ui.control.childNodes.length;i++){
                //     if(ui.control.childNodes[i].classList.contains('removing')){
                //         var that=ui.control.childNodes[i];
                //         var width=that.offsetWidth;
                //         that.style.marginLeft=(-width/2)+'px';
                //         that.style.marginRight=(-width/2)+'px';
                //         that.style.transitionDuration=0.8*parseFloat(getComputedStyle(that).opacity)+'s';
                //     }
                // }
                var i, controls;
                var nozoom = false;
                if (Array.isArray(arguments[0])) controls = arguments[0];
                else controls = arguments;
                var control = ui.create.div('.control');
                ui.control.insertBefore(control, _status.createControl || ui.confirm);
                for (i in lib.element.control) {
                    control[i] = lib.element.control[i];
                }
                for (i = 0; i &lt; controls.length; i++) {
                    if (typeof controls[i] == 'function') {
                        control.custom = controls[i];
                    }
                    else if (controls[i] == 'nozoom') {
                        nozoom = true;
                    }
                    else if (controls[i] == 'stayleft') {
                        control.stayleft = true;
                        control.classList.add('stayleft');
                    }
                    else {
                        control.add(controls[i]);
                    }
                }
                ui.controls.unshift(control);
                if (nc) {
                    ui.control.animate('nozoom', 100);
                }
                // if(ui.control.classList.contains('nozoom')){
                //     nozoom=true;
                // }
                // if(nozoom){
                //     control.classList.add('nozoom');
                // }
                if (control.childNodes.length) {
                    // if(nozoom||true){
                    control.style.transition = 'opacity 0.5s';
                    control.animate('controlpressdownx', 500);
                    // }
                    // else{
                    //     control.style.transition='';
                    //     control.style.transform='scale(0.8)';
                    // }
                    ui.refresh(control);
                    if (!control.stayleft) {
                        control.style.transform = 'translateX(-' + (control.offsetWidth / 2) + 'px)';
                    }
                    control.style.opacity = 1;
                    ui.refresh(control);
                    control.style.transition = '';
                }

                control.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.control2);

                if (lib.config.button_press) {
                    control.addEventListener(lib.config.touchscreen ? 'touchstart' : 'mousedown', function () {
                        if (this.classList.contains('disabled')) return;
                        this.classList.add('controlpressdown');
                        if (typeof this._offset == 'number') {
                            this.style.transform = 'translateX(' + this._offset + 'px) scale(0.97)';
                        }
                    });
                    control.addEventListener(lib.config.touchscreen ? 'touchend' : 'mouseup', function () {
                        this.classList.remove('controlpressdown');
                        if (typeof this._offset == 'number') {
                            this.style.transform = 'translateX(' + this._offset + 'px)';
                        }
                    });
                }

                ui.updatec();
                return control;
            },
            confirm: function (str, func) {
                if (ui.confirm &amp;&amp; ui.confirm.str == str) {
                    return;
                }
                if (str == 'o') {
                    if (ui.confirm) {
                        ui.confirm.replace('ok');
                    }
                    else {
                        ui.confirm = ui.create.control('ok');
                    }
                }
                else if (str == 'oc' || str == 'co') {
                    if (ui.confirm) {
                        ui.confirm.replace('ok', 'cancel');
                    }
                    else {
                        ui.confirm = ui.create.control('ok', 'cancel');
                    }
                }
                else if (str == 'c') {
                    if (ui.confirm) {
                        ui.confirm.replace('cancel');
                    }
                    else {
                        ui.confirm = ui.create.control('cancel');
                    }
                }
                else if (ui.confirm) {
                    ui.confirm.close();
                    delete ui.confirm;
                }
                if (ui.confirm) {
                    ui.confirm.str = str;
                    if (func) ui.confirm.custom = func;
                    else delete ui.confirm.custom;
                }
            },
            skills: function (skills) {
                var i, same;
                if (ui.skills) {
                    if (ui.skills.skills.length == skills.length &amp;&amp; ui.skills.style.display != 'none') {
                        same = true;
                        for (i = 0; i &lt; skills.length; i++) {
                            if (ui.skills.skills.contains(skills[i]) == false) {
                                same = false;
                                break;
                            }
                        }
                    }
                    if (same) return;
                    ui.skills.close();
                    delete ui.skills;
                }
                if (skills == undefined || skills.length == 0) return;
                if (!_status.event.isMine()) {
                    _status.noupdatec = true;
                }
                ui.skills = ui.create.control(skills.concat([ui.click.skill]));
                for (var i = 0; i &lt; ui.skills.childNodes.length; i++) {
                    ui.skills.childNodes[i].innerHTML = get.skillTranslation(ui.skills.childNodes[i].link, _status.event.player);
                }
                if (!_status.event.isMine()) {
                    ui.skills.style.display = 'none';
                }
                else {
                    ui.updatec();
                }
                _status.noupdatec = false;
                ui.skills.skills = skills;
                return ui.skills;
            },
            skills2: function (skills) {
                var i, same;
                if (ui.skills2) {
                    if (ui.skills2.skills.length == skills.length &amp;&amp; ui.skills2.style.display != 'none') {
                        same = true;
                        for (i = 0; i &lt; skills.length; i++) {
                            if (ui.skills2.skills.contains(skills[i]) == false) {
                                same = false;
                                break;
                            }
                        }
                    }
                    if (same) return;
                    ui.skills2.close();
                    delete ui.skills2;
                }
                if (skills == undefined || skills.length == 0) return;
                if (!_status.event.isMine()) {
                    _status.noupdatec = true;
                }
                ui.skills2 = ui.create.control(skills.concat([ui.click.skill]));
                for (var i = 0; i &lt; ui.skills2.childNodes.length; i++) {
                    ui.skills2.childNodes[i].innerHTML = get.skillTranslation(ui.skills2.childNodes[i].link, _status.event.player);
                }
                if (!_status.event.isMine()) {
                    ui.skills2.style.display = 'none';
                }
                else {
                    ui.updatec();
                }
                _status.noupdatec = false;
                ui.skills2.skills = skills;
                return ui.skills2;
            },
            skills3: function (skills) {
                var i, same;
                if (ui.skills3) {
                    if (ui.skills3.skills.length == skills.length &amp;&amp; ui.skills3.style.display != 'none') {
                        same = true;
                        for (i = 0; i &lt; skills.length; i++) {
                            if (ui.skills3.skills.contains(skills[i]) == false) {
                                same = false;
                                break;
                            }
                        }
                    }
                    if (same) return;
                    ui.skills3.close();
                    delete ui.skills3;
                }
                if (skills == undefined || skills.length == 0) return;
                if (!_status.event.isMine()) {
                    _status.noupdatec = true;
                }
                ui.skills3 = ui.create.control(skills.concat([ui.click.skill]));
                for (var i = 0; i &lt; ui.skills3.childNodes.length; i++) {
                    ui.skills3.childNodes[i].innerHTML = get.skillTranslation(ui.skills3.childNodes[i].link, _status.event.player);
                }
                if (!_status.event.isMine()) {
                    ui.skills3.style.display = 'none';
                }
                else {
                    ui.updatec();
                }
                _status.noupdatec = false;
                ui.skills3.skills = skills;
                return ui.skills3;
            },
            arena: function () {
                var i, j;
                ui.window = ui.create.div('#window.hidden', document.body);
                ui.create.div('#statusbg', document.body);
                ui.refresh(ui.window);
                if (!localStorage.getItem(lib.configprefix + 'playback')) {
                    ui.window.show();
                }
                else {
                    setTimeout(function () {
                        ui.window.show();
                    }, 1000);
                }
                // lib.setPressure(ui.window,ui.click.pressurepause);
                if (window.isNonameServer) {
                    ui.window.classList.add('server');
                    var serverinfo = ui.create.div('.serverinfo', ui.window);
                    ui.create.div('', '', serverinfo);
                    var serverinfotable = ui.create.table(2, 2, ui.create.div(serverinfo));
                    serverinfotable.style.display = 'inline-block';
                    serverinfotable.firstChild.firstChild.innerHTML = '';
                    serverinfotable.firstChild.lastChild.id = 'server_count';
                    serverinfotable.firstChild.lastChild.innerHTML = '0';
                    serverinfotable.lastChild.firstChild.innerHTML = '';
                    serverinfotable.lastChild.lastChild.id = 'server_status';
                    serverinfotable.lastChild.lastChild.innerHTML = '';
                    ui.create.div('.menubutton.large', '', function () {
                        if (_status.gameStarted &amp;&amp; !confirm('')) {
                            return;
                        }
                        localStorage.removeItem(lib.configprefix + 'asserver');
                        game.reload();
                    }, ui.create.div('', serverinfo));
                }

                ui.window.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.window);
                ui.system = ui.create.div("#system.", ui.window);
                ui.arena = ui.create.div('#arena.nome', ui.window);
                if (lib.device == 'ios' &amp;&amp; !get.is.phoneLayout()) {
                    ui.arena.classList.add('ipad');
                }
                ui.arena.setNumber = function (num) {
                    this.dataset.number = num;
                    // if(game.layout=='nova'&amp;&amp;parseInt(num)&lt;7){
                    //     ui.arena.classList.add('player_autolong');
                    // }
                    // else if(lib.config.player_height_nova!='long'){
                    //     ui.arena.classList.remove('player_autolong');
                    // }
                    // if(game.layout=='long'&amp;&amp;parseInt(num)&lt;parseInt(lib.config.fewplayer)){
                    //     this.classList.add('fewplayer');
                    // }
                    // else{
                    //     this.classList.remove('fewplayer');
                    // }
                }

                if (lib.config.low_performance) {
                    ui.window.classList.add('low_performance');
                }
                if (game.layout == 'mobile' || game.layout == 'long') {
                    ui.arena.classList.add('mobile');
                }
                if (game.layout == 'long' || game.layout == 'long2') {
                    ui.arena.classList.add('long');
                }
                if (game.layout == 'default') {
                    ui.arena.classList.add('oldlayout');
                }
                if (lib.config.player_border != 'wide' || game.layout == 'long' || game.layout == 'long2') {
                    ui.arena.classList.add('slim_player');
                }
                if (lib.config.player_border == 'slim') {
                    ui.arena.classList.add('uslim_player');
                }
                if (lib.config.player_border == 'narrow') {
                    ui.arena.classList.add('mslim_player');
                }
                if (lib.config.player_border == 'normal' &amp;&amp; lib.config.mode != 'brawl' &amp;&amp; (game.layout == 'long' || game.layout == 'long2')) {
                    ui.arena.classList.add('lslim_player');
                }
                ui.window.dataset.player_border = lib.config.player_border;
                if (lib.config.compatiblemode) {
                    ui.window.classList.add('compatiblemode');
                }
                ui.window.dataset.radius_size = lib.config.radius_size || 'default';
                if (game.layout == 'long' || game.layout == 'mobile') {
                    if (lib.config.textequip == 'text') ui.arena.classList.add('textequip');
                }
                if (game.layout == 'long' || game.layout == 'long2' || game.layout == 'mobile' || game.layout == 'nova') {
                    if (lib.config.cardshape == 'oblong') {
                        ui.window.classList.add('oblongcard');
                        ui.arena.classList.add('oblongcard');
                    }
                }
                if (lib.config.blur_ui) {
                    ui.window.classList.add('blur_ui');
                }
                if (lib.config.glass_ui) {
                    ui.window.classList.add('glass_ui');
                }
                if (lib.config.custom_button) {
                    lib.configMenu.appearence.config.custom_button.onclick('skip');
                }

                if (lib.config.show_statusbar_ios == 'overlay') {
                    document.body.classList.add('statusbar');
                }
                if (lib.config.keep_awake) {
                    if (window.plugins &amp;&amp; window.plugins.insomnia) window.plugins.insomnia.keepAwake();
                    else {
                        lib.init.js(lib.assetURL + 'game', 'NoSleep', function () {
                            var noSleep = new NoSleep();
                            document.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', function enableNoSleep() {
                                document.removeEventListener(lib.config.touchscreen ? 'touchend' : 'click', enableNoSleep, false);
                                noSleep.enable();
                                window.noSleep = noSleep;
                            }, false);
                        });
                    }
                }
                lib.init.js(lib.assetURL + 'game', 'keyWords', function () { });

                lib.updateURL = lib.updateURLS[lib.config.update_link] || lib.updateURLS.coding;

                lib.init.cssstyles();

                ui.arena.dataset.player_height = lib.config.player_height || 'default';
                ui.arena.dataset.player_height_nova = lib.config.player_height_nova || 'default';
                // if(lib.config.player_height_nova=='long') ui.arena.classList.add('player_autolong');
                ui.arena.dataset.target_shake = lib.config.target_shake || 'off';
                ui.backgroundMusic = document.createElement('audio');
                ui.backgroundMusic.volume = lib.config.volumn_background / 8;
                game.playBackgroundMusic();
                ui.backgroundMusic.autoplay = true;
                ui.backgroundMusic.addEventListener('ended', game.playBackgroundMusic);
                ui.window.appendChild(ui.backgroundMusic);
                if (lib.config.cursor_style == 'pointer') {
                    ui.window.classList.add('nopointer');
                }
                if (lib.config.turned_style == false) {
                    ui.arena.classList.add('hide_turned');
                }
                if (lib.config.link_style2 != 'chain') {
                    ui.arena.classList.add('nolink');
                }
                if (lib.config.show_name == false) {
                    ui.arena.classList.add('hide_name');
                }
                if (lib.config.change_skin_auto != 'off') {
                    _status.skintimeout = setTimeout(ui.click.autoskin, parseInt(lib.config.change_skin_auto));
                }
                if (lib.config.border_style &amp;&amp; lib.config.border_style.indexOf('dragon_') == 0) {
                    ui.arena.dataset.framedecoration = lib.config.border_style.slice(7);
                }

                ui.gameinfo = ui.create.div('#time', ui.window);

                ui.arenalog = ui.create.div('#arenalog', ui.arena);
                if (lib.config.show_log == 'off') {
                    ui.arenalog.style.display = 'none';
                }
                else {
                    ui.arenalog.dataset.position = lib.config.show_log;
                }
                ui.historybar = ui.create.div('#historybar.shadowed', ui.window);
                lib.setScroll(ui.historybar);

                ui.roundmenu = ui.create.div('#roundmenu.roundarenabutton.menubutton.round', ui.arena);
                ui.roundmenu._position = [180, 210];
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);

                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);

                ui.create.div(ui.roundmenu);
                ui.create.div(ui.roundmenu);

                ui.create.div(ui.roundmenu);

                if (lib.config.show_time2) {
                    ui.roundmenu.classList.add('clock');
                }
                ui.roundmenu.dataset.watchface = lib.config.watchface || 'none';
                if (get.is.phoneLayout()) {
                    if (lib.config.show_time3) {
                        ui.time3 = ui.create.div('.touchinfo.left', ui.window);
                    }
                    ui.cardPileNumber = ui.create.div('.touchinfo.right', ui.window);
                }
                else {
                    if (lib.config.show_time3) {
                        ui.time3 = ui.create.div(ui.gameinfo);
                    }
                    ui.cardPileNumber = ui.create.div(ui.gameinfo);
                }
                if (!lib.config.show_cardpile_number) {
                    ui.cardPileNumber.style.display = 'none';
                }
                if (ui.time3) {
                    ui.time3.starttime = get.utc();
                    ui.time3.interval = setInterval(function () {
                        var num = Math.round((get.utc() - ui.time3.starttime) / 1000);
                        if (num >= 3600) {
                            var num1 = Math.floor(num / 3600);
                            var num2 = Math.floor((num - num1 * 3600) / 60);
                            if (num2 &lt; 10) {
                                num2 = '0' + num2.toString();
                            }
                            var num3 = num - num1 * 3600 - parseInt(num2) * 60;
                            if (num3 &lt; 10) {
                                num3 = '0' + num3.toString();
                            }
                            ui.time3.innerHTML = num1 + ':' + num2 + ':' + num3;
                        }
                        else {
                            var num1 = Math.floor(num / 60);
                            var num2 = num - num1 * 60;
                            if (num2 &lt; 10) {
                                num2 = '0' + num2.toString();
                            }
                            ui.time3.innerHTML = num1 + ':' + num2;
                        }
                    }, 1000);
                }
                if (get.is.nomenu()) {
                    if (!['menu', 'system'].contains(lib.config.round_menu_func)) {
                        lib.config.round_menu_func = 'system';
                    }
                }
                else if (!lib.config.show_round_menu) {
                    ui.roundmenu.style.display = 'none';
                }

                var resetround = function (e) {
                    _status.draggingroundmenu = false;
                    ui.roundmenu.style.transform = '';
                    ui.roundmenu._dragtransform = [0, 0];
                    ui.roundmenu.style.transition = 'all 0.3s';
                    delete ui.roundmenu._dragtouches;
                    delete ui.roundmenu._dragorigin;
                    delete ui.roundmenu._dragorigintransform;
                    setTimeout(function () {
                        ui.roundmenu.style.transition = '';
                    }, 500);
                    game.saveConfig('roundmenu_transform', [0, 0]);
                    if (e) e.stopPropagation();
                    return false;
                };
                ui.click.resetround = resetround;
                if (lib.config.touchscreen) {
                    ui.roundmenu.addEventListener('touchstart', function (e) {
                        _status.draggingroundmenu = true;
                        ui.roundmenu._dragorigin = {
                            clientX: e.touches[0].clientX,
                            clientY: e.touches[0].clientY,
                        };
                        if (!ui.roundmenu._dragtransform) {
                            ui.roundmenu._dragtransform = [0, 0];
                        }
                        ui.roundmenu._dragorigintransform = ui.roundmenu._dragtransform.slice(0);
                        ui.roundmenu._resetTimeout = setTimeout(function () {
                            resetround();
                            delete ui.roundmenu._resetTimeout;
                        }, 1000);
                    });
                }
                else {
                    ui.roundmenu.oncontextmenu = resetround;
                }
                if (!lib.config.remember_round_button) {
                    game.saveConfig('roundmenu_transform');
                }
                if (lib.config.roundmenu_transform) {
                    var translate = lib.config.roundmenu_transform;
                    ui.roundmenu._dragtransform = translate;
                    ui.roundmenu.style.transform = 'translate(' + translate[0] + 'px,' + translate[1] + 'px)';
                    ui.click.checkroundtranslate();
                }
                if (get.is.phoneLayout()) {
                    ui.arena.classList.add('phone');
                }

                ui.sidebar = ui.create.div('#sidebar');
                ui.sidebar3 = ui.create.div('#sidebar3');
                ui.canvas = document.createElement('canvas');

                ui.arena.appendChild(ui.canvas);
                ui.canvas.id = 'canvas';
                ui.ctx = ui.canvas.getContext('2d');

                ui.sidebar.ontouchstart = ui.click.touchStart;
                ui.sidebar.ontouchmove = ui.click.touchScroll;
                ui.sidebar.style.WebkitOverflowScrolling = 'touch';

                var zoom;
                switch (lib.config.ui_zoom) {
                    case 'esmall': zoom = 0.8; break;
                    case 'vsmall': zoom = 0.9; break;
                    case 'small': zoom = 0.93; break;
                    case 'big': zoom = 1.05; break;
                    case 'vbig': zoom = 1.1; break;
                    case 'ebig': zoom = 1.2; break;
                    default: zoom = 1;
                }
                game.documentZoom = game.deviceZoom * zoom;
                if (zoom != 1) {
                    ui.updatez();
                }

                ui.system1 = ui.create.div('#system1', ui.system);
                ui.system2 = ui.create.div('#system2', ui.system);

                ui.replay = ui.create.system('', game.reload, true);
                ui.replay.id = 'restartbutton';
                ui.config2 = ui.create.system('', ui.click.config);
                ui.pause = ui.create.system('', ui.click.pause);
                ui.pause.id = 'pausebutton';
                if (!_status.video) {
                    ui.pause.hide();
                }
                if (!lib.config.touchscreen) {
                    lib.setPopped(ui.pause, ui.click.pausehistory, 220, 400, null, true);
                }
                if (!lib.config.show_pause) {
                    ui.pause.style.display = 'none';
                }
                ui.cardPileButton = ui.create.system('', null, true);
                ui.cardPileButton.style.display = 'none';
                lib.setPopped(ui.cardPileButton, ui.click.cardPileButton, 220);
                ui.wuxie = ui.create.system('', ui.click.wuxie, true);
                if (!lib.config.touchscreen) {
                    lib.setPopped(ui.config2, ui.click.pauseconfig, 170);
                }
                ui.auto = ui.create.system('', ui.click.auto);
                if (!game.syncMenu) {
                    ui.config2.classList.add('hidden');
                    ui.config2.style.transition = 'all 0.5s';
                    ui.roundmenu.classList.add('transparent2');

                    ui.auto.style.opacity = 0.5;
                    ui.auto.style.transition = 'all 0.5s';
                    lib.onfree.push(function () {
                        ui.auto.style.opacity = '';
                        setTimeout(function () {
                            ui.auto.style.transition = '';
                        }, 500);
                    });
                }
                ui.auto.id = 'autobutton';
                ui.autonode = ui.create.div('#autonode', '&lt;div>...&lt;/div>', ui.arena);
                ui.autonode.listen(ui.click.auto);
                if (lib.config.mode == 'connect') {
                    ui.auto.hide();
                    ui.pause.hide();
                }

                if (lib.forcehide) {
                    if (lib.forcehide.contains('replay')) ui.replay.classList.add('forcehide');
                    if (lib.forcehide.contains('auto')) ui.auto.classList.add('forcehide');
                    if (lib.forcehide.contains('pause')) ui.pause.classList.add('forcehide');
                    if (lib.forcehide.contains('wuxie')) ui.wuxie.classList.add('forcehide');
                    if (lib.forcehide.contains('cardPileButton')) ui.cardPileButton.classList.add('forcehide');
                }
                ui.volumn = ui.create.system('');
                lib.setPopped(ui.volumn, ui.click.volumn, 200);
                // if(lib.config.show_pause) ui.auto.style.marginLeft='10px';
                if (!lib.config.show_volumn) {
                    ui.volumn.style.display = 'none';
                }
                if (!lib.config.show_auto) {
                    ui.auto.style.display = 'none';
                }
                if (!lib.config.show_wuxie) {
                    ui.wuxie.style.display = 'none';
                }
                // if(!lib.config.show_cardpile||_status.connectMode){
                //     ui.cardPileButton.style.display='none';
                // }

                ui.sortCard = ui.create.system('', function () {
                    if (!game.me) return;
                    var hs = game.me.getCards('h');
                    if (!hs.length) return;
                    game.addVideo('lose', game.me, [get.cardsInfo(hs), [], [], []]);
                    for (var i = 0; i &lt; hs.length; i++) {
                        hs[i].goto(ui.special);
                    }
                    hs.sort(function (b, a) {
                        if (a.name != b.name) return lib.sort.card(a.name, b.name);
                        else if (a.suit != b.suit) return lib.suit.indexOf(a) - lib.suit.indexOf(b);
                        else return a.number - b.number;
                    });
                    game.me.directgain(hs, false);
                });
                if (!lib.config.show_sortcard) {
                    ui.sortCard.style.display = 'none';
                }
                if (lib.config.mode != 'yindao') {
                    ui.playerids = ui.create.system('', function () {
                        if (game.showIdentity) {
                            game.showIdentity();
                            _status.identityShown = true;
                        }
                    }, true);
                    if (!lib.config.show_playerids || !game.showIdentity) {
                        ui.playerids.style.display = 'none';
                    }
                }
                if (!lib.config.show_replay) {
                    ui.replay.style.display = 'none';
                }
                ui.control = ui.create.div('#control', ui.arena).animate('nozoom');
                ui.cardPile = ui.create.div('#cardPile');
                ui.discardPile = ui.create.div('#discardPile');
                ui.special = ui.create.div('#special');
                ui.ordering = ui.create.div('#ordering');
                ui.dialogs = [];
                ui.controls = [];
                ui.style = {};

                ui.time = ui.create.div(ui.gameinfo);
                var timeInterval = function () {
                    var date = new Date();
                    var hours = date.getHours();
                    var minutes = date.getMinutes();
                    if (lib.config.watchface == 'simple') {
                        ui.roundmenu.childNodes[13].style.transform = 'rotate(' + get.round((hours + 9) * 30, 2) + 'deg)';
                    }
                    else {
                        ui.roundmenu.childNodes[13].style.transform = 'rotate(' + get.round((hours + minutes / 60 + 9) * 30, 2) + 'deg)';
                    }
                    ui.roundmenu.childNodes[12].style.transform = 'rotate(' + (minutes + 45) * 6 + 'deg)';
                    if (minutes &lt; 10) {
                        minutes = '0' + minutes.toString();
                    }
                    ui.time.innerHTML = hours + ':' + minutes;
                };
                _status.timeInterval = setInterval(timeInterval, 30000);
                timeInterval();
                if (!lib.config.show_time) {
                    ui.time.style.display = 'none';
                }

                ui.timer = ui.create.div('.skillbar.shadowed.playerbg.hidden');
                ui.timer.id = 'timer';
                ui.create.div('.skillbarshadow', ui.timer);
                ui.create.div('.skillbarfill', ui.timer);
                ui.timer.fillnode = ui.create.div(ui.timer.lastChild);
                ui.timer.popnode = ui.create.div('.skillbartext', ui.timer);
                ui.timer.popnode.style.opacity = 1;
                ui.timer.position = 4;
                ui.timer.style.zIndex = 5;
                ui.timer.set = function (text, percentage) {
                    if (typeof text == 'string' || typeof text == 'number') {
                        ui.timer.popnode.innerHTML = text;
                    }
                    ui.timer.fillnode.style.top = ((1 - percentage) * 100) + '%';
                }
                var setTimerPosition = function (e) {
                    this.position++;
                    if (this.position > 4) {
                        this.position = 1;
                    }
                    var left1 = '180px';
                    var left2 = 'calc(100% - 245px)';
                    var top1 = '210px';
                    var top2 = 'calc(100% - 245px)';
                    if (game.layout == 'default') {
                        left1 = '265px';
                        top1 = '160px';
                        left2 = 'calc(100% - 330px)';
                        top2 = 'calc(100% - 235px)';
                    }
                    if (this.position == 1 || this.position == 2) {
                        this.style.top = top2;
                    }
                    else {
                        this.style.top = top1;
                    }
                    if (this.position == 1 || this.position == 4) {
                        this.style.left = left2;
                    }
                    else {
                        this.style.left = left1;
                    }
                }
                ui.timer.listen(setTimerPosition);

                ui.shortcut = ui.create.div('#shortcut.hidden', ui.window);
                ui.shortcut.listen(ui.click.shortcut);
                ui.create.div(ui.shortcut, function (e) { e.stopPropagation() });
                ui.create.div('.menubutton.round', '&lt;span>&lt;/span>', ui.shortcut, game.reload).dataset.position = 1;
                ui.create.div('.menubutton.round', '&lt;span>&lt;/span>', ui.shortcut, game.exit).dataset.position = 3;
                ui.create.div('.menubutton.round', '&lt;span>&lt;/span>', ui.shortcut, ui.click.pause).dataset.position = 4;
                ui.shortcut.autobutton = ui.create.div('.menubutton.round', '&lt;span>&lt;/span>', ui.shortcut, ui.click.auto);
                ui.shortcut.autobutton.dataset.position = 2;
                ui.favmodelist = ui.create.div('.favmodelist', ui.shortcut);
                ui.favmodelist.update = function () {
                    this.innerHTML = '';
                    var num = Math.min(6, lib.config.favouriteMode.length);
                    for (var i = 0; i &lt; num; i++) {
                        this.add(lib.config.favouriteMode[i], i);
                    }
                    var mode = get.mode();
                    if (typeof get.config(mode + '_mode') == 'string') {
                        mode += '|' + get.config(mode + '_mode');
                    }
                    if (lib.config.favouriteMode.contains(mode)) {
                        ui.favmode.classList.add('glow');
                    }
                    else {
                        ui.favmode.classList.remove('glow');
                    }
                };
                ui.favmodelist.add = function (name, index) {
                    var info = name.split('|');
                    var mode = info[0];
                    var submode = info[1];
                    var node = ui.create.div('.menubutton.large', this);
                    var num = Math.min(6, lib.config.favouriteMode.length);
                    node.dataset.type = num % 2 == 0 ? 'even' : 'odd';
                    node.dataset.position = index;
                    var str = lib.translate[name] || lib.translate[mode] || '';
                    if (str.length == 2) {
                        str += '';
                    }
                    node.innerHTML = str;
                    node.listen(function () {
                        game.saveConfig('mode', mode);
                        if (submode) {
                            game.saveConfig(mode + '_mode', submode, mode);
                        }
                        game.reload();
                    });
                };
                ui.favmode = ui.create.system('', function () {
                    var mode = get.mode();
                    if (typeof _status.mode == 'string') {
                        mode += '|' + _status.mode;
                    }
                    if (this.classList.contains('glow')) {
                        this.classList.remove('glow');
                        lib.config.favouriteMode.remove(mode);
                    }
                    else {
                        this.classList.add('glow');
                        lib.config.favouriteMode.add(mode);
                    }
                    game.saveConfig('favouriteMode', lib.config.favouriteMode);
                    ui.favmodelist.update();
                    _status.clicked = true;
                });
                ui.favmode.style.display = 'none';
                ui.favmodelist.update();
                // ui.create.div('.menubutton.round','&lt;span>&lt;/span>',ui.shortcut,ui.click.config).dataset.position=5;


                if (_status.connectMode) {
                    ui.playerids.remove();
                    ui.pause.innerHTML = '';
                }
                setTimerPosition.call(ui.timer);
                ui.arena.appendChild(ui.timer);

                if (!game.syncMenu) {
                    lib.onfree.push(function () {
                        ui.create.menu();
                        ui.config2.classList.remove('hidden');
                        ui.roundmenu.classList.remove('transparent2');
                        setTimeout(function () {
                            ui.config2.style.transition = '';
                        }, 500);
                    });
                }
                else {
                    ui.create.menu();
                }

                lib.status.date = new Date();
                lib.status.dateDelayed = 0;

                while (lib.arenaReady.length) {
                    (lib.arenaReady.shift())();
                }
                delete lib.arenaReady;
                if (lib.config.auto_check_update) {
                    setTimeout(function () {
                        game.checkForUpdate(false);
                    }, 3000);
                }
                if (!lib.config.asset_version) {
                    lib.onfree.push(function () {
                        setTimeout(function () {
                            if (!game.download) {
                                game.saveConfig('asset_version', '');
                            }
                            else {
                                var func = function () {
                                    if (confirm('275MB')) {
                                        if (!ui.arena.classList.contains('menupaused')) {
                                            ui.click.configMenu();
                                            ui.click.menuTab('');
                                        }
                                        setTimeout(game.checkForAssetUpdate, 500);
                                    }
                                    else {
                                        game.saveConfig('asset_version', '');
                                    }
                                }
                                if (_status.new_tutorial) {
                                    _status.new_tutorial = func;
                                }
                                else {
                                    func();
                                }
                            }
                        }, 3000);
                    });
                }
                if (localStorage.getItem(lib.configprefix + 'playback')) {
                    setTimeout(lib.init.onfree);
                }

                if (lib.config.test_game) {
                    ui.window.classList.add('testing');
                    lib.config.game_speed = 'vfast';
                    lib.config.low_performance = true;
                    lib.config.animation = false;
                    _status.auto = true;
                    ui.auto.classList.add('glow');
                    setTimeout(function () {
                        var node = ui.create.pause().animate('start');
                        node.appendChild(ui.sidebar);
                        node.firstChild.innerHTML = '';
                        node.removeEventListener('click', ui.click.resume);
                    }, 500);
                }
            },
            system: function (str, func, right, before) {
                var parent = right ? ui.system2 : ui.system1;
                var node = ui.create.div();
                if (before) {
                    parent.insertBefore(node, parent.firstChild);
                }
                else {
                    parent.appendChild(node);
                }
                node.innerHTML = str;
                if (func) {
                    node.listen(func);
                }
                if (lib.config.button_press) {
                    node.addEventListener(lib.config.touchscreen ? 'touchstart' : 'mousedown', function (e) {
                        if (!node.classList.contains('hidden')) node.classList.add('pressdown');
                    });
                    node.addEventListener(lib.config.touchscreen ? 'touchend' : 'mouseup', function (e) {
                        node.classList.remove('pressdown');
                    });
                    node.addEventListener(lib.config.touchscreen ? 'touchmove' : 'mousemove', function (e) {
                        node.classList.remove('pressdown');
                    });
                }
                return node;
            },
            pause: function () {
                if (_status.pausing) return;
                ui.click.shortcut(false);
                var node = ui.create.div(".pausedbg", ui.window);
                _status.pausing = true;
                setTimeout(function () {
                    _status.pausing = false;
                }, 500);
                if (lib.config.touchscreen) {
                    setTimeout(function () {
                        node.addEventListener('touchend', ui.click.resume);
                    }, 500);
                }
                else {
                    node.addEventListener('click', ui.click.resume);
                }
                if (!lib.config.touchscreen) {
                    node.oncontextmenu = ui.click.resume;
                }

                var node2 = ui.create.div(node);
                if (_status.connectMode) {
                    node2.innerHTML = '';
                }
                else {
                    node2.innerHTML = '';
                }

                // node2.listen(function(){
                //     _status.clicked=true;
                //     if(ui.sidebar.classList.contains('hidden')){
                //         ui.sidebar.show();
                //         ui.sidebar3.show();
                //     }
                //     else{
                //         ui.sidebar.hide();
                //         ui.sidebar3.hide();
                //     }
                // });
                return node;
            },
            prebutton: function (item, type, position, noclick) {
                var node = ui.create.div(position);
                node.style.display = 'none';
                node.link = item;
                node.activate = function () {
                    ui.create.button(item, type, position, noclick, node);
                    delete node.activate;
                }
                _status.prebutton.push(node);
                return node;
            },
            /**
             * 
             * @function
             * @param {!Object} item link
             * @param {!string} type 'blank''card''vcard'
             * @param {!HTMLElement} position {@link ui.create.div}
             * @param {?boolean} noclick 
             * @returns {HTMLDivElement} 
             */
            button: function (item, type, position, noclick, node) {
                switch (type) {
                    case 'blank':
                        node = ui.create.div('.button.card', position);
                        node.link = item;
                        break;

                    case 'card':
                        if (typeof item.copy == 'function') {
                            node = item.copy(false);
                        }
                        else {
                            node = item.cloneNode(true);
                        }
                        node.classList.add('button');
                        if (position) position.appendChild(node);
                        node.link = item;
                        if (item.style.backgroundImage) {
                            node.style.backgroundImage = item.style.backgroundImage;
                            node.style.backgroundSize = 'cover';
                        }
                        if (item.style.color) {
                            node.style.color = item.style.color;
                        }
                        if (item.nature) {
                            node.classList.add(item.nature);
                        }
                        if (!noclick) {
                            lib.setIntro(node);
                        }
                        if (get.position(item) == 'j' &amp;&amp; item.viewAs &amp;&amp; item.viewAs != item.name &amp;&amp; lib.config.cardtempname != 'off') {
                            node._tempName = ui.create.div('.tempname', node);
                            var tempname = get.translation(item.viewAs);
                            node._tempName.dataset.nature = 'wood';
                            node._tempName.innerHTML = lib.config.cardtempname == 'default' ? get.verticalStr(tempname) : tempname;
                            node._tempName.tempname = tempname;
                        }
                        break;

                    case 'vcard':
                        if (typeof item == 'string') {
                            item = [get.type(item), '', item];
                        }
                        node = ui.create.card(position, 'noclick', noclick);
                        node.classList.add('button');
                        node.init(item);
                        node.link = item;
                        break;

                    case 'character': case 'player': case 'characterx':
                        if (node) {
                            node.classList.add('button');
                            node.classList.add('character');
                            node.style.display = '';
                        }
                        else {
                            node = ui.create.div('.button.character', position);
                        }
                        node._link = item;
                        if (_status.noReplaceCharacter &amp;&amp; type == 'characterx') type = 'character';
                        if (type == 'characterx') {
                            if (lib.characterReplace[item] &amp;&amp; lib.characterReplace[item].length) item = lib.characterReplace[item][0];
                        }
                        node.link = item;
                        if (type == 'character' || type == 'characterx') {
                            var double = get.is.double(node._link, true);
                            if (double) node._changeGroup = true;
                            if (type == 'characterx' &amp;&amp; lib.characterReplace[node._link] &amp;&amp; lib.characterReplace[node._link].length > 1) node._replaceButton = true;
                            var func = function (node, item) {
                                node.setBackground(item, 'character');
                                if (node.node) {
                                    node.node.name.remove();
                                    node.node.hp.remove();
                                    node.node.group.remove();
                                    node.node.intro.remove();
                                    if (node.node.replaceButton) node.node.replaceButton.remove();
                                }
                                node.node = {
                                    name: ui.create.div('.name', node),
                                    hp: ui.create.div('.hp', node),
                                    group: ui.create.div('.identity', node),
                                    intro: ui.create.div('.intro', node),
                                };
                                var infoitem = lib.character[item];
                                if (!infoitem) {
                                    for (var itemx in lib.characterPack) {
                                        if (lib.characterPack[itemx][item]) {
                                            infoitem = lib.characterPack[itemx][item]; break;
                                        }
                                    }
                                }
                                node.node.name.innerHTML = get.slimName(item);
                                if (lib.config.buttoncharacter_style == 'default' || lib.config.buttoncharacter_style == 'simple') {
                                    if (lib.config.buttoncharacter_style == 'simple') {
                                        node.node.group.style.display = 'none';
                                    }
                                    node.node.name.dataset.nature = get.groupnature(infoitem[1]);
                                    node.node.group.dataset.nature = get.groupnature(infoitem[1], 'raw');
                                    node.classList.add('newstyle');
                                    if (double &amp;&amp; double.length) {
                                        node.node.name.dataset.nature = get.groupnature(double[0]);
                                        node.node.group.dataset.nature = get.groupnature(double[double.length == 2 ? 1 : 0]);
                                    }
                                    ui.create.div(node.node.hp);
                                    var textnode = ui.create.div('.text', get.numStr(infoitem[2]), node.node.hp);
                                    if (infoitem[2] == 0) {
                                        node.node.hp.hide();
                                    }
                                    else if (get.infoHp(infoitem[2]) &lt;= 3) {
                                        node.node.hp.dataset.condition = 'mid';
                                    }
                                    else {
                                        node.node.hp.dataset.condition = 'high';
                                    }
                                }
                                else {
                                    var hp = get.infoHp(infoitem[2]);
                                    var maxHp = get.infoMaxHp(infoitem[2]);
                                    if (maxHp > 14 || hp &lt; 0) {
                                        if (typeof infoitem[2] == 'string') node.node.hp.innerHTML = infoitem[2];
                                        else node.node.hp.innerHTML = get.numStr(infoitem[2]);
                                        node.node.hp.classList.add('text');
                                    }
                                    else {
                                        for (var i = 0; i &lt; maxHp; i++) {
                                            var next = ui.create.div('', node.node.hp);
                                            if (i >= hp) next.classList.add('exclude');
                                        }
                                    }
                                }
                                if (node.node.hp.childNodes.length == 0) {
                                    node.node.name.style.top = '8px';
                                }
                                if (node.node.name.querySelectorAll('br').length >= 4) {
                                    node.node.name.classList.add('long');
                                    if (lib.config.buttoncharacter_style == 'old') {
                                        node.addEventListener('mouseenter', ui.click.buttonnameenter);
                                        node.addEventListener('mouseleave', ui.click.buttonnameleave);
                                    }
                                }
                                node.node.intro.innerHTML = lib.config.intro;
                                if (!noclick) {
                                    lib.setIntro(node);
                                }
                                if (infoitem[1]) {
                                    if (double) {
                                        var str = '&lt;div>';
                                        if (double.length == 2) {
                                            for (var i of double) {
                                                str += get.translation(i);
                                            }
                                        }
                                        else str += get.translation(double[0]);
                                        str += '&lt;/div>';
                                        node.node.group.innerHTML = str;
                                    }
                                    else node.node.group.innerHTML = '&lt;div>' + get.translation(infoitem[1]) + '&lt;/div>';
                                    node.node.group.style.backgroundColor = get.translation(infoitem[1] + 'Color');
                                }
                                else {
                                    node.node.group.style.display = 'none';
                                }
                                if (node._replaceButton) {
                                    var intro = ui.create.div('.button.replaceButton', node);
                                    node.node.replaceButton = intro;
                                    intro.innerHTML = '';
                                    intro._node = node;
                                    intro.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', function () {
                                        _status.tempNoButton = true;
                                        var node = this._node;
                                        var list = lib.characterReplace[node._link];
                                        var link = node.link;
                                        var index = list.indexOf(link);
                                        if (index == list.length - 1) index = 0;
                                        else index++;
                                        link = list[index];
                                        node.link = link;
                                        node.refresh(node, link);
                                        setTimeout(function () {
                                            delete _status.tempNoButton;
                                        }, 200);
                                    });
                                }
                            };
                            node.refresh = func;
                            node.refresh(node, item);
                        }
                        else {
                            node.node = {
                                name: ui.create.div('.name', node),
                                intro: ui.create.div('.intro', node)
                            }
                            if (item.name &amp;&amp; item.name.indexOf('unknown') == 0) {
                                if (item.node &amp;&amp; item.node.name_seat) {
                                    node.classList.add('cardbg');
                                    ui.create.div('.avatar_name', node, get.translation(item.name));
                                }
                                else {
                                    node.setBackground(item.name1, 'character');
                                }
                            }
                            else {
                                node.setBackground(item.name, 'character');
                            }
                        }
                        break;

                    case 'text':
                        node = ui.create.div('.button.text', position);
                        node.link = item;
                        node.innerHTML = item;
                        break;

                    case 'textButton':
                        node = ui.create.div('.caption', position);
                        node.link = item;
                        node.innerHTML = item;
                        break;
                }
                if (!noclick) {
                    node.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.button);
                }
                else {
                    node.classList.add('noclick');
                    if (node.querySelector('.intro')) {
                        node.querySelector('.intro').remove();
                    }
                }
                for (var i in lib.element.button) {
                    node[i] = lib.element.button[i];
                }
                return node;
            },
            /**
             * 
             * @function
             * @param {!Array} list 
             * @param {!string} type 
             * @returns {HTMLDivElement} 
             * @see {@link ui.create.button}
             */
            buttons: function (list, type, position, noclick, zoom) {
                var buttons = [];
                var pre = (type.slice(0, 3) == 'pre');
                if (pre) {
                    if (!_status.prebutton) {
                        _status.prebutton = [];
                        lib.onfree.push(function () {
                            for (var i = 0; i &lt; _status.prebutton.length; i++) {
                                if (_status.prebutton[i].activate) {
                                    _status.prebutton[i].activate();
                                }
                            }
                            delete _status.prebutton;
                        });
                    }
                }
                for (var i = 0; i &lt; list.length; i++) {
                    if (pre) {
                        buttons.push(ui.create.prebutton(list[i], type.slice(3), position, noclick));
                    }
                    else {
                        buttons.push(ui.create.button(list[i], type, position, noclick));
                    }
                }
                return buttons;
            },
            /**
             * 
             * @function
             * @param {HTMLDivElement} parent 
             * @param {?boolean} noclick true****false****
             */
            player: function (position, noclick) {
                /**
                 * 
                 * {@link ui.create.player}
                 * @namespace GameCores.GameObjects.Player
                 * @mixes lib.element.player
                 */
                var node = ui.create.div('.player', position);
                /**
                 * 
                 * @name node
                 * @memberof GameCores.GameObjects.Player
                 * @property {HTMLDivElement} avatar ()
                 * @property {HTMLDivElement} avatar2 
                 * @property {HTMLDivElement} turnover 
                 * @property {HTMLDivElement} framebg 
                 * @property {HTMLDivElement} intro 
                 * @property {HTMLDivElement} identity 
                 * @property {HTMLDivElement} hp 
                 * @property {HTMLDivElement} name ()
                 * @property {HTMLDivElement} name2 
                 * @property {HTMLDivElement} nameol OL
                 * @property {HTMLDivElement} count 
                 * @property {HTMLDivElement} equips 
                 * @property {HTMLDivElement} judges 
                 * @property {HTMLDivElement} marks 
                 * @property {HTMLDivElement} chain 
                 * @property {HTMLDivElement} handcards1 1
                 * @property {HTMLDivElement} handcards2 2
                 * @property {HTMLDivElement} action action
                 * @property {HTMLDivElement} link ()
                 */
                node.node = {
                    avatar: ui.create.div('.avatar', node, ui.click.avatar).hide(),
                    avatar2: ui.create.div('.avatar2', node, ui.click.avatar2).hide(),
                    turnedover: ui.create.div('.turned', '&lt;div>&lt;br>&lt;div>', node),
                    framebg: ui.create.div('.framebg', node),
                    intro: ui.create.div('.intro', node),
                    identity: ui.create.div('.identity', node),
                    hp: ui.create.div('.hp', node),
                    name: ui.create.div('.name', node),
                    name2: ui.create.div('.name.name2', node),
                    nameol: ui.create.div('.nameol', node),
                    count: ui.create.div('.count', node).hide(),
                    equips: ui.create.div('.equips', node).hide(),
                    judges: ui.create.div('.judges', node),
                    marks: ui.create.div('.marks', node),
                    chain: ui.create.div('.chain', '&lt;div>&lt;/div>', node),
                    handcards1: ui.create.div('.handcards'),
                    handcards2: ui.create.div('.handcards'),
                };
                var chainlength = game.layout == 'default' ? 64 : 40;
                for (var i = 0; i &lt; chainlength; i++) {
                    ui.create.div(node.node.chain.firstChild, '.cardbg').style.transform = 'translateX(' + (i * 5 - 5) + 'px)';
                }
                node.node.action = ui.create.div('.action', node.node.avatar);//
                /**
                 * 01
                 * @name phaseNumber
                 * @type {!number}
                 * @memberof GameCores.GameObjects.Player
                 */
                node.phaseNumber = 0;
                /**
                 * eXXe
                 * @name skipList
                 * @type {!Array&lt;string>}
                 * @memberof GameCores.GameObjects.Player
                 */
                node.skipList = [];
                /**
                 * 
                 * @name skills
                 * @type {!Array&lt;any>}
                 * @memberof GameCores.GameObjects.player
                 */
                node.skills = [];
                /**
                 * ??
                 * @name initedSkills
                 * @type {!Array&lt;any>}
                 * @memberof GameCores.GameObjects.Player
                 */
                node.initedSkills = [];
                node.additionalSkills = {};
                node.disabledSkills = {};
                node.hiddenSkills = [];
                node.awakenedSkills = [];
                node.forbiddenSkills = {};
                node.popups = [];
                node.damagepopups = [];
                node.judging = [];
                node.stat = [{ card: {}, skill: {} }];
                node.actionHistory = [{ useCard: [], respond: [], skipped: [], lose: [], gain: [], sourceDamage: [], damage: [], custom: [] }];
                node.tempSkills = {};
                node.storage = {};
                node.marks = {};
                node.ai = { friend: [], enemy: [], neutral: [], handcards: { global: [], source: [], viewed: [] } };
                node.queueCount = 0;
                node.outCount = 0;

                for (var i in lib.element.player) {
                    node[i] = lib.element.player[i];
                }
                node.node.link = node.mark(' ', { mark: get.linkintro });
                node.node.link.firstChild.setBackgroundImage('image/card/tiesuo_mark.png')
                node.node.link.firstChild.style.backgroundSize = 'cover';
                ui.create.div(node.node.identity);//??
                if (!noclick) {
                    node.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.target);
                    node.node.identity.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.identity);
                    if (lib.config.touchscreen) {
                        node.addEventListener('touchstart', ui.click.playertouchstart);
                    }
                }
                else node.noclick = true;

                return node;
            },
            connectPlayers: function (ip) {
                game.connectPlayers = [];
                for (var i = 0; i &lt; 8; i++) {
                    var player = ui.create.player(ui.window);
                    player.dataset.position = i;
                    player.classList.add('connect');
                    game.connectPlayers.push(player);
                    if (i >= lib.configOL.number) {
                        player.classList.add('unselectable2');
                    }
                }

                var bar = ui.create.div(ui.window);
                bar.style.height = '20px';
                bar.style.width = '80%';
                bar.style.left = '10%';
                bar.style.top = 'calc(200% / 7 - 120px + 5px)';
                bar.style.textAlign = 'center';
                var ipbar = ui.create.div('.shadowed', ip, bar);
                ipbar.style.padding = '4px';
                ipbar.style.borderRadius = '2px';
                ipbar.style.position = 'relative';

                var button = ui.create.div('.menubutton.large.highlight.connectbutton.pointerdiv', game.online ? '' : '', ui.window, function () {
                    if (button.clicked) return;
                    if (game.online) {
                        if (game.onlinezhu) {
                            game.send('startGame');
                        }
                        else {
                            game.saveConfig('tmp_owner_roomId');
                            game.saveConfig('tmp_user_roomId');
                            game.saveConfig('reconnect_info');
                            game.reload();
                        }
                    }
                    else {
                        var num = 0;
                        for (var i of game.connectPlayers) {
                            if (!i.nickname &amp;&amp; !i.classList.contains('unselectable2')) num++;
                        }
                        // if (num >= lib.configOL.number - 1) {
                        //     alert('');
                        //     return;
                        // }
                        game.resume();
                    }
                    button.delete();
                    bar.delete();
                    delete ui.connectStartButton;
                    delete ui.connectStartBar;
                    button.clicked = true;
                });

                ui.connectStartButton = button;
                ui.connectStartBar = bar;
            },
            players: function (num) {
                if (num === 0) {
                    return;
                }
                if (num == undefined) num = lib.configOL.number;
                if (num == undefined) num = get.playerNumber();
                if (typeof num == 'string') {
                    num = parseInt(num);
                }
                if (!num) num = 5;
                for (var i = 0; i &lt; num; i++) {
                    var player = ui.create.player().animate('start');
                    game.players.push(player);
                    player.dataset.position = i;
                }
                var players = game.players;
                for (var i = 0; i &lt; players.length; i++) {
                    if (i > 0) {
                        players[i].previous = players[i - 1];
                        players[i].previousSeat = players[i - 1];
                    }
                    if (i &lt; players.length - 1) {
                        players[i].next = players[i + 1];
                        players[i].nextSeat = players[i + 1];
                    }
                }
                players[0].previous = players[players.length - 1];
                players[0].previousSeat = players[players.length - 1];
                players[players.length - 1].next = players[0];
                players[players.length - 1].nextSeat = players[0];
                ui.arena.setNumber(num);
                for (var i = 0; i &lt; num; i++) {
                    ui.arena.appendChild(players[i]);
                }
                // ui.arena.classList.add('glass');
                // for(var i=0;i&lt;num;i++){
                //     var bg=ui.create.div('.glassbg');
                //     var bg2=ui.create.div(bg);
                //     ui.create.div(bg);
                //     var rect=players[i].getBoundingClientRect();
                //     bg2.style.backgroundImage='url("image/background/huangtian_bg.jpg")';
                //     bg2.style.width=ui.window.offsetWidth+'px';
                //     bg2.style.height=ui.window.offsetHeight+'px';
                //     bg2.style.transform='translate('+(-rect.left)+'px,'+(-rect.top)+'px)';
                //     players[i].insertBefore(bg,players[i].firstChild);
                // }
                return players;
            },
            me: function (hasme) {
                ui.mebg = ui.create.div('#mebg', ui.arena);
                ui.me = ui.create.div('#me', ui.arena).animate('start');
                ui.handcards1Container = ui.create.div('#handcards1', ui.me);
                ui.handcards2Container = ui.create.div('#handcards2', ui.me);
                ui.arena.classList.remove('nome');
                if (lib.config.mousewheel &amp;&amp; !lib.config.touchscreen) {
                    ui.handcards1Container.onmousewheel = ui.click.mousewheel;
                    ui.handcards2Container.onmousewheel = ui.click.mousewheel;
                }
                ui.handcards1Container.ontouchstart = ui.click.touchStart;
                ui.handcards2Container.ontouchstart = ui.click.touchStart;
                ui.handcards1Container.ontouchmove = ui.click.touchScroll;
                ui.handcards2Container.ontouchmove = ui.click.touchScroll;
                ui.handcards1Container.style.WebkitOverflowScrolling = 'touch';
                ui.handcards2Container.style.WebkitOverflowScrolling = 'touch';

                if (hasme &amp;&amp; game.me) {
                    ui.handcards1 = game.me.node.handcards1;
                    ui.handcards2 = game.me.node.handcards2;
                    ui.handcards1Container.appendChild(ui.handcards1);
                    ui.handcards2Container.appendChild(ui.handcards2);
                    // ui.updatehl();
                }
                else if (game.players.length) {
                    game.me = game.players[0];
                    ui.handcards1 = game.me.node.handcards1;
                    ui.handcards2 = game.me.node.handcards2;
                    ui.handcards1Container.appendChild(ui.handcards1);
                    ui.handcards2Container.appendChild(ui.handcards2);
                    // ui.updatehl();
                }
            },
            /**
             * 
             * @param {HTMLDivElement} parent (||) 
             * @param {?'noclick'} [noclick] 'noclick'****false
             * @param {?boolean} [nodialog] true****false
             * @returns {!GameCores.GameObjects.Card} 
             */
            card: function (position, info, noclick) {
                /**
                 * 
                 * @namespace GameCores.GameObjects.Card
                 */
                var node = ui.create.div('.card', position);
                /**
                 * @name node
                 * @memberof GameCores.GameObjects.Card
                 * @property {HTMLDivElement} image 
                 * @property {HTMLDivElement} info 
                 * ```
                 * info.innerHTML = "&lt;span> &lt;/span>"
                 * ```
                 * @property {HTMLDivElement} name 
                 */
                node.node = {
                    image: ui.create.div('.image', node),
                    info: ui.create.div('.info', node),
                    name: ui.create.div('.name', node),
                    name2: ui.create.div('.name2', node),
                    background: ui.create.div('.background', node),
                    intro: ui.create.div('.intro', node),
                    range: ui.create.div('.range', node),
                    gaintag: ui.create.div('.gaintag', node),
                }
                for (var i in lib.element.card) {
                    node[i] = lib.element.card[i];
                }
                node.node.intro.innerHTML = lib.config.intro;
                if (!noclick) {
                    lib.setIntro(node);
                }
                node.storage = {};
                node.vanishtag = [];
                node.gaintag = [];
                node._uncheck = [];
                if (info != 'noclick') {
                    node.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.card);
                    if (lib.config.touchscreen) {
                        node.addEventListener('touchstart', ui.click.cardtouchstart);
                        node.addEventListener('touchmove', ui.click.cardtouchmove);
                    }
                    if (lib.cardSelectObserver) {//?? [never used]
                        lib.cardSelectObserver.observe(node, { attributes: true });
                    }
                }
                return node;
            },
            cardsAsync: function () {
                if (lib.onfree) {
                    _status.waitingForCards = Array.from(arguments);
                    lib.onfree.push(function () {
                        if (_status.waitingForCards) {
                            ui.create.cards.apply(ui.create, _status.waitingForCards);
                            delete _status.waitingForCards;
                        }
                    });
                }
                else {
                    ui.create.cards.apply(ui.create, arguments);
                }
            },
            cards: function (ordered) {
                if (_status.brawl) {
                    if (_status.brawl.cardPile) {
                        lib.card.list = _status.brawl.cardPile(lib.card.list);
                    }
                    if (_status.brawl.orderedPile) {
                        ordered = true;
                    }
                }
                if (!ordered) {
                    lib.card.list.randomSort();
                }
                for (var i = 0; i &lt; lib.card.list.length; i++) {
                    if (lib.card[lib.card.list[i][2]]) {
                        if (!lib.card.list[i]._replaced) {
                            if (!_status.connectMode) {
                                if (lib.config.bannedcards.contains(lib.card.list[i][2])) continue;
                            }
                            else {
                                if (lib.configOL.protect_beginner &amp;&amp; get.is.banForBeginner(lib.card.list[i][2])) continue;
                                if (lib.configOL.bannedcards.contains(lib.card.list[i][2])) continue;
                            }
                            if (game.bannedcards &amp;&amp; game.bannedcards.contains(lib.card.list[i][2])) continue;
                        }
                        lib.inpile.add(lib.card.list[i][2]);
                        ui.create.card(ui.cardPile).init(lib.card.list[i]);
                    }
                }
                lib.inpile.sort(lib.sort.card);
                for (var i in _status.cardtag) {
                    if (!_status.cardtag[i].length) delete _status.cardtag[i];
                }
                game.broadcastAll(function (num, pile, top, cardtag) {
                    if (ui.cardPileNumber) ui.cardPileNumber.innerHTML = '0 : ' + num;
                    lib.inpile = pile;
                    _status.pileTop = top;
                    _status.cardtag = cardtag;
                }, ui.cardPile.childNodes.length, lib.inpile, ui.cardPile.firstChild, _status.cardtag);
            },
        },
        /**
         * HTML 
         * @namespace
         */
        click: {
            identitycircle: function () {
                var list = [];
                this.classList.toggle('transparent');
                for (var i = 0; i &lt; this.parentNode.childNodes.length; i++) {
                    if (!this.parentNode.childNodes[i].classList.contains('transparent')) {
                        list.add(this.parentNode.childNodes[i].link[2]);
                    }
                }
                var info = this.link;
                if (list.length == 1) {
                    for (var i = 0; i &lt; this.parentNode.childNodes.length; i++) {
                        if (!this.parentNode.childNodes[i].classList.contains('transparent')) {
                            var info2 = this.parentNode.childNodes[i].link;
                            info[0].firstChild.innerHTML = info2[1];
                            info[0].dataset.color = info2[2];
                        }
                    }
                }
                else {
                    info[0].firstChild.innerHTML = '';
                    info[0].dataset.color = '';
                    ui.create.identitycircle(list, info[0].firstChild);
                }
                this._source._guozhanguess = list;
            },
            connectEvents: function () {
                if (this.info) {
                    var button = this;
                    var layer = ui.create.div('.poplayer', ui.window);
                    var uiintro = ui.create.dialog('hidden', 'notouchscroll');
                    this.classList.add('active');
                    if (lib.config.touchscreen) {
                        lib.setScroll(uiintro.contentContainer);
                    }
                    layer.listen(function () {
                        if (this.clicked) {
                            this.clicked = false;
                            return;
                        }
                        button.classList.remove('active');
                        uiintro.delete();
                        this.delete();
                    });
                    uiintro.listen(function () {
                        _status.clicked = true;
                    });
                    uiintro.style.zIndex = 21;
                    uiintro.classList.add('popped');
                    uiintro.classList.add('static');
                    uiintro.classList.add('onlineclient');
                    uiintro.style.width = '180px';
                    uiintro.style.height = '300px';
                    uiintro.style.left = 'auto';
                    uiintro.style.right = '20px';
                    uiintro.style.top = 'auto';
                    uiintro.style.bottom = '75px';

                    uiintro.refresh = function () {
                        if (button.focused) return;
                        uiintro.content.innerHTML = '';
                        uiintro.addText('');
                        button.textnode = uiintro.content.lastChild.lastChild;
                        uiintro.add('&lt;input type="text" style="width:calc(100% - 10px);resize: none;border: none;border-radius: 2px;box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 0px 1px;margin-top: -2px;margin-bottom: 2px;">');
                        uiintro.content.lastChild.style.paddingTop = 0;
                        button.input = uiintro.content.lastChild.lastChild;
                        button.input.onfocus = function () {
                            button.focused = true;
                        }
                        button.input.onblur = function () {
                            delete button.focused;
                        }
                        if (button.interval) {
                            button.input.disabled = true;
                            button.input.style.opacity = 0.6;
                            if (button.intervaltext) {
                                button.textnode.innerHTML = button.intervaltext;
                            }
                        }
                        var datenode = ui.create.div(uiintro.content);
                        datenode.style.marginTop = 0;
                        datenode.style.whiteSpace = 'nowrap';
                        var date = new Date();
                        var days = [];
                        var currentDay = date.getDay();
                        if (currentDay == 0) currentDay = 7;
                        for (var i = 1; i &lt;= 7; i++) {
                            if (i &lt; currentDay) {
                                days.push([i.toString(), '' + get.cnNumber(i, true)]);
                            }
                            else if (i == 7) {
                                days.push([i.toString(), '']);
                            }
                            else if (i == currentDay) {
                                days.push([i.toString(), '']);
                            }
                            else {
                                days.push([i.toString(), '' + get.cnNumber(i, true)]);
                            }
                        }
                        days = days.concat(days.splice(0, currentDay - 1));
                        var initday = currentDay + 1;
                        if (initday > 7) {
                            initday -= 7;
                        }
                        var daysselect = ui.create.selectlist(days, initday.toString(), datenode);
                        daysselect.style.width = '55px';
                        var hours = [];
                        for (var i = 0; i &lt; 24; i++) {
                            hours.push([i.toString(), i.toString() + '']);
                        }
                        var hoursselect = ui.create.selectlist(hours, date.getHours().toString(), datenode);
                        hoursselect.style.marginLeft = '5px';
                        hoursselect.style.width = '55px';
                        var timeconfirm = ui.create.node('button', '', datenode);
                        timeconfirm.style.marginLeft = '5px';
                        timeconfirm.onclick = function () {
                            if (!button.input.value) {
                                alert('');
                                return;
                            }
                            var date2 = new Date();
                            date2.setHours(parseInt(hoursselect.value));
                            date2.setMinutes(0);
                            date2.setSeconds(0);
                            var deltaday = parseInt(daysselect.value) - currentDay;
                            if (deltaday &lt; 0) {
                                deltaday += 7;
                            }
                            var utc = date2.getTime() + deltaday * 24 * 3600000;
                            if (utc &lt; date.getTime()) {
                                alert('');
                                return;
                            }
                            if (get.is.banWords(button.input.value)) {
                                var eventnode = ui.create.div('.menubutton.videotext.onlineevent.pointerdiv', function () {
                                    var that = this;
                                    setTimeout(function () {
                                        if (that.classList.contains('active')) {
                                            if (confirm('' + that.info.content + '')) {
                                                that.classList.remove('active');
                                            }
                                        }
                                        else {
                                            if (confirm('' + that.info.content + '')) {
                                                that.classList.add('active');
                                            }
                                        }
                                    });
                                }, uiintro.content, 4);
                                var fakeinfo = {
                                    utc: utc,
                                    day: parseInt(daysselect.value),
                                    hour: parseInt(hoursselect.value),
                                    nickname: get.connectNickname(),
                                    avatar: lib.config.connect_avatar,
                                    content: button.input.value,
                                    create: game.onlineKey,
                                    members: [game.onlineKey],
                                };
                                eventnode.info = fakeinfo;
                                ui.create.div('.title', fakeinfo.content, eventnode);
                                var str;
                                if (fakeinfo.day &lt; currentDay) {
                                    str = '';
                                }
                                else {
                                    str = '';
                                }
                                if (fakeinfo.day == 7) {
                                    str += ''
                                }
                                else {
                                    str += get.cnNumber(fakeinfo.day, true);
                                }
                                str += ' ';
                                var hour = fakeinfo.hour;
                                if (hour &lt;= 12) {
                                    if (hour &lt;= 5) {
                                        str += '';
                                    }
                                    else if (hour &lt; 12) {
                                        str += '';
                                    }
                                    else {
                                        str += '';
                                    }
                                    str += fakeinfo.hour + '';
                                }
                                else {
                                    if (hour &lt;= 17) {
                                        str += '';
                                    }
                                    else {
                                        str += '';
                                    }
                                    str += (fakeinfo.hour - 12) + '';
                                }
                                ui.create.div('', '' + (fakeinfo.members.length) + '', eventnode);
                                ui.create.div('', '' + str, eventnode);
                                if (fakeinfo.members.contains(game.onlineKey)) {
                                    eventnode.classList.add('active');
                                }
                                button.input.value = '';
                                return;
                            }
                            game.send('server', 'events', {
                                utc: utc,
                                day: parseInt(daysselect.value),
                                hour: parseInt(hoursselect.value),
                                nickname: get.connectNickname(),
                                avatar: lib.config.connect_avatar,
                                content: button.input.value
                            }, game.onlineKey);
                        };

                        var num = 0;
                        for (var i = 0; i &lt; button.info.length; i++) {
                            if (typeof button.info[i].creator == 'string' &amp;&amp; button.info[i].creator != game.onlineKey &amp;&amp; get.is.banWords(button.info[i].content)) continue;
                            if (button.info[i].creator == game.onlineKey) {
                                num++;
                            }
                            var eventnode = ui.create.div('.menubutton.videotext.onlineevent.pointerdiv', function () {
                                var that = this;
                                if (typeof that.info.creator != 'string') return;
                                setTimeout(function () {
                                    if (that.classList.contains('active')) {
                                        if (confirm('' + that.info.content + '')) {
                                            game.send('server', 'events', that.info.id, game.onlineKey, 'leave');
                                        }
                                    }
                                    else {
                                        if (confirm('' + that.info.content + '')) {
                                            game.send('server', 'events', that.info.id, game.onlineKey, 'join');
                                        }
                                    }
                                });
                            }, uiintro.content);
                            eventnode.info = button.info[i];
                            if (typeof button.info[i].creator == 'string') {
                                ui.create.div('.title', button.info[i].content, eventnode);
                                var str;
                                if (button.info[i].day &lt; currentDay) {
                                    str = '';
                                }
                                else {
                                    str = '';
                                }
                                if (button.info[i].day == 7) {
                                    str += ''
                                }
                                else {
                                    str += get.cnNumber(button.info[i].day, true);
                                }
                                str += ' ';
                                var hour = button.info[i].hour;
                                if (hour &lt;= 12) {
                                    if (hour &lt;= 5) {
                                        str += '';
                                    }
                                    else if (hour &lt; 12) {
                                        str += '';
                                    }
                                    else {
                                        str += '';
                                    }
                                    str += button.info[i].hour + '';
                                }
                                else {
                                    if (hour &lt;= 17) {
                                        str += '';
                                    }
                                    else {
                                        str += '';
                                    }
                                    str += (button.info[i].hour - 12) + '';
                                }
                                ui.create.div('', '' + (button.info[i].nickname), eventnode);
                                //ui.create.div('',''+(button.info[i].nickname)+'&lt;br>ID'+button.info[i].creator,eventnode);
                                ui.create.div('', '' + (button.info[i].members.length) + '', eventnode);
                                ui.create.div('', '' + str, eventnode);
                                if (button.info[i].members.contains(game.onlineKey)) {
                                    eventnode.classList.add('active');
                                }
                            }
                            else {
                                ui.create.div('.title', button.info[i].title, eventnode);
                                ui.create.div('', button.info[i].content, eventnode);
                                ui.create.div('', '' + (button.info[i].nickname), eventnode);
                            }
                        }
                        if (num >= 3) {
                            button.input.disabled = true;
                            button.input.style.opacity = 0.6;
                            hoursselect.disabled = true;
                            daysselect.disabled = true;
                            timeconfirm.disabled = true;
                        }
                    }
                    uiintro.refresh();
                    ui.window.appendChild(uiintro);
                    _status.connectEventsCallback = function () {
                        if (uiintro.parentNode == ui.window) {
                            uiintro.refresh();
                        }
                    };
                }
            },
            connectClients: function () {
                if (this.info) {
                    var button = this;
                    var layer = ui.create.div('.poplayer', ui.window);
                    var uiintro = ui.create.dialog('hidden', 'notouchscroll');
                    this.classList.add('active');
                    if (lib.config.touchscreen) {
                        lib.setScroll(uiintro.contentContainer);
                    }
                    layer.listen(function () {
                        if (this.clicked) {
                            this.clicked = false;
                            return;
                        }
                        button.classList.remove('active');
                        uiintro.delete();
                        this.delete();
                    });
                    uiintro.listen(function () {
                        _status.clicked = true;
                    });
                    uiintro.style.zIndex = 21;
                    uiintro.classList.add('popped');
                    uiintro.classList.add('static');
                    uiintro.classList.add('onlineclient');
                    uiintro.style.width = '180px';
                    uiintro.style.height = '300px';
                    uiintro.style.left = 'auto';
                    uiintro.style.right = '20px';
                    uiintro.style.top = 'auto';
                    uiintro.style.bottom = '75px';

                    uiintro.refresh = function () {
                        if (button.focused) return;
                        uiintro.content.innerHTML = '';
                        uiintro.addText('');
                        button.textnode = uiintro.content.lastChild.lastChild;
                        uiintro.add('&lt;input type="text" style="width:calc(100% - 10px);resize: none;border: none;border-radius: 2px;box-shadow: rgba(0, 0, 0, 0.2) 0px 0px 0px 1px;margin-top: -2px;margin-bottom: 2px;">');
                        uiintro.content.lastChild.style.paddingTop = 0;
                        button.input = uiintro.content.lastChild.lastChild;
                        button.input.onfocus = function () {
                            button.focused = true;
                        }
                        button.input.onblur = function () {
                            delete button.focused;
                        }
                        if (button.interval) {
                            button.input.disabled = true;
                            button.input.style.opacity = 0.6;
                            if (button.intervaltext) {
                                button.textnode.innerHTML = button.intervaltext;
                            }
                        }
                        button.input.onkeydown = function (e) {
                            if (e.keyCode == 13 &amp;&amp; !this.disabled) {
                                game.send('server', 'status', this.value);
                                this.blur();
                                this.disabled = true;
                                this.style.opacity = 0.6;
                                button.textnode.innerHTML = '(10)';
                                button.intervaltext = button.textnode.innerHTML;
                                var num = 10;
                                var that = this;
                                button.input.disabled = true;
                                button.input.style.opacity = 0.6;
                                this.value = '';
                                button.interval = setInterval(function () {
                                    num--;
                                    if (num > 0) {
                                        button.textnode.innerHTML = '(' + num + ')';
                                        button.intervaltext = button.textnode.innerHTML;
                                    }
                                    else {
                                        button.textnode.innerHTML = '';
                                        button.input.disabled = false;
                                        button.input.style.opacity = '';
                                        clearInterval(button.interval);
                                        delete button.interval;
                                        delete button.intervaltext;
                                    }
                                }, 1000);
                            }
                        }

                        for (var i = 0; i &lt; button.info.length; i++) {
                            var node = ui.create.div('.menubutton.videonode.pointerdiv', uiintro.content);
                            ui.create.div('.menubutton.videoavatar', node).setBackground(button.info[i][1] || 'KizunaAI', 'character');
                            if (button.info[i][4] == game.wsid) {
                                ui.create.div('.name', '&lt;span class="thundertext thunderauto">' + (button.info[i][0] || ''), node); node.isme = true;
                            }
                            else if (button.info[i][2]) {
                                ui.create.div('.name', (button.info[i][0] || ''), node);
                            }
                            else {
                                ui.create.div('.name', '&lt;span style="opacity:0.6">' + (button.info[i][0] || ''), node);
                            }
                            //ui.create.div('.videostatus',node,button.info[i][5]);
                            //node.classList.add('videonodestatus');
                            if (button.info[i][3]) {
                                ui.create.div('.videostatus', node, button.info[i][3].slice(0, 80));
                                node.classList.add('videonodestatus')
                            }
                        }
                    };

                    uiintro.refresh();
                    ui.window.appendChild(uiintro);
                    _status.connectClientsCallback = function () {
                        if (uiintro.parentNode == ui.window) {
                            uiintro.refresh();
                        }
                    };
                }
            },
            autoskin: function () {
                if (!lib.config.change_skin) return;
                var players = game.filterPlayer();
                var change = function (player, num, callback) {
                    if (num == '1') {
                        ui.click.skin(player.node.avatar, player.name, callback);
                    }
                    else {
                        ui.click.skin(player.node.avatar2, player.name2, callback);
                    }
                };
                var finish = function () {
                    if (lib.config.change_skin_auto != 'off') {
                        _status.skintimeout = setTimeout(ui.click.autoskin, parseInt(lib.config.change_skin_auto));
                    }
                };
                var autoskin = function () {
                    if (players.length) {
                        var player = players.randomRemove();
                        var list = [];
                        if (player.name &amp;&amp; !player.isUnseen(0)) {
                            list.push('1');
                        }
                        if (player.name2 &amp;&amp; !player.isUnseen(1)) {
                            list.push('2');
                        }
                        if (list.length) {
                            change(player, list.randomRemove(), function (bool) {
                                if (bool) {
                                    finish();
                                }
                                else if (list.length) {
                                    change(player, list[0], function (bool) {
                                        if (bool) {
                                            finish();
                                        }
                                        else {
                                            autoskin();
                                        }
                                    });
                                }
                                else {
                                    autoskin();
                                }
                            });
                        }
                        else {
                            autoskin();
                        }
                    }
                }
                autoskin();
            },
            skin: function (avatar, name, callback) {
                var num = 1;
                if (name.indexOf('gz_') == 0) {
                    name = name.slice(3);
                }
                if (lib.config.skin[name]) {
                    num = lib.config.skin[name] + 1;
                }
                var fakeavatar = avatar.cloneNode(true);
                var finish = function (bool) {
                    var player = avatar.parentNode;
                    if (bool) {
                        fakeavatar.style.boxShadow = 'none';
                        player.insertBefore(fakeavatar, avatar.nextSibling);
                        setTimeout(function () {
                            fakeavatar.delete();
                        }, 100);
                    }
                    if (bool &amp;&amp; lib.config.animation &amp;&amp; !lib.config.low_performance) {
                        player.$rare();
                    }
                    if (callback) {
                        callback(bool);
                    }
                }
                var img = new Image();
                img.onload = function () {
                    lib.config.skin[name] = num;
                    game.saveConfig('skin', lib.config.skin);
                    avatar.style.backgroundImage = 'url("' + img.src + '")';
                    finish(true);
                }
                img.onerror = function () {
                    if (lib.config.skin[name]) {
                        finish(true);
                    }
                    else {
                        finish(false);
                    }
                    delete lib.config.skin[name];
                    game.saveConfig('skin', lib.config.skin);
                    avatar.setBackground(name, 'character');
                }
                img.src = lib.assetURL + 'image/skin/' + name + '/' + num + '.jpg';
            },
            touchpop: function (forced) {
                if (lib.config.touchscreen || forced) {
                    _status.touchpopping = true;
                    clearTimeout(_status.touchpoppingtimeout);
                    _status.touchpoppingtimeout = setTimeout(function () {
                        _status.touchpopping = false;
                    }, 600);
                }
            },
            exit: function () {
                if (game.servermode &amp;&amp; lib.config.reconnect_info &amp;&amp; _status.over) {
                    if (!_status.roomtimeout) {
                        lib.config.reconnect_info[2] = game.roomId;
                        game.saveConfig('reconnect_info', lib.config.reconnect_info);
                    }
                    game.reload();
                    return;
                }
                else {
                    if (typeof game.roomId != 'string') {
                        game.saveConfig('reconnect_info');
                    }
                }
                if (!ui.exit || !ui.exit.stay) {
                    if (lib.config.reconnect_info) {
                        lib.config.reconnect_info.length = 1;
                        game.saveConfig('reconnect_info', lib.config.reconnect_info);
                    }
                    game.saveConfig('tmp_user_roomId', undefined, false, function () {
                        game.reload();
                    });
                }
                else {
                    game.reload();
                }
            },
            shortcut: function (show) {
                if (show === false) {
                    ui.shortcut.classList.add('hidden');
                }
                else {
                    ui.shortcut.classList.toggle('hidden');
                }
                if (ui.shortcut.classList.contains('hidden')) {
                    ui.favmode.style.display = 'none';
                    if (window.StatusBar &amp;&amp; lib.config.show_statusbar_ios == 'auto') {
                        document.body.classList.remove('statusbar');
                        window.StatusBar.hide();
                    }
                    ui.window.classList.remove('shortcutpaused');
                }
                else {
                    if (lib.config.show_favmode) {
                        ui.favmode.style.display = '';
                    }
                    if (window.StatusBar &amp;&amp; lib.config.show_statusbar_ios == 'auto') {
                        document.body.classList.add('statusbar');
                        window.StatusBar.overlaysWebView(true);
                        window.StatusBar.backgroundColorByName('black');
                        window.StatusBar.show();
                    }
                    if (_status.auto) {
                        ui.shortcut.autobutton.classList.add('active');
                    }
                    else {
                        ui.shortcut.autobutton.classList.remove('active');
                    }
                    ui.window.classList.add('shortcutpaused');
                }
            },
            favouriteCharacter: function (e) {
                if (typeof this.link == 'string') {
                    if (this.innerHTML == '') {
                        this.innerHTML = '';
                        lib.config.favouriteCharacter.add(this.link);
                    }
                    else {
                        this.innerHTML = '';
                        lib.config.favouriteCharacter.remove(this.link);
                    }
                    if (ui.favouriteCharacter) {
                        if (lib.config.favouriteCharacter.contains(this.link)) {
                            for (var i = 0; i &lt; ui.favouriteCharacter.childElementCount; i++) {
                                if (ui.favouriteCharacter.childNodes[i].link == this.link) {
                                    break;
                                }
                            }
                            if (i == ui.favouriteCharacter.childElementCount) {
                                ui.create.button(this.link, 'character', ui.favouriteCharacter).listen(function (e) {
                                    this._banning = 'offline';
                                    ui.click.touchpop();
                                    ui.click.intro.call(this, e);
                                    _status.clicked = false;
                                    delete this._banning;
                                }).classList.add('noclick');
                            }
                        }
                        else {
                            for (var i = 0; i &lt; ui.favouriteCharacter.childElementCount; i++) {
                                if (ui.favouriteCharacter.childNodes[i].link == this.link) {
                                    ui.favouriteCharacter.childNodes[i].remove();
                                    break;
                                }
                            }
                        }
                        var shownode = false;
                        for (var i = 0; i &lt; lib.config.favouriteCharacter.length; i++) {
                            var favname = lib.config.favouriteCharacter[i];
                            if (lib.character[favname]) {
                                shownode = true; break;
                            }
                        }
                        if (shownode) {
                            ui.favouriteCharacter.node.style.display = '';
                        }
                        else {
                            ui.favouriteCharacter.node.style.display = 'none';
                        }
                    }
                    game.saveConfig('favouriteCharacter', lib.config.favouriteCharacter);
                }
                e.stopPropagation();
            },
            buttonnameenter: function () {
                if (this.buttonscrollinterval) {
                    clearInterval(this.buttonscrollinterval);
                }
                var node = this.node.name;
                if (node.offsetHeight &lt; node.scrollHeight) {
                    var that = this;
                    var num = 40;
                    that.buttonscrollinterval = setInterval(function () {
                        if (node.scrollTop + node.offsetHeight >= node.scrollHeight) {
                            clearInterval(that.buttonscrollinterval);
                            delete that.buttonscrollinterval;
                        }
                        else {
                            if (num > 0) {
                                num--;
                            }
                            else {
                                node.scrollTop += 2;
                            }
                        }
                    }, 16);
                }
            },
            buttonnameleave: function () {
                if (this.buttonscrollinterval) {
                    clearInterval(this.buttonscrollinterval);
                }
                var node = this.node.name;
                if (node.offsetHeight &lt; node.scrollHeight) {
                    var that = this;
                    that.buttonscrollinterval = setInterval(function () {
                        if (node.scrollTop == 0) {
                            clearInterval(that.buttonscrollinterval);
                            delete that.buttonscrollinterval;
                        }
                        else {
                            node.scrollTop -= 2;
                        }
                    }, 16);
                }
            },
            dragtouchdialog: function (e) {
                if (e.touches.length > 1 &amp;&amp;
                    !this.classList.contains('popped') &amp;&amp;
                    !this.classList.contains('fixed')) {
                    _status.draggingtouchdialog = this;
                    this._dragorigin = {
                        clientX: e.touches[0].clientX,
                        clientY: e.touches[0].clientY,
                    };
                    if (!this._dragtransform) {
                        this._dragtransform = [0, 0];
                    }
                    this._dragorigintransform = this._dragtransform.slice(0);
                    e.preventDefault();
                    e.stopPropagation();
                }
            },
            identity: function (e) {
                if (_status.dragged) return;
                _status.clicked = true;
                if (!game.getIdentityList) return;
                if (_status.video) return;
                if (this.parentNode.forceShown) return;
                if (_status.clickingidentity) {
                    for (var i = 0; i &lt; _status.clickingidentity[1].length; i++) {
                        _status.clickingidentity[1][i].delete();
                        _status.clickingidentity[1][i].style.transform = '';
                    }
                    if (_status.clickingidentity[0] == this.parentNode) {
                        delete _status.clickingidentity;
                        return;
                    }
                }
                var list = game.getIdentityList(this.parentNode);
                if (!list) return;
                if (lib.config.mark_identity_style == 'click') {
                    var list2 = [];
                    for (var i in list) {
                        list2.push(i);
                    }
                    list2.push(list2[0]);
                    for (var i = 0; i &lt; list2.length; i++) {
                        if (this.firstChild.innerHTML == list[list2[i]]) {
                            this.firstChild.innerHTML = list[list2[i + 1]];
                            this.dataset.color = list2[i + 1];
                            break;
                        }
                    }
                }
                else {
                    if (get.mode() == 'guozhan') {
                        list = { holo: '', nijisanji: '', vtuber: '', clubs: '' };
                    }
                    var list2 = get.copy(list);
                    if (game.getIdentityList2) {
                        game.getIdentityList2(list2);
                    }
                    var rect = this.parentNode.getBoundingClientRect();
                    this._customintro = function (uiintro) {
                        if (get.mode() == 'guozhan') {
                            uiintro.clickintro = true;
                        }
                        else {
                            uiintro.touchclose = true;
                        }
                        // if(lib.config.theme!='woodden'){
                        uiintro.classList.add('woodbg');
                        // }
                        if (get.is.phoneLayout()) {
                            uiintro.style.width = '100px';
                        }
                        else {
                            uiintro.style.width = '85px';
                        }
                        var source = this.parentNode;
                        for (var i in list) {
                            var node = ui.create.div();
                            node.classList.add('guessidentity');
                            node.classList.add('pointerdiv');
                            ui.create.div('.menubutton.large', list2[i], node);
                            if (!get.is.phoneLayout()) {
                                node.firstChild.style.fontSize = '24px';
                                node.firstChild.style.lineHeight = '24px';
                            }
                            if (get.mode() == 'guozhan') {
                                if (source._guozhanguess) {
                                    if (!source._guozhanguess.contains(i)) {
                                        node.classList.add('transparent');
                                    }
                                }
                                node._source = source;
                                node.listen(ui.click.identitycircle);
                            }
                            else {
                                node.listen(function () {
                                    var info = this.link;
                                    info[0].firstChild.innerHTML = info[1];
                                    info[0].dataset.color = info[2];
                                    _status.clicked = false;
                                });
                            }

                            node.link = [this, list[i], i];
                            uiintro.add(node);
                        }
                    };
                    ui.click.touchpop();
                    ui.click.intro.call(this, {
                        clientX: (rect.left + rect.width) * game.documentZoom,
                        clientY: (rect.top) * game.documentZoom
                    });
                    // var nodes=[];
                    // _status.clickingidentity=[this.parentNode,nodes];
                    // var num=1;
                    // var dy=30;
                    // if(get.is.phoneLayout()){
                    //     dy=45;
                    // }
                    // for(var i in list){
                    //     if(this.firstChild.innerHTML!=list[i]){
                    //         var node=ui.create.div('.identity.hidden.pointerdiv',this.parentNode,ui.click.identity2);
                    //         ui.create.div(node).innerHTML=list[i];
                    //         node.dataset.color=i;
                    //         ui.refresh(node);
                    //         node.show();
                    //         var transstr='translateY('+((num++)*dy)+'px)';
                    //         if(get.is.phoneLayout()){
                    //             transstr+=' scale(1.3)';
                    //         }
                    //         if(get.is.newLayout()&amp;&amp;this.parentNode.classList.contains('linked')){
                    //             transstr+=' rotate(90deg)';
                    //         }
                    //         node.style.transform=transstr;
                    //         nodes.push(node);
                    //     }
                    // }
                }
            },
            identity2: function () {
                if (_status.clickingidentity) {
                    _status.clicked = true;
                    var player = _status.clickingidentity[0];
                    var nodes = _status.clickingidentity[1];
                    player.node.identity.dataset.color = this.dataset.color;
                    player.node.identity.firstChild.innerHTML = this.firstChild.innerHTML;
                    for (var i = 0; i &lt; nodes.length; i++) {
                        nodes[i].delete();
                        nodes[i].style.transform = '';
                    }
                    delete _status.clickingidentity;
                }
            },
            roundmenu: function () {
                game.closeConnectMenu();
                switch (lib.config.round_menu_func) {
                    case 'system':
                        game.closePopped();
                        ui.system1.classList.add('shown');
                        ui.system2.classList.add('shown');
                        game.closeMenu();
                        ui.click.shortcut();
                        break;
                    case 'menu':
                        if (ui.click.configMenu) {
                            game.closePopped();
                            game.pause2();
                            ui.click.configMenu();
                            ui.system1.classList.remove('shown');
                            ui.system2.classList.remove('shown');
                        }
                        break;
                    case 'pause':
                        ui.click.pause();
                        break;
                    case 'auto':
                        ui.click.auto();
                        break;
                }
                _status.clicked = true;
            },
            pausehistory: function () {
                if (!lib.config.auto_popped_history) return;
                if (!ui.sidebar.childNodes.length) return;
                var uiintro = ui.create.dialog('hidden');
                uiintro.style.maxHeight = '400px';
                uiintro.add(ui.sidebar);
                return uiintro;
            },
            pauseconfig: function () {
                if (!lib.config.auto_popped_config) return;
                if (get.is.phoneLayout()) return;
                var uiintro = ui.create.dialog('hidden');
                uiintro.listen(function (e) {
                    e.stopPropagation();
                });

                var rows = Math.floor(lib.config.all.mode.length / 3);
                uiintro.type = 'config';
                var modes = lib.config.modeorder || lib.config.all.mode.slice(0);
                for (var i = 0; i &lt; modes.length; i++) {
                    if (!lib.config.all.mode.contains(modes[i])) {
                        modes.splice(i--, 1);
                    }
                }
                for (var k = 0; k &lt; rows; k++) {
                    var node = ui.create.div('.newgame.pointernode');
                    for (var i = 0; i &lt; 3 &amp;&amp; i + k * 3 &lt; modes.length; i++) {
                        var thismode = modes[i + k * 3];
                        var div = ui.create.div(thismode == (_status.sourcemode || lib.config.mode) ? '.underlinenode.on' : '.underlinenode', node);
                        div.innerHTML = lib.translate[thismode];
                        div.link = thismode;
                        div.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', function () {
                            game.saveConfig('mode', this.link);
                            localStorage.setItem(lib.configprefix + 'directstart', true);
                            game.reload();
                        });
                    }
                    uiintro.add(node);
                }

                return uiintro;
            },
            cardPileButton: function () {
                var uiintro = ui.create.dialog('hidden');
                uiintro.listen(function (e) {
                    e.stopPropagation();
                });
                var num;
                if (game.online) {
                    num = _status.cardPileNum || 0;
                }
                else {
                    num = ui.cardPile.childNodes.length;
                }
                uiintro.add(' &lt;span style="font-family:' + 'xinwei' + '">' + num);

                if (_status.connectMode) return uiintro;
                uiintro.add('&lt;div class="text center"> &lt;span style="font-family:xinwei">' + game.roundNumber + '&lt;/span>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &lt;span style="font-family:xinwei">' + game.shuffleNumber + '&lt;/div>');
                uiintro.add('&lt;div class="text center">&lt;/div>');
                if (ui.discardPile.childNodes.length) {
                    var list = [];
                    for (var i = 0; i &lt; ui.discardPile.childNodes.length; i++) {
                        list.unshift(ui.discardPile.childNodes[i]);
                    }
                    uiintro.addSmall([list, 'card']);
                }
                else {
                    uiintro.add('&lt;div class="text center" style="padding-bottom:3px">&lt;/div>');
                }
                return uiintro;
            },
            chat: function () {
                ui.system1.classList.add('shown');
                ui.system2.classList.add('shown');

                var uiintro = ui.create.dialog('hidden');
                uiintro.listen(function (e) {
                    e.stopPropagation();
                });

                var list = ui.create.div('.caption');
                if (get.is.phoneLayout()) {
                    list.style.maxHeight = '110px';
                }
                else {
                    list.style.maxHeight = '220px';
                }
                list.style.overflow = 'scroll';
                lib.setScroll(list);
                uiintro.contentContainer.style.overflow = 'hidden';

                var input;
                var addEntry = function (info, clear) {
                    if (list._chatempty) {
                        list.innerHTML = '';
                        delete list._chatempty;
                    }
                    var node = ui.create.div('.text.chat');
                    node.innerHTML = info[0] + ': ' + info[1];
                    list.appendChild(node);
                    list.scrollTop = list.scrollHeight;
                    uiintro.style.height = uiintro.content.scrollHeight + 'px';
                }
                _status.addChatEntry = addEntry;
                _status.addChatEntry._origin = uiintro;
                if (lib.chatHistory.length) {
                    for (var i = 0; i &lt; lib.chatHistory.length; i++) {
                        addEntry(lib.chatHistory[i]);
                    }
                }
                else {
                    list._chatempty = true;
                    list.appendChild(ui.create.div('.text.center', ''))
                }
                uiintro.add(list);
                uiintro.style.height = uiintro.content.offsetHeight + 'px';
                list.scrollTop = list.scrollHeight;

                if (!_status.chatValue) _status.chatValue = '';
                var node = uiintro.add('&lt;input type="text" value="' + _status.chatValue + '">');
                node.style.paddingTop = 0;
                node.style.marginBottom = '16px';
                input = node.firstChild;
                input.style.width = 'calc(100% - 20px)';
                input.onchange = function () {
                    _status.chatValue = input.value;
                }
                input.onkeydown = function (e) {
                    if (e.keyCode == 13 &amp;&amp; input.value) {
                        var player = game.me;
                        var str = input.value;
                        if (!player) {
                            if (game.connectPlayers) {
                                if (game.online) {
                                    for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                        if (game.connectPlayers[i].playerid == game.onlineID) {
                                            player = game.connectPlayers[i]; break;
                                        }
                                    }
                                }
                                else {
                                    player = game.connectPlayers[0];
                                }
                            }
                        }
                        if (!player) return;
                        if (get.is.banWords(input.value)) {
                            player.say(input.value);
                            input.value = '';
                            _status.chatValue = '';
                        }
                        else {
                            if (game.online) {
                                game.send('chat', game.onlineID, str);
                            }
                            else {
                                lib.element.player.chat.call(player, str);
                            }
                            input.value = '';
                            _status.chatValue = '';
                        }
                    }
                    e.stopPropagation();
                }
                uiintro._onopen = function () {
                    input.focus();
                    list.scrollTop = list.scrollHeight;
                };
                uiintro._heightfixed = true;
                var emotionTitle = ui.create.div('.text.center', '', function () {
                    if (emotionTitle.innerHTML == '') {
                        emotionTitle.innerHTML = '';
                        list2.remove();
                        list3.remove();
                        uiintro.add(list1);
                        while (list2.childNodes.length) {
                            list2.firstChild.remove();
                        }
                    }
                    else {
                        emotionTitle.innerHTML = '';
                        list1.remove();
                        list2.remove();
                        uiintro.add(list3);
                    }
                });
                uiintro.add(emotionTitle);
                var list1 = ui.create.div('');
                if (get.is.phoneLayout()) {
                    list1.style.height = '110px';
                }
                else {
                    list1.style.height = '150px';
                }
                list1.style.overflow = 'scroll';
                lib.setScroll(list1);
                uiintro.add(list1);
                uiintro.style.height = uiintro.content.scrollHeight + 'px';
                var list2 = ui.create.div('');
                if (get.is.phoneLayout()) {
                    list2.style.height = '110px';
                }
                else {
                    list2.style.height = '150px';
                }
                list2.style.overflow = 'scroll';
                lib.setScroll(list2);
                //uiintro.add(list2);
                for (var i in lib.emotionList) {
                    var emotionPack = ui.create.div('.card.fullskin', '&lt;img src="' + lib.assetURL + 'image/emotion/' + i + '/1.gif" width="50" height="50">', function () {
                        emotionTitle.innerHTML = get.translation(this.pack);
                        for (var j = 1; j &lt;= lib.emotionList[this.pack]; j++) {
                            var emotionButton = ui.create.div('.card.fullskin', '&lt;img src="' + lib.assetURL + 'image/emotion/' + this.pack + '/' + j + '.gif" width="50" height="50">', function () {
                                var player = game.me;
                                if (!player) {
                                    if (game.connectPlayers) {
                                        if (game.online) {
                                            for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                                if (game.connectPlayers[i].playerid == game.onlineID) {
                                                    player = game.connectPlayers[i]; break;
                                                }
                                            }
                                        }
                                        else {
                                            player = game.connectPlayers[0];
                                        }
                                    }
                                }
                                if (!player) return;
                                if (game.online) {
                                    game.send('emotion', game.onlineID, this.pack, this.emotionID);
                                }
                                else {
                                    lib.element.player.emotion.apply(player, [this.pack, this.emotionID]);
                                }
                            });
                            emotionButton.emotionID = j;
                            emotionButton.pack = this.pack;
                            emotionButton.style.height = '50px';
                            emotionButton.style.width = '50px';
                            list2.appendChild(emotionButton);
                        }
                        list1.remove();
                        uiintro.add(list2);
                    });
                    emotionPack.pack = i;
                    emotionPack.style.height = '50px';
                    emotionPack.style.width = '50px';
                    list1.appendChild(emotionPack);
                }
                list1.scrollTop = list1.scrollHeight;
                uiintro.style.height = uiintro.content.scrollHeight + 'px';
                var list3 = ui.create.div('.caption');
                if (get.is.phoneLayout()) {
                    list3.style.height = '110px';
                }
                else {
                    list3.style.height = '150px';
                }
                list3.style.overflow = 'scroll';
                lib.setScroll(list3);
                for (var i = 0; i &lt; lib.quickVoice.length; i++) {
                    var node = ui.create.div('.text.chat', function () {
                        var player = game.me;
                        var str = this.innerHTML;
                        if (!player) {
                            if (game.connectPlayers) {
                                if (game.online) {
                                    for (var i = 0; i &lt; game.connectPlayers.length; i++) {
                                        if (game.connectPlayers[i].playerid == game.onlineID) {
                                            player = game.connectPlayers[i]; break;
                                        }
                                    }
                                }
                                else {
                                    player = game.connectPlayers[0];
                                }
                            }
                        }
                        if (!player) return;
                        if (game.online) {
                            game.send('chat', game.onlineID, str);
                        }
                        else {
                            lib.element.player.chat.call(player, str);
                        }
                    });
                    node.innerHTML = lib.quickVoice[i];
                    list3.appendChild(node);
                }
                list3.scrollTop = list1.scrollHeight;
                return uiintro;
            },
            volumn: function () {
                var uiintro = ui.create.dialog('hidden');
                uiintro.listen(function (e) {
                    e.stopPropagation();
                });
                uiintro.add('');
                var vol1 = ui.create.div('.volumn');
                uiintro.add(vol1);
                for (var i = 0; i &lt; 8; i++) {
                    var span = document.createElement('span');
                    span.link = i + 1;
                    span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.volumn_background);
                    if (i &lt; lib.config.volumn_background) {
                        span.innerHTML = '';
                    }
                    else {
                        span.innerHTML = '';
                    }
                    vol1.appendChild(span);
                }
                uiintro.add('');

                var vol2 = ui.create.div('.volumn');
                uiintro.add(vol2);
                for (var i = 0; i &lt; 8; i++) {
                    var span = document.createElement('span');
                    span.link = i + 1;
                    span.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.volumn_audio);
                    if (i &lt; lib.config.volumn_audio) {
                        span.innerHTML = '';
                    }
                    else {
                        span.innerHTML = '';
                    }
                    vol2.appendChild(span);
                }
                uiintro.add(ui.create.div('.placeholder'));
                return uiintro;
            },
            volumn_background: function (e) {
                if (_status.dragged) return;
                var volume = this.link;
                if (volume === 1 &amp;&amp; lib.config.volumn_background === 1) {
                    volume = 0;
                }
                game.saveConfig('volumn_background', volume);
                ui.backgroundMusic.volume = volume / 8;
                for (var i = 0; i &lt; 8; i++) {
                    if (i &lt; lib.config.volumn_background) {
                        this.parentNode.childNodes[i].innerHTML = '';
                    }
                    else {
                        this.parentNode.childNodes[i].innerHTML = '';
                    }
                }
                e.stopPropagation();
            },
            volumn_audio: function (e) {
                if (_status.dragged) return;
                var volume = this.link;
                if (volume === 1 &amp;&amp; lib.config.volumn_audio === 1) {
                    volume = 0;
                }
                game.saveConfig('volumn_audio', volume);
                for (var i = 0; i &lt; 8; i++) {
                    if (i &lt; lib.config.volumn_audio) {
                        this.parentNode.childNodes[i].innerHTML = '';
                    }
                    else {
                        this.parentNode.childNodes[i].innerHTML = '';
                    }
                }
                e.stopPropagation();
            },
            hoverpopped: function () {
                if (this._uiintro) {
                    return;
                }
                if (!this._poppedfunc) {
                    return;
                }
                ui.click.touchpop(this.forceclick);
                var uiintro = this._poppedfunc();
                if (!uiintro) return;
                if (ui.currentpopped &amp;&amp; ui.currentpopped._uiintro) {
                    ui.currentpopped._uiintro.delete();
                    delete ui.currentpopped._uiintro;
                }
                ui.currentpopped = this;
                uiintro.classList.add('popped');
                uiintro.classList.add('hoverdialog');
                uiintro.classList.add('static');
                this._uiintro = uiintro;

                ui.window.appendChild(uiintro);
                var width = this._poppedwidth || 330;
                uiintro.style.width = width + 'px';
                if (get.is.phoneLayout()) {
                    width *= 1.3;
                }

                if (uiintro._heightfixed) {
                    uiintro.style.height = uiintro.content.scrollHeight + 'px';
                }
                else {
                    var height = this._poppedheight || uiintro.content.scrollHeight;
                    var height2 = ui.window.offsetHeight - 260;
                    if (get.is.phoneLayout()) {
                        height2 = (ui.window.offsetHeight - 80) / 1.3;
                    }
                    uiintro.style.height = Math.min(height2, height) + 'px';
                }
                if (get.is.phoneLayout()) {
                    uiintro.style.top = '70px';
                }
                else {
                    uiintro.style.top = '50px';
                }
                var left = this.parentNode.offsetLeft + this.offsetLeft + this.offsetWidth / 2 - width / 2;
                if (left &lt; 10) {
                    left = 10;
                }
                else if (left + width > ui.window.offsetWidth - 10) {
                    left = ui.window.offsetWidth - width - 10;
                }
                uiintro.style.left = left + 'px';
                uiintro._poppedorigin = this;
                if (!lib.config.touchscreen) {
                    uiintro.addEventListener('mouseleave', ui.click.leavehoverpopped);
                }
                ui.click.shortcut(false);
                if (uiintro._onopen) {
                    uiintro._onopen();
                }
                if (this._paused2 &amp;&amp; !lib.config.touchscreen) {
                    game.pause2();
                    uiintro.classList.add('static');
                    var layer = ui.create.div('.poplayer', ui.window);
                    var clicklayer = function (e) {
                        uiintro.delete();
                        layer.remove();
                        game.resume2();
                        e.stopPropagation();
                        return false;
                    }
                    uiintro.style.zIndex = 21;
                    layer.onclick = clicklayer;
                    layer.oncontextmenu = clicklayer;
                    uiintro.addEventListener('mouseleave', clicklayer);
                    uiintro.addEventListener('click', clicklayer);
                }
            },
            hoverpopped_leave: function () {
                this._poppedalready = false;
            },
            leavehoverpopped: function () {
                if (_status.dragged) return;
                if (this.classList.contains('noleave')) return;
                this.delete();
                var button = this._poppedorigin;

                var uiintro = this;
                setTimeout(function () {
                    if (button._uiintro == uiintro) {
                        delete button._uiintro;
                    }
                }, 500);

            },
            dierevive: function () {
                if (game.me.isDead()) {
                    game.me.revive(Math.max(1, game.me.maxHp));
                    game.me.draw(2);
                }
                else {
                    if (ui.revive) {
                        ui.revive.close();
                        delete ui.revive;
                    }
                }
            },
            dieswap: function () {
                if (game.me.isDead()) {
                    _status.clicked = true;
                    var i, translation, intro, str;
                    if (ui.intro) {
                        ui.intro.close();
                        if (ui.intro.source == 'dieswap') {
                            delete ui.intro;
                            ui.control.show();
                            game.resume2();
                            return;
                        }
                    }
                    game.pause2();
                    ui.control.hide();
                    ui.intro = ui.create.dialog();
                    ui.intro.source = 'dieswap';

                    var players = [];
                    for (var i = 0; i &lt; game.players.length; i++) {
                        if (game.players[i].isAlive()) {
                            players.push(game.players[i]);
                        }
                    }
                    ui.intro.add(players, true);
                    var buttons = ui.intro.querySelectorAll('.button');
                    for (var i = 0; i &lt; buttons.length; i++) {
                        buttons[i].addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.dieswap2);
                    }
                }
                else {
                    if (ui.swap) {
                        ui.swap.close();
                        delete ui.swap;
                    }
                }
            },
            dieswap2: function () {
                if (_status.dragged) return;
                game.swapPlayer(this.link);
            },
            touchconfirm: function () {
                _status.touchconfirmed = true;
                document.removeEventListener('touchstart', ui.click.touchconfirm);
            },
            windowtouchstart: function (e) {
                if (window.inSplash) return;
                if (e.touches[0] &amp;&amp; lib.config.swipe &amp;&amp; e.touches.length &lt; 2) {
                    _status._swipeorigin = {
                        clientX: e.touches[0].clientX,
                        clientY: e.touches[0].clientY,
                        time: get.utc()
                    }
                }
                // if(window.ForceTouch&amp;&amp;!_status.paused2&amp;&amp;!_status.forcetouchinterval&amp;&amp;lib.config.enable_pressure){
                //     _status.forcetouchinterval=setInterval(ui.click.forcetouch,30);
                // }
            },
            windowtouchmove: function (e) {
                e.preventDefault();
                if (window.inSplash) return;
                if (_status.draggingroundmenu) {
                    delete _status._swipeorigin;
                    if (ui.roundmenu._dragorigin &amp;&amp; ui.roundmenu._dragtransform &amp;&amp; e.touches.length) {
                        var translate = ui.roundmenu._dragtransform.slice(0);
                        var dx = e.touches[0].clientX / game.documentZoom - ui.roundmenu._dragorigin.clientX / game.documentZoom;
                        var dy = e.touches[0].clientY / game.documentZoom - ui.roundmenu._dragorigin.clientY / game.documentZoom;
                        translate[0] += dx;
                        translate[1] += dy;
                        if (dx * dx + dy * dy > 100) {
                            if (ui.roundmenu._resetTimeout) {
                                clearTimeout(ui.roundmenu._resetTimeout);
                                delete ui.roundmenu._resetTimeout;
                            }
                        }
                        ui.roundmenu._dragtouches = e.touches[0];
                        ui.click.checkroundtranslate(translate);
                    }
                    _status.clicked = true;
                }
                else if (_status.draggingtouchdialog) {
                    delete _status._swipeorigin;
                    if (_status.draggingtouchdialog._dragorigin &amp;&amp; _status.draggingtouchdialog._dragtransform &amp;&amp; e.touches.length) {
                        var translate = _status.draggingtouchdialog._dragtransform.slice(0);
                        var dx = e.touches[0].clientX / game.documentZoom - _status.draggingtouchdialog._dragorigin.clientX / game.documentZoom;
                        var dy = e.touches[0].clientY / game.documentZoom - _status.draggingtouchdialog._dragorigin.clientY / game.documentZoom;
                        translate[0] += dx;
                        translate[1] += dy;
                        _status.draggingtouchdialog._dragtouches = e.touches[0];
                        ui.click.checkdialogtranslate(translate, _status.draggingtouchdialog);
                    }
                    _status.clicked = true;
                }
                else if (_status._swipeorigin &amp;&amp; e.touches[0]) {
                    _status._swipeorigin.touches = e.touches[0];
                }

                if (_status.mousedragging &amp;&amp; e.touches.length) {
                    e.preventDefault();
                    var item = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);
                    if (game.chess &amp;&amp; ui.selected.cards.length) {
                        var itemtype = get.itemtype(item);
                        if (itemtype != 'card' &amp;&amp; itemtype != 'button') {
                            var ex = e.touches[0].clientX / game.documentZoom - ui.arena.offsetLeft;
                            var ey = e.touches[0].clientY / game.documentZoom - ui.arena.offsetTop;
                            for (var i = 0; i &lt; game.players.length; i++) {
                                var left = -ui.chessContainer.chessLeft + ui.chess.offsetLeft + game.players[i].getLeft();
                                var top = -ui.chessContainer.chessTop + ui.chess.offsetTop + game.players[i].getTop();
                                var width = game.players[i].offsetWidth;
                                var height = game.players[i].offsetHeight;
                                if (ex > left &amp;&amp; ex &lt; left + width &amp;&amp; ey > top &amp;&amp; ey &lt; top + height) {
                                    item = game.players[i];
                                    break;
                                }
                            }
                        }
                    }
                    while (item) {
                        if (lib.config.enable_touchdragline &amp;&amp; _status.mouseleft &amp;&amp; !game.chess) {
                            ui.canvas.width = ui.arena.offsetWidth;
                            ui.canvas.height = ui.arena.offsetHeight;
                            var ctx = ui.ctx;
                            ctx.shadowBlur = 5;
                            ctx.shadowColor = 'rgba(0,0,0,0.3)';
                            ctx.strokeStyle = 'white';
                            ctx.lineWidth = 3;
                            ctx.setLineDash([8, 2]);

                            ctx.beginPath();

                            ctx.moveTo(_status.mousedragging.clientX / game.documentZoom - ui.arena.offsetLeft, _status.mousedragging.clientY / game.documentZoom - ui.arena.offsetTop);

                            if (_status.multitarget) {
                                for (var i = 0; i &lt; _status.lastdragchange.length; i++) {
                                    var exy = _status.lastdragchange[i]._lastdragchange;
                                    ctx.lineTo(exy[0], exy[1]);
                                }
                            }
                            if (!_status.selectionfull) {
                                ctx.lineTo(e.touches[0].clientX / game.documentZoom - ui.arena.offsetLeft, e.touches[0].clientY / game.documentZoom - ui.arena.offsetTop);
                            }
                            ctx.stroke();
                            if (!_status.multitarget) {
                                for (var i = 0; i &lt; _status.lastdragchange.length; i++) {
                                    ctx.moveTo(_status.mousedragging.clientX / game.documentZoom - ui.arena.offsetLeft, _status.mousedragging.clientY / game.documentZoom - ui.arena.offsetTop);
                                    var exy = _status.lastdragchange[i]._lastdragchange;
                                    ctx.lineTo(exy[0], exy[1]);
                                    ctx.stroke();
                                }
                            }
                        }

                        if (item == _status.mousedragorigin) {
                            if (_status.mouseleft) {
                                _status.mousedragging = null;
                                _status.mousedragorigin = null;
                                _status.clicked = false;
                                game.uncheck();
                                game.check();
                                _status.clicked = true;
                            }
                            return;
                        }
                        var itemtype = get.itemtype(item);
                        if (itemtype == 'card' || itemtype == 'button' || itemtype == 'player') {
                            _status.mouseleft = true;
                            if (ui.selected.cards.length) {
                                ui.selected.cards[0].updateTransform(true, 100);
                            }
                            var ex = e.touches[0].clientX / game.documentZoom - ui.arena.offsetLeft;
                            var ey = e.touches[0].clientY / game.documentZoom - ui.arena.offsetTop;
                            var exx = ex, eyy = ey;
                            if (game.chess) {
                                ex -= -ui.chessContainer.chessLeft + ui.chess.offsetLeft;
                                ey -= -ui.chessContainer.chessTop + ui.chess.offsetTop;
                            }
                            if (itemtype != 'player' || game.chess || (ex > item.offsetLeft &amp;&amp; ex &lt; item.offsetLeft + item.offsetWidth &amp;&amp;
                                ey > item.offsetTop &amp;&amp; ey &lt; item.offsetTop + item.offsetHeight)) {
                                var targetfixed = false;
                                if (itemtype == 'player') {
                                    if (get.select(_status.event.selectTarget)[1] == -1) {
                                        targetfixed = true;
                                    }
                                }
                                if (!targetfixed &amp;&amp; item.classList.contains('selectable') &amp;&amp; _status.dragstatuschanged != item) {
                                    _status.mouseleft = true;
                                    _status.dragstatuschanged = item;
                                    _status.clicked = false;
                                    _status.dragged = false;
                                    var notbefore = itemtype == 'player' &amp;&amp; !item.classList.contains('selected');
                                    ui.click[itemtype].call(item);
                                    if (item.classList.contains('selected')) {
                                        if (notbefore) {
                                            _status.lastdragchange.push(item);
                                            item._lastdragchange = [exx, eyy];
                                            if (lib.falseitem) {
                                                var from = [_status.mousedragging.clientX / game.documentZoom - ui.arena.offsetLeft, _status.mousedragging.clientY / game.documentZoom - ui.arena.offsetTop];
                                                var to = [exx, eyy];
                                                var node = ui.create.div('.linexy.hidden');
                                                node.style.left = from[0] + 'px';
                                                node.style.top = from[1] + 'px';
                                                node.style.transitionDuration = '0.3s';
                                                node.style.backgroundColor = 'white';
                                                var dy = to[1] - from[1];
                                                var dx = to[0] - from[0];
                                                var deg = Math.atan(Math.abs(dy) / Math.abs(dx)) / Math.PI * 180;
                                                if (dx >= 0) {
                                                    if (dy &lt;= 0) {
                                                        deg += 90;
                                                    }
                                                    else {
                                                        deg = 90 - deg;
                                                    }
                                                }
                                                else {
                                                    if (dy &lt;= 0) {
                                                        deg = 270 - deg;
                                                    }
                                                    else {
                                                        deg += 270;
                                                    }
                                                }
                                                node.style.transform = 'rotate(' + (-deg) + 'deg) scaleY(0)';
                                                node.style.height = get.xyDistance(from, to) + 'px';
                                                if (game.chess) {
                                                    ui.chess.appendChild(node);
                                                }
                                                else {
                                                    ui.arena.appendChild(node);
                                                }
                                                ui.refresh(node);
                                                node.show();
                                                node.style.transform = 'rotate(' + (-deg) + 'deg) scaleY(1)';
                                                ui.touchlines.push(node);
                                                node._origin = item;
                                            }
                                        }
                                    }
                                    else {
                                        _status.lastdragchange.remove(item);
                                        for (var i = 0; i &lt; ui.touchlines.length; i++) {
                                            if (ui.touchlines[i]._origin == item) {
                                                ui.touchlines[i].delete();
                                                ui.touchlines.splice(i--, 1);
                                            }
                                        }
                                    }
                                    _status.selectionfull = true;
                                    if (_status.event.filterButton &amp;&amp; ui.selected.buttons.length &lt; get.select(_status.event.selectButton)[1]) {
                                        _status.selectionfull = false;
                                    }
                                    else if (_status.event.filterCard &amp;&amp; ui.selected.cards.length &lt; get.select(_status.event.selectCard)[1]) {
                                        _status.selectionfull = false;
                                    }
                                    else if (_status.event.filterTarget &amp;&amp; ui.selected.targets.length &lt; get.select(_status.event.selectTarget)[1]) {
                                        _status.selectionfull = false;
                                    }
                                }
                            }
                            return;
                        }
                        item = item.parentNode;
                    }
                    _status.mouseleft = true;
                    _status.dragstatuschanged = null;
                }
            },
            windowtouchend: function (e) {
                delete _status.force;
                // if(_status.forcetouchinterval){
                //     clearInterval(_status.forcetouchinterval);
                //     delete _status.forcetouchinterval;
                // }
                if (window.inSplash) return;
                if (e.touches.length == 1 &amp;&amp; !_status.dragged &amp;&amp; !_status.draggingtouchdialog) {
                    ui.click.pause();
                }
                if (_status.draggingroundmenu) {
                    delete _status._swipeorigin;
                    if (ui.roundmenu._resetTimeout) {
                        clearTimeout(ui.roundmenu._resetTimeout);
                        delete ui.roundmenu._resetTimeout;
                    }
                    var translate;
                    if (ui.roundmenu._dragorigin &amp;&amp; ui.roundmenu._dragtransform &amp;&amp; ui.roundmenu._dragtouches) {
                        var dx = ui.roundmenu._dragtouches.clientX / game.documentZoom - ui.roundmenu._dragorigin.clientX / game.documentZoom;
                        var dy = ui.roundmenu._dragtouches.clientY / game.documentZoom - ui.roundmenu._dragorigin.clientY / game.documentZoom;
                        if (dx * dx + dy * dy &lt; 1000) {
                            ui.click.roundmenu();
                            ui.roundmenu._dragtransform = ui.roundmenu._dragorigintransform;
                            translate = ui.roundmenu._dragtransform;
                            ui.roundmenu.style.transform = 'translate(' + translate[0] + 'px,' + translate[1] + 'px)';
                        }
                        else {
                            translate = ui.roundmenu._dragtransform;
                            translate[0] += dx;
                            translate[1] += dy;
                            ui.click.checkroundtranslate();
                        }
                        delete ui.roundmenu._dragorigin;
                    }
                    else {
                        ui.click.roundmenu();
                    }
                    _status.clicked = false;
                    game.saveConfig('roundmenu_transform', translate);
                    delete _status.draggingroundmenu;
                }
                else if (_status.draggingtouchdialog) {
                    delete _status._swipeorigin;
                    var translate;
                    if (_status.draggingtouchdialog._dragorigin &amp;&amp; _status.draggingtouchdialog._dragtransform &amp;&amp; _status.draggingtouchdialog._dragtouches) {
                        var dx = _status.draggingtouchdialog._dragtouches.clientX / game.documentZoom - _status.draggingtouchdialog._dragorigin.clientX / game.documentZoom;
                        var dy = _status.draggingtouchdialog._dragtouches.clientY / game.documentZoom - _status.draggingtouchdialog._dragorigin.clientY / game.documentZoom;
                        translate = _status.draggingtouchdialog._dragtransform;
                        translate[0] += dx;
                        translate[1] += dy;
                        ui.click.checkdialogtranslate(null, _status.draggingtouchdialog);

                        delete _status.draggingtouchdialog._dragorigin;
                    }
                    _status.clicked = false;
                    game.saveConfig('dialog_transform', translate);
                    delete _status.draggingtouchdialog;
                    _status.justdragged = true;
                    setTimeout(function () {
                        _status.justdragged = false;
                    }, 500);
                }
                else if (_status._swipeorigin &amp;&amp; !_status.paused2 &amp;&amp; !_status.mousedragging &amp;&amp; _status._swipeorigin.touches &amp;&amp; !_status.filterCharacter) {
                    if (get.utc() - _status._swipeorigin.time &lt; 500) {
                        var dx = _status._swipeorigin.touches.clientX / game.documentZoom - _status._swipeorigin.clientX / game.documentZoom;
                        var dy = _status._swipeorigin.touches.clientY / game.documentZoom - _status._swipeorigin.clientY / game.documentZoom;
                        var goswipe = function (action) {
                            game.closeConnectMenu();
                            switch (action) {
                                case 'system':
                                    game.closePopped();
                                    ui.system1.classList.add('shown');
                                    ui.system2.classList.add('shown');
                                    game.closeMenu();
                                    ui.click.shortcut();
                                    break;
                                case 'menu':
                                    if (ui.click.configMenu) {
                                        game.closePopped();
                                        game.pause2();
                                        ui.click.configMenu();
                                        ui.system1.classList.remove('shown');
                                        ui.system2.classList.remove('shown');
                                    }
                                    break;
                                case 'pause':
                                    ui.click.pause();
                                    break;
                                case 'auto':
                                    ui.click.auto();
                                    break;
                                case 'chat':
                                    game.closeMenu();
                                    if (ui.chatButton) {
                                        ui.click.hoverpopped.call(ui.chatButton);
                                    }
                                    break;
                            }
                        }
                        if (Math.abs(dx) &lt; 100) {
                            if (dy &lt; -200) {
                                goswipe(lib.config.swipe_up);
                            }
                            else if (dy > 200) {
                                goswipe(lib.config.swipe_down);
                            }
                        }
                        else if (Math.abs(dy) &lt; 100) {
                            if (dx &lt; -200) {
                                goswipe(lib.config.swipe_left);
                            }
                            else if (dx > 200) {
                                goswipe(lib.config.swipe_right);
                            }
                        }
                    }
                }
                var tmpflag = false;
                _status.mousedown = false;
                _status.clicked = false;
                if (_status.mousedragging &amp;&amp; _status.mouseleft) {
                    if (game.check()) {
                        if (ui.confirm) {
                            ui.confirm.close();
                        }
                        ui.click.ok();
                        ui.canvas.width = ui.arena.offsetWidth;
                        ui.canvas.height = ui.arena.offsetHeight;
                    }
                    else {
                        game.uncheck();
                        game.check();
                    }
                }
                else if (_status.mousedragging &amp;&amp; _status.mousedragorigin) {
                    tmpflag = _status.mousedragorigin;
                }
                _status.lastdragchange.length = 0;
                _status.mousedragging = null;
                _status.mouseleft = false;
                _status.mousedragorigin = null;
                _status.dragstatuschanged = false;
                while (ui.touchlines.length) {
                    ui.touchlines.shift().delete();
                }
                if (tmpflag) {
                    game.check();
                }
                _status.dragged = false;
                _status.clicked = false;
            },
            checkroundtranslate: function (translate) {
                var translate = translate || ui.roundmenu._dragtransform;
                if (translate[1] + ui.roundmenu._position[1] + 50 + ui.arena.offsetTop > ui.window.offsetHeight) {
                    translate[1] = ui.window.offsetHeight - (ui.roundmenu._position[1] + 50) - ui.arena.offsetTop;
                }
                else if (translate[1] + ui.roundmenu._position[1] + ui.arena.offsetTop &lt; 0) {
                    translate[1] = -ui.roundmenu._position[1] - ui.arena.offsetTop;
                }
                if (translate[0] + ui.roundmenu._position[0] + 50 + ui.arena.offsetLeft > ui.window.offsetWidth) {
                    translate[0] = ui.window.offsetWidth - (ui.roundmenu._position[0] + 50) - ui.arena.offsetLeft;
                }
                else if (translate[0] + ui.roundmenu._position[0] + ui.arena.offsetLeft &lt; 0) {
                    translate[0] = -ui.roundmenu._position[0] - ui.arena.offsetLeft;
                }
                ui.roundmenu.style.transform = 'translate(' + translate[0] + 'px,' + translate[1] + 'px)';
            },
            checkdialogtranslate: function (translate, dialog) {
                var translate = translate || dialog._dragtransform;
                if (Math.sqrt(translate[0] * translate[0] + translate[1] * translate[1]) &lt; 10) {
                    translate[0] = 0;
                    translate[1] = 0;
                }
                dialog.style.transform = 'translate(' + translate[0] + 'px,' + translate[1] + 'px)';
            },
            windowmousewheel: function (e) {
                _status.tempunpopup = e;
            },
            windowmousemove: function (e) {
                if (window.inSplash) return;
                if (_status.tempunpopup) {
                    if (get.evtDistance(_status.tempunpopup, e) > 5) {
                        delete _status.tempunpopup;
                    }
                }
                if (e.button == 2) return;
                var dialogs = document.querySelectorAll('#window>.dialog.popped:not(.static)');
                for (var i = 0; i &lt; dialogs.length; i++) {
                    dialogs[i].delete();
                }
                var node = _status.currentmouseenter;
                var sourceitem = document.elementFromPoint(e.clientX, e.clientY);
                if (game.chess &amp;&amp; ui.selected.cards.length) {
                    var itemtype = get.itemtype(sourceitem);
                    if (itemtype != 'card' &amp;&amp; itemtype != 'button') {
                        for (var i = 0; i &lt; game.players.length; i++) {
                            var ex = e.clientX / game.documentZoom - ui.arena.offsetLeft;
                            var ey = e.clientY / game.documentZoom - ui.arena.offsetTop;
                            var left = -ui.chessContainer.chessLeft + ui.chess.offsetLeft + game.players[i].getLeft();
                            var top = -ui.chessContainer.chessTop + ui.chess.offsetTop + game.players[i].getTop();
                            var width = game.players[i].offsetWidth;
                            var height = game.players[i].offsetHeight;
                            if (ex > left &amp;&amp; ex &lt; left + width &amp;&amp; ey > top &amp;&amp; ey &lt; top + height) {
                                sourceitem = game.players[i];
                                break;
                            }
                        }
                    }
                }
                var item = sourceitem;
                if (_status.mousedragging) {
                    e.preventDefault();
                    if (lib.config.enable_dragline) {
                        // var i=0;
                        // var startPoint0=[_status.mousedragging.clientX/game.documentZoom-ui.arena.offsetLeft,_status.mousedragging.clientY/game.documentZoom-ui.arena.offsetTop];
                        // var startPoint=startPoint0;
                        // var endPoint;
                        // if(_status.multitarget){
                        //     for(;i&lt;_status.lastdragchange.length;i++){
                        //         var exy=_status.lastdragchange[i]._lastdragchange;
                        //         endPoint=[exy[0],exy[1]];
                        //         _status.dragline[i]=game.linexy(startPoint.concat(endPoint),'drag',_status.dragline[i]);
                        //         startPoint=endPoint;
                        //     }
                        // }
                        // if(!_status.selectionfull){
                        //     endPoint=[e.clientX/game.documentZoom-ui.arena.offsetLeft,e.clientY/game.documentZoom-ui.arena.offsetTop];
                        //     _status.dragline[i]=game.linexy(startPoint.concat(endPoint),'drag',_status.dragline[i]);
                        //     startPoint=endPoint;
                        //     i++;
                        // }
                        // if(!_status.multitarget){
                        //     for(var j=0;j&lt;_status.lastdragchange.length;j++){
                        //         i+=j;
                        //         var exy=_status.lastdragchange[j]._lastdragchange;
                        //         _status.dragline[i]=game.linexy(startPoint0.concat([exy[0],exy[1]]),'drag',_status.dragline[i]);
                        //     }
                        // }
                        // var remained=_status.dragline.splice(i+1);
                        // for(var j=0;j&lt;remained.length;j++){
                        //     if(remained[j]) remained[j].remove();
                        // }

                        ui.canvas.width = ui.arena.offsetWidth;
                        ui.canvas.height = ui.arena.offsetHeight;
                        var ctx = ui.ctx;
                        ctx.shadowBlur = 5;
                        ctx.shadowColor = 'rgba(0,0,0,0.3)';
                        ctx.strokeStyle = 'white';
                        ctx.lineWidth = 3;
                        ctx.setLineDash([8, 2]);

                        ctx.beginPath();

                        ctx.moveTo(_status.mousedragging.clientX / game.documentZoom - ui.arena.offsetLeft, _status.mousedragging.clientY / game.documentZoom - ui.arena.offsetTop);
                        if (_status.multitarget) {
                            for (var i = 0; i &lt; _status.lastdragchange.length; i++) {
                                var exy = _status.lastdragchange[i]._lastdragchange;
                                ctx.lineTo(exy[0], exy[1]);
                            }
                        }
                        if (!_status.selectionfull) {
                            ctx.lineTo(e.clientX / game.documentZoom - ui.arena.offsetLeft, e.clientY / game.documentZoom - ui.arena.offsetTop);
                        }
                        ctx.stroke();
                        if (!_status.multitarget) {
                            for (var i = 0; i &lt; _status.lastdragchange.length; i++) {
                                ctx.moveTo(_status.mousedragging.clientX / game.documentZoom - ui.arena.offsetLeft, _status.mousedragging.clientY / game.documentZoom - ui.arena.offsetTop);
                                var exy = _status.lastdragchange[i]._lastdragchange;
                                ctx.lineTo(exy[0], exy[1]);
                                ctx.stroke();
                            }
                        }
                    }

                    while (item) {
                        if (item == _status.mousedragorigin) {
                            if (_status.mouseleft) {
                                _status.mousedragging = null;
                                _status.mousedragorigin = null;
                                _status.clicked = false;
                                if (_status.event.type == 'phase' &amp;&amp; !_status.event.skill &amp;&amp; ui.confirm) {
                                    ui.confirm.classList.add('removing');
                                }
                                game.uncheck();
                                game.check();
                                _status.clicked = true;
                            }
                            return;
                        }
                        var itemtype = get.itemtype(item);
                        if (itemtype == 'card' || itemtype == 'button' || itemtype == 'player') {
                            _status.mouseleft = true;
                            if (ui.selected.cards.length) {
                                ui.selected.cards[0].updateTransform(true, 100);
                            }
                            var ex = e.clientX / game.documentZoom - ui.arena.offsetLeft;
                            var ey = e.clientY / game.documentZoom - ui.arena.offsetTop;
                            var exx = ex, eyy = ey;
                            if (game.chess) {
                                ex -= -ui.chessContainer.chessLeft + ui.chess.offsetLeft;
                                ey -= -ui.chessContainer.chessTop + ui.chess.offsetTop;
                            }
                            if (itemtype != 'player' || game.chess || (ex > item.offsetLeft &amp;&amp; ex &lt; item.offsetLeft + item.offsetWidth &amp;&amp;
                                ey > item.offsetTop &amp;&amp; ey &lt; item.offsetTop + item.offsetHeight)) {
                                var targetfixed = false;
                                if (itemtype == 'player') {
                                    if (get.select(_status.event.selectTarget)[1] == -1) {
                                        targetfixed = true;
                                    }
                                }
                                if (!targetfixed &amp;&amp; item.classList.contains('selectable') &amp;&amp; _status.dragstatuschanged != item) {
                                    _status.mouseleft = true;
                                    _status.dragstatuschanged = item;
                                    _status.clicked = false;
                                    var notbefore = itemtype == 'player' &amp;&amp; !item.classList.contains('selected');
                                    ui.click[itemtype].call(item);
                                    if (item.classList.contains('selected')) {
                                        if (notbefore) {
                                            _status.lastdragchange.push(item);
                                            item._lastdragchange = [exx, eyy];
                                        }
                                    }
                                    else {
                                        _status.lastdragchange.remove(item);
                                    }
                                    _status.selectionfull = true;
                                    if (_status.event.filterButton &amp;&amp; ui.selected.buttons.length &lt; get.select(_status.event.selectButton)[1]) {
                                        _status.selectionfull = false;
                                    }
                                    else if (_status.event.filterCard &amp;&amp; ui.selected.cards.length &lt; get.select(_status.event.selectCard)[1]) {
                                        _status.selectionfull = false;
                                    }
                                    else if (_status.event.filterTarget &amp;&amp; ui.selected.targets.length &lt; get.select(_status.event.selectTarget)[1]) {
                                        _status.selectionfull = false;
                                    }
                                }
                            }
                            return;
                        }
                        item = item.parentNode;
                    }
                    if (!_status.mouseleft) {
                        _status.mouseleft = true;
                        game.check();
                        for (var i = 0; i &lt; ui.selected.cards.length; i++) {
                            ui.selected.cards[i].updateTransform(true);
                        }
                    }
                    _status.dragstatuschanged = null;
                }
                else {
                    while (item) {
                        if (item == node &amp;&amp; !node._mouseentercreated) {
                            ui.click.mouseentercancel();
                            var hoveration;
                            if (typeof node._hoveration == 'number') {
                                hoveration = node._hoveration;
                            }
                            else {
                                hoveration = parseInt(lib.config.hoveration);
                                if (node.classList.contains('button') ||
                                    (node.parentNode &amp;&amp; node.parentNode.parentNode) == ui.me) {
                                    hoveration += 500;
                                }
                            }
                            _status._mouseentertimeout = setTimeout(function () {
                                if (_status.currentmouseenter != node || node._mouseentercreated || _status.tempunpopup ||
                                    _status.mousedragging || _status.mousedown || !node.offsetWidth || !node.offsetHeight) {
                                    return;
                                }
                                if (node._hoverfunc &amp;&amp; !node._nopup) {
                                    var dialog = node._hoverfunc.call(node, e);
                                    if (dialog) {
                                        dialog.classList.add('popped');
                                        ui.window.appendChild(dialog);
                                        lib.placePoppedDialog(dialog, e);
                                        if (node._hoverwidth) {
                                            dialog.style.width = node._hoverwidth + 'px';
                                            dialog._hovercustomed = true;
                                        }
                                        node._mouseenterdialog = dialog;
                                        node._mouseentercreated = true;
                                    }
                                }
                            }, hoveration);
                            break;
                        }
                        item = item.parentNode;
                    }
                    if (_status.draggingdialog) {
                        var ddialog = _status.draggingdialog;
                        if (ddialog._dragorigin &amp;&amp; ddialog._dragtransform) {
                            var translate = ddialog._dragtransform.slice(0);
                            translate[0] += e.clientX / game.documentZoom - ddialog._dragorigin.clientX / game.documentZoom;
                            translate[1] += e.clientY / game.documentZoom - ddialog._dragorigin.clientY / game.documentZoom;
                            ui.click.checkdialogtranslate(translate, ddialog);
                        }
                        _status.clicked = true;
                    }
                    if (_status.draggingroundmenu) {
                        if (ui.roundmenu._dragorigin &amp;&amp; ui.roundmenu._dragtransform) {
                            var translate = ui.roundmenu._dragtransform.slice(0);
                            translate[0] += e.clientX / game.documentZoom - ui.roundmenu._dragorigin.clientX / game.documentZoom;
                            translate[1] += e.clientY / game.documentZoom - ui.roundmenu._dragorigin.clientY / game.documentZoom;
                            ui.click.checkroundtranslate(translate);
                        }
                        _status.clicked = true;
                    }
                }
            },
            windowmousedown: function (e) {
                if (window.inSplash) return;
                if (!ui.window) return;
                if (e.button == 2) return;
                _status.mousedown = true;
                var dialogs = ui.window.querySelectorAll('#window>.dialog.popped:not(.static)');
                for (var i = 0; i &lt; dialogs.length; i++) {
                    dialogs[i].delete();
                }
                var sourceitem = document.elementFromPoint(e.clientX, e.clientY);
                var item = sourceitem;
                while (item) {
                    var itemtype = get.itemtype(item);
                    if (itemtype == 'button') break;
                    if (itemtype == 'dialog' &amp;&amp;
                        !item.classList.contains('popped') &amp;&amp;
                        !item.classList.contains('fixed')) {
                        var ddialog = item;
                        _status.draggingdialog = ddialog;
                        ddialog._dragorigin = e;
                        if (!ddialog._dragtransform) {
                            ddialog._dragtransform = [0, 0];
                        }
                        return;
                    }
                    if (item == ui.roundmenu) {
                        _status.draggingroundmenu = true;
                        ui.roundmenu._dragorigin = e;
                        if (!ui.roundmenu._dragtransform) {
                            ui.roundmenu._dragtransform = [0, 0];
                        }
                        return;
                    }
                    item = item.parentNode;
                }

                var evt = _status.event;
                if (!lib.config.enable_drag) return;
                if (!ui.arena.classList.contains('selecting')) return;
                if (!evt.isMine()) return;

                item = sourceitem;
                while (item) {
                    var itemtype = get.itemtype(item);
                    if (itemtype == 'card' || itemtype == 'button' || itemtype == 'player') {
                        if (item.classList.contains('selectable') &amp;&amp;
                            !item.classList.contains('selected') &amp;&amp;
                            !item.classList.contains('noclick')) {
                            _status.clicked = false;
                            ui.click[itemtype].call(item);
                            if (item.classList.contains('selected')) {
                                _status.mousedragging = e;
                                _status.mousedragorigin = item;
                                _status.mouseleft = false;
                                _status.selectionfull = false;
                                _status.multitarget = false;
                                _status.lastmouseutc = get.utc();
                                ui.arena.classList.add('dragging');
                            }
                        }
                        return;
                    }
                    item = item.parentNode;
                }
            },
            cardtouchstart: function (e) {
                if (e.touches.length != 1) return;
                if (!lib.config.enable_drag) return;
                if (!this.parentNode) return;
                if (!this.parentNode.parentNode) return;
                if (this.parentNode.parentNode.parentNode != ui.me) return;
                if (this.parentNode.parentNode.classList.contains('scrollh')) return;
                if (this.classList.contains('selectable') &amp;&amp;
                    !this.classList.contains('selected') &amp;&amp;
                    !this.classList.contains('noclick')) {
                    this._waitingfordrag = {
                        clientX: e.touches[0].clientX,
                        clientY: e.touches[0].clientY
                    };
                }
            },
            cardtouchmove: function (e) {
                ui.click.longpresscancel.call(this);
                if (this._waitingfordrag) {
                    var drag = this._waitingfordrag;
                    _status.clicked = false;
                    _status.touchnocheck = true;
                    ui.click.card.call(this);
                    _status.touchnocheck = false;
                    if (this.classList.contains('selected')) {
                        _status.mousedragging = drag;
                        _status.mousedragorigin = this;
                        _status.mouseleft = false;
                        _status.selectionfull = false;
                        _status.multitarget = false;
                    }
                    delete this._waitingfordrag;
                }
            },
            windowmouseup: function (e) {
                delete _status.force;
                // if(_status.forcetouchinterval){
                //     clearInterval(_status.forcetouchinterval);
                //     delete _status.forcetouchinterval;
                // }
                if (window.inSplash) return;
                if (_status.draggingdialog) {
                    var ddialog = _status.draggingdialog;
                    var translate;
                    if (ddialog._dragorigin &amp;&amp; ddialog._dragtransform) {
                        translate = ddialog._dragtransform;
                        translate[0] += e.clientX / game.documentZoom - ddialog._dragorigin.clientX / game.documentZoom;
                        translate[1] += e.clientY / game.documentZoom - ddialog._dragorigin.clientY / game.documentZoom;
                        ui.click.checkdialogtranslate(null, ddialog);
                        delete ddialog._dragorigin;
                    }
                    game.saveConfig('dialog_transform', translate);
                    delete _status.draggingdialog;
                }
                if (_status.draggingroundmenu) {
                    var translate;
                    if (ui.roundmenu._dragorigin &amp;&amp; ui.roundmenu._dragtransform) {
                        var dx = e.clientX / game.documentZoom - ui.roundmenu._dragorigin.clientX / game.documentZoom;
                        var dy = e.clientY / game.documentZoom - ui.roundmenu._dragorigin.clientY / game.documentZoom;
                        if (dx * dx + dy * dy &lt; 25) {
                            ui.click.roundmenu();
                        }
                        translate = ui.roundmenu._dragtransform;
                        translate[0] += dx;
                        translate[1] += dy;
                        ui.click.checkroundtranslate();
                        delete ui.roundmenu._dragorigin;
                    }
                    game.saveConfig('roundmenu_transform', translate);
                    delete _status.draggingroundmenu;
                }
                if (e.button == 2) {
                    if (_status.mousedragging) {
                        _status.mousedragging = null;
                        _status.mouseleft = false;
                        _status.mousedragorigin = null;
                        _status.dragstatuschanged = false;
                        game.uncheck();
                        game.check();
                        _status.noright = true;
                    }
                }
                else {
                    var tmpflag = false;
                    _status.mousedown = false;
                    for (var i = 0; i &lt; ui.selected.cards.length; i++) {
                        ui.selected.cards[i].updateTransform(true);
                    }
                    if (_status.mousedragging &amp;&amp; _status.mouseleft) {
                        if (game.check()) {
                            if (ui.confirm) {
                                ui.confirm.close();
                            }
                            ui.click.ok();
                        }
                        else {
                            game.uncheck();
                            game.check();
                        }
                    }
                    else if (_status.mousedragging &amp;&amp; _status.mousedragorigin) {
                        tmpflag = _status.mousedragorigin;
                    }
                    _status.lastdragchange.length = 0;
                    _status.mousedragging = null;
                    _status.mouseleft = false;
                    _status.mousedragorigin = null;
                    _status.dragstatuschanged = false;
                    if (ui.arena) {
                        ui.canvas.width = ui.arena.offsetWidth;
                        ui.canvas.height = ui.arena.offsetHeight;
                    }
                    if (tmpflag) {
                        ui.click[get.itemtype(tmpflag)].call(tmpflag);
                        game.check();
                    }
                    // ui.updatehl();
                }
                if (ui.arena) {
                    ui.arena.classList.remove('dragging');
                }
            },
            mousemove: function () {
                if (!lib.config.hover_handcard &amp;&amp; this.parentNode &amp;&amp; this.parentNode.parentNode == ui.me) {
                    return;
                }
                if (!_status.currentmouseenter) {
                    _status.currentmouseenter = this;
                }
            },
            mouseenter: function () {
                if (!lib.config.hover_handcard &amp;&amp; this.parentNode &amp;&amp; this.parentNode.parentNode == ui.me) {
                    return;
                }
                _status.currentmouseenter = this;
            },
            mouseleave: function () {
                ui.click.mouseentercancel();
                if (_status.currentmouseenter == this) {
                    _status.currentmouseenter = null;
                }
                this._mouseentercreated = false;
            },
            mousedown: function () {
                ui.click.mouseentercancel();
                if (_status.currentmouseenter == this) {
                    _status.currentmouseenter = null;
                }
                this._mouseentercreated = true;
            },
            mouseentercancel: function () {
                if (_status._mouseentertimeout) {
                    clearTimeout(_status._mouseentertimeout);
                    delete _status._mouseentertimeout
                }
            },
            hoverplayer: function (e) {
                var node = get.nodeintro(this, true);
                if (node) node.style.zIndex = 21;
                return node;
            },
            longpressdown: function (e) {
                if (_status.longpressed) return;
                if (this._longpresstimeout) {
                    clearTimeout(this._longpresstimeout);
                }
                if (lib.config.longpress_info) {
                    this._longpresstimeout = setTimeout(ui.click.longpresscallback, 500);
                }
                this._longpressevent = e;
                if (_status.longpressing &amp;&amp; _status.longpressing != this) {
                    ui.click.longpresscancel.call(_status.longpressing);
                }
                // if(window.ForceTouch&amp;&amp;!_status.forcetouchinterval&amp;&amp;lib.config.enable_pressure){
                //     _status.forcetouchinterval=setInterval(ui.click.forcetouch,30);
                // }
                _status.longpressing = this;
            },
            longpresscallback: function () {
                if (!_status.longpressing) return;
                var node = _status.longpressing;
                var func = node._longpresscallback;
                var e = node._longpressevent;
                if (!func || !e) return;
                clearTimeout(node._longpresstimeout);
                _status.force = true;
                delete _status.longpressing;
                delete node._longpresstimeout;
                delete node._longpressevent;
                if (_status.mousedragging &amp;&amp; _status.mouseleft) return;
                if (!_status.longpressed) {
                    _status.longpressed = true;
                    setTimeout(function () {
                        _status.longpressed = false;
                    }, 500);
                    func.call(node, e);
                    if (lib.config.touchscreen &amp;&amp; lib.config.enable_drag &amp;&amp; !node._waitingfordrag) {
                        _status.mousedragging = null;
                        _status.mousedragorigin = null;
                        _status.clicked = false;
                        game.uncheck();
                        game.check();
                        _status.clicked = true;
                    }
                    delete node._waitingfordrag;
                    ui.click.touchpop();
                }
            },
            longpresscancel: function () {
                if (this._longpresstimeout) {
                    clearTimeout(this._longpresstimeout);
                    delete this._longpresstimeout;
                }
                delete this._longpressevent;
                if (_status.longpressing == this) {
                    delete _status.longpressing;
                }
            },
            window: function () {
                var clicked = _status.clicked;
                var dialogtouched = false;
                if (_status.dialogtouched) {
                    _status.dialogtouched = false;
                    dialogtouched = true;
                }
                if (_status.dragged) return;
                if (_status.touchpopping) return;
                if (_status.reloading) return;
                if (_status.clicked || _status.clicked2) {
                    _status.clicked = false;
                    _status.clicked2 = false;
                }
                else {
                    if (_status.clickingidentity) {
                        for (var i = 0; i &lt; _status.clickingidentity[1].length; i++) {
                            _status.clickingidentity[1][i].delete();
                            _status.clickingidentity[1][i].style.transform = '';
                        }
                        delete _status.clickingidentity;
                    }
                    if (!_status.event.isMine) return;
                    if (ui.controls.length) {
                        ui.updatec();
                    }
                    if (_status.editing) {
                        if (_status.editing.innerHTML.length) {
                            _status.editing.link = _status.editing.innerHTML;
                        }
                        _status.editing.innerHTML = get.translation(_status.editing.link);
                        delete _status.editing;
                    }
                    else if (_status.choosing) {
                        if (!_status.choosing.expand) {
                            _status.choosing.parentNode.style.height = '';
                            _status.choosing.nextSibling.delete();
                            _status.choosing.previousSibling.show();
                            delete _status.choosing;
                        }
                    }
                    else if (ui.intro) {
                        ui.intro.close();
                        delete ui.intro;
                        ui.control.show();
                        game.resume2();
                    }
                    else if ((_status.event.isMine() || _status.event.forceMine) &amp;&amp; !dialogtouched) {
                        if (_status.event.custom.replace.window) {
                            _status.event.custom.replace.window();
                        }
                        else {
                            if (_status.event.skill &amp;&amp; _status.event.name == 'chooseToUse') {
                                ui.click.cancel();
                            }
                            else {
                                game.uncheck();
                                game.check();
                            }
                        }
                    }
                    if (!ui.shortcut.classList.contains('hidden')) {
                        ui.click.shortcut(false);
                    }
                    if (get.is.phoneLayout() &amp;&amp; ui.menuContainer &amp;&amp; ui.menuContainer.classList.contains('hidden')) {
                        if (ui.system2.classList.contains('shown')) {
                            _status.removinground = true;
                            setTimeout(function () {
                                _status.removinground = false;
                            }, 200);
                        }
                        ui.arena.classList.remove('phonetop');
                        ui.system1.classList.remove('shown');
                        ui.system2.classList.remove('shown');
                        // if(ui.chessinfo){
                        //     ui.chessinfo.classList.remove('zoomed');
                        // }
                    }
                }
                if (_status.tempunpop) {
                    _status.tempunpop = false;
                }
                else {
                    game.closePopped();
                }
                if (_status.event.custom &amp;&amp; _status.event.custom.add.window) {
                    _status.event.custom.add.window(clicked);
                }
            },
            toggle: function () {
                if (_status.dragged) return;
                if (this.parentNode.classList.contains('disabled')) return;
                _status.tempunpop = true;
                if (this.link) {
                    this.link = false;
                    this.classList.remove('on');
                    if (this.additionalCommand) this.additionalCommand(false, this.parentNode);
                }
                else {
                    this.link = true;
                    this.classList.add('on');
                    if (this.additionalCommand) this.additionalCommand(true, this.parentNode);
                }
            },
            editor: function () {
                if (_status.dragged) return;
                if (_status.editing) return;
                _status.clicked = true;
                this.innerHTML = '';
                _status.editing = this;
                if (this.additionalCommand) this.additionalCommand(this);
            },
            switcher: function () {
                if (_status.dragged) return;
                if (this.parentNode.classList.contains('disabled')) return;
                if (_status.choosing) return;
                _status.clicked = true;
                _status.tempunpop = true;
                this.previousSibling.hide();
                var node = ui.create.div('.switcher', this.parentNode).animate('start');
                for (var i = 0; i &lt; this.choice.length; i++) {
                    var choice = ui.create.div('.pointerdiv', node);
                    choice.innerHTML = get.translation(this.choice[i]);
                    choice.link = this.choice[i];
                    choice.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.choice);
                }
                // this.parentNode.style.height=(node.offsetHeight)+'px';
                _status.choosing = this;
                if (!_status.choosing.expand) {
                    _status.choosing.expand = true;
                    setTimeout(function () {
                        _status.choosing.expand = false;
                    }, 500);
                }
            },
            choice: function () {
                if (_status.dragged) return;
                if (!_status.choosing) return;
                _status.choosing.link = this.link;
                _status.choosing.innerHTML = get.translation(this.link);
                this.parentNode.parentNode.style.height = '';
                this.parentNode.delete();
                _status.choosing.previousSibling.show();
                delete _status.choosing;
                if (this.parentNode.parentNode.querySelector('.toggle').additionalCommand) {
                    this.parentNode.parentNode.querySelector('.toggle').additionalCommand(this.link, this.parentNode.parentNode);
                }
            },
            button: function () {
                if (_status.dragged) return;
                if (_status.clicked) return;
                if (_status.tempNoButton) return;
                if (_status.draggingtouchdialog) return;
                if (this.classList.contains('noclick')) return;
                if (_status.justdragged) return;
                _status.clicked = true;
                var custom = _status.event.custom;
                if (custom.replace.button) {
                    custom.replace.button(this);
                    return;
                }
                if (!_status.event.isMine()) return;
                if (this.classList.contains('selectable') == false) return;
                if (this.classList.contains('selected')) {
                    ui.selected.buttons.remove(this);
                    this.classList.remove('selected');
                    if (_status.multitarget || _status.event.complexSelect) {
                        game.uncheck();
                        game.check();
                    }
                }
                else {
                    this.classList.add('selected');
                    ui.selected.buttons.add(this);
                }
                if (custom.add.button) {
                    custom.add.button();
                }
                game.check();
            },
            touchintro: function () {
                var rect = this.getBoundingClientRect();
                ui.click.touchpop();
                ui.click.intro.call(this, {
                    clientX: rect.left + 18,
                    clientY: rect.top + 12
                });
                _status.clicked = false;
            },
            /**
             * 
             * @callback
             */
            card: function () {
                delete this._waitingfordrag;
                if (_status.dragged) return;
                if (_status.clicked) return;
                if (ui.intro) return;
                _status.clicked = true;
                if (this.parentNode &amp;&amp; (this.parentNode.classList.contains('judges') || this.parentNode.classList.contains('marks'))) {
                    var rect = this.getBoundingClientRect();
                    ui.click.touchpop();
                    ui.click.intro.call(this, {
                        clientX: rect.left + 18,
                        clientY: rect.top + 12
                    });
                    _status.clicked = false;
                    return;
                }
                var custom = _status.event.custom;
                if (custom.replace.card) {
                    custom.replace.card(this);
                    return;
                }
                if (this.classList.contains('selectable') == false) return;
                if (this.classList.contains('selected')) {
                    ui.selected.cards.remove(this);
                    if (_status.multitarget || _status.event.complexSelect) {
                        game.uncheck();
                        game.check();
                    }
                    else {
                        this.classList.remove('selected');
                        this.updateTransform();
                    }
                }
                else {
                    ui.selected.cards.add(this);
                    this.classList.add('selected');
                    this.updateTransform(true);
                }
                if (game.chess &amp;&amp; get.config('show_range') &amp;&amp; !_status.event.skill &amp;&amp; this.classList.contains('selected') &amp;&amp;
                    _status.event.isMine() &amp;&amp; _status.event.name == 'chooseToUse') {
                    var player = _status.event.player;
                    var range = get.info(this).range;
                    if (range) {
                        if (typeof range.attack === 'number') {
                            player.createRangeShadow(Math.min(8, player.getAttackRange(true) + range.attack - 1));
                        }
                        else if (typeof range.global === 'number') {
                            player.createRangeShadow(Math.min(8, player.getGlobalFrom() + range.global));
                        }
                    }
                }
                if (custom.add.card) {
                    custom.add.card();
                }
                game.check();

                if (lib.config.popequip &amp;&amp; get.is.phoneLayout() &amp;&amp;
                    arguments[0] != 'popequip' &amp;&amp; ui.arena &amp;&amp; ui.arena.classList.contains('selecting') &amp;&amp;
                    this.parentNode &amp;&amp; this.parentNode.classList.contains('popequip')) {
                    var rect = this.getBoundingClientRect();
                    ui.click.touchpop();
                    ui.click.intro.call(this.parentNode, {
                        clientX: rect.left + 18,
                        clientY: rect.top + 12
                    });
                }
            },
            avatar: function () {
                if (!lib.config.doubleclick_intro) return;
                if (this.parentNode.isUnseen(0)) return;
                if (!lib.character[this.parentNode.name]) return;
                if (!ui.menuContainer) return;
                var avatar = this;
                var player = this.parentNode;
                if (!game.players.contains(player) &amp;&amp; !game.dead.contains(player)) return;
                if (!this._doubleClicking) {
                    this._doubleClicking = true;
                    setTimeout(function () {
                        avatar._doubleClicking = false;
                    }, 500);
                    return;
                }
                // ui.click.skin(this,player.name);
                game.pause2();
                ui.click.charactercard(player.name, null, null, true, this);
            },
            avatar2: function () {
                if (!lib.config.doubleclick_intro) return;
                if (this.parentNode.classList.contains('unseen2')) return;
                if (!lib.character[this.parentNode.name2]) return;
                if (!ui.menuContainer) return;
                var avatar = this;
                var player = this.parentNode;
                if (!game.players.contains(player) &amp;&amp; !game.dead.contains(player)) return;
                if (!this._doubleClicking) {
                    this._doubleClicking = true;
                    setTimeout(function () {
                        avatar._doubleClicking = false;
                    }, 500);
                    return;
                }
                // ui.click.skin(this,player.name2);
                game.pause2();
                ui.click.charactercard(player.name2, null, null, true, this);
            },
            connectroom: function (e) {
                if (_status.dragged) return;
                if (_status.clicked) return;
                if (ui.intro) return;
                if (this.roomfull) {
                    alert('');
                }
                else if (this.roomgaming &amp;&amp; !game.onlineID) {
                    if (this.config &amp;&amp; this.config.observe) {
                        alert('');
                    }
                    else {
                        alert('');
                    }
                }
                else if (!this.roomempty &amp;&amp; this.version != lib.versionOL) {
                    if (this.version > lib.versionOL) {
                        alert('');
                    }
                    else {
                        alert('');
                    }
                }
                else {
                    if (!_status.enteringroom) {
                        _status.enteringroom = true;
                        _status.enteringroomserver = this.serving;
                        game.send('server', 'enter', this.key, get.connectNickname(), lib.config.connect_avatar);
                    }
                }
            },
            player: function () {
                return ui.click.target.apply(this, arguments);
            },
            target: function (e) {
                if (_status.dragged) return;
                if (_status.clicked) return;
                if (ui.intro) return;
                if (this.classList.contains('connect')) {
                    if (game.online) {
                        if (game.onlinezhu) {
                            if (!this.playerid &amp;&amp; game.connectPlayers) {
                                if (['versus','doudizhu','longlaoguan'].contains(lib.configOL.mode)) return;
                                if (lib.configOL.mode == 'identity' &amp;&amp; lib.configOL.identity_mode == 'zhong') return;
                                if (!this.classList.contains('unselectable2') &amp;&amp; lib.configOL.number &lt;= 2) return;
                                this.classList.toggle('unselectable2')
                                if (this.classList.contains('unselectable2')) {
                                    lib.configOL.number--;
                                }
                                else {
                                    lib.configOL.number++;
                                }
                                game.send('changeNumConfig', lib.configOL.number,
                                    game.connectPlayers.indexOf(this), this.classList.contains('unselectable2'));
                            }
                        }
                        return;
                    }
                    if (this.playerid) {
                        if (this.ws) {
                            if (confirm('' + this.nickname + '')) {
                                var id = get.id();
                                this.ws.send(function (id) {
                                    if (game.ws) {
                                        game.ws.close();
                                        game.saveConfig('reconnect_info');
                                        game.saveConfig('banned_info', id);
                                    }
                                }, id);
                                lib.node.banned.push(id);
                            }
                        }
                    }
                    else {
                        if (['versus','doudizhu','longlaoguan','single'].contains(lib.configOL.mode)) return;
                        if (lib.configOL.mode == 'identity' &amp;&amp; (lib.configOL.identity_mode == 'zhong' || lib.configOL.identity_mode == 'purple')) return;
                        if (!this.classList.contains('unselectable2') &amp;&amp; lib.configOL.number &lt;= 2) return;
                        this.classList.toggle('unselectable2')
                        if (this.classList.contains('unselectable2')) {
                            lib.configOL.number--;
                        }
                        else {
                            lib.configOL.number++;
                        }
                        game.send('server', 'config', lib.configOL);
                        game.updateWaiting();
                    }
                    return;
                }
                _status.clicked = true;
                var custom = _status.event.custom;
                if (custom.replace.target) {
                    custom.replace.target(this, e);
                    return;
                }
                if (this.classList.contains('selectable') == false) return;
                this.unprompt();
                if (this.classList.contains('selected')) {
                    ui.selected.targets.remove(this);
                    if (_status.multitarget || _status.event.complexSelect) {
                        game.uncheck();
                        game.check();
                    }
                    else {
                        this.classList.remove('selected');
                    }
                }
                else {
                    ui.selected.targets.add(this);
                    if (_status.event.name == 'chooseTarget' || _status.event.name == 'chooseToUse' || _status.event.name == 'chooseCardTarget') {
                        var targetprompt = null;
                        if (_status.event.targetprompt) {
                            targetprompt = _status.event.targetprompt;
                        }
                        else if (_status.event.skill &amp;&amp; !get.info(_status.event.skill).viewAs) {
                            targetprompt = get.info(_status.event.skill).targetprompt;
                        }
                        else if (_status.event.name == 'chooseToUse') {
                            var currentcard = get.card();
                            if (currentcard) {
                                targetprompt = get.info(currentcard).targetprompt;
                            }
                        }
                        if (targetprompt) {
                            if (Array.isArray(targetprompt)) {
                                targetprompt = targetprompt[Math.min(targetprompt.length - 1, ui.selected.targets.indexOf(this))];
                            }
                            else if (typeof targetprompt == 'function') {
                                targetprompt = targetprompt(this);
                            }
                            if (targetprompt &amp;&amp; typeof targetprompt == 'string') {
                                this.prompt(targetprompt);
                            }
                        }
                    }
                    this.classList.add('selected');
                }
                if (custom.add.target) {
                    custom.add.target();
                }
                game.check();
            },
            control2: function () {
                if (this.childNodes.length == 1 &amp;&amp; !this._doubleclick) {
                    ui.click.control.call(this.firstChild);
                }
            },
            control: function () {
                if (_status.dragged) return;
                if (ui.control.classList.contains('hidden')) return;
                var node = this.parentNode;
                if (node) {
                    if (node._doubleclick) {
                        return;
                    }
                    else {
                        node._doubleclick = true;
                        setTimeout(function () {
                            node._doubleclick = false;
                        }, 500);
                    }
                    if (node.classList.contains('hidden')) return;
                    if (node.classList.contains('removing')) return;
                    if (node.classList.contains('disabled')) return;
                }
                if (ui.intro) {
                    ui.intro.close();
                    delete ui.intro;
                }
                _status.clicked = true;
                if (this.parentNode.custom) {
                    this.parentNode.custom(this.link, this);
                    return;
                }
                if (this.link == 'ok') {
                    ui.click.ok(this);
                }
                else if (this.link == 'cancel') {
                    ui.click.cancel(this);
                }
                else {
                    _status.event.result = {
                        buttons: ui.selected.buttons.slice(0),
                        cards: ui.selected.cards.slice(0),
                        targets: ui.selected.targets.slice(0),
                        control: this.link,
                        links: get.links(ui.selected.buttons)
                    };
                    if (this.parentNode.close != false) {
                        game.uncheck();
                        this.parentNode.close();
                    }
                    game.resume();
                }
            },
            dialogcontrol: function () {
                _status.event.result = {
                    buttons: ui.selected.buttons.slice(0),
                    cards: ui.selected.cards.slice(0),
                    targets: ui.selected.targets.slice(0),
                    control: this.link,
                    links: get.links(ui.selected.buttons)
                };
                game.resume();
            },
            skill: function (skill) {
                var info = get.info(skill);
                var event = _status.event;
                event.backup(skill);
                if (info.filterCard &amp;&amp; info.discard != false &amp;&amp; info.lose != false &amp;&amp; !info.viewAs) {
                    var cards = event.player.getCards(event.position);
                    for (var i = 0; i &lt; cards.length; i++) {
                        if (!lib.filter.cardDiscardable(cards[i], event.player)) {
                            cards[i].uncheck('useSkill');
                        }
                    }
                }
                if (typeof event.skillDialog == 'object') {
                    event.skillDialog.close();
                }
                if (event.isMine()) {
                    event.skillDialog = true;
                }
                game.uncheck();
                game.check();
                if (event.skillDialog) {
                    var str = get.translation(skill);
                    if (info.prompt) {
                        var str2;
                        if (typeof info.prompt == 'function') {
                            str2 = info.prompt(event);
                        }
                        else {
                            str2 = info.prompt;
                        }
                        event.skillDialog = ui.create.dialog(str, '&lt;div>&lt;div style="width:100%;text-align:center">' + str2 + '&lt;/div>&lt;/div>');
                        if (info.longprompt) {
                            event.skillDialog.forcebutton = true;
                            ui.update();
                        }
                    }
                    else if (info.promptfunc) {
                        event.skillDialog = ui.create.dialog(str, '&lt;div>&lt;div style="width:100%">' + info.promptfunc(event, event.player) + '&lt;/div>&lt;/div>');
                    }
                    else if (lib.dynamicTranslate[skill] || lib.translate[skill + '_info']) {
                        event.skillDialog = ui.create.dialog(str, '&lt;div>&lt;div style="width:100%">' + get.skillInfoTranslation(skill, _status.event.player) + '&lt;/div>&lt;/div>');
                    }
                }
            },
            /**
             * /ai
             * @function
             * @param {?HTMLDivElement} node null`node``close()`
             */
            ok: function (node) {
                var event = _status.event;
                if (event.custom.replace.confirm) {
                    event.custom.replace.confirm(true); return;
                }
                event.result = {
                    buttons: ui.selected.buttons.slice(0),//
                    cards: ui.selected.cards.slice(0),//
                    targets: ui.selected.targets.slice(0),//
                    confirm: 'ok',//
                    bool: true,
                    links: get.links(ui.selected.buttons)
                };
                if (node) {
                    node.parentNode.close();
                }
                if (event.skill) {
                    event.result.skill = event.skill;
                    if (typeof get.info(event.skill).viewAs == 'function') event.result.card = get.info(event.skill).viewAs(event.result.cards, event.player);
                    else event.result.card = get.copy(get.info(event.skill).viewAs);
                    if (event.result.cards.length == 1 &amp;&amp; event.result.card) {
                        event.result.card.suit = get.suit(event.result.cards[0]);
                        event.result.card.number = get.number(event.result.cards[0]);
                    }
                    if (event.skillDialog &amp;&amp; get.objtype(event.skillDialog) == 'div') {
                        event.skillDialog.close();
                    }
                    var cards = event.player.getCards('hej');
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].recheck('useSkill');
                    }
                    event.restore();
                }
                else if (event.name == 'chooseToUse' || event.name == 'chooseToRespond') {
                    event.result.card = get.autoViewAs(event.result.cards[0]);
                }
                if (ui.skills) ui.skills.close();
                if (ui.skills2) ui.skills2.close();
                if (ui.skills3) ui.skills3.close();
                game.uncheck();
                if (event.custom.add.confirm) {
                    event.custom.add.confirm(true);
                }
                game.resume();
            },
            /**
             * 
             * @function
             * @param {?HTMLDivElement} node null`node``close()`
             */
            cancel: function (node) {
                var event = _status.event;
                if (event.custom.replace.confirm) {
                    event.custom.replace.confirm(false); return;
                }
                if (event.skill &amp;&amp; !event.norestore) {
                    if (event.skillDialog &amp;&amp; get.objtype(event.skillDialog) == 'div') {
                        event.skillDialog.close();
                    }
                    if (typeof event.dialog == 'string' &amp;&amp; event.isMine()) {
                        event.dialog = ui.create.dialog(event.dialog);
                    }
                    if (_status.event.type == 'phase' &amp;&amp; ui.confirm) {
                        ui.confirm.classList.add('removing');
                    }
                    // ui.control.animate('nozoom',100);
                    event.restore();
                    var cards = event.player.getCards('hej');
                    for (var i = 0; i &lt; cards.length; i++) {
                        cards[i].recheck('useSkill');
                    }
                    game.uncheck();
                    game.check();
                    return;
                }
                event.result = {
                    confirm: 'cancel',
                    bool: false
                };
                if (node) {
                    node.parentNode.close();
                }
                if (ui.skills) ui.skills.close();
                if (ui.skills2) ui.skills2.close();
                if (ui.skills3) ui.skills3.close();
                game.uncheck();
                if (event.custom.add.confirm) {
                    event.custom.add.confirm(true);
                }
                game.resume();
            },
            logv: function (e) {
                if (_status.currentlogv) {
                    if (_status.currentlogv == this) return;
                    if (_status.logvtimeout) {
                        clearTimeout(_status.logvtimeout);
                    }
                    var that = this;
                    _status.logvtimeout = setTimeout(function () {
                        if (!_status.currentlogv) {
                            _status.currentlogv = that;
                            ui.click.intro.call(that, e);
                        }
                    }, 200);
                    this.logvtimeout = _status.logvtimeout;
                }
                else {
                    _status.currentlogv = this;
                    ui.click.intro.call(this, e);
                }
            },
            logvleave: function () {
                if (_status.currentlogv == this) {
                    setTimeout(function () {
                        delete _status.currentlogv;
                    }, 150);
                }
                if (this.logvtimeout) {
                    clearTimeout(this.logvtimeout);
                    if (_status.logvtimeout == this.logvtimeout) {
                        delete _status.logvtimeout;
                    }
                    delete this.logvtimeout;
                }
            },
            charactercard: function (name, sourcenode, noedit, resume, avatar) {
                if (_status.dragged) return;
                if (lib.config.theme != 'simple') {
                    ui.window.classList.add('shortcutpaused');
                    ui.menuContainer.classList.add('forceopaque');
                }
                else {
                    ui.window.classList.add('systempaused');
                    ui.menuContainer.classList.add('transparent2');
                }
                if (lib.config.blur_ui) {
                    ui.arena.classList.add('blur');
                    ui.system.classList.add('blur');
                    ui.menuContainer.classList.add('blur');
                }
                var layer = ui.create.div('.popup-container');
                var clicklayer = function (e) {
                    if (_status.touchpopping) return;
                    if (_status.dragged) return;
                    ui.window.classList.remove('shortcutpaused');
                    ui.window.classList.remove('systempaused');
                    ui.menuContainer.classList.remove('forceopaque');
                    ui.menuContainer.classList.remove('transparent2');
                    ui.arena.classList.remove('blur');
                    ui.system.classList.remove('blur');
                    ui.menuContainer.classList.remove('blur');
                    this.delete();
                    e.stopPropagation();
                    if (resume) game.resume2();
                    return false;
                }
                var uiintro = ui.create.div('.menubg.charactercard', layer);
                var playerbg = ui.create.div('.menubutton.large.ava', uiintro);
                var bg = ui.create.div('.avatar', playerbg, function () {
                    if (changeskinfunc) {
                        changeskinfunc();
                    }
                }).setBackground(name, 'character');
                var changeskinfunc = null;
                var nameskin = name;
                var nameskin2 = name;
                var gzbool = false;
                if (nameskin.indexOf('gz_shibing') == 0) {
                    nameskin = nameskin.slice(3, 11);
                }
                else if (nameskin.indexOf('gz_') == 0) {
                    nameskin = nameskin.slice(3);
                    gzbool = true;
                }
                var changeskin = function () {
                    var node = ui.create.div('.changeskin', '', playerbg);
                    var avatars = ui.create.div('.avatars', playerbg);
                    changeskinfunc = function () {
                        playerbg.classList.add('scroll');
                        if (node._created) {
                            return;
                        }
                        node._created = true;
                        var createButtons = function (num) {
                            if (!num) return;
                            if (num >= 4) {
                                avatars.classList.add('scroll');
                                if (lib.config.touchscreen) {
                                    lib.setScroll(avatars);
                                }
                            }
                            for (var i = 0; i &lt;= num; i++) {
                                var button = ui.create.div(avatars, function () {
                                    playerbg.classList.remove('scroll');
                                    if (this._link) {
                                        lib.config.skin[nameskin] = this._link;
                                        bg.style.backgroundImage = this.style.backgroundImage;
                                        if (sourcenode) sourcenode.style.backgroundImage = this.style.backgroundImage;
                                        if (avatar) avatar.style.backgroundImage = this.style.backgroundImage;
                                        game.saveConfig('skin', lib.config.skin);
                                    }
                                    else {
                                        delete lib.config.skin[nameskin];
                                        if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) {
                                            bg.setBackground(nameskin2, 'character');
                                            if (sourcenode) sourcenode.setBackground(nameskin2, 'character');
                                            if (avatar) avatar.setBackground(nameskin2, 'character');
                                        }
                                        else {
                                            bg.setBackground(nameskin, 'character');
                                            if (sourcenode) sourcenode.setBackground(nameskin, 'character');
                                            if (avatar) avatar.setBackground(nameskin, 'character');
                                        }
                                        game.saveConfig('skin', lib.config.skin);
                                    }
                                });
                                button._link = i;
                                if (i) {
                                    button.setBackgroundImage('image/skin/' + nameskin + '/' + i + '.jpg');
                                }
                                else {
                                    if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) button.setBackground(nameskin2, 'character', 'noskin');
                                    else button.setBackground(nameskin, 'character', 'noskin');
                                }
                            }
                        };
                        var num = 1;
                        var loadImage = function () {
                            var img = new Image();
                            img.onload = function () {
                                num++;
                                loadImage();
                            }
                            img.onerror = function () {
                                num--;
                                createButtons(num);
                            }
                            img.src = lib.assetURL + 'image/skin/' + nameskin + '/' + num + '.jpg';
                        }
                        if (lib.config.change_skin) {
                            loadImage();
                        }
                        else {
                            createButtons(lib.skin[nameskin]);
                        }
                    };
                };
                if (lib.config.change_skin) {
                    var img = new Image();
                    img.onload = changeskin;
                    img.src = lib.assetURL + 'image/skin/' + nameskin + '/1.jpg';
                }
                else if (lib.config.debug &amp;&amp; lib.skin[nameskin]) {
                    changeskin();
                }
                var ban = ui.create.div('.menubutton.large.ban.character', uiintro, '', function (e) {
                    if (this.classList.contains('unselectable')) return;
                    if (typeof noedit == 'string') {
                        this.classList.toggle('active');
                        var bannedname = noedit + '_banned';
                        if (!lib.config[bannedname]) {
                            lib.config[bannedname] = [];
                        }
                        if (this.classList.contains('active')) {
                            lib.config[bannedname].add(name);
                        }
                        else {
                            lib.config[bannedname].remove(name);
                        }
                        game.saveConfig(bannedname, lib.config[bannedname]);
                        ban.updateBanned();
                    }
                    else {
                        ui.click.touchpop();
                        ui.click.intro.call(this, e);
                        _status.clicked = true;
                    }
                });
                ban.link = name;
                ban._banning = 'offline';
                ban.updateBanned = function () {
                    if (noedit === true) return;
                    if (lib.config[get.mode() + '_banned'] &amp;&amp; lib.config[get.mode() + '_banned'].contains(name)) {
                        ban.classList.add('active');
                    }
                    else {
                        ban.classList.remove('active');
                    }
                    if (sourcenode &amp;&amp; sourcenode.updateBanned) {
                        sourcenode.updateBanned();
                    }
                };
                ban.updateBanned();
                var fav = ui.create.div('.menubutton.large.fav', uiintro, '', function () {
                    if (this.classList.contains('unselectable')) return;
                    this.classList.toggle('active');
                    if (this.classList.contains('active')) {
                        lib.config.favouriteCharacter.add(name);
                    }
                    else {
                        lib.config.favouriteCharacter.remove(name);
                    }
                    game.saveConfig('favouriteCharacter', lib.config.favouriteCharacter);
                });
                if (noedit === true) {
                    fav.classList.add('unselectable');
                    ban.classList.add('unselectable');
                }
                else if (lib.config.favouriteCharacter.contains(name)) {
                    fav.classList.add('active');
                }
                var intro = ui.create.div('.charactercontainer', uiintro);
                if(get.characterIntro(name).length){
                    var intro0 = ui.create.div('.characterintro', get.characterIntro(name), intro);
                }
                if(get.characterTag(name).length){
                    var intro1 = ui.create.div('.characterintro.intro1', get.characterTag(name), intro);
                }
                var intro2 = ui.create.div('.characterintro.intro2', intro);
                var list = get.character(name, 3) || [];
                var skills = ui.create.div('.characterskill', intro);
                if (lib.config.touchscreen) {
                    lib.setScroll(intro);
                    lib.setScroll(intro2);
                    lib.setScroll(skills);
                }

                if (lib.config.mousewheel) {
                    skills.onmousewheel = ui.click.mousewheel;
                }
                var clickSkill = function (e) {
                    var current = this.parentNode.querySelector('.active');
                    if (current) {
                        current.classList.remove('active');
                    }
                    this.classList.add('active');
                    intro2.innerHTML = '&lt;span style="font-weight:bold;margin-right:5px">' + get.translation(this.link) + '&lt;/span>' + get.skillInfoTranslation(this.link);
                    var info = get.info(this.link);
                    var skill = this.link;
                    var playername = this.linkname;
                    var skillnode = this;
                    if (info.derivation) {
                        var derivation = info.derivation;
                        if (typeof derivation == 'string') {
                            derivation = [derivation];
                        }
                        for (var i = 0; i &lt; derivation.length; i++) {
                            intro2.innerHTML += '&lt;br>&lt;br>&lt;span style="font-weight:bold;margin-right:5px">' + get.translation(derivation[i]) + '&lt;/span>' + get.skillInfoTranslation(derivation[i]);
                        }
                    }
                    if (info.alter) {
                        intro2.innerHTML += '&lt;br>&lt;br>&lt;div class="hrefnode skillversion">&lt;/div>';
                        var skillversionnode = intro2.querySelector('.hrefnode.skillversion');
                        if (lib.config.vintageSkills.contains(skill)) {
                            skillversionnode.innerHTML = '';
                        }
                        else {
                            skillversionnode.innerHTML = '';
                        }
                        skillversionnode.listen(function () {
                            if (lib.config.vintageSkills.contains(skill)) {
                                lib.config.vintageSkills.remove(skill);
                                lib.translate[skill + '_info'] = lib.translate[skill + '_info_alter'];
                            }
                            else {
                                lib.config.vintageSkills.push(skill);
                                lib.translate[skill + '_info'] = lib.translate[skill + '_info_origin'];
                            }
                            game.saveConfig('vintageSkills', lib.config.vintageSkills);
                            clickSkill.call(skillnode, 'init');
                        });
                    }
                    if (lib.config.background_speak &amp;&amp; e !== 'init') {
                        var audioname = this.link;
                        if (info.audioname2 &amp;&amp; info.audioname2[playername]) {
                            audioname = info.audioname2[playername];
                            info = lib.skill[audioname];
                        }
                        var audioinfo = info.audio;
                        var that = this;
                        var getIndex = function (i) {
                            if (typeof that.audioindex != 'number') {
                                that.audioindex = i;
                            }
                            that.audioindex++;
                            if (that.audioindex > i) {
                                that.audioindex = 1;
                            }
                            return that.audioindex;
                        };
                        if (typeof audioinfo == 'string') {
                            if (audioinfo.indexOf('ext:') == 0) {
                                audioinfo = audioinfo.split(':');
                                if (audioinfo.length == 3) {
                                    if (audioinfo[2] == 'true') {
                                        game.playAudio('..', 'extension', audioinfo[1], audioname);
                                    }
                                    else {
                                        audioinfo[2] = parseInt(audioinfo[2]);
                                        if (audioinfo[2]) {
                                            game.playAudio('..', 'extension', audioinfo[1], audioname + getIndex(audioinfo[2]));
                                        }
                                    }
                                }
                                return;
                            }
                            else {
                                audioname = audioinfo;
                                if (lib.skill[audioinfo]) {
                                    audioinfo = lib.skill[audioinfo].audio;
                                }
                            }
                        }
                        else if (Array.isArray(audioinfo)) {
                            audioname = audioinfo[0];
                            audioinfo = audioinfo[1];
                        }
                        if (typeof audioinfo == 'number') {
                            if (Array.isArray(info.audioname) &amp;&amp; info.audioname.contains(playername)) audioname = audioname + '_' + playername;
                            game.playAudio('skill', audioname + getIndex(audioinfo));
                        }
                        else if (audioinfo) {
                            if (Array.isArray(info.audioname) &amp;&amp; info.audioname.contains(playername)) audioname = audioname + '_' + playername;
                            game.playAudio('skill', audioname);
                        }
                        else if (true &amp;&amp; info.audio !== false) {
                            if (Array.isArray(info.audioname) &amp;&amp; info.audioname.contains(playername)) audioname = audioname + '_' + playername;
                            game.playSkillAudio(audioname, getIndex(2));
                        }
                    }
                }
                var initskill = false;
                for (var i = 0; i &lt; list.length; i++) {
                    if (!get.info(list[i]) || get.info(list[i]).nopop) continue;
                    if (!lib.translate[list[i]] || !lib.translate[list[i] + '_info']) continue;
                    var skilltrans = get.translation(list[i]);
                    if (skilltrans.indexOf('&amp;nbsp;') == 0) {
                        skilltrans = skilltrans.slice(6);
                    }
                    var current = ui.create.div('.menubutton.large', skills, clickSkill, skilltrans);
                    current.link = list[i];
                    current.linkname = name;
                    if (!initskill) {
                        initskill = true;
                        clickSkill.call(current, 'init');
                    }
                }

                uiintro.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', ui.click.touchpop);
                layer.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clicklayer);
                ui.window.appendChild(layer);
            },
            /**
             * 
             * @function
             * @param {(MouseEvent|TouchEvent)} e 
             * @returns {(undefined|false|HTMLDivElement)}
             */
            intro: function (e) {
                if (_status.dragged) return;
                _status.clicked = true;
                if (this.classList.contains('player') &amp;&amp; !this.name) {
                    return;
                }
                if (this.parentNode == ui.historybar) {
                    if (ui.historybar.style.zIndex == '22') {
                        if (_status.removePop) {
                            if (_status.removePop(this) == false) return;
                        }
                        else {
                            return;
                        }
                    }
                    ui.historybar.style.zIndex = 22;
                }
                var uiintro;
                if (this.classList.contains('card') &amp;&amp; this.parentNode &amp;&amp;
                    this.parentNode.classList.contains('equips') &amp;&amp; get.is.phoneLayout() &amp;&amp;
                    !get.is.mobileMe(this.parentNode.parentNode)) {
                    uiintro = get.nodeintro(this.parentNode.parentNode, false, e);
                }
                uiintro = uiintro || get.nodeintro(this, false, e);
                if (!uiintro) return;
                uiintro.classList.add('popped');
                uiintro.classList.add('static');
                ui.window.appendChild(uiintro);
                var layer = ui.create.div('.poplayer', ui.window);
                var clicklayer = function (e) {
                    if (_status.touchpopping) return;
                    delete ui.throwEmotion;
                    delete _status.removePop;
                    uiintro.delete();
                    this.remove();
                    ui.historybar.style.zIndex = '';
                    delete _status.currentlogv;
                    if (!ui.arena.classList.contains('menupaused') &amp;&amp; !uiintro.noresume) game.resume2();
                    if (e &amp;&amp; e.stopPropagation) e.stopPropagation();
                    if (uiintro._onclose) {
                        uiintro._onclose();
                    }
                    return false;
                }
                layer.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', clicklayer);
                if (!lib.config.touchscreen) layer.oncontextmenu = clicklayer;
                if (this.parentNode == ui.historybar &amp;&amp; lib.config.touchscreen) {
                    var rect = this.getBoundingClientRect();
                    e = { clientX: 0, clientY: rect.top + 30 };
                }
                lib.placePoppedDialog(uiintro, e);
                if (this.parentNode == ui.historybar) {
                    if (lib.config.show_history == 'right') {
                        uiintro.style.left = (ui.historybar.offsetLeft - 230) + 'px';
                    }
                    else {
                        uiintro.style.left = (ui.historybar.offsetLeft + 60) + 'px';
                    }
                }
                uiintro.style.zIndex = 21;
                var clickintro = function () {
                    if (_status.touchpopping) return;
                    delete _status.removePop;
                    layer.remove();
                    this.delete();
                    ui.historybar.style.zIndex = '';
                    delete _status.currentlogv;
                    if (!ui.arena.classList.contains('menupaused') &amp;&amp; !uiintro.noresume) game.resume2();
                    if (uiintro._onclose) {
                        uiintro._onclose();
                    }
                };
                var currentpop = this;
                _status.removePop = function (node) {
                    if (node == currentpop) return false;
                    layer.remove();
                    uiintro.delete();
                    delete _status.removePop;
                    return true;
                };
                if (uiintro.clickintro) {
                    uiintro.listen(function () {
                        _status.clicked = true;
                    });
                    uiintro._clickintro = clicklayer;
                }
                else if (!lib.config.touchscreen) {
                    uiintro.addEventListener('mouseleave', clickintro);
                    uiintro.addEventListener('click', clickintro);
                }
                else if (uiintro.touchclose) {
                    uiintro.listen(clickintro);
                }
                uiintro._close = clicklayer;

                game.pause2();
                return uiintro;
            },
            intro2: function () {
                if (ui.intro) {
                    ui.intro.close();
                    if (ui.intro.source == this) {
                        delete ui.intro;
                        ui.control.show();
                        game.resume2();
                        return;
                    }
                }
            },
            /**
             * 
             * @function
             */
            auto: function () {
                if (ui.auto.classList.contains('hidden') &amp;&amp; arguments[0] !== 'forced') return;
                if (_status.paused2) return;
                ui.click.shortcut(false);
                if (!_status.auto) {
                    _status.auto = true;
                    ui.auto.classList.add('glow');
                    ui.arena.classList.add('auto');

                    if (_status.imchoosing &amp;&amp; _status.paused) {
                        if (ui.confirm) ui.confirm.close();
                        ui.control.hide();
                        if (_status.event.switchToAuto) {
                            _status.event.switchToAuto();
                        }
                        else {
                            if (_status.paused &amp;&amp; _status.imchoosing) {
                                game.uncheck();
                                _status.event.redo();
                            }
                        }
                        game.resume();
                    }
                    else if (_status.event.switchToAuto) {
                        _status.event.switchToAuto();
                    }
                    if (game.online) {
                        game.send('auto');
                    }
                    else if (_status.connectMode) {
                        game.broadcastAll(function (player) {
                            player.setNickname(player.nickname + ' - ');
                        }, game.me);
                    }
                }
                else {
                    if (game.notMe) return;
                    ui.control.show();
                    _status.auto = false;
                    ui.auto.classList.remove('glow');
                    ui.arena.classList.remove('auto');

                    if (game.online) {
                        game.send('unauto');
                    }
                    else if (_status.connectMode) {
                        game.broadcastAll(function (player) {
                            player.setNickname(player.nickname);
                        }, game.me);
                    }
                }
            },
            /**
             * 
             * @function
             */
            wuxie: function () {
                if (this.classList.contains('hidden')) return;
                this.classList.toggle('glow');
                if (this.classList.contains('glow') &amp;&amp; _status.event.type == 'wuxie' &amp;&amp;
                    _status.event.isMine() &amp;&amp; ui.confirm &amp;&amp; _status.imchoosing) {
                    ui.click.cancel(ui.confirm.lastChild);
                }
            },
            tempnowuxie: function () {
                if (this.classList.contains('hidden')) return;
                this.classList.toggle('glow');
                if (this.classList.contains('glow') &amp;&amp; _status.event.type == 'wuxie' &amp;&amp;
                    _status.event.isMine() &amp;&amp; ui.confirm &amp;&amp; _status.imchoosing) {
                    var triggerevent = _status.event.getTrigger();
                    if (triggerevent &amp;&amp; this._origin == triggerevent.parent.id) {
                        if (triggerevent.targets &amp;&amp; triggerevent.num == triggerevent.targets.length - 1) {
                            this.close();
                        }
                    }
                    ui.click.cancel(ui.confirm.lastChild);
                }
            },
            pause: function () {
                if (_status.paused2) return;
                if (_status.nopause) return;
                if (!_status.video) {
                    if (ui.pause.classList.contains('hidden')) return;
                    if (!_status.gameStarted) return;
                }
                ui.system.hide();
                game.pause2();
                var node = ui.create.pause().animate('start');
                ui.sidebar3.innerHTML = '';
                if (lib.config.show_discardpile) {
                    for (var i = 0; i &lt; ui.discardPile.childNodes.length; i++) {
                        var div = ui.create.div(ui.sidebar3);
                        div.innerHTML = get.translation(ui.discardPile.childNodes[i]);
                        ui.sidebar3.insertBefore(div, ui.sidebar3.firstChild);
                    }
                }
                node.appendChild(ui.sidebar);
                node.appendChild(ui.sidebar3);
                ui.historybar.classList.add('paused');
                ui.arena.classList.add('paused');
                ui.window.classList.add('touchinfohidden');
                ui.time.hide();
                if (game.onpause) {
                    game.onpause();
                }
            },
            resume: function (e) {
                if (_status.pausing) return;
                if (_status.dragged) return;
                if (_status.clicked) return;
                this.delete();
                ui.system.show();
                ui.time.show();
                ui.historybar.classList.remove('paused');
                ui.arena.classList.remove('paused');
                ui.window.classList.remove('touchinfohidden');
                game.resume2();
                e.stopPropagation();
                if (game.onresume) {
                    game.onresume();
                }
                return false;
            },
            config: function () {
                if (!ui.click.configMenu) return;
                if (_status.paused2) _status.config2 = false;
                else _status.config2 = true;

                _status.clicked = true;
                game.pause2();
                ui.click.configMenu();
                ui.system1.classList.remove('shown');
                ui.system2.classList.remove('shown');
            },
            swap: function () {
                if (_status.dragged) return;
                if (this.classList.contains('dead')) return;
                if (_status.over) return;
                if (ui.auto) ui.auto.show();
                if (ui.wuxie) ui.wuxie.show();
                game.swapPlayer(this);
            },
            mousewheel: function (evt) {
                if (this.firstChild &amp;&amp; this.firstChild.classList.contains('handcards') &amp;&amp;
                    !this.classList.contains('scrollh')) return;
                var node = this;
                var num = this._scrollnum || 6;
                var speed = this._scrollspeed || 16;
                clearInterval(node.interval);
                if (evt.detail > 0 || evt.wheelDelta &lt; 0) {
                    node.interval = setInterval(function () {
                        if (num-- &amp;&amp; Math.abs(node.scrollLeft + node.clientWidth - node.scrollWidth) > 0) {
                            node.scrollLeft += speed;
                        }
                        else {
                            clearInterval(node.interval);
                        }
                    }, 16);
                }
                else {
                    node.interval = setInterval(function () {
                        if (num-- &amp;&amp; node.scrollLeft > 0) {
                            node.scrollLeft -= speed;
                        }
                        else {
                            clearInterval(node.interval);
                        }
                    }, 16);
                }
            },
            touchStart: function (e) {
                this.startX = e.touches[0].clientX / game.documentZoom;
                this.startY = e.touches[0].clientY / game.documentZoom;
                _status.dragged = false;
            },
            dialogtouchStart: function (e) {
                ui.click.touchStart.call(this, e);
                _status.dialogtouched = true;
            },
            touchScroll: function (e) {
                if (_status.mousedragging) return;
                if (_status.draggingtouchdialog) return;
                if (!_status.dragged) {
                    if (Math.abs(e.touches[0].clientX / game.documentZoom - this.startX) > 10 ||
                        Math.abs(e.touches[0].clientY / game.documentZoom - this.startY) > 10) {
                        _status.dragged = true;
                    }
                }
                if ((this == ui.handcards1Container || this == ui.handcards2Container) &amp;&amp; !this.classList.contains('scrollh')) {
                    e.preventDefault();
                }
                else if (lib.device == 'ios' &amp;&amp; this.scrollHeight &lt;= this.offsetHeight + 5 &amp;&amp; this.scrollWidth &lt;= this.offsetWidth + 5) {
                    e.preventDefault();
                }
                else {
                    delete _status._swipeorigin;
                    e.stopPropagation();
                }
            },
            autoskill: function (bool, node) {
                var list = lib.config.autoskilllist;
                if (bool) {
                    list.remove(node.link);
                }
                else {
                    list.add(node.link);
                }
                game.saveConfig('autoskilllist', list);
            },
            skillbutton: function () {
                this.func(this.link);
            },
            autoskill2: function (e) {
                this.classList.toggle('on');
                var list = [];
                if (lib.skill[this.link].frequent) {
                    list.push(this.link);
                }
                if (lib.skill[this.link].subfrequent) {
                    for (var i = 0; i &lt; lib.skill[this.link].subfrequent.length; i++) {
                        list.push(this.link + '_' + lib.skill[this.link].subfrequent[i]);
                    }
                }
                for (var i = 0; i &lt; list.length; i++) {
                    if (this.classList.contains('on')) {
                        lib.config.autoskilllist.remove(list[i]);
                    }
                    else {
                        lib.config.autoskilllist.add(list[i]);
                    }
                }
                game.saveConfig('autoskilllist', lib.config.autoskilllist);
                ui.click.touchpop();
                e.stopPropagation();
            },
            hiddenskill: function (e) {
                this.classList.toggle('on');
                var hidden = lib.skill[this.link].preHidden;
                if (Array.isArray(hidden)) {
                    if (this.classList.contains('on')) {
                        _status.prehidden_skills.removeArray(hidden);
                    }
                    else {
                        _status.prehidden_skills.addArray(hidden);
                    }
                }
                if (this.classList.contains('on')) {
                    _status.prehidden_skills.remove(this.link);
                }
                else {
                    _status.prehidden_skills.add(this.link);
                }
                ui.click.touchpop();
                e.stopPropagation();
            },
            // forcetouch:function(){
            //     if(_status.force||_status.dragged){
            //         clearInterval(_status.forcetouchinterval);
            //         delete _status.forcetouchinterval;
            //         return;
            //     }
            //     window.ForceTouch.getForceTouchData(function(ForceTouchData){
            //         if(ForceTouchData.touches[0]){
            //             var force = parseFloat(ForceTouchData.touches[0].force);
            //             if(force > 0.2){
            //                 _status.force=true;
            //                 var taptic=false;
            //                 if(_status.longpressing){
            //                     delete _status.longpressing._waitingfordrag;
            //                     ui.click.touchpop();
            //                     ui.click.longpresscallback.call(_status.longpressing);
            //                     taptic=true;
            //                 }
            //                 else if(!_status.forceright){
            //                     _status.forceright=true;
            //                     setTimeout(function(){
            //                         _status.forceright=false;
            //                     },600);
            //                     if(_status.mousedragging){
            //                         _status.mousedragging=null;
            //                         _status.mouseleft=false;
            //                         _status.mousedragorigin=null;
            //                         _status.dragstatuschanged=false;
            //                         game.uncheck();
            //                         game.check();
            //                     }
            //                     switch(lib.config.pressure_click){
            //                         case 'pause':ui.click.pause();break;
            //                         case 'auto':ui.click.auto();break;
            //                         case 'config':ui.click.config();break;
            //                     }
            //                     taptic=true;
            //                 }
            //                 if(taptic&amp;&amp;lib.config.pressure_taptic){
            //                     if(window.TapticEngine){
            //                         window.TapticEngine.generateTapticFeedback();
            //                     }
            //                     else{
            //                         game.vibrate(50);
            //                     }
            //                 }
            //             }
            //         }
            //     });
            // },
            // pressurepause:function(force,event){
            //     if(!_status.force&amp;&amp;!_status.mousedragging&amp;&amp;force>=0.5&amp;&amp;!_status.forceright){
            //         _status.force=true;
            //         _status.forceright=true;
            //         setTimeout(function(){
            //             _status.forceright=false;
            //         },600);
            //         switch(lib.config.pressure_click){
            //             case 'pause':ui.click.pause();break;
            //             case 'auto':ui.click.auto();break;
            //             case 'config':ui.click.config();break;
            //         }
            //     }
            // },
            // rightpressure:function(force, event){
            //     if(force>0){
            //         _status.force=true;
            //     }
            //     if(force>=0.5){
            //         if(_status.mousedragging){
            //             _status.mousedragging=null;
            //             _status.mouseleft=false;
            //             _status.mousedragorigin=null;
            //             _status.dragstatuschanged=false;
            //             game.uncheck();
            //             game.check();
            //         }
            //         ui.click.rightplayer.call(this,event);
            //         _status.clickedplayer=false;
            //     }
            // },
            rightplayer: function (e) {
                if (this._nopup) return false;
                if (_status.clickedplayer) {
                    return false;
                }

                if (this._mouseenterdialog &amp;&amp; this._mouseenterdialog.parentNode) {
                    this._mouseenterdialog.delete();
                }
                else {
                    ui.click.intro.call(this, e);
                }
                _status.clickedplayer = true;
                _status.clicked = false;
                ui.click.longpresscancel.call(this);
                return false;
            },
            right: function (e) {
                if (window.inSplash) return false;
                if (lib.config.touchscreen) return;
                if (_status.noright) {
                    _status.noright = false;
                    return false;
                }
                if (_status.clickedplayer) {
                    _status.clickedplayer = false;
                    return;
                }
                game.closePopped();
                switch (lib.config.right_click) {
                    case 'shortcut': ui.click.shortcut(); break;
                    case 'pause': ui.click.pause(); break;
                    case 'auto': ui.click.auto(); break;
                    case 'config': ui.click.config(); break;
                }
                e.preventDefault();
                return false;
            }
        },
        /**
         * 
         * 
         * ui.selected = {buttons: [], cards: [], targets: []},
         * @type {!Object}
         */
        selected: {
            buttons: [], cards: [], targets: []
        },
        /**
         * ui
         * ui.clear
         * @function
         */
        clear: function () {
            game.addVideo('uiClear');
            var thrown = document.getElementsByClassName('thrown');
            var nodes = [];
            var i;
            for (i = 0; i &lt; thrown.length; i++) {
                nodes.push(thrown[i]);
            }
            for (i = 0; i &lt; nodes.length; i++) {
                if (!nodes[i].fixed) nodes[i].delete();
            }
        },
        updatec: function () {
            if (_status.noupdatec) return;
            var length = 0;
            var controls = [];
            var widths = [];
            var add = function (node, first) {
                var thiswidth = parseInt(node.style.width);
                if (thiswidth) {
                    thiswidth += 8;
                    length += thiswidth;
                    if (first) {
                        widths.unshift(thiswidth);
                    }
                    else {
                        widths.push(thiswidth);
                    }
                }
                else {
                    length += node.offsetWidth;
                    if (first) {
                        widths.unshift(node.offsetWidth);
                    }
                    else {
                        widths.push(node.offsetWidth);
                    }
                }
                if (first) {
                    controls.unshift(node);
                }
                else {
                    controls.push(node);
                }
            }
            var stayleft = null;
            for (var i = 0; i &lt; ui.control.childNodes.length; i++) {
                if (ui.control.childNodes[i].classList.contains('removing')) continue;
                if (!stayleft &amp;&amp; lib.config.wuxie_right &amp;&amp; ui.control.childNodes[i].stayleft) {
                    stayleft = ui.control.childNodes[i];
                }
                else {
                    add(ui.control.childNodes[i]);
                }
            }
            if (stayleft) {
                var fullwidth = 0;
                var fullright = (game.layout == 'long' || game.layout == 'long2' || game.chess || (game.layout != 'nova' &amp;&amp; parseInt(ui.arena.dataset.number) &lt;= 5));
                for (var i = 0; i &lt; widths.length; i++) {
                    fullwidth += widths[i] + 6;
                    if (get.is.phoneLayout()) fullwidth += 6;
                }
                fullwidth /= 2;
                fullwidth += stayleft.offsetWidth;
                if (get.is.phoneLayout()) {
                    fullwidth += 18;
                }
                else {
                    fullwidth += 12;
                }
                if (fullright) {
                    fullwidth += 124;
                    if ((game.layout == 'long2' || game.layout == 'nova') &amp;&amp; ui.arena.dataset.number == '8' &amp;&amp; get.mode() != 'boss') {
                        fullwidth += game.me.getLeft();
                    }
                }
                else {
                    fullwidth += 154;
                }
                if (game.layout != 'default' &amp;&amp; game.layout != 'newlayout' &amp;&amp; ui.arena.offsetWidth / 2 >= fullwidth) {
                    var current_offset = stayleft._offset;
                    if (fullright) {
                        stayleft._offset = Math.ceil(-ui.arena.offsetWidth / 2) + 135;
                        if ((game.layout == 'long2' || game.layout == 'nova') &amp;&amp; ui.arena.dataset.number == '8' &amp;&amp; get.mode() != 'boss') {
                            stayleft._offset += game.me.getLeft();
                        }
                    }
                    else {
                        stayleft._offset = Math.ceil(-ui.arena.offsetWidth / 2) + 165;
                    }
                    if (current_offset != stayleft._offset) {
                        stayleft.animate('controlpressdownx', 500);
                        stayleft.style.transform = 'translateX(' + stayleft._offset + 'px)';
                    }
                }
                else {
                    add(stayleft, true);
                }
            }
            if (!controls.length) return;
            var offset = -length / 2;
            var control = controls.shift();
            if (control._offset != offset) {
                control.animate('controlpressdownx', 500);
                control.style.transform = 'translateX(' + offset + 'px)';
                control._offset = offset;
            }
            while (controls.length) {
                var control = controls.shift();
                var width = widths.shift();
                offset += width + 6;
                if (get.is.phoneLayout()) {
                    offset += 6;
                }
                if (control._offset != offset) {
                    control.animate('controlpressdownx', 500);
                    control.style.transform = 'translateX(' + offset + 'px)';
                    control._offset = offset;
                }
            }
        },
        updatex: function () {
            ui.update.apply(this, arguments);
            ui.updatehl();
            for (var i = 0; i &lt; lib.onresize.length; i++) {
                lib.onresize[i]();
            }
            var cfg = game.documentZoom / game.deviceZoom;
            ui.updated();
            game.documentZoom = cfg * game.deviceZoom;
            ui.updatez();
            delete ui._updatexr;
        },
        updatexr: function () {
            if (ui._updatexr) {
                clearTimeout(ui._updatexr);
            }
            ui._updatexr = setTimeout(ui.updatex, 500);
        },
        /**
         * 
         * @function
         * @param {GameCores.GameObjects.Player} player 
         * @param {HTMLDivElement} nodes 
         * @param {?number} start [>=0]
         * @param {?boolean} inv truefalseXY
         */
        updatejm: function (player, nodes, start, inv) {
            if (typeof start != 'number') {
                start = 0;
            }
            var str;
            if (get.is.mobileMe(player) || game.layout == 'default' || player.classList.contains('linked')) {
                str = 'translateX(';
                if (inv) {
                    str += '-';
                }
            }
            else {
                str = 'translateY(';
            }
            var num = 0;
            for (var i = 0; i &lt; nodes.childElementCount; i++) {
                var node = nodes.childNodes[i];
                if (i &lt; start) {
                    node.style.transform = '';
                }
                else if (node.classList.contains('removing')) {
                    start++;
                }
                else {
                    ui.refresh(node);
                    node.classList.remove('drawinghidden');
                    node._transform = str + ((i - start) * 28) + 'px)';
                    node.style.transform = node._transform;
                }
            }
        },
        /**
         * 
         * @function
         * @param {?GameCores.GameObjects.Player} player 
         */
        updatem: function (player) {
            if (player) {
                var start = 0;
                if (!player.classList.contains('linked2') || !ui.arena.classList.contains('nolink')) {
                    start = 1;
                }
                ui.updatejm(player, player.node.marks, start, get.is.mobileMe(player));
            }
            else {
                for (var i = 0; i &lt; game.players.length; i++) {
                    ui.updatem(game.players[i]);
                }
            }
        },
        /**
         * 
         * @function
         * @param {?GameCores.GameObjects.Player} player 
         */
        updatej: function (player) {
            if (player) {
                ui.updatejm(player, player.node.judges);
            }
            else {
                for (var i = 0; i &lt; game.players.length; i++) {
                    ui.updatej(game.players[i]);
                }
            }
        },
        updatehl: function () {
            if (!game.me) return;
            if (!ui.handcards1Container || !ui.handcards2Container) return;
            if (!ui.handcards1Container.childNodes.length) return;
            var hs1 = [], hs2 = [];
            for (var i = 0; i &lt; ui.handcards1Container.firstChild.childElementCount; i++) {
                if (!ui.handcards1Container.firstChild.childNodes[i].classList.contains('removing')) {
                    hs1.push(ui.handcards1Container.firstChild.childNodes[i]);
                }
            }
            for (var i = 0; i &lt; ui.handcards2Container.firstChild.childElementCount; i++) {
                if (!ui.handcards2Container.firstChild.childNodes[i].classList.contains('removing')) {
                    hs2.push(ui.handcards2Container.firstChild.childNodes[i]);
                }
            }
            var offset1, offset12 = 0;
            if (!lib.config.fold_card) {
                offset1 = 112;
                ui.handcards1Container.classList.add('scrollh');
            }
            else {
                offset1 = Math.min(112, (ui.handcards1Container.offsetWidth - 128) / (hs1.length - 1));
                if (hs1.length > 1 &amp;&amp; offset1 &lt; 32) {
                    offset1 = 32;
                    ui.handcards1Container.classList.add('scrollh');
                }
                else {
                    ui.handcards1Container.classList.remove('scrollh');
                }
            }
            if (offset1 &lt; 100) {
                offset12 = 100 - offset1;
            }
            for (var i = 0; i &lt; hs1.length; i++) {
                hs1[i].style.transform = 'translateX(' + (i * offset1) + 'px)';
                hs1[i]._transform = 'translateX(' + (i * offset1) + 'px)';
                ui.refresh(hs1[i]);
                hs1[i].classList.remove('drawinghidden');
                if (offset12 > 40) {
                    offset12 = 90 - hs1[i].node.info.offsetWidth;
                    hs1[i].node.info.querySelector('span').style.display = 'none';
                    if (hs1[i].node.name.classList.contains('long')) {
                        hs1[i].node.name.style.transform = 'translateY(16px)  scale(0.85)';
                        hs1[i].node.name.style.transformOrigin = 'top left';
                    }
                    else {
                        hs1[i].node.name.style.transform = 'translateY(16px)';
                    }
                    hs1[i].node.info.style.transform = 'translateX(-' + offset12 + 'px) translateY(-3px)';
                }
                else {
                    hs1[i].node.info.querySelector('span').style.display = '';
                    hs1[i].node.name.style.transform = '';
                    hs1[i].node.name.style.transformOrigin = '';
                    hs1[i].node.info.style.transform = 'translateX(-' + offset12 + 'px)';
                }
            }
            ui.handcards1Container.firstChild.style.width = (offset1 * (hs1.length - 1) + 118) + 'px';

            var offset2, offset22 = 0;
            if (!lib.config.fold_card) {
                offset2 = 112;
                ui.handcards2Container.classList.add('scrollh');
            }
            else {
                offset2 = Math.min(112, (ui.handcards2Container.offsetWidth - 128) / (hs2.length - 1));
                if (hs2.length > 1 &amp;&amp; offset2 &lt; 32) {
                    offset2 = 32;
                    ui.handcards2Container.classList.add('scrollh');
                }
                else {
                    ui.handcards2Container.classList.remove('scrollh');
                }
            }
            if (offset2 &lt; 100) {
                offset22 = 100 - offset2;
            }
            for (var i = 0; i &lt; hs2.length; i++) {
                hs2[i].style.transform = 'translateX(' + (i * offset2) + 'px)';
                hs2[i]._transform = 'translateX(' + (i * offset2) + 'px)';
                ui.refresh(hs2[i]);
                hs2[i].classList.remove('drawinghidden');
                if (offset22 > 40) {
                    offset22 = 90 - hs2[i].node.info.offsetWidth;
                    hs2[i].node.info.querySelector('span').style.display = 'none';
                    if (hs2[i].node.name.classList.contains('long')) {
                        hs2[i].node.name.style.transform = 'translateY(16px)  scale(0.85)';
                        hs2[i].node.name.style.transformOrigin = 'top left';
                    }
                    else {
                        hs2[i].node.name.style.transform = 'translateY(16px)';
                    }
                    hs2[i].node.info.style.transform = 'translateX(-' + offset22 + 'px) translateY(-3px)';
                }
                else {
                    hs2[i].node.info.querySelector('span').style.display = '';
                    hs2[i].node.name.style.transform = '';
                    hs2[i].node.name.style.transformOrigin = '';
                    hs2[i].node.info.style.transform = 'translateX(-' + offset22 + 'px)';
                }
            }
            ui.handcards2Container.firstChild.style.width = (offset2 * (hs2.length - 1) + 118) + 'px';
        },
        /**
         * 
         * @function
         * @param {?boolean} compute true
         */
        updateh: function (compute) {
            if (!game.me) return;
            if (!ui.handcards1Container) return;
            if (lib.config.low_performance) {
                if (compute) {
                    ui.updatehl();
                    setTimeout(ui.updatehl, 1000);
                }
                return;
            }
            if (compute) {
                ui.handcards1Container._handcardsWidth = ui.handcards1Container.offsetWidth;
                ui.handcards2Container._handcardsWidth = ui.handcards2Container.offsetWidth;
            }
            ui.updatehx(game.me.node.handcards1);
            ui.updatehx(game.me.node.handcards2);
        },
        updatehx: function (node) {
            var width = node.parentNode._handcardsWidth;
            var num = node.childElementCount - node.getElementsByClassName('removing').length;
            node.classList.remove('fold0');
            node.classList.remove('fold1');
            node.classList.remove('fold2');
            node.classList.remove('fold3');
            if (num * 78 + 40 >= width) {
                // node.dataset.fold=3;
                node.classList.add('fold3');
            }
            else if (num * 93 + 25 >= width) {
                // node.dataset.fold=2;
                node.classList.add('fold2');
            }
            else if (num * 112 + 6 >= width) {
                // node.dataset.fold=1;
                node.classList.add('fold1');
            }
            else {
                // node.dataset.fold=0;
                node.classList.add('fold0');
            }
        },
        /**
         * 
         * @function
         */
        updated: function () {
            if (document.documentElement.offsetWidth &lt; 900 || document.documentElement.offsetHeight &lt; 500) {
                /**
                 * 
                 * @type {number}
                 */
                game.deviceZoom = Math.min(
                    Math.round(document.documentElement.offsetWidth / 98) / 10,//?? 98?
                    Math.round(document.documentElement.offsetHeight / 50) / 10
                );
            }
            else {
                game.deviceZoom = 1;
            }
        },
        /**
         * {@link game.documenZoom}document
         * @function
         */
        updatez: function () {
            var width = document.documentElement.offsetWidth;
            var height = document.documentElement.offsetHeight;
            var zoom = game.documentZoom;
            if (zoom != 1) {
                document.body.style.width = Math.round(width / zoom) + 'px';
                document.body.style.height = Math.round(height / zoom) + 'px';
                document.body.style.transform = 'scale(' + (Math.floor(zoom * 100) / 100) + ')';
            }
            else {
                document.body.style.width = width + 'px';
                document.body.style.height = height + 'px';
                document.body.style.transform = '';
            }
        },
        /**
         * UI
         * @function
         */
        update: function () {
            for (var i = 0; i &lt; ui.updates.length; i++) {
                ui.updates[i]();
            }
            if (ui.dialog &amp;&amp; !ui.dialog.classList.contains('noupdate')) {
                if (game.chess) {
                    if (ui.dialog.content.scrollHeight &lt; 240 &amp;&amp; (!ui.dialog.buttons || !ui.dialog.buttons.length) &amp;&amp; !ui.dialog.forcebutton) {
                        ui.dialog.style.height = ui.dialog.content.offsetHeight + 'px';
                        ui.dialog.classList.add('slim');
                    }
                    else {
                        ui.dialog.style.height = '';
                        ui.dialog.classList.remove('slim');
                    }
                }
                else {
                    if ((!ui.dialog.buttons || !ui.dialog.buttons.length) &amp;&amp; !ui.dialog.forcebutton &amp;&amp; ui.dialog.classList.contains('fullheight') == false &amp;&amp; get.mode() != 'stone') {
                        ui.dialog.classList.add('nobutton');
                        if (ui.dialog.content.offsetHeight &lt; 240) {
                            if (!ui.dialog._heightset) {
                                ui.dialog._heightset = ui.dialog.style.height || true;
                            }
                            ui.dialog.style.height = ui.dialog.content.offsetHeight + 'px';
                            if (lib.config.show_log != 'off') {
                                ui.dialog.classList.add('scroll1');
                                ui.dialog.classList.add('scroll2');
                                return;
                            }
                        }
                        else {
                            if (typeof ui.dialog._heightset == 'string') {
                                ui.dialog.style.height = ui.dialog._heightset;
                            }
                            else if (ui.dialog._heightset) {
                                ui.dialog.style.height = '';
                            }
                            delete ui.dialog._heightset;
                        }
                    }
                    else {
                        if (typeof ui.dialog._heightset == 'string') {
                            ui.dialog.style.height = ui.dialog._heightset;
                        }
                        else if (ui.dialog._heightset) {
                            ui.dialog.style.height = '';
                        }
                        delete ui.dialog._heightset;
                        ui.dialog.classList.remove('nobutton');
                    }
                }
                var height1 = ui.dialog.content.offsetHeight;
                var height2 = ui.dialog.contentContainer.offsetHeight;
                if (game.chess) {
                    if (height1 &lt; 240) {
                        ui.dialog.style.height = height1 + 'px';
                    }
                }
                else {
                    if (!ui.dialog.forcebutton &amp;&amp; !ui.dialog._scrollset &amp;&amp; (height1 &lt;= 190 || (height2 >= height1 &amp;&amp; height2 >= 210))) {
                        ui.dialog.classList.remove('scroll1');
                        ui.dialog.classList.remove('scroll2');
                    }
                    else {
                        ui.dialog.classList.add('scroll1');
                        ui.dialog.classList.add('scroll2');
                        if (game.layout != 'default') {
                            ui.dialog.style.height = Math.min(height1, ((game.layout == 'long2' || game.layout == 'nova') &amp;&amp; ui.arena.classList.contains('choose-character')) ? 380 : 350) + 'px';
                            ui.dialog._scrollset = true;
                        }
                    }
                    if (game.layout == 'long2' || game.layout == 'nova') {
                        if (height1 + 240 >= ui.arena.offsetHeight) {
                            ui.dialog.classList.add('scroll3');
                        }
                        else {
                            ui.dialog.classList.remove('scroll3');
                        }
                    }
                }
            }
        },
        recycle: function (node, key) {
            if (!ui._recycle) ui._recycle = {};
            if (typeof node == 'string') {
                return ui._recycle[node]
            }
            ui._recycle[key] = node;
        },
    };
    /**
     * ()
     * @namespace
     * @global
     */
    var get = /**@lends get */ {
        /**
         * 
         * @returns {!number} 
         */
        connectNickname: function () {
            return typeof lib.config.connect_nickname == 'string' ? (lib.config.connect_nickname.slice(0, 12)) : '';
        },
        //TODO
        sourceCharacter: function (str) {
            if (str) {
                for (var i in lib.characterReplace) {
                    if (lib.characterReplace[i].contains(str)) return i;
                }
            }
            return str;
        },
        /**
         * 
         * false
         * @param {GameCores.GameObjects.Player} player 
         * @returns {!boolean}
         */
        isLuckyStar: function (player) {
            if (player &amp;&amp; player.hasSkillTag('luckyStar')) return true;
            if (_status.connectMode) return false;
            return (!player || player == game.me || player.isUnderControl()) &amp;&amp; lib.config.lucky_star == true;
        },
        /**
         * hp
         * @param {(number|string)} hp `hp``hp/maxHp`**hp**0
         * @returns {!number}
         */
        infoHp: function (hp) {
            if (typeof hp == 'number') return hp;
            else if (typeof hp == 'string' &amp;&amp; hp.indexOf('/') != -1) {
                return parseInt(hp.slice(0, hp.indexOf('/')));
            }
            return 0;
        },
        /**
         * maxHp
         * @param {(number|string)} hp `hp``hp/maxHp`**maxHp**0
         * @returns {!number}
         */
        infoMaxHp: function (hp) {
            if (typeof hp == 'number') return hp;
            else if (typeof hp == 'string' &amp;&amp; hp.indexOf('/') != -1) {
                return parseInt(hp.slice(hp.indexOf('/') + 1));
            }
            return 0;
        },
        /**
         * 
         * @namespace
         */
        is: {
            //ban
            banForBeginner: function (current) {
                if (current in lib.character) {
                    for (var i in lib.characterPack) {
                        if (!['Beginner', 'hololive', 'nijisanji', 'clubs', 'vtuber'].contains(i)) {
                            if (current in lib.characterPack[i]) {
                                return true
                            }
                        }
                    }
                    if ([
                        're_ShigureUi', 're_NijikawaRaki',
                        'okamiMio',
                        'Elu', 'SuzukaUtako', 'MononobeAlice', 'SakuraRitsuki', 'YagamiKaruta',
                        'Bella', 'Carol', 'Azusa', 'Yousa', 'AkiRinco', 'Lovely', 'Pudding', 'jike', 'Bacharu', 'SephiraSu', 'Reine', 'IsekaiJoucho', 'Rim', 'Harusaruhi',
                        'Bafuko', 'Hiiro', 'Eilene', 'YaotomeNoe', 'Niuniuzi', 'Zaodaoji'
                    ].contains(current)) return true;
                    return false;
                }
                if (current in lib.card) {
                    for (var i in lib.cardPack) {
                        if (!['standard', 'extra'].contains(i)) {
                            if (lib.cardPack[i].contains(current)) {
                                return true
                            }
                        }
                    }
                    return false;
                }
            },
            //()
            filterCardBy: function (card, arg) {
                if (!card || !arg) return false;
                if (typeof arg == 'string') {
                    if (arg == get.name(card)) return true;
                }
                else if (typeof arg == 'object') {
                    for (var x in arg) {
                        var value;
                        if (x == 'type' || x == 'subtype' || x == 'color' || x == 'suit' || x == 'number') {
                            value = get[x](card);
                        }
                        else {
                            value = card[x];
                        }
                        if ((typeof arg[x] == 'string' &amp;&amp; value == arg[x]) ||
                            (Array.isArray(arg[x]) &amp;&amp; arg[x].contains(value))) {
                            return true;
                        }
                    }
                }
                else if (typeof arg == 'function') {
                    return arg(card);
                }
                return false;
            },
            /**
             * 
             */
            blocked: function (skill, player) {
                if (!player.storage.skill_blocker || !player.storage.skill_blocker.length) return false;
                for (var i of player.storage.skill_blocker) {
                    if (lib.skill[i] &amp;&amp; lib.skill[i].skillBlocker &amp;&amp; lib.skill[i].skillBlocker(skill, player)) return true;
                }
                return false;
            },
            /**
             * 
             */
            double: function (name, array) {
                if (!lib.character[name] || !lib.character[name][4] || name.indexOf('gz_') != 0) return false;
                for (var i of lib.character[name][4]) {
                    if (i.indexOf('doublegroup:') == 0) {
                        if (!array) return true;
                        return i.split(':').slice(1);
                    }
                }
                return false;
            },
            /**
             * 
             */
            yingbian: function (node) {
                return get.cardtag(node, 'yingbian_zhuzhan') || get.cardtag(node, 'yingbian_fujia') || get.cardtag(node, 'yingbian_canqu') || get.cardtag(node, 'yingbian_kongchao');
            },
            emoji: function (substring) {
                if (substring) {
                    var reg = new RegExp("[~#^$@%&amp;!?%*]", 'g');
                    if (substring.match(reg)) {
                        return true;
                    }
                    for (var i = 0; i &lt; substring.length; i++) {
                        var hs = substring.charCodeAt(i);
                        if (0xd800 &lt;= hs &amp;&amp; hs &lt;= 0xdbff) {
                            if (substring.length > 1) {
                                var ls = substring.charCodeAt(i + 1);
                                var uc = ((hs - 0xd800) * 0x400) + (ls - 0xdc00) + 0x10000;
                                if (0x1d000 &lt;= uc &amp;&amp; uc &lt;= 0x1f77f) {
                                    return true;
                                }
                            }
                        }
                        else if (substring.length > 1) {
                            var ls = substring.charCodeAt(i + 1);
                            if (ls == 0x20e3) {
                                return true;
                            }
                        }
                        else {
                            if (0x2100 &lt;= hs &amp;&amp; hs &lt;= 0x27ff) {
                                return true;
                            }
                            else if (0x2B05 &lt;= hs &amp;&amp; hs &lt;= 0x2b07) {
                                return true;
                            }
                            else if (0x2934 &lt;= hs &amp;&amp; hs &lt;= 0x2935) {
                                return true;
                            }
                            else if (0x3297 &lt;= hs &amp;&amp; hs &lt;= 0x3299) {
                                return true;
                            }
                            else if (hs == 0xa9 || hs == 0xae || hs == 0x303d || hs == 0x3030
                                || hs == 0x2b55 || hs == 0x2b1c || hs == 0x2b1b
                                || hs == 0x2b50) {
                                return true;
                            }
                        }
                    }
                }
                return false;
            },
            banWords: function (str) {
                if (get.is.emoji(str)) return true;
                for (var i of window.bannedKeyWords) {
                    if (str.indexOf(i) != -1) return true;
                }
                return false;
            },
            converted: function (event) {
                return !(event.card &amp;&amp; event.card.isCard);
            },
            safari: function () {
                var ua = navigator.userAgent.toLowerCase();
                return ua.indexOf('safari' != -1) &amp;&amp; ua.indexOf('chrome') == -1;
            },
            freePosition: function (cards) {
                for (var i = 0; i &lt; cards.length; i++) {
                    if (!cards[i].hasPosition) return false;
                    if (cards[i].hasPosition()) return false;
                }
                return true;
            },
            nomenu: function (name, item) {
                var menus = ['system', 'menu'];
                var configs = {
                    show_round_menu: lib.config.show_round_menu,
                    round_menu_func: lib.config.round_menu_func,
                    touchscreen: lib.config.touchscreen,
                    swipe_up: lib.config.swipe_up,
                    swipe_down: lib.config.swipe_down,
                    swipe_left: lib.config.swipe_left,
                    swipe_right: lib.config.swipe_right,
                    right_click: lib.config.right_click,
                    phonelayout: lib.config.phonelayout
                };
                configs[name] = item;
                if (!configs.phonelayout) return false;
                if (configs.show_round_menu &amp;&amp; menus.contains(configs.round_menu_func)) {
                    return false;
                }
                if (configs.touchscreen) {
                    if (menus.contains(configs.swipe_up)) return false;
                    if (menus.contains(configs.swipe_down)) return false;
                    if (menus.contains(configs.swipe_left)) return false;
                    if (menus.contains(configs.swipe_right)) return false;
                }
                else {
                    if (configs.right_click == 'config') return false;
                }
                if (name) {
                    setTimeout(function () {
                        alert('');
                    });
                }
                return true;
            },
            altered: function (skill) {
                return false;
                // if(_status.connectMode) return true;
                // return !lib.config.vintageSkills.contains(skill);
            },
            node: function (obj) {
                var str = Object.prototype.toString.call(obj);
                if (str &amp;&amp; str.indexOf('[object HTML')) return true;
                return false;
            },
            div: function (obj) {
                return Object.prototype.toString.call(obj) === '[object HTMLDivElement]';
            },
            map: function (obj) {
                return Object.prototype.toString.call(obj) === '[object Map]';
            },
            set: function (obj) {
                return Object.prototype.toString.call(obj) === '[object Set]';
            },
            object: function (obj) {
                return Object.prototype.toString.call(obj) === '[object Object]';
            },
            singleSelect: function (func) {
                if (typeof func == 'function') return false;
                var select = get.select(func);
                return select[0] == 1 &amp;&amp; select[1] == 1;
            },
            jun: function (name) {
                if (get.mode() == 'guozhan') {
                    if (name &amp;&amp; typeof name == 'object') {
                        if (name.isUnseen &amp;&amp; name.isUnseen(0)) return false;
                        name = name.name1;
                    }
                    if (typeof name == 'string' &amp;&amp; name.indexOf('gz_jun_') == 0) {
                        return true;
                    }
                }
                return false;
            },
            versus: function () {
                return !_status.connectMode &amp;&amp; get.mode() == 'versus' &amp;&amp; _status.mode == 'three';
            },
            changban: function () {
                return get.mode() == 'single' &amp;&amp; _status.mode == 'changban';
            },
            single: function () {
                return get.mode() == 'single' &amp;&amp; _status.mode == 'normal';
            },
            mobileMe: function (player) {
                return (game.layout == 'mobile' || game.layout == 'long') &amp;&amp; !game.chess &amp;&amp; player.dataset.position == 0;
            },
            newLayout: function () {
                if (game.layout != 'default') return true;
                return false;
            },
            phoneLayout: function () {
                if (!lib.config.phonelayout) return false;
                return (game.layout == 'mobile' || game.layout == 'long' || game.layout == 'long2' || game.layout == 'nova');
            },
            singleHandcard: function () {
                if (game.singleHandcard || game.layout == 'mobile' || game.layout == 'long' || game.layout == 'long2' || game.layout == 'nova') {
                    return true;
                }
                return false;
            },
            linked2: function (player) {
                if (game.chess) return true;
                if (lib.config.link_style2 != 'rotate') return true;
                // if(game.chess) return false;
                if (game.layout == 'long' || game.layout == 'long2' || game.layout == 'nova') return true;
                if (player.dataset.position == '0') {
                    return ui.arena.classList.contains('oblongcard');
                }
                return false;
            },
            empty: function (obj) {
                for (var i in obj) return false;
                return true;
            },
            pos: function (str) {
                return (str == 'h' || str == 'e' || str == 'j' || str == 'he' || str == 'hj' || str == 'ej' || str == 'hej');
            },
            /**
             * 
             */
            locked: function (skill, player) {
                var info = lib.skill[skill];
                if (typeof info.locked == 'function') return info.locked(skill, player);
                if (info.locked == false) return false;
                if (info.trigger &amp;&amp; info.forced) return true;
                if (info.mod) return true;
                if (info.locked) return true;
                return false;
            },
        },
        /**
         * 
         * 
         * @param {number} num 
         * @returns {!Array&lt;GameCores.GameObjects.Card>}
         */
        bottomCards: function (num) {
            if (_status.waitingForCards) {
                ui.create.cards.apply(ui.create, _status.waitingForCards);
                delete _status.waitingForCards;
            }
            var list = [];
            var card = false;
            if (typeof num != 'number') num = 1;
            if (num == 0) { card = true; num = 1; }
            if (num &lt; 0) num = 1;
            while (num--) {
                if (ui.cardPile.hasChildNodes() == false) {
                    if (_status.maxShuffle != undefined) {
                        if (_status.maxShuffle == 0) {
                            if (_status.maxShuffleCheck) {
                                game.over(_status.maxShuffleCheck());
                            }
                            else {
                                game.over('');
                            }
                            return [];
                        }
                        _status.maxShuffle--;
                    }
                    game.shuffleNumber++;
                    if (_status.event.trigger) _status.event.trigger('washCard');
                    var cards = [], i;
                    for (var i = 0; i &lt; lib.onwash.length; i++) {
                        if (lib.onwash[i]() == 'remove') {
                            lib.onwash.splice(i--, 1);
                        }
                    }
                    if (_status.discarded) {
                        _status.discarded.length = 0;
                    }
                    for (i = 0; i &lt; ui.discardPile.childNodes.length; i++) {
                        var currentcard = ui.discardPile.childNodes[i];
                        currentcard.vanishtag.length = 0;
                        if (get.info(currentcard).vanish || currentcard.storage.vanish) {
                            currentcard.remove();
                            continue;
                        }
                        cards.push(currentcard);
                    }
                    cards.randomSort();
                    for (var i = 0; i &lt; cards.length; i++) {
                        ui.cardPile.appendChild(cards[i]);
                    }
                }
                if (ui.cardPile.hasChildNodes() == false) {
                    game.over('');
                    return [];
                }
                var cardx = ui.cardPile.removeChild(ui.cardPile.lastChild);
                cardx.original = 'c';
                list.push(cardx);
            }
            game.updateRoundNumber();
            if (card) return list[0];
            return list;
        },
        //TODO
        discarded: function () {
            var list = _status.discarded.slice(0);
            for (var i = 0; i &lt; list.length; i++) {
                if (list[i].parentNode != ui.discardPile) {
                    list.splice(i--, 1);
                }
            }
            return list;
        },
        /**
         * 
         * #window &lt;- #arena
         * @returns {number}
         */
        cardOffset: function () {
            var x = ui.arena.getBoundingClientRect();
            var y = ui.window.getBoundingClientRect();
            return -y.width / 2 + (x.left + x.width / 2);
        },
        /**
         * @param {string} str color
         * @returns {string} '#r'
         */
        colorspan: function (str) {
            if (str[0] == '#') {
                var color;
                switch (str[1]) {
                    case 'r': color = 'fire'; break;
                    case 'p': color = 'legend'; break;
                    case 'b': color = 'blue'; break;
                    case 'g': color = 'green'; break;
                    case 'y': color = 'yellow'; break;
                    case 'i': color = 'ice'; break;
                    default: return str.slice(2);
                }
                return '&lt;span class="' + color + 'text ' + color + 'auto">' + str.slice(2) + '&lt;/span>';
            }
            return str;
        },
        evtprompt: function (next, str) {
            if (next.prompt) {
                next.set('prompt2', str);
            }
            else {
                if (str.indexOf('###') == 0) {
                    var prompts = str.slice(3).split('###');
                    if (prompts[0]) next.set('prompt', prompts[0]);
                    if (prompts[1]) next.set('prompt2', prompts[1]);
                }
                else {
                    next.set('prompt', str);
                }
            }
        },
        /**
         * ()`cards``card`
         * `card``autoViewAs`()`cards``autoViewAs`
         * @param {GameCores.GameObjects.Card} card  ""
         * @param {!string} card.name 
         * @param {(GameCores.GameObjects.Card|Array&lt;GameCores.GameObjects.Card>)} cards ()
         * @returns {({name:string, cards:?Array&lt;GameCores.GameObjects.Card>}|{name:string, suit: string, number: (string|number), nature: string}|{name:string, suit: string, number: (string|number), nature: string, isCard: true, cardid: (string|number), wunature: boolean, storage: Object, cards: Array&lt;GameCores.GameObjects.Card>}|GameCores.GameObjects.Card)}
         */
        autoViewAs: function (card, cards) {
            var info = get.info(card);
            if (info.autoViewAs) {
                if (cards === false) {
                    return {
                        name: info.autoViewAs
                    };
                }
                else if (Array.isArray(cards)) {
                    return {
                        name: info.autoViewAs,
                        cards: cards.slice(0)
                    };
                }
                else if (get.itemtype(card) == 'card') {
                    return {
                        name: info.autoViewAs,
                        cards: [card]
                    };
                }
                else {
                    return {
                        name: info.autoViewAs,
                        suit: card.suit,
                        number: card.number,
                        nature: card.nature,
                    };
                }
            }
            else {
                if (card.isCard || get.itemtype(card) == 'card') {
                    var next = {
                        name: get.name(card),
                        suit: get.suit(card),
                        number: get.number(card),
                        nature: get.nature(card),
                        isCard: true,
                        cardid: card.cardid,
                        wunature: card.wunature,
                        storage: card.storage,
                        cards: card.cards,
                    };
                    if (get.itemtype(cards) == 'cards' &amp;&amp; !card.cards) next.cards = cards.slice(0);
                    else if (get.itemtype(card) == 'card') next.cards = [card];
                    return next;
                }
                else if (get.is.object(card) &amp;&amp; get.itemtype(cards) == 'cards' &amp;&amp; !card.cards) {
                    card = get.copy(card);
                    card.cards = cards.slice(0);
                }
                return card;
            }
        },
        max: function (list, func, type) {
            list = list.slice(0);
            if (typeof func == 'string') {
                var key = func;
                func = function (item) {
                    return item[key];
                }
            }
            list.sort(function (a, b) {
                return func(b) - func(a);
            });
            if (type == 'list') {
                var list2 = [];
                for (var i = 0; i &lt; list.length; i++) {
                    if (func(list[i]) == func(list[0])) {
                        list2.push(list[i]);
                    }
                }
                return list2;
            }
            else if (type == 'item') {
                return list[0];
            }
            else {
                return func(list[0]);
            }
        },
        min: function (list, func, type) {
            list = list.slice(0);
            if (typeof func == 'string') {
                var key = func;
                func = function (item) {
                    return item[key];
                }
            }
            list.sort(function (a, b) {
                return func(a) - func(b);
            });
            if (type == 'list') {
                var list2 = [];
                for (var i = 0; i &lt; list.length; i++) {
                    if (func(list[i]) == func(list[0])) {
                        list2.push(list[i]);
                    }
                }
                return list2;
            }
            else if (type == 'item') {
                return list[0];
            }
            else {
                return func(list[0]);
            }
        },
        character: function (name, num) {
            var info = lib.character[name];
            if (!info) {
                for (var i in lib.characterPack) {
                    if (lib.characterPack[i][name]) {
                        info = lib.characterPack[i][name];
                        break;
                    }
                }
            }
            if (info) {
                if (typeof num == 'number') {
                    return info[num];
                }
                return info;
            }
            return null;
        },
        characterIntro: function (name) {
            if (lib.characterIntro[name]) return lib.characterIntro[name];
            var tags = get.character(name, 4);
            if (tags) {
                for (var i = 0; i &lt; tags.length; i++) {
                    if (tags[i].indexOf('des:') == 0) {
                        return tags[i].slice(4);
                    }
                }
            }
            if (name.indexOf('gz_') == 0) {
                name = name.slice(3);
                if (lib.characterIntro[name]) return lib.characterIntro[name];
            }
            if (name.indexOf('_') != -1) {
                name = name.slice(name.indexOf('_') + 1);
            }
            if (lib.characterIntro[name]) return lib.characterIntro[name];
            // return '';
            return '';
        },
        characterTag: function (name) {
            var str = '';
            var tags = get.character(name, 4);
            if (!tags) return str;
            if (tags) {
                for (var i = 0; i &lt; tags.length; i++) {
                    if (tags[i].indexOf('des:') == 0) {
                        continue;
                    }
                    var str0 = lib.translate[tags[i] + '_tag'] || lib.translate[tags[i]];
                    if (str0) {
                        if (!str.length) str += ':';
                        str += ' ';
                        str += str0;
                    }
                }
            }
            return str;
        },
        groupnature: function (group, method) {
            var nature = lib.groupnature[group];
            if (!nature) return '';
            if (method == 'raw') {
                return nature;
            }
            return nature + 'mm';
        },
        /**
         * 
         * @param {number} 
         * @returns {number} (-1|0|1)
         */
        sgn: function (num) {
            if (num > 0) return 1;
            if (num &lt; 0) return -1;
            return 0;
        },
        rand: function (num, num2) {
            if (typeof num2 == 'number') {
                return num + Math.floor(Math.random() * (num2 - num + 1));
            }
            else {
                return Math.floor(Math.random() * num);
            }
        },
        sort: function (arr, method) {
            switch (method) {
                case 'seat': {
                    lib.tempSortSeat = arguments[2];
                    arr.sort(lib.sort.seat);
                    delete lib.tempSortSeat;
                    return arr;
                }
            }
        },
        sortSeat: function (arr, target) {
            lib.tempSortSeat = target;
            arr.sort(lib.sort.seat);
            delete lib.tempSortSeat;
            return arr;
        },
        zip: function (callback) {
            if (!window.JSZip) {
                lib.init.js(lib.assetURL + 'game', 'jszip', function () {
                    callback(new JSZip());
                });
            }
            else {
                callback(new JSZip());
            }
        },
        delayx: function (num, max) {
            if (typeof num != 'number') num = 1;
            if (typeof max != 'number') max = Infinity;
            switch (lib.config.game_speed) {
                case 'vslow': return Math.min(max, 2.5 * num);
                case 'slow': return Math.min(max, 1.5 * num);
                case 'fast': return Math.min(max, 0.7 * num);
                case 'vfast': return Math.min(max, 0.4 * num);
                case 'vvfast': return Math.min(max, 0.2 * num);
                default: return Math.min(max, num);
            }
        },
        prompt: function (skill, target, player) {
            player = player || _status.event.player;
            if (target) {
                var str = get.translation(target);
                if (target == player) {
                    str += ''
                }
                return '' + str + '' + get.skillTranslation(skill, player) + '';
            }
            else {
                return '' + get.skillTranslation(skill, player) + '';
            }
        },
        prompt2: function (skill, target, player) {
            var str = get.prompt.apply(this, arguments);
            if (!lib.translate[skill + '_info'] &amp;&amp; !lib.dynamicTranslate[skill]) return str;
            return '###' + str + '###' + get.skillInfoTranslation(skill, player);
        },
        url: function (master) {
            var url = lib.config.updateURL || lib.updateURL;
            if (url[url.length - 1] != '/') {
                url += '/';
            }
            if (master != 'nodev') {
                return url + 'master/';
            }
            else {
                return url + 'v' + lib.version + '/';
            }
        },
        round: function (num, f) {
            var round = 1;
            for (var i = 0; i &lt; f; i++) {
                round *= 10;
            }
            return Math.round(num * round) / round;
        },
        playerNumber: function () {
            var num;
            if (_status.brawl &amp;&amp; _status.brawl.playerNumber) {
                num = _status.brawl.playerNumber
            }
            else {
                num = get.config('player_number');
            }
            return parseInt(num) || 2;
        },
        benchmark: function (func1, func2, iteration, arg) {
            var tic, toc;
            var key1, key2;
            if (!arg) arg = [];
            if (Array.isArray(func2)) {
                key1 = func2[0];
                key2 = func2[1];
            }
            else if (typeof func2 == 'string') {
                key1 = func2;
                func2 = iteration || 100;
            }
            else if (typeof func2 == 'number') {
                arg = iteration || arg;
                iteration = func2;
            }
            tic = get.utc();
            for (var i = 0; i &lt; iteration; i++) {
                if (key1) {
                    func1[key1](arg.randomGet());
                }
                else {
                    func1(arg.randomGet());
                }
            }
            toc = get.utc();
            if (typeof func2 == 'number') {
                return toc - tic;
            }
            console.log('time1: ' + (toc - tic));
            tic = get.utc();
            for (var i = 0; i &lt; iteration; i++) {
                if (key2) {
                    func1[key2](arg.randomGet());
                }
                else {
                    func2(arg.randomGet());
                }
            }
            toc = get.utc();
            console.log('time2: ' + (toc - tic));
        },
        stringify: function (obj, level) {
            level = level || 0;
            var indent = '';
            var str;
            for (var i = 0; i &lt; level; i++) {
                indent += '    ';
            }
            if (get.objtype(obj) == 'object') {
                str = '{\n';
                for (var i in obj) {
                    if (/[^a-zA-Z]/.test(i)) {
                        str += indent + '    "' + i + '":' + get.stringify(obj[i], level + 1) + ',\n';
                    }
                    else {
                        str += indent + '    ' + i + ':' + get.stringify(obj[i], level + 1) + ',\n';
                    }
                }
                str += indent + '}';
                return str;
            }
            else {
                if (typeof obj == 'function') {
                    str = obj.toString();
                    str = str.replace(/\t/g, '    ');
                    var i = str.lastIndexOf('\n');
                    var num = 0;
                    for (var j = i + 1; j &lt; str.length &amp;&amp; str[j] == ' '; j++) {
                        num++;
                    }
                    num = Math.floor(num / 4);
                    for (i = 0; i &lt; num - level; i++) {
                        str = str.replace(/\n    /g, '\n');
                    }
                }
                else {
                    try {
                        if (Array.isArray(obj) &amp;&amp; obj.contains(Infinity)) {
                            obj = obj.slice(0);
                            var rand = get.id();
                            for (var i = 0; i &lt; obj.length; i++) {
                                if (obj[i] === Infinity) {
                                    obj[i] = parseInt(rand);
                                }
                            }
                            str = JSON.stringify(obj).replace(new RegExp(rand, 'g'), 'Infinity');
                        }
                        else {
                            str = JSON.stringify(obj) || '';
                        }
                    }
                    catch (e) {
                        str = '';
                    }
                }
                return str;
            }
        },
        /**
         * (|)HTML
         * @param {any} obj 
         * @returns {any}
         */
        copy: function (obj) {
            if (get.objtype(obj) == 'object') {
                var copy = {};
                for (var i in obj) {
                    copy[i] = get.copy(obj[i]);
                }
                return copy;
            }
            else if (Array.isArray(obj)) {
                var copy = [];
                for (var i = 0; i &lt; obj.length; i++) {
                    copy.push(get.copy(obj[i]));
                }
                return copy;
            }
            else {
                return obj;
            }
        },
        inpilefull: function (type) {
            var list = [];
            for (var i in lib.cardPile) {
                for (var j = 0; j &lt; lib.cardPile[i].length; j++) {
                    var info = lib.cardPile[i][j];
                    if (lib.inpile.contains(info[2]) &amp;&amp; get.type(info[2]) == type) {
                        list.push({
                            name: info[2],
                            suit: info[0],
                            number: info[1],
                            nature: info[3]
                        });
                    }
                }
            }
            return list;
        },
        inpile: function (type, filter) {
            var list = [];
            if (filter == 'trick') {
                for (var i = 0; i &lt; lib.inpile.length; i++) {
                    if (get.type(lib.inpile[i], 'trick') == type) list.push(lib.inpile[i]);
                }
            }
            else {
                for (var i = 0; i &lt; lib.inpile.length; i++) {
                    if (typeof type == 'function') {
                        if (type(lib.inpile[i])) {
                            list.push(lib.inpile[i]);
                        }
                    }
                    else {
                        if (typeof filter == 'function' &amp;&amp; !filter(lib.inpile[i])) continue;
                        if (type.indexOf('equip') == 0 &amp;&amp; type.length == 6) {
                            if (get.subtype(lib.inpile[i]) == type) list.push(lib.inpile[i]);
                        }
                        else {
                            if (get.type(lib.inpile[i]) == type) list.push(lib.inpile[i]);
                        }
                    }
                }
            }
            return list;
        },
        inpile2: function (type) {
            return get.inpile(type, 'trick');
        },
        typeCard: function (type, filter) {
            var list = [];
            for (var i in lib.card) {
                if (lib.card[i].mode &amp;&amp; lib.card[i].mode.contains(get.mode()) == false) continue;
                // if(lib.card[i].vanish||lib.card[i].destroy) continue;
                if (lib.card[i].destroy) continue;
                if (typeof filter == 'function' &amp;&amp; !filter(i)) continue;
                if (lib.config.bannedcards.contains(i)) continue;
                if (!lib.translate[i + '_info']) continue;
                if ((type.indexOf('equip') == 0 &amp;&amp; type.length == 6) ||
                    (type.indexOf('hslingjian') == 0 &amp;&amp; type.length == 11) ||
                    (type.indexOf('spell_') == 0)) {
                    if (get.subtype(i) == type) list.push(i);
                }
                else {
                    if (get.type(i) == type) list.push(i);
                }
            }
            return list;
        },
        libCard: function (filter) {
            var list = [];
            for (var i in lib.card) {
                if (lib.card[i].mode &amp;&amp; lib.card[i].mode.contains(get.mode()) == false) continue;
                // if(lib.card[i].vanish||lib.card[i].destroy) continue;
                if (lib.card[i].destroy) continue;
                if (lib.config.bannedcards.contains(i)) continue;
                if (!lib.translate[i + '_info']) continue;
                if (filter(lib.card[i], i)) {
                    list.push(i);
                }
            }
            return list;
        },
        ip: function () {
            if (!require) return '';
            var interfaces = require('os').networkInterfaces();
            for (var devName in interfaces) {
                var iface = interfaces[devName];
                for (var i = 0; i &lt; iface.length; i++) {
                    var alias = iface[i];
                    if (alias.family === 'IPv4' &amp;&amp; alias.address !== '127.0.0.1' &amp;&amp; !alias.internal) {
                        return alias.address;
                    }
                }
            }
        },
        modetrans: function (config, server) {
            if (config.mode == 'doudizhu') {
                switch (config.doudizhu_mode) {
                    case 'kaihei': return '';
                    case 'huanle': return '';
                    case 'binglin': return '';
                    case 'online': return '';
                    default: return '' + (config.double_character ? '' : '') + '';
                }
            }
            if (config.mode == 'longlaoguan') return '';
            if (config.mode == 'versus') {
                switch (config.versus_mode) {
                    case '1v1': return '';
                    case '2v2': return '';
                    case '3v3': return '';
                    case '4v4': return '';
                    case 'guandu': return '';
                }
            }
            else if (config.mode == 'single') {
                switch (config.single_mode) {
                    case 'normal': return '1v1';
                    case 'changban': return '';
                    case 'dianjiang': return '';
                }
            }
            else if (config.mode == 'identity') {
                switch (config.identity_mode) {
                    case 'purple': return '';
                    case 'zhong': return (config.double_character ? '' : '') + '';
                    default: return get.cnNumber(parseInt(config.number)) + '' + (config.double_character ? '' : '') + '';
                }
            }
            else if (config.mode == 'guozhan' &amp;&amp; config.guozhan_mode != 'normal') {
                switch (config.guozhan_mode) {
                    case 'yingbian': return '';
                    case 'old': return '';
                }
            }
            else {
                if (server) {
                    return get.translation(config.mode) + '';
                }
                else {
                    return get.cnNumber(parseInt(config.number)) + '' + get.translation(config.mode);
                }
            }
        },
        charactersOL: function (func) {
            var list = [];
            var libCharacter = {};
            for (var i = 0; i &lt; lib.configOL.characterPack.length; i++) {
                var pack = lib.characterPack[lib.configOL.characterPack[i]];
                for (var j in pack) {
                    if (typeof func == 'function' &amp;&amp; func(j)) continue;
                    if (lib.connectBanned.contains(j)) continue;
                    if (lib.configOL.protect_beginner &amp;&amp; get.is.banForBeginner(i)) return true;
                    if (lib.character[j]) libCharacter[j] = pack[j];
                }
            }
            for (i in libCharacter) {
                if (lib.filter.characterDisabled(i, libCharacter)) continue;
                list.push(i);
            }
            return list;
        },
        trimip: function (str) {
            var len = str.length - 5;
            if (str.lastIndexOf(':8080') == len) {
                str = str.slice(0, len);
            }
            return str;
        },
        /**
         * 
         * @returns {!string}
         */
        mode: function () {
            if (_status.connectMode) {
                return lib.configOL.mode;
            }
            else {
                return lib.config.mode;
            }
        },
        idDialog: function (id) {
            for (var i = 0; i &lt; ui.dialogs.length; i++) {
                if (ui.dialogs[i].videoId == id) {
                    return ui.dialogs[i];
                }
            }
            return null;
        },
        arenaState: function () {
            var state = {
                number: ui.arena.dataset.number,
                players: {},
                mode: _status.mode,
                dying: _status.dying,
                servermode: window.isNonameServer,
                roomId: game.roomId,
                over: _status.over,
                inpile: lib.inpile,
                cardtag: _status.cardtag,
            };
            for (var i in lib.playerOL) {
                state.players[i] = lib.playerOL[i].getState();
            }
            return state;
        },
        skillState: function (player) {
            var skills = {
                global: lib.skill.global
            };
            var skillinfo = {};
            for (var i in lib.playerOL) {
                skills[i] = {
                    skills: lib.playerOL[i].skills,
                    hiddenSkills: lib.playerOL[i].hiddenSkills,
                    additionalSkills: lib.playerOL[i].additionalSkills,
                    disabledSkills: lib.playerOL[i].disabledSkills,
                    tempSkills: lib.playerOL[i].tempSkills,
                    storage: lib.playerOL[i].storage,
                }
            }
            for (var i in lib.skill) {
                if (lib.skill[i].chooseButton &amp;&amp; lib.skill[i].enable) {
                    skillinfo[i] = lib.skill[i].chooseButton;
                }
            }
            skills.skillinfo = skillinfo;
            if (player) {
                skills.stat = player.getStat();
            }
            return skills;
        },
        /**
         * Id
         * @returns {!number} ID
         */
        id: function () {
            return (Math.floor(1000000 + 9000000 * Math.random())).toString() + (10 + lib.status.globalId++);
        },
        zhu: function (player, skill, unseen) {
            if (typeof player == 'string') {
                skill = player;
                player = null;
            }
            var mode = get.mode();
            if (mode == 'identity') {
                if (_status.mode == 'purple') {
                    if (!player) return null;
                    var zhu = game[player.identity.slice(0, 1) + 'Zhu'];
                    if (!zhu) return null;
                    if (skill &amp;&amp; !zhu.hasSkill(skill)) return null;
                    return zhu;
                }
                if (!game.zhu) return null;
                if (skill &amp;&amp; !game.zhu.hasSkill(skill)) return null;
                if (game.zhu.isZhu) return game.zhu;
            }
            else if (mode == 'versus' &amp;&amp; (_status.mode == 'four' || _status.mode == 'guandu')) {
                for (var i = 0; i &lt; game.players.length; i++) {
                    if (game.players[i].isZhu) {
                        if (skill &amp;&amp; !(game.players[i].hasSkill(skill))) continue;
                        if (!player) return game.players[i];
                        if (player.side == game.players[i].side) {
                            return game.players[i];
                        }
                    }
                }
            }
            else if (mode == 'guozhan') {
                for (var i = 0; i &lt; game.players.length; i++) {
                    if (get.is.jun(game.players[i]) &amp;&amp; !game.players[i].isUnseen()) {
                        if (skill &amp;&amp; !game.players[i].hasSkill(skill)) continue;
                        if (!player) return game.players[i];
                        if (player.identity == game.players[i].identity) {
                            return game.players[i];
                        }
                        else if (unseen &amp;&amp; player._group == game.players[i].identity) {
                            return game.players[i];
                        }
                    }
                }
            }
            return null;
        },
        config: function (item, mode) {
            mode = mode || lib.config.mode;
            if (!lib.config.mode_config[mode]) return;
            return lib.config.mode_config[mode][item];
        },
        coinCoeff: function (list) {
            var num = 0;
            for (var i = 0; i &lt; list.length; i++) {
                var rank = get.rank(list[i]);
                switch (rank) {
                    case 'sp': return 0.1;
                    case 's': num += 0.4; break;
                    case 'ap': num += 0.6; break;
                    case 'a': num += 0.8; break;
                    case 'am': num += 0.95; break;
                    case 'bp': num += 1.05; break;
                    case 'b': num += 1.2; break;
                    case 'bm': num += 1.4; break;
                    case 'c': num += 1.6; break;
                    case 'd': num += 1.8; break;
                }
            }
            return num / list.length;
        },
        rank: function (name, num) {
            if (typeof name == 'object' &amp;&amp; name.name) {
                name = name.name;
            }
            if (num == true) num = 9;
            if (typeof num != 'number') num = false;
            if (name == _status.lord) return num ? Math.round(7 * (num - 1) / 8 + 1) : 'ap';
            var rank = lib.rank;
            if (lib.characterPack.clubs[name] || lib.characterPack.vtuber[name] || lib.characterPack.yuzu[name] || lib.characterPack.hololive[name] || lib.characterPack.nijisanji[name]) {
                var skills;
                if (lib.character[name]) {
                    skills = lib.character[name][3];
                }
                else {
                    var tmpinfo = get.character(name);
                    if (tmpinfo) {
                        skills = tmpinfo[3];
                    }
                    else {
                        skills = [];
                    }
                }
                for (var i = 0; i &lt; skills.length; i++) {
                    if (skills[i].alter &amp;&amp; !lib.config.vintageSkills.contains(skills[i])) {
                        name = lib.rank.a[0]; break;
                    }
                }
            }
            if (rank.s.contains(name)) return num ? Math.round(8 * (num - 1) / 8 + 1) : 's';
            if (rank.ap.contains(name)) return num ? Math.round(7 * (num - 1) / 8 + 1) : 'ap';
            if (rank.a.contains(name)) return num ? Math.round(6 * (num - 1) / 8 + 1) : 'a';
            if (rank.am.contains(name)) return num ? Math.round(5 * (num - 1) / 8 + 1) : 'am';
            if (rank.bp.contains(name)) return num ? Math.round(4 * (num - 1) / 8 + 1) : 'bp';
            if (rank.b.contains(name)) return num ? Math.round(3 * (num - 1) / 8 + 1) : 'b';
            if (rank.bm.contains(name)) return num ? Math.round(2 * (num - 1) / 8 + 1) : 'bm';
            if (rank.c.contains(name)) return num ? Math.round(1 * (num - 1) / 8 + 1) : 'c';
            if (rank.d.contains(name)) return num ? Math.round(0 * (num - 1) / 8 + 1) : 'd';
            if (lib.character[name] &amp;&amp; lib.character[name][4]) {
                if (lib.character[name][4].contains('boss') ||
                    lib.character[name][4].contains('bossallowed') ||
                    lib.character[name][4].contains('hiddenboss')) {
                    return num ? Math.round(9 * (num - 1) / 8 + 1) : 'sp';
                }
            }
            return num ? Math.round(9 * (num - 1) / 8 + 1) : 'x';
        },
        skillRank: function (skill, type, grouped) {
            var info = lib.skill[skill];
            var player = _status.event.skillRankPlayer || _status.event.player;
            if (!info) return 0;
            if (info.ai) {
                if (info.ai.halfneg) return 0;
                if (typeof info.ai.combo == 'string' &amp;&amp; player &amp;&amp; !player.hasSkill(info.ai.combo)) {
                    return 0;
                }
                if (info.ai.neg) return -1;
            }
            var num = 1;
            var threaten = 1;
            if (info.ai &amp;&amp; info.ai.threaten) {
                if (typeof info.ai.threaten == 'number') {
                    threaten = info.ai.threaten;
                }
                else if (typeof info.ai.threaten == 'function' &amp;&amp; player) {
                    threaten = info.ai.threaten(player, player);
                }
            }
            if (type == 'in') {
                if (info.enable == 'phaseUse') num += 0.5;
                if (info.trigger &amp;&amp; info.trigger.player) {
                    var list = Array.isArray(info.trigger.player) ? info.trigger.player : [info.trigger.player];
                    var add = false;
                    for (var i of list) {
                        for (var j of lib.phaseName) {
                            if (i.indexOf[j] == 0) {
                                num += 0.5;
                                add = true;
                                break;
                            }
                        }
                        if (add) break;
                    }
                }
                if (info.trigger &amp;&amp; ((typeof info.trigger.player == 'string' &amp;&amp; info.trigger.player.indexOf('use') == 0) || info.trigger.source)) {
                    num += 0.3;
                }
                if (num > 1 &amp;&amp; threaten > 1) {
                    num += Math.sqrt(threaten) - 1;
                }
            }
            else if (type == 'out') {
                if (threaten &lt; 1) {
                    num = 1 / Math.sqrt(threaten);
                }
                if (info.trigger &amp;&amp; (info.trigger.global || info.trigger.target || (typeof info.trigger.player == 'string' &amp;&amp;
                    (info.trigger.player.indexOf('damage') == 0 || info.trigger.player.indexOf('lose') == 0)))) num += 0.1;
                if (info.ai) {
                    if (info.ai.maixie || info.ai.maixie_hp || info.ai.maixie_defend) {
                        num += 0.5;
                    }
                    if (info.ai.nolose || info.ai.noh || info.ai.noe || info.ai.nodiscard) {
                        num += 0.3;
                    }
                }
            }
            if (!grouped) {
                var groups = game.expandSkills([skill]);
                groups.remove(skill);
                var ggt = [];
                for (var i = 0; i &lt; groups.length; i++) {
                    var gi = get.skillRank(groups[i], type, true);
                    if (gi &lt; 0) {
                        num -= 0.5;
                    }
                    else if (gi > 1) {
                        ggt.push(gi);
                    }
                }
                if (ggt.length) {
                    num += Math.max.apply(this, ggt) - 1 + ggt.length / 20;
                }
            }
            return num;
        },
        targetsInfo: function (targets) {
            var info = [];
            for (var i = 0; i &lt; targets.length; i++) {
                info.push(targets[i].dataset.position);
            }
            return info;
        },
        infoTargets: function (info) {
            var targets = [];
            for (var i = 0; i &lt; info.length; i++) {
                targets.push(game.playerMap[info[i]]);
            }
            return targets;
        },
        cardInfo: function (card) {
            if (card.specialEffects) return [card.suit, card.number, card.name, card.nature, card.tags, card.specialEffects];
            else return [card.suit, card.number, card.name, card.nature, card.tags];
        },
        cardsInfo: function (cards) {
            var info = [];
            for (var i = 0; i &lt; cards.length; i++) {
                info.push(get.cardInfo(cards[i]));
            }
            return info;
        },
        infoCard: function (info) {
            var card = ui.create.card();
            if (info[0]) {
                card.init(info);
            }
            return card;
        },
        infoCards: function (info) {
            var cards = [];
            for (var i = 0; i &lt; info.length; i++) {
                cards.push(get.infoCard(info[i]));
            }
            return cards;
        },
        cardInfoOL: function (card) {
            return '_noname_card:' + JSON.stringify([card.cardid, card.suit, card.number, card.name, card.nature, card.tags, card.specialEffects]);
        },
        infoCardOL: function (info) {
            if (!lib.cardOL) return info;
            var card;
            try {
                var info = JSON.parse(info.slice(13));
                var id = info.shift();
                if (!id) {
                    card = ui.create.card();
                    if (info &amp;&amp; info[2]) card.init(info);
                }
                else if (lib.cardOL[id]) {
                    if (lib.cardOL[id].name != info[2]) {
                        if (info &amp;&amp; info[2]) lib.cardOL[id].init(info);
                    }
                    if (lib.cardOL[id].specialEffects != info[5]) {
                        if (info &amp;&amp; info[2]) lib.cardOL[id].init(info);
                    }
                    card = lib.cardOL[id];
                }
                else if (game.online) {
                    card = ui.create.card();
                    card.cardid = id;
                    if (info &amp;&amp; info[2]) card.init(info);
                    lib.cardOL[id] = card;
                }
            }
            catch (e) {
                console.log(e);
            }
            return card || info;
        },
        cardsInfoOL: function (cards) {
            var info = [];
            for (var i = 0; i &lt; cards.length; i++) {
                info.push(get.cardInfoOL(cards[i]));
            }
            return info;
        },
        infoCardsOL: function (info) {
            var cards = [];
            for (var i = 0; i &lt; info.length; i++) {
                cards.push(get.infoCardOL(info[i]));
            }
            return cards;
        },
        playerInfoOL: function (player) {
            return '_noname_player:' + player.playerid;
        },
        infoPlayerOL: function (info) {
            if (!lib.playerOL) return info
            return lib.playerOL[info.slice(15)] || info;
        },
        playersInfoOL: function (players) {
            var info = [];
            for (var i = 0; i &lt; players.length; i++) {
                info.push(get.playerInfoOL(players[i]));
            }
            return info;
        },
        infoPlayersOL: function (info) {
            var players = [];
            for (var i = 0; i &lt; info.length; i++) {
                players.push(get.infoPlayerOL(info[i]));
            }
            return players;
        },
        funcInfoOL: function (func) {
            if (typeof func == 'function') {
                if (func._filter_args) {
                    return '_noname_func:' + JSON.stringify(get.stringifiedResult(func._filter_args, 3));
                }
                return '_noname_func:' + func.toString();
            }
            return '';
        },
        infoFuncOL: function (info) {
            var func;
            try {
                eval('func=(' + info.slice(13) + ');');
            }
            catch (e) {
                return function () { };
            }
            if (Array.isArray(func)) {
                func = get.filter.apply(this, get.parsedResult(func));
            }
            return func;
        },
        eventInfoOL: function (item, level) {
            if (Object.prototype.toString.call(item) == '[object Object]') {
                var item2 = {};
                for (var i in item) {
                    if (i == '_trigger') {
                        if (level !== false) item2[i] = get.eventInfoOL(item[i], false);
                    }
                    else if (lib.element.event[i] || i == 'content' || get.itemtype(item[i]) == 'event') continue;
                    else item2[i] = get.stringifiedResult(item[i], level - 1);
                }
                return '_noname_event:' + JSON.stringify(item2);
            }
            else {
                return '';
            }
        },
        infoEventOL: function (item) {
            var evt;
            try {
                evt = JSON.parse(item.slice(14));
                for (var i in evt) {
                    evt[i] = get.parsedResult(evt[i]);
                }
                for (var i in lib.element.event) evt[i] = lib.element.event[i];
            }
            catch (e) {
                console.log(e);
            }
            return evt || item;
        },
        stringifiedResult: function (item, level) {
            if (!item) return item;
            if (typeof item == 'function') {
                return get.funcInfoOL(item);
            }
            else if (typeof item == 'object') {
                switch (get.itemtype(item)) {
                    case 'card': return get.cardInfoOL(item);
                    case 'cards': return get.cardsInfoOL(item);
                    case 'player': return get.playerInfoOL(item);
                    case 'players': return get.playersInfoOL(item);
                    case 'event': return get.eventInfoOL(item);
                    default:
                        if (typeof level != 'number') {
                            level = 5;
                        }
                        if (Array.isArray(item)) {
                            if (level == 0) {
                                return [];
                            }
                            var item2 = [];
                            for (var i = 0; i &lt; item.length; i++) {
                                item2.push(get.stringifiedResult(item[i], level - 1));
                            }
                            return item2;
                        }
                        else if (Object.prototype.toString.call(item) == '[object Object]') {
                            if (level == 0) {
                                return {};
                            }
                            var item2 = {};
                            for (var i in item) {
                                item2[i] = get.stringifiedResult(item[i], level - 1);
                            }
                            return item2;
                        }
                        else {
                            return {};
                        }
                }
            }
            else if (item === Infinity) {
                return '_noname_infinity';
            }
            else {
                return item;
            }
        },
        parsedResult: function (item) {
            if (!item) return item;
            if (typeof item == 'string') {
                if (item.indexOf('_noname_func:') == 0) {
                    return get.infoFuncOL(item);
                }
                else if (item.indexOf('_noname_card:') == 0) {
                    return get.infoCardOL(item);
                }
                else if (item.indexOf('_noname_player:') == 0) {
                    return get.infoPlayerOL(item);
                }
                else if (item.indexOf('_noname_event:') == 0) {
                    return get.infoEventOL(item);
                }
                else if (item == '_noname_infinity') {
                    return Infinity;
                }
                else {
                    return item;
                }
            }
            else if (Array.isArray(item)) {
                var item2 = [];
                for (var i = 0; i &lt; item.length; i++) {
                    item2.push(get.parsedResult(item[i]));
                }
                return item2;
            }
            else if (typeof item == 'object') {
                var item2 = {};
                for (var i in item) {
                    item2[i] = get.parsedResult(item[i]);
                }
                return item2;
            }
            else {
                return item;
            }
        },
        /**
         * 
         * `&lt;br>`
         * @function
         * @param {?string} 
         * @param {?boolean} sp 'SP'true'S''P'
         * @returns {!string} 
         * @example
         * get.verticalStr('Hello sP')
         * //result:
         * //"H&lt;br>E&lt;br>L&lt;br>L&lt;br>O&lt;br> &lt;br>S&lt;br>P"
         * get.verticalStr('Hello sP', true)
         * //result:
         * //"H&lt;br>E&lt;br>L&lt;br>L&lt;br>O&lt;br> &lt;br>SP"
         * get.verticalStr('`He`llo sP')
         * //result:
         * //"HEL&lt;br>L&lt;br>O&lt;br> &lt;br>S&lt;br>P"
         */
        verticalStr: function (str, sp) {
            if (typeof str != 'string') return '';
            str = str.toUpperCase();
            var str2 = '';
            var nobreak = false;
            for (var i = 0; i &lt; str.length; i++) {
                if (str[i] == '`') {
                    nobreak = !nobreak; continue;
                }
                if (str.slice(i, i + 4) == '&lt;BR>') { i += 3; continue; }
                str2 += str[i];
                if (nobreak) continue;
                if (sp &amp;&amp; str[i] == 'S' &amp;&amp; str[i + 1] == 'P') continue;
                if (/[0-9]/.test(str[i]) &amp;&amp; /[0-9]/.test(str[i + 1])) continue;
                if (i &lt; str.length - 1) {
                    str2 += '&lt;br>';
                }
            }
            return str2;
        },
        numStr: function (num, method) {
            if (num == Infinity) {
                if (method == 'card') return get.selectableCards().length + ui.selected.cards.length;
                if (method == 'target') return get.selectableTargets().length + ui.selected.targets.length;
                return '';
            }
            return num.toString();
        },
        rawName: function (str) {
            if (lib.translate[str + '_ab']) return lib.translate[str + '_ab'];
            var str2 = lib.translate[str];
            if (!str2) return '';
            if (str2.indexOf('SP') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('TW') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('OL') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('JSP') == 0) {
                str2 = str2.slice(3);
            }
            else if (str2.indexOf('SP') == 0) {
                str2 = str2.slice(3);
            }
            else if (str2.indexOf('') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; lib.characterPack.refresh &amp;&amp; lib.characterPack.refresh[str]) {
                str2 = str2.slice(1);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; (lib.characterPack.old || lib.characterPack.mobile) &amp;&amp; (lib.characterPack.old[str] || lib.characterPack.mobile[str])) {
                str2 = str2.slice(1);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; str.indexOf('re_') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; (str.indexOf('re_') == 0 || str.indexOf('new_') == 0)) {
                str2 = str2.slice(1);
            }
            return str2;
        },
        rawName2: function (str) {
            if (lib.translate[str + '_ab']) return lib.translate[str + '_ab'];
            var str2 = lib.translate[str];
            if (!str2) return '';
            if (str2.indexOf('SP') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('TW') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('OL') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('JSP') == 0) {
                str2 = str2.slice(3);
            }
            else if (str2.indexOf('SP') == 0) {
                str2 = str2.slice(3);
            }
            else if (str2.indexOf('') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; str.indexOf('re_') == 0) {
                str2 = str2.slice(2);
            }
            return str2;
        },
        slimName: function (str) {
            var str2 = lib.translate[str];
            if (lib.translate[str + '_ab']) str2 = lib.translate[str + '_ab'];
            if (!str2) return '';
            if (str2.indexOf('SP') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('TW') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('OL') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('JSP') == 0) {
                str2 = str2.slice(3);
            }
            else if (str2.indexOf('SP') == 0) {
                str2 = str2.slice(3);
            }
            else if (str2.indexOf('') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; str.indexOf('re_') == 0) {
                str2 = str2.slice(2);
            }
            else if (str2.indexOf('') == 0 &amp;&amp; str.indexOf('sp_') == 0) {
                str2 = str2.replace('','');
            }
            else if (str2.indexOf('') == 0 &amp;&amp; str.indexOf('sea_') == 0) {
                str2 = str2.replace('','');
            }
            else if (str2.indexOf('') == 0 &amp;&amp; lib.config.mode == 'guozhan' &amp;&amp; str.indexOf('gz_') == 0) {
                str2 = str2.slice(2);
            }
            return get.verticalStr(str2, true);
        },
        time: function () {
            if (lib.status.dateDelaying) {
                return lib.getUTC(lib.status.dateDelaying) - lib.getUTC(lib.status.date) - lib.status.dateDelayed;
            }
            else {
                return lib.getUTC(new Date()) - lib.getUTC(lib.status.date) - lib.status.dateDelayed;
            }
        },
        /**
         * datetime(`new Date().getTime()`)
         * @returns {number} datetime
         */
        utc: function () {
            return (new Date()).getTime();
        },
        evtDistance: function (e1, e2) {
            var dx = (e1.clientX - e2.clientX) / game.documentZoom;
            var dy = (e1.clientY - e2.clientY) / game.documentZoom;
            return Math.sqrt(dx * dx + dy * dy);
        },
        xyDistance: function (from, to) {
            return Math.sqrt((from[0] - to[0]) * (from[0] - to[0]) + (from[1] - to[1]) * (from[1] - to[1]));
        },
        /**
         * ((|))
         * @param {Object} obj 
         * @returns {?string} 
         */
        itemtype: function (obj) {
            var i, j;
            if (typeof obj == 'string') {
                if (obj.length &lt;= 4) {
                    var bool = true;
                    for (i = 0; i &lt; obj.length; i++) {
                        if (/h|e|j|s/.test(obj[i]) == false) {
                            bool = false; break;
                        }
                    }
                    if (bool) return 'position';
                }
                if (lib.nature.contains(obj)) return 'nature';
            }
            if (Array.isArray(obj) &amp;&amp; obj.length) {
                var isPlayers = true;
                for (i = 0; i &lt; obj.length; i++) {
                    if (get.itemtype(obj[i]) != 'player') { isPlayers = false; break; }
                }
                if (isPlayers) return 'players';

                var isCards = true;
                for (i = 0; i &lt; obj.length; i++) {
                    if (get.itemtype(obj[i]) != 'card') { isCards = false; break; }
                }
                if (isCards) return 'cards';

                if (obj.length == 2) {
                    if (typeof obj[0] == 'number' &amp;&amp; typeof obj[1] == 'number') {
                        if (obj[0] &lt;= obj[1] || obj[1] == -1) return 'select';
                    }
                }

                if (obj.length == 4) {
                    var isPosition = true;
                    for (i = 0; i &lt; obj.length; i++) {
                        if (typeof obj[i] != 'number') { isPosition = false; break; }
                    }
                    if (isPosition) return 'divposition';
                }
            }
            if (get.objtype(obj) == 'div') {
                if (obj.classList.contains('button')) return 'button';
                if (obj.classList.contains('card')) return 'card';
                if (obj.classList.contains('player')) return 'player';
                if (obj.classList.contains('dialog')) return 'dialog';
            }
            if (get.is.object(obj)) {
                if (obj.isMine == lib.element.event.isMine) return 'event';
            }
        },
        equipNum: function (card) {
            if (get.type(card) == 'equip') {
                return parseInt(get.subtype(card)[5]);
            }
            return 0;
        },
        /**
         * (ObjectDivTableTableRowTableCellBody)
         * @param {Object} obj 
         * @returns {?string} 
         */
        objtype: function (obj) {
            if (Object.prototype.toString.call(obj) === '[object Array]') return 'array';
            if (Object.prototype.toString.call(obj) === '[object Object]') return 'object';
            if (Object.prototype.toString.call(obj) === '[object HTMLDivElement]') return 'div';
            if (Object.prototype.toString.call(obj) === '[object HTMLTableElement]') return 'table';
            if (Object.prototype.toString.call(obj) === '[object HTMLTableRowElement]') return 'tr';
            if (Object.prototype.toString.call(obj) === '[object HTMLTableCellElement]') return 'td';
            if (Object.prototype.toString.call(obj) === '[object HTMLBodyElement]') return 'td';
        },
        type: function (obj, method, player) {
            if (typeof obj == 'string') obj = { name: obj };
            if (typeof obj != 'object') return;
            var name = get.name(obj, player);
            if (!lib.card[name]) return;
            if (method == 'trick' &amp;&amp; lib.card[name].type == 'delay') return 'trick';
            return lib.card[name].type;
        },
        type2: function (card, player) {
            return get.type(card, 'trick', player);
        },
        //
        type3: function (cards, method, player) {
            if (get.itemtype(cards) != 'cards') return;
            var types = [];
            for (var i of cards) {
                types.add(get.type(i, method, player));
            }
            return types;
        },
        subtype: function (obj) {
            if (typeof obj == 'string') obj = { name: obj };
            if (typeof obj != 'object') return;
            if (!lib.card[obj.name]) return;
            return lib.card[obj.name].subtype;
        },
        equiptype: function (card, player) {
            var subtype = get.subtype(card, player);
            if (subtype.indexOf('equip') == 0) return parseInt(subtype[5]);
            return 0;
        },
        /**
         * 
         * @name get.name
         * @function
         * @param {!GameCores.GameObjects.Card} card 
         * @param {boolean} [isCheckMod=true] true**cardname**false
         * @returns {?string} 
         */
        /**
         * 
         * @name get.name
         * @function
         * @variation 2
         * @param {!GameCores.GameObjects.Card} card 
         * @param {(GameCores.GameObjects.Player|false)} player **cardname**false
         * @returns {string} 
         */
        name: function (card, player) {
            if (get.itemtype(player) == 'player' || (player !== false &amp;&amp; get.position(card) == 'h')) {
                var owner = player || get.owner(card);
                if (owner) {
                    return game.checkMod(card, owner, card.name, 'cardname', owner);
                }
            }
            return card.name;
        },
        suit: function (card, player) {
            if (get.itemtype(card) == 'cards') {
                if (card.length == 1) return get.suit(card[0], player);
                return 'none';
                //var suit=get.suit(card[0])
                //for(var i=1;i&lt;card.length;i++){
                //    if(get.suit(card[i])!=suit) return 'none';
                //}
                //return suit;
            }
            else if (get.itemtype(card.cards) == 'cards' &amp;&amp; card.suit != 'none' &amp;&amp; !lib.suit.contains(card.suit)) {
                return get.suit(card.cards, player);
            }
            else {
                var owner = player || get.owner(card);
                if (owner) {
                    return game.checkMod(card, card.suit, 'suit', owner);
                }
                return card.suit;
            }
        },
        suit3: function (cards, player) {
            if (get.itemtype(cards) != 'cards') return [];
            var suits = [];
            for (var i of cards) {
                suits.add(get.suit(i, player));
            }
            return suits;
        },
        color: function (card, player) {
            if (_status.event.name == 'judge' &amp;&amp; card.color) return card.color;
            if (get.itemtype(card) == 'cards') {
                var color = get.color(card[0], player)
                for (var i = 1; i &lt; card.length; i++) {
                    if (get.color(card[i], player) != color) return 'none';
                }
                return color;
            }
            else if (get.itemtype(card.cards) == 'cards' &amp;&amp; card.suit != 'none' &amp;&amp; !lib.suit.contains(card.suit)) {
                return get.color(card.cards, player);
            }
            else {
                //
                var color = 'none'
                if (get.suit(card, player) == 'spade' || get.suit(card, player) == 'club') color = 'black';
                if (get.suit(card, player) == 'heart' || get.suit(card, player) == 'diamond') color = 'red';
                var owner = player || get.owner(card);
                if (owner) {
                    return game.checkMod(card, owner, color, 'color', owner);
                }
                return color;
            }
        },
        color3: function (cards, player) {
            if (get.itemtype(cards) != 'cards') return;
            var colors = [];
            for (var i of cards) {
                colors.add(get.color(i, player));
            }
            return colors;
        },
        number: function (card, player) {
            //
            var number = null;
            if (card.number &amp;&amp; typeof card.number == 'number') number = card.number;
            else if (card.cards &amp;&amp; card.cards.length == 1) number = get.number(card.cards[0]);
            if (number != null &amp;&amp; get.itemtype(player) == 'player' || (player !== false &amp;&amp; get.position(card) == 'h')) {
                var owner = player || get.owner(card);
                if (owner) {
                    return game.checkMod(card, owner, number, 'number', owner);
                }
            }
            return number;
        },
        /**
         * 
         * `cardnature`
         * @param {!GameCores.GameObjects.Card} card 
         * @param {(GameCores.GameObjects.Player|false|undefined)} [player] false
         * @returns {string}
         */
        nature: function (card, player) {
            if (get.itemtype(player) == 'player' || player !== false) {
                var owner = get.owner(card);
                if (owner) {
                    return game.checkMod(card, owner, card.nature, 'cardnature', owner);
                }
            }
            return card.nature;
        },
        /**
         * 
         * 
         * @param {number} num 
         * @returns {!Array&lt;GameCores.GameObjects.Card>}
         */
        cards: function (num) {
            if (_status.waitingForCards) {
                ui.create.cards.apply(ui.create, _status.waitingForCards);
                delete _status.waitingForCards;
            }
            var list = [];
            var card = false;
            if (typeof num != 'number') num = 1;
            if (num == 0) { card = true; num = 1; }
            if (num &lt; 0) num = 1;
            while (num--) {
                if (ui.cardPile.hasChildNodes() == false) {
                    if (_status.maxShuffle != undefined) {
                        if (_status.maxShuffle == 0) {
                            if (_status.maxShuffleCheck) {
                                game.over(_status.maxShuffleCheck());
                            }
                            else {
                                game.over('');
                            }
                            return [];
                        }
                        _status.maxShuffle--;
                    }
                    game.shuffleNumber++;
                    var cards = [], i;
                    for (var i = 0; i &lt; lib.onwash.length; i++) {
                        if (lib.onwash[i]() == 'remove') {
                            lib.onwash.splice(i--, 1);
                        }
                    }
                    if (_status.discarded) {
                        _status.discarded.length = 0;
                    }
                    for (i = 0; i &lt; ui.discardPile.childNodes.length; i++) {
                        var currentcard = ui.discardPile.childNodes[i];
                        currentcard.vanishtag.length = 0;
                        if (get.info(currentcard).vanish || currentcard.storage.vanish) {
                            currentcard.remove();
                            continue;
                        }
                        cards.push(currentcard);
                    }
                    cards.randomSort();
                    for (var i = 0; i &lt; cards.length; i++) {
                        ui.cardPile.appendChild(cards[i]);
                    }
                }
                if (ui.cardPile.hasChildNodes() == false) {
                    game.over('');
                    return [];
                }
                var cardx = ui.cardPile.removeChild(ui.cardPile.firstChild);
                cardx.original = 'c';
                list.push(cardx);
            }
            game.updateRoundNumber();
            if (card) return list[0];
            return list;
        },
        /**
         * `info.judge`(`viewAs`)`info.judge`
         * @param {GameCores.GameObjects.Card} card 
         * @returns {string}
         */
        judge: function (card) {
            if (card.viewAs) return lib.card[card.viewAs].judge;
            return get.info(card).judge;
        },
        /**
         * 
         * 0
         * `method`:
         * `method`:
         * **Chess Mode:**
         * 
         * |method|type|
         * |:----:|:--:|
         * |undefined||
         * |raw, pure, absolute||
         * **Stone Mode:**
         * 
         * |method|type|
         * |:----:|:--:|
         * |undefined||
         * |raw, pure, absolute|1|
         * **Others:**
         * 
         * |method|type|
         * |:----:|:--:|
         * |undefined|[^]|
         * |raw, pure||
         * |absolute|()|
         * |attack||
         * **** 10
         * **** `from`**globalFrom**`to`**globalTo**`from`**attackFrom**, `to`**attackTo**`from``to`()
         * @param {!GameCores.GameObjects.Player} from 
         * @param {!GameCores.GameObjects.Player} to 
         * @param {?string} method method
         * @returns {number} `from``to``Infinity``from==to`0
         */
        distance: function (from, to, method) {
            if (from == to) return 0;
            if (!game.players.contains(from) &amp;&amp; !game.dead.contains(from)) return Infinity;
            if (!game.players.contains(to) &amp;&amp; !game.dead.contains(to)) return Infinity;
            var player = from, m, n = 1, i;
            var fxy, txy;
            if (game.chess) {
                fxy = from.getXY();
                txy = to.getXY();
                n = Math.abs(fxy[0] - txy[0]) + Math.abs(fxy[1] - txy[1]);
                if (method == 'raw' || method == 'pure' || method == 'absolute') return n;
            }
            else if (to.isMin(true) || from.isMin(true)) {
                if (method == 'raw' || method == 'pure' || method == 'absolute') return n;
            }
            else {
                var length = game.players.length;
                var totalPopulation = game.players.length + game.dead.length + 1;
                for (var iwhile = 0; iwhile &lt; totalPopulation; iwhile++) {
                    if (player.nextSeat != to) {
                        player = player.nextSeat;
                        if (player.isAlive() &amp;&amp; !player.isOut() &amp;&amp; !player.hasSkill('undist') &amp;&amp; !player.isMin(true)) n++;
                    }
                    else {
                        break;
                    }
                }
                for (i = 0; i &lt; game.players.length; i++) {
                    if (game.players[i].isOut() || game.players[i].hasSkill('undist') || game.players[i].isMin(true)) length--;
                }
                if (method == 'absolute') return n;
                if (from.isDead()) length++;
                if (to.isDead()) length++;
                var left = from.hasSkillTag('left_hand');
                var right = from.hasSkillTag('right_hand');
                if (left === right) n = Math.min(n, length - n);
                else if (left == true) n = length - n;
                if (method == 'raw' || method == 'pure') return n;
            }

            n = game.checkMod(from, to, n, 'globalFrom', from);
            n = game.checkMod(from, to, n, 'globalTo', to);
            m = n;
            m = game.checkMod(from, to, m, 'attackFrom', from);
            m = game.checkMod(from, to, m, 'attackTo', to);
            var equips1 = from.getCards('e', function (card) {
                return !ui.selected.cards || !ui.selected.cards.contains(card);
            }), equips2 = to.getCards('e', function (card) {
                return !ui.selected.cards || !ui.selected.cards.contains(card);
            });
            for (i = 0; i &lt; equips1.length; i++) {
                var info = get.info(equips1[i]).distance;
                if (!info) continue;
                if (info.globalFrom) {
                    m += info.globalFrom;
                    n += info.globalFrom;
                }
                if (info.attackFrom) {
                    m += info.attackFrom;
                }
            }
            for (i = 0; i &lt; equips2.length; i++) {
                var info = get.info(equips2[i]).distance;
                if (!info) continue;
                if (info.globalTo) {
                    m += info.globalTo;
                    n += info.globalTo;
                }
                if (info.attaclTo) {//[recommend][bug] use attackTo instead of attaclTo
                    m += info.attaclTo;
                }
            }
            if (method == 'attack') return m;
            return n;
        },
        /**
         * 
         * @name get.info
         * @function
         * @param {?string} item IDundefined
         * @returns {?GameCores.GameObjects.SkillInfo} 
         */
        /**
         * 
         * @name get.info
         * @function
         * @variation 2
         * @param {!GameCores.GameObjects.Card} card (`card.name`)
         * @param {(GameCores.GameObjects.Player|boolean|undefined)} option `option`{@link game.name}{@link game.name(2)}
         * @returns {?GameCores.GameObjects.CardInfo} 
         */
        info: function (item, player) {
            if (typeof item == 'string') {
                return lib.skill[item];
            }
            if (typeof item == 'object') {
                var name = item.name;
                if (player !== false) name = get.name(item, player);
                return lib.card[name];
            }
        },
        /**
         * `[(number), (number)]`
         * @param {(number|Array&lt;number>|function():Array&lt;number>)} select `[select, select]``[(number), (number)]``select``[1, 1]`
         * @returns {Array&lt;number>} `[(number), (number)]`
         */
        select: function (select) {
            if (typeof select == 'number') return [select, select];
            if (get.itemtype(select) == 'select') return select;
            if (typeof select == 'function') return get.select(select());
            return [1, 1]
        },
        /**
         * 
         * `get.info(_status.event.skill).viewAs``viewAs8``viewAs``viewAs(ui.selected.cards, _status.event.player)`(`card`)`card`
         * `_status.event._get_card``_status.event._get_card`
         * @param {?boolean} [original] true`ui.selected.cards[0]`false`ui.selected.cards[0]`
         * @returns {?GameCores.GameObjects.Card} undefined
         */
        card: function (original) {
            if (_status.event.skill) {
                var card = get.info(_status.event.skill).viewAs;
                if (typeof card == 'function') card = card(ui.selected.cards, _status.event.player);
                if (card) {
                    return get.autoViewAs(card, ui.selected.cards, _status.event.player);
                }
            }
            if (_status.event._get_card) {
                return _status.event._get_card;
            }
            var card = ui.selected.cards[0];
            if (original) return card;
            if (card) {
                card = get.autoViewAs(card, ui.selected.cards, _status.event.player);
            }
            return card;
        },
        /**
         * 
         * @returns {GameCores.GameObjects.Player}
         */
        player: function () {
            return _status.event.player;
        },
        /**
         * 
         * @param {*} sort 
         * @param {*} dead 
         * @param {*} out 
         * @returns {Array&lt;GameCores.GameObjects.Player>}
         */
        //TODO
        players: function (sort, dead, out) {
            var players = game.players.slice(0);
            if (sort != false) {
                if (typeof sort == 'function') {
                    players.sort(sort);
                }
                else {
                    if (get.itemtype(sort) != 'player') lib.tempSortSeat = _status.event.player;
                    else lib.tempSortSeat = sort;
                    players.sort(lib.sort.seat);
                    delete lib.tempSortSeat;
                }
            }
            if (dead) players = players.concat(game.dead);
            if (!out) {
                for (var i = 0; i &lt; players.length; i++) {
                    if (players[i].isOut()) players.splice(i--, 1);
                }
            }
            return players;
        },
        /**
         * (|)
         * @param {*} card 
         * @param {*} ordering 
         * @returns {(number|'h'|'e'|'j'|'o'|'s'|'c'|'d'|null)}
         */
        //TODO
        position: function (card, ordering) {
            if (get.itemtype(card) == 'player') return parseInt(card.dataset.position);
            if (card.timeout &amp;&amp; card.destiny) {
                if (card.destiny.classList.contains('equips')) return 'e';
                if (card.destiny.classList.contains('judges')) return 'j';
                if (card.destiny.classList.contains('handcards')) return card.classList.contains('glows') ? 's' : 'h';
                if (card.destiny.id == 'cardPile') return 'c';
                if (card.destiny.id == 'discardPile') return 'd';
                if (card.destiny.id == 'special') return 's';
                if (card.destiny.id == 'ordering') return ordering ? 'o' : 'd';
                return null;
            }
            if (!card.parentNode) return;
            if (card.parentNode.classList.contains('equips')) return 'e';
            if (card.parentNode.classList.contains('judges')) return 'j';
            if (card.parentNode.classList.contains('handcards')) return card.classList.contains('glows') ? 's' : 'h';
            if (card.parentNode.id == 'cardPile') return 'c';
            if (card.parentNode.id == 'discardPile') return 'd';
            if (card.parentNode.id == 'special') return 's';
            if (card.parentNode.id == 'ordering') return ordering ? 'o' : 'd';
            return null;
        },
        skillTranslation: function (str, player) {
            var str2, str3;
            if (str.indexOf('re_') == 0) {
                str2 = str.slice(3);
                if (str2) {
                    if (lib.translate[str] == lib.translate[str2]) {
                        if (player.hasSkill(str2)) {
                            return '' + lib.translate[str];
                        }
                    }
                    str3 = 'mark_' + str2;
                    if (lib.translate[str3] &amp;&amp; lib.translate[str] == lib.translate[str3]) {
                        if (player.hasSkill(str3)) {
                            return '' + lib.translate[str];
                        }

                    }
                }
            }
            if (str.indexOf('re') == 0) {
                str2 = str.slice(2);
                if (str2) {
                    if (lib.translate[str] == lib.translate[str2]) {
                        if (player.hasSkill(str2)) {
                            return '' + lib.translate[str];
                        }
                    }
                }
            }
            else if (str.indexOf('xin') == 0) {
                str2 = str.slice(3);
                if (str2) {
                    if (lib.translate[str] == lib.translate[str2]) {
                        if (player.hasSkill(str2)) {
                            return '' + lib.translate[str];
                        }
                    }
                }
            }
            return get.translation(str);
        },
        skillInfoTranslation: function (name, player) {
            var str = lib.translate[name + '_info'];
            if (player &amp;&amp; lib.dynamicTranslate[name]) str = lib.dynamicTranslate[name](player, name);
            if (!str) return '';
            str = str
                .replace(/(|||||X)/g, '&lt;font style="font-weight:bold;color:#ddd">$1&lt;/font>')
                .replace(/ /g, '&lt;font color=#f77> &lt;/font>')
                .replace(/ /g, '&lt;font color=#fe2> &lt;/font>')
                .replace(/ /g, '&lt;font color=#fc2> &lt;/font>')
                .replace(/ /g, '&lt;font color=#8ae> &lt;/font>')
                .replace(/ /g, '&lt;font color=#baf> &lt;/font>')
                .replace(/ /g, '&lt;font color=#bf9> &lt;/font>')
                .replace(/ /g, '&lt;font color=#fcd> &lt;/font>')
                .replace(/ /g, '&lt;font color=#ff4> &lt;/font>')
            return str;
            // 	replace(//g,'&lt;span class="bluetext">&lt;/span>').
            // 	replace(//g,'&lt;span class="bluetext">&lt;/span>').
        },
        translation: function (str, arg) {
            if (str &amp;&amp; typeof str == 'object' &amp;&amp; (str.name || str._tempTranslate)) {
                if (str._tempTranslate) return str._tempTranslate;
                var str2;
                if (arg == 'viewAs' &amp;&amp; str.viewAs) {
                    str2 = get.translation(str.viewAs);
                }
                else {
                    str2 = get.translation(str.name);
                }
                if (str2.length == 1) {
                    if (str.nature == 'fire') {
                        str2 = '' + str2;
                    }
                    else if (str.nature == 'thunder') {
                        str2 = '' + str2;
                    }
                    else if (str.nature == 'kami') {
                        str2 = '' + str2;
                    }
                    else if (str.nature == 'ocean') {
                        str2 = '' + str2;
                    }
                    else if (str.nature == 'ice') {
                        str2 = '' + str2;
                    }
                    else if (str.nature == 'yami') {
                        str2 = '' + str2;
                    }
                } else if (str.nature &amp;&amp; str.nature.length) {
                    if (str.nature == 'fire') {
                        str2 = str2.replace(str2.charAt(0), '');
                    }
                    else if (str.nature == 'thunder') {
                        str2 = str2.replace(str2.charAt(0), '');
                    }
                    else if (str.nature == 'kami') {
                        str2 = str2.replace(str2.charAt(0), '');
                    }
                    else if (str.nature == 'ocean') {
                        str2 = str2.replace(str2.charAt(0), '');
                    }
                    else if (str.nature == 'ice') {
                        str2 = str2.replace(str2.charAt(0), '');
                    }
                    else if (str.nature == 'yami') {
                        str2 = str2.replace(str2.charAt(0), '');
                    }
                }
                if (get.itemtype(str) == 'card' || str.isCard) {
                    if (_status.cardtag &amp;&amp; str.cardid) {
                        var tagstr = '';
                        for (var i in _status.cardtag) {
                            if (_status.cardtag[i].contains(str.cardid)) {
                                tagstr += lib.translate[i + '_tag'];
                            }
                        }
                        if (tagstr) {
                            str2 += '' + tagstr;
                        }
                    }
                    if (str.suit &amp;&amp; str.number) {
                        var cardnum = str.number || '';
                        if ([1, 11, 12, 13, 14].contains(cardnum)) {
                            cardnum = { '1': 'A', '11': 'J', '12': 'Q', '13': 'K', '14': '' }[cardnum]
                        }
                        if (arg == 'viewAs' &amp;&amp; str.viewAs != str.name &amp;&amp; str.viewAs) {
                            str2 += '' + get.translation(str) + '';
                        }
                        else {
                            str2 += '' + get.translation(str.suit) + cardnum + '';
                            // var len=str2.length-1;
                            // str2=str2.slice(0,len)+'&lt;span style="letter-spacing: -2px">'+str2[len]+'&lt;/span>'+get.translation(str.suit)+str.number;
                        }
                    }
                }
                return str2;
            }
            if (Array.isArray(str)) {
                var str2 = get.translation(str[0], arg);
                for (var i = 1; i &lt; str.length; i++) {
                    str2 += '' + get.translation(str[i], arg);
                }
                return str2;
            }
            if (arg == 'skill') {
                if (lib.translate[str + '_ab']) return lib.translate[str + '_ab'];
                if (lib.translate[str]) return lib.translate[str].slice(0, 2);
                return str;
            }
            else if (arg == 'info') {
                if (lib.translate[str + '_info']) return lib.translate[str + '_info'];
                var str2 = str.slice(0, str.length - 1);
                if (lib.translate[str2 + '_info']) return lib.translate[str2 + '_info'];
                if (str.lastIndexOf('_') > 0) {
                    str2 = str.slice(0, str.lastIndexOf('_'));
                    if (lib.translate[str2 + '_info']) return lib.translate[str2 + '_info'];
                }
                str2 = str.slice(0, str.length - 2);
                if (lib.translate[str2 + '_info']) return lib.translate[str2 + '_info'];
                if (lib.skill[str] &amp;&amp; lib.skill[str].prompt) return lib.skill[str].prompt;
            }
            if (lib.translate[str]) {
                return lib.translate[str];
            }
            if (typeof str == 'string') {
                return str;
            }
            if (typeof str == 'number' || typeof str == 'boolean') {
                return str.toString();
            }
            if (str &amp;&amp; str.toString) {
                return str.toString();
            }
            return '';
        },
        strNumber: function (num) {
            switch (num) {
                case 1: return 'A';
                case 11: return 'J';
                case 12: return 'Q';
                case 13: return 'K';
                case 14: return '';
                default: return num.toString();
            }
        },
        cnNumber: function (num, two) {
            if (num == Infinity) return '';
            if (isNaN(num)) return '';
            if (typeof num != 'number') return num;
            if (num &lt; 0 || num > 99) return num;
            if (num &lt;= 10) {
                switch (num) {
                    case 0: return '';
                    case 1: return '';
                    case 2: return two ? '' : '';
                    case 3: return '';
                    case 4: return '';
                    case 5: return '';
                    case 6: return '';
                    case 7: return '';
                    case 8: return '';
                    case 9: return '';
                    case 10: return '';
                }
            }
            if (num &lt; 20) {
                return '' + get.cnNumber(num - 10, true);
            }
            var x = Math.floor(num / 10);
            return get.cnNumber(x, true) + '' + (num > 10 * x ? get.cnNumber(num - 10 * x, true) : '');
        },
        selectableButtons: function (sort) {
            if (!_status.event.player) return [];
            var buttons = _status.event.dialog.buttons;
            var selectable = [];
            for (var i = 0; i &lt; buttons.length; i++) {
                if (buttons[i].classList.contains('selectable') &amp;&amp;
                    buttons[i].classList.contains('selected') == false) {
                    selectable.push(buttons[i]);
                }
            }
            if (sort) {
                selectable.sort(sort);
            }
            return selectable;
        },
        selectableCards: function (sort) {
            if (!_status.event.player) return [];
            var cards = _status.event.player.getCards('hes');
            var selectable = [];
            for (var i = 0; i &lt; cards.length; i++) {
                if (cards[i].classList.contains('selectable') &amp;&amp;
                    cards[i].classList.contains('selected') == false) {
                    selectable.push(cards[i]);
                }
            }
            if (sort) {
                selectable.sort(sort);
            }
            return selectable;
        },
        skills: function () {
            var skills = [];
            if (ui.skills) {
                skills = skills.concat(ui.skills.skills);
            }
            if (ui.skills2) {
                skills = skills.concat(ui.skills2.skills);
            }
            if (ui.skills3) {
                skills = skills.concat(ui.skills3.skills);
            }
            return skills;
        },
        /**
         * 
         * @param {?Function} func 
         * @param {?HTMLDivElement} player 
         * @returns {!Array&lt;string>}
         */
        gainableSkills: function (func, player) {
            var list = [];
            for (var i in lib.character) {
                if (lib.filter.characterDisabled(i)) continue;
                if (lib.filter.characterDisabled2(i)) continue;
                if (lib.character[i][4]) {
                    if (lib.character[i][4].contains('boss')) continue;
                    if (lib.character[i][4].contains('hiddenboss')) continue;
                    if (lib.character[i][4].contains('minskin')) continue;
                    if (lib.character[i][4].contains('unseen')) continue;
                }
                for (var j = 0; j &lt; lib.character[i][3].length; j++) {
                    var skill = lib.character[i][3][j];
                    var info = lib.skill[skill];
                    if (lib.filter.skillDisabled(skill)) continue;
                    if (func &amp;&amp; !func(info, skill, i)) continue;
                    if (player &amp;&amp; player.hasSkill &amp;&amp; info.ai &amp;&amp; info.ai.combo &amp;&amp; !player.hasSkill(info.ai.combo)) continue;
                    list.add(skill);
                }
            }
            return list;
        },
        /**
         * 
         * @param {!string} name 
         * @param {?Function} func 
         * @returns {!Array&lt;string>}
         */
        gainableSkillsName: function (name, func) {
            var list = [];
            if (name &amp;&amp; lib.character[name]) {
                if (lib.character[name][4]) {
                    if (lib.character[name][4].contains('boss')) return list;
                    if (lib.character[name][4].contains('hiddenboss')) return list;
                    if (lib.character[name][4].contains('minskin')) return list;
                    if (lib.character[name][4].contains('unseen')) return list;
                }
                for (var j = 0; j &lt; lib.character[name][3].length; j++) {
                    var skill = lib.character[name][3][j];
                    var info = lib.skill[skill];
                    if (lib.filter.skillDisabled(skill)) continue;
                    if (func &amp;&amp; !func(info, skill, name)) continue;
                    list.add(skill);
                }
            }
            return list;
        },
        /**
         * 
         * @param {?Function} func 
         * @returns {!Array&lt;string>}
         */
        gainableCharacters: function (func) {
            var list = [];
            for (var i in lib.character) {
                var info = lib.character[i];
                if (!info) continue;
                if (typeof func == 'function' &amp;&amp; !func(info, i)) continue;
                if (lib.filter.characterDisabled(i)) continue;
                if (lib.filter.characterDisabled2(i)) continue;
                list.push(i);
            }
            if (func === true) {
                var players = game.players.concat(game.dead);
                for (var i = 0; i &lt; players.length; i++) {
                    list.remove(players[i].name);
                    list.remove(players[i].name1);
                    list.remove(players[i].name2);
                }
            }
            return list;
        },
        selectableTargets: function (sort) {
            var selectable = [];
            var players = game.players.slice(0);
            if (_status.event.deadTarget) players.addArray(game.dead);
            for (var i = 0; i &lt; players.length; i++) {
                if (players[i].classList.contains('selectable') &amp;&amp;
                    players[i].classList.contains('selected') == false) {
                    selectable.push(players[i]);
                }
            }
            selectable.randomSort();
            if (sort) {
                selectable.sort(sort);
            }
            return selectable;
        },
        //()
        filter: function (filter, i) {
            if (typeof filter == 'function') return filter;
            if (i == undefined) i = 0;
            var result = function () {
                if (filter == arguments[i]) return true;
                for (var j in filter) {
                    if (filter.hasOwnProperty(j)) {
                        if (get.itemtype(arguments[i]) == 'card') {
                            if (j == 'name') {
                                if (typeof filter[j] == 'object') {
                                    if (filter[j].contains(get.name(arguments[i])) == false) return false;
                                }
                                else if (typeof filter[j] == 'string') {
                                    if (get.name(arguments[i]) != filter[j]) return false;
                                }
                            }
                            else if (j == 'type') {
                                if (typeof filter[j] == 'object') {
                                    if (filter[j].contains(get.type(arguments[i])) == false) return false;
                                }
                                else if (typeof filter[j] == 'string') {
                                    if (get.type(arguments[i]) != filter[j]) return false;
                                }
                            }
                            else if (j == 'subtype') {
                                if (typeof filter[j] == 'object') {
                                    if (filter[j].contains(get.subtype(arguments[i])) == false) return false;
                                }
                                else if (typeof filter[j] == 'string') {
                                    if (get.subtype(arguments[i]) != filter[j]) return false;
                                }
                            }
                            else if (['color', 'suit', 'number'].contains(j)) {
                                if (typeof filter[j] == 'object') {
                                    if (filter[j].contains(get[j](arguments[i])) == false) return false;
                                }
                                else if (typeof filter[j] == 'string') {
                                    if (get[j](arguments[i]) != filter[j]) return false;
                                }
                            }
                            else if (typeof filter[j] == 'object') {
                                if (filter[j].contains(arguments[i][j]) == false) return false;
                            }
                            else if (typeof filter[j] == 'string') {
                                if (typeof get[j] == 'function') {
                                    if (get[j](arguments[i]) != filter[j]) return false;
                                }
                                else if (arguments[i][j] != filter[j]) return false;
                            }
                        }
                        else {
                            if (arguments[i][j] != filter[j]) return false;
                        }
                    }
                }
                return true;
            }
            result._filter_args = [filter, i];
            return result;
        },
        cardCount: function (card, player) {
            var num;
            if (card == true) {
                num = 0;
                var stat = player.getStat('card');
                for (var i in stat) {
                    if (typeof stat[i] == 'number') num += stat[i];
                }
                return num;
            }
            if (player == undefined) player = _status.event.player;
            if (typeof card == 'object') {
                card = card.name;
            }
            num = player.getStat('card')[card];
            if (num == undefined) return 0;
            return num;
        },
        skillCount: function (skill, player) {
            if (player == undefined) player = _status.event.player;
            var num = player.getStat('skill')[skill];
            if (num == undefined) return 0;
            return num;
        },
        owner: function (card, method) {
            var list = game.players.concat(game.dead);
            for (var i = 0; i &lt; list.length; i++) {
                if (list[i].getCards('hej').contains(card)) return list[i];
                if (list[i].judging[0] == card &amp;&amp; method != 'judge') return list[i];
            }
            //for(var i=0;i&lt;game.players.length;i++){
            //    if(game.players[i].using&amp;&amp;game.players[i].using.contains(card)) return game.players[i];
            //}
        },
        noSelected: function () {
            return (ui.selected.buttons.length + ui.selected.cards.length + ui.selected.targets.length == 0)
        },
        population: function (identity) {
            if (identity == undefined) return game.players.length + game.dead.length;
            var i;
            var num = 0;
            for (i = 0; i &lt; game.players.length; i++) {
                if (game.players[i].identity == identity) num++;
            }
            return num;
        },
        totalPopulation: function (identity) {
            if (identity == undefined) return game.players.length + game.dead.length;
            var i, players = game.players.concat(game.dead);
            var num = 0;
            for (i = 0; i &lt; players.length; i++) {
                if (players[i].identity == identity) num++;
            }
            return num;
        },
        //
        cardtag: function (item, tag) {
            if (item.cardid &amp;&amp; (get.itemtype(item) == 'card' || !item.cards || !item.cards.length || item.name == item.cards[0].name) &amp;&amp; _status.cardtag &amp;&amp; _status.cardtag[tag] &amp;&amp; _status.cardtag[tag].contains(item.cardid)) {
                return true;
            }
            if (item.cardtags &amp;&amp; item.cardtags.contains(tag)) return true;
            return false;
        },
        tag: function (item, tag, item2) {
            var result;
            if (get.info(item) &amp;&amp; get.info(item).ai &amp;&amp; get.info(item).ai.tag) {
                result = get.info(item).ai.tag[tag];
            }
            if (typeof result == 'function') return result(item, item2);
            return result;
        },
        sortCard: function (sort) {
            var func;
            if (sort == 'type_sort') {
                func = function (card) {
                    var type = get.type(card);
                    var subtype = get.subtype(card);
                    if (lib.cardType[subtype]) {
                        return lib.cardType[subtype];
                    }
                    if (lib.cardType[type]) {
                        return lib.cardType[type];
                    }
                    switch (type) {
                        case 'basic': return 2;
                        case 'chess': return 1.5;
                        case 'trick': return -1;
                        case 'delay': return -2;
                        case 'equip': return -3;
                        default: return -4;
                    }
                }
            }
            else if (sort == 'suit_sort') {
                func = function (card) {
                    if (get.suit(card) == 'heart') return 2;
                    if (get.suit(card) == 'diamond') return 1;
                    if (get.suit(card) == 'spade') return -1;
                    if (get.suit(card) == 'club') return -2;
                }
            }
            else if (sort == 'number_sort') {
                func = function (card) {
                    return get.number(card) - 7 + 0.5;
                }
            }
            return func;
        },
        difficulty: function () {
            switch (get.config('difficulty')) {
                case 'easy': return 1;
                case 'normal': return 2;
                case 'hard': return 3;
                default: return 1;
            }
        },
        cardPile: function (name, create) {
            var filter = function (card) {
                if (typeof name == 'string') {
                    if (card.name == name) {
                        return true;
                    }
                }
                else if (typeof name == 'function') {
                    if (name(card)) {
                        return true;
                    }
                }
                return false;
            };
            if (create != 'discardPile') {
                for (var i = 0; i &lt; ui.cardPile.childNodes.length; i++) {
                    if (filter(ui.cardPile.childNodes[i])) {
                        return ui.cardPile.childNodes[i];
                    }
                }
            }
            if (create != 'cardPile') {
                for (var i = 0; i &lt; ui.discardPile.childNodes.length; i++) {
                    if (filter(ui.discardPile.childNodes[i])) {
                        return ui.discardPile.childNodes[i];
                    }
                }
            }
            if (create == 'field') {
                var found = null;
                game.findPlayer(function (current) {
                    var ej = current.getCards('ej');
                    for (var i = 0; i &lt; ej.length; i++) {
                        if (filter(ej[i])) {
                            found = ej[i];
                            return true;
                        }
                    }
                });
                return found;
            }
            if (create &amp;&amp; !['cardPile', 'discardPile', 'field'].contains(create)) {
                return game.createCard(name);
            }
            return null;
        },
        cardPile2: function (name) {
            return get.cardPile(name, 'cardPile');
        },
        discardPile: function (name) {
            return get.cardPile(name, 'discardPile');
        },
        aiStrategy: function () {
            switch (get.config('ai_strategy')) {
                case 'ai_strategy_1': return 1;
                case 'ai_strategy_2': return 2;
                case 'ai_strategy_3': return 3;
                case 'ai_strategy_4': return 4;
                case 'ai_strategy_5': return 5;
                case 'ai_strategy_6': return 6;
                default: return 1;
            }
        },
        skillintro: function (name, learn, learn2) {
            var str = '';
            var infoitem = lib.character[name];
            if (!infoitem) {
                for (var itemx in lib.characterPack) {
                    if (lib.characterPack[itemx][name]) {
                        infoitem = lib.characterPack[itemx][name]; break;
                    }
                }
            }
            var skills = infoitem[3];
            var opacity;
            for (var i = 0; i &lt; skills.length; i++) {
                if (lib.translate[skills[i]] &amp;&amp; lib.translate[skills[i] + '_info'] &amp;&amp; lib.skill[skills[i]]) {
                    if (learn &amp;&amp; lib.skill[skills[i]].unique &amp;&amp; (learn2 || !lib.skill[skills[i]].gainable)) {
                        opacity = 'opacity:0.5';
                    }
                    else {
                        opacity = '';
                    }
                    var skilltrans = get.translation(skills[i]).slice(0, 2);
                    str += '&lt;div class="skill" style="' + opacity +
                        '">' + skilltrans + '&lt;/div>&lt;div style="' + opacity + '">' +
                        get.skillInfoTranslation(skills[i]) + '&lt;/div>&lt;div style="display:block;height:10px">&lt;/div>';
                }
            }
            return str;
        },
        intro: function (name) {
            var info = lib.character[name];
            var str = '' + get.translation(info[0]) + '&lt;br/>';
            str += '' + get.translation(info[1]) + '&lt;br/>';
            str += '' + get.translation(info[2]) + '&lt;br/>';
            str += '';
            if (info[3].length) {
                str += get.translation(info[3][0]);
                for (var i = 1; i &lt; info[3].length; i++) {
                    str += '' + get.translation(info[3][i]);
                }
            }
            return str;
        },
        storageintro: function (type, content, player, dialog, skill) {
            switch (type) {
                case 'mark': {
                    if (content > 0) {
                        return '' + content + '';
                    }
                    return false;
                }
                case 'turn': {
                    if (content > 0) {
                        return '' + content + '';
                    }
                    return false;
                }
                case 'time': {
                    if (content > 0) {
                        return '' + content + '';
                    }
                    return false;
                }
                case 'limited': {
                    if (content) {
                        return '';
                    }
                    return '';
                }
                case 'info': {
                    return lib.translate[skill + '_info'];
                }
                case 'cardCount': {
                    if (typeof content == 'object' &amp;&amp; typeof content.length == 'number') {
                        return '' + get.cnNumber(content.length) + '';
                    }
                    return false;
                }
                case 'card': case 'cards': {
                    if (get.itemtype(content) == 'card') {
                        content = [content];
                    }
                    if (dialog &amp;&amp; get.itemtype(content) == 'cards') {
                        dialog.addAuto(content);
                    }
                    else {
                        if (content &amp;&amp; content.length) {
                            return get.translation(content);
                        }
                    }
                    if (Array.isArray(content) &amp;&amp; !content.length) {
                        return '';
                    }
                    return false;
                }
                case 'player': case 'players': {
                    if (get.itemtype(content) == 'player') {
                        content = [content];
                    }
                    if (dialog &amp;&amp; get.itemtype(content) == 'players') {
                        dialog.addAuto(content);
                        return false;
                    }
                    else {
                        if (content &amp;&amp; content.length) {
                            return get.translation(content);
                        }
                        return false;
                    }
                }
                case 'character': case 'characters': {
                    if (typeof content == 'string') {
                        content = [content];
                    }
                    if (dialog &amp;&amp; Array.isArray(content)) {
                        dialog.addAuto([content, 'character']);
                        return false;
                    }
                    else {
                        if (content &amp;&amp; content.length) {
                            return get.translation(content);
                        }
                        return false;
                    }
                }
                default: {
                    if (typeof type == 'string') {
                        type = type.replace(/#/g, content);
                        type = type.replace(/&amp;/g, get.cnNumber(content));
                        type = type.replace(/\$/g, get.translation(content));
                        return type;
                    }
                    else if (typeof type == 'function') {
                        return type(content, player, skill);
                    }
                    return false;
                }
            }
        },
        /**
         * (: [, ])|(: , [, ])
         * @name get.nodeintro
         * @function
         * @param {!HTMLDivElement} node 
         * @returns {!HTMLDivElement} 
         * @see {@link lib.setIntro}
         */
        nodeintro: function (node, simple, evt) {
            var uiintro = ui.create.dialog('hidden', 'notouchscroll');
            if (node.classList.contains('player') &amp;&amp; !node.name) {
                return uiintro;
            }
            var i, translation, intro, str;
            if (node._nointro) return;
            if (typeof node._customintro == 'function') {
                if (node._customintro(uiintro) === false) return;
            }
            else if (Array.isArray(node._customintro)) {
                var caption = node._customintro[0];
                var content = node._customintro[1];
                if (typeof caption == 'function') {
                    caption = caption(node);
                }
                if (typeof content == 'function') {
                    content = content(node);
                }
                uiintro.add(caption);
                uiintro.add('&lt;div class="text center" style="padding-bottom:5px">' + content + '&lt;/div>');
            }
            else if (node.classList.contains('player') || node.linkplayer) {
                if (node.linkplayer) {
                    node = node.link;
                }
                var capt = get.translation(node.name);
                if ((lib.character[node.name] &amp;&amp; lib.character[node.name][1]) || lib.group.contains(node.group)) {
                    capt += '&amp;nbsp;&amp;nbsp;' + (lib.group.contains(node.group) ? (lib.translate[node.group + '2'] ? get.translation(node.group + '2') : get.translation(node.group)) : lib.translate[lib.character[node.name][1]]);
                }
                uiintro.add(capt);

                if (lib.characterTitle[node.name]) {
                    uiintro.addText(get.colorspan(lib.characterTitle[node.name]));
                }

                if (true) {
                    var hs = node.getCards('h');
                    if (hs.length) {
                        var ms = [];
                        if (node.isUnderControl() || (!game.observe &amp;&amp; game.me &amp;&amp; game.me.hasSkillTag('viewHandcard', null, node, true))) {
                            ms.addArray(hs);
                        }
                        for (var i = 0; i &lt; hs.length; i++) {
                            if (hs[i].hasGaintag('ming_')) ms.add(hs[i]);
                            if (hs[i].hasGaintag('an_')) ms.remove(ms[i]);
                        }
                        if (ms.length) {
                            uiintro.add('&lt;div class="text center">&lt;/div>');
                            uiintro.addSmall(ms);
                        }
                    }
                }

                var skills = node.getSkills(null, null, false).slice(0);
                var skills2 = game.filterSkills(skills, node);
                if (node == game.me &amp;&amp; node.hiddenSkills.length) {
                    skills.addArray(node.hiddenSkills);
                }
                for (var i in node.disabledSkills) {
                    if (node.disabledSkills[i].length == 1 &amp;&amp;
                        node.disabledSkills[i][0] == i + '_awake' &amp;&amp;
                        !node.hiddenSkills.contains(i)) {
                        skills.add(i);
                    }
                }
                for (i = 0; i &lt; skills.length; i++) {
                    if (lib.skill[skills[i]] &amp;&amp; (lib.skill[skills[i]].nopop || lib.skill[skills[i]].equipSkill)) continue;
                    if (lib.translate[skills[i] + '_info']) {
                        translation = lib.translate[skills[i] + '_ab'] || get.translation(skills[i]).slice(0, 5);
                        if (node.forbiddenSkills[skills[i]]) {
                            var forbidstr = '&lt;div style="opacity:0.5">&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>';
                            if (node.forbiddenSkills[skills[i]].length) {
                                forbidstr += '' + get.translation(node.forbiddenSkills[skills[i]]) + '&lt;br>';
                            }
                            else {
                                forbidstr += '&lt;br>';
                            }
                            forbidstr += get.skillInfoTranslation(skills[i], node) + '&lt;/div>&lt;/div>'
                            uiintro.add(forbidstr);
                        }
                        else if (!skills2.contains(skills[i])) {
                            uiintro.add('&lt;div style="opacity:0.5">&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;/div>&lt;/div>');
                        }
                        else if (lib.skill[skills[i]].temp || !node.skills.contains(skills[i]) || lib.skill[skills[i]].thundertext) {
                            if (lib.skill[skills[i]].frequent || lib.skill[skills[i]].subfrequent) {
                                uiintro.add('&lt;div>&lt;div class="skill thundertext thunderauto">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext thundertext thunderauto"' : ' class="thundertext thunderauto"') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;br>&lt;div class="underlinenode on gray" style="position:relative;padding-left:0;padding-top:7px">&lt;/div>&lt;/div>&lt;/div>');
                                var underlinenode = uiintro.content.lastChild.querySelector('.underlinenode');
                                if (lib.skill[skills[i]].frequent) {
                                    if (lib.config.autoskilllist.contains(skills[i])) {
                                        underlinenode.classList.remove('on');
                                    }
                                }
                                if (lib.skill[skills[i]].subfrequent) {
                                    for (var j = 0; j &lt; lib.skill[skills[i]].subfrequent.length; j++) {
                                        if (lib.config.autoskilllist.contains(skills[i] + '_' + lib.skill[skills[i]].subfrequent[j])) {
                                            underlinenode.classList.remove('on');
                                        }
                                    }
                                }
                                if (lib.config.autoskilllist.contains(skills[i])) {
                                    underlinenode.classList.remove('on');
                                }
                                underlinenode.link = skills[i];
                                underlinenode.listen(ui.click.autoskill2);
                            }
                            else {
                                uiintro.add('&lt;div>&lt;div class="skill thundertext thunderauto">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext thundertext thunderauto"' : ' class="thundertext thunderauto"') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;/div>&lt;/div>');
                            }
                        }
                        else if (lib.skill[skills[i]].frequent || lib.skill[skills[i]].subfrequent) {
                            uiintro.add('&lt;div>&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;br>&lt;div class="underlinenode on gray" style="position:relative;padding-left:0;padding-top:7px">&lt;/div>&lt;/div>&lt;/div>');
                            var underlinenode = uiintro.content.lastChild.querySelector('.underlinenode');
                            if (lib.skill[skills[i]].frequent) {
                                if (lib.config.autoskilllist.contains(skills[i])) {
                                    underlinenode.classList.remove('on');
                                }
                            }
                            if (lib.skill[skills[i]].subfrequent) {
                                for (var j = 0; j &lt; lib.skill[skills[i]].subfrequent.length; j++) {
                                    if (lib.config.autoskilllist.contains(skills[i] + '_' + lib.skill[skills[i]].subfrequent[j])) {
                                        underlinenode.classList.remove('on');
                                    }
                                }
                            }
                            if (lib.config.autoskilllist.contains(skills[i])) {
                                underlinenode.classList.remove('on');
                            }
                            underlinenode.link = skills[i];
                            underlinenode.listen(ui.click.autoskill2);
                        }
                        else if (lib.skill[skills[i]].clickable &amp;&amp; node.isIn() &amp;&amp; node.isUnderControl(true)) {
                            if (lib.skill[skills[i]].clickChange) {
                                var intronode = uiintro.add('&lt;div>&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;br>&lt;div class="menubutton skillbutton" style="position:relative;margin-top:5px">' + lib.skill[skills[i]].clickChange + '&lt;/div>&lt;/div>&lt;/div>').querySelector('.skillbutton');
                                if (!_status.gameStarted || (lib.skill[skills[i]].clickableFilter &amp;&amp; !lib.skill[skills[i]].clickableFilter(node))) {
                                    intronode.innerHTML = lib.discoloration1 + '' + lib.skill[skills[i]].clickChange;
                                    intronode.classList.add('hrefnode');
                                    intronode.style.opacity = 0.8;
                                }
                                intronode.link = node;
                                intronode.func = lib.skill[skills[i]].clickable;
                                intronode.classList.add('pointerdiv');
                                intronode.listen(ui.click.skillbutton);
                            }
                            else {
                                var intronode = uiintro.add('&lt;div>&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;br>&lt;div class="menubutton skillbutton" style="position:relative;margin-top:5px">&lt;/div>&lt;/div>&lt;/div>').querySelector('.skillbutton');
                                if (!_status.gameStarted || (lib.skill[skills[i]].clickableFilter &amp;&amp; !lib.skill[skills[i]].clickableFilter(node))) {
                                    intronode.classList.add('disabled');
                                    intronode.style.opacity = 0.5;
                                }
                                else {
                                    intronode.link = node;
                                    intronode.func = lib.skill[skills[i]].clickable;
                                    intronode.classList.add('pointerdiv');
                                    intronode.listen(ui.click.skillbutton);
                                }
                            }
                        }
                        else if (lib.skill[skills[i]].nobracket) {
                            uiintro.add('&lt;div>&lt;div class="skilln">' + get.translation(skills[i]) + '&lt;/div>&lt;div' + ((get.translation(skills[i]).length > 3) ? ' class="skilltext"' : '') + '>' + lib.translate[skills[i] + '_info'] + '&lt;/div>&lt;/div>');
                        }
                        else {
                            uiintro.add('&lt;div>&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i], node) + '&lt;/div>&lt;/div>');
                        }
                        if (lib.translate[skills[i] + '_append']) {
                            uiintro._place_text = uiintro.add('&lt;div class="text">' + lib.translate[skills[i] + '_append'] + '&lt;/div>')
                        }
                    }
                }
                // if(get.is.phoneLayout()){
                //     var storage=node.storage;
                //     for(i in storage){
                //                  if(get.info(i)&amp;&amp;get.info(i).intro){
                //                               intro=get.info(i).intro;
                //                               if(node.getSkills().concat(lib.skill.global).contains(i)==false&amp;&amp;!intro.show) continue;
                //                               var name=intro.name?intro.name:get.translation(i);
                //                               if(typeof name=='function'){
                //                                            name=name(storage[i],node);
                //                               }
                //                               translation='&lt;div>&lt;div class="skill">'+name.slice(0,2)+'&lt;/div>&lt;div>';
                //                               var stint=get.storageintro(intro.content,storage[i],node,null,i);
                //                               if(stint){
                //                                            translation+=stint+'&lt;/div>&lt;/div>';
                //                                            uiintro.add(translation);
                //                               }
                //                  }
                //     }
                // }

                if (lib.config.right_range &amp;&amp; _status.gameStarted) {
                    uiintro.add(ui.create.div('.placeholder'));
                    var table, tr, td;
                    table = document.createElement('table');
                    tr = document.createElement('tr');
                    table.appendChild(tr);
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = game.chess ? '' : '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = '';
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = game.chess ? '' : '';
                    tr.appendChild(td);

                    tr = document.createElement('tr');
                    table.appendChild(tr);
                    td = document.createElement('td');
                    if (node == game.me || !game.me || !game.me.isIn()) {
                        td.innerHTML = '-';
                    }
                    else {
                        var dist1 = get.numStr(Math.max(1, game.me.distanceTo(node)));
                        var dist2 = get.numStr(Math.max(1, node.distanceTo(game.me)));
                        if (dist1 == dist2) {
                            td.innerHTML = dist1;
                        }
                        else {
                            td.innerHTML = dist1 + '/' + dist2;
                        }
                    }
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = node.countCards('h');
                    tr.appendChild(td);
                    td = document.createElement('td');
                    td.innerHTML = node.phaseNumber;
                    tr.appendChild(td);
                    td = document.createElement('td');
                    if (game.chess) {
                        if (node.storage.curClass) td.innerHTML = get.translation(node.storage.curClass);
                        else td.innerHTML = '-';
                    } else {
                        (function () {
                            num = 0;
                            for (var j = 0; j &lt; node.stat.length; j++) {
                                if (typeof node.stat[j].damage == 'number') num += node.stat[j].damage;
                            }
                            td.innerHTML = num;
                        }());
                    }
                    tr.appendChild(td);
                    table.style.width = 'calc(100% - 20px)';
                    table.style.marginLeft = '10px';

                    uiintro.content.appendChild(table);
                    if (!lib.config.show_favourite) {
                        table.style.paddingBottom = '5px'
                    }
                }
                if (!simple || get.is.phoneLayout()) {
                    var es = node.getCards('e');
                    for (var i = 0; i &lt; es.length; i++) {
                        if (es[i].viewAs &amp;&amp; es[i].originalName &amp;&amp; es[i].originalName != es[i].name) {
                            uiintro.add('&lt;div>&lt;div class="equip">' + es[i].outerHTML + '&lt;/div>&lt;div>' + lib.translate[es[i].viewAs] + '' + lib.translate[es[i].viewAs + '_info'] + '&lt;/div>&lt;/div>');
                        }
                        else {
                            uiintro.add('&lt;div>&lt;div class="equip">' + es[i].outerHTML + '&lt;/div>&lt;div>' + lib.translate[es[i].name + '_info'] + '&lt;/div>&lt;/div>');
                        }
                        uiintro.content.lastChild.querySelector('.equip>.card').style.transform = '';
                    }
                    var js = node.getCards('j');
                    for (var i = 0; i &lt; js.length; i++) {
                        if (js[i].viewAs &amp;&amp; js[i].viewAs != js[i].name) {
                            uiintro.add('&lt;div>&lt;div class="equip">' + js[i].outerHTML + '&lt;/div>&lt;div>' + lib.translate[js[i].viewAs] + '' + lib.translate[js[i].viewAs + '_info'] + '&lt;/div>&lt;/div>');
                        }
                        else {
                            uiintro.add('&lt;div>&lt;div class="equip">' + js[i].outerHTML + '&lt;/div>&lt;div>' + lib.translate[js[i].name + '_info'] + '&lt;/div>&lt;/div>');
                        }
                        uiintro.content.lastChild.querySelector('.equip>.card').style.transform = '';
                    }
                    if (get.is.phoneLayout()) {
                        var markCoutainer = ui.create.div('.mark-container.marks');
                        for (var i in node.marks) {
                            var nodemark = node.marks[i].cloneNode(true);
                            nodemark.classList.add('pointerdiv');
                            nodemark.link = node.marks[i];
                            nodemark.style.transform = '';
                            markCoutainer.appendChild(nodemark);
                            nodemark.listen(function () {
                                uiintro.noresume = true;
                                var rect = this.link.getBoundingClientRect();
                                ui.click.intro.call(this.link, {
                                    clientX: rect.left + rect.width,
                                    clientY: rect.top + rect.height / 2,
                                });
                                if (lib.config.touchscreen) {
                                    uiintro._close();
                                }
                            });
                        }
                        if (markCoutainer.childElementCount) {
                            uiintro.addText('');
                            uiintro.add(markCoutainer);
                        }
                    }
                }
                if (!game.observe &amp;&amp; _status.gameStarted &amp;&amp; game.me &amp;&amp; node != game.me) {
                    ui.throwEmotion = [];
                    uiintro.addText('');
                    var click = function () {
                        if (_status.dragged) return;
                        if (_status.justdragged) return;
                        if (_status.throwEmotionWait) return;
                        var emotion = this.link;
                        if (game.online) {
                            game.send('throwEmotion', node, emotion);
                        }
                        else game.me.throwEmotion(node, emotion);
                        uiintro._close();
                        _status.throwEmotionWait = true;
                        setTimeout(function () {
                            _status.throwEmotionWait = false;
                            if (ui.throwEmotion) {
                                for (var i of ui.throwEmotion) i.classList.remove('exclude');
                            }
                        }, (emotion == 'flower' || emotion == 'egg') ? 5000 : 10000)
                    };
                    var td;
                    var table = document.createElement('div');
                    table.classList.add('add-setting');
                    table.style.margin = '0';
                    table.style.width = '100%';
                    table.style.position = 'relative';
                    var listi = ['flower', 'egg', 'wine', 'shoe'];
                    for (var i = 0; i &lt; listi.length; i++) {
                        td = ui.create.div('.menubutton.reduce_radius.pointerdiv.tdnode');
                        ui.throwEmotion.add(td);
                        if (_status.throwEmotionWait) td.classList.add('exclude');
                        td.link = listi[i];
                        table.appendChild(td);
                        td.innerHTML = '&lt;span>' + get.translation(listi[i]) + '&lt;/span>';
                        td.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', click);
                    }
                    uiintro.content.appendChild(table);
                    table = document.createElement('div');
                    table.classList.add('add-setting');
                    table.style.margin = '0';
                    table.style.width = '100%';
                    table.style.position = 'relative';
                    var listi = ['yuxisx', 'shoukao', 'sc', 'ship'];
                    for (var i = 0; i &lt; listi.length; i++) {
                        td = ui.create.div('.menubutton.reduce_radius.pointerdiv.tdnode');
                        ui.throwEmotion.add(td);
                        if (_status.throwEmotionWait) td.classList.add('exclude');
                        td.link = listi[i];
                        table.appendChild(td);
                        td.innerHTML = '&lt;span>' + get.translation(listi[i]) + '&lt;/span>';
                        td.addEventListener(lib.config.touchscreen ? 'touchend' : 'click', click);
                    }
                    uiintro.content.appendChild(table);
                }
                var modepack = lib.characterPack['mode_' + get.mode()];
                if (lib.config.show_favourite &amp;&amp; lib.character[node.name] &amp;&amp; game.players.contains(node) &amp;&amp;
                    (!modepack || !modepack[node.name]) &amp;&amp; (!simple || get.is.phoneLayout())) {
                    var addFavourite = ui.create.div('.text.center.pointerdiv');
                    addFavourite.link = node.link;
                    if (lib.config.favouriteCharacter.contains(node.name)) {
                        addFavourite.innerHTML = '';
                    }
                    else {
                        addFavourite.innerHTML = '';
                    }
                    addFavourite.listen(ui.click.favouriteCharacter)
                    uiintro.add(addFavourite);
                }
                if (!simple || get.is.phoneLayout()) {
                    if ((lib.config.change_skin || lib.skin) &amp;&amp; !node.isUnseen()) {
                        var num = 1;
                        var introadded = false;
                        var createButtons = function (num, avatar2) {
                            if (!introadded) {
                                introadded = true;
                                uiintro.add('&lt;div class="text center">&lt;/div>');
                            }
                            var buttons = ui.create.div('.buttons.smallzoom.scrollbuttons');
                            lib.setMousewheel(buttons);
                            var nameskin = (avatar2 ? node.name2 : node.name1);
                            var nameskin2 = nameskin;
                            var gzbool = false;
                            if (nameskin.indexOf('gz_shibing') == 0) {
                                nameskin = nameskin.slice(3, 11);
                            }
                            else if (nameskin.indexOf('gz_') == 0) {
                                nameskin = nameskin.slice(3);
                                gzbool = true;
                            }
                            for (var i = 0; i &lt;= num; i++) {
                                var button = ui.create.div('.button.character.pointerdiv', buttons, function () {
                                    if (this._link) {
                                        if (avatar2) {
                                            lib.config.skin[nameskin] = this._link;
                                            node.node.avatar2.style.backgroundImage = this.style.backgroundImage;
                                        }
                                        else {
                                            lib.config.skin[nameskin] = this._link;
                                            node.node.avatar.style.backgroundImage = this.style.backgroundImage;
                                        }
                                    }
                                    else {
                                        delete lib.config.skin[nameskin];
                                        if (avatar2) {
                                            if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) node.node.avatar2.setBackground(nameskin2, 'character');
                                            else node.node.avatar2.setBackground(nameskin, 'character');
                                        }
                                        else {
                                            if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) node.node.avatar.setBackground(nameskin2, 'character');
                                            else node.node.avatar.setBackground(nameskin, 'character');
                                        }
                                    }
                                    game.saveConfig('skin', lib.config.skin);
                                });
                                button._link = i;
                                if (i) {
                                    button.setBackgroundImage('image/skin/' + nameskin + '/' + i + '.jpg');
                                }
                                else {
                                    if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) button.setBackground(nameskin2, 'character', 'noskin');
                                    else button.setBackground(nameskin, 'character', 'noskin');
                                }
                            }
                            uiintro.add(buttons);
                        };
                        var loadImage = function (avatar2) {
                            var img = new Image();
                            img.onload = function () {
                                num++;
                                loadImage(avatar2);
                            }
                            img.onerror = function () {
                                num--;
                                if (num) {
                                    createButtons(num, avatar2);
                                }
                                if (!avatar2) {
                                    if (!node.classList.contains('unseen2') &amp;&amp; node.name2) {
                                        num = 1;
                                        loadImage(true);
                                    }
                                }
                            }
                            var nameskin = (avatar2 ? node.name2 : node.name1);
                            var nameskin2 = nameskin;
                            var gzbool = false;
                            if (nameskin.indexOf('gz_shibing') == 0) {
                                nameskin = nameskin.slice(3, 11);
                            }
                            else if (nameskin.indexOf('gz_') == 0) {
                                nameskin = nameskin.slice(3);
                                gzbool = true;
                            }
                            img.src = lib.assetURL + 'image/skin/' + nameskin + '/' + num + '.jpg';
                        }
                        if (lib.config.change_skin) {
                            if (!node.isUnseen(0)) {
                                loadImage();
                            }
                            else if (node.name2) {
                                loadImage(true);
                            }
                        }
                        else {
                            setTimeout(function () {
                                var nameskin1 = node.name1;
                                var nameskin2 = node.name2;
                                if (nameskin1 &amp;&amp; nameskin1.indexOf('gz_') == 0) {
                                    nameskin1 = nameskin1.slice(3);
                                }
                                if (nameskin2 &amp;&amp; nameskin2.indexOf('gz_') == 0) {
                                    nameskin2 = nameskin2.slice(3);
                                }
                                if (!node.isUnseen(0) &amp;&amp; lib.skin[nameskin1]) {
                                    createButtons(lib.skin[nameskin1]);
                                }
                                if (!node.isUnseen(1) &amp;&amp; lib.skin[nameskin2]) {
                                    createButtons(lib.skin[nameskin2], true);
                                }
                            });
                        }
                    }
                }

                uiintro.add(ui.create.div('.placeholder.slim'));
            }
            else if (node.classList.contains('mark') &amp;&amp; node.info &amp;&amp;
                node.parentNode &amp;&amp; node.parentNode.parentNode &amp;&amp; node.parentNode.parentNode.classList.contains('player')) {
                var info = node.info;
                var player = node.parentNode.parentNode;
                if (info.name) {
                    if (typeof info.name == 'function') {
                        var named = info.name(player.storage[node.skill], player);
                        if (named) {
                            uiintro.add(named);
                        }
                    }
                    else {
                        uiintro.add(info.name);
                    }
                }
                else if (info.name !== false) {
                    uiintro.add(get.translation(node.skill));
                }
                if (typeof info.id == 'string' &amp;&amp; info.id.indexOf('subplayer') == 0 &amp;&amp;
                    player.isUnderControl(true) &amp;&amp; player.storage[info.id] &amp;&amp; !_status.video) {
                    var storage = player.storage[info.id];
                    uiintro.addText('' + storage.hp + '/' + storage.maxHp);
                    if (storage.hs.length) {
                        uiintro.addText('');
                        uiintro.addSmall(storage.hs);
                    }
                    if (storage.es.length) {
                        uiintro.addText('');
                        uiintro.addSmall(storage.es);
                    }
                }
                if (typeof info.mark == 'function') {
                    var stint = info.mark(uiintro, player.storage[node.skill], player);
                    if (stint) {
                        var placetext = uiintro.add('&lt;div class="text" style="display:inline">' + stint + '&lt;/div>');
                        if (stint.indexOf('&lt;div class="equip"') != 0) {
                            uiintro._place_text = placetext;
                        }
                        // if(stint.length&lt;=100){
                        //     uiintro.add('&lt;div class="text center">'+stint+'&lt;/div>');
                        // }
                        // else{
                        //     uiintro.add('&lt;div class="text">'+stint+'&lt;/div>');
                        // }
                    }
                }
                else {
                    var stint = get.storageintro(info.content, player.storage[node.skill], player, uiintro, node.skill);
                    if (stint) {
                        if (stint[0] == '@') {
                            uiintro.add('&lt;div class="caption">' + stint.slice(1) + '&lt;/div>');
                        }
                        else {
                            var placetext = uiintro.add('&lt;div class="text" style="display:inline">' + stint + '&lt;/div>');
                            if (stint.indexOf('&lt;div class="equip"') != 0) {
                                uiintro._place_text = placetext;
                            }
                        }
                        // else if(stint.length&lt;=100){
                        //     uiintro.add('&lt;div class="text center">'+stint+'&lt;/div>');
                        // }
                        // else{
                        //     uiintro.add('&lt;div class="text">'+stint+'&lt;/div>');
                        // }
                    }
                }
                uiintro.add(ui.create.div('.placeholder.slim'));
            }
            else if (node.classList.contains('card')) {
                //
                if (ui.arena.classList.contains('observe') &amp;&amp; node.parentNode.classList.contains('handcards')) {
                    return;
                }
                var name = node.name;
                if (node.parentNode.cardMod) {
                    var moded = false;
                    for (var i in node.parentNode.cardMod) {
                        var item = node.parentNode.cardMod[i](node);
                        if (Array.isArray(item)) {
                            moded = true;
                            uiintro.add(item[0]);
                            uiintro._place_text = uiintro.add('&lt;div class="text" style="display:inline">' + item[1] + '&lt;/div>');
                        }
                    }
                    if (moded) return uiintro;
                }
                if (node.link &amp;&amp; node.link.name &amp;&amp; lib.card[node.link.name]) {
                    name = node.link.name;
                }
                if ((get.position(node) == 'j' || get.position(node) == 'e') &amp;&amp; node.viewAs &amp;&amp; (node.viewAs != name || node.originalName != name)) {
                    uiintro.add(get.translation(node.viewAs));
                    console.log(node.originalName)
                    uiintro.add('&lt;div class="text center">' + get.translation(get.translation(node.originalName || node)) + '&lt;/div>');
                    // uiintro.add(get.translation(node.viewAs)+'&lt;br>&lt;div class="text center" style="padding-top:5px;">'+get.translation(node)+'&lt;/div>');
                    uiintro.nosub = true;
                    name = node.viewAs;
                }
                else {
                    uiintro.add(get.translation(node));
                }
                if (node._banning) {
                    var clickBanned = function () {
                        var banned = lib.config[this.bannedname] || [];
                        if (banned.contains(name)) {
                            banned.remove(name);
                        }
                        else {
                            banned.push(name);
                        }
                        game.saveConfig(this.bannedname, banned);
                        this.classList.toggle('on');
                        if (node.updateBanned) {
                            node.updateBanned();
                        }
                    };
                    var modeorder = lib.config.modeorder || [];
                    for (var i in lib.mode) {
                        modeorder.add(i);
                    }
                    var list = [];
                    uiintro.contentContainer.listen(function (e) {
                        ui.click.touchpop();
                        e.stopPropagation();
                    });
                    for (var i = 0; i &lt; modeorder.length; i++) {
                        if (node._banning == 'online') {
                            if (!lib.mode[modeorder[i]].connect) continue;
                        }
                        else if (modeorder[i] == 'connect' || modeorder[i] == 'brawl') {
                            continue;
                        }
                        if (lib.config.all.mode.contains(modeorder[i])) {
                            list.push(modeorder[i]);
                        }
                    }
                    var page = ui.create.div('.menu-buttons.configpopped', uiintro.content);
                    var banall = false;
                    for (var i = 0; i &lt; list.length; i++) {
                        var cfg = ui.create.div('.config', lib.translate[list[i]] + '', page);
                        cfg.classList.add('toggle');
                        if (node._banning == 'offline') {
                            cfg.bannedname = list[i] + '_bannedcards';
                        }
                        else {
                            cfg.bannedname = 'connect_' + list[i] + '_bannedcards';
                        }
                        cfg.listen(clickBanned);
                        ui.create.div(ui.create.div(cfg));
                        var banned = lib.config[cfg.bannedname] || [];
                        if (!banned.contains(name)) {
                            cfg.classList.add('on');
                            banall = true;
                        }
                    }
                    ui.create.div('.menubutton.pointerdiv', banall ? '' : '', uiintro.content, function () {
                        if (this.innerHTML == '') {
                            for (var i = 0; i &lt; page.childElementCount; i++) {
                                if (page.childNodes[i].bannedname &amp;&amp; page.childNodes[i].classList.contains('on')) {
                                    clickBanned.call(page.childNodes[i]);
                                }
                            }
                            this.innerHTML = '';
                        }
                        else {
                            for (var i = 0; i &lt; page.childElementCount; i++) {
                                if (page.childNodes[i].bannedname &amp;&amp; !page.childNodes[i].classList.contains('on')) {
                                    clickBanned.call(page.childNodes[i]);
                                }
                            }
                            this.innerHTML = '';
                        }
                    }).style.marginTop = '-10px';
                    ui.create.div('.placeholder.slim', uiintro.content);
                }
                else {
                    if (lib.translate[name + '_info']) {
                        if (!uiintro.nosub) {
                            if (get.subtype(node) == 'equip1') {
                                var added = false;
                                if (lib.card[node.name] &amp;&amp; lib.card[node.name].distance) {
                                    var dist = lib.card[node.name].distance;
                                    if (dist.attackFrom) {
                                        added = true;
                                        uiintro.add('&lt;div class="text center">' + (-dist.attackFrom + 1) + '&lt;/div>');
                                    }
                                }
                                if (!added) {
                                    uiintro.add('&lt;div class="text center">1&lt;/div>');
                                }
                            }
                            else if (get.subtype(node)) {
                                uiintro.add('&lt;div class="text center">' + get.translation(get.subtype(node)) + '&lt;/div>');
                            }
                            else if (lib.card[name] &amp;&amp; lib.card[name].addinfomenu) {
                                uiintro.add('&lt;div class="text center">' + lib.card[name].addinfomenu + '&lt;/div>');
                            }
                            else if (lib.card[name] &amp;&amp; lib.card[name].derivation) {
                                if (typeof lib.card[name].derivation == 'string') {
                                    uiintro.add('&lt;div class="text center">' + get.translation(lib.card[name].derivation) + '&lt;/div>');
                                }
                                else if (lib.card[name].derivationpack) {
                                    uiintro.add('&lt;div class="text center">' + get.translation(lib.card[name].derivationpack + '_card_config') + '&lt;/div>');
                                }
                            }
                            else {
                                if (lib.card[name].unique) {
                                    uiintro.add('&lt;div class="text center">' + get.translation(lib.card[name].type) + '&lt;/div>');
                                }
                                else {
                                    if (lib.card[name].type &amp;&amp; lib.translate[lib.card[name].type]) uiintro.add('&lt;div class="text center">' + get.translation(lib.card[name].type) + '&lt;/div>');
                                }
                            }
                            if (lib.card[name].unique &amp;&amp; lib.card[name].type == 'equip') {
                                if (lib.cardPile.guozhan &amp;&amp; lib.cardPack.guozhan.contains(name)) {
                                    uiintro.add('&lt;div class="text center">&lt;/div>').style.marginTop = '-5px';
                                }
                                else {
                                    uiintro.add('&lt;div class="text center">&lt;/div>').style.marginTop = '-5px';
                                }
                            }
                        }
                        if (lib.translate[name + '_info']) {
                            var placetext = uiintro.add('&lt;div class="text" style="display:inline">' + lib.translate[name + '_info'] + '&lt;/div>');
                            if (lib.translate[name + '_info'].indexOf('&lt;div class="equip"') != 0) {
                                uiintro._place_text = placetext;
                            }
                        }
                        if (lib.card[name].materials) {
                            if (lib.card[name].materials_prompt) uiintro.add('&lt;div class="text" style="font-family: yuanli">' + lib.card[name].materials_prompt + '&lt;/div>');
                            else if (typeof lib.card[name].materials == 'function') uiintro.add('&lt;div class="text" style="font-family: yuanli">' + lib.card[name].materials_prompt(node.link || node) + '&lt;/div>');
                            else if (Array.isArray(lib.card[name].materials)) uiintro.add('&lt;div class="text" style="font-family: yuanli">' + get.translation(lib.card[name].materials) + '&lt;/div>');
                            else uiintro.add('&lt;div class="text" style="font-family: yuanli">&lt;/div>');
                        }
                        if (lib.card[name].yingbian_prompt &amp;&amp; get.is.yingbian(node.link || node)) {
                            if (typeof lib.card[name].yingbian_prompt == 'function') uiintro.add('&lt;div class="text" style="font-family: yuanli">' + lib.card[name].yingbian_prompt(node.link || node) + '&lt;/div>');
                            else uiintro.add('&lt;div class="text" style="font-family: yuanli">' + lib.card[name].yingbian_prompt + '&lt;/div>');
                        }
                        if (node.nature == 'ocean') {
                            uiintro.add('&lt;div class="text" style="font-family: yuanli;zoom: 0.8">' + '&lt;span class="bluetext">&lt;/span>' + '1+1' + '&lt;/div>');
                        }
                        if (node.nature == 'yami') {
                            uiintro.add('&lt;div class="text" style="font-family: yuanli;zoom: 0.8">' + '&lt;span class="legendtext">&lt;/span>' + '' + '&lt;/div>');
                        }
                        if (lib.translate[name + '_append']) {
                            uiintro.add('&lt;div class="text" style="display:inline">' + lib.translate[name + '_append'] + '&lt;/div>');
                        }
                    }
                    uiintro.add(ui.create.div('.placeholder.slim'));
                }
            }
            else if (node.classList.contains('character')) {
                var character = node.link;
                if (lib.character[node.link] &amp;&amp; lib.character[node.link][1]) {
                    var group = get.is.double(node.link, true);
                    if (group) {
                        var str = get.translation(character) + '&amp;nbsp;&amp;nbsp;';
                        for (var i = 0; i &lt; group.length; i++) {
                            str += get.translation(group[i]);
                            if (i &lt; group.length - 1) str += '/';
                        }
                        uiintro.add(str);
                    }
                    else uiintro.add(get.translation(character) + '&amp;nbsp;&amp;nbsp;' + lib.translate[lib.character[node.link][1]] || lib.character[node.link][1]);
                }
                else {
                    uiintro.add(get.translation(character));
                }

                if (lib.characterTitle[node.link]) {
                    uiintro.addText(get.colorspan(lib.characterTitle[node.link]));
                }

                if (node._banning) {
                    var clickBanned = function () {
                        var banned = lib.config[this.bannedname] || [];
                        if (banned.contains(character)) {
                            banned.remove(character);
                        }
                        else {
                            banned.push(character);
                        }
                        game.saveConfig(this.bannedname, banned);
                        this.classList.toggle('on');
                        if (node.updateBanned) {
                            node.updateBanned();
                        }
                    };
                    var modeorder = lib.config.modeorder || [];
                    for (var i in lib.mode) {
                        modeorder.add(i);
                    }
                    var list = [];
                    uiintro.contentContainer.listen(function (e) {
                        ui.click.touchpop();
                        e.stopPropagation();
                    });
                    for (var i = 0; i &lt; modeorder.length; i++) {
                        if (node._banning == 'online') {
                            if (!lib.mode[modeorder[i]].connect) continue;
                            if (!lib.config['connect_' + modeorder[i] + '_banned']) {
                                lib.config['connect_' + modeorder[i] + '_banned'] = [];
                            }
                        }
                        else if (modeorder[i] == 'connect' || modeorder[i] == 'brawl') {
                            continue;
                        }
                        if (lib.config.all.mode.contains(modeorder[i])) {
                            list.push(modeorder[i]);
                        }
                    }
                    var page = ui.create.div('.menu-buttons.configpopped', uiintro.content);
                    var banall = false;
                    for (var i = 0; i &lt; list.length; i++) {
                        var cfg = ui.create.div('.config', lib.translate[list[i]] + '', page);
                        cfg.classList.add('toggle');
                        if (node._banning == 'offline') {
                            cfg.bannedname = list[i] + '_banned';
                        }
                        else {
                            cfg.bannedname = 'connect_' + list[i] + '_banned';
                        }
                        cfg.listen(clickBanned);
                        ui.create.div(ui.create.div(cfg));
                        var banned = lib.config[cfg.bannedname] || [];
                        if (!banned.contains(character)) {
                            cfg.classList.add('on');
                            banall = true;
                        }
                    }
                    if (node._banning == 'offline') {
                        var cfg = ui.create.div('.config', '', page);
                        cfg.classList.add('toggle');
                        cfg.listen(function () {
                            this.classList.toggle('on');
                            if (this.classList.contains('on')) {
                                lib.config.forbidai_user.remove(character);
                            }
                            else {
                                lib.config.forbidai_user.add(character);
                            }
                            game.saveConfig('forbidai_user', lib.config.forbidai_user);
                        });
                        ui.create.div(ui.create.div(cfg));
                        if (!lib.config.forbidai_user.contains(character)) {
                            cfg.classList.add('on');
                        }
                    }
                    ui.create.div('.menubutton.pointerdiv', banall ? '' : '', uiintro.content, function () {
                        if (this.innerHTML == '') {
                            for (var i = 0; i &lt; page.childElementCount; i++) {
                                if (page.childNodes[i].bannedname &amp;&amp; page.childNodes[i].classList.contains('on')) {
                                    clickBanned.call(page.childNodes[i]);
                                }
                            }
                            this.innerHTML = '';
                        }
                        else {
                            for (var i = 0; i &lt; page.childElementCount; i++) {
                                if (page.childNodes[i].bannedname &amp;&amp; !page.childNodes[i].classList.contains('on')) {
                                    clickBanned.call(page.childNodes[i]);
                                }
                            }
                            this.innerHTML = '';
                        }
                    }).style.marginTop = '-10px';
                    ui.create.div('.placeholder.slim', uiintro.content);
                }
                else {
                    var infoitem = lib.character[character];
                    if (!infoitem) {
                        for (var itemx in lib.characterPack) {
                            if (lib.characterPack[itemx][character]) {
                                infoitem = lib.characterPack[itemx][character]; break;
                            }
                        }
                    }
                    var skills = infoitem[3];
                    for (i = 0; i &lt; skills.length; i++) {
                        if (lib.translate[skills[i] + '_info']) {
                            translation = lib.translate[skills[i] + '_ab'] || get.translation(skills[i]).slice(0, 5);
                            if (lib.skill[skills[i]] &amp;&amp; lib.skill[skills[i]].nobracket) {
                                uiintro.add('&lt;div>&lt;div class="skilln">' + get.translation(skills[i]) + '&lt;/div>&lt;div' + ((get.translation(skills[i]).length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i]) + '&lt;/div>&lt;/div>');
                            }
                            else {
                                uiintro.add('&lt;div>&lt;div class="skill">' + translation + '&lt;/div>&lt;div' + ((translation.length > 3) ? ' class="skilltext"' : '') + '>' + get.skillInfoTranslation(skills[i]) + '&lt;/div>&lt;/div>');
                            }
                            if (lib.translate[skills[i] + '_append']) {
                                uiintro._place_text = uiintro.add('&lt;div class="text">' + lib.translate[skills[i] + '_append'] + '&lt;/div>')
                            }
                        }
                    }
                    var modepack = lib.characterPack['mode_' + get.mode()];
                    if (lib.config.show_favourite &amp;&amp;
                        lib.character[node.link] &amp;&amp; (!modepack || !modepack[node.link]) &amp;&amp; (!simple || get.is.phoneLayout())) {
                        var addFavourite = ui.create.div('.text.center.pointerdiv');
                        addFavourite.link = node.link;
                        addFavourite.style.marginBottom = '15px';
                        if (lib.config.favouriteCharacter.contains(node.link)) {
                            addFavourite.innerHTML = '';
                        }
                        else {
                            addFavourite.innerHTML = '';
                        }
                        addFavourite.listen(ui.click.favouriteCharacter)
                        uiintro.add(addFavourite);
                    }
                    else {
                        uiintro.add(ui.create.div('.placeholder.slim'));
                    }
                    var addskin = false;
                    if (node.parentNode.classList.contains('menu-buttons')) {
                        addskin = !lib.config.show_charactercard;
                    }
                    else {
                        addskin = lib.config.change_skin || lib.skin;
                    }
                    if (addskin &amp;&amp; (!simple || get.is.phoneLayout())) {
                        var num = 1;
                        var introadded = false;
                        var nameskin = node.link;
                        var nameskin2 = nameskin;
                        var gzbool = false;
                        if (nameskin.indexOf('gz_shibing') == 0) {
                            nameskin = nameskin.slice(3, 11);
                        }
                        else if (nameskin.indexOf('gz_') == 0) {
                            nameskin = nameskin.slice(3);
                            gzbool = true;
                        }
                        var createButtons = function (num) {
                            if (!num) return;
                            if (!introadded) {
                                introadded = true;
                                uiintro.add('&lt;div class="text center">&lt;/div>');
                            }
                            var buttons = ui.create.div('.buttons.smallzoom.scrollbuttons');
                            lib.setMousewheel(buttons);
                            for (var i = 0; i &lt;= num; i++) {
                                var button = ui.create.div('.button.character.pointerdiv', buttons, function () {
                                    if (this._link) {
                                        lib.config.skin[nameskin] = this._link;
                                        node.style.backgroundImage = this.style.backgroundImage;
                                        game.saveConfig('skin', lib.config.skin);
                                    }
                                    else {
                                        delete lib.config.skin[nameskin];
                                        if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) node.setBackground(nameskin2, 'character');
                                        else node.setBackground(nameskin, 'character');
                                        game.saveConfig('skin', lib.config.skin);
                                    }
                                });
                                button._link = i;
                                if (i) {
                                    button.setBackgroundImage('image/skin/' + nameskin + '/' + i + '.jpg');
                                }
                                else {
                                    if (gzbool &amp;&amp; lib.character[nameskin2][4].contains('gzskin') &amp;&amp; lib.config.mode_config.guozhan.guozhanSkin) button.setBackground(nameskin2, 'character', 'noskin');
                                    else button.setBackground(nameskin, 'character', 'noskin');
                                }
                            }
                            uiintro.add(buttons);
                        };
                        var loadImage = function () {
                            var img = new Image();
                            img.onload = function () {
                                num++;
                                loadImage();
                            }
                            img.onerror = function () {
                                num--;
                                createButtons(num);
                            }
                            img.src = lib.assetURL + 'image/skin/' + nameskin + '/' + num + '.jpg';
                        }
                        if (lib.config.change_skin) {
                            loadImage();
                        }
                        else {
                            setTimeout(function () {
                                createButtons(lib.skin[nameskin]);
                            });
                        }
                    }
                }
            }
            else if (node.classList.contains('equips') &amp;&amp; ui.arena.classList.contains('selecting')) {
                (function () {
                    uiintro.add('');
                    uiintro.addSmall(Array.from(node.childNodes), true);
                    uiintro.clickintro = true;
                    ui.control.hide();
                    uiintro._onclose = function () {
                        ui.control.show();
                    }
                    var confirmbutton;
                    for (var i = 0; i &lt; uiintro.buttons.length; i++) {
                        var button = uiintro.buttons[i];
                        button.classList.add('pointerdiv');
                        if (button.link.classList.contains('selected')) {
                            button.classList.add('selected');
                        }
                        button.listen(function (e) {
                            ui.click.card.call(this.link, 'popequip');
                            ui.click.window.call(ui.window, e);
                            if (this.link.classList.contains('selected')) {
                                this.classList.add('selected');
                            }
                            else {
                                this.classList.remove('selected');
                            }
                            if (ui.confirm &amp;&amp; ui.confirm.str &amp;&amp; ui.confirm.str.indexOf('o') != -1) {
                                confirmbutton.classList.remove('disabled');
                            }
                            else {
                                confirmbutton.classList.add('disabled');
                            }
                        });
                    }
                    var buttoncontainer = uiintro.add(ui.create.div());
                    buttoncontainer.style.display = 'block';
                    confirmbutton = ui.create.div('.menubutton.large.pointerdiv', '', function () {
                        if (ui.confirm &amp;&amp; ui.confirm.str &amp;&amp; ui.confirm.str.indexOf('o') != -1) {
                            uiintro._clickintro();
                            ui.click.ok(ui.confirm.firstChild);
                        }
                    }, buttoncontainer);
                    confirmbutton.style.position = 'relative';
                    setTimeout(function () {
                        if (ui.confirm &amp;&amp; ui.confirm.str &amp;&amp; ui.confirm.str.indexOf('o') != -1) {
                            confirmbutton.classList.remove('disabled');
                        }
                        else {
                            confirmbutton.classList.add('disabled');
                        }
                    }, 300);
                }());
            }
            else if (node.classList.contains('identity') &amp;&amp; node.dataset.career) {
                var career = node.dataset.career;
                uiintro.add(get.translation(career));
                uiintro.add('&lt;div class="text center" style="padding-bottom:5px">' + lib.translate['_' + career + '_skill_info'] + '&lt;/div>');
            }
            else if (node.classList.contains('skillbar')) {
                if (node == ui.friendBar) {
                    uiintro.add('');
                    uiintro.add('&lt;div class="text center" style="padding-bottom:5px">' + _status.friendRage + '/100&lt;/div>');
                }
                else if (node == ui.enemyBar) {
                    uiintro.add('');
                    uiintro.add('&lt;div class="text center" style="padding-bottom:5px">' + _status.enemyRage + '/100&lt;/div>');
                }
            }
            else if (node.parentNode == ui.historybar) {
                if (node.dead) {
                    if (!node.source || node.source == node.player) {
                        uiintro.add('&lt;div class="text center">' + get.translation(node.player) + '&lt;/div>');
                        uiintro.addSmall([node.player]);
                    }
                    else {
                        uiintro.add('&lt;div class="text center">' + get.translation(node.player) + '' + get.translation(node.source) + '&lt;/div>');
                        uiintro.addSmall([node.source]);
                    }
                }
                if (node.skill) {
                    uiintro.add('&lt;div class="text center">' + get.translation(node.skill, 'skill') + '&lt;/div>');
                    uiintro._place_text = uiintro.add('&lt;div class="text" style="display:inline">' + get.translation(node.skill, 'info') + '&lt;/div>');
                }
                if (node.targets &amp;&amp; get.itemtype(node.targets) == 'players') {
                    uiintro.add('&lt;div class="text center">&lt;/div>');
                    uiintro.addSmall(node.targets);
                }
                if (node.players &amp;&amp; node.players.length > 1) {
                    uiintro.add('&lt;div class="text center">&lt;/div>');
                    uiintro.addSmall(node.players);
                }
                if (node.cards &amp;&amp; node.cards.length) {
                    uiintro.add('&lt;div class="text center">&lt;/div>');
                    uiintro.addSmall(node.cards);
                }
                for (var i = 0; i &lt; node.added.length; i++) {
                    uiintro.add(node.added[i]);
                }
                if (node.added.length) {
                    uiintro.add(ui.create.div('.placeholder.slim'));
                }
                if (uiintro.content.firstChild) {
                    uiintro.content.firstChild.style.paddingTop = '3px';
                }
            }
            if (lib.config.touchscreen) {
                lib.setScroll(uiintro.contentContainer);
            }
            return uiintro;
        },
        linkintro: function (dialog, content, player) {
            dialog.content.firstChild.remove();
            dialog.add('&lt;div class="text center">&lt;/div>');
            var list = [];
            for (var i = 0; i &lt; game.players.length; i++) {
                if (game.players[i].isLinked() &amp;&amp; game.players[i].name &amp;&amp; game.players[i].name.indexOf('unknown') != 0) {
                    list.push(game.players[i]);
                }
            }
            if (list.length) {
                dialog.add(list, true, true);
            }
        },
        groups: function () {
            return [
                'vtuber', 'clubs',
                'wei', 'shu', 'wu', 'qun', 'jin', 'western', 'key',
                'holo', 'nijisanji', 'dotlive', 'upd8', 'eilene', 'paryi', 'kagura', 'nori', 'vwp', 'nanashi',
                'VirtuaReal', 'HappyElements', 'psp', 'asoul', 'xuyan', 'chaos', 'xuefeng','hunmiao', 'ego', 'chidori', 'lucca',
                'vshojo'
            ];
        },
        types: function () {
            var types = [];
            for (var i in lib.card) {
                if (lib.card[i].mode &amp;&amp; lib.card[i].mode.contains(lib.config.mode) == false) continue;
                if (lib.card[i].forbid &amp;&amp; lib.card[i].forbid.contains(lib.config.mode)) continue;
                if (lib.card[i].type) {
                    if (lib.card[i].type == 'delay') types.add('trick');
                    else types.add(lib.card[i].type);
                }
            }
            return types;
        },
        links: function (buttons) {
            var links = [];
            for (var i = 0; i &lt; buttons.length; i++) {
                if (buttons[i].link != undefined) links.push(buttons[i].link);
            }
            return links;
        },
        /**
         * $P$$threaten$$T$`info.ai.threaten`$S_n$$h$$c$:
         * &lt;p>
         * \begin{align*}
         * {threaten} &amp; = \alpha{F(h,c)}\\
         * \alpha &amp; = \left\{\begin{aligned}&amp;1,\,n = 0\\
         * &amp;\prod_{i=1}^{n-1}{f(S_i)},\,n \geq 1\\
         * \end{aligned}\right.\\
         * {f(x)} &amp; = \left\{\begin{aligned}{S_i.ai.threaten},\,\textrm{threatennumber}\\
         * S_i.ai.threaten(P, T),\,\textrm{threatenfunction}
         * \end{aligned}\right.\\
         * {F(x, y)} &amp; = \left\{\begin{aligned}&amp;1,\,\textrm{}\\
         * &amp;g(x)g(y),\,\textrm{}\\
         * \end{aligned}\right.\\
         * {g(x)} &amp; = \left\{\begin{aligned}&amp;1.5,\,x = 0\\
         * &amp;1.2,\,x = 1\\
         * &amp;1,\,x \not = 0 \land x \not = 1
         * \end{aligned}\right.
         * \end{align*}
         * &lt;/p>
         * @param {?GameCores.GameObjects.Player} [player] false
         * @param {GameCores.GameObjects.Player} [target] `player`
         * @param {?boolean} [hp] truefalse
         * @returns {number}
         */
        threaten: function (target, player, hp) {
            var threaten = 1;
            var skills = target.getSkills();
            if (!player &amp;&amp; player !== false) {
                player = _status.event.player;
            }
            for (var i = 0; i &lt; skills.length; i++) {
                var info = get.info(skills[i]);
                if (info &amp;&amp; info.ai &amp;&amp; info.ai.threaten) {
                    if (typeof info.ai.threaten == 'function' &amp;&amp; player) {
                        var tmp = info.ai.threaten(player, target);
                        if (typeof tmp == 'number') {
                            threaten *= tmp;
                        }
                    }
                    else if (typeof info.ai.threaten == 'number') {
                        threaten *= info.ai.threaten;
                    }
                }
            }
            if (hp) {
                switch (target.hp) {
                    case 0: threaten *= 1.5; break;
                    case 1: threaten *= 1.2; break;
                }
                switch (target.countCards('h')) {
                    case 0: threaten *= 1.5; break;
                    case 1: threaten *= 1.2; break;
                }
            }
            return threaten;
        },
        /**
         * $condition$$h$$H$$E_n$:
         * &lt;p>
         * \begin{align*}
         * {condition} &amp; = \left\{\begin{aligned}
         * &amp; {h}+\frac{H}{2},\,n=0 \\
         * &amp; {h}+\frac{H}{2}+\sum_{i=0}^{n-1}{M(E_i)},\,n\geq1
         * \end{aligned}\right.\\
         * {M(x)} &amp; = \left\{\begin{aligned}
         * &amp; 0.8,\,x\geq7\\
         * &amp; 0.5,\,x\geq5\\
         * &amp; 0.2,\,x\geq3\\
         * &amp; 0,\,x&lt;3
         * \end{aligned}\right.\\
         * E_n &amp; = {get.equipValueNumber(equips[n])}\\
         * {equips} &amp; = {player.getCards('e')}
         * \end{align*}
         * &lt;/p>
         * @param {GameCores.GameObjects.Player} player 
         * @returns {number}
         * @see {@link get.equipValueNumber}
         */
        condition: function (player) {
            var num = player.hp;
            if (num > 4) {
                num = 4 + Math.sqrt(num - 4);
            }
            else {
                if (player.isHealthy()) {
                    if (player.hp == 3) {
                        num += 0.5;
                    }
                    else if (player.hp &lt; 3) {
                        num++;
                    }
                }
            }
            num += player.countCards('h') / 2;
            var es = player.getCards('e');
            for (var i = 0; i &lt; es.length; i++) {
                var val = get.equipValueNumber(es[i]);
                if (val >= 7) num += 0.8;
                if (val >= 5) num += 0.5;
                if (val >= 3) num += 0.2;
            }
            return num;
        },
        /**
         * 
         * 
         * 
         * 01
         * @param {!GameCores.GameObjects.Player} from 0
         * @param {!GameCores.GameObjects.Player} to 0
         * @returns {number}
         */
        attitude: function (from, to) {
            if (!from || !to) return 0;
            from = from._trueMe || from;
            arguments[0] = from;
            var att = get.rawAttitude.apply(this, arguments);
            if (from.isMad()) att = -att;
            if (to.isMad() &amp;&amp; att > 0) {
                if (to.identity == 'zhu') {
                    att = 1;
                }
                else {
                    att = 0;
                }
            }
            if (!_status.tempnofake) {
                _status.tempnofake = true;
                if (from.ai.modAttitudeFrom) {
                    att = from.ai.modAttitudeFrom(from, to, att);
                }
                if (to.ai.modAttitudeTo) {
                    att = to.ai.modAttitudeTo(from, to, att);
                }
                delete _status.tempnofake;
            }
            return att;
        },
        /**
         * 
         * @param {...any} args {@link get.attitude}
         * @returns {number} (-1|0|1)
         */
        sgnAttitude: function () {
            return get.sgn(get.attitude.apply(this, arguments));
        },
        /**
         * (`info.ai.useful`|`info.ai.basic.useful`)
         * `card._modUseful``card._modUseful()`
         * `useful``useful(card, cardIndex)``cardIndex``card``player`(`card.name`)(|)`cardIndex`0
         * @param {!GameCores.GameObjects.Card} card 
         * @returns {number} -1 `useful`-1(`useful`-1)
         */
        useful: function (card, player) {
            if (get.position(card) == 'j') return -1;
            if (get.position(card) == 'e') return get.equipValue(card);
            if (card._modUseful) {
                return card._modUseful();
            }
            var i = 0;
            player = player || _status.event.player;
            if (player) {
                i = player.getCards('h', card.name).indexOf(card);
                if (i &lt; 0) i = 0;
            }
            var aii = get.info(card).ai;
            var useful;
            if (aii &amp;&amp; aii.useful) useful = aii.useful;
            else if (aii &amp;&amp; aii.basic) useful = aii.basic.useful;
            var result;
            if (useful == undefined) result = -1;
            else if (typeof useful == 'function') {
                result = useful(card, i);
            }
            else if (typeof useful == 'number') result = useful;
            else if (i &lt; useful.length) {
                result = useful[i];
            }
            else result = useful[useful.length - 1];
            result = game.checkMod(player, card, result, 'aiUseful', player);
            return result;
        },
        /**
         * 
         * @param {!GameCores.GameObjects.Card} card 
         * @returns {!number}
         */
        unuseful: function (card) {
            return -get.useful(card);
        },
        /**
         * `10 - oriUseful`oriUseful
         * @param {!GameCores.GameObjects.Card} card 
         * @returns {!number}
         */
        unuseful2: function (card) {
            return 10 - get.useful(card);
        },
        /**
         * `10 - oriUseful`oriUseful
         * (card.name)'du'20
         * @param {!GameCores.GameObjects.Card} card 
         * @returns {!number}
         */
        unuseful3: function (card) {
            if (card.name == 'du') return 20;
            return 10 - get.useful(card);
        },
        /**
         * $P$$C_n$$value$`method`$m$:
         * &lt;p>
         * \begin{align*}
         * {value} &amp; = \frac{\sum_{i=0}^{n-1}F(C_i)}{\sqrt{n}}\\
         * {F(x)} &amp; = {get.value(x, P, m)}
         * \end{align*}
         * &lt;/p>
         * @name get.value
         * @function
         * @param {!Array&lt;GameCores.GameObjects.Card>} cards ****`0/0``NaN`
         * @param {?GameCores.GameObjects.Player} [player] 
         * @param {?string} [method] 'raw'
         * @returns {number}
         */
        /**
         * (`info.ai.value`|`info.ai.basic.value`)
         * `card._modValue``card._modValue(player, method)`
         * 
         * `value``value(card, player, cardIndex, method)``cardIndex``card``player`(`card.name`)`card`
         * **aiValue**
         * @name get.value
         * @function
         * @variation 2
         * @param {(!GameCores.GameObjects.Card)} card 
         * @param {?GameCores.GameObjects.Player} [player] 
         * @param {?string} [method] 'raw'
         * @returns {number}
         */
        value: function (card, player, method) {
            var result = 0;
            var value;
            if (Array.isArray(card)) {
                value = 0;
                for (var i = 0; i &lt; card.length; i++) {
                    value += get.value(card[i], player, method);
                }
                return value / Math.sqrt(card.length);
            }
            if (card._modValue) {
                return card._modValue(player, method);
            }
            var aii = get.info(card).ai;
            if (aii &amp;&amp; aii.value) value = aii.value;
            else if (aii &amp;&amp; aii.basic) value = aii.basic.value;
            if (player == undefined || get.itemtype(player) != 'player') player = _status.event.player;
            var geti = function () {
                var num = 0, i;
                var cards = player.getCards('hs', card.name);
                if (cards.contains(card)) {
                    return cards.indexOf(card);
                }
                return cards.length;
            };
            if (typeof value == 'function') {
                result = value(card, player, geti(), method);
            }
            if (typeof value == 'number') result = value;
            if (Array.isArray(value)) {
                if (method == 'raw') result = value[0];//??
                var num = geti();
                if (num &lt; value.length) result = value[num];
                else result = value[value.length - 1];
            }
            result = game.checkMod(player, card, result, 'aiValue', player);
            return result;
        },
        /**
         * **0**(tag`valueswap`)0
         * $equipValue$$v$$v_{0}$
         * :
         * $${equipValue}=\frac{max(0, {v}-{v_{0}})}{5}$$
         * @param {GameCores.GameObjects.Player} player [never used]
         * @param {GameCores.GameOjbects.Player} target 
         * @param {!string} name `{name:name}`
         * @returns {number}
         */
        equipResult: function (player, target, name) {
            var card = get.card();
            if (!card || card.name != name) {
                card = { name: name };
            }
            var value1 = get.equipValue(card, target);
            var value2 = 0;
            var current = target.getEquip(card);
            if (current &amp;&amp; current != card) {
                value2 = get.equipValue(current, target);
                if (value2 > 0 &amp;&amp; !target.needsToDiscard() &amp;&amp; !get.tag(card, 'valueswap')) {
                    return 0;
                }
            }
            return Math.max(0, value1 - value2) / 5;
        },
        /**
         * (`info.ai.equipValue`|`info.ai.basic.equipValue`)
         * 0
         * `equipValue``equipValue(card, player, null, 'raw2')``player``card``player`
         * @param {!GameCores.GameObjects.Card} card 
         * @param {?GameCores.GameObjects.Player} [player] `card``card`
         * @returns {!number}
         */
        equipValue: function (card, player) {
            if (player == undefined || get.itemtype(player) != 'player') player = get.owner(card);
            if (player == undefined || get.itemtype(player) != 'player') player = _status.event.player;
            var info = get.info(card);
            if (!info.ai) return 0;
            var value = info.ai.equipValue;
            if (value == undefined) {
                if (info.ai.basic &amp;&amp; info.ai.basic.equipValue != undefined) {
                    value = info.ai.basic.equipValue;
                }
                else return 0;
            }
            if (typeof value == 'number') return value;
            if (typeof value == 'function') return value(card, player, null, 'raw2');
            return 0;
        },
        /**
         * (`info.ai.equipValue`|`info.ai.basic.equipValue`)
         * `equipValue`'number'0
         * @param {!GameCores.GameObjects.Card} card 
         * @returns {number}
         */
        equipValueNumber: function (card) {
            var info = get.info(card);
            if (info.ai) {
                if (typeof info.ai.equipValue == 'number') return info.ai.equipValue;
                if (info.ai.basic &amp;&amp; typeof info.ai.basic.equipValue == 'number') return info.ai.basic.equipValue;
            }
            return 0;
        },
        /**
         * 
         * @param {GameCores.GameObjects.Card} card 
         * @param {GameCores.GameObjects.Player} player 
         * @returns {number}
         */
        disvalue: function (card, player) {
            return -get.value(card, player);
        },
        /**
         * 
         * @param {GameCores.GameObjects.Card} card 
         * @param {GameCores.GameObjects.Player} player 
         * @returns {number}
         */
        disvalue2: function (card, player) {
            return -get.value(card, player, 'raw');
        },
        /**
         * (`info.ai.threaten`)
         * `threaten`
         * `order(player, target)``threaten`
         * @param {!string} skill 
         * @param {?GameCores.GameObjects.Player} [player] 
         * @param {GameCores.GameObjects.Player} [target] `player`
         * @returns {number} 1 `info.ai.threaten`1(`threaten`1)
         */
        skillthreaten: function (skill, player, target) {
            if (!lib.skill[skill]) return 1;
            if (!lib.skill[skill].ai) return 1;
            var threaten = lib.skill[skill].ai.threaten;
            if (typeof threaten == 'number') return threaten;
            if (typeof threaten == 'function') {
                player = player || _status.event.player;
                target = target || player;
                return threaten(player, target);
            }
            return 1;
        },
        /**
         * (|)(`info.ai.order`|`info.ai.basic.order`)
         * `order`
         * `order(item, _status.event.player)``order``_status.event.player`
         * **aiOrder**
         * @param {(string|GameCores.GameObjects.Card)} item 
         * @returns {!number} `{@link get.info() get.info(item)}`undefined-1`info.ai.order``info.ai.basic.order`-1
         */
        order: function (item) {
            var info = get.info(item);
            if (!info) return -1;
            var aii = info.ai;
            var order;
            if (aii &amp;&amp; aii.order) order = aii.order;
            else if (aii &amp;&amp; aii.basic) order = aii.basic.order;
            if (order == undefined) return -1;
            var num = order;
            if (typeof (order) == 'function') {
                num = order(item, _status.event.player);
            }
            if (typeof item == 'object' &amp;&amp; _status.event.player) {
                var player = _status.event.player;
                num = game.checkMod(player, item, num, 'aiOrder', player);
            }
            return num;
        },
        /**
         * `get.info(item).ai.result``ai.result``get.info(item).ai.result(item)`
         * @private
         * @param {GameCores.GameObjects.Card} item 
         * @param {?} skill 
         * @returns {!Object}
         */
        result: function (item, skill) {
            var result;
            var info = get.info(item);
            if (info.ai) result = get.copy(info.ai.result);
            if (typeof (result) == 'function') result = result(item);
            if (!result) result = {};
            if (skill) {
                var info2 = get.info(skill);
                if (info2.ai) {
                    info2 = info2.ai.result;
                    for (var i in info2) {
                        result[i] = info2[i];
                    }
                }
            }
            return result;
        },
        /**
         * 
         * @param {GameCores.GameObjects.Player} target 
         * @param {*} card 
         * @param {?GameCores.GameObjects.Player} [player] 
         * @param {?GameCores.GameObjects.Player} player2 
         * @param {?boolean} [isLink] 
         * @returns {number}
         */
        effect_use: function (target, card, player, player2, isLink) {
            var event = _status.event;
            var eventskill = null;
            if (player == undefined) player = _status.event.player;
            if (typeof card != 'string' &amp;&amp; (typeof card != 'object' || !card.name)) {
                var skillinfo = get.info(event.skill);
                if (event.skill &amp;&amp; skillinfo.viewAs == undefined) card = _status.event.skill;
                else {
                    card = get.card();
                    if (skillinfo &amp;&amp; skillinfo.viewAs &amp;&amp; card.name === skillinfo.viewAs.name) {
                        eventskill = event.skill;
                    }
                }
            }
            var info = get.info(card);
            if (typeof card == 'object' &amp;&amp; info &amp;&amp; info.changeTarget) {
                var targets = [target];
                info.changeTarget(player, targets);
                var eff = 0;
                for (var i of targets) {
                    eff += get.effect(i, card, player, player2, isLink);
                }
                return eff;
            }
            var result = get.result(card, eventskill);
            var result1 = result.player_use || result.player, result2 = result.target_use || result.target;
            if (typeof result1 == 'function') result1 = result1(player, target, card, isLink);
            if (typeof result2 == 'function') result2 = result2(player, target, card, isLink);

            if (typeof result1 != 'number') result1 = 0;
            if (typeof result2 != 'number') result2 = 0;
            var temp1, temp2, temp3, temp01 = 0, temp02 = 0, threaten = 1;
            var skills1 = player.getSkills().concat(lib.skill.global);
            game.expandSkills(skills1);
            var zerotarget = false, zeroplayer = false;
            for (var i = 0; i &lt; skills1.length; i++) {
                temp1 = get.info(skills1[i]).ai;
                if (temp1 &amp;&amp; typeof temp1.effect == 'object' &amp;&amp; typeof temp1.effect.player_use == 'function') {
                    temp1 = temp1.effect.player_use(card, player, target, result1, isLink);
                }
                else if (temp1 &amp;&amp; typeof temp1.effect == 'object' &amp;&amp; typeof temp1.effect.player == 'function') {
                    temp1 = temp1.effect.player(card, player, target, result1, isLink);
                }
                else temp1 = undefined;
                if (typeof temp1 == 'object') {
                    if (temp1.length == 2 || temp1.length == 4) {
                        result1 *= temp1[0];
                        temp01 += temp1[1];
                    }
                    if (temp1.length == 4) {
                        result2 *= temp1[2];
                        temp02 += temp1[3];
                    }
                }
                else if (typeof temp1 == 'number') {
                    result1 *= temp1;
                }
                else if (temp1 == 'zeroplayer') {
                    zeroplayer = true;
                }
                else if (temp1 == 'zerotarget') {
                    zerotarget = true;
                }
                else if (temp1 == 'zeroplayertarget') {
                    zeroplayer = true;
                    zerotarget = true;
                }
            }
            if (target) {
                var skills2 = target.getSkills().concat(lib.skill.global);
                game.expandSkills(skills2);
                for (var i = 0; i &lt; skills2.length; i++) {
                    temp2 = get.info(skills2[i]).ai;
                    if (temp2 &amp;&amp; temp2.threaten) temp3 = temp2.threaten;
                    else temp3 = undefined;
                    if (temp2 &amp;&amp; typeof temp2.effect == 'function') {
                        if (!player.hasSkillTag('ignoreSkill', true, {
                            card: card,
                            target: target,
                            skill: skills2[i],
                            isLink: isLink,
                        })) temp2 = temp2.effect(card, player, target, result2, isLink);
                        else temp2 = undefined;
                    }
                    else if (temp2 &amp;&amp; typeof temp2.effect == 'object' &amp;&amp; typeof temp2.effect.target_use == 'function') {
                        if (!player.hasSkillTag('ignoreSkill', true, {
                            card: card,
                            target: target,
                            skill: skills2[i],
                            isLink: isLink,
                        })) temp2 = temp2.effect.target_use(card, player, target, result2, isLink);
                        else temp2 = undefined;
                    }
                    else if (temp2 &amp;&amp; typeof temp2.effect == 'object' &amp;&amp; typeof temp2.effect.target == 'function') {
                        if (!player.hasSkillTag('ignoreSkill', true, {
                            card: card,
                            target: target,
                            skill: skills2[i],
                            isLink: isLink,
                        })) temp2 = temp2.effect.target(card, player, target, result2, isLink);
                        else temp2 = undefined;
                    }
                    else temp2 = undefined;
                    if (typeof temp2 == 'object') {
                        if (temp2.length == 2 || temp2.length == 4) {
                            result2 *= temp2[0];
                            temp02 += temp2[1];
                        }
                        if (temp2.length == 4) {
                            result1 *= temp2[2];
                            temp01 += temp2[3];
                        }
                    }
                    else if (typeof temp2 == 'number') {
                        result2 *= temp2;
                    }
                    else if (temp2 == 'zeroplayer') {
                        zeroplayer = true;
                    }
                    else if (temp2 == 'zerotarget') {
                        zerotarget = true;
                    }
                    else if (temp2 == 'zeroplayertarget') {
                        zeroplayer = true;
                        zerotarget = true;
                    }
                    if (typeof temp3 == 'function' &amp;&amp; temp3(player, target) != undefined) {
                        threaten *= temp3(player, target);
                    }
                    else if (typeof temp3 == 'object') {
                        if (typeof temp3.target == 'number') {
                            threaten *= temp3;
                        }
                        else if (typeof temp3.target == 'function' &amp;&amp; temp3(player, target) != undefined) {
                            threaten *= temp3(player, target);
                        }
                    }
                    else if (typeof temp3 == 'number') {
                        threaten *= temp3;
                    }
                }
                result2 += temp02;
                result1 += temp01;
                if (get.attitude(player, target) &lt; 0) {
                    result2 *= Math.sqrt(threaten);
                }
                else {
                    result2 *= Math.sqrt(Math.sqrt(threaten));
                }
                if (target.hp == 1) result2 *= 2.5;
                if (target.hp == 2) result2 *= 1.8;
                if (target.countCards('h') == 0) {
                    if (get.tag(card, 'respondSha') || get.tag(card, 'respondShan')) {
                        result2 *= 1.7;
                    }
                    else {
                        result2 *= 1.5;
                    }
                }
                if (target.countCards('h') == 1) result2 *= 1.3;
                if (target.countCards('h') == 2) result2 *= 1.1;
                if (target.countCards('h') > 3) result2 *= 0.5;
                if (target.hp == 4) result2 *= 0.9;
                if (target.hp == 5) result2 *= 0.8;
                if (target.hp > 5) result2 *= 0.6;
            }
            else {
                result2 += temp02;
                result1 += temp01;
            }
            if (zeroplayer) result1 = 0;
            if (zerotarget) result2 = 0;
            var final = 0;
            if (player2) {
                final = (result1 * get.attitude(player2, player) + (target ? result2 * get.attitude(player2, target) : 0));
            }
            else final = (result1 * get.attitude(player, player) + (target ? result2 * get.attitude(player, target) : 0));
            if (!isLink &amp;&amp; get.tag(card, 'natureDamage') &amp;&amp; !zerotarget) {
                var info = get.info(card);
                if (!info || !info.ai || !info.ai.canLink) {
                    if (target.isLinked()) game.countPlayer(function (current) {
                        if (current != target &amp;&amp; current.isLinked()) final += get.effect(current, card, player, player2, true);
                    });
                }
                else if (info.ai.canLink(player, target, card)) {
                    game.countPlayer(function (current) {
                        if (current != target &amp;&amp; current.isLinked()) final += get.effect(current, card, player, player2, true);
                    });
                }
            }
            return final;
        },
        /**
         * (||)
         * @param {?GameCores.GameObjects.Player} target 
         * @param {!GameCores.GameObjects.Card} card 
         * @param {?string} [card.name] `card``_status.event.skill`
         * @param {?GameCores.GameObjects.Player} [player] 
         * @param {?GameCores.GameObjects.Player} player2 
         * @param {?boolean} [isLink] truefalse$effect$$P_n$(`target`)$C$$P2$$O$${effect}=\sum_{i=0}^{n-1}{get.effect(P_i, C, P2, O, true)})$
         * @returns {number}
         */
        effect: function (target, card, player, player2, isLink) {
            var event = _status.event;
            var eventskill = null;
            if (player == undefined) player = _status.event.player;
            if (typeof card != 'string' &amp;&amp; (typeof card != 'object' || !card.name)) {
                var skillinfo = get.info(event.skill);
                if (event.skill &amp;&amp; skillinfo.viewAs == undefined) card = _status.event.skill;
                else {
                    card = get.card();
                    if (skillinfo &amp;&amp; skillinfo.viewAs &amp;&amp; card.name === skillinfo.viewAs.name) {
                        eventskill = event.skill;
                    }
                }
            }
            var result = get.result(card, eventskill);
            var result1 = result.player, result2 = result.target;
            if (typeof result1 == 'function') result1 = result1(player, target, card, isLink);
            if (typeof result2 == 'function') result2 = result2(player, target, card, isLink);

            if (typeof result1 != 'number') result1 = 0;
            if (typeof result2 != 'number') result2 = 0;
            var temp1, temp2, temp3, temp01 = 0, temp02 = 0, threaten = 1;
            var skills1 = player.getSkills().concat(lib.skill.global);
            game.expandSkills(skills1);
            var zerotarget = false, zeroplayer = false;
            for (var i = 0; i &lt; skills1.length; i++) {
                temp1 = get.info(skills1[i]).ai;
                if (temp1 &amp;&amp; typeof temp1.effect == 'object' &amp;&amp; typeof temp1.effect.player == 'function') {
                    temp1 = temp1.effect.player(card, player, target, result1, isLink);
                }
                else temp1 = undefined;
                if (typeof temp1 == 'object') {
                    if (temp1.length == 2 || temp1.length == 4) {
                        result1 *= temp1[0];
                        temp01 += temp1[1];
                    }
                    if (temp1.length == 4) {
                        result2 *= temp1[2];
                        temp02 += temp1[3];
                    }
                }
                else if (typeof temp1 == 'number') {
                    result1 *= temp1;
                }
                else if (temp1 == 'zeroplayer') {
                    zeroplayer = true;
                }
                else if (temp1 == 'zerotarget') {
                    zerotarget = true;
                }
                else if (temp1 == 'zeroplayertarget') {
                    zeroplayer = true;
                    zerotarget = true;
                }
            }
            if (target) {
                var skills2 = target.getSkills().concat(lib.skill.global);
                game.expandSkills(skills2);
                for (var i = 0; i &lt; skills2.length; i++) {
                    temp2 = get.info(skills2[i]).ai;
                    if (temp2 &amp;&amp; temp2.threaten) temp3 = temp2.threaten;
                    else temp3 = undefined;
                    if (temp2 &amp;&amp; typeof temp2.effect == 'function') {
                        if (!player.hasSkillTag('ignoreSkill', true, {
                            card: card,
                            target: target,
                            skill: skills2[i],
                            isLink: isLink,
                        })) temp2 = temp2.effect(card, player, target, result2, isLink);
                        else temp2 = undefined;
                    }
                    else if (temp2 &amp;&amp; typeof temp2.effect == 'object' &amp;&amp; typeof temp2.effect.target == 'function') {
                        if (!player.hasSkillTag('ignoreSkill', true, {
                            card: card,
                            target: target,
                            skill: skills2[i],
                            isLink: isLink,
                        })) temp2 = temp2.effect.target(card, player, target, result2, isLink);
                        else temp2 = undefined;
                    }
                    else temp2 = undefined;
                    if (typeof temp2 == 'object') {
                        if (temp2.length == 2 || temp2.length == 4) {
                            result2 *= temp2[0];
                            temp02 += temp2[1];
                        }
                        if (temp2.length == 4) {
                            result1 *= temp2[2];
                            temp01 += temp2[3];
                        }
                    }
                    else if (typeof temp2 == 'number') {
                        result2 *= temp2;
                    }
                    else if (temp2 == 'zeroplayer') {
                        zeroplayer = true;
                    }
                    else if (temp2 == 'zerotarget') {
                        zerotarget = true;
                    }
                    else if (temp2 == 'zeroplayertarget') {
                        zeroplayer = true;
                        zerotarget = true;
                    }
                    if (typeof temp3 == 'function' &amp;&amp; temp3(player, target) != undefined) {
                        threaten *= temp3(player, target);
                    }
                    else if (typeof temp3 == 'object') {
                        if (typeof temp3.target == 'number') {
                            threaten *= temp3;
                        }
                        else if (typeof temp3.target == 'function' &amp;&amp; temp3(player, target) != undefined) {
                            threaten *= temp3(player, target);
                        }
                    }
                    else if (typeof temp3 == 'number') {
                        threaten *= temp3;
                    }
                }
                result2 += temp02;
                result1 += temp01;
                if (get.attitude(player, target) &lt; 0) {
                    result2 *= Math.sqrt(threaten);
                }
                else {
                    result2 *= Math.sqrt(Math.sqrt(threaten));
                }
                // *** continue here ***
                if (target.hp == 1) result2 *= 2.5;
                if (target.hp == 2) result2 *= 1.8;
                if (target.countCards('h') == 0) {
                    if (get.tag(card, 'respondSha') || get.tag(card, 'respondShan')) {
                        result2 *= 1.7;
                    }
                    else {
                        result2 *= 1.5;
                    }
                }
                if (target.countCards('h') == 1) result2 *= 1.3;
                if (target.countCards('h') == 2) result2 *= 1.1;
                if (target.countCards('h') > 3) result2 *= 0.5;
                if (target.hp == 4) result2 *= 0.9;
                if (target.hp == 5) result2 *= 0.8;
                if (target.hp > 5) result2 *= 0.6;
                // if(get.attitude(player,target)&lt;0){
                //     result2*=threaten;
                // }
                // else{
                //     result2*=Math.sqrt(threaten);
                // }
                // if(target.hp&lt;=1) result2*=2;
                // if(target.hp==2) result2*=1.1;
                // if(target.countCards('h')==0){
                //     result2*=1.1;
                //     if(get.tag(card,'respondSha')||get.tag(card,'respondShan')) result2*=1.4;
                // }
                // if(target.countCards('h')==1) result2*=1.05;
                // if(target.countCards('h')==2) result2*=1.02;
                // if(target.countCards('h')>3) result2*=0.9;
                // if(target.hp==4) result2*=0.9;
                // if(target.hp==5) result2*=0.8;
                // if(target.hp>5) result2*=0.6;
            }
            else {
                result2 += temp02;
                result1 += temp01;
            }
            if (zeroplayer) result1 = 0;
            if (zerotarget) result2 = 0;
            var final = 0;
            if (player2) {
                final = (result1 * get.attitude(player2, player) + (target ? result2 * get.attitude(player2, target) : 0));
            }
            else final = (result1 * get.attitude(player, player) + (target ? result2 * get.attitude(player, target) : 0));
            if (!isLink &amp;&amp; get.tag(card, 'natureDamage') &amp;&amp; !zerotarget) {
                var info = get.info(card);
                if (!info || !info.ai || !info.ai.canLink) {
                    if (target.isLinked()) game.countPlayer(function (current) {
                        if (current != target &amp;&amp; current.isLinked()) final += get.effect(current, card, player, player2, true);
                    });
                }
                else if (info.ai.canLink(player, target, card)) {
                    game.countPlayer(function (current) {
                        if (current != target &amp;&amp; current.isLinked()) final += get.effect(current, card, player, player2, true);
                    });
                }
            }
            return final;
        },
        /**
         * 
         * @param {GameCores.GameObjects.Player} target 
         * @param {?GameCores.GameObjects.Player} [player] `target`
         * @param {?GameCores.GameObjects.Player} [viewer] ()()`target`
         * @param {?string} [nature] 
         * @returns {number}
         */
        damageEffect: function (target, player, viewer, nature) {
            if (!player) {
                player = target;
            }
            if (!viewer) {
                viewer = target;
            }
            var name = 'damage';
            if (nature == 'fire') {
                name = 'firedamage';
            }
            else if (nature == 'thunder') {
                name = 'thunderdamage';
            }
            else if (nature == 'ocean') {
                name = 'oceandamage';
            }
            else if (nature == 'ice') {
                name = 'icedamage';
            }
            else if (nature == 'yami') {
                name = 'yamidamage';
            }
            var eff = get.effect(target, { name: name }, player, viewer);
            if (eff > 0 &amp;&amp; target.hujia > 0) return 0;
            return eff;
        },
        /**
         * 0()
         * @param {GameCores.GameObjects.Player} target 
         * @param {?GameCores.GameObjects.Player} [player] `target`
         * @param {?GameCores.GameObjects.Player} [viewer] ()()`target`
         * @returns {number}
         */
        recoverEffect: function (target, player, viewer) {
            if (target.hp == target.maxHp) return 0;
            if (!player) {
                player = target;
            }
            if (!viewer) {
                viewer = target;
            }
            return get.effect(target, { name: 'recover' }, player, viewer);
        },
        /**
         * (|||)
         * ****(`_status.event.player`)
         * @param {HTMLDivElement} button 
         * @returns {number}
         */
        buttonValue: function (button) {
            var card = button.link;
            var player = get.owner(card);
            if (!player) player = _status.event.player;
            if (player.getCards('j').contains(card)) {
                var efff = get.effect(player, {
                    name: card.viewAs || card.name,
                    cards: [card],
                }, player, player);
                if (efff > 0) return 0.5;
                if (efff == 0) return 0;
                return -1.5;
            }
            if (player.getCards('e').contains(card)) {
                var evalue = get.value(card, player);
                if (player.hasSkillTag('noe')) {
                    if (evalue >= 7) {
                        return evalue / 6;
                    }
                    return evalue / 10;
                }
                return evalue / 3;
            }
            if (player.hasSkillTag('noh')) return 0.1;
            var nh = player.countCards('h');
            switch (nh) {
                case 1: return 2;
                case 2: return 1.6;
                case 3: return 1;
                case 4: return 0.8;
                case 5: return 0.6;
                default: return 0.4;
            }
        },
        /**
         * 
         * @param {GameCores.GameObjects.Player} to 
         * @param {number}
         */
        attitude2: function (to) {
            return get.attitude(_status.event.player, to);
        },
    };
    /**
     * AI
     * @namespace
     * @global
     */
    var ai = /**@lends ai */ {
        basic: {
            chooseButton: function (check) {
                var event = _status.event;
                var i, j, range, buttons, buttons2;
                var ok = false, forced = event.forced;
                var iwhile = 100;
                while (iwhile--) {
                    range = get.select(event.selectButton);
                    if (range[1] == -1) {
                        j = 0;
                        for (i = 0; i &lt; ui.selected.buttons.length; i++) {
                            j += check(ui.selected.buttons[i]);
                        }
                        return (j > 0);
                    }
                    buttons = get.selectableButtons();
                    if (buttons.length == 0) {
                        return ok;
                    }
                    buttons2 = buttons.slice(0);
                    var ix = 0;
                    var checkix = check(buttons[0], buttons2);
                    for (i = 1; i &lt; buttons.length; i++) {
                        var checkixtmp = check(buttons[i], buttons2);
                        if (checkixtmp > checkix) {
                            ix = i;
                            checkix = checkixtmp;
                        }
                    }
                    // buttons.sort(function(a,b){
                    //     return check(b,buttons2)-check(a,buttons2);
                    // });
                    if (check(buttons[ix]) &lt;= 0) {
                        if (!forced || ok) {
                            return ok;
                        }
                    }
                    buttons[ix].classList.add('selected');
                    ui.selected.buttons.add(buttons[ix]);
                    game.check();
                    if (ui.selected.buttons.length >= range[0]) {
                        ok = true;
                    }
                    if (ui.selected.buttons.length == range[1]) {
                        return true;
                    }
                }
            },
            chooseCard: function (check) {
                var event = _status.event;
                if (event.filterCard == undefined) return (check() > 0);
                var i, j, range, cards, cards2, skills, check, effect;
                var ok = false, forced = event.forced;
                var iwhile = 100;
                while (iwhile--) {
                    range = get.select(event.selectCard);
                    if (ui.selected.cards.length >= range[0]) {
                        ok = true;
                    }
                    if (range[1] == -1) {
                        if (ui.selected.cards.length == 0) return true;
                        j = 0;
                        for (i = 0; i &lt; ui.selected.cards.length; i++) {
                            effect = check(ui.selected.cards[i]);
                            if (effect &lt; 0) j -= Math.sqrt(-effect);
                            else j += Math.sqrt(effect);
                        }
                        return (j > 0);
                    }
                    cards = get.selectableCards();
                    if (!_status.event.player._noSkill) {
                        cards = cards.concat(get.skills());
                    }
                    if (cards.length == 0) {
                        return ok;
                    }
                    cards2 = cards.slice(0);
                    // cards.sort(function(a,b){
                    //     return (check(b,cards2)-check(a,cards2));
                    // });
                    var ix = 0;
                    var checkix = check(cards[0], cards2);
                    for (i = 1; i &lt; cards.length; i++) {
                        var checkixtmp = check(cards[i], cards2);
                        if (checkixtmp > checkix) {
                            ix = i;
                            checkix = checkixtmp;
                        }
                    }
                    if (check(cards[ix]) &lt;= 0) {
                        if (!forced || ok) {
                            return ok;
                        }
                    }
                    if (typeof cards[ix] == 'string') {
                        ui.click.skill(cards[ix]);
                        var info = get.info(event.skill);
                        if (info.filterCard) {
                            check = info.check || get.unuseful2;
                            return (ai.basic.chooseCard(check));
                        }
                        else {
                            return true;
                        }
                    }
                    else {
                        cards[ix].classList.add('selected');
                        ui.selected.cards.add(cards[ix]);
                        game.check();
                        if (ui.selected.cards.length >= range[ix]) {
                            ok = true;
                        }
                        if (ui.selected.cards.length == range[1]) {
                            return true;
                        }
                    }
                }
            },
            chooseTarget: function (check) {
                var event = _status.event;
                if (event.filterTarget == undefined) return (check() > 0);
                var i, j, range, targets, targets2, effect;
                var ok = false, forced = event.forced;
                var iwhile = 100;
                while (iwhile--) {
                    range = get.select(event.selectTarget);
                    if (range[1] == -1) {
                        j = 0;
                        for (i = 0; i &lt; ui.selected.targets.length; i++) {
                            effect = check(ui.selected.targets[i]);
                            if (effect &lt; 0) j -= Math.sqrt(-effect);
                            else j += Math.sqrt(effect);
                        }
                        return (j > 0);
                    }
                    else if (range[1] == 0) {
                        return check() > 0
                    }
                    targets = get.selectableTargets();
                    if (targets.length == 0) {
                        return range[0] == 0 || ok;
                    }
                    targets2 = targets.slice(0);
                    // targets.sort(function(a,b){
                    //     return check(b)-check(a);
                    // });
                    var ix = 0;
                    var checkix = check(targets[0], targets2);
                    for (i = 1; i &lt; targets.length; i++) {
                        var checkixtmp = check(targets[i], targets2);
                        if (checkixtmp > checkix) {
                            ix = i;
                            checkix = checkixtmp;
                        }
                    }
                    if (check(targets[ix]) &lt;= 0) {
                        if (!forced || ok) {
                            return ok;
                        }
                    }
                    targets[ix].classList.add('selected');
                    ui.selected.targets.add(targets[ix]);
                    game.check();
                    if (ui.selected.targets.length >= range[0]) {
                        ok = true;
                    }
                    if (ui.selected.targets.length == range[1]) {
                        return true;
                    }
                }
            }
        },
        /**
         * AI
         * @see {@link get}
         */
        get: get
    };

	lib.init.init();
}());
</code></pre>
        </article>
    </section>




    </div>

    <footer class="footer" id="footer">
      
    </footer>

    <script src="scripts/third-party/prettify.js"></script>
    <script src="scripts/third-party/lang-css.js"></script>
    <script type="text/javascript" src="scripts/misc.js"></script>

    <script>prettyPrint();</script>
    <script src="scripts/linenumber.js"></script>
    <script src="scripts/fix-code-block.js"></script>
    <script src="scripts/fix-navbar.js"></script>
    
      <script src="scripts/search.js"></script>
      <script src="scripts/third-party/fuse.js"></script>
      <script>
        var list = [{"title":"Array","link":"<a href=\"Array.html\">Array</a>"},{"title":"Array#add","link":"<a href=\"Array.html#add\">Array &rtrif; add</a>"},{"title":"Array#add","link":"<a href=\"Array.html#add\">Array &rtrif; add</a>"},{"title":"Array#addArray","link":"<a href=\"Array.html#addArray\">Array &rtrif; addArray</a>"},{"title":"Array#addArray","link":"<a href=\"Array.html#addArray\">Array &rtrif; addArray</a>"},{"title":"Array#contains","link":"<a href=\"Array.html#contains\">Array &rtrif; contains</a>"},{"title":"Array#contains","link":"<a href=\"Array.html#contains\">Array &rtrif; contains</a>"},{"title":"Array#filterInD","link":"<a href=\"Array.html#filterInD\">Array &rtrif; filterInD</a>"},{"title":"Array#filterInD","link":"<a href=\"Array.html#filterInD\">Array &rtrif; filterInD</a>"},{"title":"Array#find","link":"<a href=\"Array.html#find\">Array &rtrif; find</a>"},{"title":"Array#find","link":"<a href=\"Array.html#find\">Array &rtrif; find</a>"},{"title":"Array#from","link":"<a href=\"Array.html#from\">Array &rtrif; from</a>"},{"title":"Array#from","link":"<a href=\"Array.html#from\">Array &rtrif; from</a>"},{"title":"Array#numOf","link":"<a href=\"Array.html#numOf\">Array &rtrif; numOf</a>"},{"title":"Array#numOf","link":"<a href=\"Array.html#numOf\">Array &rtrif; numOf</a>"},{"title":"Array#randomGet","link":"<a href=\"Array.html#randomGet\">Array &rtrif; randomGet</a>"},{"title":"Array#randomGet","link":"<a href=\"Array.html#randomGet\">Array &rtrif; randomGet</a>"},{"title":"Array#randomGet","link":"<a href=\"Array.html#randomGet\">Array &rtrif; randomGet</a>"},{"title":"Array#randomGet","link":"<a href=\"Array.html#randomGet\">Array &rtrif; randomGet</a>"},{"title":"Array#randomRemove","link":"<a href=\"Array.html#randomRemove\">Array &rtrif; randomRemove</a>"},{"title":"Array#randomRemove","link":"<a href=\"Array.html#randomRemove\">Array &rtrif; randomRemove</a>"},{"title":"Array#randomSort","link":"<a href=\"Array.html#randomSort\">Array &rtrif; randomSort</a>"},{"title":"Array#randomSort","link":"<a href=\"Array.html#randomSort\">Array &rtrif; randomSort</a>"},{"title":"Array#remove","link":"<a href=\"Array.html#remove\">Array &rtrif; remove</a>"},{"title":"Array#remove","link":"<a href=\"Array.html#remove\">Array &rtrif; remove</a>"},{"title":"Array#removeArray","link":"<a href=\"Array.html#removeArray\">Array &rtrif; removeArray</a>"},{"title":"Array#removeArray","link":"<a href=\"Array.html#removeArray\">Array &rtrif; removeArray</a>"},{"title":"Array#sortBySeat","link":"<a href=\"Array.html#sortBySeat\">Array &rtrif; sortBySeat</a>"},{"title":"Array#sortBySeat","link":"<a href=\"Array.html#sortBySeat\">Array &rtrif; sortBySeat</a>"},{"title":"Error","link":"<a href=\"Error.html\">Error</a>"},{"title":"HTMLDivElement","link":"<a href=\"HTMLDivElement.html\">HTMLDivElement</a>"},{"title":"HTMLDivElement#animate","link":"<a href=\"HTMLDivElement.html#animate\">HTMLDivElement &rtrif; animate</a>"},{"title":"HTMLDivElement#animate","link":"<a href=\"HTMLDivElement.html#animate\">HTMLDivElement &rtrif; animate</a>"},{"title":"HTMLDivElement#css","link":"<a href=\"HTMLDivElement.html#css\">HTMLDivElement &rtrif; css</a>"},{"title":"HTMLDivElement#css","link":"<a href=\"HTMLDivElement.html#css\">HTMLDivElement &rtrif; css</a>"},{"title":"HTMLDivElement#delete","link":"<a href=\"HTMLDivElement.html#delete\">HTMLDivElement &rtrif; delete</a>"},{"title":"HTMLDivElement#delete","link":"<a href=\"HTMLDivElement.html#delete\">HTMLDivElement &rtrif; delete</a>"},{"title":"HTMLDivElement#fix","link":"<a href=\"HTMLDivElement.html#fix\">HTMLDivElement &rtrif; fix</a>"},{"title":"HTMLDivElement#fix","link":"<a href=\"HTMLDivElement.html#fix\">HTMLDivElement &rtrif; fix</a>"},{"title":"HTMLDivElement#goto","link":"<a href=\"HTMLDivElement.html#goto\">HTMLDivElement &rtrif; goto</a>"},{"title":"HTMLDivElement#goto","link":"<a href=\"HTMLDivElement.html#goto\">HTMLDivElement &rtrif; goto</a>"},{"title":"HTMLDivElement#hide","link":"<a href=\"HTMLDivElement.html#hide\">HTMLDivElement &rtrif; hide</a>"},{"title":"HTMLDivElement#hide","link":"<a href=\"HTMLDivElement.html#hide\">HTMLDivElement &rtrif; hide</a>"},{"title":"HTMLDivElement#listen","link":"<a href=\"HTMLDivElement.html#listen\">HTMLDivElement &rtrif; listen</a>"},{"title":"HTMLDivElement#listen","link":"<a href=\"HTMLDivElement.html#listen\">HTMLDivElement &rtrif; listen</a>"},{"title":"HTMLDivElement#listenTransition","link":"<a href=\"HTMLDivElement.html#listenTransition\">HTMLDivElement &rtrif; listenTransition</a>"},{"title":"HTMLDivElement#listenTransition","link":"<a href=\"HTMLDivElement.html#listenTransition\">HTMLDivElement &rtrif; listenTransition</a>"},{"title":"HTMLDivElement#refocus","link":"<a href=\"HTMLDivElement.html#refocus\">HTMLDivElement &rtrif; refocus</a>"},{"title":"HTMLDivElement#refocus","link":"<a href=\"HTMLDivElement.html#refocus\">HTMLDivElement &rtrif; refocus</a>"},{"title":"HTMLDivElement#setBackground","link":"<a href=\"HTMLDivElement.html#setBackground\">HTMLDivElement &rtrif; setBackground</a>"},{"title":"HTMLDivElement#setBackground","link":"<a href=\"HTMLDivElement.html#setBackground\">HTMLDivElement &rtrif; setBackground</a>"},{"title":"HTMLDivElement#setBackgroundDB","link":"<a href=\"HTMLDivElement.html#setBackgroundDB\">HTMLDivElement &rtrif; setBackgroundDB</a>"},{"title":"HTMLDivElement#setBackgroundDB","link":"<a href=\"HTMLDivElement.html#setBackgroundDB\">HTMLDivElement &rtrif; setBackgroundDB</a>"},{"title":"HTMLDivElement#setBackgroundImage","link":"<a href=\"HTMLDivElement.html#setBackgroundImage\">HTMLDivElement &rtrif; setBackgroundImage</a>"},{"title":"HTMLDivElement#setBackgroundImage","link":"<a href=\"HTMLDivElement.html#setBackgroundImage\">HTMLDivElement &rtrif; setBackgroundImage</a>"},{"title":"HTMLDivElement#setPosition","link":"<a href=\"HTMLDivElement.html#setPosition\">HTMLDivElement &rtrif; setPosition</a>"},{"title":"HTMLDivElement#setPosition","link":"<a href=\"HTMLDivElement.html#setPosition\">HTMLDivElement &rtrif; setPosition</a>"},{"title":"HTMLDivElement#setPosition(2)","link":"<a href=\"HTMLDivElement.html#setPosition2\">HTMLDivElement &rtrif; setPosition(2)</a>"},{"title":"HTMLDivElement#setPosition(2)","link":"<a href=\"HTMLDivElement.html#setPosition2\">HTMLDivElement &rtrif; setPosition(2)</a>"},{"title":"HTMLDivElement#show","link":"<a href=\"HTMLDivElement.html#show\">HTMLDivElement &rtrif; show</a>"},{"title":"HTMLDivElement#show","link":"<a href=\"HTMLDivElement.html#show\">HTMLDivElement &rtrif; show</a>"},{"title":"HTMLDivElement#unfocus","link":"<a href=\"HTMLDivElement.html#unfocus\">HTMLDivElement &rtrif; unfocus</a>"},{"title":"HTMLDivElement#unfocus","link":"<a href=\"HTMLDivElement.html#unfocus\">HTMLDivElement &rtrif; unfocus</a>"},{"title":"HTMLDivElementProxyProxy","link":"<a href=\"HTMLDivElementProxyProxy.html\">HTMLDivElementProxyProxy</a>"},{"title":"HTMLTableCellElement","link":"<a href=\"HTMLTableCellElement.html\">HTMLTableCellElement</a>"},{"title":"HTMLTableElement","link":"<a href=\"HTMLTableElement.html\">HTMLTableElement</a>"},{"title":"HTMLTableElement#get","link":"<a href=\"HTMLTableElement.html#get\">HTMLTableElement &rtrif; get</a>"},{"title":"HTMLTableElement#get","link":"<a href=\"HTMLTableElement.html#get\">HTMLTableElement &rtrif; get</a>"},{"title":"Module","link":"<a href=\"module-moduleManager-Module.html\">Module</a>"},{"title":"module:moduleManager~Module#get","link":"<a href=\"module-moduleManager-Module.html#get\">module:moduleManager~Module &rtrif; get</a>"},{"title":"module:moduleManager~Module#init","link":"<a href=\"module-moduleManager-Module.html#init\">module:moduleManager~Module &rtrif; init</a>"},{"title":"module:moduleManager~Module#then","link":"<a href=\"module-moduleManager-Module.html#then\">module:moduleManager~Module &rtrif; then</a>"},{"title":"PlayerModel","link":"<a href=\"PlayerModel.html\">PlayerModel</a>"},{"title":"PlayerModel#$damagepop","link":"<a href=\"PlayerModel.html#$damagepop\">PlayerModel &rtrif; $damagepop</a>"},{"title":"PlayerModel#$showCharacter","link":"<a href=\"PlayerModel.html#$showCharacter\">PlayerModel &rtrif; $showCharacter</a>"},{"title":"PlayerModel#$skill","link":"<a href=\"PlayerModel.html#$skill\">PlayerModel &rtrif; $skill</a>"},{"title":"PlayerModel#$throwEmotion","link":"<a href=\"PlayerModel.html#$throwEmotion\">PlayerModel &rtrif; $throwEmotion</a>"},{"title":"PlayerModel#addAdditionalSkill","link":"<a href=\"PlayerModel.html#addAdditionalSkill\">PlayerModel &rtrif; addAdditionalSkill</a>"},{"title":"PlayerModel#addEquipTrigger","link":"<a href=\"PlayerModel.html#addEquipTrigger\">PlayerModel &rtrif; addEquipTrigger</a>"},{"title":"PlayerModel#addGaintag","link":"<a href=\"PlayerModel.html#addGaintag\">PlayerModel &rtrif; addGaintag</a>"},{"title":"PlayerModel#addMark","link":"<a href=\"PlayerModel.html#addMark\">PlayerModel &rtrif; addMark</a>"},{"title":"PlayerModel#addSkillBlocker","link":"<a href=\"PlayerModel.html#addSkillBlocker\">PlayerModel &rtrif; addSkillBlocker</a>"},{"title":"PlayerModel#addSkillLog","link":"<a href=\"PlayerModel.html#addSkillLog\">PlayerModel &rtrif; addSkillLog</a>"},{"title":"PlayerModel#addSkillTrigger","link":"<a href=\"PlayerModel.html#addSkillTrigger\">PlayerModel &rtrif; addSkillTrigger</a>"},{"title":"PlayerModel#addSubPlayer","link":"<a href=\"PlayerModel.html#addSubPlayer\">PlayerModel &rtrif; addSubPlayer</a>"},{"title":"PlayerModel#addTempSkill","link":"<a href=\"PlayerModel.html#addTempSkill\">PlayerModel &rtrif; addTempSkill</a>"},{"title":"PlayerModel#addToJudge","link":"<a href=\"PlayerModel.html#addToJudge\">PlayerModel &rtrif; addToJudge</a>"},{"title":"PlayerModel#applySkills","link":"<a href=\"PlayerModel.html#applySkills\">PlayerModel &rtrif; applySkills</a>"},{"title":"PlayerModel#attitudeTo","link":"<a href=\"PlayerModel.html#attitudeTo\">PlayerModel &rtrif; attitudeTo</a>"},{"title":"PlayerModel#awakenSkill","link":"<a href=\"PlayerModel.html#awakenSkill\">PlayerModel &rtrif; awakenSkill</a>"},{"title":"PlayerModel#buffAvatar","link":"<a href=\"PlayerModel.html#buffAvatar\">PlayerModel &rtrif; buffAvatar</a>"},{"title":"PlayerModel#callSubPlayer","link":"<a href=\"PlayerModel.html#callSubPlayer\">PlayerModel &rtrif; callSubPlayer</a>"},{"title":"PlayerModel#canAddToJudge","link":"<a href=\"PlayerModel.html#canAddToJudge\">PlayerModel &rtrif; canAddToJudge</a>"},{"title":"PlayerModel#canSave","link":"<a href=\"PlayerModel.html#canSave\">PlayerModel &rtrif; canSave</a>"},{"title":"PlayerModel#canUse","link":"<a href=\"PlayerModel.html#canUse\">PlayerModel &rtrif; canUse</a>"},{"title":"PlayerModel#changeSeat","link":"<a href=\"PlayerModel.html#changeSeat\">PlayerModel &rtrif; changeSeat</a>"},{"title":"PlayerModel#chat","link":"<a href=\"PlayerModel.html#chat\">PlayerModel &rtrif; chat</a>"},{"title":"PlayerModel#checkConflict","link":"<a href=\"PlayerModel.html#checkConflict\">PlayerModel &rtrif; checkConflict</a>"},{"title":"PlayerModel#checkMarks","link":"<a href=\"PlayerModel.html#checkMarks\">PlayerModel &rtrif; checkMarks</a>"},{"title":"PlayerModel#chooseToGuanxing","link":"<a href=\"PlayerModel.html#chooseToGuanxing\">PlayerModel &rtrif; chooseToGuanxing</a>"},{"title":"PlayerModel#clearSkills","link":"<a href=\"PlayerModel.html#clearSkills\">PlayerModel &rtrif; clearSkills</a>"},{"title":"PlayerModel#countMark","link":"<a href=\"PlayerModel.html#countMark\">PlayerModel &rtrif; countMark</a>"},{"title":"PlayerModel#directgains","link":"<a href=\"PlayerModel.html#directgains\">PlayerModel &rtrif; directgains</a>"},{"title":"PlayerModel#disableSkill","link":"<a href=\"PlayerModel.html#disableSkill\">PlayerModel &rtrif; disableSkill</a>"},{"title":"PlayerModel#emotion","link":"<a href=\"PlayerModel.html#emotion\">PlayerModel &rtrif; emotion</a>"},{"title":"PlayerModel#enableSkill","link":"<a href=\"PlayerModel.html#enableSkill\">PlayerModel &rtrif; enableSkill</a>"},{"title":"PlayerModel#exitSubPlayer","link":"<a href=\"PlayerModel.html#exitSubPlayer\">PlayerModel &rtrif; exitSubPlayer</a>"},{"title":"PlayerModel#flashAvatar","link":"<a href=\"PlayerModel.html#flashAvatar\">PlayerModel &rtrif; flashAvatar</a>"},{"title":"PlayerModel#get","link":"<a href=\"PlayerModel.html#get\">PlayerModel &rtrif; get</a>"},{"title":"PlayerModel#getAllHistory","link":"<a href=\"PlayerModel.html#getAllHistory\">PlayerModel &rtrif; getAllHistory</a>"},{"title":"PlayerModel#getAttackRange","link":"<a href=\"PlayerModel.html#getAttackRange\">PlayerModel &rtrif; getAttackRange</a>"},{"title":"PlayerModel#getCardUsable","link":"<a href=\"PlayerModel.html#getCardUsable\">PlayerModel &rtrif; getCardUsable</a>"},{"title":"PlayerModel#getDamagedHp","link":"<a href=\"PlayerModel.html#getDamagedHp\">PlayerModel &rtrif; getDamagedHp</a>"},{"title":"PlayerModel#getEquip","link":"<a href=\"PlayerModel.html#getEquip\">PlayerModel &rtrif; getEquip</a>"},{"title":"PlayerModel#getGlobalFrom","link":"<a href=\"PlayerModel.html#getGlobalFrom\">PlayerModel &rtrif; getGlobalFrom</a>"},{"title":"PlayerModel#getGlobalTo","link":"<a href=\"PlayerModel.html#getGlobalTo\">PlayerModel &rtrif; getGlobalTo</a>"},{"title":"PlayerModel#getHandcardLimit","link":"<a href=\"PlayerModel.html#getHandcardLimit\">PlayerModel &rtrif; getHandcardLimit</a>"},{"title":"PlayerModel#getHistory","link":"<a href=\"PlayerModel.html#getHistory\">PlayerModel &rtrif; getHistory</a>"},{"title":"PlayerModel#getId","link":"<a href=\"PlayerModel.html#getId\">PlayerModel &rtrif; getId</a>"},{"title":"PlayerModel#getJudge","link":"<a href=\"PlayerModel.html#getJudge\">PlayerModel &rtrif; getJudge</a>"},{"title":"PlayerModel#getLastHistory","link":"<a href=\"PlayerModel.html#getLastHistory\">PlayerModel &rtrif; getLastHistory</a>"},{"title":"PlayerModel#getLastStat","link":"<a href=\"PlayerModel.html#getLastStat\">PlayerModel &rtrif; getLastStat</a>"},{"title":"PlayerModel#getLastUsed","link":"<a href=\"PlayerModel.html#getLastUsed\">PlayerModel &rtrif; getLastUsed</a>"},{"title":"PlayerModel#getLeft","link":"<a href=\"PlayerModel.html#getLeft\">PlayerModel &rtrif; getLeft</a>"},{"title":"PlayerModel#getSkills","link":"<a href=\"PlayerModel.html#getSkills\">PlayerModel &rtrif; getSkills</a>"},{"title":"PlayerModel#getStat","link":"<a href=\"PlayerModel.html#getStat\">PlayerModel &rtrif; getStat</a>"},{"title":"PlayerModel#getState","link":"<a href=\"PlayerModel.html#getState\">PlayerModel &rtrif; getState</a>"},{"title":"PlayerModel#getSubPlayers","link":"<a href=\"PlayerModel.html#getSubPlayers\">PlayerModel &rtrif; getSubPlayers</a>"},{"title":"PlayerModel#getTop","link":"<a href=\"PlayerModel.html#getTop\">PlayerModel &rtrif; getTop</a>"},{"title":"PlayerModel#getUseValue","link":"<a href=\"PlayerModel.html#getUseValue\">PlayerModel &rtrif; getUseValue</a>"},{"title":"PlayerModel#goMad","link":"<a href=\"PlayerModel.html#goMad\">PlayerModel &rtrif; goMad</a>"},{"title":"PlayerModel#hasCardAround","link":"<a href=\"PlayerModel.html#hasCardAround\">PlayerModel &rtrif; hasCardAround</a>"},{"title":"PlayerModel#hasMark","link":"<a href=\"PlayerModel.html#hasMark\">PlayerModel &rtrif; hasMark</a>"},{"title":"PlayerModel#hasSkill","link":"<a href=\"PlayerModel.html#hasSkill\">PlayerModel &rtrif; hasSkill</a>"},{"title":"PlayerModel#hasUseTarget","link":"<a href=\"PlayerModel.html#hasUseTarget\">PlayerModel &rtrif; hasUseTarget</a>"},{"title":"PlayerModel#hasValueTarget","link":"<a href=\"PlayerModel.html#hasValueTarget\">PlayerModel &rtrif; hasValueTarget</a>"},{"title":"PlayerModel#init","link":"<a href=\"PlayerModel.html#init\">PlayerModel &rtrif; init</a>"},{"title":"PlayerModel#initOL","link":"<a href=\"PlayerModel.html#initOL\">PlayerModel &rtrif; initOL</a>"},{"title":"PlayerModel#initRoom","link":"<a href=\"PlayerModel.html#initRoom\">PlayerModel &rtrif; initRoom</a>"},{"title":"PlayerModel#inRange","link":"<a href=\"PlayerModel.html#inRange\">PlayerModel &rtrif; inRange</a>"},{"title":"PlayerModel#inRangeOf","link":"<a href=\"PlayerModel.html#inRangeOf\">PlayerModel &rtrif; inRangeOf</a>"},{"title":"PlayerModel#isAlive","link":"<a href=\"PlayerModel.html#isAlive\">PlayerModel &rtrif; isAlive</a>"},{"title":"PlayerModel#isDamaged","link":"<a href=\"PlayerModel.html#isDamaged\">PlayerModel &rtrif; isDamaged</a>"},{"title":"PlayerModel#isDead","link":"<a href=\"PlayerModel.html#isDead\">PlayerModel &rtrif; isDead</a>"},{"title":"PlayerModel#isDying","link":"<a href=\"PlayerModel.html#isDying\">PlayerModel &rtrif; isDying</a>"},{"title":"PlayerModel#isEnemiesOf","link":"<a href=\"PlayerModel.html#isEnemiesOf\">PlayerModel &rtrif; isEnemiesOf</a>"},{"title":"PlayerModel#isEnemyOf","link":"<a href=\"PlayerModel.html#isEnemyOf\">PlayerModel &rtrif; isEnemyOf</a>"},{"title":"PlayerModel#isFriendOf","link":"<a href=\"PlayerModel.html#isFriendOf\">PlayerModel &rtrif; isFriendOf</a>"},{"title":"PlayerModel#isFriendsOf","link":"<a href=\"PlayerModel.html#isFriendsOf\">PlayerModel &rtrif; isFriendsOf</a>"},{"title":"PlayerModel#isHealthy","link":"<a href=\"PlayerModel.html#isHealthy\">PlayerModel &rtrif; isHealthy</a>"},{"title":"PlayerModel#isIn","link":"<a href=\"PlayerModel.html#isIn\">PlayerModel &rtrif; isIn</a>"},{"title":"PlayerModel#isLinked","link":"<a href=\"PlayerModel.html#isLinked\">PlayerModel &rtrif; isLinked</a>"},{"title":"PlayerModel#isMad","link":"<a href=\"PlayerModel.html#isMad\">PlayerModel &rtrif; isMad</a>"},{"title":"PlayerModel#isMaxCard","link":"<a href=\"PlayerModel.html#isMaxCard\">PlayerModel &rtrif; isMaxCard</a>"},{"title":"PlayerModel#isMaxEquip","link":"<a href=\"PlayerModel.html#isMaxEquip\">PlayerModel &rtrif; isMaxEquip</a>"},{"title":"PlayerModel#isMaxHandcard","link":"<a href=\"PlayerModel.html#isMaxHandcard\">PlayerModel &rtrif; isMaxHandcard</a>"},{"title":"PlayerModel#isMaxHp","link":"<a href=\"PlayerModel.html#isMaxHp\">PlayerModel &rtrif; isMaxHp</a>"},{"title":"PlayerModel#isMin","link":"<a href=\"PlayerModel.html#isMin\">PlayerModel &rtrif; isMin</a>"},{"title":"PlayerModel#isMinCard","link":"<a href=\"PlayerModel.html#isMinCard\">PlayerModel &rtrif; isMinCard</a>"},{"title":"PlayerModel#isMinEquip","link":"<a href=\"PlayerModel.html#isMinEquip\">PlayerModel &rtrif; isMinEquip</a>"},{"title":"PlayerModel#isMinHandcard","link":"<a href=\"PlayerModel.html#isMinHandcard\">PlayerModel &rtrif; isMinHandcard</a>"},{"title":"PlayerModel#isMinHp","link":"<a href=\"PlayerModel.html#isMinHp\">PlayerModel &rtrif; isMinHp</a>"},{"title":"PlayerModel#isOffline","link":"<a href=\"PlayerModel.html#isOffline\">PlayerModel &rtrif; isOffline</a>"},{"title":"PlayerModel#isOnline","link":"<a href=\"PlayerModel.html#isOnline\">PlayerModel &rtrif; isOnline</a>"},{"title":"PlayerModel#isOnline2","link":"<a href=\"PlayerModel.html#isOnline2\">PlayerModel &rtrif; isOnline2</a>"},{"title":"PlayerModel#isOut","link":"<a href=\"PlayerModel.html#isOut\">PlayerModel &rtrif; isOut</a>"},{"title":"PlayerModel#isTurnedOver","link":"<a href=\"PlayerModel.html#isTurnedOver\">PlayerModel &rtrif; isTurnedOver</a>"},{"title":"PlayerModel#isUnderControl","link":"<a href=\"PlayerModel.html#isUnderControl\">PlayerModel &rtrif; isUnderControl</a>"},{"title":"PlayerModel#isUnseen","link":"<a href=\"PlayerModel.html#isUnseen\">PlayerModel &rtrif; isUnseen</a>"},{"title":"PlayerModel#judge","link":"<a href=\"PlayerModel.html#judge\">PlayerModel &rtrif; judge</a>"},{"title":"PlayerModel#link","link":"<a href=\"PlayerModel.html#link\">PlayerModel &rtrif; link</a>"},{"title":"PlayerModel#logSkill","link":"<a href=\"PlayerModel.html#logSkill\">PlayerModel &rtrif; logSkill</a>"},{"title":"PlayerModel#loseToSpecial","link":"<a href=\"PlayerModel.html#loseToSpecial\">PlayerModel &rtrif; loseToSpecial</a>"},{"title":"PlayerModel#mark","link":"<a href=\"PlayerModel.html#mark\">PlayerModel &rtrif; mark</a>"},{"title":"PlayerModel#needsToDiscard","link":"<a href=\"PlayerModel.html#needsToDiscard\">PlayerModel &rtrif; needsToDiscard</a>"},{"title":"PlayerModel#popup","link":"<a href=\"PlayerModel.html#popup\">PlayerModel &rtrif; popup</a>"},{"title":"PlayerModel#queue","link":"<a href=\"PlayerModel.html#queue\">PlayerModel &rtrif; queue</a>"},{"title":"PlayerModel#reinit","link":"<a href=\"PlayerModel.html#reinit\">PlayerModel &rtrif; reinit</a>"},{"title":"PlayerModel#removeAdditionalSkill","link":"<a href=\"PlayerModel.html#removeAdditionalSkill\">PlayerModel &rtrif; removeAdditionalSkill</a>"},{"title":"PlayerModel#removeEquipTrigger","link":"<a href=\"PlayerModel.html#removeEquipTrigger\">PlayerModel &rtrif; removeEquipTrigger</a>"},{"title":"PlayerModel#removeGaintag","link":"<a href=\"PlayerModel.html#removeGaintag\">PlayerModel &rtrif; removeGaintag</a>"},{"title":"PlayerModel#removeMark","link":"<a href=\"PlayerModel.html#removeMark\">PlayerModel &rtrif; removeMark</a>"},{"title":"PlayerModel#removeSkill","link":"<a href=\"PlayerModel.html#removeSkill\">PlayerModel &rtrif; removeSkill</a>"},{"title":"PlayerModel#removeSkillBlocker","link":"<a href=\"PlayerModel.html#removeSkillBlocker\">PlayerModel &rtrif; removeSkillBlocker</a>"},{"title":"PlayerModel#removeSkillTrigger","link":"<a href=\"PlayerModel.html#removeSkillTrigger\">PlayerModel &rtrif; removeSkillTrigger</a>"},{"title":"PlayerModel#removeSubPlayer","link":"<a href=\"PlayerModel.html#removeSubPlayer\">PlayerModel &rtrif; removeSubPlayer</a>"},{"title":"PlayerModel#restoreSkill","link":"<a href=\"PlayerModel.html#restoreSkill\">PlayerModel &rtrif; restoreSkill</a>"},{"title":"PlayerModel#say","link":"<a href=\"PlayerModel.html#say\">PlayerModel &rtrif; say</a>"},{"title":"PlayerModel#send","link":"<a href=\"PlayerModel.html#send\">PlayerModel &rtrif; send</a>"},{"title":"PlayerModel#setAvatar","link":"<a href=\"PlayerModel.html#setAvatar\">PlayerModel &rtrif; setAvatar</a>"},{"title":"PlayerModel#setAvatarQueue","link":"<a href=\"PlayerModel.html#setAvatarQueue\">PlayerModel &rtrif; setAvatarQueue</a>"},{"title":"PlayerModel#setIdentity","link":"<a href=\"PlayerModel.html#setIdentity\">PlayerModel &rtrif; setIdentity</a>"},{"title":"PlayerModel#setNickname","link":"<a href=\"PlayerModel.html#setNickname\">PlayerModel &rtrif; setNickname</a>"},{"title":"PlayerModel#showCharacter","link":"<a href=\"PlayerModel.html#showCharacter\">PlayerModel &rtrif; showCharacter</a>"},{"title":"PlayerModel#showGiveup","link":"<a href=\"PlayerModel.html#showGiveup\">PlayerModel &rtrif; showGiveup</a>"},{"title":"PlayerModel#smoothAvatar","link":"<a href=\"PlayerModel.html#smoothAvatar\">PlayerModel &rtrif; smoothAvatar</a>"},{"title":"PlayerModel#syncStorage","link":"<a href=\"PlayerModel.html#syncStorage\">PlayerModel &rtrif; syncStorage</a>"},{"title":"PlayerModel#throwEmotion","link":"<a href=\"PlayerModel.html#throwEmotion\">PlayerModel &rtrif; throwEmotion</a>"},{"title":"PlayerModel#toggleSubPlayer","link":"<a href=\"PlayerModel.html#toggleSubPlayer\">PlayerModel &rtrif; toggleSubPlayer</a>"},{"title":"PlayerModel#tryCardAnimate","link":"<a href=\"PlayerModel.html#tryCardAnimate\">PlayerModel &rtrif; tryCardAnimate</a>"},{"title":"PlayerModel#trySkillAnimate","link":"<a href=\"PlayerModel.html#trySkillAnimate\">PlayerModel &rtrif; trySkillAnimate</a>"},{"title":"PlayerModel#turnOver","link":"<a href=\"PlayerModel.html#turnOver\">PlayerModel &rtrif; turnOver</a>"},{"title":"PlayerModel#uninit","link":"<a href=\"PlayerModel.html#uninit\">PlayerModel &rtrif; uninit</a>"},{"title":"PlayerModel#uninitOL","link":"<a href=\"PlayerModel.html#uninitOL\">PlayerModel &rtrif; uninitOL</a>"},{"title":"PlayerModel#unMad","link":"<a href=\"PlayerModel.html#unMad\">PlayerModel &rtrif; unMad</a>"},{"title":"PlayerModel#unmark","link":"<a href=\"PlayerModel.html#unmark\">PlayerModel &rtrif; unmark</a>"},{"title":"PlayerModel#update","link":"<a href=\"PlayerModel.html#update\">PlayerModel &rtrif; update</a>"},{"title":"PlayerModel#updateMark","link":"<a href=\"PlayerModel.html#updateMark\">PlayerModel &rtrif; updateMark</a>"},{"title":"PlayerModel#updateMarks","link":"<a href=\"PlayerModel.html#updateMarks\">PlayerModel &rtrif; updateMarks</a>"},{"title":"PlayerModel#useResult","link":"<a href=\"PlayerModel.html#useResult\">PlayerModel &rtrif; useResult</a>"},{"title":"Subject","link":"<a href=\"Subject.html\">Subject</a>"},{"title":"Subject#set","link":"<a href=\"Subject.html#set\">Subject &rtrif; set</a>"},{"title":"core","link":"<a href=\"module-core.html\">core</a>"},{"title":"moduleManager","link":"<a href=\"module-moduleManager.html\">moduleManager</a>"},{"title":"module:moduleManager#define","link":"<a href=\"module-moduleManager.html#define\">module:moduleManager &rtrif; define</a>"},{"title":"module:moduleManager#require","link":"<a href=\"module-moduleManager.html#require\">module:moduleManager &rtrif; require</a>"},{"title":"module:moduleManager~checkModule","link":"<a href=\"module-moduleManager.html#~checkModule\">module:moduleManager~checkModule &rtrif; undefined</a>"},{"title":"module:moduleManager~createScript","link":"<a href=\"module-moduleManager.html#~createScript\">module:moduleManager~createScript &rtrif; undefined</a>"},{"title":"module:moduleManager~getModule","link":"<a href=\"module-moduleManager.html#~getModule\">module:moduleManager~getModule &rtrif; undefined</a>"},{"title":"module:moduleManager~immediateInvoke","link":"<a href=\"module-moduleManager.html#~immediateInvoke\">module:moduleManager~immediateInvoke &rtrif; undefined</a>"},{"title":"module:moduleManager~invokeOnReady","link":"<a href=\"module-moduleManager.html#~invokeOnReady\">module:moduleManager~invokeOnReady &rtrif; undefined</a>"},{"title":"module:moduleManager~setModule","link":"<a href=\"module-moduleManager.html#~setModule\">module:moduleManager~setModule &rtrif; undefined</a>"},{"title":"module:moduleManager~toUrl","link":"<a href=\"module-moduleManager.html#~toUrl\">module:moduleManager~toUrl &rtrif; undefined</a>"},{"title":"KeyboardEvent","link":"<a href=\"global.html#event:KeyboardEvent\">KeyboardEvent</a>"},{"title":"MouseEvent","link":"<a href=\"global.html#event:MouseEvent\">MouseEvent</a>"},{"title":"TouchEvent","link":"<a href=\"global.html#event:TouchEvent\">TouchEvent</a>"},{"title":"_status","link":"<a href=\"-_status.html\">_status</a>"},{"title":"ai","link":"<a href=\"ai.html\">ai</a>"},{"title":"configMenu","link":"<a href=\"configMenu.html\">configMenu</a>"},{"title":"content","link":"<a href=\"content.html\">content</a>"},{"title":"element","link":"<a href=\"element.html\">element</a>"},{"title":"game","link":"<a href=\"game.html\">game</a>"},{"title":"game.addCard","link":"<a href=\"game.html#.addCard\">game.addCard &rtrif; undefined</a>"},{"title":"game.addCardPack","link":"<a href=\"game.html#.addCardPack\">game.addCardPack &rtrif; undefined</a>"},{"title":"game.addCharacter","link":"<a href=\"game.html#.addCharacter\">game.addCharacter &rtrif; undefined</a>"},{"title":"game.addCharacterPack","link":"<a href=\"game.html#.addCharacterPack\">game.addCharacterPack &rtrif; undefined</a>"},{"title":"game.addGlobalSkill","link":"<a href=\"game.html#.addGlobalSkill\">game.addGlobalSkill &rtrif; undefined</a>"},{"title":"game.addMode","link":"<a href=\"game.html#.addMode\">game.addMode &rtrif; undefined</a>"},{"title":"game.addSkill","link":"<a href=\"game.html#.addSkill\">game.addSkill &rtrif; undefined</a>"},{"title":"game.check","link":"<a href=\"game.html#.check\">game.check &rtrif; undefined</a>"},{"title":"game.clearModeConfig","link":"<a href=\"game.html#.clearModeConfig\">game.clearModeConfig &rtrif; undefined</a>"},{"title":"game.countGroup","link":"<a href=\"game.html#.countGroup\">game.countGroup &rtrif; undefined</a>"},{"title":"game.countPlayer","link":"<a href=\"game.html#.countPlayer\">game.countPlayer &rtrif; undefined</a>"},{"title":"game.countPlayer2","link":"<a href=\"game.html#.countPlayer2\">game.countPlayer2 &rtrif; undefined</a>"},{"title":"game.createEvent","link":"<a href=\"game.html#.createEvent\">game.createEvent &rtrif; undefined</a>"},{"title":"game.createTrigger","link":"<a href=\"game.html#.createTrigger\">game.createTrigger &rtrif; undefined</a>"},{"title":"game.deleteDB","link":"<a href=\"game.html#.deleteDB\">game.deleteDB &rtrif; undefined</a>"},{"title":"game.expandSkills","link":"<a href=\"game.html#.expandSkills\">game.expandSkills &rtrif; undefined</a>"},{"title":"game.filterSkills","link":"<a href=\"game.html#.filterSkills\">game.filterSkills &rtrif; undefined</a>"},{"title":"game.finishCards","link":"<a href=\"game.html#.finishCards\">game.finishCards &rtrif; undefined</a>"},{"title":"game.finishSkill","link":"<a href=\"game.html#.finishSkill\">game.finishSkill &rtrif; undefined</a>"},{"title":"game.getDB","link":"<a href=\"game.html#.getDB\">game.getDB &rtrif; undefined</a>"},{"title":"game.getExtensionConfig","link":"<a href=\"game.html#.getExtensionConfig\">game.getExtensionConfig &rtrif; undefined</a>"},{"title":"game.hasPlayer","link":"<a href=\"game.html#.hasPlayer\">game.hasPlayer &rtrif; undefined</a>"},{"title":"game.hasPlayer2","link":"<a href=\"game.html#.hasPlayer2\">game.hasPlayer2 &rtrif; undefined</a>"},{"title":"game.import","link":"<a href=\"game.html#.import\">game.import &rtrif; undefined</a>"},{"title":"game.loop","link":"<a href=\"game.html#.loop\">game.loop &rtrif; undefined</a>"},{"title":"game.putDB","link":"<a href=\"game.html#.putDB\">game.putDB &rtrif; undefined</a>"},{"title":"game.saveConfig","link":"<a href=\"game.html#.saveConfig\">game.saveConfig &rtrif; undefined</a>"},{"title":"game.saveConfigValue","link":"<a href=\"game.html#.saveConfigValue\">game.saveConfigValue &rtrif; undefined</a>"},{"title":"game.saveExtensionConfig","link":"<a href=\"game.html#.saveExtensionConfig\">game.saveExtensionConfig &rtrif; undefined</a>"},{"title":"game.showPlayerCard","link":"<a href=\"game.html#.showPlayerCard\">game.showPlayerCard &rtrif; undefined</a>"},{"title":"GameCores","link":"<a href=\"GameCores.html\">GameCores</a>"},{"title":"Bases","link":"<a href=\"GameCores.Bases.html\">Bases</a>"},{"title":"Event","link":"<a href=\"GameCores.Bases.Event.html\">Event</a>"},{"title":"GameObjects","link":"<a href=\"GameCores.GameObjects.html\">GameObjects</a>"},{"title":"Card","link":"<a href=\"GameCores.GameObjects.Card.html\">Card</a>"},{"title":"Player","link":"<a href=\"GameCores.GameObjects.Player.html\">Player</a>"},{"title":"get","link":"<a href=\"get.html\">get</a>"},{"title":"get.attitude","link":"<a href=\"get.html#.attitude\">get.attitude &rtrif; undefined</a>"},{"title":"get.attitude2","link":"<a href=\"get.html#.attitude2\">get.attitude2 &rtrif; undefined</a>"},{"title":"get.autoViewAs","link":"<a href=\"get.html#.autoViewAs\">get.autoViewAs &rtrif; undefined</a>"},{"title":"get.bottomCards","link":"<a href=\"get.html#.bottomCards\">get.bottomCards &rtrif; undefined</a>"},{"title":"get.buttonValue","link":"<a href=\"get.html#.buttonValue\">get.buttonValue &rtrif; undefined</a>"},{"title":"get.card","link":"<a href=\"get.html#.card\">get.card &rtrif; undefined</a>"},{"title":"get.cardOffset","link":"<a href=\"get.html#.cardOffset\">get.cardOffset &rtrif; undefined</a>"},{"title":"get.cards","link":"<a href=\"get.html#.cards\">get.cards &rtrif; undefined</a>"},{"title":"get.colorspan","link":"<a href=\"get.html#.colorspan\">get.colorspan &rtrif; undefined</a>"},{"title":"get.condition","link":"<a href=\"get.html#.condition\">get.condition &rtrif; undefined</a>"},{"title":"get.connectNickname","link":"<a href=\"get.html#.connectNickname\">get.connectNickname &rtrif; undefined</a>"},{"title":"get.copy","link":"<a href=\"get.html#.copy\">get.copy &rtrif; undefined</a>"},{"title":"get.damageEffect","link":"<a href=\"get.html#.damageEffect\">get.damageEffect &rtrif; undefined</a>"},{"title":"get.distance","link":"<a href=\"get.html#.distance\">get.distance &rtrif; undefined</a>"},{"title":"get.disvalue","link":"<a href=\"get.html#.disvalue\">get.disvalue &rtrif; undefined</a>"},{"title":"get.disvalue2","link":"<a href=\"get.html#.disvalue2\">get.disvalue2 &rtrif; undefined</a>"},{"title":"get.effect","link":"<a href=\"get.html#.effect\">get.effect &rtrif; undefined</a>"},{"title":"get.effect_use","link":"<a href=\"get.html#.effect_use\">get.effect_use &rtrif; undefined</a>"},{"title":"get.equipResult","link":"<a href=\"get.html#.equipResult\">get.equipResult &rtrif; undefined</a>"},{"title":"get.equipValue","link":"<a href=\"get.html#.equipValue\">get.equipValue &rtrif; undefined</a>"},{"title":"get.equipValueNumber","link":"<a href=\"get.html#.equipValueNumber\">get.equipValueNumber &rtrif; undefined</a>"},{"title":"get.gainableCharacters","link":"<a href=\"get.html#.gainableCharacters\">get.gainableCharacters &rtrif; undefined</a>"},{"title":"get.gainableSkills","link":"<a href=\"get.html#.gainableSkills\">get.gainableSkills &rtrif; undefined</a>"},{"title":"get.gainableSkillsName","link":"<a href=\"get.html#.gainableSkillsName\">get.gainableSkillsName &rtrif; undefined</a>"},{"title":"get.id","link":"<a href=\"get.html#.id\">get.id &rtrif; undefined</a>"},{"title":"get.info","link":"<a href=\"get.html#.info\">get.info &rtrif; undefined</a>"},{"title":"get.info","link":"<a href=\"get.html#.info\">get.info &rtrif; undefined</a>"},{"title":"get.info(2)","link":"<a href=\"get.html#.info2\">get.info(2) &rtrif; undefined</a>"},{"title":"get.info(2)","link":"<a href=\"get.html#.info2\">get.info(2) &rtrif; undefined</a>"},{"title":"get.infoHp","link":"<a href=\"get.html#.infoHp\">get.infoHp &rtrif; undefined</a>"},{"title":"get.infoMaxHp","link":"<a href=\"get.html#.infoMaxHp\">get.infoMaxHp &rtrif; undefined</a>"},{"title":"get.isLuckyStar","link":"<a href=\"get.html#.isLuckyStar\">get.isLuckyStar &rtrif; undefined</a>"},{"title":"get.itemtype","link":"<a href=\"get.html#.itemtype\">get.itemtype &rtrif; undefined</a>"},{"title":"get.judge","link":"<a href=\"get.html#.judge\">get.judge &rtrif; undefined</a>"},{"title":"get.mode","link":"<a href=\"get.html#.mode\">get.mode &rtrif; undefined</a>"},{"title":"get.name","link":"<a href=\"get.html#.name\">get.name &rtrif; undefined</a>"},{"title":"get.name","link":"<a href=\"get.html#.name\">get.name &rtrif; undefined</a>"},{"title":"get.name(2)","link":"<a href=\"get.html#.name2\">get.name(2) &rtrif; undefined</a>"},{"title":"get.name(2)","link":"<a href=\"get.html#.name2\">get.name(2) &rtrif; undefined</a>"},{"title":"get.nature","link":"<a href=\"get.html#.nature\">get.nature &rtrif; undefined</a>"},{"title":"get.nodeintro","link":"<a href=\"get.html#.nodeintro\">get.nodeintro &rtrif; undefined</a>"},{"title":"get.nodeintro","link":"<a href=\"get.html#.nodeintro\">get.nodeintro &rtrif; undefined</a>"},{"title":"get.objtype","link":"<a href=\"get.html#.objtype\">get.objtype &rtrif; undefined</a>"},{"title":"get.order","link":"<a href=\"get.html#.order\">get.order &rtrif; undefined</a>"},{"title":"get.player","link":"<a href=\"get.html#.player\">get.player &rtrif; undefined</a>"},{"title":"get.players","link":"<a href=\"get.html#.players\">get.players &rtrif; undefined</a>"},{"title":"get.position","link":"<a href=\"get.html#.position\">get.position &rtrif; undefined</a>"},{"title":"get.recoverEffect","link":"<a href=\"get.html#.recoverEffect\">get.recoverEffect &rtrif; undefined</a>"},{"title":"get.select","link":"<a href=\"get.html#.select\">get.select &rtrif; undefined</a>"},{"title":"get.sgn","link":"<a href=\"get.html#.sgn\">get.sgn &rtrif; undefined</a>"},{"title":"get.sgnAttitude","link":"<a href=\"get.html#.sgnAttitude\">get.sgnAttitude &rtrif; undefined</a>"},{"title":"get.skillthreaten","link":"<a href=\"get.html#.skillthreaten\">get.skillthreaten &rtrif; undefined</a>"},{"title":"get.threaten","link":"<a href=\"get.html#.threaten\">get.threaten &rtrif; undefined</a>"},{"title":"get.unuseful","link":"<a href=\"get.html#.unuseful\">get.unuseful &rtrif; undefined</a>"},{"title":"get.unuseful2","link":"<a href=\"get.html#.unuseful2\">get.unuseful2 &rtrif; undefined</a>"},{"title":"get.unuseful3","link":"<a href=\"get.html#.unuseful3\">get.unuseful3 &rtrif; undefined</a>"},{"title":"get.useful","link":"<a href=\"get.html#.useful\">get.useful &rtrif; undefined</a>"},{"title":"get.utc","link":"<a href=\"get.html#.utc\">get.utc &rtrif; undefined</a>"},{"title":"get.value","link":"<a href=\"get.html#.value\">get.value &rtrif; undefined</a>"},{"title":"get.value","link":"<a href=\"get.html#.value\">get.value &rtrif; undefined</a>"},{"title":"get.value(2)","link":"<a href=\"get.html#.value2\">get.value(2) &rtrif; undefined</a>"},{"title":"get.value(2)","link":"<a href=\"get.html#.value2\">get.value(2) &rtrif; undefined</a>"},{"title":"get.verticalStr","link":"<a href=\"get.html#.verticalStr\">get.verticalStr &rtrif; undefined</a>"},{"title":"is","link":"<a href=\"get.is.html\">is</a>"},{"title":"get.is.blocked","link":"<a href=\"get.is.html#.blocked\">get.is.blocked &rtrif; undefined</a>"},{"title":"get.is.double","link":"<a href=\"get.is.html#.double\">get.is.double &rtrif; undefined</a>"},{"title":"get.is.locked","link":"<a href=\"get.is.html#.locked\">get.is.locked &rtrif; undefined</a>"},{"title":"get.is.yingbian","link":"<a href=\"get.is.html#.yingbian\">get.is.yingbian &rtrif; undefined</a>"},{"title":"lib","link":"<a href=\"lib.html\">lib</a>"},{"title":"lib.getUTC","link":"<a href=\"lib.html#.getUTC\">lib.getUTC &rtrif; undefined</a>"},{"title":"lib.listenEnd","link":"<a href=\"lib.html#.listenEnd\">lib.listenEnd &rtrif; undefined</a>"},{"title":"lib.run","link":"<a href=\"lib.html#.run\">lib.run &rtrif; undefined</a>"},{"title":"lib.saveVideo","link":"<a href=\"lib.html#.saveVideo\">lib.saveVideo &rtrif; undefined</a>"},{"title":"lib.setHover","link":"<a href=\"lib.html#.setHover\">lib.setHover &rtrif; undefined</a>"},{"title":"lib.setLongPress","link":"<a href=\"lib.html#.setLongPress\">lib.setLongPress &rtrif; undefined</a>"},{"title":"lib.setMousewheel","link":"<a href=\"lib.html#.setMousewheel\">lib.setMousewheel &rtrif; undefined</a>"},{"title":"lib.setScroll","link":"<a href=\"lib.html#.setScroll\">lib.setScroll &rtrif; undefined</a>"},{"title":"lib.updateCanvas","link":"<a href=\"lib.html#.updateCanvas\">lib.updateCanvas &rtrif; undefined</a>"},{"title":"filter","link":"<a href=\"lib.filter.html\">filter</a>"},{"title":"lib.filter.cardSavable","link":"<a href=\"lib.filter.html#.cardSavable\">lib.filter.cardSavable &rtrif; undefined</a>"},{"title":"lib.filter.filterTrigger","link":"<a href=\"lib.filter.html#.filterTrigger\">lib.filter.filterTrigger &rtrif; undefined</a>"},{"title":"init","link":"<a href=\"lib.init.html\">init</a>"},{"title":"lib.init.background","link":"<a href=\"lib.init.html#.background\">lib.init.background &rtrif; undefined</a>"},{"title":"lib.init.css","link":"<a href=\"lib.init.html#.css\">lib.init.css &rtrif; undefined</a>"},{"title":"lib.init.css","link":"<a href=\"lib.init.html#.css\">lib.init.css &rtrif; undefined</a>"},{"title":"lib.init.css(2)","link":"<a href=\"lib.init.html#.css2\">lib.init.css(2) &rtrif; undefined</a>"},{"title":"lib.init.css(2)","link":"<a href=\"lib.init.html#.css2\">lib.init.css(2) &rtrif; undefined</a>"},{"title":"lib.init.cssstyles","link":"<a href=\"lib.init.html#.cssstyles\">lib.init.cssstyles &rtrif; undefined</a>"},{"title":"lib.init.decode","link":"<a href=\"lib.init.html#.decode\">lib.init.decode &rtrif; undefined</a>"},{"title":"lib.init.encode","link":"<a href=\"lib.init.html#.encode\">lib.init.encode &rtrif; undefined</a>"},{"title":"lib.init.eval","link":"<a href=\"lib.init.html#.eval\">lib.init.eval &rtrif; undefined</a>"},{"title":"lib.init.init","link":"<a href=\"lib.init.html#.init\">lib.init.init &rtrif; undefined</a>"},{"title":"lib.init.js","link":"<a href=\"lib.init.html#.js\">lib.init.js &rtrif; undefined</a>"},{"title":"lib.init.js","link":"<a href=\"lib.init.html#.js\">lib.init.js &rtrif; undefined</a>"},{"title":"lib.init.js(2)","link":"<a href=\"lib.init.html#.js2\">lib.init.js(2) &rtrif; undefined</a>"},{"title":"lib.init.js(2)","link":"<a href=\"lib.init.html#.js2\">lib.init.js(2) &rtrif; undefined</a>"},{"title":"lib.init.js(3)","link":"<a href=\"lib.init.html#.js3\">lib.init.js(3) &rtrif; undefined</a>"},{"title":"lib.init.js(3)","link":"<a href=\"lib.init.html#.js3\">lib.init.js(3) &rtrif; undefined</a>"},{"title":"lib.init.json","link":"<a href=\"lib.init.html#.json\">lib.init.json &rtrif; undefined</a>"},{"title":"lib.init.layout","link":"<a href=\"lib.init.html#.layout\">lib.init.layout &rtrif; undefined</a>"},{"title":"lib.init.onfree","link":"<a href=\"lib.init.html#.onfree\">lib.init.onfree &rtrif; undefined</a>"},{"title":"lib.init.onload","link":"<a href=\"lib.init.html#.onload\">lib.init.onload &rtrif; undefined</a>"},{"title":"lib.init.reset","link":"<a href=\"lib.init.html#.reset\">lib.init.reset &rtrif; undefined</a>"},{"title":"lib.init.sheet","link":"<a href=\"lib.init.html#.sheet\">lib.init.sheet &rtrif; undefined</a>"},{"title":"lib.init.stringify","link":"<a href=\"lib.init.html#.stringify\">lib.init.stringify &rtrif; undefined</a>"},{"title":"lib.init.stringifySkill","link":"<a href=\"lib.init.html#.stringifySkill\">lib.init.stringifySkill &rtrif; undefined</a>"},{"title":"skill","link":"<a href=\"lib.skill.html\">skill</a>"},{"title":"_status","link":"<a href=\"module-core._status.html\">_status</a>"},{"title":"ai","link":"<a href=\"module-core.ai.html\">ai</a>"},{"title":"game","link":"<a href=\"module-core.game.html\">game</a>"},{"title":"module:core.game.addCard","link":"<a href=\"module-core.game.html#.addCard\">module:core.game.addCard &rtrif; undefined</a>"},{"title":"module:core.game.addCardPack","link":"<a href=\"module-core.game.html#.addCardPack\">module:core.game.addCardPack &rtrif; undefined</a>"},{"title":"module:core.game.addCharacter","link":"<a href=\"module-core.game.html#.addCharacter\">module:core.game.addCharacter &rtrif; undefined</a>"},{"title":"module:core.game.addCharacterPack","link":"<a href=\"module-core.game.html#.addCharacterPack\">module:core.game.addCharacterPack &rtrif; undefined</a>"},{"title":"module:core.game.addGlobalSkill","link":"<a href=\"module-core.game.html#.addGlobalSkill\">module:core.game.addGlobalSkill &rtrif; undefined</a>"},{"title":"module:core.game.addMode","link":"<a href=\"module-core.game.html#.addMode\">module:core.game.addMode &rtrif; undefined</a>"},{"title":"module:core.game.addSkill","link":"<a href=\"module-core.game.html#.addSkill\">module:core.game.addSkill &rtrif; undefined</a>"},{"title":"module:core.game.check","link":"<a href=\"module-core.game.html#.check\">module:core.game.check &rtrif; undefined</a>"},{"title":"module:core.game.clearModeConfig","link":"<a href=\"module-core.game.html#.clearModeConfig\">module:core.game.clearModeConfig &rtrif; undefined</a>"},{"title":"module:core.game.countGroup","link":"<a href=\"module-core.game.html#.countGroup\">module:core.game.countGroup &rtrif; undefined</a>"},{"title":"module:core.game.countPlayer","link":"<a href=\"module-core.game.html#.countPlayer\">module:core.game.countPlayer &rtrif; undefined</a>"},{"title":"module:core.game.countPlayer2","link":"<a href=\"module-core.game.html#.countPlayer2\">module:core.game.countPlayer2 &rtrif; undefined</a>"},{"title":"module:core.game.createEvent","link":"<a href=\"module-core.game.html#.createEvent\">module:core.game.createEvent &rtrif; undefined</a>"},{"title":"module:core.game.createTrigger","link":"<a href=\"module-core.game.html#.createTrigger\">module:core.game.createTrigger &rtrif; undefined</a>"},{"title":"module:core.game.deleteDB","link":"<a href=\"module-core.game.html#.deleteDB\">module:core.game.deleteDB &rtrif; undefined</a>"},{"title":"module:core.game.expandSkills","link":"<a href=\"module-core.game.html#.expandSkills\">module:core.game.expandSkills &rtrif; undefined</a>"},{"title":"module:core.game.filterSkills","link":"<a href=\"module-core.game.html#.filterSkills\">module:core.game.filterSkills &rtrif; undefined</a>"},{"title":"module:core.game.finishCards","link":"<a href=\"module-core.game.html#.finishCards\">module:core.game.finishCards &rtrif; undefined</a>"},{"title":"module:core.game.finishSkill","link":"<a href=\"module-core.game.html#.finishSkill\">module:core.game.finishSkill &rtrif; undefined</a>"},{"title":"module:core.game.getDB","link":"<a href=\"module-core.game.html#.getDB\">module:core.game.getDB &rtrif; undefined</a>"},{"title":"module:core.game.getExtensionConfig","link":"<a href=\"module-core.game.html#.getExtensionConfig\">module:core.game.getExtensionConfig &rtrif; undefined</a>"},{"title":"module:core.game.hasPlayer","link":"<a href=\"module-core.game.html#.hasPlayer\">module:core.game.hasPlayer &rtrif; undefined</a>"},{"title":"module:core.game.hasPlayer2","link":"<a href=\"module-core.game.html#.hasPlayer2\">module:core.game.hasPlayer2 &rtrif; undefined</a>"},{"title":"module:core.game.import","link":"<a href=\"module-core.game.html#.import\">module:core.game.import &rtrif; undefined</a>"},{"title":"module:core.game.loop","link":"<a href=\"module-core.game.html#.loop\">module:core.game.loop &rtrif; undefined</a>"},{"title":"module:core.game.putDB","link":"<a href=\"module-core.game.html#.putDB\">module:core.game.putDB &rtrif; undefined</a>"},{"title":"module:core.game.saveConfig","link":"<a href=\"module-core.game.html#.saveConfig\">module:core.game.saveConfig &rtrif; undefined</a>"},{"title":"module:core.game.saveConfigValue","link":"<a href=\"module-core.game.html#.saveConfigValue\">module:core.game.saveConfigValue &rtrif; undefined</a>"},{"title":"module:core.game.saveExtensionConfig","link":"<a href=\"module-core.game.html#.saveExtensionConfig\">module:core.game.saveExtensionConfig &rtrif; undefined</a>"},{"title":"module:core.game.showPlayerCard","link":"<a href=\"module-core.game.html#.showPlayerCard\">module:core.game.showPlayerCard &rtrif; undefined</a>"},{"title":"get","link":"<a href=\"module-core.get.html\">get</a>"},{"title":"module:core.get.attitude","link":"<a href=\"module-core.get.html#.attitude\">module:core.get.attitude &rtrif; undefined</a>"},{"title":"module:core.get.attitude2","link":"<a href=\"module-core.get.html#.attitude2\">module:core.get.attitude2 &rtrif; undefined</a>"},{"title":"module:core.get.autoViewAs","link":"<a href=\"module-core.get.html#.autoViewAs\">module:core.get.autoViewAs &rtrif; undefined</a>"},{"title":"module:core.get.bottomCards","link":"<a href=\"module-core.get.html#.bottomCards\">module:core.get.bottomCards &rtrif; undefined</a>"},{"title":"module:core.get.buttonValue","link":"<a href=\"module-core.get.html#.buttonValue\">module:core.get.buttonValue &rtrif; undefined</a>"},{"title":"module:core.get.card","link":"<a href=\"module-core.get.html#.card\">module:core.get.card &rtrif; undefined</a>"},{"title":"module:core.get.cardOffset","link":"<a href=\"module-core.get.html#.cardOffset\">module:core.get.cardOffset &rtrif; undefined</a>"},{"title":"module:core.get.cards","link":"<a href=\"module-core.get.html#.cards\">module:core.get.cards &rtrif; undefined</a>"},{"title":"module:core.get.colorspan","link":"<a href=\"module-core.get.html#.colorspan\">module:core.get.colorspan &rtrif; undefined</a>"},{"title":"module:core.get.condition","link":"<a href=\"module-core.get.html#.condition\">module:core.get.condition &rtrif; undefined</a>"},{"title":"module:core.get.connectNickname","link":"<a href=\"module-core.get.html#.connectNickname\">module:core.get.connectNickname &rtrif; undefined</a>"},{"title":"module:core.get.copy","link":"<a href=\"module-core.get.html#.copy\">module:core.get.copy &rtrif; undefined</a>"},{"title":"module:core.get.damageEffect","link":"<a href=\"module-core.get.html#.damageEffect\">module:core.get.damageEffect &rtrif; undefined</a>"},{"title":"module:core.get.distance","link":"<a href=\"module-core.get.html#.distance\">module:core.get.distance &rtrif; undefined</a>"},{"title":"module:core.get.disvalue","link":"<a href=\"module-core.get.html#.disvalue\">module:core.get.disvalue &rtrif; undefined</a>"},{"title":"module:core.get.disvalue2","link":"<a href=\"module-core.get.html#.disvalue2\">module:core.get.disvalue2 &rtrif; undefined</a>"},{"title":"module:core.get.effect","link":"<a href=\"module-core.get.html#.effect\">module:core.get.effect &rtrif; undefined</a>"},{"title":"module:core.get.effect_use","link":"<a href=\"module-core.get.html#.effect_use\">module:core.get.effect_use &rtrif; undefined</a>"},{"title":"module:core.get.equipResult","link":"<a href=\"module-core.get.html#.equipResult\">module:core.get.equipResult &rtrif; undefined</a>"},{"title":"module:core.get.equipValue","link":"<a href=\"module-core.get.html#.equipValue\">module:core.get.equipValue &rtrif; undefined</a>"},{"title":"module:core.get.equipValueNumber","link":"<a href=\"module-core.get.html#.equipValueNumber\">module:core.get.equipValueNumber &rtrif; undefined</a>"},{"title":"module:core.get.gainableCharacters","link":"<a href=\"module-core.get.html#.gainableCharacters\">module:core.get.gainableCharacters &rtrif; undefined</a>"},{"title":"module:core.get.gainableSkills","link":"<a href=\"module-core.get.html#.gainableSkills\">module:core.get.gainableSkills &rtrif; undefined</a>"},{"title":"module:core.get.gainableSkillsName","link":"<a href=\"module-core.get.html#.gainableSkillsName\">module:core.get.gainableSkillsName &rtrif; undefined</a>"},{"title":"module:core.get.id","link":"<a href=\"module-core.get.html#.id\">module:core.get.id &rtrif; undefined</a>"},{"title":"module:core.get.infoHp","link":"<a href=\"module-core.get.html#.infoHp\">module:core.get.infoHp &rtrif; undefined</a>"},{"title":"module:core.get.infoMaxHp","link":"<a href=\"module-core.get.html#.infoMaxHp\">module:core.get.infoMaxHp &rtrif; undefined</a>"},{"title":"module:core.get.isLuckyStar","link":"<a href=\"module-core.get.html#.isLuckyStar\">module:core.get.isLuckyStar &rtrif; undefined</a>"},{"title":"module:core.get.itemtype","link":"<a href=\"module-core.get.html#.itemtype\">module:core.get.itemtype &rtrif; undefined</a>"},{"title":"module:core.get.judge","link":"<a href=\"module-core.get.html#.judge\">module:core.get.judge &rtrif; undefined</a>"},{"title":"module:core.get.mode","link":"<a href=\"module-core.get.html#.mode\">module:core.get.mode &rtrif; undefined</a>"},{"title":"module:core.get.nature","link":"<a href=\"module-core.get.html#.nature\">module:core.get.nature &rtrif; undefined</a>"},{"title":"module:core.get.objtype","link":"<a href=\"module-core.get.html#.objtype\">module:core.get.objtype &rtrif; undefined</a>"},{"title":"module:core.get.order","link":"<a href=\"module-core.get.html#.order\">module:core.get.order &rtrif; undefined</a>"},{"title":"module:core.get.player","link":"<a href=\"module-core.get.html#.player\">module:core.get.player &rtrif; undefined</a>"},{"title":"module:core.get.players","link":"<a href=\"module-core.get.html#.players\">module:core.get.players &rtrif; undefined</a>"},{"title":"module:core.get.position","link":"<a href=\"module-core.get.html#.position\">module:core.get.position &rtrif; undefined</a>"},{"title":"module:core.get.recoverEffect","link":"<a href=\"module-core.get.html#.recoverEffect\">module:core.get.recoverEffect &rtrif; undefined</a>"},{"title":"module:core.get.select","link":"<a href=\"module-core.get.html#.select\">module:core.get.select &rtrif; undefined</a>"},{"title":"module:core.get.sgn","link":"<a href=\"module-core.get.html#.sgn\">module:core.get.sgn &rtrif; undefined</a>"},{"title":"module:core.get.sgnAttitude","link":"<a href=\"module-core.get.html#.sgnAttitude\">module:core.get.sgnAttitude &rtrif; undefined</a>"},{"title":"module:core.get.skillthreaten","link":"<a href=\"module-core.get.html#.skillthreaten\">module:core.get.skillthreaten &rtrif; undefined</a>"},{"title":"module:core.get.threaten","link":"<a href=\"module-core.get.html#.threaten\">module:core.get.threaten &rtrif; undefined</a>"},{"title":"module:core.get.unuseful","link":"<a href=\"module-core.get.html#.unuseful\">module:core.get.unuseful &rtrif; undefined</a>"},{"title":"module:core.get.unuseful2","link":"<a href=\"module-core.get.html#.unuseful2\">module:core.get.unuseful2 &rtrif; undefined</a>"},{"title":"module:core.get.unuseful3","link":"<a href=\"module-core.get.html#.unuseful3\">module:core.get.unuseful3 &rtrif; undefined</a>"},{"title":"module:core.get.useful","link":"<a href=\"module-core.get.html#.useful\">module:core.get.useful &rtrif; undefined</a>"},{"title":"module:core.get.utc","link":"<a href=\"module-core.get.html#.utc\">module:core.get.utc &rtrif; undefined</a>"},{"title":"module:core.get.verticalStr","link":"<a href=\"module-core.get.html#.verticalStr\">module:core.get.verticalStr &rtrif; undefined</a>"},{"title":"is","link":"<a href=\"module-core.get.is.html\">is</a>"},{"title":"module:core.get.is.blocked","link":"<a href=\"module-core.get.is.html#.blocked\">module:core.get.is.blocked &rtrif; undefined</a>"},{"title":"module:core.get.is.double","link":"<a href=\"module-core.get.is.html#.double\">module:core.get.is.double &rtrif; undefined</a>"},{"title":"module:core.get.is.locked","link":"<a href=\"module-core.get.is.html#.locked\">module:core.get.is.locked &rtrif; undefined</a>"},{"title":"module:core.get.is.yingbian","link":"<a href=\"module-core.get.is.html#.yingbian\">module:core.get.is.yingbian &rtrif; undefined</a>"},{"title":"lib","link":"<a href=\"module-core.lib.html\">lib</a>"},{"title":"module:core.lib.getUTC","link":"<a href=\"module-core.lib.html#.getUTC\">module:core.lib.getUTC &rtrif; undefined</a>"},{"title":"module:core.lib.listenEnd","link":"<a href=\"module-core.lib.html#.listenEnd\">module:core.lib.listenEnd &rtrif; undefined</a>"},{"title":"module:core.lib.run","link":"<a href=\"module-core.lib.html#.run\">module:core.lib.run &rtrif; undefined</a>"},{"title":"module:core.lib.saveVideo","link":"<a href=\"module-core.lib.html#.saveVideo\">module:core.lib.saveVideo &rtrif; undefined</a>"},{"title":"module:core.lib.setHover","link":"<a href=\"module-core.lib.html#.setHover\">module:core.lib.setHover &rtrif; undefined</a>"},{"title":"module:core.lib.setLongPress","link":"<a href=\"module-core.lib.html#.setLongPress\">module:core.lib.setLongPress &rtrif; undefined</a>"},{"title":"module:core.lib.setMousewheel","link":"<a href=\"module-core.lib.html#.setMousewheel\">module:core.lib.setMousewheel &rtrif; undefined</a>"},{"title":"module:core.lib.setScroll","link":"<a href=\"module-core.lib.html#.setScroll\">module:core.lib.setScroll &rtrif; undefined</a>"},{"title":"module:core.lib.updateCanvas","link":"<a href=\"module-core.lib.html#.updateCanvas\">module:core.lib.updateCanvas &rtrif; undefined</a>"},{"title":"filter","link":"<a href=\"module-core.lib.filter.html\">filter</a>"},{"title":"module:core.lib.filter.cardSavable","link":"<a href=\"module-core.lib.filter.html#.cardSavable\">module:core.lib.filter.cardSavable &rtrif; undefined</a>"},{"title":"module:core.lib.filter.filterTrigger","link":"<a href=\"module-core.lib.filter.html#.filterTrigger\">module:core.lib.filter.filterTrigger &rtrif; undefined</a>"},{"title":"init","link":"<a href=\"module-core.lib.init.html\">init</a>"},{"title":"module:core.lib.init.background","link":"<a href=\"module-core.lib.init.html#.background\">module:core.lib.init.background &rtrif; undefined</a>"},{"title":"module:core.lib.init.cssstyles","link":"<a href=\"module-core.lib.init.html#.cssstyles\">module:core.lib.init.cssstyles &rtrif; undefined</a>"},{"title":"module:core.lib.init.decode","link":"<a href=\"module-core.lib.init.html#.decode\">module:core.lib.init.decode &rtrif; undefined</a>"},{"title":"module:core.lib.init.encode","link":"<a href=\"module-core.lib.init.html#.encode\">module:core.lib.init.encode &rtrif; undefined</a>"},{"title":"module:core.lib.init.eval","link":"<a href=\"module-core.lib.init.html#.eval\">module:core.lib.init.eval &rtrif; undefined</a>"},{"title":"module:core.lib.init.init","link":"<a href=\"module-core.lib.init.html#.init\">module:core.lib.init.init &rtrif; undefined</a>"},{"title":"module:core.lib.init.json","link":"<a href=\"module-core.lib.init.html#.json\">module:core.lib.init.json &rtrif; undefined</a>"},{"title":"module:core.lib.init.layout","link":"<a href=\"module-core.lib.init.html#.layout\">module:core.lib.init.layout &rtrif; undefined</a>"},{"title":"module:core.lib.init.onfree","link":"<a href=\"module-core.lib.init.html#.onfree\">module:core.lib.init.onfree &rtrif; undefined</a>"},{"title":"module:core.lib.init.onload","link":"<a href=\"module-core.lib.init.html#.onload\">module:core.lib.init.onload &rtrif; undefined</a>"},{"title":"module:core.lib.init.reset","link":"<a href=\"module-core.lib.init.html#.reset\">module:core.lib.init.reset &rtrif; undefined</a>"},{"title":"module:core.lib.init.sheet","link":"<a href=\"module-core.lib.init.html#.sheet\">module:core.lib.init.sheet &rtrif; undefined</a>"},{"title":"module:core.lib.init.stringify","link":"<a href=\"module-core.lib.init.html#.stringify\">module:core.lib.init.stringify &rtrif; undefined</a>"},{"title":"module:core.lib.init.stringifySkill","link":"<a href=\"module-core.lib.init.html#.stringifySkill\">module:core.lib.init.stringifySkill &rtrif; undefined</a>"},{"title":"skill","link":"<a href=\"module-core.lib.skill.html\">skill</a>"},{"title":"ui","link":"<a href=\"module-core.ui.html\">ui</a>"},{"title":"module:core.ui.clear","link":"<a href=\"module-core.ui.html#.clear\">module:core.ui.clear &rtrif; undefined</a>"},{"title":"module:core.ui.refresh","link":"<a href=\"module-core.ui.html#.refresh\">module:core.ui.refresh &rtrif; undefined</a>"},{"title":"module:core.ui.update","link":"<a href=\"module-core.ui.html#.update\">module:core.ui.update &rtrif; undefined</a>"},{"title":"module:core.ui.updated","link":"<a href=\"module-core.ui.html#.updated\">module:core.ui.updated &rtrif; undefined</a>"},{"title":"module:core.ui.updateh","link":"<a href=\"module-core.ui.html#.updateh\">module:core.ui.updateh &rtrif; undefined</a>"},{"title":"module:core.ui.updatej","link":"<a href=\"module-core.ui.html#.updatej\">module:core.ui.updatej &rtrif; undefined</a>"},{"title":"module:core.ui.updatejm","link":"<a href=\"module-core.ui.html#.updatejm\">module:core.ui.updatejm &rtrif; undefined</a>"},{"title":"module:core.ui.updatem","link":"<a href=\"module-core.ui.html#.updatem\">module:core.ui.updatem &rtrif; undefined</a>"},{"title":"module:core.ui.updatez","link":"<a href=\"module-core.ui.html#.updatez\">module:core.ui.updatez &rtrif; undefined</a>"},{"title":"click","link":"<a href=\"module-core.ui.click.html\">click</a>"},{"title":"module:core.ui.click.auto","link":"<a href=\"module-core.ui.click.html#.auto\">module:core.ui.click.auto &rtrif; undefined</a>"},{"title":"module:core.ui.click.cancel","link":"<a href=\"module-core.ui.click.html#.cancel\">module:core.ui.click.cancel &rtrif; undefined</a>"},{"title":"module:core.ui.click.intro","link":"<a href=\"module-core.ui.click.html#.intro\">module:core.ui.click.intro &rtrif; undefined</a>"},{"title":"module:core.ui.click.ok","link":"<a href=\"module-core.ui.click.html#.ok\">module:core.ui.click.ok &rtrif; undefined</a>"},{"title":"module:core.ui.click.wuxie","link":"<a href=\"module-core.ui.click.html#.wuxie\">module:core.ui.click.wuxie &rtrif; undefined</a>"},{"title":"create","link":"<a href=\"module-core.ui.create.html\">create</a>"},{"title":"module:core.ui.create.button","link":"<a href=\"module-core.ui.create.html#.button\">module:core.ui.create.button &rtrif; undefined</a>"},{"title":"module:core.ui.create.buttons","link":"<a href=\"module-core.ui.create.html#.buttons\">module:core.ui.create.buttons &rtrif; undefined</a>"},{"title":"module:core.ui.create.card","link":"<a href=\"module-core.ui.create.html#.card\">module:core.ui.create.card &rtrif; undefined</a>"},{"title":"module:core.ui.create.cardDialog","link":"<a href=\"module-core.ui.create.html#.cardDialog\">module:core.ui.create.cardDialog &rtrif; undefined</a>"},{"title":"module:core.ui.create.characterDialog","link":"<a href=\"module-core.ui.create.html#.characterDialog\">module:core.ui.create.characterDialog &rtrif; undefined</a>"},{"title":"module:core.ui.create.control","link":"<a href=\"module-core.ui.create.html#.control\">module:core.ui.create.control &rtrif; undefined</a>"},{"title":"module:core.ui.create.div","link":"<a href=\"module-core.ui.create.html#.div\">module:core.ui.create.div &rtrif; undefined</a>"},{"title":"module:core.ui.create.menu","link":"<a href=\"module-core.ui.create.html#.menu\">module:core.ui.create.menu &rtrif; undefined</a>"},{"title":"module:core.ui.create.player","link":"<a href=\"module-core.ui.create.html#.player\">module:core.ui.create.player &rtrif; undefined</a>"},{"title":"sort","link":"<a href=\"sort.html\">sort</a>"},{"title":"sort.card","link":"<a href=\"sort.html#.card\">sort.card &rtrif; undefined</a>"},{"title":"sort.card","link":"<a href=\"sort.html#.card\">sort.card &rtrif; undefined</a>"},{"title":"sort.character","link":"<a href=\"sort.html#.character\">sort.character &rtrif; undefined</a>"},{"title":"sort.character","link":"<a href=\"sort.html#.character\">sort.character &rtrif; undefined</a>"},{"title":"sort.seat","link":"<a href=\"sort.html#.seat\">sort.seat &rtrif; undefined</a>"},{"title":"sort.seat","link":"<a href=\"sort.html#.seat\">sort.seat &rtrif; undefined</a>"},{"title":"ui","link":"<a href=\"ui.html\">ui</a>"},{"title":"ui.clear","link":"<a href=\"ui.html#.clear\">ui.clear &rtrif; undefined</a>"},{"title":"ui.refresh","link":"<a href=\"ui.html#.refresh\">ui.refresh &rtrif; undefined</a>"},{"title":"ui.update","link":"<a href=\"ui.html#.update\">ui.update &rtrif; undefined</a>"},{"title":"ui.updated","link":"<a href=\"ui.html#.updated\">ui.updated &rtrif; undefined</a>"},{"title":"ui.updateh","link":"<a href=\"ui.html#.updateh\">ui.updateh &rtrif; undefined</a>"},{"title":"ui.updatej","link":"<a href=\"ui.html#.updatej\">ui.updatej &rtrif; undefined</a>"},{"title":"ui.updatejm","link":"<a href=\"ui.html#.updatejm\">ui.updatejm &rtrif; undefined</a>"},{"title":"ui.updatem","link":"<a href=\"ui.html#.updatem\">ui.updatem &rtrif; undefined</a>"},{"title":"ui.updatez","link":"<a href=\"ui.html#.updatez\">ui.updatez &rtrif; undefined</a>"},{"title":"click","link":"<a href=\"ui.click.html\">click</a>"},{"title":"ui.click.auto","link":"<a href=\"ui.click.html#.auto\">ui.click.auto &rtrif; undefined</a>"},{"title":"ui.click.cancel","link":"<a href=\"ui.click.html#.cancel\">ui.click.cancel &rtrif; undefined</a>"},{"title":"ui.click.intro","link":"<a href=\"ui.click.html#.intro\">ui.click.intro &rtrif; undefined</a>"},{"title":"ui.click.ok","link":"<a href=\"ui.click.html#.ok\">ui.click.ok &rtrif; undefined</a>"},{"title":"ui.click.wuxie","link":"<a href=\"ui.click.html#.wuxie\">ui.click.wuxie &rtrif; undefined</a>"},{"title":"create","link":"<a href=\"ui.create.html\">create</a>"},{"title":"ui.create.button","link":"<a href=\"ui.create.html#.button\">ui.create.button &rtrif; undefined</a>"},{"title":"ui.create.buttons","link":"<a href=\"ui.create.html#.buttons\">ui.create.buttons &rtrif; undefined</a>"},{"title":"ui.create.card","link":"<a href=\"ui.create.html#.card\">ui.create.card &rtrif; undefined</a>"},{"title":"ui.create.cardDialog","link":"<a href=\"ui.create.html#.cardDialog\">ui.create.cardDialog &rtrif; undefined</a>"},{"title":"ui.create.characterDialog","link":"<a href=\"ui.create.html#.characterDialog\">ui.create.characterDialog &rtrif; undefined</a>"},{"title":"ui.create.control","link":"<a href=\"ui.create.html#.control\">ui.create.control &rtrif; undefined</a>"},{"title":"ui.create.div","link":"<a href=\"ui.create.html#.div\">ui.create.div &rtrif; undefined</a>"},{"title":"ui.create.menu","link":"<a href=\"ui.create.html#.menu\">ui.create.menu &rtrif; undefined</a>"},{"title":"ui.create.player","link":"<a href=\"ui.create.html#.player\">ui.create.player &rtrif; undefined</a>"},{"title":"card","link":"<a href=\"lib.element.card.html\">card</a>"},{"title":"lib.element.card.addGaintag","link":"<a href=\"lib.element.card.html#.addGaintag\">lib.element.card.addGaintag &rtrif; undefined</a>"},{"title":"lib.element.card.hasGaintag","link":"<a href=\"lib.element.card.html#.hasGaintag\">lib.element.card.hasGaintag &rtrif; undefined</a>"},{"title":"lib.element.card.hasPosition","link":"<a href=\"lib.element.card.html#.hasPosition\">lib.element.card.hasPosition &rtrif; undefined</a>"},{"title":"lib.element.card.init","link":"<a href=\"lib.element.card.html#.init\">lib.element.card.init &rtrif; undefined</a>"},{"title":"lib.element.card.isInPile","link":"<a href=\"lib.element.card.html#.isInPile\">lib.element.card.isInPile &rtrif; undefined</a>"},{"title":"lib.element.card.removeGaintag","link":"<a href=\"lib.element.card.html#.removeGaintag\">lib.element.card.removeGaintag &rtrif; undefined</a>"},{"title":"lib.element.card.updateTransform","link":"<a href=\"lib.element.card.html#.updateTransform\">lib.element.card.updateTransform &rtrif; undefined</a>"},{"title":"event","link":"<a href=\"lib.element.event.html\">event</a>"},{"title":"lib.element.event.backup","link":"<a href=\"lib.element.event.html#.backup\">lib.element.event.backup &rtrif; undefined</a>"},{"title":"lib.element.event.cancel","link":"<a href=\"lib.element.event.html#.cancel\">lib.element.event.cancel &rtrif; undefined</a>"},{"title":"lib.element.event.finish","link":"<a href=\"lib.element.event.html#.finish\">lib.element.event.finish &rtrif; undefined</a>"},{"title":"lib.element.event.getParent","link":"<a href=\"lib.element.event.html#.getParent\">lib.element.event.getParent &rtrif; undefined</a>"},{"title":"lib.element.event.getRand","link":"<a href=\"lib.element.event.html#.getRand\">lib.element.event.getRand &rtrif; undefined</a>"},{"title":"lib.element.event.getTrigger","link":"<a href=\"lib.element.event.html#.getTrigger\">lib.element.event.getTrigger &rtrif; undefined</a>"},{"title":"lib.element.event.goto","link":"<a href=\"lib.element.event.html#.goto\">lib.element.event.goto &rtrif; undefined</a>"},{"title":"lib.element.event.insert","link":"<a href=\"lib.element.event.html#.insert\">lib.element.event.insert &rtrif; undefined</a>"},{"title":"lib.element.event.insertAfter","link":"<a href=\"lib.element.event.html#.insertAfter\">lib.element.event.insertAfter &rtrif; undefined</a>"},{"title":"lib.element.event.redo","link":"<a href=\"lib.element.event.html#.redo\">lib.element.event.redo &rtrif; undefined</a>"},{"title":"lib.element.event.resume","link":"<a href=\"lib.element.event.html#.resume\">lib.element.event.resume &rtrif; undefined</a>"},{"title":"lib.element.event.set","link":"<a href=\"lib.element.event.html#.set\">lib.element.event.set &rtrif; undefined</a>"},{"title":"lib.element.event.set","link":"<a href=\"lib.element.event.html#.set\">lib.element.event.set &rtrif; undefined</a>"},{"title":"lib.element.event.set(2)","link":"<a href=\"lib.element.event.html#.set2\">lib.element.event.set(2) &rtrif; undefined</a>"},{"title":"lib.element.event.set(2)","link":"<a href=\"lib.element.event.html#.set2\">lib.element.event.set(2) &rtrif; undefined</a>"},{"title":"lib.element.event.setContent","link":"<a href=\"lib.element.event.html#.setContent\">lib.element.event.setContent &rtrif; undefined</a>"},{"title":"lib.element.event.trigger","link":"<a href=\"lib.element.event.html#.trigger\">lib.element.event.trigger &rtrif; undefined</a>"},{"title":"lib.element.event.untrigger","link":"<a href=\"lib.element.event.html#.untrigger\">lib.element.event.untrigger &rtrif; undefined</a>"},{"title":"player","link":"<a href=\"lib.element.player.html\">player</a>"},{"title":"lib.element.player.$damagepop","link":"<a href=\"lib.element.player.html#.$damagepop\">lib.element.player.$damagepop &rtrif; undefined</a>"},{"title":"lib.element.player.$showCharacter","link":"<a href=\"lib.element.player.html#.$showCharacter\">lib.element.player.$showCharacter &rtrif; undefined</a>"},{"title":"lib.element.player.$skill","link":"<a href=\"lib.element.player.html#.$skill\">lib.element.player.$skill &rtrif; undefined</a>"},{"title":"lib.element.player.$throwEmotion","link":"<a href=\"lib.element.player.html#.$throwEmotion\">lib.element.player.$throwEmotion &rtrif; undefined</a>"},{"title":"lib.element.player.addAdditionalSkill","link":"<a href=\"lib.element.player.html#.addAdditionalSkill\">lib.element.player.addAdditionalSkill &rtrif; undefined</a>"},{"title":"lib.element.player.addEquipTrigger","link":"<a href=\"lib.element.player.html#.addEquipTrigger\">lib.element.player.addEquipTrigger &rtrif; undefined</a>"},{"title":"lib.element.player.addGaintag","link":"<a href=\"lib.element.player.html#.addGaintag\">lib.element.player.addGaintag &rtrif; undefined</a>"},{"title":"lib.element.player.addMark","link":"<a href=\"lib.element.player.html#.addMark\">lib.element.player.addMark &rtrif; undefined</a>"},{"title":"lib.element.player.addSkill","link":"<a href=\"lib.element.player.html#.addSkill\">lib.element.player.addSkill &rtrif; undefined</a>"},{"title":"lib.element.player.addSkill","link":"<a href=\"lib.element.player.html#.addSkill\">lib.element.player.addSkill &rtrif; undefined</a>"},{"title":"lib.element.player.addSkill","link":"<a href=\"lib.element.player.html#.addSkill\">lib.element.player.addSkill &rtrif; undefined</a>"},{"title":"lib.element.player.addSkill(2)","link":"<a href=\"lib.element.player.html#.addSkill2\">lib.element.player.addSkill(2) &rtrif; undefined</a>"},{"title":"lib.element.player.addSkill(2)","link":"<a href=\"lib.element.player.html#.addSkill2\">lib.element.player.addSkill(2) &rtrif; undefined</a>"},{"title":"lib.element.player.addSkill(2)","link":"<a href=\"lib.element.player.html#.addSkill2\">lib.element.player.addSkill(2) &rtrif; undefined</a>"},{"title":"lib.element.player.addSkillBlocker","link":"<a href=\"lib.element.player.html#.addSkillBlocker\">lib.element.player.addSkillBlocker &rtrif; undefined</a>"},{"title":"lib.element.player.addSkillLog","link":"<a href=\"lib.element.player.html#.addSkillLog\">lib.element.player.addSkillLog &rtrif; undefined</a>"},{"title":"lib.element.player.addSkillTrigger","link":"<a href=\"lib.element.player.html#.addSkillTrigger\">lib.element.player.addSkillTrigger &rtrif; undefined</a>"},{"title":"lib.element.player.addSubPlayer","link":"<a href=\"lib.element.player.html#.addSubPlayer\">lib.element.player.addSubPlayer &rtrif; undefined</a>"},{"title":"lib.element.player.addTempSkill","link":"<a href=\"lib.element.player.html#.addTempSkill\">lib.element.player.addTempSkill &rtrif; undefined</a>"},{"title":"lib.element.player.addToJudge","link":"<a href=\"lib.element.player.html#.addToJudge\">lib.element.player.addToJudge &rtrif; undefined</a>"},{"title":"lib.element.player.applySkills","link":"<a href=\"lib.element.player.html#.applySkills\">lib.element.player.applySkills &rtrif; undefined</a>"},{"title":"lib.element.player.attitudeTo","link":"<a href=\"lib.element.player.html#.attitudeTo\">lib.element.player.attitudeTo &rtrif; undefined</a>"},{"title":"lib.element.player.awakenSkill","link":"<a href=\"lib.element.player.html#.awakenSkill\">lib.element.player.awakenSkill &rtrif; undefined</a>"},{"title":"lib.element.player.buffAvatar","link":"<a href=\"lib.element.player.html#.buffAvatar\">lib.element.player.buffAvatar &rtrif; undefined</a>"},{"title":"lib.element.player.callSubPlayer","link":"<a href=\"lib.element.player.html#.callSubPlayer\">lib.element.player.callSubPlayer &rtrif; undefined</a>"},{"title":"lib.element.player.canAddToJudge","link":"<a href=\"lib.element.player.html#.canAddToJudge\">lib.element.player.canAddToJudge &rtrif; undefined</a>"},{"title":"lib.element.player.canSave","link":"<a href=\"lib.element.player.html#.canSave\">lib.element.player.canSave &rtrif; undefined</a>"},{"title":"lib.element.player.canUse","link":"<a href=\"lib.element.player.html#.canUse\">lib.element.player.canUse &rtrif; undefined</a>"},{"title":"lib.element.player.changeSeat","link":"<a href=\"lib.element.player.html#.changeSeat\">lib.element.player.changeSeat &rtrif; undefined</a>"},{"title":"lib.element.player.chat","link":"<a href=\"lib.element.player.html#.chat\">lib.element.player.chat &rtrif; undefined</a>"},{"title":"lib.element.player.checkConflict","link":"<a href=\"lib.element.player.html#.checkConflict\">lib.element.player.checkConflict &rtrif; undefined</a>"},{"title":"lib.element.player.checkMarks","link":"<a href=\"lib.element.player.html#.checkMarks\">lib.element.player.checkMarks &rtrif; undefined</a>"},{"title":"lib.element.player.chooseToGuanxing","link":"<a href=\"lib.element.player.html#.chooseToGuanxing\">lib.element.player.chooseToGuanxing &rtrif; undefined</a>"},{"title":"lib.element.player.clearSkills","link":"<a href=\"lib.element.player.html#.clearSkills\">lib.element.player.clearSkills &rtrif; undefined</a>"},{"title":"lib.element.player.countMark","link":"<a href=\"lib.element.player.html#.countMark\">lib.element.player.countMark &rtrif; undefined</a>"},{"title":"lib.element.player.directgains","link":"<a href=\"lib.element.player.html#.directgains\">lib.element.player.directgains &rtrif; undefined</a>"},{"title":"lib.element.player.disableSkill","link":"<a href=\"lib.element.player.html#.disableSkill\">lib.element.player.disableSkill &rtrif; undefined</a>"},{"title":"lib.element.player.emotion","link":"<a href=\"lib.element.player.html#.emotion\">lib.element.player.emotion &rtrif; undefined</a>"},{"title":"lib.element.player.enableSkill","link":"<a href=\"lib.element.player.html#.enableSkill\">lib.element.player.enableSkill &rtrif; undefined</a>"},{"title":"lib.element.player.exitSubPlayer","link":"<a href=\"lib.element.player.html#.exitSubPlayer\">lib.element.player.exitSubPlayer &rtrif; undefined</a>"},{"title":"lib.element.player.flashAvatar","link":"<a href=\"lib.element.player.html#.flashAvatar\">lib.element.player.flashAvatar &rtrif; undefined</a>"},{"title":"lib.element.player.get","link":"<a href=\"lib.element.player.html#.get\">lib.element.player.get &rtrif; undefined</a>"},{"title":"lib.element.player.getAllHistory","link":"<a href=\"lib.element.player.html#.getAllHistory\">lib.element.player.getAllHistory &rtrif; undefined</a>"},{"title":"lib.element.player.getAttackRange","link":"<a href=\"lib.element.player.html#.getAttackRange\">lib.element.player.getAttackRange &rtrif; undefined</a>"},{"title":"lib.element.player.getCards","link":"<a href=\"lib.element.player.html#.getCards\">lib.element.player.getCards &rtrif; undefined</a>"},{"title":"lib.element.player.getCards","link":"<a href=\"lib.element.player.html#.getCards\">lib.element.player.getCards &rtrif; undefined</a>"},{"title":"lib.element.player.getCards","link":"<a href=\"lib.element.player.html#.getCards\">lib.element.player.getCards &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(2)","link":"<a href=\"lib.element.player.html#.getCards2\">lib.element.player.getCards(2) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(2)","link":"<a href=\"lib.element.player.html#.getCards2\">lib.element.player.getCards(2) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(2)","link":"<a href=\"lib.element.player.html#.getCards2\">lib.element.player.getCards(2) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(3)","link":"<a href=\"lib.element.player.html#.getCards3\">lib.element.player.getCards(3) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(3)","link":"<a href=\"lib.element.player.html#.getCards3\">lib.element.player.getCards(3) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(3)","link":"<a href=\"lib.element.player.html#.getCards3\">lib.element.player.getCards(3) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(4)","link":"<a href=\"lib.element.player.html#.getCards4\">lib.element.player.getCards(4) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(4)","link":"<a href=\"lib.element.player.html#.getCards4\">lib.element.player.getCards(4) &rtrif; undefined</a>"},{"title":"lib.element.player.getCards(4)","link":"<a href=\"lib.element.player.html#.getCards4\">lib.element.player.getCards(4) &rtrif; undefined</a>"},{"title":"lib.element.player.getCardUsable","link":"<a href=\"lib.element.player.html#.getCardUsable\">lib.element.player.getCardUsable &rtrif; undefined</a>"},{"title":"lib.element.player.getDamagedHp","link":"<a href=\"lib.element.player.html#.getDamagedHp\">lib.element.player.getDamagedHp &rtrif; undefined</a>"},{"title":"lib.element.player.getEnemies","link":"<a href=\"lib.element.player.html#.getEnemies\">lib.element.player.getEnemies &rtrif; undefined</a>"},{"title":"lib.element.player.getEnemies","link":"<a href=\"lib.element.player.html#.getEnemies\">lib.element.player.getEnemies &rtrif; undefined</a>"},{"title":"lib.element.player.getEnemies","link":"<a href=\"lib.element.player.html#.getEnemies\">lib.element.player.getEnemies &rtrif; undefined</a>"},{"title":"lib.element.player.getEquip","link":"<a href=\"lib.element.player.html#.getEquip\">lib.element.player.getEquip &rtrif; undefined</a>"},{"title":"lib.element.player.getFriends","link":"<a href=\"lib.element.player.html#.getFriends\">lib.element.player.getFriends &rtrif; undefined</a>"},{"title":"lib.element.player.getFriends","link":"<a href=\"lib.element.player.html#.getFriends\">lib.element.player.getFriends &rtrif; undefined</a>"},{"title":"lib.element.player.getFriends","link":"<a href=\"lib.element.player.html#.getFriends\">lib.element.player.getFriends &rtrif; undefined</a>"},{"title":"lib.element.player.getFriends","link":"<a href=\"lib.element.player.html#.getFriends\">lib.element.player.getFriends &rtrif; undefined</a>"},{"title":"lib.element.player.getFriends","link":"<a href=\"lib.element.player.html#.getFriends\">lib.element.player.getFriends &rtrif; undefined</a>"},{"title":"lib.element.player.getFriends","link":"<a href=\"lib.element.player.html#.getFriends\">lib.element.player.getFriends &rtrif; undefined</a>"},{"title":"lib.element.player.getGlobalFrom","link":"<a href=\"lib.element.player.html#.getGlobalFrom\">lib.element.player.getGlobalFrom &rtrif; undefined</a>"},{"title":"lib.element.player.getGlobalTo","link":"<a href=\"lib.element.player.html#.getGlobalTo\">lib.element.player.getGlobalTo &rtrif; undefined</a>"},{"title":"lib.element.player.getHandcardLimit","link":"<a href=\"lib.element.player.html#.getHandcardLimit\">lib.element.player.getHandcardLimit &rtrif; undefined</a>"},{"title":"lib.element.player.getHistory","link":"<a href=\"lib.element.player.html#.getHistory\">lib.element.player.getHistory &rtrif; undefined</a>"},{"title":"lib.element.player.getId","link":"<a href=\"lib.element.player.html#.getId\">lib.element.player.getId &rtrif; undefined</a>"},{"title":"lib.element.player.getJudge","link":"<a href=\"lib.element.player.html#.getJudge\">lib.element.player.getJudge &rtrif; undefined</a>"},{"title":"lib.element.player.getLastHistory","link":"<a href=\"lib.element.player.html#.getLastHistory\">lib.element.player.getLastHistory &rtrif; undefined</a>"},{"title":"lib.element.player.getLastStat","link":"<a href=\"lib.element.player.html#.getLastStat\">lib.element.player.getLastStat &rtrif; undefined</a>"},{"title":"lib.element.player.getLastUsed","link":"<a href=\"lib.element.player.html#.getLastUsed\">lib.element.player.getLastUsed &rtrif; undefined</a>"},{"title":"lib.element.player.getLeft","link":"<a href=\"lib.element.player.html#.getLeft\">lib.element.player.getLeft &rtrif; undefined</a>"},{"title":"lib.element.player.getSkills","link":"<a href=\"lib.element.player.html#.getSkills\">lib.element.player.getSkills &rtrif; undefined</a>"},{"title":"lib.element.player.getStat","link":"<a href=\"lib.element.player.html#.getStat\">lib.element.player.getStat &rtrif; undefined</a>"},{"title":"lib.element.player.getState","link":"<a href=\"lib.element.player.html#.getState\">lib.element.player.getState &rtrif; undefined</a>"},{"title":"lib.element.player.getSubPlayers","link":"<a href=\"lib.element.player.html#.getSubPlayers\">lib.element.player.getSubPlayers &rtrif; undefined</a>"},{"title":"lib.element.player.getTop","link":"<a href=\"lib.element.player.html#.getTop\">lib.element.player.getTop &rtrif; undefined</a>"},{"title":"lib.element.player.getUseValue","link":"<a href=\"lib.element.player.html#.getUseValue\">lib.element.player.getUseValue &rtrif; undefined</a>"},{"title":"lib.element.player.goMad","link":"<a href=\"lib.element.player.html#.goMad\">lib.element.player.goMad &rtrif; undefined</a>"},{"title":"lib.element.player.hasCardAround","link":"<a href=\"lib.element.player.html#.hasCardAround\">lib.element.player.hasCardAround &rtrif; undefined</a>"},{"title":"lib.element.player.hasMark","link":"<a href=\"lib.element.player.html#.hasMark\">lib.element.player.hasMark &rtrif; undefined</a>"},{"title":"lib.element.player.hasSkill","link":"<a href=\"lib.element.player.html#.hasSkill\">lib.element.player.hasSkill &rtrif; undefined</a>"},{"title":"lib.element.player.hasUseTarget","link":"<a href=\"lib.element.player.html#.hasUseTarget\">lib.element.player.hasUseTarget &rtrif; undefined</a>"},{"title":"lib.element.player.hasValueTarget","link":"<a href=\"lib.element.player.html#.hasValueTarget\">lib.element.player.hasValueTarget &rtrif; undefined</a>"},{"title":"lib.element.player.init","link":"<a href=\"lib.element.player.html#.init\">lib.element.player.init &rtrif; undefined</a>"},{"title":"lib.element.player.initOL","link":"<a href=\"lib.element.player.html#.initOL\">lib.element.player.initOL &rtrif; undefined</a>"},{"title":"lib.element.player.initRoom","link":"<a href=\"lib.element.player.html#.initRoom\">lib.element.player.initRoom &rtrif; undefined</a>"},{"title":"lib.element.player.inRange","link":"<a href=\"lib.element.player.html#.inRange\">lib.element.player.inRange &rtrif; undefined</a>"},{"title":"lib.element.player.inRangeOf","link":"<a href=\"lib.element.player.html#.inRangeOf\">lib.element.player.inRangeOf &rtrif; undefined</a>"},{"title":"lib.element.player.isAlive","link":"<a href=\"lib.element.player.html#.isAlive\">lib.element.player.isAlive &rtrif; undefined</a>"},{"title":"lib.element.player.isDamaged","link":"<a href=\"lib.element.player.html#.isDamaged\">lib.element.player.isDamaged &rtrif; undefined</a>"},{"title":"lib.element.player.isDead","link":"<a href=\"lib.element.player.html#.isDead\">lib.element.player.isDead &rtrif; undefined</a>"},{"title":"lib.element.player.isDying","link":"<a href=\"lib.element.player.html#.isDying\">lib.element.player.isDying &rtrif; undefined</a>"},{"title":"lib.element.player.isEnemiesOf","link":"<a href=\"lib.element.player.html#.isEnemiesOf\">lib.element.player.isEnemiesOf &rtrif; undefined</a>"},{"title":"lib.element.player.isEnemyOf","link":"<a href=\"lib.element.player.html#.isEnemyOf\">lib.element.player.isEnemyOf &rtrif; undefined</a>"},{"title":"lib.element.player.isFriendOf","link":"<a href=\"lib.element.player.html#.isFriendOf\">lib.element.player.isFriendOf &rtrif; undefined</a>"},{"title":"lib.element.player.isFriendsOf","link":"<a href=\"lib.element.player.html#.isFriendsOf\">lib.element.player.isFriendsOf &rtrif; undefined</a>"},{"title":"lib.element.player.isHealthy","link":"<a href=\"lib.element.player.html#.isHealthy\">lib.element.player.isHealthy &rtrif; undefined</a>"},{"title":"lib.element.player.isIn","link":"<a href=\"lib.element.player.html#.isIn\">lib.element.player.isIn &rtrif; undefined</a>"},{"title":"lib.element.player.isLinked","link":"<a href=\"lib.element.player.html#.isLinked\">lib.element.player.isLinked &rtrif; undefined</a>"},{"title":"lib.element.player.isMad","link":"<a href=\"lib.element.player.html#.isMad\">lib.element.player.isMad &rtrif; undefined</a>"},{"title":"lib.element.player.isMaxCard","link":"<a href=\"lib.element.player.html#.isMaxCard\">lib.element.player.isMaxCard &rtrif; undefined</a>"},{"title":"lib.element.player.isMaxEquip","link":"<a href=\"lib.element.player.html#.isMaxEquip\">lib.element.player.isMaxEquip &rtrif; undefined</a>"},{"title":"lib.element.player.isMaxHandcard","link":"<a href=\"lib.element.player.html#.isMaxHandcard\">lib.element.player.isMaxHandcard &rtrif; undefined</a>"},{"title":"lib.element.player.isMaxHp","link":"<a href=\"lib.element.player.html#.isMaxHp\">lib.element.player.isMaxHp &rtrif; undefined</a>"},{"title":"lib.element.player.isMin","link":"<a href=\"lib.element.player.html#.isMin\">lib.element.player.isMin &rtrif; undefined</a>"},{"title":"lib.element.player.isMinCard","link":"<a href=\"lib.element.player.html#.isMinCard\">lib.element.player.isMinCard &rtrif; undefined</a>"},{"title":"lib.element.player.isMinEquip","link":"<a href=\"lib.element.player.html#.isMinEquip\">lib.element.player.isMinEquip &rtrif; undefined</a>"},{"title":"lib.element.player.isMinHandcard","link":"<a href=\"lib.element.player.html#.isMinHandcard\">lib.element.player.isMinHandcard &rtrif; undefined</a>"},{"title":"lib.element.player.isMinHp","link":"<a href=\"lib.element.player.html#.isMinHp\">lib.element.player.isMinHp &rtrif; undefined</a>"},{"title":"lib.element.player.isOffline","link":"<a href=\"lib.element.player.html#.isOffline\">lib.element.player.isOffline &rtrif; undefined</a>"},{"title":"lib.element.player.isOnline","link":"<a href=\"lib.element.player.html#.isOnline\">lib.element.player.isOnline &rtrif; undefined</a>"},{"title":"lib.element.player.isOnline2","link":"<a href=\"lib.element.player.html#.isOnline2\">lib.element.player.isOnline2 &rtrif; undefined</a>"},{"title":"lib.element.player.isOut","link":"<a href=\"lib.element.player.html#.isOut\">lib.element.player.isOut &rtrif; undefined</a>"},{"title":"lib.element.player.isTurnedOver","link":"<a href=\"lib.element.player.html#.isTurnedOver\">lib.element.player.isTurnedOver &rtrif; undefined</a>"},{"title":"lib.element.player.isUnderControl","link":"<a href=\"lib.element.player.html#.isUnderControl\">lib.element.player.isUnderControl &rtrif; undefined</a>"},{"title":"lib.element.player.isUnseen","link":"<a href=\"lib.element.player.html#.isUnseen\">lib.element.player.isUnseen &rtrif; undefined</a>"},{"title":"lib.element.player.judge","link":"<a href=\"lib.element.player.html#.judge\">lib.element.player.judge &rtrif; undefined</a>"},{"title":"lib.element.player.link","link":"<a href=\"lib.element.player.html#.link\">lib.element.player.link &rtrif; undefined</a>"},{"title":"lib.element.player.logSkill","link":"<a href=\"lib.element.player.html#.logSkill\">lib.element.player.logSkill &rtrif; undefined</a>"},{"title":"lib.element.player.loseToSpecial","link":"<a href=\"lib.element.player.html#.loseToSpecial\">lib.element.player.loseToSpecial &rtrif; undefined</a>"},{"title":"lib.element.player.mark","link":"<a href=\"lib.element.player.html#.mark\">lib.element.player.mark &rtrif; undefined</a>"},{"title":"lib.element.player.needsToDiscard","link":"<a href=\"lib.element.player.html#.needsToDiscard\">lib.element.player.needsToDiscard &rtrif; undefined</a>"},{"title":"lib.element.player.popup","link":"<a href=\"lib.element.player.html#.popup\">lib.element.player.popup &rtrif; undefined</a>"},{"title":"lib.element.player.queue","link":"<a href=\"lib.element.player.html#.queue\">lib.element.player.queue &rtrif; undefined</a>"},{"title":"lib.element.player.reinit","link":"<a href=\"lib.element.player.html#.reinit\">lib.element.player.reinit &rtrif; undefined</a>"},{"title":"lib.element.player.removeAdditionalSkill","link":"<a href=\"lib.element.player.html#.removeAdditionalSkill\">lib.element.player.removeAdditionalSkill &rtrif; undefined</a>"},{"title":"lib.element.player.removeEquipTrigger","link":"<a href=\"lib.element.player.html#.removeEquipTrigger\">lib.element.player.removeEquipTrigger &rtrif; undefined</a>"},{"title":"lib.element.player.removeGaintag","link":"<a href=\"lib.element.player.html#.removeGaintag\">lib.element.player.removeGaintag &rtrif; undefined</a>"},{"title":"lib.element.player.removeMark","link":"<a href=\"lib.element.player.html#.removeMark\">lib.element.player.removeMark &rtrif; undefined</a>"},{"title":"lib.element.player.removeSkill","link":"<a href=\"lib.element.player.html#.removeSkill\">lib.element.player.removeSkill &rtrif; undefined</a>"},{"title":"lib.element.player.removeSkillBlocker","link":"<a href=\"lib.element.player.html#.removeSkillBlocker\">lib.element.player.removeSkillBlocker &rtrif; undefined</a>"},{"title":"lib.element.player.removeSkillTrigger","link":"<a href=\"lib.element.player.html#.removeSkillTrigger\">lib.element.player.removeSkillTrigger &rtrif; undefined</a>"},{"title":"lib.element.player.removeSubPlayer","link":"<a href=\"lib.element.player.html#.removeSubPlayer\">lib.element.player.removeSubPlayer &rtrif; undefined</a>"},{"title":"lib.element.player.restoreSkill","link":"<a href=\"lib.element.player.html#.restoreSkill\">lib.element.player.restoreSkill &rtrif; undefined</a>"},{"title":"lib.element.player.say","link":"<a href=\"lib.element.player.html#.say\">lib.element.player.say &rtrif; undefined</a>"},{"title":"lib.element.player.send","link":"<a href=\"lib.element.player.html#.send\">lib.element.player.send &rtrif; undefined</a>"},{"title":"lib.element.player.setAvatar","link":"<a href=\"lib.element.player.html#.setAvatar\">lib.element.player.setAvatar &rtrif; undefined</a>"},{"title":"lib.element.player.setAvatarQueue","link":"<a href=\"lib.element.player.html#.setAvatarQueue\">lib.element.player.setAvatarQueue &rtrif; undefined</a>"},{"title":"lib.element.player.setIdentity","link":"<a href=\"lib.element.player.html#.setIdentity\">lib.element.player.setIdentity &rtrif; undefined</a>"},{"title":"lib.element.player.setNickname","link":"<a href=\"lib.element.player.html#.setNickname\">lib.element.player.setNickname &rtrif; undefined</a>"},{"title":"lib.element.player.showCharacter","link":"<a href=\"lib.element.player.html#.showCharacter\">lib.element.player.showCharacter &rtrif; undefined</a>"},{"title":"lib.element.player.showGiveup","link":"<a href=\"lib.element.player.html#.showGiveup\">lib.element.player.showGiveup &rtrif; undefined</a>"},{"title":"lib.element.player.smoothAvatar","link":"<a href=\"lib.element.player.html#.smoothAvatar\">lib.element.player.smoothAvatar &rtrif; undefined</a>"},{"title":"lib.element.player.syncStorage","link":"<a href=\"lib.element.player.html#.syncStorage\">lib.element.player.syncStorage &rtrif; undefined</a>"},{"title":"lib.element.player.throwEmotion","link":"<a href=\"lib.element.player.html#.throwEmotion\">lib.element.player.throwEmotion &rtrif; undefined</a>"},{"title":"lib.element.player.toggleSubPlayer","link":"<a href=\"lib.element.player.html#.toggleSubPlayer\">lib.element.player.toggleSubPlayer &rtrif; undefined</a>"},{"title":"lib.element.player.tryCardAnimate","link":"<a href=\"lib.element.player.html#.tryCardAnimate\">lib.element.player.tryCardAnimate &rtrif; undefined</a>"},{"title":"lib.element.player.trySkillAnimate","link":"<a href=\"lib.element.player.html#.trySkillAnimate\">lib.element.player.trySkillAnimate &rtrif; undefined</a>"},{"title":"lib.element.player.turnOver","link":"<a href=\"lib.element.player.html#.turnOver\">lib.element.player.turnOver &rtrif; undefined</a>"},{"title":"lib.element.player.uninit","link":"<a href=\"lib.element.player.html#.uninit\">lib.element.player.uninit &rtrif; undefined</a>"},{"title":"lib.element.player.uninitOL","link":"<a href=\"lib.element.player.html#.uninitOL\">lib.element.player.uninitOL &rtrif; undefined</a>"},{"title":"lib.element.player.unMad","link":"<a href=\"lib.element.player.html#.unMad\">lib.element.player.unMad &rtrif; undefined</a>"},{"title":"lib.element.player.unmark","link":"<a href=\"lib.element.player.html#.unmark\">lib.element.player.unmark &rtrif; undefined</a>"},{"title":"lib.element.player.update","link":"<a href=\"lib.element.player.html#.update\">lib.element.player.update &rtrif; undefined</a>"},{"title":"lib.element.player.updateMark","link":"<a href=\"lib.element.player.html#.updateMark\">lib.element.player.updateMark &rtrif; undefined</a>"},{"title":"lib.element.player.updateMarks","link":"<a href=\"lib.element.player.html#.updateMarks\">lib.element.player.updateMarks &rtrif; undefined</a>"},{"title":"lib.element.player.useResult","link":"<a href=\"lib.element.player.html#.useResult\">lib.element.player.useResult &rtrif; undefined</a>"},{"title":"card","link":"<a href=\"module-core.lib.element.card.html\">card</a>"},{"title":"module:core.lib.element.card.addGaintag","link":"<a href=\"module-core.lib.element.card.html#.addGaintag\">module:core.lib.element.card.addGaintag &rtrif; undefined</a>"},{"title":"module:core.lib.element.card.hasGaintag","link":"<a href=\"module-core.lib.element.card.html#.hasGaintag\">module:core.lib.element.card.hasGaintag &rtrif; undefined</a>"},{"title":"module:core.lib.element.card.hasPosition","link":"<a href=\"module-core.lib.element.card.html#.hasPosition\">module:core.lib.element.card.hasPosition &rtrif; undefined</a>"},{"title":"module:core.lib.element.card.init","link":"<a href=\"module-core.lib.element.card.html#.init\">module:core.lib.element.card.init &rtrif; undefined</a>"},{"title":"module:core.lib.element.card.isInPile","link":"<a href=\"module-core.lib.element.card.html#.isInPile\">module:core.lib.element.card.isInPile &rtrif; undefined</a>"},{"title":"module:core.lib.element.card.removeGaintag","link":"<a href=\"module-core.lib.element.card.html#.removeGaintag\">module:core.lib.element.card.removeGaintag &rtrif; undefined</a>"},{"title":"module:core.lib.element.card.updateTransform","link":"<a href=\"module-core.lib.element.card.html#.updateTransform\">module:core.lib.element.card.updateTransform &rtrif; undefined</a>"},{"title":"event","link":"<a href=\"module-core.lib.element.event.html\">event</a>"},{"title":"module:core.lib.element.event.backup","link":"<a href=\"module-core.lib.element.event.html#.backup\">module:core.lib.element.event.backup &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.cancel","link":"<a href=\"module-core.lib.element.event.html#.cancel\">module:core.lib.element.event.cancel &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.finish","link":"<a href=\"module-core.lib.element.event.html#.finish\">module:core.lib.element.event.finish &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.getParent","link":"<a href=\"module-core.lib.element.event.html#.getParent\">module:core.lib.element.event.getParent &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.getRand","link":"<a href=\"module-core.lib.element.event.html#.getRand\">module:core.lib.element.event.getRand &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.getTrigger","link":"<a href=\"module-core.lib.element.event.html#.getTrigger\">module:core.lib.element.event.getTrigger &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.goto","link":"<a href=\"module-core.lib.element.event.html#.goto\">module:core.lib.element.event.goto &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.insert","link":"<a href=\"module-core.lib.element.event.html#.insert\">module:core.lib.element.event.insert &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.insertAfter","link":"<a href=\"module-core.lib.element.event.html#.insertAfter\">module:core.lib.element.event.insertAfter &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.redo","link":"<a href=\"module-core.lib.element.event.html#.redo\">module:core.lib.element.event.redo &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.resume","link":"<a href=\"module-core.lib.element.event.html#.resume\">module:core.lib.element.event.resume &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.setContent","link":"<a href=\"module-core.lib.element.event.html#.setContent\">module:core.lib.element.event.setContent &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.trigger","link":"<a href=\"module-core.lib.element.event.html#.trigger\">module:core.lib.element.event.trigger &rtrif; undefined</a>"},{"title":"module:core.lib.element.event.untrigger","link":"<a href=\"module-core.lib.element.event.html#.untrigger\">module:core.lib.element.event.untrigger &rtrif; undefined</a>"},{"title":"player","link":"<a href=\"module-core.lib.element.player.html\">player</a>"},{"title":"module:core.lib.element.player.$damagepop","link":"<a href=\"module-core.lib.element.player.html#.$damagepop\">module:core.lib.element.player.$damagepop &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.$showCharacter","link":"<a href=\"module-core.lib.element.player.html#.$showCharacter\">module:core.lib.element.player.$showCharacter &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.$skill","link":"<a href=\"module-core.lib.element.player.html#.$skill\">module:core.lib.element.player.$skill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.$throwEmotion","link":"<a href=\"module-core.lib.element.player.html#.$throwEmotion\">module:core.lib.element.player.$throwEmotion &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addAdditionalSkill","link":"<a href=\"module-core.lib.element.player.html#.addAdditionalSkill\">module:core.lib.element.player.addAdditionalSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addEquipTrigger","link":"<a href=\"module-core.lib.element.player.html#.addEquipTrigger\">module:core.lib.element.player.addEquipTrigger &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addGaintag","link":"<a href=\"module-core.lib.element.player.html#.addGaintag\">module:core.lib.element.player.addGaintag &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addMark","link":"<a href=\"module-core.lib.element.player.html#.addMark\">module:core.lib.element.player.addMark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addSkillBlocker","link":"<a href=\"module-core.lib.element.player.html#.addSkillBlocker\">module:core.lib.element.player.addSkillBlocker &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addSkillLog","link":"<a href=\"module-core.lib.element.player.html#.addSkillLog\">module:core.lib.element.player.addSkillLog &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addSkillTrigger","link":"<a href=\"module-core.lib.element.player.html#.addSkillTrigger\">module:core.lib.element.player.addSkillTrigger &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addSubPlayer","link":"<a href=\"module-core.lib.element.player.html#.addSubPlayer\">module:core.lib.element.player.addSubPlayer &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addTempSkill","link":"<a href=\"module-core.lib.element.player.html#.addTempSkill\">module:core.lib.element.player.addTempSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.addToJudge","link":"<a href=\"module-core.lib.element.player.html#.addToJudge\">module:core.lib.element.player.addToJudge &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.applySkills","link":"<a href=\"module-core.lib.element.player.html#.applySkills\">module:core.lib.element.player.applySkills &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.attitudeTo","link":"<a href=\"module-core.lib.element.player.html#.attitudeTo\">module:core.lib.element.player.attitudeTo &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.awakenSkill","link":"<a href=\"module-core.lib.element.player.html#.awakenSkill\">module:core.lib.element.player.awakenSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.buffAvatar","link":"<a href=\"module-core.lib.element.player.html#.buffAvatar\">module:core.lib.element.player.buffAvatar &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.callSubPlayer","link":"<a href=\"module-core.lib.element.player.html#.callSubPlayer\">module:core.lib.element.player.callSubPlayer &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.canAddToJudge","link":"<a href=\"module-core.lib.element.player.html#.canAddToJudge\">module:core.lib.element.player.canAddToJudge &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.canSave","link":"<a href=\"module-core.lib.element.player.html#.canSave\">module:core.lib.element.player.canSave &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.canUse","link":"<a href=\"module-core.lib.element.player.html#.canUse\">module:core.lib.element.player.canUse &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.changeSeat","link":"<a href=\"module-core.lib.element.player.html#.changeSeat\">module:core.lib.element.player.changeSeat &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.chat","link":"<a href=\"module-core.lib.element.player.html#.chat\">module:core.lib.element.player.chat &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.checkConflict","link":"<a href=\"module-core.lib.element.player.html#.checkConflict\">module:core.lib.element.player.checkConflict &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.checkMarks","link":"<a href=\"module-core.lib.element.player.html#.checkMarks\">module:core.lib.element.player.checkMarks &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.chooseToGuanxing","link":"<a href=\"module-core.lib.element.player.html#.chooseToGuanxing\">module:core.lib.element.player.chooseToGuanxing &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.clearSkills","link":"<a href=\"module-core.lib.element.player.html#.clearSkills\">module:core.lib.element.player.clearSkills &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.countMark","link":"<a href=\"module-core.lib.element.player.html#.countMark\">module:core.lib.element.player.countMark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.directgains","link":"<a href=\"module-core.lib.element.player.html#.directgains\">module:core.lib.element.player.directgains &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.disableSkill","link":"<a href=\"module-core.lib.element.player.html#.disableSkill\">module:core.lib.element.player.disableSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.emotion","link":"<a href=\"module-core.lib.element.player.html#.emotion\">module:core.lib.element.player.emotion &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.enableSkill","link":"<a href=\"module-core.lib.element.player.html#.enableSkill\">module:core.lib.element.player.enableSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.exitSubPlayer","link":"<a href=\"module-core.lib.element.player.html#.exitSubPlayer\">module:core.lib.element.player.exitSubPlayer &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.flashAvatar","link":"<a href=\"module-core.lib.element.player.html#.flashAvatar\">module:core.lib.element.player.flashAvatar &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.get","link":"<a href=\"module-core.lib.element.player.html#.get\">module:core.lib.element.player.get &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getAllHistory","link":"<a href=\"module-core.lib.element.player.html#.getAllHistory\">module:core.lib.element.player.getAllHistory &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getAttackRange","link":"<a href=\"module-core.lib.element.player.html#.getAttackRange\">module:core.lib.element.player.getAttackRange &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getCardUsable","link":"<a href=\"module-core.lib.element.player.html#.getCardUsable\">module:core.lib.element.player.getCardUsable &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getDamagedHp","link":"<a href=\"module-core.lib.element.player.html#.getDamagedHp\">module:core.lib.element.player.getDamagedHp &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getEquip","link":"<a href=\"module-core.lib.element.player.html#.getEquip\">module:core.lib.element.player.getEquip &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getGlobalFrom","link":"<a href=\"module-core.lib.element.player.html#.getGlobalFrom\">module:core.lib.element.player.getGlobalFrom &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getGlobalTo","link":"<a href=\"module-core.lib.element.player.html#.getGlobalTo\">module:core.lib.element.player.getGlobalTo &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getHandcardLimit","link":"<a href=\"module-core.lib.element.player.html#.getHandcardLimit\">module:core.lib.element.player.getHandcardLimit &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getHistory","link":"<a href=\"module-core.lib.element.player.html#.getHistory\">module:core.lib.element.player.getHistory &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getId","link":"<a href=\"module-core.lib.element.player.html#.getId\">module:core.lib.element.player.getId &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getJudge","link":"<a href=\"module-core.lib.element.player.html#.getJudge\">module:core.lib.element.player.getJudge &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getLastHistory","link":"<a href=\"module-core.lib.element.player.html#.getLastHistory\">module:core.lib.element.player.getLastHistory &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getLastStat","link":"<a href=\"module-core.lib.element.player.html#.getLastStat\">module:core.lib.element.player.getLastStat &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getLastUsed","link":"<a href=\"module-core.lib.element.player.html#.getLastUsed\">module:core.lib.element.player.getLastUsed &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getLeft","link":"<a href=\"module-core.lib.element.player.html#.getLeft\">module:core.lib.element.player.getLeft &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getSkills","link":"<a href=\"module-core.lib.element.player.html#.getSkills\">module:core.lib.element.player.getSkills &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getStat","link":"<a href=\"module-core.lib.element.player.html#.getStat\">module:core.lib.element.player.getStat &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getState","link":"<a href=\"module-core.lib.element.player.html#.getState\">module:core.lib.element.player.getState &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getSubPlayers","link":"<a href=\"module-core.lib.element.player.html#.getSubPlayers\">module:core.lib.element.player.getSubPlayers &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getTop","link":"<a href=\"module-core.lib.element.player.html#.getTop\">module:core.lib.element.player.getTop &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.getUseValue","link":"<a href=\"module-core.lib.element.player.html#.getUseValue\">module:core.lib.element.player.getUseValue &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.goMad","link":"<a href=\"module-core.lib.element.player.html#.goMad\">module:core.lib.element.player.goMad &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.hasCardAround","link":"<a href=\"module-core.lib.element.player.html#.hasCardAround\">module:core.lib.element.player.hasCardAround &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.hasMark","link":"<a href=\"module-core.lib.element.player.html#.hasMark\">module:core.lib.element.player.hasMark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.hasSkill","link":"<a href=\"module-core.lib.element.player.html#.hasSkill\">module:core.lib.element.player.hasSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.hasUseTarget","link":"<a href=\"module-core.lib.element.player.html#.hasUseTarget\">module:core.lib.element.player.hasUseTarget &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.hasValueTarget","link":"<a href=\"module-core.lib.element.player.html#.hasValueTarget\">module:core.lib.element.player.hasValueTarget &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.init","link":"<a href=\"module-core.lib.element.player.html#.init\">module:core.lib.element.player.init &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.initOL","link":"<a href=\"module-core.lib.element.player.html#.initOL\">module:core.lib.element.player.initOL &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.initRoom","link":"<a href=\"module-core.lib.element.player.html#.initRoom\">module:core.lib.element.player.initRoom &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.inRange","link":"<a href=\"module-core.lib.element.player.html#.inRange\">module:core.lib.element.player.inRange &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.inRangeOf","link":"<a href=\"module-core.lib.element.player.html#.inRangeOf\">module:core.lib.element.player.inRangeOf &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isAlive","link":"<a href=\"module-core.lib.element.player.html#.isAlive\">module:core.lib.element.player.isAlive &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isDamaged","link":"<a href=\"module-core.lib.element.player.html#.isDamaged\">module:core.lib.element.player.isDamaged &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isDead","link":"<a href=\"module-core.lib.element.player.html#.isDead\">module:core.lib.element.player.isDead &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isDying","link":"<a href=\"module-core.lib.element.player.html#.isDying\">module:core.lib.element.player.isDying &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isEnemiesOf","link":"<a href=\"module-core.lib.element.player.html#.isEnemiesOf\">module:core.lib.element.player.isEnemiesOf &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isEnemyOf","link":"<a href=\"module-core.lib.element.player.html#.isEnemyOf\">module:core.lib.element.player.isEnemyOf &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isFriendOf","link":"<a href=\"module-core.lib.element.player.html#.isFriendOf\">module:core.lib.element.player.isFriendOf &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isFriendsOf","link":"<a href=\"module-core.lib.element.player.html#.isFriendsOf\">module:core.lib.element.player.isFriendsOf &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isHealthy","link":"<a href=\"module-core.lib.element.player.html#.isHealthy\">module:core.lib.element.player.isHealthy &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isIn","link":"<a href=\"module-core.lib.element.player.html#.isIn\">module:core.lib.element.player.isIn &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isLinked","link":"<a href=\"module-core.lib.element.player.html#.isLinked\">module:core.lib.element.player.isLinked &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMad","link":"<a href=\"module-core.lib.element.player.html#.isMad\">module:core.lib.element.player.isMad &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMaxCard","link":"<a href=\"module-core.lib.element.player.html#.isMaxCard\">module:core.lib.element.player.isMaxCard &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMaxEquip","link":"<a href=\"module-core.lib.element.player.html#.isMaxEquip\">module:core.lib.element.player.isMaxEquip &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMaxHandcard","link":"<a href=\"module-core.lib.element.player.html#.isMaxHandcard\">module:core.lib.element.player.isMaxHandcard &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMaxHp","link":"<a href=\"module-core.lib.element.player.html#.isMaxHp\">module:core.lib.element.player.isMaxHp &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMin","link":"<a href=\"module-core.lib.element.player.html#.isMin\">module:core.lib.element.player.isMin &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMinCard","link":"<a href=\"module-core.lib.element.player.html#.isMinCard\">module:core.lib.element.player.isMinCard &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMinEquip","link":"<a href=\"module-core.lib.element.player.html#.isMinEquip\">module:core.lib.element.player.isMinEquip &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMinHandcard","link":"<a href=\"module-core.lib.element.player.html#.isMinHandcard\">module:core.lib.element.player.isMinHandcard &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isMinHp","link":"<a href=\"module-core.lib.element.player.html#.isMinHp\">module:core.lib.element.player.isMinHp &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isOffline","link":"<a href=\"module-core.lib.element.player.html#.isOffline\">module:core.lib.element.player.isOffline &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isOnline","link":"<a href=\"module-core.lib.element.player.html#.isOnline\">module:core.lib.element.player.isOnline &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isOnline2","link":"<a href=\"module-core.lib.element.player.html#.isOnline2\">module:core.lib.element.player.isOnline2 &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isOut","link":"<a href=\"module-core.lib.element.player.html#.isOut\">module:core.lib.element.player.isOut &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isTurnedOver","link":"<a href=\"module-core.lib.element.player.html#.isTurnedOver\">module:core.lib.element.player.isTurnedOver &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isUnderControl","link":"<a href=\"module-core.lib.element.player.html#.isUnderControl\">module:core.lib.element.player.isUnderControl &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.isUnseen","link":"<a href=\"module-core.lib.element.player.html#.isUnseen\">module:core.lib.element.player.isUnseen &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.judge","link":"<a href=\"module-core.lib.element.player.html#.judge\">module:core.lib.element.player.judge &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.link","link":"<a href=\"module-core.lib.element.player.html#.link\">module:core.lib.element.player.link &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.logSkill","link":"<a href=\"module-core.lib.element.player.html#.logSkill\">module:core.lib.element.player.logSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.loseToSpecial","link":"<a href=\"module-core.lib.element.player.html#.loseToSpecial\">module:core.lib.element.player.loseToSpecial &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.mark","link":"<a href=\"module-core.lib.element.player.html#.mark\">module:core.lib.element.player.mark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.needsToDiscard","link":"<a href=\"module-core.lib.element.player.html#.needsToDiscard\">module:core.lib.element.player.needsToDiscard &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.popup","link":"<a href=\"module-core.lib.element.player.html#.popup\">module:core.lib.element.player.popup &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.queue","link":"<a href=\"module-core.lib.element.player.html#.queue\">module:core.lib.element.player.queue &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.reinit","link":"<a href=\"module-core.lib.element.player.html#.reinit\">module:core.lib.element.player.reinit &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeAdditionalSkill","link":"<a href=\"module-core.lib.element.player.html#.removeAdditionalSkill\">module:core.lib.element.player.removeAdditionalSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeEquipTrigger","link":"<a href=\"module-core.lib.element.player.html#.removeEquipTrigger\">module:core.lib.element.player.removeEquipTrigger &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeGaintag","link":"<a href=\"module-core.lib.element.player.html#.removeGaintag\">module:core.lib.element.player.removeGaintag &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeMark","link":"<a href=\"module-core.lib.element.player.html#.removeMark\">module:core.lib.element.player.removeMark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeSkill","link":"<a href=\"module-core.lib.element.player.html#.removeSkill\">module:core.lib.element.player.removeSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeSkillBlocker","link":"<a href=\"module-core.lib.element.player.html#.removeSkillBlocker\">module:core.lib.element.player.removeSkillBlocker &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeSkillTrigger","link":"<a href=\"module-core.lib.element.player.html#.removeSkillTrigger\">module:core.lib.element.player.removeSkillTrigger &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.removeSubPlayer","link":"<a href=\"module-core.lib.element.player.html#.removeSubPlayer\">module:core.lib.element.player.removeSubPlayer &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.restoreSkill","link":"<a href=\"module-core.lib.element.player.html#.restoreSkill\">module:core.lib.element.player.restoreSkill &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.say","link":"<a href=\"module-core.lib.element.player.html#.say\">module:core.lib.element.player.say &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.send","link":"<a href=\"module-core.lib.element.player.html#.send\">module:core.lib.element.player.send &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.setAvatar","link":"<a href=\"module-core.lib.element.player.html#.setAvatar\">module:core.lib.element.player.setAvatar &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.setAvatarQueue","link":"<a href=\"module-core.lib.element.player.html#.setAvatarQueue\">module:core.lib.element.player.setAvatarQueue &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.setIdentity","link":"<a href=\"module-core.lib.element.player.html#.setIdentity\">module:core.lib.element.player.setIdentity &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.setNickname","link":"<a href=\"module-core.lib.element.player.html#.setNickname\">module:core.lib.element.player.setNickname &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.showCharacter","link":"<a href=\"module-core.lib.element.player.html#.showCharacter\">module:core.lib.element.player.showCharacter &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.showGiveup","link":"<a href=\"module-core.lib.element.player.html#.showGiveup\">module:core.lib.element.player.showGiveup &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.smoothAvatar","link":"<a href=\"module-core.lib.element.player.html#.smoothAvatar\">module:core.lib.element.player.smoothAvatar &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.syncStorage","link":"<a href=\"module-core.lib.element.player.html#.syncStorage\">module:core.lib.element.player.syncStorage &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.throwEmotion","link":"<a href=\"module-core.lib.element.player.html#.throwEmotion\">module:core.lib.element.player.throwEmotion &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.toggleSubPlayer","link":"<a href=\"module-core.lib.element.player.html#.toggleSubPlayer\">module:core.lib.element.player.toggleSubPlayer &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.tryCardAnimate","link":"<a href=\"module-core.lib.element.player.html#.tryCardAnimate\">module:core.lib.element.player.tryCardAnimate &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.trySkillAnimate","link":"<a href=\"module-core.lib.element.player.html#.trySkillAnimate\">module:core.lib.element.player.trySkillAnimate &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.turnOver","link":"<a href=\"module-core.lib.element.player.html#.turnOver\">module:core.lib.element.player.turnOver &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.uninit","link":"<a href=\"module-core.lib.element.player.html#.uninit\">module:core.lib.element.player.uninit &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.uninitOL","link":"<a href=\"module-core.lib.element.player.html#.uninitOL\">module:core.lib.element.player.uninitOL &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.unMad","link":"<a href=\"module-core.lib.element.player.html#.unMad\">module:core.lib.element.player.unMad &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.unmark","link":"<a href=\"module-core.lib.element.player.html#.unmark\">module:core.lib.element.player.unmark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.update","link":"<a href=\"module-core.lib.element.player.html#.update\">module:core.lib.element.player.update &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.updateMark","link":"<a href=\"module-core.lib.element.player.html#.updateMark\">module:core.lib.element.player.updateMark &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.updateMarks","link":"<a href=\"module-core.lib.element.player.html#.updateMarks\">module:core.lib.element.player.updateMarks &rtrif; undefined</a>"},{"title":"module:core.lib.element.player.useResult","link":"<a href=\"module-core.lib.element.player.html#.useResult\">module:core.lib.element.player.useResult &rtrif; undefined</a>"},{"title":"animate","link":"<a href=\"global.html#animate\">animate</a>"},{"title":"assert","link":"<a href=\"global.html#assert\">assert</a>"},{"title":"cheat","link":"<a href=\"global.html#cheat\">cheat</a>"},{"title":"css","link":"<a href=\"global.html#css\">css</a>"},{"title":"delete","link":"<a href=\"global.html#delete\">delete</a>"},{"title":"fix","link":"<a href=\"global.html#fix\">fix</a>"},{"title":"GameConfig","link":"<a href=\"global.html#GameConfig\">GameConfig</a>"},{"title":"goto","link":"<a href=\"global.html#goto\">goto</a>"},{"title":"hide","link":"<a href=\"global.html#hide\">hide</a>"},{"title":"isNonameServer","link":"<a href=\"global.html#isNonameServer\">isNonameServer</a>"},{"title":"listen","link":"<a href=\"global.html#listen\">listen</a>"},{"title":"listenTransition","link":"<a href=\"global.html#listenTransition\">listenTransition</a>"},{"title":"localStorage","link":"<a href=\"global.html#localStorage\">localStorage</a>"},{"title":"mixin","link":"<a href=\"global.html#mixin\">mixin</a>"},{"title":"nodb","link":"<a href=\"global.html#nodb\">nodb</a>"},{"title":"onerror","link":"<a href=\"global.html#onerror\">onerror</a>"},{"title":"onkeydown","link":"<a href=\"global.html#onkeydown\">onkeydown</a>"},{"title":"onload","link":"<a href=\"global.html#onload\">onload</a>"},{"title":"refocus","link":"<a href=\"global.html#refocus\">refocus</a>"},{"title":"setBackground","link":"<a href=\"global.html#setBackground\">setBackground</a>"},{"title":"setBackgroundDB","link":"<a href=\"global.html#setBackgroundDB\">setBackgroundDB</a>"},{"title":"setBackgroundImage","link":"<a href=\"global.html#setBackgroundImage\">setBackgroundImage</a>"},{"title":"setPosition","link":"<a href=\"global.html#setPosition\">setPosition</a>"},{"title":"setPosition","link":"<a href=\"global.html#setPosition2\">setPosition</a>"},{"title":"show","link":"<a href=\"global.html#show\">show</a>"},{"title":"unfocus","link":"<a href=\"global.html#unfocus\">unfocus</a>"}];
        var options = 
          setupSearch(list, options)
      </script>
    

    
    <script type="text/javascript">
        MathJax = { loader: { load: ['[custom]/xypic.js'], paths: {custom: 'https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/'} }, tex: { inlineMath:[['$', '$']], packages: {'[+]': ['xypic']} } };
    </script>
    

    
      <script src="scripts/resize.js"></script>
      <script type="text/javascript">
        var option = {"min":"300","max":"600"}
        setupResizeOptions(option)
      </script>
    

    
    <script type="text/javascript">
    MathJax = { loader: { load: ['[custom]/xypic.js'], paths: {custom: 'https://cdn.jsdelivr.net/gh/sonoisa/XyJax-v3@3.0.1/build/'} }, tex: { inlineMath:[['$', '$']], packages: {'[+]': ['xypic']} } };
    </script>
    

    


  </body>

</html>
